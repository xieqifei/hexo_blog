{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/volantis/source/js/aplayer.js","path":"js/aplayer.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/app.js","path":"js/app.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/valine.js","path":"js/valine.js","modified":0,"renderable":1},{"_id":"themes/volantis/source/js/search.js","path":"js/search.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/_data/friends.json","hash":"57ba2b4421aa2badfb7c0a5e924da370c9b96512","modified":1572113582000},{"_id":"source/CNAME","hash":"70b5b9ae3771b9fc0402fa6a3beb0a7e425fc328","modified":1598462517230},{"_id":"source/_data/musics.json","hash":"a7dcf7bfa28ad082c6fc158db71eb4022a92ef29","modified":1572023112000},{"_id":"source/archives/index.md","hash":"a62b7d9b8a8bdf966ec5c823e71581d2b185156e","modified":1571865416000},{"_id":"source/about/index.md","hash":"e4627b6dd3380d41e2905579077fb1ba931d0942","modified":1598717394006},{"_id":"source/categories/index.md","hash":"e9f60057d5e5b57b1845cbbac34087c668bec406","modified":1598460641582},{"_id":"source/_posts/.password","hash":"5b4b823069b81de657c8e62cd051158eb8973175","modified":1592838227000},{"_id":"source/_posts/ADB参考指令.md","hash":"e7a2993dcc8a7a54ff46f7ca014bf4111afab8e6","modified":1600698906157},{"_id":"source/_posts/BLOG双线部署-https.md","hash":"76ef8b438d0fdc97be82aad30ce6dbcfc57a6de9","modified":1592635591000},{"_id":"source/_posts/Bootstrap学习笔记.md","hash":"282730926cf0ea80a761b33a7124cfb03d1f9268","modified":1592635745000},{"_id":"source/_posts/Flutter学习记录.md","hash":"4fd817779ba4f4f264f561b3dfc0d5c3b04c3036","modified":1592635735000},{"_id":"source/_posts/Kali-Linux的学习和使用.md","hash":"18b29c7c3d015cd561f3bad7b9fadca388dea14f","modified":1592635726000},{"_id":"source/_posts/Linux操作系统学习笔记.md","hash":"b31ab9988babb489c7d14e6feecd0277c1e38e31","modified":1599312592221},{"_id":"source/_posts/Oneindex-YAAW增加后台离线上传.md","hash":"4016d331f5af04ce477c3faf0737c29ebc718522","modified":1593057920000},{"_id":"source/_posts/Oneindex自建不限速网盘.md","hash":"ece07245178442820b97b1fcc5e42022267ceaef","modified":1593057650000},{"_id":"source/_posts/PyTorch学习笔记.md","hash":"dfad95e577b4744913fddf35db12c0457d87b77d","modified":1592729526000},{"_id":"source/_posts/Pandas知识总结.md","hash":"c639322590611fb5510f4af031b68f9cf62a4ed7","modified":1602777714543},{"_id":"source/_posts/Python基础.md","hash":"9d4ce618f327626f072de101dcc62295efe4fcdc","modified":1595753635359},{"_id":"source/_posts/Python数据分析.md","hash":"05e93986cd4503334124aa54e6816c70f14a513d","modified":1602623640346},{"_id":"source/_posts/Rclone在win上挂在Onedrive.md","hash":"f4794a0289f61372e0b6245faffea2c3c9f02306","modified":1592837825000},{"_id":"source/_posts/SSR加速和降低服务器端口被封风险.md","hash":"08051332bcdcdca200e6fc11ae7bb2a9c0b07657","modified":1605430769616},{"_id":"source/_posts/SSR负载均衡实现自动切换端口.md","hash":"46382d24e22b7cde0e5589470ce96079863ee493","modified":1605430779216},{"_id":"source/_posts/Selenium常用操作记录.md","hash":"d0fad9e71cb69dfeca6c3bfc348ff62dfb69f734","modified":1600457423759},{"_id":"source/_posts/Squid-MySQL储存用户验证通过的IP.md","hash":"4b450e529404ce7ed0604e4cbb539b95002d7fb5","modified":1592635708000},{"_id":"source/_posts/ShopXO商城优化商品价格修改.md","hash":"9070c686e0e1d10e9296d185fd7910aef0e36a51","modified":1592635582000},{"_id":"source/_posts/Stunnel-squid代理加速亚琛教学视频加速.md","hash":"ae23fbfd0cae9fd95fed63da5a0bf945f188263c","modified":1591073236000},{"_id":"source/_posts/Valantis-ReadMore自动截取文章内容.md","hash":"6b91fe148fd2776ed16802b9e975851af74cc7c1","modified":1592467939000},{"_id":"source/_posts/TensorFlow学习笔记.md","hash":"8cd37f461937196d1dd59100683dafda821414e0","modified":1592480603000},{"_id":"source/_posts/git使用记录.md","hash":"b188dc1f1f6d2203b31ea93bfe02d9acb37e5a70","modified":1594488078272},{"_id":"source/_posts/Vue、Vuejs学习记录.md","hash":"078f5e230fdeb2f6fcbe169946273d1f2e443b9f","modified":1592635700000},{"_id":"source/_posts/httponly的Cookie.md","hash":"8772407e7d944d2cb426baac41bb43d8cdf7553b","modified":1595410499990},{"_id":"source/_posts/亚琛工大教学视频添加中德字幕.md","hash":"49573d8bb3b50cd6641012d89faa165a974d5474","modified":1592635659000},{"_id":"source/_posts/php和js中的JSON操作.md","hash":"6e0c4878b63c968202f43c3152b1d02c6d430af8","modified":1594965481473},{"_id":"source/_posts/使用JsDelivr给静态资源加速.md","hash":"97b66be18b103c6a5f42131d5c26cdd7d95b9376","modified":1594965800717},{"_id":"source/_posts/使用Magento创建电商网站记录.md","hash":"a7395b4fd6e845bd63a2f3cd4c60bce4f546c88d","modified":1592464932000},{"_id":"source/_posts/利用Stunnel+squid代理实现国内无客户端访问外网.md","hash":"c87e7a6a577dc40d9fd1e9ee36d040d5efccda5a","modified":1605430787964},{"_id":"source/_posts/利用树莓派定时抢图书馆座位.md","hash":"054271fd52b9d79579c6560bf992eb19e002c4a9","modified":1601276134473},{"_id":"source/_posts/利用树莓派-内网穿透搭建网站服务器.md","hash":"f0e826e5dc94ec371b23501c0f51ee7f52aecaec","modified":1599780674611},{"_id":"source/_posts/创建一个简单的API项目.md","hash":"b739cea76465df0c17014289981f9ff508440430","modified":1592635567000},{"_id":"source/_posts/利用海贝音乐做一个自用音乐播放器.md","hash":"f0ce8048aa7996aca62e254c409425283c7f0cd8","modified":1601497977008},{"_id":"source/_posts/在订单中打印收货地址二维码.md","hash":"d5b38b3ab00eff78f4ba7f67d6c78a47c4f7c8d7","modified":1598717127104},{"_id":"source/_posts/如何自己开发一个VPN程序.md","hash":"ae4df21593fced19a2cb03e731a88a3eb43987bd","modified":1592466775000},{"_id":"source/_posts/微信公众号开发.md","hash":"5dc3e81daa42303d7d1e5b5553aaa71fd08e550d","modified":1585755713000},{"_id":"source/_posts/微信小程序学习笔记.md","hash":"94fa049652266d40d91e7f5583c74c0e3ffdd242","modified":1592635668000},{"_id":"source/_posts/收集一些优秀的安卓开源库.md","hash":"03cc064acf629e3d8619449c09aa1228982d972f","modified":1592635678000},{"_id":"source/_posts/树莓派4B无网线无显示器出发.md","hash":"f8bce33cb9e769d4ef7dccba8b8d50c54dc1aa39","modified":1598648059259},{"_id":"source/_posts/机器学习深度学习-学习笔记.md","hash":"cd8f559f487a4e17e8fda47778e3ec76133e19ce","modified":1592728764000},{"_id":"source/_posts/正则表达式.md","hash":"4bab15a940b7a9cea1ef1f8729f1225830275022","modified":1601455569590},{"_id":"source/_posts/树莓派Chrome浏览器驱动webdriver.md","hash":"fba4b6ec1ce692297dc95b7d443314723fda1846","modified":1600718782640},{"_id":"source/_posts/爬虫基础.md","hash":"9d81984e3002b2f7eaa0fdfae833f0986899fb43","modified":1599570369418},{"_id":"source/_posts/移动运营商过滤外网流量问题.md","hash":"f5cc8992d62a4295ad1a765aa70c240cc87b4191","modified":1592635649000},{"_id":"source/_posts/计划为Hexo博客添加相册和Vlog页面.md","hash":"ca1af5f9edd368b4f41776a9b639f55c143aa4da","modified":1599570690619},{"_id":"source/_posts/自定义Volantis主题页脚.md","hash":"369d8077e823f9b5eb7e187762043f25f75ab87e","modified":1602353314628},{"_id":"source/_posts/计算机网络技术学习笔记.md","hash":"60840e4beca819db57296e5411ac39a31f789807","modified":1592635688000},{"_id":"source/_posts/订单卡片备注自动打印系统.md","hash":"72f547c52412a0853000f8570340a9c2a5513052","modified":1598452323863},{"_id":"source/_posts/记录一次在Linux上彻底卸载nginx.md","hash":"9a9e64ac21ccd9ede5f1b40f4df7c3bcd2c470fd","modified":1599768143439},{"_id":"source/_posts/部署Aria2-Rclone实现离线下载文件到Onedrive.md","hash":"30d42a90634206ed4f3f08cd3864de73b10d941c","modified":1593057446000},{"_id":"source/_posts/重温安卓编程.md","hash":"e15126fb7730697a474effa36c9e98fe83456ece","modified":1592635640000},{"_id":"source/contact/index.md","hash":"1b73066956ccc4340e0eba3a3a0b09d4c49e33d0","modified":1571942076000},{"_id":"source/friends/index-DESKTOP-N8PHHQN.md","hash":"eb5ba7d1e626d1b43d37aa4560588f14f8a00972","modified":1591369658929},{"_id":"source/friends/index.md","hash":"6154271c3e20f7d2f601346c28d1ccb98b545571","modified":1572113770000},{"_id":"source/tags/index.md","hash":"df418f6a4fe19d74f936bd4f598f68ccddd9b608","modified":1598460622630},{"_id":"themes/volantis/layout/_cover/blank.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1598457989119},{"_id":"themes/volantis/.gitignore","hash":"4b5e4eb66070da8433cd43d75af0de341e04a2ed","modified":1598457989107},{"_id":"themes/volantis/.npmignore","hash":"cc76f1920409c38e33ff5122852c44d380bf6e3d","modified":1598457989108},{"_id":"themes/volantis/LICENSE","hash":"e0cbf6906cab5926a34f17852db6c05187ee1f68","modified":1598457989108},{"_id":"themes/volantis/README.md","hash":"19f8ea12cf72971ec50a5019119a9479965ac478","modified":1598457989110},{"_id":"themes/volantis/_config.yml","hash":"06fa79d701394f79f60177be6a095fe837a5cba6","modified":1602773193218},{"_id":"themes/volantis/package.json","hash":"8d66211d98bdd90f892aae5ed8a409acacddef41","modified":1598457989185},{"_id":"themes/volantis/publish.sh","hash":"c54e1d31222885e89e803e2ab010ccdbff806217","modified":1598457989185},{"_id":"themes/volantis/.github/label-commenter-config.yml","hash":"8ccc1a5153d9343507b533df9afd7d063e7b5a2b","modified":1598457989104},{"_id":"themes/volantis/.github/config.yml","hash":"bffc5c3d4fb49467779092628519cfc456362a67","modified":1598457989103},{"_id":"themes/volantis/layout/404.ejs","hash":"f392f3fb08d8371ccf0d36aba1fc2b8c57d59daa","modified":1598457989118},{"_id":"themes/volantis/layout/_pre.ejs","hash":"19e3c81f4881e04f3f8717729baff8754abd5f90","modified":1598457989141},{"_id":"themes/volantis/layout/archive.ejs","hash":"619555b8e15045aa86a37927822c14c9160efe29","modified":1598457989178},{"_id":"themes/volantis/layout/artitalk.ejs","hash":"9a1052f464a6e39a73bbe28e423344a18bb1dc87","modified":1598457989179},{"_id":"themes/volantis/layout/category.ejs","hash":"79f6b30ca727d297cbe9e19615533ed40b4a7dfc","modified":1598457989179},{"_id":"themes/volantis/layout/docs.ejs","hash":"f0ba3f414b17a96a28ade8128d78707fd7bd36be","modified":1598457989180},{"_id":"themes/volantis/layout/friends.ejs","hash":"fe7c4419ba0f6129dae08e1cac54752fea946fe0","modified":1598457989181},{"_id":"themes/volantis/layout/index.ejs","hash":"015a5e90c9d3ded0a39bd41d348d9191459f0112","modified":1598457989181},{"_id":"themes/volantis/layout/layout.ejs","hash":"71564aeb7fe2e336056c7f83b458fd77ec36f329","modified":1598457989182},{"_id":"themes/volantis/layout/list.ejs","hash":"c83339caca29ad7c865dc0757476f78d43aeffd0","modified":1598457989182},{"_id":"themes/volantis/layout/page.ejs","hash":"f0ba3f414b17a96a28ade8128d78707fd7bd36be","modified":1598457989183},{"_id":"themes/volantis/layout/post.ejs","hash":"f0ba3f414b17a96a28ade8128d78707fd7bd36be","modified":1598457989183},{"_id":"themes/volantis/layout/tag.ejs","hash":"f4120e8356aff4822a7782b5f43d18c317be04a6","modified":1598457989184},{"_id":"themes/volantis/languages/en.yml","hash":"f12025c827cc255d30c9870d8b4e9146f9e5dba9","modified":1598457989112},{"_id":"themes/volantis/languages/zh-CN.yml","hash":"414c63c11323c856b8baf0c02c47860c645de71a","modified":1598457989113},{"_id":"themes/volantis/languages/zh-TW.yml","hash":"cd8aadeceae95f92232ad1fd670b89337ea30217","modified":1598457989113},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/en-1-help.md","hash":"24b65d924fd027472ca7cc804b1402fe0461e5a5","modified":1598457989100},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/en-5-feature-request.md","hash":"9fda3ef4af4000775b52bd5cfd8af939859c6920","modified":1598457989100},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/en-8-bug-report.md","hash":"4341a6b32bf2142c5d6a6a968643d4d254126be7","modified":1598457989101},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/en-9-other-issue.md","hash":"85eccd10f64d7bb085e4e755fb6a810250d57672","modified":1598457989101},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-1-help.md","hash":"9e5a0002833d177e1723d2c44379447c4f236516","modified":1598457989102},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-5-feature-request.md","hash":"1fe93da06bab44b0f1c484f6400dbc0ddc8f17a6","modified":1598457989102},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-8-bug-report.md","hash":"b593325023a3c864b4a0f1a1901e47ad5fa21620","modified":1598457989102},{"_id":"themes/volantis/.github/ISSUE_TEMPLATE/zh-cn-9-other-issue.md","hash":"e676078767d37cbb7d91e7a4a06053ed6d0c70b4","modified":1598457989103},{"_id":"themes/volantis/.github/workflows/auto-close-issues.yml","hash":"b3314545d69c397273c8aa5b9c6984018259ea60","modified":1598457989105},{"_id":"themes/volantis/.github/workflows/merge-conflicts.yml","hash":"cca34d26637c13a56def824f6869ec79a5777e5e","modified":1598457989106},{"_id":"themes/volantis/.github/workflows/label-commenter.yml","hash":"3ee1f3b8f92feb764e4c388f300c7d10e349c8f6","modified":1598457989105},{"_id":"themes/volantis/.github/workflows/npm-publish.yml","hash":"a24e8421622ebfa35203fb418a117041b4ba6a9a","modified":1598457989106},{"_id":"themes/volantis/.github/workflows/pr-updater.yml","hash":"54a47ca636d2304aa4d2466e020997cbdc5eef69","modified":1598457989107},{"_id":"themes/volantis/layout/_cover/dock.ejs","hash":"f580f4bd530b78c87439777eb35f2146a0a6f58f","modified":1598457989120},{"_id":"themes/volantis/layout/_cover/focus.ejs","hash":"f580f4bd530b78c87439777eb35f2146a0a6f58f","modified":1598457989122},{"_id":"themes/volantis/layout/_cover/featured.ejs","hash":"f580f4bd530b78c87439777eb35f2146a0a6f58f","modified":1598457989121},{"_id":"themes/volantis/layout/_cover/search.ejs","hash":"1577018a55b4cbacbb84af07cf29b158141ece27","modified":1598457989122},{"_id":"themes/volantis/layout/_meta/author.ejs","hash":"59c2fecba13b2528c6565dbe080d093af5e39b43","modified":1598457989123},{"_id":"themes/volantis/layout/_meta/category.ejs","hash":"037f6c3393f108e90d9fed4615a967b79916e82d","modified":1598457989124},{"_id":"themes/volantis/layout/_meta/counter.ejs","hash":"71d82208dbca502b71b5bf50fc02ca6dafc46864","modified":1598457989124},{"_id":"themes/volantis/layout/_meta/date.ejs","hash":"52765a7359fe63d7bf7651e4446f18bea86a0cd4","modified":1598457989125},{"_id":"themes/volantis/layout/_meta/music.ejs","hash":"7434c8262760b3680321309b062be82c3c52dab1","modified":1598457989125},{"_id":"themes/volantis/layout/_meta/share.ejs","hash":"19912556160cf300db737554d3481b1eef9ccf8d","modified":1598457989126},{"_id":"themes/volantis/layout/_meta/tags.ejs","hash":"ffaa30c9e4bc5b90a0e3f14de3959b11857c1068","modified":1598457989127},{"_id":"themes/volantis/layout/_meta/thumbnail.ejs","hash":"8afd94949e88f7c0373974234c6f80ed858705c7","modified":1598457989127},{"_id":"themes/volantis/layout/_meta/updated.ejs","hash":"7871f8cedfea2cf77f38676726e2e39d4662a7cd","modified":1598457989128},{"_id":"themes/volantis/layout/_meta/valinecount.ejs","hash":"024f8e45ff9130e4c5afdabddb765f28310ff6b7","modified":1598457989128},{"_id":"themes/volantis/layout/_meta/wordcount.ejs","hash":"eebaab3821af95ee64d8d56f33ca6c9c60b9b6f0","modified":1598457989129},{"_id":"themes/volantis/layout/_partial/archive.ejs","hash":"4c1aee843e8f7a327427c026ded94e197f96b77b","modified":1598457989130},{"_id":"themes/volantis/layout/_partial/article.ejs","hash":"e399d3c6e8b5d1c7918d09f1d534e21f41a67a45","modified":1598457989131},{"_id":"themes/volantis/layout/_partial/categories.ejs","hash":"7c7b6cc39e1aa8d01cc2e94d1195bb7620bb68ea","modified":1598457989131},{"_id":"themes/volantis/layout/_partial/cover.ejs","hash":"ebd76879e54c9d992f3320d6cdfc0382906a5894","modified":1598457989132},{"_id":"themes/volantis/layout/_partial/head.ejs","hash":"16970721d9379219168f520e1060a2fec22c7111","modified":1598457989133},{"_id":"themes/volantis/layout/_partial/footer.ejs","hash":"c6a6af627538903455dbc0613363e76e3c0326ac","modified":1598457989132},{"_id":"themes/volantis/layout/_partial/header.ejs","hash":"59e59174f0786fc56459c131bc5cc8fd0e295085","modified":1598457989134},{"_id":"themes/volantis/layout/_partial/post.ejs","hash":"9edac3808a6ea0a0412c4b02c384e8052d206085","modified":1598457989135},{"_id":"themes/volantis/layout/_partial/meta.ejs","hash":"19784b748f8ae5c553c54de3496c2a1de5f657ac","modified":1598457989134},{"_id":"themes/volantis/layout/_partial/rightmenu.ejs","hash":"c84e116fd83ca6a3f9c7fbec2501528cbc59681a","modified":1598457989136},{"_id":"themes/volantis/layout/_partial/side.ejs","hash":"8fcd8edfaa77a9f2b8ec93268c9448e515b46254","modified":1598457989141},{"_id":"themes/volantis/layout/_widget/_pre.ejs","hash":"eb2440e66fd08b914598453587100e586c1642d1","modified":1598457989167},{"_id":"themes/volantis/layout/_widget/blogger.ejs","hash":"3ea8024a4368ebe0d786833ec041898661b3c35b","modified":1598457989168},{"_id":"themes/volantis/layout/_widget/category.ejs","hash":"7295c87e3e095018d07af7941232b12970f0fcc5","modified":1598457989169},{"_id":"themes/volantis/layout/_widget/copyright.ejs","hash":"de6870c3cc658c054012c0c700d3e0342de99251","modified":1598457989169},{"_id":"themes/volantis/layout/_widget/grid.ejs","hash":"6ceb91ad7fecbfaf86342a99656767c76bca357d","modified":1598457989170},{"_id":"themes/volantis/layout/_widget/group.ejs","hash":"ae9811631165d22bae8c40c511c73bfda720420c","modified":1598457989170},{"_id":"themes/volantis/layout/_widget/header.ejs","hash":"b54a04af22efd55585af6e76ddbb7e856c5e9601","modified":1598457989171},{"_id":"themes/volantis/layout/_widget/list.ejs","hash":"eac7e6b422049eff92e2eaff892519c9058dc342","modified":1598457989172},{"_id":"themes/volantis/layout/_widget/load.ejs","hash":"c57c534a6e407bf78709f215ad792f6bd4beb7a8","modified":1598457989172},{"_id":"themes/volantis/layout/_widget/page.ejs","hash":"49ee453f2694a978dc159a39667e74d6b5b139e5","modified":1598457989173},{"_id":"themes/volantis/layout/_widget/music.ejs","hash":"a1e566b7d468fb28a2743adda7544c1ac0f0ca06","modified":1598457989173},{"_id":"themes/volantis/layout/_widget/qrcode.ejs","hash":"0209fc678cf2e7d0bf35be6a4b572598c150515d","modified":1598457989174},{"_id":"themes/volantis/layout/_widget/references.ejs","hash":"c4669e92b922516265bb68b1802d759cf0265fbf","modified":1598457989175},{"_id":"themes/volantis/layout/_widget/related_posts.ejs","hash":"92754a4f747299709cda4e32a1eecb6ec54265ef","modified":1598457989175},{"_id":"themes/volantis/layout/_widget/tagcloud.ejs","hash":"e58c16a7671a3575cfec7093a24267d97f84646f","modified":1598457989176},{"_id":"themes/volantis/layout/_widget/text.ejs","hash":"a6e2d9e52008b548e1863355d319504abb59fabb","modified":1598457989176},{"_id":"themes/volantis/layout/_widget/toc.ejs","hash":"4d16a09f52c019586320c04d49b257891142123d","modified":1598457989177},{"_id":"themes/volantis/layout/_widget/webinfo.ejs","hash":"804bfd82ee80c4ca1b660d75d2d269fdcca662a8","modified":1598457989178},{"_id":"themes/volantis/source/js/aplayer.js","hash":"e186f9a2a248e9e25b96089a5472532c19ac1b8f","modified":1598457989233},{"_id":"themes/volantis/source/css/style.styl","hash":"8032846ff8e9a26753d8c7ce33d8f8f52c520395","modified":1598457989232},{"_id":"themes/volantis/source/js/app.js","hash":"47983ec7d39fbbea82c4459ad47c39ed12ae44b3","modified":1598457989234},{"_id":"themes/volantis/scripts/events/index.js","hash":"a0f10031807f8c58c99085cfe95d850269ca709b","modified":1598457989187},{"_id":"themes/volantis/source/js/search.js","hash":"bd9f0ec09fb4b523aca45d3dd55a13d55a8e67fa","modified":1598457989235},{"_id":"themes/volantis/scripts/lazyload/index.js","hash":"58b935fb699a98f0a9ceb741d2105a977e24cf59","modified":1598457989188},{"_id":"themes/volantis/scripts/related_posts/index.js","hash":"8fb8973e37d7f7257afb8e82df2ef77a527b5bbf","modified":1598457989190},{"_id":"themes/volantis/scripts/tags/btn.js","hash":"0e628fa28e03f60e28f257af895b2e72a0cb8449","modified":1598457989191},{"_id":"themes/volantis/scripts/tags/btns.js","hash":"0d119e6a2f4a4a365090c569a4ff502db8f060e3","modified":1598457989192},{"_id":"themes/volantis/scripts/tags/checkbox.js","hash":"636cef0f4500a14b123c6b21187fb67989472cbd","modified":1598457989193},{"_id":"themes/volantis/scripts/tags/dropmenu.js","hash":"702005e9a8a9b42fabae9a020671134a336c3952","modified":1598457989193},{"_id":"themes/volantis/scripts/tags/fancybox.js","hash":"57f93baabda81366903bff4c189c489bec3fa97e","modified":1598457989194},{"_id":"themes/volantis/scripts/tags/folding.js","hash":"13cde292311a8d00f5d149a171f3d0f3251e20da","modified":1598457989194},{"_id":"themes/volantis/scripts/tags/ghcard.js","hash":"567c0ef4ad0ecc6a3597f68e2a1e10d82256f35e","modified":1598457989195},{"_id":"themes/volantis/scripts/tags/image.js","hash":"aec527fa94333b0bee0a78868b4bc02b0e15c1f4","modified":1598457989196},{"_id":"themes/volantis/scripts/tags/inline-labels.js","hash":"eaaedc3d65384e0beb4306534ef4ed202b46da18","modified":1598457989196},{"_id":"themes/volantis/scripts/tags/link.js","hash":"2ae15c5dc06feb14f4cedd96ee809a2ef276f063","modified":1598457989197},{"_id":"themes/volantis/scripts/tags/media.js","hash":"ebe4a6ebe34e8d77c0652c63bd5f763439743eb2","modified":1598457989197},{"_id":"themes/volantis/scripts/tags/note.js","hash":"cc8b525d2e2951a003bad69910fd1231f0a06ea6","modified":1598457989198},{"_id":"themes/volantis/scripts/tags/span.js","hash":"89aaa0678188aa85ec18116af4b036f80ca7c073","modified":1598457989199},{"_id":"themes/volantis/scripts/tags/site.js","hash":"51f4a8b26379ed54868a260cbf7129c9c3358fc3","modified":1598457989198},{"_id":"themes/volantis/scripts/tags/tabs.js","hash":"c59daf8a06e3a355663b89a7ab5445cdec5384fd","modified":1598457989199},{"_id":"themes/volantis/layout/_partial/scripts/counter.ejs","hash":"aeca5c6cd3906b846d73c811d974c9d1aecc6ef1","modified":1598457989137},{"_id":"themes/volantis/scripts/tags/timeline.js","hash":"fe253dd2ada60cec838bace5f07c4305773508f4","modified":1598457989200},{"_id":"themes/volantis/layout/_partial/scripts/darkmode.ejs","hash":"7cc27d0730c474a571da84c0deb3e823405835e9","modified":1598457989138},{"_id":"themes/volantis/layout/_partial/scripts/cover.ejs","hash":"df836a601c0ad095111956c36948b4d1cdce5076","modified":1598457989137},{"_id":"themes/volantis/layout/_partial/scripts/import.ejs","hash":"0a61a4d35ffdc4ee858e9c4199cc2fd0b1926025","modified":1598457989139},{"_id":"themes/volantis/layout/_partial/scripts/index.ejs","hash":"6ec55f4f46ef178f0d6b8bbf8d0fcf9f3c330929","modified":1598457989139},{"_id":"themes/volantis/layout/_partial/scripts/search.ejs","hash":"d1412907297397688edf607809a8874eb36e26b0","modified":1598457989140},{"_id":"themes/volantis/layout/_third-party/aplayer/layout.ejs","hash":"9b64c819cd0301def53d223c2f3bd89e4962fd79","modified":1598457989143},{"_id":"themes/volantis/layout/_third-party/clipboard/script.ejs","hash":"d63c7a63a7c5fdbd61d61327ad81e55fdf12976c","modified":1598457989144},{"_id":"themes/volantis/layout/_third-party/aplayer/script.ejs","hash":"4db591f6ba7cdcaac1d5603aef8051bf98f2537f","modified":1598457989143},{"_id":"themes/volantis/layout/_third-party/comments/index.ejs","hash":"03e55bce7b54c0a02729a48b9b2af6168b74865c","modified":1598457989150},{"_id":"themes/volantis/layout/_third-party/fancybox/script.ejs","hash":"ea6854134fa73f0d93f060f67cabd294b08abc23","modified":1598457989160},{"_id":"themes/volantis/layout/_third-party/lazyload/script.ejs","hash":"59a2957aca23c0cc4199aa30596423876891d2b9","modified":1598457989161},{"_id":"themes/volantis/layout/_third-party/pjax/animate.ejs","hash":"e8f1f218df15be8946d08ebb71bfbfc3773a4705","modified":1598457989163},{"_id":"themes/volantis/layout/_third-party/pjax/data.ejs","hash":"bfa0f0dc3312b482412cd19c16bcce7496ad026c","modified":1598457989164},{"_id":"themes/volantis/layout/_third-party/pjax/index.ejs","hash":"4777f7fbc488234830808111fec014cb5836f09b","modified":1598457989164},{"_id":"themes/volantis/layout/_third-party/scrollreveal/script.ejs","hash":"a7f780d70f7f959908adf298b28221541dc341c2","modified":1598457989165},{"_id":"themes/volantis/layout/_third-party/share/layout.ejs","hash":"aa714ba68918c2b9e74997161811ca35ff57da1c","modified":1598457989166},{"_id":"themes/volantis/source/css/_base/index.styl","hash":"960f0087c93828a59c076bf96953d544e1c0207b","modified":1598457989202},{"_id":"themes/volantis/source/css/_defines/color.styl","hash":"3cdea513216d0bae587374a6f1ea6b0b0c290f65","modified":1598457989203},{"_id":"themes/volantis/source/css/_defines/effect.styl","hash":"065bc72deaea55a248bd1e022d92252f456d7036","modified":1598457989203},{"_id":"themes/volantis/source/css/_defines/fonts.styl","hash":"3bd9b01721b73fe379b94c37c7cdd4b7da4790fe","modified":1598457989204},{"_id":"themes/volantis/source/css/_defines/layout.styl","hash":"03799fb740e64162fa125f128cb4c07552d40826","modified":1598457989205},{"_id":"themes/volantis/source/css/_defines/func.styl","hash":"1d40fb8d857059a8e073176ebc8d3a71140cd855","modified":1598457989205},{"_id":"themes/volantis/source/css/_layout/archive.styl","hash":"5487d761953fbb70d61f562d9bc4e998422d7786","modified":1598457989208},{"_id":"themes/volantis/source/css/_layout/article.styl","hash":"26c07ceeb9858be724cad5585594479da5318d85","modified":1598457989208},{"_id":"themes/volantis/source/css/_layout/cover.styl","hash":"8afcfaae78cb6e209e20f7220309324917953b0b","modified":1598457989209},{"_id":"themes/volantis/source/css/_layout/footer.styl","hash":"1ca7c8cb28cd09acbc5ddcc7d9abe22a059cbb2d","modified":1598457989210},{"_id":"themes/volantis/source/css/_layout/friends.styl","hash":"4d555d87f888dec5a19b42599a02dfc924766566","modified":1598457989210},{"_id":"themes/volantis/source/css/_layout/main.styl","hash":"988f97613d815f0dc125864677ea06448f05bb47","modified":1598457989211},{"_id":"themes/volantis/source/css/_layout/navbar.styl","hash":"17f3b553cdb5b0887ac548203c65c6dc68dcbae9","modified":1598457989212},{"_id":"themes/volantis/source/css/_layout/pagination.styl","hash":"c8182b152c0276b0829dc3b88c1021caa874d055","modified":1598457989213},{"_id":"themes/volantis/source/css/_layout/posts.styl","hash":"f2a8a7d9b850e4d58bd13f9bb39ff1da8e560e97","modified":1598457989213},{"_id":"themes/volantis/source/css/_layout/sidebar.styl","hash":"3b3470337d9949280a75844c68e628fd17d1eea5","modified":1598457989215},{"_id":"themes/volantis/source/css/_layout/search.styl","hash":"3d99fa8ae385f34a8e55d2ba40153283e291e967","modified":1598457989214},{"_id":"themes/volantis/source/css/_layout/toc.styl","hash":"7f69fb0a3adeb472d063647c408d76fe7ad35368","modified":1598457989215},{"_id":"themes/volantis/source/css/_highlight/index.styl","hash":"9cc7d5d1797a972354401dc3678beff7d873251d","modified":1598457989206},{"_id":"themes/volantis/source/css/_plugins/aplayer.styl","hash":"b16c177861756d8874f40868fd70533a291f09f3","modified":1598457989216},{"_id":"themes/volantis/source/css/_plugins/clipboard.styl","hash":"6c13f52596a79874f95adbf78276c28cfd6f12ec","modified":1598457989217},{"_id":"themes/volantis/source/css/_plugins/cursor.styl","hash":"86944f64bbe38ec73bf84a78d23d8b52acce4a8c","modified":1598457989218},{"_id":"themes/volantis/source/css/_plugins/darkmode.styl","hash":"455c31d90632d68eddf9428b95ae1ec7584e4025","modified":1598457989218},{"_id":"themes/volantis/source/css/_plugins/fancybox.styl","hash":"ebe86bd5ac6b9de64d0582fc303a850b19474d44","modified":1598457989219},{"_id":"themes/volantis/source/css/_plugins/gitalk.styl","hash":"17938fd65f7996c71e382934553af9fdee6a0e18","modified":1598457989220},{"_id":"themes/volantis/source/css/_plugins/index.styl","hash":"c44c2790449763adae6c9fc06b5af08cca6e0d5a","modified":1598457989220},{"_id":"themes/volantis/source/css/_plugins/mathjax.styl","hash":"95b0c51b678bc3ecc607bcf52d97b9634931ccba","modified":1598457989221},{"_id":"themes/volantis/source/css/_plugins/pjaxanimate.styl","hash":"9664f37f2632e17c2d6bd93eb587d4df9aefa265","modified":1598457989222},{"_id":"themes/volantis/source/css/_plugins/rightmenu.styl","hash":"30970b02eb48326a0e62a7787f3d3445400f41ee","modified":1598457989222},{"_id":"themes/volantis/source/css/_plugins/valine.styl","hash":"98eebc5a83e7d028ffe4980ae61518a6b2734cea","modified":1598457989223},{"_id":"themes/volantis/source/css/_tag-plugins/btns.styl","hash":"525919d04929c2c849f3aae587ecc6a004b05e86","modified":1598457989224},{"_id":"themes/volantis/source/css/_tag-plugins/checkbox.styl","hash":"917dc0635bca4d466bc5f228e4bd278b900cb7d0","modified":1598457989225},{"_id":"themes/volantis/source/css/_tag-plugins/dropmenu.styl","hash":"469d3458db6531b1283768bbae30f283110d1726","modified":1598457989225},{"_id":"themes/volantis/source/css/_tag-plugins/folding.styl","hash":"ae02ec2e1be3d58a59b9092cbef941a24bd20ed4","modified":1598457989226},{"_id":"themes/volantis/source/css/_tag-plugins/ghcard.styl","hash":"1f2585e9ed92674d51bde2355bc44f2f0b0094ac","modified":1598457989226},{"_id":"themes/volantis/source/css/_tag-plugins/image.styl","hash":"842f58a4c464d5ec59038cc923dbce1dd432362b","modified":1598457989227},{"_id":"themes/volantis/source/css/_tag-plugins/link.styl","hash":"8201625c097b50cd9b28f57e5e1c9703a0fcf538","modified":1598457989227},{"_id":"themes/volantis/source/css/_tag-plugins/media.styl","hash":"de97807507e324554608c890c7fb54aecfbffd7e","modified":1598457989228},{"_id":"themes/volantis/source/css/_tag-plugins/note.styl","hash":"985e770d197153ca92659fd98ae61f8523802753","modified":1598457989229},{"_id":"themes/volantis/source/css/_tag-plugins/site-card.styl","hash":"89a0d9be3b52c52f2aaaeffb52e8365f09056f23","modified":1598457989229},{"_id":"themes/volantis/source/css/_tag-plugins/span.styl","hash":"93377dc51a236914a735e372e533594ade9f4df0","modified":1598457989230},{"_id":"themes/volantis/source/css/_tag-plugins/tabs.styl","hash":"3702755ed2c245d689f231be96f14470d04e958a","modified":1598457989231},{"_id":"themes/volantis/source/css/_tag-plugins/timeline.styl","hash":"83cb474cc9fe3500b82586ec5dc426a3bba895e2","modified":1598457989231},{"_id":"themes/volantis/scripts/events/lib/config.js","hash":"913154f487b0e49c5a7fb0f462ec7fa4c90e87cb","modified":1598457989188},{"_id":"themes/volantis/scripts/lazyload/lib/process.js","hash":"c290400a5b35db91ad3060266afb811f8691141d","modified":1598457989189},{"_id":"themes/volantis/layout/_third-party/comments/disqus/layout.ejs","hash":"33f5624ef44627a1b87a0826a5e28d5417a0d7a4","modified":1598457989146},{"_id":"themes/volantis/layout/_third-party/comments/disqus/script.ejs","hash":"762f73e793a4026a92589847d20fbd69eb39c2b4","modified":1598457989146},{"_id":"themes/volantis/layout/_third-party/comments/gitalk/layout.ejs","hash":"9b3789aa0fc94ca455661b3fb67480eda9f04d06","modified":1598457989147},{"_id":"themes/volantis/layout/_third-party/comments/gitalk/script.ejs","hash":"daaf20e2cca9faf55373ddc69b54af1ef46e5c04","modified":1598457989148},{"_id":"themes/volantis/layout/_third-party/comments/hashover/layout.ejs","hash":"8a2b27c6fb85afb903cce69edf7e473305dec9f0","modified":1598457989149},{"_id":"themes/volantis/layout/_third-party/comments/hashover/script.ejs","hash":"6ead033be7b3886c46925262cff87d4d56bb8008","modified":1598457989150},{"_id":"themes/volantis/layout/_third-party/comments/isso/layout.ejs","hash":"8d893ef2921e2ba8ed25a349145dcf1f725f7623","modified":1598457989151},{"_id":"themes/volantis/layout/_third-party/comments/isso/script.ejs","hash":"9f26d9a503ce7ca96dd761a871547da3a430ac0c","modified":1598457989152},{"_id":"themes/volantis/layout/_third-party/comments/livere/layout.ejs","hash":"0aa83bcb7be0fc37f8e743371787ab6f81716149","modified":1598457989153},{"_id":"themes/volantis/layout/_third-party/comments/livere/script.ejs","hash":"f32e2157c5858ae89d1392334d90c119aa33837d","modified":1598457989153},{"_id":"themes/volantis/layout/_third-party/comments/minivaline/layout.ejs","hash":"9ecc6a0f61c3a1ab39d6d9bff0f1a7b4fd83046a","modified":1598457989154},{"_id":"themes/volantis/layout/_third-party/comments/minivaline/script.ejs","hash":"bed9a5281f45db476e58d3b3cdd4041b08575ae3","modified":1598457989155},{"_id":"themes/volantis/layout/_third-party/comments/valine/layout.ejs","hash":"0e8ba274feed22e672955c6f768f2b55ba330a4c","modified":1598457989156},{"_id":"themes/volantis/layout/_third-party/comments/valine/script.ejs","hash":"8ba4a63fa08b654db6c4d8434e25aec2c0fb198f","modified":1598457989157},{"_id":"themes/volantis/layout/_third-party/comments/vssue/layout.ejs","hash":"14dd5a9f1e74d3955a161208464281af67ed761f","modified":1598457989158},{"_id":"themes/volantis/layout/_third-party/comments/vssue/script.ejs","hash":"cda36871397adf18a11c8d87e744d50b50378bc8","modified":1598457989159},{"_id":"themes/volantis/layout/_third-party/math/mathjax/script.ejs","hash":"84a37ec604d16df3b9828e6938128213da6f5fb0","modified":1598457989162},{"_id":"themes/volantis/source/js/valine.js","hash":"8d9fea2d670fa9250f946edea212bf1e2315efba","modified":1598457989238},{"_id":"public/baidu_urls.txt","hash":"0b8a46f5a63dd921399d61adfdb0827c490c6ecd","modified":1612620045968},{"_id":"public/search.xml","hash":"820fb2404f0371880a683cd85bf6cd1311641841","modified":1612620045968},{"_id":"public/content.json","hash":"6285a3279a2a94ee363b635c460bdfeadbfbef42","modified":1612620045968},{"_id":"public/archives/index.html","hash":"f6846dc3d49cda95e191869ea9b53b21c14cdefb","modified":1612620045968},{"_id":"public/categories/index.html","hash":"2677f8c58eb778d0b19e2a9ce27b04f9bb17e06d","modified":1612620045968},{"_id":"public/about/index.html","hash":"8bd550ffcbe91f3d8f005bacad4db1b8c01503bb","modified":1602773205256},{"_id":"public/contact/index.html","hash":"a67ca980fe8b05e19bc194af23506fb4525f7646","modified":1602773205256},{"_id":"public/friends/index-DESKTOP-N8PHHQN.html","hash":"7d012f8e901b91f2954a72fb417a51e24865e7d9","modified":1602773205256},{"_id":"public/friends/index.html","hash":"5a3ae08d2d7aab38612a33d56c0b7efe723f6b2e","modified":1602773205256},{"_id":"public/tags/index.html","hash":"34da1eae2a80cb7792c8b67c2d4c14593d4f95ec","modified":1612620045968},{"_id":"public/2020/10/14/Pandas知识总结/index.html","hash":"25ac3b2e311cb0da22530c4cc8473e69e1cc5ba8","modified":1603064327138},{"_id":"public/2020/10/10/自定义Volantis主题页脚/index.html","hash":"ce9e8716d8b322068395b05907a71d6bdf2daeb0","modified":1602773205256},{"_id":"public/2020/09/30/正则表达式/index.html","hash":"eab1229b6f1086181a1164e311636df6005cc406","modified":1602773205256},{"_id":"public/2020/09/29/Python数据分析/index.html","hash":"b549776932b2efdb9cf6f3aba093b098d18581a2","modified":1602773205256},{"_id":"public/2020/09/27/利用树莓派定时抢图书馆座位/index.html","hash":"7d5237516fc3ddcbbe3840c959b5361ee2584137","modified":1605442302497},{"_id":"public/2020/09/21/树莓派Chrome浏览器驱动webdriver/index.html","hash":"f091d1b4bbc84a7a984feca686c9ad210292dc82","modified":1602773205256},{"_id":"public/2020/09/21/ADB参考指令/index.html","hash":"313ab4f358043166d8fcb3116db19b5af1343402","modified":1603564172137},{"_id":"public/2020/09/18/Selenium常用操作记录/index.html","hash":"97f2233806c289b3225877c25437e7e86ccea59e","modified":1602773205256},{"_id":"public/2020/09/10/利用树莓派-内网穿透搭建网站服务器/index.html","hash":"fdd40695fbaa475e4b269f78333193cacffab088","modified":1602773205256},{"_id":"public/2020/09/10/记录一次在Linux上彻底卸载nginx/index.html","hash":"f9f66c56edc028d1a766ee2ad0a27b3408928b86","modified":1605442302497},{"_id":"public/2020/09/08/计划为Hexo博客添加相册和Vlog页面/index.html","hash":"c02d9e139a759eb08d580fdc7f9bf56a47619689","modified":1602773205256},{"_id":"public/2020/09/06/利用海贝音乐做一个自用音乐播放器/index.html","hash":"6c93400da070f32546194f18ce1946d06834c433","modified":1602773205256},{"_id":"public/2020/08/28/树莓派4B无网线无显示器出发/index.html","hash":"df69de921c955c115966ecc43e6f4129c0117830","modified":1602773205256},{"_id":"public/2020/08/28/在订单中打印收货地址二维码/index.html","hash":"ae368603bf740a7a00a168577d1fd72e9973359d","modified":1602773205256},{"_id":"public/2020/08/26/订单卡片备注自动打印系统/index.html","hash":"fb83a1d623a27757d2a0701b826e701ee57fd6c0","modified":1602773205256},{"_id":"public/2020/07/26/爬虫基础/index.html","hash":"93167a6b98c51143e8bff55e58e4723dcf9c2478","modified":1612620045968},{"_id":"public/2020/07/22/httponly的Cookie/index.html","hash":"c3f40a4c78a6ac3067c7b1526452f90e53a6040f","modified":1602773205256},{"_id":"public/2020/07/22/Python基础/index.html","hash":"d94e03fa9d8e8ac849544c12a861bdcea074ffad","modified":1612620045968},{"_id":"public/2020/07/17/php和js中的JSON操作/index.html","hash":"f2a3e4ba6738b0d9da3d09556ff2884511b3b433","modified":1602773205256},{"_id":"public/2020/07/12/git使用记录/index.html","hash":"a2e5d8172cca547aaa1883c1dedc3f73b3c213c4","modified":1602773205256},{"_id":"public/2020/07/11/使用JsDelivr给静态资源加速/index.html","hash":"5f345f9360db4d10ece2c7572bbd401c9d0e8f2b","modified":1602773205256},{"_id":"public/2020/06/25/Oneindex-YAAW增加后台离线上传/index.html","hash":"1ca6a27a81b45abcc936e7e3be86db0cc4566ef8","modified":1602773205256},{"_id":"public/2020/06/25/部署Aria2-Rclone实现离线下载文件到Onedrive/index.html","hash":"5fca077af5b97cd53cb531d7b5a171c885040917","modified":1605442302497},{"_id":"public/2020/06/22/Rclone在win上挂在Onedrive/index.html","hash":"082194b60e73fea3d0c61e9b15b7fd4545fcfd6e","modified":1602773205256},{"_id":"public/2020/06/22/Oneindex自建不限速网盘/index.html","hash":"03de5353f418ab652871c0fdf9bfab91479d8bf5","modified":1602773205256},{"_id":"public/2020/06/18/Valantis-ReadMore自动截取文章内容/index.html","hash":"0cea2e28da19f014e68ecb3d111a95aee13abe4c","modified":1602773205256},{"_id":"public/2020/06/17/TensorFlow学习笔记/index.html","hash":"250ee15e371b8514a854b0a006936b91dc420665","modified":1602773205256},{"_id":"public/2020/06/16/PyTorch学习笔记/index.html","hash":"9a4c92fc79452661014f9df17014b628f3626946","modified":1602773205256},{"_id":"public/2020/06/16/SSR负载均衡实现自动切换端口/index.html","hash":"ca48e54ac50e7cb8670183f76df2db8e48b2c34b","modified":1605442302497},{"_id":"public/2020/06/14/BLOG双线部署-https/index.html","hash":"bc544679ea336ec3dedf339458b0540ac0eb88c9","modified":1602773205256},{"_id":"public/2020/06/14/移动运营商过滤外网流量问题/index.html","hash":"e074818dc4d26124f00236b628775db143eca836","modified":1602773205256},{"_id":"public/2020/06/08/SSR加速和降低服务器端口被封风险/index.html","hash":"3216ae2956e84c46f1b05d52b75950624405770e","modified":1605442302497},{"_id":"public/2020/06/02/Squid-MySQL储存用户验证通过的IP/index.html","hash":"d44692d85e28aab52e665cee18dc7d4b39a3419f","modified":1602773205256},{"_id":"public/2020/05/28/Stunnel-squid代理加速亚琛教学视频加速/index.html","hash":"a73f182f31a4e5780d4f749c2525c4d932e7df3f","modified":1602773205256},{"_id":"public/2020/05/28/利用Stunnel+squid代理实现国内无客户端访问外网/index.html","hash":"7cca5c3b15f91c1712429e43b5bf155ecc064f77","modified":1605442302497},{"_id":"public/2020/05/27/亚琛工大教学视频添加中德字幕/index.html","hash":"9377df9b50a55398583c5c13d7dd5852bbf3d3c2","modified":1602773205256},{"_id":"public/2020/05/26/ShopXO商城优化商品价格修改/index.html","hash":"b37bab00284592bdc021a9c4cae723428c3b0ce5","modified":1602773205256},{"_id":"public/2020/05/21/机器学习深度学习-学习笔记/index.html","hash":"20db729b02b31b95e98ce175ac5ce542ad65426b","modified":1602773205256},{"_id":"public/2020/04/26/计算机网络技术学习笔记/index.html","hash":"50ff568c472f968ecdc1b9b0df08490fbdd31422","modified":1602773205256},{"_id":"public/2020/04/07/微信小程序学习笔记/index.html","hash":"faea3c16294797c69d49190c76f1693a307686b1","modified":1602773205256},{"_id":"public/2020/04/01/微信公众号开发/index.html","hash":"a2fe19b38f3c6c7fa5880baa810e6c08a07c1c38","modified":1602773205256},{"_id":"public/2020/03/01/Bootstrap学习笔记/index.html","hash":"59c30daf0682238f210697b24a58f9bc53ffbc38","modified":1602773205256},{"_id":"public/2020/02/20/Linux操作系统学习笔记/index.html","hash":"37b57e922ad1b465a5db2067858eff166eaeb88e","modified":1602773205256},{"_id":"public/2020/02/19/Kali-Linux的学习和使用/index.html","hash":"96805e07e7f81ef79554045a4bbcbd85ab94c34c","modified":1602773205256},{"_id":"public/2020/02/15/Flutter学习记录/index.html","hash":"d96e5f38918d7dac73b21e227fd01e340b38daba","modified":1602773205256},{"_id":"public/2020/02/15/Vue、Vuejs学习记录/index.html","hash":"3408eab378ce2a798b922dd16ff4b1c45a92d56e","modified":1602773205256},{"_id":"public/2020/02/01/收集一些优秀的安卓开源库/index.html","hash":"60a57b5aec9589609b94a285fba1ae7fada2cea4","modified":1602773205256},{"_id":"public/2020/01/26/创建一个简单的API项目/index.html","hash":"0f4887a4cf3ae53fe2e7c5b020122a056e18452f","modified":1602773205256},{"_id":"public/2020/01/24/使用Magento创建电商网站记录/index.html","hash":"e2e7f56177172228b71645a30ea0f69865ea36e6","modified":1602773205256},{"_id":"public/2019/12/12/如何自己开发一个VPN程序/index.html","hash":"9299a4069c10dc5b8ac08321285f1d682c42fa39","modified":1602773205256},{"_id":"public/2019/11/18/重温安卓编程/index.html","hash":"a33d8fd69b2c277ff023122826b399f53f43fb64","modified":1602773205256},{"_id":"public/categories/安卓编程/index.html","hash":"88b77628986bf2af92bac622f68aa3829c93add2","modified":1612620045968},{"_id":"public/categories/网站编程/index.html","hash":"0f1024c2b728374114788a5e042ac5a9034333e5","modified":1612620045968},{"_id":"public/categories/网站编程/page/2/index.html","hash":"75c602e81d9d1e227cd62c212787c43b858390e9","modified":1612620045968},{"_id":"public/categories/学习笔记/index.html","hash":"f976f4f738d7fd9bf9869ece685d37beb847dc57","modified":1612620045968},{"_id":"public/categories/学习笔记/page/2/index.html","hash":"0919fee819b4ad189ca2df532f5093ae24e31cb8","modified":1612620045968},{"_id":"public/categories/Python/index.html","hash":"7826cd1057f564ad90ca46f1c10f98c7bc7f468f","modified":1612620045968},{"_id":"public/categories/Windows/index.html","hash":"b601e0df0b6865a4a450b92e7da17731f1d4702b","modified":1612620045968},{"_id":"public/categories/Linux编程/index.html","hash":"9d4e0ee666f36393cc45cfa41132677e91506f51","modified":1605390760934},{"_id":"public/categories/其他/index.html","hash":"0d18a20d9fcbad3eff566c4ff1660a03ff155bb3","modified":1612620045968},{"_id":"public/categories/Linux/index.html","hash":"f4e7c7decec10d973e5fd2c0076d43c5a7a733e6","modified":1612620045968},{"_id":"public/categories/树莓派/index.html","hash":"2b5759c18a90499c2e18954cc5f1a36eb5b3d609","modified":1612620045968},{"_id":"public/archives/page/2/index.html","hash":"f6846dc3d49cda95e191869ea9b53b21c14cdefb","modified":1612620045968},{"_id":"public/archives/page/3/index.html","hash":"f6846dc3d49cda95e191869ea9b53b21c14cdefb","modified":1612620045968},{"_id":"public/archives/page/4/index.html","hash":"f6846dc3d49cda95e191869ea9b53b21c14cdefb","modified":1612620045968},{"_id":"public/archives/page/5/index.html","hash":"f6846dc3d49cda95e191869ea9b53b21c14cdefb","modified":1612620045968},{"_id":"public/archives/page/6/index.html","hash":"f6846dc3d49cda95e191869ea9b53b21c14cdefb","modified":1612620045968},{"_id":"public/archives/2019/index.html","hash":"25d295764a697b028e4e48b4b8f20dc4f4cbf41a","modified":1612620045968},{"_id":"public/archives/2019/11/index.html","hash":"d3980b529cd8b941d65e5ad2e02abb17582b39f3","modified":1612620045968},{"_id":"public/archives/2019/12/index.html","hash":"e812083ac8cd2a010344b4a880b6b66fb7d41e2b","modified":1612620045968},{"_id":"public/archives/2020/index.html","hash":"1a18f54d7408279cf81d8180f5f72d962dc5e5ca","modified":1612620045968},{"_id":"public/archives/2020/page/2/index.html","hash":"ac51b12546a59d88312b69bf2550a686b9f5c221","modified":1612620045968},{"_id":"public/archives/2020/page/3/index.html","hash":"a815610281a680d51f282b9f395a16f28d7cd07e","modified":1612620045968},{"_id":"public/archives/2020/page/4/index.html","hash":"75736c70cac0a1a6c9d0cb588e9bd21ae5ea2403","modified":1612620045968},{"_id":"public/archives/2020/page/5/index.html","hash":"0d88f9373a0f5340e1cd27412517b997f7391efb","modified":1612620045968},{"_id":"public/archives/2020/01/index.html","hash":"d22eeb41780db9dce7383c84dea5b14b4e44dacd","modified":1612620045968},{"_id":"public/archives/2020/02/index.html","hash":"6af9b1c369494e35995d526b4bae842bf4f00bca","modified":1612620045968},{"_id":"public/archives/2020/03/index.html","hash":"6bf660469eb217dd135bc8c209955c0cd25d09b8","modified":1612620045968},{"_id":"public/archives/2020/04/index.html","hash":"db2e9314aaddd572d617a638f83b54e69533a424","modified":1612620045968},{"_id":"public/archives/2020/05/index.html","hash":"a0e112fb7332381aa0c515363eb40ec65f83baba","modified":1612620045968},{"_id":"public/archives/2020/06/index.html","hash":"6311f5318338b884ac367274624ed4f340a4e576","modified":1612620045968},{"_id":"public/archives/2020/06/page/2/index.html","hash":"a182ca37f476553013a1f444185d35730e0d7f4e","modified":1612620045968},{"_id":"public/archives/2020/07/index.html","hash":"dba93dd0897e1cdc9f75243367b53f57a0940e0e","modified":1612620045968},{"_id":"public/archives/2020/08/index.html","hash":"98c5a525009ad3d8340f7211be39e8b471267d91","modified":1612620045968},{"_id":"public/archives/2020/09/index.html","hash":"6f7a435457d6a41997c9244021e2e556259332a4","modified":1612620045968},{"_id":"public/archives/2020/10/index.html","hash":"14bca0ae3ac782aa218c74f27b5cc7c40f0a60f4","modified":1612620045968},{"_id":"public/index.html","hash":"34d6cb18b478aa3fff08be0542dd584c92fdc7de","modified":1612620045968},{"_id":"public/page/2/index.html","hash":"e4755a86481f3b8d644a088abdc9e0e96e279750","modified":1612620045968},{"_id":"public/page/3/index.html","hash":"c2d154e0974efbbf0b887826f4b55b97cf0831a9","modified":1612620045968},{"_id":"public/page/4/index.html","hash":"2b5252a292500b8e66bf2bc20e13aa826de48333","modified":1612620045968},{"_id":"public/page/6/index.html","hash":"93689f23024c5ab1102756a0429b43791a767c1e","modified":1612620045968},{"_id":"public/page/5/index.html","hash":"7c6443378cbe9dfbaafd36c26124e6bdd28619ba","modified":1612620045968},{"_id":"public/tags/ADB/index.html","hash":"064779330f5be39d39425996cff89b64cbc6a4ba","modified":1612620045968},{"_id":"public/tags/网站优化/index.html","hash":"7bd0baed4b90adbef97541975509e44c33e777ba","modified":1612620045968},{"_id":"public/tags/Bootstrap/index.html","hash":"f79209c53a55f3e9d469602e25774e90d9b6f94e","modified":1612620045968},{"_id":"public/tags/Flutter/index.html","hash":"90106264614997a381d47176284222c327be2283","modified":1612620045968},{"_id":"public/tags/Kali-Linux/index.html","hash":"9ba2d2ffa95a0d59ccf9b30c9df9f72731c60d52","modified":1612620045968},{"_id":"public/tags/Linux/index.html","hash":"87165bde7837309e8f0ed1056ffc7886dee1fc6c","modified":1612620045968},{"_id":"public/tags/YAAW/index.html","hash":"615f10644d12d334176852ea8d807ea0573e5e04","modified":1612620045968},{"_id":"public/tags/Oneindex/index.html","hash":"d7e91381172431e4b97aa35bf439d8fcdd502eda","modified":1612620045968},{"_id":"public/tags/深度学习/index.html","hash":"c78f060652cab797b910b4c8d3db12671dfca9e7","modified":1612620045968},{"_id":"public/tags/PyTorch/index.html","hash":"2675e7cf43ec4680f677c3fda1fc5711b59c15fa","modified":1612620045968},{"_id":"public/tags/Pandas/index.html","hash":"416a03b2d389c13c368fa6700d4ecb25a74d6083","modified":1612620045968},{"_id":"public/tags/数据处理/index.html","hash":"7c429b0d0a497387a2c90c356e686ea8f1f33b40","modified":1612620045968},{"_id":"public/tags/Python/index.html","hash":"d6738189e45368a09e37be6ed554e3318f3b5a4b","modified":1612620045968},{"_id":"public/tags/Matplotlib/index.html","hash":"e3ec9dfaf56585cabe20316b97af48fef6f8d34b","modified":1612620045968},{"_id":"public/tags/Rclone/index.html","hash":"a10d8d653ee4d5237960ecb66bbb05fad37e3220","modified":1612620045968},{"_id":"public/tags/Numpy/index.html","hash":"b635a182ee3c25374c9f703d858f8f6cbf5f8b99","modified":1612620045968},{"_id":"public/tags/SSR/index.html","hash":"a9a38a9978c4096b8303e4e8a39ec14789839ab0","modified":1612620045968},{"_id":"public/tags/Stunnel/index.html","hash":"4ff525efdb80deab43a8b0e075b93086bfd86f6c","modified":1612620045968},{"_id":"public/tags/haproxy/index.html","hash":"31ff2b70451117be2115fde160316c5dab58eae1","modified":1612620045968},{"_id":"public/tags/ShopXO/index.html","hash":"cd38c9afdacdd5eeea78060171da8738f416a6da","modified":1612620045968},{"_id":"public/tags/负载均衡/index.html","hash":"70de22d065ccf248002d79b6b18e291122b26303","modified":1612620045968},{"_id":"public/tags/Squid/index.html","hash":"529c840446093f8a0f62aae5848ecc23f97171ad","modified":1612620045968},{"_id":"public/tags/Mysql/index.html","hash":"361dff94e532d5c89449d96db1a41eb1ed4545ea","modified":1612620045968},{"_id":"public/tags/Volantis/index.html","hash":"ffa79d0b112fcb0f7e4ea3c0dcd3e75212658e8d","modified":1612620045968},{"_id":"public/tags/TensorFlow/index.html","hash":"4e36fd2d540274b70c355f61126e34db216d1ea1","modified":1612620045968},{"_id":"public/tags/Git/index.html","hash":"6350680a6ac0e676a2fe0b4ee78a721e2de5b3c1","modified":1612620045968},{"_id":"public/tags/Cookie/index.html","hash":"e2d69c977ab066f1e5f166007d7aef16cb942066","modified":1612620045968},{"_id":"public/tags/浏览器插件/index.html","hash":"496828ceae8192416f1e7ab77567c1b13f0c49f1","modified":1612620045968},{"_id":"public/tags/JSON/index.html","hash":"df6572cf6ba808b74cd6ea9f87ef07214201e7d3","modified":1612620045968},{"_id":"public/tags/JsDelivr/index.html","hash":"82de519980d03195939b486b77d49c2e37132619","modified":1612620045968},{"_id":"public/tags/Magento/index.html","hash":"1b4e785ae97a2b1126bc0568139ce724725c8451","modified":1612620045968},{"_id":"public/tags/树莓派/index.html","hash":"a03913340aac58fbf068a71416b4708d09b791ab","modified":1612620045968},{"_id":"public/tags/API/index.html","hash":"098c243021a731b93a956aca5fb3a781a9d3b31c","modified":1612620045968},{"_id":"public/tags/音乐播放器/index.html","hash":"3e3330c953153084556ed7f8dc7867d5f92fdd62","modified":1612620045968},{"_id":"public/tags/电商/index.html","hash":"acc28d664b05b3489cac20e092022e4c10679da2","modified":1612620045968},{"_id":"public/tags/VPN/index.html","hash":"f6f513428a377bf7a1a3010a5ef991aa748d41b8","modified":1612620045968},{"_id":"public/tags/微信公众号/index.html","hash":"d2d2509a9a0003d308dedfee4bdd02375127599f","modified":1612620045968},{"_id":"public/tags/微信小程序/index.html","hash":"abd658f509503271fc583cfd2253ec4648e3c3c0","modified":1612620045968},{"_id":"public/tags/安卓开源库/index.html","hash":"fa6671035297035bec15fec346dfc2520ab13700","modified":1612620045968},{"_id":"public/tags/机器学习/index.html","hash":"27a3691cbba1776aba0c9057e7be76df6278a090","modified":1612620045968},{"_id":"public/tags/正则表达式/index.html","hash":"393f56e0b16815fb80829e67fb7fa2dd18a21691","modified":1612620045968},{"_id":"public/tags/Selenium/index.html","hash":"7e4c4f7bdda1776210a01ee6999f40049915850c","modified":1612620045968},{"_id":"public/tags/爬虫/index.html","hash":"d7f5213b63cf7131c39e5e5dcfba6570d3b9e535","modified":1612620045968},{"_id":"public/tags/移动网络/index.html","hash":"349f714ed1bdb443278a37a9a6ed4c8423eb5d52","modified":1612620045968},{"_id":"public/tags/博客/index.html","hash":"2d21a47324be4fa7bbaee1978d66f5485d034bcb","modified":1612620045968},{"_id":"public/tags/Hexo/index.html","hash":"9ca9cee6db018f5713fe6f932d8df38f30b5277d","modified":1612620045968},{"_id":"public/tags/Vlantis/index.html","hash":"0175f6567bef1614067c5b73ed615e8ee1db468a","modified":1612620045968},{"_id":"public/tags/电商系统/index.html","hash":"514e03d5d194293122dc3fab41702ded9c7d8b06","modified":1612620045968},{"_id":"public/tags/Nginx/index.html","hash":"c109a63b989f19e5cdc15a4170825f7d6e667ebc","modified":1612620045968},{"_id":"public/tags/Aria2/index.html","hash":"c640f3ea66012d08097cbd1e9a632c38b13be42b","modified":1612620045968},{"_id":"public/tags/Stunnel代理/index.html","hash":"335099533673acad38e5883ac2c7f4c1f6429886","modified":1612620045968},{"_id":"public/tags/Vuejs/index.html","hash":"ffdc29470abb5a70789cd38057d4104d12980654","modified":1612620045968},{"_id":"public/tags/网络技术/index.html","hash":"638ebda95ef8ea4b4fc78b935eb4a97615237ef4","modified":1612620045968},{"_id":"public/tags/安卓编程/index.html","hash":"428cb8ca9c8343b951dd7a8f3fe214fd36f0ff9c","modified":1612620045968},{"_id":"public/CNAME","hash":"70b5b9ae3771b9fc0402fa6a3beb0a7e425fc328","modified":1602773205256},{"_id":"public/js/aplayer.js","hash":"5fcc1729a1417f204275fe37ef45f9464781badd","modified":1602773205256},{"_id":"public/css/style.css","hash":"972eeb4fb676a6cddb6f8717420a081e32358c97","modified":1602773205256},{"_id":"public/js/app.js","hash":"75ad92af8c1a5c20d43f74c322e7ce5e0c871054","modified":1602773205256},{"_id":"public/js/search.js","hash":"909000d8031fb4508d8fe011bcd69436f7cc95f1","modified":1602773205256},{"_id":"public/js/valine.js","hash":"3c81f4a8ae93e8fda36a3fc9b0d0053eca81847f","modified":1602773205256},{"_id":"source/_posts/利用mitmproxy-Python爬取饿了么零售商家版订单信息.md","hash":"8e16148b18cf2bd3e339d3d9086c01047ae6ea46","modified":1602888142537},{"_id":"public/2020/10/16/利用mitmproxy-Python爬取饿了么零售商家版订单信息/index.html","hash":"bf33a24723955e65a7500cd149d38e73c1770428","modified":1602888154165},{"_id":"public/categories/爬虫/index.html","hash":"6cb8570052f906c64a889c8c8a308cab80cacbcf","modified":1612620045968},{"_id":"public/tags/Mitmproxy/index.html","hash":"07d612ca40e21e50e6e11d98acbef6f944a95c8b","modified":1612620045968},{"_id":"source/_posts/已知多个地点经纬度的最优路径规划.md","hash":"c411e42b793df379f0ea602d1c896ae9bbdd7207","modified":1603064312401},{"_id":"source/_posts/外卖平台订单爬取之美团外卖商家版.md","hash":"02110a068972c5f160a256514066f407402cf28a","modified":1603035824512},{"_id":"source/_posts/外卖平台订单爬取之饿了么零售商家版.md","hash":"0b78e576a500f0264a7e0811c31c9f4268b0789f","modified":1603033876585},{"_id":"public/2020/10/19/已知多个地点经纬度的最优路径规划/index.html","hash":"986a9f09ebdf94cda5be23d37245fbd5d7298ee8","modified":1603564172137},{"_id":"public/2020/10/17/外卖平台订单爬取之美团外卖商家版/index.html","hash":"20b1380702e3dc373e4a3ac0f375d9c227f69ce6","modified":1603064327138},{"_id":"public/2020/10/16/外卖平台订单爬取之饿了么零售商家版/index.html","hash":"7a4b58808af6da3fb077000a4f046ff79a99f1ee","modified":1612620045968},{"_id":"public/archives/2020/page/6/index.html","hash":"9a69d11bd415b2e3807a9ca259395f7c629c8b90","modified":1612620045968},{"_id":"public/tags/TWRP/index.html","hash":"243bf2028f69a2d1b0e21d891a27348577576433","modified":1612620045968},{"_id":"source/_posts/如何利用ADB开发王者荣耀外挂.md","hash":"42e292415cbffcffbb8d5a437081207ed44b7941","modified":1603564352932},{"_id":"public/2020/10/24/如何利用ADB开发王者荣耀外挂/index.html","hash":"5d8cd90f8528645fb6c72ebdbe2691deb795a8f2","modified":1605390760934},{"_id":"public/tags/Java/index.html","hash":"7a38598eae740e51115635a46d1f2527b4cf3f33","modified":1612620045968},{"_id":"source/_posts/北大人工智能实践——TensorFlow2.md","hash":"75eac763dabc82ef7fd1f7d5101a9cb9d46994de","modified":1605549507052},{"_id":"public/2020/11/12/北大人工智能实践——TensorFlow2/index.html","hash":"42770ad15b19759a619a373ca7c1bf9203fe7082","modified":1606562725269},{"_id":"public/archives/2020/11/index.html","hash":"99545d7c042aa38911b7cdf08c297d076b38ef3b","modified":1612620045968},{"_id":"public/tags/人工智能/index.html","hash":"48c890ffb93bdc9940ff80827306775376b334aa","modified":1612620045968},{"_id":"source/_posts/人工智能——激活函数.md","hash":"2d1cc649507ab7058741b77f26e6ca2c5004f6a0","modified":1605442278508},{"_id":"public/2020/11/15/人工智能——激活函数/index.html","hash":"36421af25258da344c36f68c6cdac744cc268b85","modified":1606680097034},{"_id":"public/categories/人工智能/index.html","hash":"5c3d5544123949b9c98f4be72d1efc1311f10597","modified":1612620045968},{"_id":"public/tags/AI/index.html","hash":"1191a5529b34d9dee00de7345cfd83c01df5ddf2","modified":1612620045968},{"_id":"source/_posts/ESP8266从0到1.md","hash":"edeb937c4e9be6e2d6c651463241c0a00e6f333c","modified":1606561849694},{"_id":"source/_posts/基于ESP8266WIFI模块和MPU6050加速度计在Arduino上开发智能信箱.md","hash":"848648c95d97591b328a3362c76c20065c0f2567","modified":1606757349825},{"_id":"public/2020/11/26/ESP8266从0到1/index.html","hash":"fbfae33052e959c47afcdcffdc8896a4a5779545","modified":1612620045968},{"_id":"public/2020/11/24/基于ESP8266WIFI模块和MPU6050加速度计在Arduino上开发智能信箱/index.html","hash":"f290e0f4f028383357ea63932152029eb581fdde","modified":1606757362848},{"_id":"public/categories/嵌入式/index.html","hash":"244bb57587d92d89c26a854af4845efb64201d55","modified":1612620045968},{"_id":"public/tags/Arduino/index.html","hash":"8efbe49d24076bae7d487894360d63340180471f","modified":1612620045968},{"_id":"public/tags/ESP8266/index.html","hash":"ae24b51ddbaa1d45488fad84b3b90c281fa8f294","modified":1612620045968},{"_id":"public/tags/MPU6050/index.html","hash":"d6df1a44fa9ed752f3842f33206895cfa7868c94","modified":1612620045968},{"_id":"source/_posts/爬取Youtube搜索结果.md","hash":"a419a9840085b662b907467594bf97206512f4e8","modified":1612620026565},{"_id":"public/2021/02/06/爬取Youtube搜索结果/index.html","hash":"e7e25a0541de17c0135b638e874bb577297111ec","modified":1612620045968},{"_id":"public/archives/2021/index.html","hash":"ee995b086931fef9f5320c2a0f1ded984d84170b","modified":1612620045968},{"_id":"public/archives/2021/02/index.html","hash":"bcb159d0e2461b711a7b11346653fc251af97df3","modified":1612620045968}],"Category":[{"name":"安卓编程","_id":"ckgaxsaai0004p0vzh38gbgkd"},{"name":"网站编程","_id":"ckgaxsaar000cp0vzer11e5s7"},{"name":"学习笔记","_id":"ckgaxsaaw000kp0vzg82c4j3a"},{"name":"Python","_id":"ckgaxsabb001bp0vz02r5es0b"},{"name":"Windows","_id":"ckgaxsabi001ip0vz7l9hbu44"},{"name":"Linux编程","_id":"ckgaxsabo001pp0vz67pwbnrg"},{"name":"其他","_id":"ckgaxsac10024p0vzb4qs1u41"},{"name":"Linux","_id":"ckgaxsacb002pp0vzd89ph2g9"},{"name":"树莓派","_id":"ckgaxsacp003ap0vzc4zfa5lx"},{"name":"爬虫","_id":"ckgcu81wb0001tsvz2fdm3p25"},{"name":"人工智能","_id":"ckhj2wb3800029kvz57ki0due"},{"name":"嵌入式","_id":"cki1lyuec0001ekvz2vigbozr"}],"Data":[{"_id":"friends","data":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}]},{"_id":"musics","data":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}],"Page":[{"title":"archives","date":"2019-07-19T14:39:20.000Z","type":"archives","layout":"archives","_content":"","source":"archives/index.md","raw":"---\ntitle: archives\ndate: 2019-07-19 16:39:20\ntype: \"archives\"\nlayout: \"archives\"\n---","updated":"2019-10-23T21:16:56.000Z","path":"archives/index.html","comments":1,"_id":"ckgaxsaa30000p0vz0vwu4r2q","content":"","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":""},{"title":"所有分类","date":"2019-07-19T14:39:20.000Z","type":"categories","layout":"category","index":true,"_content":"","source":"categories/index.md","raw":"---\ntitle: 所有分类\ndate: 2019-07-19 16:39:20\ntype: \"categories\"\nlayout: category\nindex: true\n---","updated":"2020-08-26T16:50:41.582Z","path":"categories/index.html","comments":1,"_id":"ckgaxsaaf0002p0vzcvnpgy8w","content":"","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":""},{"title":"about","date":"2019-10-24T14:41:10.000Z","type":"about","layout":"about","_content":"\n\n# 教育经历\n* **硕士 可持续能源供应**\n\n  RWTH\n\n  2020/04 - 至今\n\n* <b>语言学习</b>\n  德国\n  2019/10 - 2020/03\n\n* <b>本科 机械设计制造及其自动化</b>\n  国内某大学\n  2015/09 - 2019/06\n\n\n# 联系方式\n* <b>电子邮箱</b>\nim@xieqifei.com\n* <b>地址</b>\nAachen, Nordrhein-Westfalen, Germany\nBLZ:52074\n* <b>微信</b>\nTakeOff_Xie\n* <b>QQ</b>\n975322731","source":"about/index.md","raw":"---\ntitle: about\ndate: 2019-10-24 16:41:10\ntype: \"about\"\nlayout: \"about\"\n---\n\n\n# 教育经历\n* **硕士 可持续能源供应**\n\n  RWTH\n\n  2020/04 - 至今\n\n* <b>语言学习</b>\n  德国\n  2019/10 - 2020/03\n\n* <b>本科 机械设计制造及其自动化</b>\n  国内某大学\n  2015/09 - 2019/06\n\n\n# 联系方式\n* <b>电子邮箱</b>\nim@xieqifei.com\n* <b>地址</b>\nAachen, Nordrhein-Westfalen, Germany\nBLZ:52074\n* <b>微信</b>\nTakeOff_Xie\n* <b>QQ</b>\n975322731","updated":"2020-08-29T16:09:54.006Z","path":"about/index.html","comments":1,"_id":"ckgaxsaal0006p0vz2c8bbpz7","content":"<h1 id=\"教育经历\"><a href=\"#教育经历\" class=\"headerlink\" title=\"教育经历\"></a>教育经历</h1><ul>\n<li><p><strong>硕士 可持续能源供应</strong></p>\n<p>RWTH</p>\n<p>2020/04 - 至今</p>\n</li>\n<li><p><b>语言学习</b><br>德国<br>2019/10 - 2020/03</p>\n</li>\n<li><p><b>本科 机械设计制造及其自动化</b><br>国内某大学<br>2015/09 - 2019/06</p>\n</li>\n</ul>\n<h1 id=\"联系方式\"><a href=\"#联系方式\" class=\"headerlink\" title=\"联系方式\"></a>联系方式</h1><ul>\n<li><b>电子邮箱</b><br><a href=\"mailto:&#x69;&#109;&#x40;&#x78;&#x69;&#x65;&#x71;&#x69;&#102;&#x65;&#x69;&#46;&#x63;&#x6f;&#109;\">&#x69;&#109;&#x40;&#x78;&#x69;&#x65;&#x71;&#x69;&#102;&#x65;&#x69;&#46;&#x63;&#x6f;&#109;</a></li>\n<li><b>地址</b><br>Aachen, Nordrhein-Westfalen, Germany<br>BLZ:52074</li>\n<li><b>微信</b><br>TakeOff_Xie</li>\n<li><b>QQ</b><br>975322731</li>\n</ul>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"教育经历\"><a href=\"#教育经历\" class=\"headerlink\" title=\"教育经历\"></a>教育经历</h1><ul>\n<li><p><strong>硕士 可持续能源供应</strong></p>\n<p>RWTH</p>\n<p>2020/04 - 至今</p>\n</li>\n<li><p><b>语言学习</b><br>德国<br>2019/10 - 2020/03</p>\n</li>\n<li><p><b>本科 机械设计制造及其自动化</b><br>国内某大学<br>2015/09 - 2019/06</p>\n</li>\n</ul>\n<h1 id=\"联系方式\"><a href=\"#联系方式\" class=\"headerlink\" title=\"联系方式\"></a>联系方式</h1><ul>\n<li><b>电子邮箱</b><br><a href=\"mailto:&#x69;&#109;&#x40;&#x78;&#x69;&#x65;&#x71;&#x69;&#102;&#x65;&#x69;&#46;&#x63;&#x6f;&#109;\">&#x69;&#109;&#x40;&#x78;&#x69;&#x65;&#x71;&#x69;&#102;&#x65;&#x69;&#46;&#x63;&#x6f;&#109;</a></li>\n<li><b>地址</b><br>Aachen, Nordrhein-Westfalen, Germany<br>BLZ:52074</li>\n<li><b>微信</b><br>TakeOff_Xie</li>\n<li><b>QQ</b><br>975322731</li>\n</ul>\n"},{"title":"contact","date":"2019-07-26T15:17:02.000Z","type":"contact","layout":"contact","_content":"\n# 欢迎留言\n大家有任何问题，都可以在评论区给我留言，或者加我联系方式：\n* QQ：**975322731**\n* 微信：**TakeOff_Xie**\n\n我很忙啦，如果不是很麻烦的问题就直接在评论区留言啦。\n**当然不介意你加我~~**\n\n# 友链交换\n想要交换友链的小伙伴，欢迎在评论区留言，留言格式：\n* **名称：**你的博客名称\n* **地址：**你的博客地址\n* **简介：**一句话简介\n* **头像：**你的头像地址\n\n例如我的博客友链，大家可以加到自己博客里哦：\n* **名称：**飞吧\n* **地址：**https://fei.bar\n* **简介：**分享生活和学习。\n* **头像：**https://fei.bar/medias/avatars/profile.jpg","source":"contact/index.md","raw":"---\ntitle: contact\ndate: 2019-07-26 17:17:02\ntype: \"contact\"\nlayout: \"contact\"\n---\n\n# 欢迎留言\n大家有任何问题，都可以在评论区给我留言，或者加我联系方式：\n* QQ：**975322731**\n* 微信：**TakeOff_Xie**\n\n我很忙啦，如果不是很麻烦的问题就直接在评论区留言啦。\n**当然不介意你加我~~**\n\n# 友链交换\n想要交换友链的小伙伴，欢迎在评论区留言，留言格式：\n* **名称：**你的博客名称\n* **地址：**你的博客地址\n* **简介：**一句话简介\n* **头像：**你的头像地址\n\n例如我的博客友链，大家可以加到自己博客里哦：\n* **名称：**飞吧\n* **地址：**https://fei.bar\n* **简介：**分享生活和学习。\n* **头像：**https://fei.bar/medias/avatars/profile.jpg","updated":"2019-10-24T18:34:36.000Z","path":"contact/index.html","comments":1,"_id":"ckgaxsaan0008p0vz14ql97gr","content":"<h1 id=\"欢迎留言\"><a href=\"#欢迎留言\" class=\"headerlink\" title=\"欢迎留言\"></a>欢迎留言</h1><p>大家有任何问题，都可以在评论区给我留言，或者加我联系方式：</p>\n<ul>\n<li>QQ：<strong>975322731</strong></li>\n<li>微信：<strong>TakeOff_Xie</strong></li>\n</ul>\n<p>我很忙啦，如果不是很麻烦的问题就直接在评论区留言啦。<br><strong>当然不介意你加我~~</strong></p>\n<h1 id=\"友链交换\"><a href=\"#友链交换\" class=\"headerlink\" title=\"友链交换\"></a>友链交换</h1><p>想要交换友链的小伙伴，欢迎在评论区留言，留言格式：</p>\n<ul>\n<li><strong>名称：</strong>你的博客名称</li>\n<li><strong>地址：</strong>你的博客地址</li>\n<li><strong>简介：</strong>一句话简介</li>\n<li><strong>头像：</strong>你的头像地址</li>\n</ul>\n<p>例如我的博客友链，大家可以加到自己博客里哦：</p>\n<ul>\n<li><strong>名称：</strong>飞吧</li>\n<li><strong>地址：</strong><a href=\"https://fei.bar/\">https://fei.bar</a></li>\n<li><strong>简介：</strong>分享生活和学习。</li>\n<li><strong>头像：</strong><a href=\"https://fei.bar/medias/avatars/profile.jpg\">https://fei.bar/medias/avatars/profile.jpg</a></li>\n</ul>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"欢迎留言\"><a href=\"#欢迎留言\" class=\"headerlink\" title=\"欢迎留言\"></a>欢迎留言</h1><p>大家有任何问题，都可以在评论区给我留言，或者加我联系方式：</p>\n<ul>\n<li>QQ：<strong>975322731</strong></li>\n<li>微信：<strong>TakeOff_Xie</strong></li>\n</ul>\n<p>我很忙啦，如果不是很麻烦的问题就直接在评论区留言啦。<br><strong>当然不介意你加我~~</strong></p>\n<h1 id=\"友链交换\"><a href=\"#友链交换\" class=\"headerlink\" title=\"友链交换\"></a>友链交换</h1><p>想要交换友链的小伙伴，欢迎在评论区留言，留言格式：</p>\n<ul>\n<li><strong>名称：</strong>你的博客名称</li>\n<li><strong>地址：</strong>你的博客地址</li>\n<li><strong>简介：</strong>一句话简介</li>\n<li><strong>头像：</strong>你的头像地址</li>\n</ul>\n<p>例如我的博客友链，大家可以加到自己博客里哦：</p>\n<ul>\n<li><strong>名称：</strong>飞吧</li>\n<li><strong>地址：</strong><a href=\"https://fei.bar/\">https://fei.bar</a></li>\n<li><strong>简介：</strong>分享生活和学习。</li>\n<li><strong>头像：</strong><a href=\"https://fei.bar/medias/avatars/profile.jpg\">https://fei.bar/medias/avatars/profile.jpg</a></li>\n</ul>\n"},{"layout":"links","date":"2019-07-19T14:42:10.000Z","title":"我的朋友们","sidebar":[],"links":[{"group":"分组1","icon":"fas fa-user-tie","desc":"这个分组的描述","items":[{"name":null,"avatar":null,"url":null,"backgroundColor":"#3E74C9","textColor":"#fff","tags":["标签1","标签2"],"desc":"描述文字"}]},{"group":"分组2","icon":"fas fa-user-tie","desc":"这个分组的描述","items":[{"name":null,"avatar":null,"url":null,"backgroundColor":"#3E74C9","textColor":"#fff","tags":["标签1","标签2"],"desc":"描述文字"}]}],"_content":"\n\n\n<!-- more -->\n\n\n\n# 友链交换\n\n想要交换友链的小伙伴，欢迎在留言板留言，留言格式：\n* **名称：**你的博客名称\n* **地址：**你的博客地址\n* **简介：**一句话简介\n* **头像：**你的头像地址\n\n例如我的博客友链，大家可以加到自己博客里哦：\n* **名称：**飞吧\n* **地址：**https://fei.bar\n* **简介：**分享生活和学习\n* **头像：**https://fei.bar/medias/avatars/profile.jpg","source":"friends/index-DESKTOP-N8PHHQN.md","raw":"---\nlayout: links     # 必须\ndate: 2019-07-19 16:42:10\ntitle: 我的朋友们   # 可选，这是友链页的标题\nsidebar: []\nlinks:\n  - group: 分组1\n    icon: fas fa-user-tie\n    desc: 这个分组的描述\n    items:\n    - name:     # 博客名\n      avatar:   # 头像链接\n      url:      # 博客链接\n      backgroundColor: '#3E74C9' # 卡片背景颜色\n      textColor: '#fff'  # 卡片文字颜色\n      tags: [标签1, 标签2]    # 标签\n      desc: 描述文字\n  - group: 分组2\n    icon: fas fa-user-tie\n    desc: 这个分组的描述\n    items:\n    - name:     # 博客名\n      avatar:   # 头像链接\n      url:      # 博客链接\n      backgroundColor: '#3E74C9' # 卡片背景颜色\n      textColor: '#fff'  # 卡片文字颜色\n      tags: [标签1, 标签2]    # 标签\n      desc: 描述文字\n---\n\n\n\n<!-- more -->\n\n\n\n# 友链交换\n\n想要交换友链的小伙伴，欢迎在留言板留言，留言格式：\n* **名称：**你的博客名称\n* **地址：**你的博客地址\n* **简介：**一句话简介\n* **头像：**你的头像地址\n\n例如我的博客友链，大家可以加到自己博客里哦：\n* **名称：**飞吧\n* **地址：**https://fei.bar\n* **简介：**分享生活和学习\n* **头像：**https://fei.bar/medias/avatars/profile.jpg","updated":"2020-06-05T15:07:38.929Z","path":"friends/index-DESKTOP-N8PHHQN.html","comments":1,"_id":"ckgaxsaap000ap0vzek29ep1a","content":"<a id=\"more\"></a>\n\n\n\n<h1 id=\"友链交换\"><a href=\"#友链交换\" class=\"headerlink\" title=\"友链交换\"></a>友链交换</h1><p>想要交换友链的小伙伴，欢迎在留言板留言，留言格式：</p>\n<ul>\n<li><strong>名称：</strong>你的博客名称</li>\n<li><strong>地址：</strong>你的博客地址</li>\n<li><strong>简介：</strong>一句话简介</li>\n<li><strong>头像：</strong>你的头像地址</li>\n</ul>\n<p>例如我的博客友链，大家可以加到自己博客里哦：</p>\n<ul>\n<li><strong>名称：</strong>飞吧</li>\n<li><strong>地址：</strong><a href=\"https://fei.bar/\">https://fei.bar</a></li>\n<li><strong>简介：</strong>分享生活和学习</li>\n<li><strong>头像：</strong><a href=\"https://fei.bar/medias/avatars/profile.jpg\">https://fei.bar/medias/avatars/profile.jpg</a></li>\n</ul>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"友链交换\"><a href=\"#友链交换\" class=\"headerlink\" title=\"友链交换\"></a>友链交换</h1><p>想要交换友链的小伙伴，欢迎在留言板留言，留言格式：</p>\n<ul>\n<li><strong>名称：</strong>你的博客名称</li>\n<li><strong>地址：</strong>你的博客地址</li>\n<li><strong>简介：</strong>一句话简介</li>\n<li><strong>头像：</strong>你的头像地址</li>\n</ul>\n<p>例如我的博客友链，大家可以加到自己博客里哦：</p>\n<ul>\n<li><strong>名称：</strong>飞吧</li>\n<li><strong>地址：</strong><a href=\"https://fei.bar/\">https://fei.bar</a></li>\n<li><strong>简介：</strong>分享生活和学习</li>\n<li><strong>头像：</strong><a href=\"https://fei.bar/medias/avatars/profile.jpg\">https://fei.bar/medias/avatars/profile.jpg</a></li>\n</ul>"},{"title":"friends","date":"2019-07-19T14:42:10.000Z","type":"friends","layout":"friends","_content":"\n# 友链交换\n想要交换友链的小伙伴，欢迎在留言板留言，留言格式：\n* **名称：**你的博客名称\n* **地址：**你的博客地址\n* **简介：**一句话简介\n* **头像：**你的头像地址\n\n例如我的博客友链，大家可以加到自己博客里哦：\n* **名称：**飞吧\n* **地址：**https://fei.bar\n* **简介：**分享生活和学习\n* **头像：**https://fei.bar/medias/avatars/profile.jpg","source":"friends/index.md","raw":"---\ntitle: friends\ndate: 2019-07-19 16:42:10\ntype: \"friends\"\nlayout: \"friends\"\n---\n\n# 友链交换\n想要交换友链的小伙伴，欢迎在留言板留言，留言格式：\n* **名称：**你的博客名称\n* **地址：**你的博客地址\n* **简介：**一句话简介\n* **头像：**你的头像地址\n\n例如我的博客友链，大家可以加到自己博客里哦：\n* **名称：**飞吧\n* **地址：**https://fei.bar\n* **简介：**分享生活和学习\n* **头像：**https://fei.bar/medias/avatars/profile.jpg","updated":"2019-10-26T18:16:10.000Z","path":"friends/index.html","comments":1,"_id":"ckgaxsaas000fp0vz0dfaggii","content":"<h1 id=\"友链交换\"><a href=\"#友链交换\" class=\"headerlink\" title=\"友链交换\"></a>友链交换</h1><p>想要交换友链的小伙伴，欢迎在留言板留言，留言格式：</p>\n<ul>\n<li><strong>名称：</strong>你的博客名称</li>\n<li><strong>地址：</strong>你的博客地址</li>\n<li><strong>简介：</strong>一句话简介</li>\n<li><strong>头像：</strong>你的头像地址</li>\n</ul>\n<p>例如我的博客友链，大家可以加到自己博客里哦：</p>\n<ul>\n<li><strong>名称：</strong>飞吧</li>\n<li><strong>地址：</strong><a href=\"https://fei.bar/\">https://fei.bar</a></li>\n<li><strong>简介：</strong>分享生活和学习</li>\n<li><strong>头像：</strong><a href=\"https://fei.bar/medias/avatars/profile.jpg\">https://fei.bar/medias/avatars/profile.jpg</a></li>\n</ul>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"友链交换\"><a href=\"#友链交换\" class=\"headerlink\" title=\"友链交换\"></a>友链交换</h1><p>想要交换友链的小伙伴，欢迎在留言板留言，留言格式：</p>\n<ul>\n<li><strong>名称：</strong>你的博客名称</li>\n<li><strong>地址：</strong>你的博客地址</li>\n<li><strong>简介：</strong>一句话简介</li>\n<li><strong>头像：</strong>你的头像地址</li>\n</ul>\n<p>例如我的博客友链，大家可以加到自己博客里哦：</p>\n<ul>\n<li><strong>名称：</strong>飞吧</li>\n<li><strong>地址：</strong><a href=\"https://fei.bar/\">https://fei.bar</a></li>\n<li><strong>简介：</strong>分享生活和学习</li>\n<li><strong>头像：</strong><a href=\"https://fei.bar/medias/avatars/profile.jpg\">https://fei.bar/medias/avatars/profile.jpg</a></li>\n</ul>\n"},{"title":"所有标签","date":"2019-07-19T14:40:27.000Z","type":"tags","layout":"tag","index":true,"_content":"","source":"tags/index.md","raw":"---\ntitle: 所有标签\ndate: 2019-07-19 16:40:27\ntype: \"tags\"\nlayout: tag\nindex: true\n---","updated":"2020-08-26T16:50:22.630Z","path":"tags/index.html","comments":1,"_id":"ckgaxsaau000hp0vz8ctyfhtj","content":"","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":""}],"Post":[{"title":"ADB参考指令","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-21T14:31:53.000Z","password":null,"summary":null,"_content":"\n# 1：参考资料\n\n《[使用adb命令操控Android手机（adb命令）](https://www.cnblogs.com/hyf20131113/p/10919586.html)》：从连接设备，到键盘输入和点击操作\n\n《[adb shell getevent中获取到的屏幕事件的坐标转换](http://www.360doc.com/content/14/0628/14/426085_390487096.shtml)》","source":"_posts/ADB参考指令.md","raw":"---\ntitle: ADB参考指令\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-21 16:31:53\npassword:\nsummary:\ntags: ADB\ncategories: 安卓编程\n---\n\n# 1：参考资料\n\n《[使用adb命令操控Android手机（adb命令）](https://www.cnblogs.com/hyf20131113/p/10919586.html)》：从连接设备，到键盘输入和点击操作\n\n《[adb shell getevent中获取到的屏幕事件的坐标转换](http://www.360doc.com/content/14/0628/14/426085_390487096.shtml)》","slug":"ADB参考指令","published":1,"updated":"2020-09-21T14:35:06.157Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaac0001p0vzdznr4syg","content":"<h1 id=\"1：参考资料\"><a href=\"#1：参考资料\" class=\"headerlink\" title=\"1：参考资料\"></a>1：参考资料</h1><p>《<a href=\"https://www.cnblogs.com/hyf20131113/p/10919586.html\">使用adb命令操控Android手机（adb命令）</a>》：从连接设备，到键盘输入和点击操作</p>\n<p>《<a href=\"http://www.360doc.com/content/14/0628/14/426085_390487096.shtml\">adb shell getevent中获取到的屏幕事件的坐标转换</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：参考资料\"><a href=\"#1：参考资料\" class=\"headerlink\" title=\"1：参考资料\"></a>1：参考资料</h1><p>《<a href=\"https://www.cnblogs.com/hyf20131113/p/10919586.html\">使用adb命令操控Android手机（adb命令）</a>》：从连接设备，到键盘输入和点击操作</p>\n<p>《<a href=\"http://www.360doc.com/content/14/0628/14/426085_390487096.shtml\">adb shell getevent中获取到的屏幕事件的坐标转换</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Mon Sep 21 2020 16:35:06 GMT+0200 (GMT+02:00)","title":"ADB参考指令","path":"2020/09/21/ADB参考指令/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-21T14:31:53.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-21T14:31:53.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"安卓编程","tags":["ADB"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"BLOG双线部署+https","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-14T11:53:54.000Z","password":null,"summary":"将Hexo博客分别部署到github和coding，并使用dns.la分海外和国内分别解析。之前使用hexo博客时，就打算使用双线部署，但当时在coding申请ssl证书一直失败。加上一直没法把域名dns修改为dnspod（dnspod支持多线解析），所以放弃了。这次换了个dns服务商，并且成功申请了ssl证书。","_content":"\ndns.la支持多线解析，而且免费，非常好用。推荐！\n\n关于证书申请的方式，就不多说了。之前在coding申请证书失败，是因为域名cname解析没有配置正确。将域名服务商修改为 https://dns.la 后，需要先将域名海外线路解析到coding。\n\n> 将海外线路解析到coding是，coding证书能够申请成功的关键！\n> 在github申请证书时，也需要将海外线路解析到github。\n\n证书申请完毕后，可以在dns.la上修改dns线路，国内解析到coding，海外解析到github。","source":"_posts/BLOG双线部署-https.md","raw":"---\ntitle: BLOG双线部署+https\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-14 13:53:54\npassword:\nsummary: 将Hexo博客分别部署到github和coding，并使用dns.la分海外和国内分别解析。之前使用hexo博客时，就打算使用双线部署，但当时在coding申请ssl证书一直失败。加上一直没法把域名dns修改为dnspod（dnspod支持多线解析），所以放弃了。这次换了个dns服务商，并且成功申请了ssl证书。\ntags: 网站优化\ncategories: 网站编程\n---\n\ndns.la支持多线解析，而且免费，非常好用。推荐！\n\n关于证书申请的方式，就不多说了。之前在coding申请证书失败，是因为域名cname解析没有配置正确。将域名服务商修改为 https://dns.la 后，需要先将域名海外线路解析到coding。\n\n> 将海外线路解析到coding是，coding证书能够申请成功的关键！\n> 在github申请证书时，也需要将海外线路解析到github。\n\n证书申请完毕后，可以在dns.la上修改dns线路，国内解析到coding，海外解析到github。","slug":"BLOG双线部署-https","published":1,"updated":"2020-06-20T06:46:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaag0003p0vzfzsu0ksi","content":"<p>dns.la支持多线解析，而且免费，非常好用。推荐！</p>\n<p>关于证书申请的方式，就不多说了。之前在coding申请证书失败，是因为域名cname解析没有配置正确。将域名服务商修改为 <a href=\"https://dns.la/\">https://dns.la</a> 后，需要先将域名海外线路解析到coding。</p>\n<blockquote>\n<p>将海外线路解析到coding是，coding证书能够申请成功的关键！<br>在github申请证书时，也需要将海外线路解析到github。</p>\n</blockquote>\n<p>证书申请完毕后，可以在dns.la上修改dns线路，国内解析到coding，海外解析到github。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>dns.la支持多线解析，而且免费，非常好用。推荐！</p>\n<p>关于证书申请的方式，就不多说了。之前在coding申请证书失败，是因为域名cname解析没有配置正确。将域名服务商修改为 <a href=\"https://dns.la/\">https://dns.la</a> 后，需要先将域名海外线路解析到coding。</p>\n<blockquote>\n<p>将海外线路解析到coding是，coding证书能够申请成功的关键！<br>在github申请证书时，也需要将海外线路解析到github。</p>\n</blockquote>\n<p>证书申请完毕后，可以在dns.la上修改dns线路，国内解析到coding，海外解析到github。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:46:31 GMT+0200 (GMT+02:00)","title":"BLOG双线部署+https","path":"2020/06/14/BLOG双线部署-https/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-14T11:53:54.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-14T11:53:54.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["网站优化"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Bootstrap学习笔记","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-03-01T15:34:13.000Z","password":null,"summary":"Bootstrap是一个非常优秀的CSS样式库，利用这个库，可以更少的关注网站样式，而更多的去专注于网站内容的安排。她同时还提供了非常不错的布局方案。响应式布局，灵活的容器修改。","_content":"\n# 0：入门例子\n\n```html\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <title>Bootstrap</title>\n    <link rel=\"stylesheet\" href=\"css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <h1>网站天下</h1>\n        <p>hello-world</p>\n    </div>\n\n</body>\n</html>\n```\n\n`lang=\"zh-CN\"`修改网站文字为中文文字。\n\n`<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">`设置网站为自适应屏幕尺寸网站，缩放比例为不缩放。\n\n`<link rel=\"stylesheet\" href=\"css/bootstrap.min.css\">`导入本地bootstrap.css样式。\n\n# 1：容器\n\n`.container`+`tab`=`<div class=\"container\"></div>`固定宽度居中显示\n\n`.container-fluid`全宽容器\n\n变化容器中一行一共包含12个格子。建立一个列表，每三个小格（col-xl-3）为一大格，需要一共4个大格可将其填满。\n\n```html\n    <div class=\"container\">\n        <div class=\"row\">\n            <div class=\"col-xl-3\" style=\"background-color: #0c5460\">111</div>\n            <div class=\"col-xl-3\" style=\"background-color: #005cbf\">222</div>\n            <div class=\"col-xl-3\" style=\"background-color: #1e7e34\">333</div>\n            <div class=\"col-xl-3\" style=\"background-color: #6c757d\">444</div>\n        </div>\n    </div>\n```\n\n**栅格等级：**`col`特小、`col-sm-*`小、`col=md-*`中、`col-lg-*`大、`col-xl-*`超宽。\n\n各尺寸表示在不同尺寸屏幕上的显示方式，比如使用，`col-xl`则在屏幕宽度变为1000像素左右时，原来的栅格就换行显示，每个栅格占据一行。\n\n若直接使用`col`来修饰，那么，即便在很小的屏幕上，栅格也不会换行。相当于网页直接缩放。不推荐使用。\n\n栅格后的数字非必须。不添加数字则采用`flexbox`布局\n\n- 设置一列宽度\n\n`col-6`占6/12\n\n`col-auto`可变宽度，随内容变化，变化的单位为1小格\n\n- 混合布局\n\n`col-sm-6 col-lg-3`大屏时每行四个，中屏每行2个，小屏每行一个。\n\n- 对齐\n\n垂直对齐`align-items-center`、`align-items-xl-end`\n\n水平对齐`justify-content-start/center/end/around/between`\n\n- 消除内边距\n\n`<div class=\"row no-gutters\">`\n\n- 排序\n\n`order-*`*值越小排序越前。默认为0\n\n- 偏移\n\n`offset-*`偏移*个格子，也可加断点\n\n- margin移动\n\n`mr-auto``ml-auto`\n\n# 2：排版\n\n```html\n<h1>\n    主标题<small> 小号字体</small>\n</h1>\n\n<div class=\"display-1\">比标题字体大</div>\n\n<div class=\"leader\">变大强调</div>\n\n<p><mark>高亮</mark></p>\n<p>普通<span class=\"mark\">高亮</span>文本</p>\n\n<p><del>删除线</del></p>\n<p><s>删除线</s></p>\n\n<p><ins>下划线</ins></p>\n<p><u>下划线</u></p>\n\n<p><strong>粗体</strong></p>\n<p><b>粗体</b></p>\n\n<p><em>斜体</em></p>\n<p><i>斜体</i></p>\n\n<p><abbr title=\"请输入你的邮箱\" class=\"initialism\">email</abbr></p>\n\n<blockquote class=\"blockquote\">\n    引用在此\n</blockquote>\n\n<code>代码块</code>\n\n<var>变量斜体</var>\n\n<kbd>用户输入，黑色背景白色字体</kbd>\n```\n\n# 3：图片和图片框\n\n```html\n<img src=\"../img/lg.img\" alt=\"\" class=\"img-fluid img-thumbnail w-100\">\n\n<div>\n    <img src=\"\" class=\"rounded float-left\">//圆角\n    <img src=\"\" class=\"rounded float-right\">\n    <img src=\"\" class=\"rounded d-block mx-auto\">//转为块级元素，然后居中对齐\n</div>\n\n<picture>\n\t<source srcset=\"../images/lg.jpg\" media=\"(min-width:992px)\">\n    <source srcset=\"../images/md.jpg\" media=\"(min-width:576px)\">\n    <img src=\"../images/sm.jpg\" alt=\"\">\n</picture>\n<!--设置不同屏幕显示不同尺寸图片-->\n```\n\n# 4：表格\n\n```html\n<body>\n    <div class=\"container\"><br>\n            <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead>\n                <tr>\n                    <th>HeadingHeadingHeading</th>\n                    <th>HeadingHeadingHeading</th>\n                    <th>HeadingHeadingHeading</th>\n                </tr>\n                </thead>\n                <tbody>\n                <tr>\n                    <td>CellCellCell</td>\n                    <td>CellCellCell</td>\n                    <td>CellCellCell</td>\n                </tr>\n                </tbody>\n            </table>\n            </div>\n    </div>\n</body>\n```\n\n**条纹状表格：**使用`.table-striped`样式定义`<tbody>`可以产生逐行交替变化的背景色。同`.table-dark`结合使用改变变化背景色为黑夜主题。\n\n**表格边框：**使用`。table-bordered`产生表格边框与间隙。`table-borderless`无边界表格。\n\n**悬停效果：**`table-hover`悬停时，背景高亮。\n\n**缩紧表格**：`table—sm`可以将表格padding值缩减为原来的一般。\n\n**Caption表格辅助标题：**`<caption>`默认是隐藏的，协助屏幕阅读用户找到表格，了解表格内容，并决定是否阅读它。\n\n**字体和背景色：**`table-dark、table-primary、table-secondary、table-warnung、table-success、table-danger、table-info`为浅色字体色，将`table`替换为`bg`则改为背景色。能加在tr或td上。\n\n**响应式滚动条：**在`table`上层添加`<div class=\"table-responsive\">`\n\n# 5：边框\n\n```html\n<span class=\"border-top border-secondary rounded-top\"></span>\n<span class=\"rounded-circle\">圆形或椭圆边框</span>\n<span class=\"rounded-pill\">圆形或胶囊型</span>\n```\n\n`border-top-0`清除边框。\n\n# 6：颜色—Display显示属性\n\n```html\n<div class=\"d-inline\"></div>\n<div class=\"d-xl-none\">断点，当屏幕过大时不显示</div>\n```\n\n","source":"_posts/Bootstrap学习笔记.md","raw":"---\ntitle: Bootstrap学习笔记\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-03-01 16:34:13\npassword:\nsummary: Bootstrap是一个非常优秀的CSS样式库，利用这个库，可以更少的关注网站样式，而更多的去专注于网站内容的安排。她同时还提供了非常不错的布局方案。响应式布局，灵活的容器修改。\ntags: Bootstrap\ncategories: 学习笔记\n---\n\n# 0：入门例子\n\n```html\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <title>Bootstrap</title>\n    <link rel=\"stylesheet\" href=\"css/bootstrap.min.css\">\n</head>\n<body>\n    <div class=\"container\">\n        <h1>网站天下</h1>\n        <p>hello-world</p>\n    </div>\n\n</body>\n</html>\n```\n\n`lang=\"zh-CN\"`修改网站文字为中文文字。\n\n`<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">`设置网站为自适应屏幕尺寸网站，缩放比例为不缩放。\n\n`<link rel=\"stylesheet\" href=\"css/bootstrap.min.css\">`导入本地bootstrap.css样式。\n\n# 1：容器\n\n`.container`+`tab`=`<div class=\"container\"></div>`固定宽度居中显示\n\n`.container-fluid`全宽容器\n\n变化容器中一行一共包含12个格子。建立一个列表，每三个小格（col-xl-3）为一大格，需要一共4个大格可将其填满。\n\n```html\n    <div class=\"container\">\n        <div class=\"row\">\n            <div class=\"col-xl-3\" style=\"background-color: #0c5460\">111</div>\n            <div class=\"col-xl-3\" style=\"background-color: #005cbf\">222</div>\n            <div class=\"col-xl-3\" style=\"background-color: #1e7e34\">333</div>\n            <div class=\"col-xl-3\" style=\"background-color: #6c757d\">444</div>\n        </div>\n    </div>\n```\n\n**栅格等级：**`col`特小、`col-sm-*`小、`col=md-*`中、`col-lg-*`大、`col-xl-*`超宽。\n\n各尺寸表示在不同尺寸屏幕上的显示方式，比如使用，`col-xl`则在屏幕宽度变为1000像素左右时，原来的栅格就换行显示，每个栅格占据一行。\n\n若直接使用`col`来修饰，那么，即便在很小的屏幕上，栅格也不会换行。相当于网页直接缩放。不推荐使用。\n\n栅格后的数字非必须。不添加数字则采用`flexbox`布局\n\n- 设置一列宽度\n\n`col-6`占6/12\n\n`col-auto`可变宽度，随内容变化，变化的单位为1小格\n\n- 混合布局\n\n`col-sm-6 col-lg-3`大屏时每行四个，中屏每行2个，小屏每行一个。\n\n- 对齐\n\n垂直对齐`align-items-center`、`align-items-xl-end`\n\n水平对齐`justify-content-start/center/end/around/between`\n\n- 消除内边距\n\n`<div class=\"row no-gutters\">`\n\n- 排序\n\n`order-*`*值越小排序越前。默认为0\n\n- 偏移\n\n`offset-*`偏移*个格子，也可加断点\n\n- margin移动\n\n`mr-auto``ml-auto`\n\n# 2：排版\n\n```html\n<h1>\n    主标题<small> 小号字体</small>\n</h1>\n\n<div class=\"display-1\">比标题字体大</div>\n\n<div class=\"leader\">变大强调</div>\n\n<p><mark>高亮</mark></p>\n<p>普通<span class=\"mark\">高亮</span>文本</p>\n\n<p><del>删除线</del></p>\n<p><s>删除线</s></p>\n\n<p><ins>下划线</ins></p>\n<p><u>下划线</u></p>\n\n<p><strong>粗体</strong></p>\n<p><b>粗体</b></p>\n\n<p><em>斜体</em></p>\n<p><i>斜体</i></p>\n\n<p><abbr title=\"请输入你的邮箱\" class=\"initialism\">email</abbr></p>\n\n<blockquote class=\"blockquote\">\n    引用在此\n</blockquote>\n\n<code>代码块</code>\n\n<var>变量斜体</var>\n\n<kbd>用户输入，黑色背景白色字体</kbd>\n```\n\n# 3：图片和图片框\n\n```html\n<img src=\"../img/lg.img\" alt=\"\" class=\"img-fluid img-thumbnail w-100\">\n\n<div>\n    <img src=\"\" class=\"rounded float-left\">//圆角\n    <img src=\"\" class=\"rounded float-right\">\n    <img src=\"\" class=\"rounded d-block mx-auto\">//转为块级元素，然后居中对齐\n</div>\n\n<picture>\n\t<source srcset=\"../images/lg.jpg\" media=\"(min-width:992px)\">\n    <source srcset=\"../images/md.jpg\" media=\"(min-width:576px)\">\n    <img src=\"../images/sm.jpg\" alt=\"\">\n</picture>\n<!--设置不同屏幕显示不同尺寸图片-->\n```\n\n# 4：表格\n\n```html\n<body>\n    <div class=\"container\"><br>\n            <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead>\n                <tr>\n                    <th>HeadingHeadingHeading</th>\n                    <th>HeadingHeadingHeading</th>\n                    <th>HeadingHeadingHeading</th>\n                </tr>\n                </thead>\n                <tbody>\n                <tr>\n                    <td>CellCellCell</td>\n                    <td>CellCellCell</td>\n                    <td>CellCellCell</td>\n                </tr>\n                </tbody>\n            </table>\n            </div>\n    </div>\n</body>\n```\n\n**条纹状表格：**使用`.table-striped`样式定义`<tbody>`可以产生逐行交替变化的背景色。同`.table-dark`结合使用改变变化背景色为黑夜主题。\n\n**表格边框：**使用`。table-bordered`产生表格边框与间隙。`table-borderless`无边界表格。\n\n**悬停效果：**`table-hover`悬停时，背景高亮。\n\n**缩紧表格**：`table—sm`可以将表格padding值缩减为原来的一般。\n\n**Caption表格辅助标题：**`<caption>`默认是隐藏的，协助屏幕阅读用户找到表格，了解表格内容，并决定是否阅读它。\n\n**字体和背景色：**`table-dark、table-primary、table-secondary、table-warnung、table-success、table-danger、table-info`为浅色字体色，将`table`替换为`bg`则改为背景色。能加在tr或td上。\n\n**响应式滚动条：**在`table`上层添加`<div class=\"table-responsive\">`\n\n# 5：边框\n\n```html\n<span class=\"border-top border-secondary rounded-top\"></span>\n<span class=\"rounded-circle\">圆形或椭圆边框</span>\n<span class=\"rounded-pill\">圆形或胶囊型</span>\n```\n\n`border-top-0`清除边框。\n\n# 6：颜色—Display显示属性\n\n```html\n<div class=\"d-inline\"></div>\n<div class=\"d-xl-none\">断点，当屏幕过大时不显示</div>\n```\n\n","slug":"Bootstrap学习笔记","published":1,"updated":"2020-06-20T06:49:05.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaam0007p0vz4lag53ov","content":"<h1 id=\"0：入门例子\"><a href=\"#0：入门例子\" class=\"headerlink\" title=\"0：入门例子\"></a>0：入门例子</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Bootstrap<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>网站天下<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>hello-world<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>lang=&quot;zh-CN&quot;</code>修改网站文字为中文文字。</p>\n<p><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</code>设置网站为自适应屏幕尺寸网站，缩放比例为不缩放。</p>\n<p><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;css/bootstrap.min.css&quot;&gt;</code>导入本地bootstrap.css样式。</p>\n<h1 id=\"1：容器\"><a href=\"#1：容器\" class=\"headerlink\" title=\"1：容器\"></a>1：容器</h1><p><code>.container</code>+<code>tab</code>=<code>&lt;div class=&quot;container&quot;&gt;&lt;/div&gt;</code>固定宽度居中显示</p>\n<p><code>.container-fluid</code>全宽容器</p>\n<p>变化容器中一行一共包含12个格子。建立一个列表，每三个小格（col-xl-3）为一大格，需要一共4个大格可将其填满。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;row&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #0c5460&quot;</span>&gt;</span>111<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #005cbf&quot;</span>&gt;</span>222<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #1e7e34&quot;</span>&gt;</span>333<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #6c757d&quot;</span>&gt;</span>444<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>栅格等级：</strong><code>col</code>特小、<code>col-sm-*</code>小、<code>col=md-*</code>中、<code>col-lg-*</code>大、<code>col-xl-*</code>超宽。</p>\n<p>各尺寸表示在不同尺寸屏幕上的显示方式，比如使用，<code>col-xl</code>则在屏幕宽度变为1000像素左右时，原来的栅格就换行显示，每个栅格占据一行。</p>\n<p>若直接使用<code>col</code>来修饰，那么，即便在很小的屏幕上，栅格也不会换行。相当于网页直接缩放。不推荐使用。</p>\n<p>栅格后的数字非必须。不添加数字则采用<code>flexbox</code>布局</p>\n<ul>\n<li>设置一列宽度</li>\n</ul>\n<p><code>col-6</code>占6/12</p>\n<p><code>col-auto</code>可变宽度，随内容变化，变化的单位为1小格</p>\n<ul>\n<li>混合布局</li>\n</ul>\n<p><code>col-sm-6 col-lg-3</code>大屏时每行四个，中屏每行2个，小屏每行一个。</p>\n<ul>\n<li>对齐</li>\n</ul>\n<p>垂直对齐<code>align-items-center</code>、<code>align-items-xl-end</code></p>\n<p>水平对齐<code>justify-content-start/center/end/around/between</code></p>\n<ul>\n<li>消除内边距</li>\n</ul>\n<p><code>&lt;div class=&quot;row no-gutters&quot;&gt;</code></p>\n<ul>\n<li>排序</li>\n</ul>\n<p><code>order-*</code>*值越小排序越前。默认为0</p>\n<ul>\n<li>偏移</li>\n</ul>\n<p><code>offset-*</code>偏移*个格子，也可加断点</p>\n<ul>\n<li>margin移动</li>\n</ul>\n<p><code>mr-auto``ml-auto</code></p>\n<h1 id=\"2：排版\"><a href=\"#2：排版\" class=\"headerlink\" title=\"2：排版\"></a>2：排版</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    主标题<span class=\"tag\">&lt;<span class=\"name\">small</span>&gt;</span> 小号字体<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;display-1&quot;</span>&gt;</span>比标题字体大<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;leader&quot;</span>&gt;</span>变大强调<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">mark</span>&gt;</span>高亮<span class=\"tag\">&lt;/<span class=\"name\">mark</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>普通<span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;mark&quot;</span>&gt;</span>高亮<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>文本<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">del</span>&gt;</span>删除线<span class=\"tag\">&lt;/<span class=\"name\">del</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">s</span>&gt;</span>删除线<span class=\"tag\">&lt;/<span class=\"name\">s</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">ins</span>&gt;</span>下划线<span class=\"tag\">&lt;/<span class=\"name\">ins</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">u</span>&gt;</span>下划线<span class=\"tag\">&lt;/<span class=\"name\">u</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>粗体<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">b</span>&gt;</span>粗体<span class=\"tag\">&lt;/<span class=\"name\">b</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>斜体<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span>&gt;</span>斜体<span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">abbr</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;请输入你的邮箱&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;initialism&quot;</span>&gt;</span>email<span class=\"tag\">&lt;/<span class=\"name\">abbr</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">blockquote</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;blockquote&quot;</span>&gt;</span></span><br><span class=\"line\">    引用在此</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">blockquote</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">code</span>&gt;</span>代码块<span class=\"tag\">&lt;/<span class=\"name\">code</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">var</span>&gt;</span>变量斜体<span class=\"tag\">&lt;/<span class=\"name\">var</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">kbd</span>&gt;</span>用户输入，黑色背景白色字体<span class=\"tag\">&lt;/<span class=\"name\">kbd</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：图片和图片框\"><a href=\"#3：图片和图片框\" class=\"headerlink\" title=\"3：图片和图片框\"></a>3：图片和图片框</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../img/lg.img&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;img-fluid img-thumbnail w-100&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded float-left&quot;</span>&gt;</span>//圆角</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded float-right&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded d-block mx-auto&quot;</span>&gt;</span>//转为块级元素，然后居中对齐</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">picture</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">source</span> <span class=\"attr\">srcset</span>=<span class=\"string\">&quot;../images/lg.jpg&quot;</span> <span class=\"attr\">media</span>=<span class=\"string\">&quot;(min-width:992px)&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">source</span> <span class=\"attr\">srcset</span>=<span class=\"string\">&quot;../images/md.jpg&quot;</span> <span class=\"attr\">media</span>=<span class=\"string\">&quot;(min-width:576px)&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../images/sm.jpg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">picture</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--设置不同屏幕显示不同尺寸图片--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：表格\"><a href=\"#4：表格\" class=\"headerlink\" title=\"4：表格\"></a>4：表格</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;table-responsive&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;table&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>HeadingHeadingHeading<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>HeadingHeadingHeading<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>HeadingHeadingHeading<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>CellCellCell<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>CellCellCell<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>CellCellCell<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>条纹状表格：</strong>使用<code>.table-striped</code>样式定义<code>&lt;tbody&gt;</code>可以产生逐行交替变化的背景色。同<code>.table-dark</code>结合使用改变变化背景色为黑夜主题。</p>\n<p><strong>表格边框：</strong>使用<code>。table-bordered</code>产生表格边框与间隙。<code>table-borderless</code>无边界表格。</p>\n<p><strong>悬停效果：</strong><code>table-hover</code>悬停时，背景高亮。</p>\n<p><strong>缩紧表格</strong>：<code>table—sm</code>可以将表格padding值缩减为原来的一般。</p>\n<p><strong>Caption表格辅助标题：</strong><code>&lt;caption&gt;</code>默认是隐藏的，协助屏幕阅读用户找到表格，了解表格内容，并决定是否阅读它。</p>\n<p><strong>字体和背景色：</strong><code>table-dark、table-primary、table-secondary、table-warnung、table-success、table-danger、table-info</code>为浅色字体色，将<code>table</code>替换为<code>bg</code>则改为背景色。能加在tr或td上。</p>\n<p><strong>响应式滚动条：</strong>在<code>table</code>上层添加<code>&lt;div class=&quot;table-responsive&quot;&gt;</code></p>\n<h1 id=\"5：边框\"><a href=\"#5：边框\" class=\"headerlink\" title=\"5：边框\"></a>5：边框</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-top border-secondary rounded-top&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded-circle&quot;</span>&gt;</span>圆形或椭圆边框<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded-pill&quot;</span>&gt;</span>圆形或胶囊型<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>border-top-0</code>清除边框。</p>\n<h1 id=\"6：颜色—Display显示属性\"><a href=\"#6：颜色—Display显示属性\" class=\"headerlink\" title=\"6：颜色—Display显示属性\"></a>6：颜色—Display显示属性</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;d-inline&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;d-xl-none&quot;</span>&gt;</span>断点，当屏幕过大时不显示<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：入门例子\"><a href=\"#0：入门例子\" class=\"headerlink\" title=\"0：入门例子\"></a>0：入门例子</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Bootstrap<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>网站天下<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>hello-world<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>lang=&quot;zh-CN&quot;</code>修改网站文字为中文文字。</p>\n<p><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</code>设置网站为自适应屏幕尺寸网站，缩放比例为不缩放。</p>\n<p><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;css/bootstrap.min.css&quot;&gt;</code>导入本地bootstrap.css样式。</p>\n<h1 id=\"1：容器\"><a href=\"#1：容器\" class=\"headerlink\" title=\"1：容器\"></a>1：容器</h1><p><code>.container</code>+<code>tab</code>=<code>&lt;div class=&quot;container&quot;&gt;&lt;/div&gt;</code>固定宽度居中显示</p>\n<p><code>.container-fluid</code>全宽容器</p>\n<p>变化容器中一行一共包含12个格子。建立一个列表，每三个小格（col-xl-3）为一大格，需要一共4个大格可将其填满。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;row&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #0c5460&quot;</span>&gt;</span>111<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #005cbf&quot;</span>&gt;</span>222<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #1e7e34&quot;</span>&gt;</span>333<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;col-xl-3&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #6c757d&quot;</span>&gt;</span>444<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>栅格等级：</strong><code>col</code>特小、<code>col-sm-*</code>小、<code>col=md-*</code>中、<code>col-lg-*</code>大、<code>col-xl-*</code>超宽。</p>\n<p>各尺寸表示在不同尺寸屏幕上的显示方式，比如使用，<code>col-xl</code>则在屏幕宽度变为1000像素左右时，原来的栅格就换行显示，每个栅格占据一行。</p>\n<p>若直接使用<code>col</code>来修饰，那么，即便在很小的屏幕上，栅格也不会换行。相当于网页直接缩放。不推荐使用。</p>\n<p>栅格后的数字非必须。不添加数字则采用<code>flexbox</code>布局</p>\n<ul>\n<li>设置一列宽度</li>\n</ul>\n<p><code>col-6</code>占6/12</p>\n<p><code>col-auto</code>可变宽度，随内容变化，变化的单位为1小格</p>\n<ul>\n<li>混合布局</li>\n</ul>\n<p><code>col-sm-6 col-lg-3</code>大屏时每行四个，中屏每行2个，小屏每行一个。</p>\n<ul>\n<li>对齐</li>\n</ul>\n<p>垂直对齐<code>align-items-center</code>、<code>align-items-xl-end</code></p>\n<p>水平对齐<code>justify-content-start/center/end/around/between</code></p>\n<ul>\n<li>消除内边距</li>\n</ul>\n<p><code>&lt;div class=&quot;row no-gutters&quot;&gt;</code></p>\n<ul>\n<li>排序</li>\n</ul>\n<p><code>order-*</code>*值越小排序越前。默认为0</p>\n<ul>\n<li>偏移</li>\n</ul>\n<p><code>offset-*</code>偏移*个格子，也可加断点</p>\n<ul>\n<li>margin移动</li>\n</ul>\n<p><code>mr-auto``ml-auto</code></p>\n<h1 id=\"2：排版\"><a href=\"#2：排版\" class=\"headerlink\" title=\"2：排版\"></a>2：排版</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    主标题<span class=\"tag\">&lt;<span class=\"name\">small</span>&gt;</span> 小号字体<span class=\"tag\">&lt;/<span class=\"name\">small</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;display-1&quot;</span>&gt;</span>比标题字体大<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;leader&quot;</span>&gt;</span>变大强调<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">mark</span>&gt;</span>高亮<span class=\"tag\">&lt;/<span class=\"name\">mark</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>普通<span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;mark&quot;</span>&gt;</span>高亮<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>文本<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">del</span>&gt;</span>删除线<span class=\"tag\">&lt;/<span class=\"name\">del</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">s</span>&gt;</span>删除线<span class=\"tag\">&lt;/<span class=\"name\">s</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">ins</span>&gt;</span>下划线<span class=\"tag\">&lt;/<span class=\"name\">ins</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">u</span>&gt;</span>下划线<span class=\"tag\">&lt;/<span class=\"name\">u</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>粗体<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">b</span>&gt;</span>粗体<span class=\"tag\">&lt;/<span class=\"name\">b</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>斜体<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span>&gt;</span>斜体<span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">abbr</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;请输入你的邮箱&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;initialism&quot;</span>&gt;</span>email<span class=\"tag\">&lt;/<span class=\"name\">abbr</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">blockquote</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;blockquote&quot;</span>&gt;</span></span><br><span class=\"line\">    引用在此</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">blockquote</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">code</span>&gt;</span>代码块<span class=\"tag\">&lt;/<span class=\"name\">code</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">var</span>&gt;</span>变量斜体<span class=\"tag\">&lt;/<span class=\"name\">var</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">kbd</span>&gt;</span>用户输入，黑色背景白色字体<span class=\"tag\">&lt;/<span class=\"name\">kbd</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：图片和图片框\"><a href=\"#3：图片和图片框\" class=\"headerlink\" title=\"3：图片和图片框\"></a>3：图片和图片框</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../img/lg.img&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;img-fluid img-thumbnail w-100&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded float-left&quot;</span>&gt;</span>//圆角</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded float-right&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded d-block mx-auto&quot;</span>&gt;</span>//转为块级元素，然后居中对齐</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">picture</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">source</span> <span class=\"attr\">srcset</span>=<span class=\"string\">&quot;../images/lg.jpg&quot;</span> <span class=\"attr\">media</span>=<span class=\"string\">&quot;(min-width:992px)&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">source</span> <span class=\"attr\">srcset</span>=<span class=\"string\">&quot;../images/md.jpg&quot;</span> <span class=\"attr\">media</span>=<span class=\"string\">&quot;(min-width:576px)&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../images/sm.jpg&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">picture</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--设置不同屏幕显示不同尺寸图片--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：表格\"><a href=\"#4：表格\" class=\"headerlink\" title=\"4：表格\"></a>4：表格</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;table-responsive&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;table&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>HeadingHeadingHeading<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>HeadingHeadingHeading<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>HeadingHeadingHeading<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>CellCellCell<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>CellCellCell<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>CellCellCell<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>条纹状表格：</strong>使用<code>.table-striped</code>样式定义<code>&lt;tbody&gt;</code>可以产生逐行交替变化的背景色。同<code>.table-dark</code>结合使用改变变化背景色为黑夜主题。</p>\n<p><strong>表格边框：</strong>使用<code>。table-bordered</code>产生表格边框与间隙。<code>table-borderless</code>无边界表格。</p>\n<p><strong>悬停效果：</strong><code>table-hover</code>悬停时，背景高亮。</p>\n<p><strong>缩紧表格</strong>：<code>table—sm</code>可以将表格padding值缩减为原来的一般。</p>\n<p><strong>Caption表格辅助标题：</strong><code>&lt;caption&gt;</code>默认是隐藏的，协助屏幕阅读用户找到表格，了解表格内容，并决定是否阅读它。</p>\n<p><strong>字体和背景色：</strong><code>table-dark、table-primary、table-secondary、table-warnung、table-success、table-danger、table-info</code>为浅色字体色，将<code>table</code>替换为<code>bg</code>则改为背景色。能加在tr或td上。</p>\n<p><strong>响应式滚动条：</strong>在<code>table</code>上层添加<code>&lt;div class=&quot;table-responsive&quot;&gt;</code></p>\n<h1 id=\"5：边框\"><a href=\"#5：边框\" class=\"headerlink\" title=\"5：边框\"></a>5：边框</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;border-top border-secondary rounded-top&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded-circle&quot;</span>&gt;</span>圆形或椭圆边框<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;rounded-pill&quot;</span>&gt;</span>圆形或胶囊型<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>border-top-0</code>清除边框。</p>\n<h1 id=\"6：颜色—Display显示属性\"><a href=\"#6：颜色—Display显示属性\" class=\"headerlink\" title=\"6：颜色—Display显示属性\"></a>6：颜色—Display显示属性</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;d-inline&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;d-xl-none&quot;</span>&gt;</span>断点，当屏幕过大时不显示<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:49:05 GMT+0200 (GMT+02:00)","title":"Bootstrap学习笔记","path":"2020/03/01/Bootstrap学习笔记/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-03-01T15:34:13.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-03-01T15:34:13.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Bootstrap"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Flutter学习记录","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-02-15T16:32:32.000Z","password":null,"summary":"Flutter是一个基于手机编程的样式库，和网站前端类似，我们可以利用flutter设计好看的手机软件样式，并将它运用到安卓端或者IOS端。这极大的避免了，重复开发。","_content":"\n# 1：Flutter介绍\n\n- 市面上有很多混合开发框架，比如ReactNative、lonic，但都是针对前端开发。\n\n- Flutter针对全部开发者的混合框架。\n\n- 需要Dart语言基础。\n\n# 2：Flutter目录结构、入口、自定义Widget、Center等组件\n\n- 目录：ios，android，build，lib，text，pubspec.yaml（配置依赖），main.dart\n\n- 入口文件、方法：再main.dart中\n\n```dart\nimport 'package:flutter/material.dart';\n\nvoid main(){\n    runApp(new MyApp())//new 再Dart中可以省略\n}\n//void main()=>runApp(MyApp());\n//自定义组件\nclass MyApp extends StatelessWidget{\n    @override\n    Widget build(BuildContext context){\n        return MaterialApp(\n        \thome:Scaffold(\n        \t\tappBar:AppBar(\n                \ttitle:Text('Flutter Demo')\n                ),\n                body:HomeContent(),\n        \t),\n            theme:ThemeData(\n            \tprimarySwatch:Colors.blue\n            ),\n        )\n    }\n}\n\nclass HomeContent extends StatelessWidget{\n    @override\n    Widget build(BuildContext context){\n        return Center(//内容居中的LinearLayout\n    \t\tchild:Text(\n            \t'Hello Flutter'，\n            \ttextDirection:TextDirection.ltr,//文字方向从左到右\n                style:TextStyle(\n                \tfontSize:40.0,\n                    color:Colors.yellow,\n                    //color:Color.formRGBO(244,233,121,0.5),\n                ),\n        \t)\n    \t);\n    }\n}\n```\n\n# 3：Container组件、Text组件\n\n```dart\nimport 'package:flutter/material.dart';\n\nvoid main() => runApp(MyApp());\n\nclass MyApp extends StatelessWidget {\n  // This widget is the root of your application.\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      home:Scaffold(\n        appBar: AppBar(\n          title: Text(\"flutter demo\"),\n        ),\n        body: HomeContent(),\n      )\n    );\n  }\n}\n\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: Text('各位同学大家好，我是珠江老师阿发是否你好吗',\n        textAlign: TextAlign.left,\n        style: TextStyle(\n          fontSize: 16,\n          color: Colors.red,\n          fontWeight: FontWeight.w800,//加粗\n          fontStyle: FontStyle.italic,//斜线\n          decoration: TextDecoration.lineThrough,\n          decorationColor: Colors.white,\n          decorationStyle: TextDecorationStyle.dashed,\n          letterSpacing: 5\n        ),\n        overflow: TextOverflow.ellipsis,\n        maxLines: 2,\n        textScaleFactor: 1.2,//size scale 2 times\n        ),\n        height: 300,\n        width: 300,\n        decoration: BoxDecoration(\n          color: Colors.yellow,\n          border: Border.all(\n            color: Colors.blue,\n            width: 2\n          ),\n          borderRadius: BorderRadius.all(\n            Radius.circular(20)\n          )\n        ),\n        padding: EdgeInsets.all(10),\n        margin: EdgeInsets.all(10),\n        //transform: Matrix4.translationValues(100, 0, 0),\n        transform: Matrix4.rotationZ(0.3),\n        alignment: Alignment.bottomLeft,\n      ),\n    );\n  }\n  \n}\n```\n\n# 4：图片组件Image、本地图片、远程图片、图片裁剪\n\n## 4.1 网络图片和样式\n\n- 网络图片：\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: Image.network(\"https://i0.hdslb.com/bfs/archive/9377fda78c8a873085bd133e4fc54699ab56746d.jpg@336w_190h.webp\",\n          alignment: Alignment.center,\n          //color: Colors.yellow,\n          //colorBlendMode: BlendMode.screen,\n          fit: BoxFit.cover,//cover：拉伸剪切，但不变形。最常用\n          //repeat: ImageRepeat.repeatX,//X轴平铺\n        ),\n        width: 300,\n        height: 300,\n        decoration: BoxDecoration(\n          color: Colors.lightBlue\n        ),\n      ),\n    );\n  }\n```\n\n- 容器装饰图片\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        width: 300,\n        height: 300,\n        decoration: BoxDecoration(\n          color: Colors.lightBlue,\n          borderRadius: BorderRadius.circular(150),\n          image: DecorationImage(\n            image: NetworkImage(\"https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp\"),\n            fit: BoxFit.cover\n          )\n        ),\n      ),\n    );\n  }\n```\n\n- ClipOval\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: ClipOval(\n          child: Image.network(\"https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp\",\n            height: 100,\n            width: 100,\n            fit: BoxFit.cover,\n          ),\n        ),\n      ),\n    );\n  }\n  \n}\n```\n\n## 4.2 引入本地图片\n\n1. 在项目根目录下新建文件夹images\n\n- build\n- images\n  - 2.0x\n  - 3.0x\n  - 4.0x\n\n2. 在文件夹里放入图片，会根据屏幕分辨率配置不同图片\n3. 在pubspec.yaml中配置\n\n```yaml\nassets:\n- images/2.0x/a.jpeg\n- images/3.0x/a.jpeg\n```\n\n4. 在代码中使用\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: Image.asset('images/a.jpeg'),\n      ),\n    );\n  }\n```\n\n# 5：ListView组件\n\n## 5.1 基本列表\n\n- 垂直列表 ListTile组件\n\n```dart\n\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView(\n      padding: EdgeInsets.all(10),\n      children: <Widget>[\n        ListTile(\n          leading: Icon(Icons.settings,color: Colors.red,),//前置图标\n          title: Text(\"1你好列表组件\",style: TextStyle(\n            fontSize: 24\n          ),),\n          subtitle: Text(\"1你好我是二级标题\"),\n        ),\n        ListTile(\n          title: Text(\"1你好列表组件\"),\n          subtitle: Text(\"1你好我是二级标题\"),\n          trailing: Icon(Icons.home,size: 30,),//后置图标\n        ),\n        ListTile(\n          leading: Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n          title: Text(\"你好列表组件\"),\n          subtitle: Text(\"你好我是二级标题\"),\n        ),\n      ],\n    );\n  }\n  \n}\n```\n\n- 垂直图文列表\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView(\n      padding: EdgeInsets.all(10),\n      children: <Widget>[\n        Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n        Container(\n          child: Text(\"i am title\",textAlign: TextAlign.center,style: TextStyle(fontSize: 18),),\n          height: 40,\n          padding: EdgeInsets.fromLTRB(0, 10, 0, 10),\n        ),\n        Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n        Container(\n          child: Text(\"i am title\",textAlign: TextAlign.center,style: TextStyle(fontSize: 18),),\n          height: 40,\n          padding: EdgeInsets.fromLTRB(0, 10, 0, 10),\n        ),\n      ],\n    );\n  }\n}\n```\n\n- 水平列表\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Container(\n      height: 180,\n      child: ListView(\n        padding: EdgeInsets.all(10),\n        scrollDirection: Axis.horizontal,\n        children: <Widget>[\n          Container(\n            width: 180,\n            height: 180,\n            color: Colors.red,\n          ),\n          Container(\n            width: 180,\n            height: 180,\n            color: Colors.orange,\n            child: ListView(\n              children: <Widget>[\n                Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n                Text(\"i am text\")\n              ],\n            ),\n          ),\n          Container(\n            width: 180,\n            height: 180,\n            color: Colors.blue,\n          ),\n        ],\n      ),\n    );\n\n  }\n  \n}\n```\n\n**scrollDirection**\n\n## 5.2 ListView列表组件、动态列表\n\n- 展示一个列表中的数据\n\n```dart\nclass HomeContent extends StatelessWidget{\n  //自定义方法\n  List<Widget> _getData(){\n    List<Widget> list=new List();\n    for(var i=0;i<20;i++){\n      list.add(ListTile(\n        title: Text(\"iam $i list\"),\n      ));\n    }\n    return list;\n  }\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView(\n      children: _getData()\n    );\n  }\n  \n}\n```\n\n- ListView.builder\n\n```dart\nclass HomeContent extends StatelessWidget{\n\n  List list=new List();\n  HomeContent(){\n    for(var i=0;i<20;i++) {\n      list.add(ListTile(\n        title: Text(\"iam $i list\"),\n      ));\n    }\n  }\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView.builder(\n        itemCount: this.list.length,\n        itemBuilder: (context,index){\n          return ListTile(\n            title: Text(this.list[index]),\n          );\n        }\n    );\n  }\n}\n```\n\n","source":"_posts/Flutter学习记录.md","raw":"---\n\ntitle: Flutter学习记录\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-02-15 17:32:32\npassword:\nsummary: Flutter是一个基于手机编程的样式库，和网站前端类似，我们可以利用flutter设计好看的手机软件样式，并将它运用到安卓端或者IOS端。这极大的避免了，重复开发。\ntags: Flutter\ncategories: 学习笔记\n---\n\n# 1：Flutter介绍\n\n- 市面上有很多混合开发框架，比如ReactNative、lonic，但都是针对前端开发。\n\n- Flutter针对全部开发者的混合框架。\n\n- 需要Dart语言基础。\n\n# 2：Flutter目录结构、入口、自定义Widget、Center等组件\n\n- 目录：ios，android，build，lib，text，pubspec.yaml（配置依赖），main.dart\n\n- 入口文件、方法：再main.dart中\n\n```dart\nimport 'package:flutter/material.dart';\n\nvoid main(){\n    runApp(new MyApp())//new 再Dart中可以省略\n}\n//void main()=>runApp(MyApp());\n//自定义组件\nclass MyApp extends StatelessWidget{\n    @override\n    Widget build(BuildContext context){\n        return MaterialApp(\n        \thome:Scaffold(\n        \t\tappBar:AppBar(\n                \ttitle:Text('Flutter Demo')\n                ),\n                body:HomeContent(),\n        \t),\n            theme:ThemeData(\n            \tprimarySwatch:Colors.blue\n            ),\n        )\n    }\n}\n\nclass HomeContent extends StatelessWidget{\n    @override\n    Widget build(BuildContext context){\n        return Center(//内容居中的LinearLayout\n    \t\tchild:Text(\n            \t'Hello Flutter'，\n            \ttextDirection:TextDirection.ltr,//文字方向从左到右\n                style:TextStyle(\n                \tfontSize:40.0,\n                    color:Colors.yellow,\n                    //color:Color.formRGBO(244,233,121,0.5),\n                ),\n        \t)\n    \t);\n    }\n}\n```\n\n# 3：Container组件、Text组件\n\n```dart\nimport 'package:flutter/material.dart';\n\nvoid main() => runApp(MyApp());\n\nclass MyApp extends StatelessWidget {\n  // This widget is the root of your application.\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      home:Scaffold(\n        appBar: AppBar(\n          title: Text(\"flutter demo\"),\n        ),\n        body: HomeContent(),\n      )\n    );\n  }\n}\n\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: Text('各位同学大家好，我是珠江老师阿发是否你好吗',\n        textAlign: TextAlign.left,\n        style: TextStyle(\n          fontSize: 16,\n          color: Colors.red,\n          fontWeight: FontWeight.w800,//加粗\n          fontStyle: FontStyle.italic,//斜线\n          decoration: TextDecoration.lineThrough,\n          decorationColor: Colors.white,\n          decorationStyle: TextDecorationStyle.dashed,\n          letterSpacing: 5\n        ),\n        overflow: TextOverflow.ellipsis,\n        maxLines: 2,\n        textScaleFactor: 1.2,//size scale 2 times\n        ),\n        height: 300,\n        width: 300,\n        decoration: BoxDecoration(\n          color: Colors.yellow,\n          border: Border.all(\n            color: Colors.blue,\n            width: 2\n          ),\n          borderRadius: BorderRadius.all(\n            Radius.circular(20)\n          )\n        ),\n        padding: EdgeInsets.all(10),\n        margin: EdgeInsets.all(10),\n        //transform: Matrix4.translationValues(100, 0, 0),\n        transform: Matrix4.rotationZ(0.3),\n        alignment: Alignment.bottomLeft,\n      ),\n    );\n  }\n  \n}\n```\n\n# 4：图片组件Image、本地图片、远程图片、图片裁剪\n\n## 4.1 网络图片和样式\n\n- 网络图片：\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: Image.network(\"https://i0.hdslb.com/bfs/archive/9377fda78c8a873085bd133e4fc54699ab56746d.jpg@336w_190h.webp\",\n          alignment: Alignment.center,\n          //color: Colors.yellow,\n          //colorBlendMode: BlendMode.screen,\n          fit: BoxFit.cover,//cover：拉伸剪切，但不变形。最常用\n          //repeat: ImageRepeat.repeatX,//X轴平铺\n        ),\n        width: 300,\n        height: 300,\n        decoration: BoxDecoration(\n          color: Colors.lightBlue\n        ),\n      ),\n    );\n  }\n```\n\n- 容器装饰图片\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        width: 300,\n        height: 300,\n        decoration: BoxDecoration(\n          color: Colors.lightBlue,\n          borderRadius: BorderRadius.circular(150),\n          image: DecorationImage(\n            image: NetworkImage(\"https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp\"),\n            fit: BoxFit.cover\n          )\n        ),\n      ),\n    );\n  }\n```\n\n- ClipOval\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: ClipOval(\n          child: Image.network(\"https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp\",\n            height: 100,\n            width: 100,\n            fit: BoxFit.cover,\n          ),\n        ),\n      ),\n    );\n  }\n  \n}\n```\n\n## 4.2 引入本地图片\n\n1. 在项目根目录下新建文件夹images\n\n- build\n- images\n  - 2.0x\n  - 3.0x\n  - 4.0x\n\n2. 在文件夹里放入图片，会根据屏幕分辨率配置不同图片\n3. 在pubspec.yaml中配置\n\n```yaml\nassets:\n- images/2.0x/a.jpeg\n- images/3.0x/a.jpeg\n```\n\n4. 在代码中使用\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Center(\n      child: Container(\n        child: Image.asset('images/a.jpeg'),\n      ),\n    );\n  }\n```\n\n# 5：ListView组件\n\n## 5.1 基本列表\n\n- 垂直列表 ListTile组件\n\n```dart\n\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView(\n      padding: EdgeInsets.all(10),\n      children: <Widget>[\n        ListTile(\n          leading: Icon(Icons.settings,color: Colors.red,),//前置图标\n          title: Text(\"1你好列表组件\",style: TextStyle(\n            fontSize: 24\n          ),),\n          subtitle: Text(\"1你好我是二级标题\"),\n        ),\n        ListTile(\n          title: Text(\"1你好列表组件\"),\n          subtitle: Text(\"1你好我是二级标题\"),\n          trailing: Icon(Icons.home,size: 30,),//后置图标\n        ),\n        ListTile(\n          leading: Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n          title: Text(\"你好列表组件\"),\n          subtitle: Text(\"你好我是二级标题\"),\n        ),\n      ],\n    );\n  }\n  \n}\n```\n\n- 垂直图文列表\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView(\n      padding: EdgeInsets.all(10),\n      children: <Widget>[\n        Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n        Container(\n          child: Text(\"i am title\",textAlign: TextAlign.center,style: TextStyle(fontSize: 18),),\n          height: 40,\n          padding: EdgeInsets.fromLTRB(0, 10, 0, 10),\n        ),\n        Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n        Container(\n          child: Text(\"i am title\",textAlign: TextAlign.center,style: TextStyle(fontSize: 18),),\n          height: 40,\n          padding: EdgeInsets.fromLTRB(0, 10, 0, 10),\n        ),\n      ],\n    );\n  }\n}\n```\n\n- 水平列表\n\n```dart\nclass HomeContent extends StatelessWidget{\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return Container(\n      height: 180,\n      child: ListView(\n        padding: EdgeInsets.all(10),\n        scrollDirection: Axis.horizontal,\n        children: <Widget>[\n          Container(\n            width: 180,\n            height: 180,\n            color: Colors.red,\n          ),\n          Container(\n            width: 180,\n            height: 180,\n            color: Colors.orange,\n            child: ListView(\n              children: <Widget>[\n                Image.network(\"https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg\"),\n                Text(\"i am text\")\n              ],\n            ),\n          ),\n          Container(\n            width: 180,\n            height: 180,\n            color: Colors.blue,\n          ),\n        ],\n      ),\n    );\n\n  }\n  \n}\n```\n\n**scrollDirection**\n\n## 5.2 ListView列表组件、动态列表\n\n- 展示一个列表中的数据\n\n```dart\nclass HomeContent extends StatelessWidget{\n  //自定义方法\n  List<Widget> _getData(){\n    List<Widget> list=new List();\n    for(var i=0;i<20;i++){\n      list.add(ListTile(\n        title: Text(\"iam $i list\"),\n      ));\n    }\n    return list;\n  }\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView(\n      children: _getData()\n    );\n  }\n  \n}\n```\n\n- ListView.builder\n\n```dart\nclass HomeContent extends StatelessWidget{\n\n  List list=new List();\n  HomeContent(){\n    for(var i=0;i<20;i++) {\n      list.add(ListTile(\n        title: Text(\"iam $i list\"),\n      ));\n    }\n  }\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return ListView.builder(\n        itemCount: this.list.length,\n        itemBuilder: (context,index){\n          return ListTile(\n            title: Text(this.list[index]),\n          );\n        }\n    );\n  }\n}\n```\n\n","slug":"Flutter学习记录","published":1,"updated":"2020-06-20T06:48:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaao0009p0vz7glj3ixx","content":"<h1 id=\"1：Flutter介绍\"><a href=\"#1：Flutter介绍\" class=\"headerlink\" title=\"1：Flutter介绍\"></a>1：Flutter介绍</h1><ul>\n<li><p>市面上有很多混合开发框架，比如ReactNative、lonic，但都是针对前端开发。</p>\n</li>\n<li><p>Flutter针对全部开发者的混合框架。</p>\n</li>\n<li><p>需要Dart语言基础。</p>\n</li>\n</ul>\n<h1 id=\"2：Flutter目录结构、入口、自定义Widget、Center等组件\"><a href=\"#2：Flutter目录结构、入口、自定义Widget、Center等组件\" class=\"headerlink\" title=\"2：Flutter目录结构、入口、自定义Widget、Center等组件\"></a>2：Flutter目录结构、入口、自定义Widget、Center等组件</h1><ul>\n<li><p>目录：ios，android，build，lib，text，pubspec.yaml（配置依赖），main.dart</p>\n</li>\n<li><p>入口文件、方法：再main.dart中</p>\n</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main()&#123;</span><br><span class=\"line\">    runApp(<span class=\"keyword\">new</span> MyApp())<span class=\"comment\">//new 再Dart中可以省略</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//void main()=&gt;runApp(MyApp());</span></span><br><span class=\"line\"><span class=\"comment\">//自定义组件</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@override</span></span><br><span class=\"line\">    Widget build(BuildContext context)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">        \thome:Scaffold(</span><br><span class=\"line\">        \t\tappBar:AppBar(</span><br><span class=\"line\">                \ttitle:Text(<span class=\"string\">&#x27;Flutter Demo&#x27;</span>)</span><br><span class=\"line\">                ),</span><br><span class=\"line\">                body:HomeContent(),</span><br><span class=\"line\">        \t),</span><br><span class=\"line\">            theme:ThemeData(</span><br><span class=\"line\">            \tprimarySwatch:Colors.blue</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@override</span></span><br><span class=\"line\">    Widget build(BuildContext context)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Center(<span class=\"comment\">//内容居中的LinearLayout</span></span><br><span class=\"line\">    \t\tchild:Text(</span><br><span class=\"line\">            \t<span class=\"string\">&#x27;Hello Flutter&#x27;</span>，</span><br><span class=\"line\">            \ttextDirection:TextDirection.ltr,<span class=\"comment\">//文字方向从左到右</span></span><br><span class=\"line\">                style:TextStyle(</span><br><span class=\"line\">                \tfontSize:<span class=\"number\">40.0</span>,</span><br><span class=\"line\">                    color:Colors.yellow,</span><br><span class=\"line\">                    <span class=\"comment\">//color:Color.formRGBO(244,233,121,0.5),</span></span><br><span class=\"line\">                ),</span><br><span class=\"line\">        \t)</span><br><span class=\"line\">    \t);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：Container组件、Text组件\"><a href=\"#3：Container组件、Text组件\" class=\"headerlink\" title=\"3：Container组件、Text组件\"></a>3：Container组件、Text组件</h1><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// This widget is the root of your application.</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home:Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;flutter demo&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: HomeContent(),</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: Text(<span class=\"string\">&#x27;各位同学大家好，我是珠江老师阿发是否你好吗&#x27;</span>,</span><br><span class=\"line\">        textAlign: TextAlign.left,</span><br><span class=\"line\">        style: TextStyle(</span><br><span class=\"line\">          fontSize: <span class=\"number\">16</span>,</span><br><span class=\"line\">          color: Colors.red,</span><br><span class=\"line\">          fontWeight: FontWeight.w800,<span class=\"comment\">//加粗</span></span><br><span class=\"line\">          fontStyle: FontStyle.italic,<span class=\"comment\">//斜线</span></span><br><span class=\"line\">          decoration: TextDecoration.lineThrough,</span><br><span class=\"line\">          decorationColor: Colors.white,</span><br><span class=\"line\">          decorationStyle: TextDecorationStyle.dashed,</span><br><span class=\"line\">          letterSpacing: <span class=\"number\">5</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        overflow: TextOverflow.ellipsis,</span><br><span class=\"line\">        maxLines: <span class=\"number\">2</span>,</span><br><span class=\"line\">        textScaleFactor: <span class=\"number\">1.2</span>,<span class=\"comment\">//size scale 2 times</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        height: <span class=\"number\">300</span>,</span><br><span class=\"line\">        width: <span class=\"number\">300</span>,</span><br><span class=\"line\">        decoration: BoxDecoration(</span><br><span class=\"line\">          color: Colors.yellow,</span><br><span class=\"line\">          border: Border.all(</span><br><span class=\"line\">            color: Colors.blue,</span><br><span class=\"line\">            width: <span class=\"number\">2</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          borderRadius: BorderRadius.all(</span><br><span class=\"line\">            Radius.circular(<span class=\"number\">20</span>)</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">        margin: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">        <span class=\"comment\">//transform: Matrix4.translationValues(100, 0, 0),</span></span><br><span class=\"line\">        transform: Matrix4.rotationZ(<span class=\"number\">0.3</span>),</span><br><span class=\"line\">        alignment: Alignment.bottomLeft,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：图片组件Image、本地图片、远程图片、图片裁剪\"><a href=\"#4：图片组件Image、本地图片、远程图片、图片裁剪\" class=\"headerlink\" title=\"4：图片组件Image、本地图片、远程图片、图片裁剪\"></a>4：图片组件Image、本地图片、远程图片、图片裁剪</h1><h2 id=\"4-1-网络图片和样式\"><a href=\"#4-1-网络图片和样式\" class=\"headerlink\" title=\"4.1 网络图片和样式\"></a>4.1 网络图片和样式</h2><ul>\n<li>网络图片：</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/archive/9377fda78c8a873085bd133e4fc54699ab56746d.jpg@336w_190h.webp&quot;</span>,</span><br><span class=\"line\">          alignment: Alignment.center,</span><br><span class=\"line\">          <span class=\"comment\">//color: Colors.yellow,</span></span><br><span class=\"line\">          <span class=\"comment\">//colorBlendMode: BlendMode.screen,</span></span><br><span class=\"line\">          fit: BoxFit.cover,<span class=\"comment\">//cover：拉伸剪切，但不变形。最常用</span></span><br><span class=\"line\">          <span class=\"comment\">//repeat: ImageRepeat.repeatX,//X轴平铺</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        width: <span class=\"number\">300</span>,</span><br><span class=\"line\">        height: <span class=\"number\">300</span>,</span><br><span class=\"line\">        decoration: BoxDecoration(</span><br><span class=\"line\">          color: Colors.lightBlue</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>容器装饰图片</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        width: <span class=\"number\">300</span>,</span><br><span class=\"line\">        height: <span class=\"number\">300</span>,</span><br><span class=\"line\">        decoration: BoxDecoration(</span><br><span class=\"line\">          color: Colors.lightBlue,</span><br><span class=\"line\">          borderRadius: BorderRadius.circular(<span class=\"number\">150</span>),</span><br><span class=\"line\">          image: DecorationImage(</span><br><span class=\"line\">            image: NetworkImage(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp&quot;</span>),</span><br><span class=\"line\">            fit: BoxFit.cover</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ClipOval</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: ClipOval(</span><br><span class=\"line\">          child: Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp&quot;</span>,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">            width: <span class=\"number\">100</span>,</span><br><span class=\"line\">            fit: BoxFit.cover,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-引入本地图片\"><a href=\"#4-2-引入本地图片\" class=\"headerlink\" title=\"4.2 引入本地图片\"></a>4.2 引入本地图片</h2><ol>\n<li>在项目根目录下新建文件夹images</li>\n</ol>\n<ul>\n<li>build</li>\n<li>images<ul>\n<li>2.0x</li>\n<li>3.0x</li>\n<li>4.0x</li>\n</ul>\n</li>\n</ul>\n<ol start=\"2\">\n<li>在文件夹里放入图片，会根据屏幕分辨率配置不同图片</li>\n<li>在pubspec.yaml中配置</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">assets:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">images/2.0x/a.jpeg</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">images/3.0x/a.jpeg</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>在代码中使用</li>\n</ol>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: Image.asset(<span class=\"string\">&#x27;images/a.jpeg&#x27;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：ListView组件\"><a href=\"#5：ListView组件\" class=\"headerlink\" title=\"5：ListView组件\"></a>5：ListView组件</h1><h2 id=\"5-1-基本列表\"><a href=\"#5-1-基本列表\" class=\"headerlink\" title=\"5.1 基本列表\"></a>5.1 基本列表</h2><ul>\n<li>垂直列表 ListTile组件</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView(</span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">      children: &lt;Widget&gt;[</span><br><span class=\"line\">        ListTile(</span><br><span class=\"line\">          leading: Icon(Icons.settings,color: Colors.red,),<span class=\"comment\">//前置图标</span></span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;1你好列表组件&quot;</span>,style: TextStyle(</span><br><span class=\"line\">            fontSize: <span class=\"number\">24</span></span><br><span class=\"line\">          ),),</span><br><span class=\"line\">          subtitle: Text(<span class=\"string\">&quot;1你好我是二级标题&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        ListTile(</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;1你好列表组件&quot;</span>),</span><br><span class=\"line\">          subtitle: Text(<span class=\"string\">&quot;1你好我是二级标题&quot;</span>),</span><br><span class=\"line\">          trailing: Icon(Icons.home,size: <span class=\"number\">30</span>,),<span class=\"comment\">//后置图标</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        ListTile(</span><br><span class=\"line\">          leading: Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;你好列表组件&quot;</span>),</span><br><span class=\"line\">          subtitle: Text(<span class=\"string\">&quot;你好我是二级标题&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>垂直图文列表</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView(</span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">      children: &lt;Widget&gt;[</span><br><span class=\"line\">        Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          child: Text(<span class=\"string\">&quot;i am title&quot;</span>,textAlign: TextAlign.center,style: TextStyle(fontSize: <span class=\"number\">18</span>),),</span><br><span class=\"line\">          height: <span class=\"number\">40</span>,</span><br><span class=\"line\">          padding: EdgeInsets.fromLTRB(<span class=\"number\">0</span>, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          child: Text(<span class=\"string\">&quot;i am title&quot;</span>,textAlign: TextAlign.center,style: TextStyle(fontSize: <span class=\"number\">18</span>),),</span><br><span class=\"line\">          height: <span class=\"number\">40</span>,</span><br><span class=\"line\">          padding: EdgeInsets.fromLTRB(<span class=\"number\">0</span>, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>水平列表</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      height: <span class=\"number\">180</span>,</span><br><span class=\"line\">      child: ListView(</span><br><span class=\"line\">        padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">        scrollDirection: Axis.horizontal,</span><br><span class=\"line\">        children: &lt;Widget&gt;[</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"number\">180</span>,</span><br><span class=\"line\">            height: <span class=\"number\">180</span>,</span><br><span class=\"line\">            color: Colors.red,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"number\">180</span>,</span><br><span class=\"line\">            height: <span class=\"number\">180</span>,</span><br><span class=\"line\">            color: Colors.orange,</span><br><span class=\"line\">            child: ListView(</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">                Text(<span class=\"string\">&quot;i am text&quot;</span>)</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"number\">180</span>,</span><br><span class=\"line\">            height: <span class=\"number\">180</span>,</span><br><span class=\"line\">            color: Colors.blue,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>scrollDirection</strong></p>\n<h2 id=\"5-2-ListView列表组件、动态列表\"><a href=\"#5-2-ListView列表组件、动态列表\" class=\"headerlink\" title=\"5.2 ListView列表组件、动态列表\"></a>5.2 ListView列表组件、动态列表</h2><ul>\n<li>展示一个列表中的数据</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//自定义方法</span></span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;Widget&gt; _getData()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">List</span>&lt;Widget&gt; list=<span class=\"keyword\">new</span> <span class=\"built_in\">List</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++)&#123;</span><br><span class=\"line\">      list.add(ListTile(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;iam <span class=\"subst\">$i</span> list&quot;</span>),</span><br><span class=\"line\">      ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView(</span><br><span class=\"line\">      children: _getData()</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ListView.builder</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">List</span> list=<span class=\"keyword\">new</span> <span class=\"built_in\">List</span>();</span><br><span class=\"line\">  HomeContent()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++) &#123;</span><br><span class=\"line\">      list.add(ListTile(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;iam <span class=\"subst\">$i</span> list&quot;</span>),</span><br><span class=\"line\">      ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView.builder(</span><br><span class=\"line\">        itemCount: <span class=\"keyword\">this</span>.list.length,</span><br><span class=\"line\">        itemBuilder: (context,index)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> ListTile(</span><br><span class=\"line\">            title: Text(<span class=\"keyword\">this</span>.list[index]),</span><br><span class=\"line\">          );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：Flutter介绍\"><a href=\"#1：Flutter介绍\" class=\"headerlink\" title=\"1：Flutter介绍\"></a>1：Flutter介绍</h1><ul>\n<li><p>市面上有很多混合开发框架，比如ReactNative、lonic，但都是针对前端开发。</p>\n</li>\n<li><p>Flutter针对全部开发者的混合框架。</p>\n</li>\n<li><p>需要Dart语言基础。</p>\n</li>\n</ul>\n<h1 id=\"2：Flutter目录结构、入口、自定义Widget、Center等组件\"><a href=\"#2：Flutter目录结构、入口、自定义Widget、Center等组件\" class=\"headerlink\" title=\"2：Flutter目录结构、入口、自定义Widget、Center等组件\"></a>2：Flutter目录结构、入口、自定义Widget、Center等组件</h1><ul>\n<li><p>目录：ios，android，build，lib，text，pubspec.yaml（配置依赖），main.dart</p>\n</li>\n<li><p>入口文件、方法：再main.dart中</p>\n</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main()&#123;</span><br><span class=\"line\">    runApp(<span class=\"keyword\">new</span> MyApp())<span class=\"comment\">//new 再Dart中可以省略</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//void main()=&gt;runApp(MyApp());</span></span><br><span class=\"line\"><span class=\"comment\">//自定义组件</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@override</span></span><br><span class=\"line\">    Widget build(BuildContext context)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">        \thome:Scaffold(</span><br><span class=\"line\">        \t\tappBar:AppBar(</span><br><span class=\"line\">                \ttitle:Text(<span class=\"string\">&#x27;Flutter Demo&#x27;</span>)</span><br><span class=\"line\">                ),</span><br><span class=\"line\">                body:HomeContent(),</span><br><span class=\"line\">        \t),</span><br><span class=\"line\">            theme:ThemeData(</span><br><span class=\"line\">            \tprimarySwatch:Colors.blue</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@override</span></span><br><span class=\"line\">    Widget build(BuildContext context)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Center(<span class=\"comment\">//内容居中的LinearLayout</span></span><br><span class=\"line\">    \t\tchild:Text(</span><br><span class=\"line\">            \t<span class=\"string\">&#x27;Hello Flutter&#x27;</span>，</span><br><span class=\"line\">            \ttextDirection:TextDirection.ltr,<span class=\"comment\">//文字方向从左到右</span></span><br><span class=\"line\">                style:TextStyle(</span><br><span class=\"line\">                \tfontSize:<span class=\"number\">40.0</span>,</span><br><span class=\"line\">                    color:Colors.yellow,</span><br><span class=\"line\">                    <span class=\"comment\">//color:Color.formRGBO(244,233,121,0.5),</span></span><br><span class=\"line\">                ),</span><br><span class=\"line\">        \t)</span><br><span class=\"line\">    \t);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：Container组件、Text组件\"><a href=\"#3：Container组件、Text组件\" class=\"headerlink\" title=\"3：Container组件、Text组件\"></a>3：Container组件、Text组件</h1><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// This widget is the root of your application.</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home:Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;flutter demo&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: HomeContent(),</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: Text(<span class=\"string\">&#x27;各位同学大家好，我是珠江老师阿发是否你好吗&#x27;</span>,</span><br><span class=\"line\">        textAlign: TextAlign.left,</span><br><span class=\"line\">        style: TextStyle(</span><br><span class=\"line\">          fontSize: <span class=\"number\">16</span>,</span><br><span class=\"line\">          color: Colors.red,</span><br><span class=\"line\">          fontWeight: FontWeight.w800,<span class=\"comment\">//加粗</span></span><br><span class=\"line\">          fontStyle: FontStyle.italic,<span class=\"comment\">//斜线</span></span><br><span class=\"line\">          decoration: TextDecoration.lineThrough,</span><br><span class=\"line\">          decorationColor: Colors.white,</span><br><span class=\"line\">          decorationStyle: TextDecorationStyle.dashed,</span><br><span class=\"line\">          letterSpacing: <span class=\"number\">5</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        overflow: TextOverflow.ellipsis,</span><br><span class=\"line\">        maxLines: <span class=\"number\">2</span>,</span><br><span class=\"line\">        textScaleFactor: <span class=\"number\">1.2</span>,<span class=\"comment\">//size scale 2 times</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        height: <span class=\"number\">300</span>,</span><br><span class=\"line\">        width: <span class=\"number\">300</span>,</span><br><span class=\"line\">        decoration: BoxDecoration(</span><br><span class=\"line\">          color: Colors.yellow,</span><br><span class=\"line\">          border: Border.all(</span><br><span class=\"line\">            color: Colors.blue,</span><br><span class=\"line\">            width: <span class=\"number\">2</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          borderRadius: BorderRadius.all(</span><br><span class=\"line\">            Radius.circular(<span class=\"number\">20</span>)</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">        margin: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">        <span class=\"comment\">//transform: Matrix4.translationValues(100, 0, 0),</span></span><br><span class=\"line\">        transform: Matrix4.rotationZ(<span class=\"number\">0.3</span>),</span><br><span class=\"line\">        alignment: Alignment.bottomLeft,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：图片组件Image、本地图片、远程图片、图片裁剪\"><a href=\"#4：图片组件Image、本地图片、远程图片、图片裁剪\" class=\"headerlink\" title=\"4：图片组件Image、本地图片、远程图片、图片裁剪\"></a>4：图片组件Image、本地图片、远程图片、图片裁剪</h1><h2 id=\"4-1-网络图片和样式\"><a href=\"#4-1-网络图片和样式\" class=\"headerlink\" title=\"4.1 网络图片和样式\"></a>4.1 网络图片和样式</h2><ul>\n<li>网络图片：</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/archive/9377fda78c8a873085bd133e4fc54699ab56746d.jpg@336w_190h.webp&quot;</span>,</span><br><span class=\"line\">          alignment: Alignment.center,</span><br><span class=\"line\">          <span class=\"comment\">//color: Colors.yellow,</span></span><br><span class=\"line\">          <span class=\"comment\">//colorBlendMode: BlendMode.screen,</span></span><br><span class=\"line\">          fit: BoxFit.cover,<span class=\"comment\">//cover：拉伸剪切，但不变形。最常用</span></span><br><span class=\"line\">          <span class=\"comment\">//repeat: ImageRepeat.repeatX,//X轴平铺</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        width: <span class=\"number\">300</span>,</span><br><span class=\"line\">        height: <span class=\"number\">300</span>,</span><br><span class=\"line\">        decoration: BoxDecoration(</span><br><span class=\"line\">          color: Colors.lightBlue</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>容器装饰图片</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        width: <span class=\"number\">300</span>,</span><br><span class=\"line\">        height: <span class=\"number\">300</span>,</span><br><span class=\"line\">        decoration: BoxDecoration(</span><br><span class=\"line\">          color: Colors.lightBlue,</span><br><span class=\"line\">          borderRadius: BorderRadius.circular(<span class=\"number\">150</span>),</span><br><span class=\"line\">          image: DecorationImage(</span><br><span class=\"line\">            image: NetworkImage(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp&quot;</span>),</span><br><span class=\"line\">            fit: BoxFit.cover</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ClipOval</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: ClipOval(</span><br><span class=\"line\">          child: Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp&quot;</span>,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">            width: <span class=\"number\">100</span>,</span><br><span class=\"line\">            fit: BoxFit.cover,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-引入本地图片\"><a href=\"#4-2-引入本地图片\" class=\"headerlink\" title=\"4.2 引入本地图片\"></a>4.2 引入本地图片</h2><ol>\n<li>在项目根目录下新建文件夹images</li>\n</ol>\n<ul>\n<li>build</li>\n<li>images<ul>\n<li>2.0x</li>\n<li>3.0x</li>\n<li>4.0x</li>\n</ul>\n</li>\n</ul>\n<ol start=\"2\">\n<li>在文件夹里放入图片，会根据屏幕分辨率配置不同图片</li>\n<li>在pubspec.yaml中配置</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">assets:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">images/2.0x/a.jpeg</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">images/3.0x/a.jpeg</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>在代码中使用</li>\n</ol>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        child: Image.asset(<span class=\"string\">&#x27;images/a.jpeg&#x27;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：ListView组件\"><a href=\"#5：ListView组件\" class=\"headerlink\" title=\"5：ListView组件\"></a>5：ListView组件</h1><h2 id=\"5-1-基本列表\"><a href=\"#5-1-基本列表\" class=\"headerlink\" title=\"5.1 基本列表\"></a>5.1 基本列表</h2><ul>\n<li>垂直列表 ListTile组件</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView(</span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">      children: &lt;Widget&gt;[</span><br><span class=\"line\">        ListTile(</span><br><span class=\"line\">          leading: Icon(Icons.settings,color: Colors.red,),<span class=\"comment\">//前置图标</span></span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;1你好列表组件&quot;</span>,style: TextStyle(</span><br><span class=\"line\">            fontSize: <span class=\"number\">24</span></span><br><span class=\"line\">          ),),</span><br><span class=\"line\">          subtitle: Text(<span class=\"string\">&quot;1你好我是二级标题&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        ListTile(</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;1你好列表组件&quot;</span>),</span><br><span class=\"line\">          subtitle: Text(<span class=\"string\">&quot;1你好我是二级标题&quot;</span>),</span><br><span class=\"line\">          trailing: Icon(Icons.home,size: <span class=\"number\">30</span>,),<span class=\"comment\">//后置图标</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        ListTile(</span><br><span class=\"line\">          leading: Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;你好列表组件&quot;</span>),</span><br><span class=\"line\">          subtitle: Text(<span class=\"string\">&quot;你好我是二级标题&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>垂直图文列表</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView(</span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">      children: &lt;Widget&gt;[</span><br><span class=\"line\">        Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          child: Text(<span class=\"string\">&quot;i am title&quot;</span>,textAlign: TextAlign.center,style: TextStyle(fontSize: <span class=\"number\">18</span>),),</span><br><span class=\"line\">          height: <span class=\"number\">40</span>,</span><br><span class=\"line\">          padding: EdgeInsets.fromLTRB(<span class=\"number\">0</span>, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          child: Text(<span class=\"string\">&quot;i am title&quot;</span>,textAlign: TextAlign.center,style: TextStyle(fontSize: <span class=\"number\">18</span>),),</span><br><span class=\"line\">          height: <span class=\"number\">40</span>,</span><br><span class=\"line\">          padding: EdgeInsets.fromLTRB(<span class=\"number\">0</span>, <span class=\"number\">10</span>, <span class=\"number\">0</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>水平列表</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      height: <span class=\"number\">180</span>,</span><br><span class=\"line\">      child: ListView(</span><br><span class=\"line\">        padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">        scrollDirection: Axis.horizontal,</span><br><span class=\"line\">        children: &lt;Widget&gt;[</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"number\">180</span>,</span><br><span class=\"line\">            height: <span class=\"number\">180</span>,</span><br><span class=\"line\">            color: Colors.red,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"number\">180</span>,</span><br><span class=\"line\">            height: <span class=\"number\">180</span>,</span><br><span class=\"line\">            color: Colors.orange,</span><br><span class=\"line\">            child: ListView(</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                Image.network(<span class=\"string\">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class=\"line\">                Text(<span class=\"string\">&quot;i am text&quot;</span>)</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"number\">180</span>,</span><br><span class=\"line\">            height: <span class=\"number\">180</span>,</span><br><span class=\"line\">            color: Colors.blue,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>scrollDirection</strong></p>\n<h2 id=\"5-2-ListView列表组件、动态列表\"><a href=\"#5-2-ListView列表组件、动态列表\" class=\"headerlink\" title=\"5.2 ListView列表组件、动态列表\"></a>5.2 ListView列表组件、动态列表</h2><ul>\n<li>展示一个列表中的数据</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//自定义方法</span></span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;Widget&gt; _getData()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">List</span>&lt;Widget&gt; list=<span class=\"keyword\">new</span> <span class=\"built_in\">List</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++)&#123;</span><br><span class=\"line\">      list.add(ListTile(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;iam <span class=\"subst\">$i</span> list&quot;</span>),</span><br><span class=\"line\">      ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView(</span><br><span class=\"line\">      children: _getData()</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>ListView.builder</li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HomeContent</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">List</span> list=<span class=\"keyword\">new</span> <span class=\"built_in\">List</span>();</span><br><span class=\"line\">  HomeContent()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">20</span>;i++) &#123;</span><br><span class=\"line\">      list.add(ListTile(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;iam <span class=\"subst\">$i</span> list&quot;</span>),</span><br><span class=\"line\">      ));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ListView.builder(</span><br><span class=\"line\">        itemCount: <span class=\"keyword\">this</span>.list.length,</span><br><span class=\"line\">        itemBuilder: (context,index)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> ListTile(</span><br><span class=\"line\">            title: Text(<span class=\"keyword\">this</span>.list[index]),</span><br><span class=\"line\">          );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:48:55 GMT+0200 (GMT+02:00)","title":"Flutter学习记录","path":"2020/02/15/Flutter学习记录/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-02-15T16:32:32.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-15T16:32:32.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Flutter"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Kali Linux的学习和使用","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-02-19T11:05:29.000Z","password":null,"summary":"Kali Linux是linux下的一个发行版本，它的特殊是包含了众多安全渗透相关的软件，最基础的如nmap，从事安全方面工作的工程师，可以直接下载kali而无需再在linux上安装所需的软件包。同时，kali还被广泛用于黑客攻击和网站安全测试。","_content":"\n# 0：Kali简介\n\nKali作为最常用的网络渗透系统，内置了网络安全人员和黑客最常用的各类工具。\n\n# 1：Kali安装\n\n**安装途径：**\n\n1. 在VMWare虚拟机上安装Kali，[Kali Linux 系统安装详细教程](https://blog.csdn.net/xfyangle/article/details/81045116)\n\n2. 在Vultr上上传自定义的IOS。将Kali部署到服务器上。\n\n**常见问题：**\n\n- 切换图形界面和命令界面，当主机内存小于2g时，使用图形界面体验更好。\n\n1. 切换命令界面：Ctrl+Alt+F3\n\n2. 切换图形界面：Ctrl+Alt+F1\n\n- 在新版本Kali Linux2020中默认系统登陆为非超级管理员权限，也就是说不是root权限。在安装过程中，只有普通用户的用户名和密码设置。不会涉及root密码的设置。现在为root设置密码。\n\n1. 命令界面输入`sudo passwd root`\n\n2. 输入新密码，重复输入新密码。密码设置完成。\n\n- 开启SSH，如果你在服务器中安装了Kali，这个操作是必须的，他能让你使用其他终端，登陆Kali。\n\n1. 命令界面输入`sudo vim /etc/ssh/sshd_config`。\n\n2. 修改部分内容为如下：\n\n```\n#Authentication\nLoginGraceTime 2m\nPermitRoootLogin yes\nStrictModes yes\nMaxAuthTries 0\nMaxSessions 10\n```\n\n3. 保存退出\n\n4. 重启ssh `service ssh restart`\n5. 查看ssh是否启动，`service ssh status`\n6. 如果显示active则已生效，现在可以使用ssh登陆了。\n\n# 3：被动信息收集\n\n## 3.1 常用查询指令和工具\n\n`Ctrl+L`:清屏\n\n`ping sci.ci`:查看域名的访问速度\n\n`nslookup baidu.com`:域名服务器查询。\n\n`dig @8.8.8.8 baidu.com any`:查询，@8.8.8.8域名服务器记录的baidu.com域名解析记录。any:查询所有记录。不加只查A记录。+noall +answer只输出域名记录结果。\n\n`dig -x 35.201.203.235`：查询反向解析，ptr记录，需要有解析记录才行\n\n`dig txt chaos VERSION.BIND @ns3.dnsv4.com`:查询Dns服务器版本。通过版本信息查找漏洞\n\n`whois baidu.com`:查询注册信息\n\n查询接口：\n\n- 备案信息：`http://www.beianbeian.com`\n\n- 天眼查：`https://www.tianyancha.com`\n\n## 3.2 子域名挖掘\n\n1. 子域名挖掘工具：Maltego子域名挖掘机\n2. 搜索引擎：`site:qq.com`\n3. 第三方网站：`http://tool.chinaz.com/subdomain、https://dnsdumpster.com`\n\n## 3.3 Maltego使用\n\n## 3.4 Shodan搜索技巧\n\n`https://www.shodan.io`\n\n搜索技巧：\n\n`webcam`//网络摄像头\n\n`city:beijing webcam`//位于北京的摄像头\n\n`net:35.201.203.235`//查询到ip绑定的域名等信息\n\n`port:9200`//搜索开启9200端口的服务器\n\n## 3.5 Google搜索引擎的使用技巧\n\n- `inurl:qq.txt`文件\n- `inurl:admin_login.asp`登陆界面\n- `intitle:index.of .bash_history`表示网站目录对我们开放，我i们可以看到该目录下所有文件的信息。`.文件名`表示隐藏目录。\n  - 查找mysql的配置文件，my.cnf\n  - 查找discuz论坛中储存mysql密码的配置文件confg_global.php\n\n- `cache:baidu.com`搜索缓存的页面，虽然某些页面被删了\n- `Kali filetype:torrent`Kali时关键词，搜索Kali相关的指定文件类型\n- `apache site:baidu.com `某网站下的关键词\n- `intext:user.sql intitle:index.of`查询包含user.sql用户信息数据的网站，并且网站目录可见\n- `s3 site:amazonaws.com filetype:xls password`s3关键字，亚马逊的一种服务器类型。\n\n**总结：谷歌黑客数据库：https://www.exploit-db.com/google-hacking-database**\n\n# 4: 信息收集\n\n## 4.1 主动采集\n\n- `ping 192.168.1. -c 1`-c 1发一个ping包就停止，默认一直发\n\n- `traceroute baidu.com`检测路由\n\n**ARP：将ip解析为MAC物理地址**\n\n- 使用`apring`命令查看局域网中的IP是否有冲突\n\n如何在Kali中排查黑客是否冒充网关进行中间攻击？\n\n伪装机配置：`ifconfig ens33 192.168.1.1`\n\nKali探测：`arping 192.168.1.1 -c 1`//查看局域网中是否存在arp攻击，出现两个MAC地址对应IP地址，就有ARP攻击了。\n\n- `netdiscover -i eth0 -r 192.168.1.0/27`查看局域网中存活的设备。\n\n-i 是网络设备，网卡。-r 表示扫描范围\n\n## 4.2 被动采集\n\n`netdiscover -p`扫描局域网中的设备，不容易被管理员发现\n\n## 4.3 用Hping3对服务器进行DOS攻击\n\n`hping3 -c 1000 -d 120 -s -w 64 -p 80 --flood --rand-source baidu.com`\n\n-c 发送包的数量\n\n-d 发送到目标机器的每个数据包的大小。单位是字节\n\n-s 只发送SYN数据包\n\n-w TCP窗口大小\n\n-p 目的地端口（80是web端口）\n\n--flood 洪水攻击模式，尽可能快地发送数据包\n\n--rand-source 使用随机性的源头ip地址。只是在局域中伪造\n\n## 4.4 使用Nmap进行半连接扫描\n\n`nmap -sS 101.200.128.35 -p 80,81,21,25,110,443`看某个端口是否开启\n\n`nmap -sS 101.200.128.35`查看其打开的端口，但不会完全扫描65535个端口\n\n`nmap -sS 101.200.128.35 -p 1-1024`指定端口范围\n\n## 4.5使用nc扫描端口\n\n`nc -nv -w 1 -z 192.168.1.1 1-100`\n\n1. 实现任意TCP/UDP端口的监听，nc可以作为server以TCP或UDP方式监听指定端口。\n2. 端口的扫描，nc可以作为client发起TCOP或UDP连接。\n3. 机器之间传输文件。\n4. 机器之间网络测速\n\nnc参数：\n\n-nv 表示扫描的目标是个IP地址不做域名解析\n\n-w 表示超时时间，超过时间则不再扫描\n\n-z 表示进行端口扫描\n\n## 4.6 Scapy定制ARP和ICMP协议数据包\n\n伪装网络报文\n\n`scapy`如果报错弹出：`Wont be able to plot`\n\n`apt install python-matplotlib`\n\n`exti()`//退出Scapy\n\n`ARP().display()`//列出arp相关参数","source":"_posts/Kali-Linux的学习和使用.md","raw":"---\ntitle: Kali Linux的学习和使用\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-02-19 12:05:29\npassword:\nsummary: Kali Linux是linux下的一个发行版本，它的特殊是包含了众多安全渗透相关的软件，最基础的如nmap，从事安全方面工作的工程师，可以直接下载kali而无需再在linux上安装所需的软件包。同时，kali还被广泛用于黑客攻击和网站安全测试。\ntags: Kali Linux\ncategories: 学习笔记\n---\n\n# 0：Kali简介\n\nKali作为最常用的网络渗透系统，内置了网络安全人员和黑客最常用的各类工具。\n\n# 1：Kali安装\n\n**安装途径：**\n\n1. 在VMWare虚拟机上安装Kali，[Kali Linux 系统安装详细教程](https://blog.csdn.net/xfyangle/article/details/81045116)\n\n2. 在Vultr上上传自定义的IOS。将Kali部署到服务器上。\n\n**常见问题：**\n\n- 切换图形界面和命令界面，当主机内存小于2g时，使用图形界面体验更好。\n\n1. 切换命令界面：Ctrl+Alt+F3\n\n2. 切换图形界面：Ctrl+Alt+F1\n\n- 在新版本Kali Linux2020中默认系统登陆为非超级管理员权限，也就是说不是root权限。在安装过程中，只有普通用户的用户名和密码设置。不会涉及root密码的设置。现在为root设置密码。\n\n1. 命令界面输入`sudo passwd root`\n\n2. 输入新密码，重复输入新密码。密码设置完成。\n\n- 开启SSH，如果你在服务器中安装了Kali，这个操作是必须的，他能让你使用其他终端，登陆Kali。\n\n1. 命令界面输入`sudo vim /etc/ssh/sshd_config`。\n\n2. 修改部分内容为如下：\n\n```\n#Authentication\nLoginGraceTime 2m\nPermitRoootLogin yes\nStrictModes yes\nMaxAuthTries 0\nMaxSessions 10\n```\n\n3. 保存退出\n\n4. 重启ssh `service ssh restart`\n5. 查看ssh是否启动，`service ssh status`\n6. 如果显示active则已生效，现在可以使用ssh登陆了。\n\n# 3：被动信息收集\n\n## 3.1 常用查询指令和工具\n\n`Ctrl+L`:清屏\n\n`ping sci.ci`:查看域名的访问速度\n\n`nslookup baidu.com`:域名服务器查询。\n\n`dig @8.8.8.8 baidu.com any`:查询，@8.8.8.8域名服务器记录的baidu.com域名解析记录。any:查询所有记录。不加只查A记录。+noall +answer只输出域名记录结果。\n\n`dig -x 35.201.203.235`：查询反向解析，ptr记录，需要有解析记录才行\n\n`dig txt chaos VERSION.BIND @ns3.dnsv4.com`:查询Dns服务器版本。通过版本信息查找漏洞\n\n`whois baidu.com`:查询注册信息\n\n查询接口：\n\n- 备案信息：`http://www.beianbeian.com`\n\n- 天眼查：`https://www.tianyancha.com`\n\n## 3.2 子域名挖掘\n\n1. 子域名挖掘工具：Maltego子域名挖掘机\n2. 搜索引擎：`site:qq.com`\n3. 第三方网站：`http://tool.chinaz.com/subdomain、https://dnsdumpster.com`\n\n## 3.3 Maltego使用\n\n## 3.4 Shodan搜索技巧\n\n`https://www.shodan.io`\n\n搜索技巧：\n\n`webcam`//网络摄像头\n\n`city:beijing webcam`//位于北京的摄像头\n\n`net:35.201.203.235`//查询到ip绑定的域名等信息\n\n`port:9200`//搜索开启9200端口的服务器\n\n## 3.5 Google搜索引擎的使用技巧\n\n- `inurl:qq.txt`文件\n- `inurl:admin_login.asp`登陆界面\n- `intitle:index.of .bash_history`表示网站目录对我们开放，我i们可以看到该目录下所有文件的信息。`.文件名`表示隐藏目录。\n  - 查找mysql的配置文件，my.cnf\n  - 查找discuz论坛中储存mysql密码的配置文件confg_global.php\n\n- `cache:baidu.com`搜索缓存的页面，虽然某些页面被删了\n- `Kali filetype:torrent`Kali时关键词，搜索Kali相关的指定文件类型\n- `apache site:baidu.com `某网站下的关键词\n- `intext:user.sql intitle:index.of`查询包含user.sql用户信息数据的网站，并且网站目录可见\n- `s3 site:amazonaws.com filetype:xls password`s3关键字，亚马逊的一种服务器类型。\n\n**总结：谷歌黑客数据库：https://www.exploit-db.com/google-hacking-database**\n\n# 4: 信息收集\n\n## 4.1 主动采集\n\n- `ping 192.168.1. -c 1`-c 1发一个ping包就停止，默认一直发\n\n- `traceroute baidu.com`检测路由\n\n**ARP：将ip解析为MAC物理地址**\n\n- 使用`apring`命令查看局域网中的IP是否有冲突\n\n如何在Kali中排查黑客是否冒充网关进行中间攻击？\n\n伪装机配置：`ifconfig ens33 192.168.1.1`\n\nKali探测：`arping 192.168.1.1 -c 1`//查看局域网中是否存在arp攻击，出现两个MAC地址对应IP地址，就有ARP攻击了。\n\n- `netdiscover -i eth0 -r 192.168.1.0/27`查看局域网中存活的设备。\n\n-i 是网络设备，网卡。-r 表示扫描范围\n\n## 4.2 被动采集\n\n`netdiscover -p`扫描局域网中的设备，不容易被管理员发现\n\n## 4.3 用Hping3对服务器进行DOS攻击\n\n`hping3 -c 1000 -d 120 -s -w 64 -p 80 --flood --rand-source baidu.com`\n\n-c 发送包的数量\n\n-d 发送到目标机器的每个数据包的大小。单位是字节\n\n-s 只发送SYN数据包\n\n-w TCP窗口大小\n\n-p 目的地端口（80是web端口）\n\n--flood 洪水攻击模式，尽可能快地发送数据包\n\n--rand-source 使用随机性的源头ip地址。只是在局域中伪造\n\n## 4.4 使用Nmap进行半连接扫描\n\n`nmap -sS 101.200.128.35 -p 80,81,21,25,110,443`看某个端口是否开启\n\n`nmap -sS 101.200.128.35`查看其打开的端口，但不会完全扫描65535个端口\n\n`nmap -sS 101.200.128.35 -p 1-1024`指定端口范围\n\n## 4.5使用nc扫描端口\n\n`nc -nv -w 1 -z 192.168.1.1 1-100`\n\n1. 实现任意TCP/UDP端口的监听，nc可以作为server以TCP或UDP方式监听指定端口。\n2. 端口的扫描，nc可以作为client发起TCOP或UDP连接。\n3. 机器之间传输文件。\n4. 机器之间网络测速\n\nnc参数：\n\n-nv 表示扫描的目标是个IP地址不做域名解析\n\n-w 表示超时时间，超过时间则不再扫描\n\n-z 表示进行端口扫描\n\n## 4.6 Scapy定制ARP和ICMP协议数据包\n\n伪装网络报文\n\n`scapy`如果报错弹出：`Wont be able to plot`\n\n`apt install python-matplotlib`\n\n`exti()`//退出Scapy\n\n`ARP().display()`//列出arp相关参数","slug":"Kali-Linux的学习和使用","published":1,"updated":"2020-06-20T06:48:46.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaaq000bp0vzceytfjmp","content":"<h1 id=\"0：Kali简介\"><a href=\"#0：Kali简介\" class=\"headerlink\" title=\"0：Kali简介\"></a>0：Kali简介</h1><p>Kali作为最常用的网络渗透系统，内置了网络安全人员和黑客最常用的各类工具。</p>\n<h1 id=\"1：Kali安装\"><a href=\"#1：Kali安装\" class=\"headerlink\" title=\"1：Kali安装\"></a>1：Kali安装</h1><p><strong>安装途径：</strong></p>\n<ol>\n<li><p>在VMWare虚拟机上安装Kali，<a href=\"https://blog.csdn.net/xfyangle/article/details/81045116\">Kali Linux 系统安装详细教程</a></p>\n</li>\n<li><p>在Vultr上上传自定义的IOS。将Kali部署到服务器上。</p>\n</li>\n</ol>\n<p><strong>常见问题：</strong></p>\n<ul>\n<li>切换图形界面和命令界面，当主机内存小于2g时，使用图形界面体验更好。</li>\n</ul>\n<ol>\n<li><p>切换命令界面：Ctrl+Alt+F3</p>\n</li>\n<li><p>切换图形界面：Ctrl+Alt+F1</p>\n</li>\n</ol>\n<ul>\n<li>在新版本Kali Linux2020中默认系统登陆为非超级管理员权限，也就是说不是root权限。在安装过程中，只有普通用户的用户名和密码设置。不会涉及root密码的设置。现在为root设置密码。</li>\n</ul>\n<ol>\n<li><p>命令界面输入<code>sudo passwd root</code></p>\n</li>\n<li><p>输入新密码，重复输入新密码。密码设置完成。</p>\n</li>\n</ol>\n<ul>\n<li>开启SSH，如果你在服务器中安装了Kali，这个操作是必须的，他能让你使用其他终端，登陆Kali。</li>\n</ul>\n<ol>\n<li><p>命令界面输入<code>sudo vim /etc/ssh/sshd_config</code>。</p>\n</li>\n<li><p>修改部分内容为如下：</p>\n</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Authentication</span><br><span class=\"line\">LoginGraceTime 2m</span><br><span class=\"line\">PermitRoootLogin yes</span><br><span class=\"line\">StrictModes yes</span><br><span class=\"line\">MaxAuthTries 0</span><br><span class=\"line\">MaxSessions 10</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>保存退出</p>\n</li>\n<li><p>重启ssh <code>service ssh restart</code></p>\n</li>\n<li><p>查看ssh是否启动，<code>service ssh status</code></p>\n</li>\n<li><p>如果显示active则已生效，现在可以使用ssh登陆了。</p>\n</li>\n</ol>\n<h1 id=\"3：被动信息收集\"><a href=\"#3：被动信息收集\" class=\"headerlink\" title=\"3：被动信息收集\"></a>3：被动信息收集</h1><h2 id=\"3-1-常用查询指令和工具\"><a href=\"#3-1-常用查询指令和工具\" class=\"headerlink\" title=\"3.1 常用查询指令和工具\"></a>3.1 常用查询指令和工具</h2><p><code>Ctrl+L</code>:清屏</p>\n<p><code>ping sci.ci</code>:查看域名的访问速度</p>\n<p><code>nslookup baidu.com</code>:域名服务器查询。</p>\n<p><code>dig @8.8.8.8 baidu.com any</code>:查询，@8.8.8.8域名服务器记录的baidu.com域名解析记录。any:查询所有记录。不加只查A记录。+noall +answer只输出域名记录结果。</p>\n<p><code>dig -x 35.201.203.235</code>：查询反向解析，ptr记录，需要有解析记录才行</p>\n<p><code>dig txt chaos VERSION.BIND @ns3.dnsv4.com</code>:查询Dns服务器版本。通过版本信息查找漏洞</p>\n<p><code>whois baidu.com</code>:查询注册信息</p>\n<p>查询接口：</p>\n<ul>\n<li><p>备案信息：<code>http://www.beianbeian.com</code></p>\n</li>\n<li><p>天眼查：<code>https://www.tianyancha.com</code></p>\n</li>\n</ul>\n<h2 id=\"3-2-子域名挖掘\"><a href=\"#3-2-子域名挖掘\" class=\"headerlink\" title=\"3.2 子域名挖掘\"></a>3.2 子域名挖掘</h2><ol>\n<li>子域名挖掘工具：Maltego子域名挖掘机</li>\n<li>搜索引擎：<code>site:qq.com</code></li>\n<li>第三方网站：<code>http://tool.chinaz.com/subdomain、https://dnsdumpster.com</code></li>\n</ol>\n<h2 id=\"3-3-Maltego使用\"><a href=\"#3-3-Maltego使用\" class=\"headerlink\" title=\"3.3 Maltego使用\"></a>3.3 Maltego使用</h2><h2 id=\"3-4-Shodan搜索技巧\"><a href=\"#3-4-Shodan搜索技巧\" class=\"headerlink\" title=\"3.4 Shodan搜索技巧\"></a>3.4 Shodan搜索技巧</h2><p><code>https://www.shodan.io</code></p>\n<p>搜索技巧：</p>\n<p><code>webcam</code>//网络摄像头</p>\n<p><code>city:beijing webcam</code>//位于北京的摄像头</p>\n<p><code>net:35.201.203.235</code>//查询到ip绑定的域名等信息</p>\n<p><code>port:9200</code>//搜索开启9200端口的服务器</p>\n<h2 id=\"3-5-Google搜索引擎的使用技巧\"><a href=\"#3-5-Google搜索引擎的使用技巧\" class=\"headerlink\" title=\"3.5 Google搜索引擎的使用技巧\"></a>3.5 Google搜索引擎的使用技巧</h2><ul>\n<li><p><code>inurl:qq.txt</code>文件</p>\n</li>\n<li><p><code>inurl:admin_login.asp</code>登陆界面</p>\n</li>\n<li><p><code>intitle:index.of .bash_history</code>表示网站目录对我们开放，我i们可以看到该目录下所有文件的信息。<code>.文件名</code>表示隐藏目录。</p>\n<ul>\n<li>查找mysql的配置文件，my.cnf</li>\n<li>查找discuz论坛中储存mysql密码的配置文件confg_global.php</li>\n</ul>\n</li>\n<li><p><code>cache:baidu.com</code>搜索缓存的页面，虽然某些页面被删了</p>\n</li>\n<li><p><code>Kali filetype:torrent</code>Kali时关键词，搜索Kali相关的指定文件类型</p>\n</li>\n<li><p><code>apache site:baidu.com </code>某网站下的关键词</p>\n</li>\n<li><p><code>intext:user.sql intitle:index.of</code>查询包含user.sql用户信息数据的网站，并且网站目录可见</p>\n</li>\n<li><p><code>s3 site:amazonaws.com filetype:xls password</code>s3关键字，亚马逊的一种服务器类型。</p>\n</li>\n</ul>\n<p><strong>总结：谷歌黑客数据库：<a href=\"https://www.exploit-db.com/google-hacking-database\">https://www.exploit-db.com/google-hacking-database</a></strong></p>\n<h1 id=\"4-信息收集\"><a href=\"#4-信息收集\" class=\"headerlink\" title=\"4: 信息收集\"></a>4: 信息收集</h1><h2 id=\"4-1-主动采集\"><a href=\"#4-1-主动采集\" class=\"headerlink\" title=\"4.1 主动采集\"></a>4.1 主动采集</h2><ul>\n<li><p><code>ping 192.168.1. -c 1</code>-c 1发一个ping包就停止，默认一直发</p>\n</li>\n<li><p><code>traceroute baidu.com</code>检测路由</p>\n</li>\n</ul>\n<p><strong>ARP：将ip解析为MAC物理地址</strong></p>\n<ul>\n<li>使用<code>apring</code>命令查看局域网中的IP是否有冲突</li>\n</ul>\n<p>如何在Kali中排查黑客是否冒充网关进行中间攻击？</p>\n<p>伪装机配置：<code>ifconfig ens33 192.168.1.1</code></p>\n<p>Kali探测：<code>arping 192.168.1.1 -c 1</code>//查看局域网中是否存在arp攻击，出现两个MAC地址对应IP地址，就有ARP攻击了。</p>\n<ul>\n<li><code>netdiscover -i eth0 -r 192.168.1.0/27</code>查看局域网中存活的设备。</li>\n</ul>\n<p>-i 是网络设备，网卡。-r 表示扫描范围</p>\n<h2 id=\"4-2-被动采集\"><a href=\"#4-2-被动采集\" class=\"headerlink\" title=\"4.2 被动采集\"></a>4.2 被动采集</h2><p><code>netdiscover -p</code>扫描局域网中的设备，不容易被管理员发现</p>\n<h2 id=\"4-3-用Hping3对服务器进行DOS攻击\"><a href=\"#4-3-用Hping3对服务器进行DOS攻击\" class=\"headerlink\" title=\"4.3 用Hping3对服务器进行DOS攻击\"></a>4.3 用Hping3对服务器进行DOS攻击</h2><p><code>hping3 -c 1000 -d 120 -s -w 64 -p 80 --flood --rand-source baidu.com</code></p>\n<p>-c 发送包的数量</p>\n<p>-d 发送到目标机器的每个数据包的大小。单位是字节</p>\n<p>-s 只发送SYN数据包</p>\n<p>-w TCP窗口大小</p>\n<p>-p 目的地端口（80是web端口）</p>\n<p>–flood 洪水攻击模式，尽可能快地发送数据包</p>\n<p>–rand-source 使用随机性的源头ip地址。只是在局域中伪造</p>\n<h2 id=\"4-4-使用Nmap进行半连接扫描\"><a href=\"#4-4-使用Nmap进行半连接扫描\" class=\"headerlink\" title=\"4.4 使用Nmap进行半连接扫描\"></a>4.4 使用Nmap进行半连接扫描</h2><p><code>nmap -sS 101.200.128.35 -p 80,81,21,25,110,443</code>看某个端口是否开启</p>\n<p><code>nmap -sS 101.200.128.35</code>查看其打开的端口，但不会完全扫描65535个端口</p>\n<p><code>nmap -sS 101.200.128.35 -p 1-1024</code>指定端口范围</p>\n<h2 id=\"4-5使用nc扫描端口\"><a href=\"#4-5使用nc扫描端口\" class=\"headerlink\" title=\"4.5使用nc扫描端口\"></a>4.5使用nc扫描端口</h2><p><code>nc -nv -w 1 -z 192.168.1.1 1-100</code></p>\n<ol>\n<li>实现任意TCP/UDP端口的监听，nc可以作为server以TCP或UDP方式监听指定端口。</li>\n<li>端口的扫描，nc可以作为client发起TCOP或UDP连接。</li>\n<li>机器之间传输文件。</li>\n<li>机器之间网络测速</li>\n</ol>\n<p>nc参数：</p>\n<p>-nv 表示扫描的目标是个IP地址不做域名解析</p>\n<p>-w 表示超时时间，超过时间则不再扫描</p>\n<p>-z 表示进行端口扫描</p>\n<h2 id=\"4-6-Scapy定制ARP和ICMP协议数据包\"><a href=\"#4-6-Scapy定制ARP和ICMP协议数据包\" class=\"headerlink\" title=\"4.6 Scapy定制ARP和ICMP协议数据包\"></a>4.6 Scapy定制ARP和ICMP协议数据包</h2><p>伪装网络报文</p>\n<p><code>scapy</code>如果报错弹出：<code>Wont be able to plot</code></p>\n<p><code>apt install python-matplotlib</code></p>\n<p><code>exti()</code>//退出Scapy</p>\n<p><code>ARP().display()</code>//列出arp相关参数</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：Kali简介\"><a href=\"#0：Kali简介\" class=\"headerlink\" title=\"0：Kali简介\"></a>0：Kali简介</h1><p>Kali作为最常用的网络渗透系统，内置了网络安全人员和黑客最常用的各类工具。</p>\n<h1 id=\"1：Kali安装\"><a href=\"#1：Kali安装\" class=\"headerlink\" title=\"1：Kali安装\"></a>1：Kali安装</h1><p><strong>安装途径：</strong></p>\n<ol>\n<li><p>在VMWare虚拟机上安装Kali，<a href=\"https://blog.csdn.net/xfyangle/article/details/81045116\">Kali Linux 系统安装详细教程</a></p>\n</li>\n<li><p>在Vultr上上传自定义的IOS。将Kali部署到服务器上。</p>\n</li>\n</ol>\n<p><strong>常见问题：</strong></p>\n<ul>\n<li>切换图形界面和命令界面，当主机内存小于2g时，使用图形界面体验更好。</li>\n</ul>\n<ol>\n<li><p>切换命令界面：Ctrl+Alt+F3</p>\n</li>\n<li><p>切换图形界面：Ctrl+Alt+F1</p>\n</li>\n</ol>\n<ul>\n<li>在新版本Kali Linux2020中默认系统登陆为非超级管理员权限，也就是说不是root权限。在安装过程中，只有普通用户的用户名和密码设置。不会涉及root密码的设置。现在为root设置密码。</li>\n</ul>\n<ol>\n<li><p>命令界面输入<code>sudo passwd root</code></p>\n</li>\n<li><p>输入新密码，重复输入新密码。密码设置完成。</p>\n</li>\n</ol>\n<ul>\n<li>开启SSH，如果你在服务器中安装了Kali，这个操作是必须的，他能让你使用其他终端，登陆Kali。</li>\n</ul>\n<ol>\n<li><p>命令界面输入<code>sudo vim /etc/ssh/sshd_config</code>。</p>\n</li>\n<li><p>修改部分内容为如下：</p>\n</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Authentication</span><br><span class=\"line\">LoginGraceTime 2m</span><br><span class=\"line\">PermitRoootLogin yes</span><br><span class=\"line\">StrictModes yes</span><br><span class=\"line\">MaxAuthTries 0</span><br><span class=\"line\">MaxSessions 10</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>保存退出</p>\n</li>\n<li><p>重启ssh <code>service ssh restart</code></p>\n</li>\n<li><p>查看ssh是否启动，<code>service ssh status</code></p>\n</li>\n<li><p>如果显示active则已生效，现在可以使用ssh登陆了。</p>\n</li>\n</ol>\n<h1 id=\"3：被动信息收集\"><a href=\"#3：被动信息收集\" class=\"headerlink\" title=\"3：被动信息收集\"></a>3：被动信息收集</h1><h2 id=\"3-1-常用查询指令和工具\"><a href=\"#3-1-常用查询指令和工具\" class=\"headerlink\" title=\"3.1 常用查询指令和工具\"></a>3.1 常用查询指令和工具</h2><p><code>Ctrl+L</code>:清屏</p>\n<p><code>ping sci.ci</code>:查看域名的访问速度</p>\n<p><code>nslookup baidu.com</code>:域名服务器查询。</p>\n<p><code>dig @8.8.8.8 baidu.com any</code>:查询，@8.8.8.8域名服务器记录的baidu.com域名解析记录。any:查询所有记录。不加只查A记录。+noall +answer只输出域名记录结果。</p>\n<p><code>dig -x 35.201.203.235</code>：查询反向解析，ptr记录，需要有解析记录才行</p>\n<p><code>dig txt chaos VERSION.BIND @ns3.dnsv4.com</code>:查询Dns服务器版本。通过版本信息查找漏洞</p>\n<p><code>whois baidu.com</code>:查询注册信息</p>\n<p>查询接口：</p>\n<ul>\n<li><p>备案信息：<code>http://www.beianbeian.com</code></p>\n</li>\n<li><p>天眼查：<code>https://www.tianyancha.com</code></p>\n</li>\n</ul>\n<h2 id=\"3-2-子域名挖掘\"><a href=\"#3-2-子域名挖掘\" class=\"headerlink\" title=\"3.2 子域名挖掘\"></a>3.2 子域名挖掘</h2><ol>\n<li>子域名挖掘工具：Maltego子域名挖掘机</li>\n<li>搜索引擎：<code>site:qq.com</code></li>\n<li>第三方网站：<code>http://tool.chinaz.com/subdomain、https://dnsdumpster.com</code></li>\n</ol>\n<h2 id=\"3-3-Maltego使用\"><a href=\"#3-3-Maltego使用\" class=\"headerlink\" title=\"3.3 Maltego使用\"></a>3.3 Maltego使用</h2><h2 id=\"3-4-Shodan搜索技巧\"><a href=\"#3-4-Shodan搜索技巧\" class=\"headerlink\" title=\"3.4 Shodan搜索技巧\"></a>3.4 Shodan搜索技巧</h2><p><code>https://www.shodan.io</code></p>\n<p>搜索技巧：</p>\n<p><code>webcam</code>//网络摄像头</p>\n<p><code>city:beijing webcam</code>//位于北京的摄像头</p>\n<p><code>net:35.201.203.235</code>//查询到ip绑定的域名等信息</p>\n<p><code>port:9200</code>//搜索开启9200端口的服务器</p>\n<h2 id=\"3-5-Google搜索引擎的使用技巧\"><a href=\"#3-5-Google搜索引擎的使用技巧\" class=\"headerlink\" title=\"3.5 Google搜索引擎的使用技巧\"></a>3.5 Google搜索引擎的使用技巧</h2><ul>\n<li><p><code>inurl:qq.txt</code>文件</p>\n</li>\n<li><p><code>inurl:admin_login.asp</code>登陆界面</p>\n</li>\n<li><p><code>intitle:index.of .bash_history</code>表示网站目录对我们开放，我i们可以看到该目录下所有文件的信息。<code>.文件名</code>表示隐藏目录。</p>\n<ul>\n<li>查找mysql的配置文件，my.cnf</li>\n<li>查找discuz论坛中储存mysql密码的配置文件confg_global.php</li>\n</ul>\n</li>\n<li><p><code>cache:baidu.com</code>搜索缓存的页面，虽然某些页面被删了</p>\n</li>\n<li><p><code>Kali filetype:torrent</code>Kali时关键词，搜索Kali相关的指定文件类型</p>\n</li>\n<li><p><code>apache site:baidu.com </code>某网站下的关键词</p>\n</li>\n<li><p><code>intext:user.sql intitle:index.of</code>查询包含user.sql用户信息数据的网站，并且网站目录可见</p>\n</li>\n<li><p><code>s3 site:amazonaws.com filetype:xls password</code>s3关键字，亚马逊的一种服务器类型。</p>\n</li>\n</ul>\n<p><strong>总结：谷歌黑客数据库：<a href=\"https://www.exploit-db.com/google-hacking-database\">https://www.exploit-db.com/google-hacking-database</a></strong></p>\n<h1 id=\"4-信息收集\"><a href=\"#4-信息收集\" class=\"headerlink\" title=\"4: 信息收集\"></a>4: 信息收集</h1><h2 id=\"4-1-主动采集\"><a href=\"#4-1-主动采集\" class=\"headerlink\" title=\"4.1 主动采集\"></a>4.1 主动采集</h2><ul>\n<li><p><code>ping 192.168.1. -c 1</code>-c 1发一个ping包就停止，默认一直发</p>\n</li>\n<li><p><code>traceroute baidu.com</code>检测路由</p>\n</li>\n</ul>\n<p><strong>ARP：将ip解析为MAC物理地址</strong></p>\n<ul>\n<li>使用<code>apring</code>命令查看局域网中的IP是否有冲突</li>\n</ul>\n<p>如何在Kali中排查黑客是否冒充网关进行中间攻击？</p>\n<p>伪装机配置：<code>ifconfig ens33 192.168.1.1</code></p>\n<p>Kali探测：<code>arping 192.168.1.1 -c 1</code>//查看局域网中是否存在arp攻击，出现两个MAC地址对应IP地址，就有ARP攻击了。</p>\n<ul>\n<li><code>netdiscover -i eth0 -r 192.168.1.0/27</code>查看局域网中存活的设备。</li>\n</ul>\n<p>-i 是网络设备，网卡。-r 表示扫描范围</p>\n<h2 id=\"4-2-被动采集\"><a href=\"#4-2-被动采集\" class=\"headerlink\" title=\"4.2 被动采集\"></a>4.2 被动采集</h2><p><code>netdiscover -p</code>扫描局域网中的设备，不容易被管理员发现</p>\n<h2 id=\"4-3-用Hping3对服务器进行DOS攻击\"><a href=\"#4-3-用Hping3对服务器进行DOS攻击\" class=\"headerlink\" title=\"4.3 用Hping3对服务器进行DOS攻击\"></a>4.3 用Hping3对服务器进行DOS攻击</h2><p><code>hping3 -c 1000 -d 120 -s -w 64 -p 80 --flood --rand-source baidu.com</code></p>\n<p>-c 发送包的数量</p>\n<p>-d 发送到目标机器的每个数据包的大小。单位是字节</p>\n<p>-s 只发送SYN数据包</p>\n<p>-w TCP窗口大小</p>\n<p>-p 目的地端口（80是web端口）</p>\n<p>–flood 洪水攻击模式，尽可能快地发送数据包</p>\n<p>–rand-source 使用随机性的源头ip地址。只是在局域中伪造</p>\n<h2 id=\"4-4-使用Nmap进行半连接扫描\"><a href=\"#4-4-使用Nmap进行半连接扫描\" class=\"headerlink\" title=\"4.4 使用Nmap进行半连接扫描\"></a>4.4 使用Nmap进行半连接扫描</h2><p><code>nmap -sS 101.200.128.35 -p 80,81,21,25,110,443</code>看某个端口是否开启</p>\n<p><code>nmap -sS 101.200.128.35</code>查看其打开的端口，但不会完全扫描65535个端口</p>\n<p><code>nmap -sS 101.200.128.35 -p 1-1024</code>指定端口范围</p>\n<h2 id=\"4-5使用nc扫描端口\"><a href=\"#4-5使用nc扫描端口\" class=\"headerlink\" title=\"4.5使用nc扫描端口\"></a>4.5使用nc扫描端口</h2><p><code>nc -nv -w 1 -z 192.168.1.1 1-100</code></p>\n<ol>\n<li>实现任意TCP/UDP端口的监听，nc可以作为server以TCP或UDP方式监听指定端口。</li>\n<li>端口的扫描，nc可以作为client发起TCOP或UDP连接。</li>\n<li>机器之间传输文件。</li>\n<li>机器之间网络测速</li>\n</ol>\n<p>nc参数：</p>\n<p>-nv 表示扫描的目标是个IP地址不做域名解析</p>\n<p>-w 表示超时时间，超过时间则不再扫描</p>\n<p>-z 表示进行端口扫描</p>\n<h2 id=\"4-6-Scapy定制ARP和ICMP协议数据包\"><a href=\"#4-6-Scapy定制ARP和ICMP协议数据包\" class=\"headerlink\" title=\"4.6 Scapy定制ARP和ICMP协议数据包\"></a>4.6 Scapy定制ARP和ICMP协议数据包</h2><p>伪装网络报文</p>\n<p><code>scapy</code>如果报错弹出：<code>Wont be able to plot</code></p>\n<p><code>apt install python-matplotlib</code></p>\n<p><code>exti()</code>//退出Scapy</p>\n<p><code>ARP().display()</code>//列出arp相关参数</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:48:46 GMT+0200 (GMT+02:00)","title":"Kali Linux的学习和使用","path":"2020/02/19/Kali-Linux的学习和使用/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-02-19T11:05:29.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-19T11:05:29.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Kali Linux"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Linux操作系统","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-02-20T16:40:28.000Z","password":null,"summary":"作为服务器最流行的操作系统，linux在网站方面意义重大，了解linux系统的编程、操作和系统结构，就显得尤为重要。","_content":"\n# 1：Linux简介\n\n开源软件：\n\n- 使用自由\n- 研究自由\n- 散布及改良的自由\n\nLAMP：Linux+Apache+Mysql+PHP\n\n网络配置：\n\n- 桥接：像一台真实电脑一样直接连接互联网\n- NAT：类似于使用真实电脑的热点\n- host only：只允许和真实机通行\n\n`ifconfig eth0 192.168.118.2`//配置网卡和ip，如果配置为桥接，需要设置为局域网相同网段。此设置重启后失效。\n\n注意事项：\n\n- Linux严格区分大小写\n- Linux所有内容以文件形式保存，包括硬件。\n\n**Linux目录的作用**\n\n| 目录名       | 目录的作用                                                   |\n| ------------ | ------------------------------------------------------------ |\n| /bin/        | 存放系统命令的目录，普通和超级用户都可以执行                 |\n| /sbin/       | 保存和系统环境设置相关的指令，只有超级用户root能使用，但普通用户可以查看 |\n| /usr/bin/    | 单用户模式下不能使用，类似于win的安全模式                    |\n| /usr/sbin/   | 超级用户才能使用                                             |\n| /boot/       | 系统启动目录，保存系统启动相关文件，如内核文件和启动引导程序 |\n| /dev/        | 设备文件保存位置，                                           |\n| /etc/        | 配置文件，默认保存在这                                       |\n| /home/       | 普通用户的家目录                                             |\n| /lib/        | 系统调用的函数库                                             |\n| /lost+found/ | 当系统意外崩溃或关机，产生一些文件碎片放在这里。系统启动时，fsck工具会检测这里。每个分区下都有自己的此文件 |\n| /media/      | 挂载目录，媒体设备                                           |\n| /mnt/        | 挂在如优盘、移动硬盘                                         |\n| /misc/       | 挂在NFS服务的共享目录                                        |\n| /opt/        | 第三方安装的软件保存位置。现在的习惯是，放在/usr/local/，类似于win中的Program Files文件夹。 |\n| /proc/       | 虚拟文件系统。存放在内存中，保存系统的内核、今后曾、外部设备状态、网络状态。不要再这里面写东西 |\n| /sys/        | 虚拟文件系统。内存中，保存内核相关                           |\n| /root/       | 超级用户的家目录。普通用户在/home/                           |\n| /srv/        | 服务数据目录。                                               |\n| /tmp/        | 临时目录。可以清空                                           |\n| /usr/        | 系统软件资源目录。unix software resource                     |\n| /var/        | 动态数据保存目录。保存缓存、日志以及软件运行产生的文件。     |\n\n\n\n# 2：Linux常用命令\n\n**命令格式**\n\n命令 [-选项] [参数]\n\n例： ls -la /etc\n\n说明：\n\n1. 个别命令不遵守此格式\n\n2. 当有多个选项时，可以写在一起\n\n3. 简写选项与完整选项\n\n   -a 等于 --all\n\n## 2.1 目录处理命令\n\n### 2.1.1 展示子目录：ls\n\n命令名称：ls\n\n命令原意：list\n\n```shell\nls\t#显示当前目录的非隐藏文件\nls -a\t#all，显示隐藏文件和非隐藏文件，隐藏文件文件名格式：.abc\nls /\t#查看根目录，/+文件路径可以查看任意位置\nls -l\t#long，长格式显示，显示文件的详细信息\nls -h\t#human,比如将文件大小单位列出来，人性化显示\nls -d\t#direct，只显示目录本身\nls -i\t#inode，展示i节点，文件的唯一身份标识\n```\n\nls -l的结果：\n```shell\ntotal 31056\n-rwxr-xr-x  1 root root     3612 Jun 23 19:17 Aria2Drive.sh\n权限 引用次数 文件所有者 文件所属组 文件大小(单位字节) 文件最近修改时间 文件名\n```\n**权限：-rw-r--r--**\n\n权限第一个参数：\n\n| -    | d      | l      |\n| ---- | ------ | ------ |\n| 文件 | 文件夹 | 软连接 |\n\n剩余九个参数：\n\n| rw-         | r--         | r--     |\n| ----------- | ----------- | ------- |\n| u所有者权限 | g所属组权限 | o其他人 |\n| r读         | w写         | x执行   |\n\n### 2.1.2 新建目录：mkdir\n\n命令名称：mkdir\n\n命令原意：创建文件目录\n\n```shell\nmkdir /tmp/123\nmkdir -p /tmp/japan/123\t#递归创建目录，japan目录原来也没有\nmkdir -p /tmp/japan/123 /temp/japan/456\t#创建多个目录\n```\n### 2.1.3 切换目录：cd\n\n```shell\ncd /tmp/japan/123\t#切换到指定目录\ncd .\t#表示当前目录\ncd ..\t#回到上级目录\n```\n\n### 2.1.4 展示当前完整路径：pwd\n\n```shell\npwd\t#显示当前位置的完整路径\n```\n\n### 2.1.5 删除空目录：rmdir\n\n```shell\nrmdir /tmp/japan/123\n```\n\n### 2.1.6 复制：cp\n\n```shell\ncp /etc/grab.conf /root\t#复制文件\ncp -r /tmp/japan/123 /root\t#复制目录\ncp /tmp/japan/123.log /tmp/japan/456.log /tmp\t#复制多个文件\ncp -p /tmp/abc.log /tmp\t#保存文件的属性不变，比如最近修改的时间。\ncp /tmp/japan/abc.log /tmp/gaiming.log\t#拷贝并改名\n```\n\n### 2.1.7 移动、剪切：mv\n\n```shell\nmv /tmp/japan/123 /tmp\t#把123移动到/tmp目录下\nmv /tmp/japan/123 /tmp/us\t#移动并改名\nmv 123 456\t#当前目录下移动并改名，则是重命名\n```\n\n### 2.1.8 删除：rm\n\n```shell\nrm grab.conf\t#删除文件\nrm -f grab.conf\t#强制删除文件，不会询问是否确认。\nrm -r /tmp/japan\t#删除目录\n```\n\n## 2.2 文件处理命令\n\n### 2.2.1 新建文件：touch\n\n```shell\ntouch japanlovestory.list\t#新建文件\ntouch \"program files\" #创建带空格文件，不推荐带空格文件名\n```\n\n### 2.2.2 浏览短文件：cat\n\n```shell\ncat /etc/issue\t#显示内容\ncat -n /etc/issue\t#显示行号\n```\n\n### 2.2.3 按行反向显示浏览：tac\n\n### 2.2.4 分页浏览长文件：more\n\n```shell\nmore /etc/services\t#空格或f向下翻页，按行向下翻，按q退出，帮助信息都是调用more命令。\n```\n\n不能往上翻。\n\n### 2.2.5 可向上分页浏览：less\n\n```shell\nless /etc/services\t#向下翻页和more相同，按pgup向上翻页，上箭头向上一行。\n#搜索功能，浏览状态，输入“/service”，按“n”向下找搜索结果。\n\n```\n\n### 2.2.6 浏览文件前几行：head\n\n```shell\nhead /etc/services\t#默认显示前十行\nhead -n 7 /etc/services\t#显示前七行\n```\n\n### 2.2.7 浏览文件末尾几行：tail\n\n```shell\ntail /etc/services\t#显示末尾几行\ntail -n 7 /etc/services\t#显示指定行\ntail -f /var/log/messages\t#动态显示文件末尾几行\n```\n\n## 2.3 链接命令\n\n**生成链接文件：ln**\n\n```shell\nln -s /etc/issue /tmp/issue.soft\t#创建文件的软连接\nln /etc/issue /tmp/issue.hard\t#创建文件的硬链接\n```\n\n软连接：类似windows的快捷方式\n\n硬链接：硬链接和源文件属性相同，且同步更新，可以向硬链接中写入内容，删除源文件后，硬链接任然存在。硬链接的i节点与源文件相同。\n\n硬链接不能跨分区，生成对象不能是目录\n\n## 2.4 权限管理命令\n\n## 2.4.1 文件权限变更：chmod\n\n命令名称：chmod（change the permissions mode of a file）\n\n语法： chmod \\[{ugoa}\\]{+-=}\\[文件或目录\\]\n\n​\t\t\t\t\t\t\t\\[mode=421\\]\\[文件或目录\\]\n\n​\t\t\t\t\t\t\t-R 递归修改\n\n权限只有管理员root和所有者可以修改。\n\n```shell\nchmod g+w,o-r japan.list\t#所属组加读权限，其他人减少读权限\nchmod g=rwx japn.list\n```\n\n数字表述法：\n\n|  r   |  w   |  x   |\n| :--: | :--: | :--: |\n|  4   |  2   |  1   |\n\nrwxrw-r--对应权限：(4+2+1)(4+2)(4)=764\n\n```shell\nchmod -R 777 /tmp/abc\t#修改/tmp/abc及其下面的的所有文件的权限为777\n```\n\n> root用户创建的644权限文件，其他用户能否删除？\n>\n> 答案取决于用户是否具有文件所属的目录的写权限。\n\n比如：\n一个目录/temp权限为777\n\n文件/temp/testfile的权限为644。\n\n那么普通用户任然可以删除/temp/testfile，因为所有人都有/tmp目录的写权限，所以可以再/temp目录下新建文件、目录、删除目录和删除文件。\n\n|           | r读权限                 | w写权限              | x执行权限      |\n| --------- | ----------------------- | -------------------- | -------------- |\n| file      | cat/more/less/head/tail | vim                  | script command |\n| directory | ls                      | touch/mkdir/rmdir/rm | cd             |\n\n## 2.4.2 文件所有者变更：chown\n\n语法： chown [用户] [文件或目录]\n\n```shell\nuseradd shenchao\t#添加一个用户\nchown shenchao /tmp/japan\t#改变所有者\n```\n\n## 2.4.3 文件所属组变更：chgrp\n\n```shell\ngroupadd lampbrother\t#新建组\nchgrp lampbrother /tmp/japan\t#更改所属组\n```\n\n### 2.4.4 显示新建文件的缺省权限：umask\n\n```shell\numask -S\t#显示新建目录缺省权限\numask\t#显示新建目录缺省权限的与值\numask 077\t#修改新建文件的缺省权限为700.原理为，777与077得700\n```\n\n0022\n\n0：特殊权限\n\n022：--- -w- -w-\n\n则目录的权限为：777和022逻辑与的结果，等于755\n\n## 2.5 文件搜索命令\n\n### 2.5.1 文件搜索命令：find\n\n语法：find [搜索范围] [匹配条件]\n\n```shell\nfind /etc -name init\t#在/etc目录下搜索名为init的文件，initab不能被搜索到。\nfind /etc -name *init*\t#名字包含init就会被搜索，*作为通配符\nfind /etc -name int???\t#?\nfind /etc -iname init???\t#搜索名字不区分大小写。\n```\n\n```shell\nfind / -size +204800\t#查找大于100MB文件，按数据块算，一个数据块=0.5K。204800个数据块=100MB\n```\n\n```shell\nfind / -user shenchao\t#根据所有者查找\n```\n\n```shell\nfind /etc -cmin -5\t#根据文件属性5分钟内被改的文件查找 change\nfind /etc -amin -5\t#根据访问时间 access\nfind /etc -mmin -5\t#根据文件内容被改变 modify\n```\n\n```shell\nfind /etc -size +163840 -a -size -204800\t#查找大于80MB并且小于100MB的文件\nfind /etc -size +163840 -o -size -204800\t#查找大于80MB或者小于100MB的文件\n```\n\n```shell\nfind /etc -name init* -a -type f\t#查找类型为文件的init*对象\n```\n-exec/-ok 对搜索结果进行处理。-ok比-exec多了询问是否操作过程\n\n```shell\nfind /etc -name inittab -exec ls -l {} \\;\t#-exec 命令 {} \\;为固定格式\n```\n\n```shell\nfind /etc -inum 3442\t#根据i节点查找文件\nfind /etc -inum 3442 -exec rm {} \\;\t#删除i节点为3442的文件。可用于名字奇怪的文件\n```\n\n### 2.5.2 其他文件搜索命令：locate\n\n在文件资料库中查找文件，速度非常快。但是不能及时更新。\n\n```shell\nlocate inittab\t#查找inittab的位置\nlocate -i inittab\t#查找时不区分大小写\n```\n\n更新资料库\n\n```shell\nupdatedb\n```\n\n> locate无法收录/tmp目录下的文件\n\n### 2.5.3 命令文件搜索命令：which\n\n对命令使用\n\n```shell\nwhich cp\t#查找命令绝对路径的位置，并且得到命令是否有别命\n```\n\n### 2.5.4 命令文件搜索命令：whereis\n\n```shell\nwhereis rm\t#找到命令绝对路径，和命令的帮助文档所在位置\n```\n\n### 2.5.5 文件内容搜索命令：grep\n\n| 参数 | 作用         |\n| ---- | ------------ |\n| -i   | 不区分大小写 |\n| -v   | 排除指定字串 |\n\n\n\n```shell\ngrep multiuser /etc/inittab\t#查找文件中multiuser所在的行。\ngrep -v ^# /etc/inittab\t#排除指定字串所在的行，即以#开头的行，不希显示。\n```\n\n","source":"_posts/Linux操作系统学习笔记.md","raw":"---\ntitle: Linux操作系统\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-02-20 17:40:28\npassword:\nsummary: 作为服务器最流行的操作系统，linux在网站方面意义重大，了解linux系统的编程、操作和系统结构，就显得尤为重要。\ntags: Linux\ncategories: 学习笔记\n---\n\n# 1：Linux简介\n\n开源软件：\n\n- 使用自由\n- 研究自由\n- 散布及改良的自由\n\nLAMP：Linux+Apache+Mysql+PHP\n\n网络配置：\n\n- 桥接：像一台真实电脑一样直接连接互联网\n- NAT：类似于使用真实电脑的热点\n- host only：只允许和真实机通行\n\n`ifconfig eth0 192.168.118.2`//配置网卡和ip，如果配置为桥接，需要设置为局域网相同网段。此设置重启后失效。\n\n注意事项：\n\n- Linux严格区分大小写\n- Linux所有内容以文件形式保存，包括硬件。\n\n**Linux目录的作用**\n\n| 目录名       | 目录的作用                                                   |\n| ------------ | ------------------------------------------------------------ |\n| /bin/        | 存放系统命令的目录，普通和超级用户都可以执行                 |\n| /sbin/       | 保存和系统环境设置相关的指令，只有超级用户root能使用，但普通用户可以查看 |\n| /usr/bin/    | 单用户模式下不能使用，类似于win的安全模式                    |\n| /usr/sbin/   | 超级用户才能使用                                             |\n| /boot/       | 系统启动目录，保存系统启动相关文件，如内核文件和启动引导程序 |\n| /dev/        | 设备文件保存位置，                                           |\n| /etc/        | 配置文件，默认保存在这                                       |\n| /home/       | 普通用户的家目录                                             |\n| /lib/        | 系统调用的函数库                                             |\n| /lost+found/ | 当系统意外崩溃或关机，产生一些文件碎片放在这里。系统启动时，fsck工具会检测这里。每个分区下都有自己的此文件 |\n| /media/      | 挂载目录，媒体设备                                           |\n| /mnt/        | 挂在如优盘、移动硬盘                                         |\n| /misc/       | 挂在NFS服务的共享目录                                        |\n| /opt/        | 第三方安装的软件保存位置。现在的习惯是，放在/usr/local/，类似于win中的Program Files文件夹。 |\n| /proc/       | 虚拟文件系统。存放在内存中，保存系统的内核、今后曾、外部设备状态、网络状态。不要再这里面写东西 |\n| /sys/        | 虚拟文件系统。内存中，保存内核相关                           |\n| /root/       | 超级用户的家目录。普通用户在/home/                           |\n| /srv/        | 服务数据目录。                                               |\n| /tmp/        | 临时目录。可以清空                                           |\n| /usr/        | 系统软件资源目录。unix software resource                     |\n| /var/        | 动态数据保存目录。保存缓存、日志以及软件运行产生的文件。     |\n\n\n\n# 2：Linux常用命令\n\n**命令格式**\n\n命令 [-选项] [参数]\n\n例： ls -la /etc\n\n说明：\n\n1. 个别命令不遵守此格式\n\n2. 当有多个选项时，可以写在一起\n\n3. 简写选项与完整选项\n\n   -a 等于 --all\n\n## 2.1 目录处理命令\n\n### 2.1.1 展示子目录：ls\n\n命令名称：ls\n\n命令原意：list\n\n```shell\nls\t#显示当前目录的非隐藏文件\nls -a\t#all，显示隐藏文件和非隐藏文件，隐藏文件文件名格式：.abc\nls /\t#查看根目录，/+文件路径可以查看任意位置\nls -l\t#long，长格式显示，显示文件的详细信息\nls -h\t#human,比如将文件大小单位列出来，人性化显示\nls -d\t#direct，只显示目录本身\nls -i\t#inode，展示i节点，文件的唯一身份标识\n```\n\nls -l的结果：\n```shell\ntotal 31056\n-rwxr-xr-x  1 root root     3612 Jun 23 19:17 Aria2Drive.sh\n权限 引用次数 文件所有者 文件所属组 文件大小(单位字节) 文件最近修改时间 文件名\n```\n**权限：-rw-r--r--**\n\n权限第一个参数：\n\n| -    | d      | l      |\n| ---- | ------ | ------ |\n| 文件 | 文件夹 | 软连接 |\n\n剩余九个参数：\n\n| rw-         | r--         | r--     |\n| ----------- | ----------- | ------- |\n| u所有者权限 | g所属组权限 | o其他人 |\n| r读         | w写         | x执行   |\n\n### 2.1.2 新建目录：mkdir\n\n命令名称：mkdir\n\n命令原意：创建文件目录\n\n```shell\nmkdir /tmp/123\nmkdir -p /tmp/japan/123\t#递归创建目录，japan目录原来也没有\nmkdir -p /tmp/japan/123 /temp/japan/456\t#创建多个目录\n```\n### 2.1.3 切换目录：cd\n\n```shell\ncd /tmp/japan/123\t#切换到指定目录\ncd .\t#表示当前目录\ncd ..\t#回到上级目录\n```\n\n### 2.1.4 展示当前完整路径：pwd\n\n```shell\npwd\t#显示当前位置的完整路径\n```\n\n### 2.1.5 删除空目录：rmdir\n\n```shell\nrmdir /tmp/japan/123\n```\n\n### 2.1.6 复制：cp\n\n```shell\ncp /etc/grab.conf /root\t#复制文件\ncp -r /tmp/japan/123 /root\t#复制目录\ncp /tmp/japan/123.log /tmp/japan/456.log /tmp\t#复制多个文件\ncp -p /tmp/abc.log /tmp\t#保存文件的属性不变，比如最近修改的时间。\ncp /tmp/japan/abc.log /tmp/gaiming.log\t#拷贝并改名\n```\n\n### 2.1.7 移动、剪切：mv\n\n```shell\nmv /tmp/japan/123 /tmp\t#把123移动到/tmp目录下\nmv /tmp/japan/123 /tmp/us\t#移动并改名\nmv 123 456\t#当前目录下移动并改名，则是重命名\n```\n\n### 2.1.8 删除：rm\n\n```shell\nrm grab.conf\t#删除文件\nrm -f grab.conf\t#强制删除文件，不会询问是否确认。\nrm -r /tmp/japan\t#删除目录\n```\n\n## 2.2 文件处理命令\n\n### 2.2.1 新建文件：touch\n\n```shell\ntouch japanlovestory.list\t#新建文件\ntouch \"program files\" #创建带空格文件，不推荐带空格文件名\n```\n\n### 2.2.2 浏览短文件：cat\n\n```shell\ncat /etc/issue\t#显示内容\ncat -n /etc/issue\t#显示行号\n```\n\n### 2.2.3 按行反向显示浏览：tac\n\n### 2.2.4 分页浏览长文件：more\n\n```shell\nmore /etc/services\t#空格或f向下翻页，按行向下翻，按q退出，帮助信息都是调用more命令。\n```\n\n不能往上翻。\n\n### 2.2.5 可向上分页浏览：less\n\n```shell\nless /etc/services\t#向下翻页和more相同，按pgup向上翻页，上箭头向上一行。\n#搜索功能，浏览状态，输入“/service”，按“n”向下找搜索结果。\n\n```\n\n### 2.2.6 浏览文件前几行：head\n\n```shell\nhead /etc/services\t#默认显示前十行\nhead -n 7 /etc/services\t#显示前七行\n```\n\n### 2.2.7 浏览文件末尾几行：tail\n\n```shell\ntail /etc/services\t#显示末尾几行\ntail -n 7 /etc/services\t#显示指定行\ntail -f /var/log/messages\t#动态显示文件末尾几行\n```\n\n## 2.3 链接命令\n\n**生成链接文件：ln**\n\n```shell\nln -s /etc/issue /tmp/issue.soft\t#创建文件的软连接\nln /etc/issue /tmp/issue.hard\t#创建文件的硬链接\n```\n\n软连接：类似windows的快捷方式\n\n硬链接：硬链接和源文件属性相同，且同步更新，可以向硬链接中写入内容，删除源文件后，硬链接任然存在。硬链接的i节点与源文件相同。\n\n硬链接不能跨分区，生成对象不能是目录\n\n## 2.4 权限管理命令\n\n## 2.4.1 文件权限变更：chmod\n\n命令名称：chmod（change the permissions mode of a file）\n\n语法： chmod \\[{ugoa}\\]{+-=}\\[文件或目录\\]\n\n​\t\t\t\t\t\t\t\\[mode=421\\]\\[文件或目录\\]\n\n​\t\t\t\t\t\t\t-R 递归修改\n\n权限只有管理员root和所有者可以修改。\n\n```shell\nchmod g+w,o-r japan.list\t#所属组加读权限，其他人减少读权限\nchmod g=rwx japn.list\n```\n\n数字表述法：\n\n|  r   |  w   |  x   |\n| :--: | :--: | :--: |\n|  4   |  2   |  1   |\n\nrwxrw-r--对应权限：(4+2+1)(4+2)(4)=764\n\n```shell\nchmod -R 777 /tmp/abc\t#修改/tmp/abc及其下面的的所有文件的权限为777\n```\n\n> root用户创建的644权限文件，其他用户能否删除？\n>\n> 答案取决于用户是否具有文件所属的目录的写权限。\n\n比如：\n一个目录/temp权限为777\n\n文件/temp/testfile的权限为644。\n\n那么普通用户任然可以删除/temp/testfile，因为所有人都有/tmp目录的写权限，所以可以再/temp目录下新建文件、目录、删除目录和删除文件。\n\n|           | r读权限                 | w写权限              | x执行权限      |\n| --------- | ----------------------- | -------------------- | -------------- |\n| file      | cat/more/less/head/tail | vim                  | script command |\n| directory | ls                      | touch/mkdir/rmdir/rm | cd             |\n\n## 2.4.2 文件所有者变更：chown\n\n语法： chown [用户] [文件或目录]\n\n```shell\nuseradd shenchao\t#添加一个用户\nchown shenchao /tmp/japan\t#改变所有者\n```\n\n## 2.4.3 文件所属组变更：chgrp\n\n```shell\ngroupadd lampbrother\t#新建组\nchgrp lampbrother /tmp/japan\t#更改所属组\n```\n\n### 2.4.4 显示新建文件的缺省权限：umask\n\n```shell\numask -S\t#显示新建目录缺省权限\numask\t#显示新建目录缺省权限的与值\numask 077\t#修改新建文件的缺省权限为700.原理为，777与077得700\n```\n\n0022\n\n0：特殊权限\n\n022：--- -w- -w-\n\n则目录的权限为：777和022逻辑与的结果，等于755\n\n## 2.5 文件搜索命令\n\n### 2.5.1 文件搜索命令：find\n\n语法：find [搜索范围] [匹配条件]\n\n```shell\nfind /etc -name init\t#在/etc目录下搜索名为init的文件，initab不能被搜索到。\nfind /etc -name *init*\t#名字包含init就会被搜索，*作为通配符\nfind /etc -name int???\t#?\nfind /etc -iname init???\t#搜索名字不区分大小写。\n```\n\n```shell\nfind / -size +204800\t#查找大于100MB文件，按数据块算，一个数据块=0.5K。204800个数据块=100MB\n```\n\n```shell\nfind / -user shenchao\t#根据所有者查找\n```\n\n```shell\nfind /etc -cmin -5\t#根据文件属性5分钟内被改的文件查找 change\nfind /etc -amin -5\t#根据访问时间 access\nfind /etc -mmin -5\t#根据文件内容被改变 modify\n```\n\n```shell\nfind /etc -size +163840 -a -size -204800\t#查找大于80MB并且小于100MB的文件\nfind /etc -size +163840 -o -size -204800\t#查找大于80MB或者小于100MB的文件\n```\n\n```shell\nfind /etc -name init* -a -type f\t#查找类型为文件的init*对象\n```\n-exec/-ok 对搜索结果进行处理。-ok比-exec多了询问是否操作过程\n\n```shell\nfind /etc -name inittab -exec ls -l {} \\;\t#-exec 命令 {} \\;为固定格式\n```\n\n```shell\nfind /etc -inum 3442\t#根据i节点查找文件\nfind /etc -inum 3442 -exec rm {} \\;\t#删除i节点为3442的文件。可用于名字奇怪的文件\n```\n\n### 2.5.2 其他文件搜索命令：locate\n\n在文件资料库中查找文件，速度非常快。但是不能及时更新。\n\n```shell\nlocate inittab\t#查找inittab的位置\nlocate -i inittab\t#查找时不区分大小写\n```\n\n更新资料库\n\n```shell\nupdatedb\n```\n\n> locate无法收录/tmp目录下的文件\n\n### 2.5.3 命令文件搜索命令：which\n\n对命令使用\n\n```shell\nwhich cp\t#查找命令绝对路径的位置，并且得到命令是否有别命\n```\n\n### 2.5.4 命令文件搜索命令：whereis\n\n```shell\nwhereis rm\t#找到命令绝对路径，和命令的帮助文档所在位置\n```\n\n### 2.5.5 文件内容搜索命令：grep\n\n| 参数 | 作用         |\n| ---- | ------------ |\n| -i   | 不区分大小写 |\n| -v   | 排除指定字串 |\n\n\n\n```shell\ngrep multiuser /etc/inittab\t#查找文件中multiuser所在的行。\ngrep -v ^# /etc/inittab\t#排除指定字串所在的行，即以#开头的行，不希显示。\n```\n\n","slug":"Linux操作系统学习笔记","published":1,"updated":"2020-09-05T13:29:52.221Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaat000gp0vz7wmk0lfo","content":"<h1 id=\"1：Linux简介\"><a href=\"#1：Linux简介\" class=\"headerlink\" title=\"1：Linux简介\"></a>1：Linux简介</h1><p>开源软件：</p>\n<ul>\n<li>使用自由</li>\n<li>研究自由</li>\n<li>散布及改良的自由</li>\n</ul>\n<p>LAMP：Linux+Apache+Mysql+PHP</p>\n<p>网络配置：</p>\n<ul>\n<li>桥接：像一台真实电脑一样直接连接互联网</li>\n<li>NAT：类似于使用真实电脑的热点</li>\n<li>host only：只允许和真实机通行</li>\n</ul>\n<p><code>ifconfig eth0 192.168.118.2</code>//配置网卡和ip，如果配置为桥接，需要设置为局域网相同网段。此设置重启后失效。</p>\n<p>注意事项：</p>\n<ul>\n<li>Linux严格区分大小写</li>\n<li>Linux所有内容以文件形式保存，包括硬件。</li>\n</ul>\n<p><strong>Linux目录的作用</strong></p>\n<table>\n<thead>\n<tr>\n<th>目录名</th>\n<th>目录的作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>/bin/</td>\n<td>存放系统命令的目录，普通和超级用户都可以执行</td>\n</tr>\n<tr>\n<td>/sbin/</td>\n<td>保存和系统环境设置相关的指令，只有超级用户root能使用，但普通用户可以查看</td>\n</tr>\n<tr>\n<td>/usr/bin/</td>\n<td>单用户模式下不能使用，类似于win的安全模式</td>\n</tr>\n<tr>\n<td>/usr/sbin/</td>\n<td>超级用户才能使用</td>\n</tr>\n<tr>\n<td>/boot/</td>\n<td>系统启动目录，保存系统启动相关文件，如内核文件和启动引导程序</td>\n</tr>\n<tr>\n<td>/dev/</td>\n<td>设备文件保存位置，</td>\n</tr>\n<tr>\n<td>/etc/</td>\n<td>配置文件，默认保存在这</td>\n</tr>\n<tr>\n<td>/home/</td>\n<td>普通用户的家目录</td>\n</tr>\n<tr>\n<td>/lib/</td>\n<td>系统调用的函数库</td>\n</tr>\n<tr>\n<td>/lost+found/</td>\n<td>当系统意外崩溃或关机，产生一些文件碎片放在这里。系统启动时，fsck工具会检测这里。每个分区下都有自己的此文件</td>\n</tr>\n<tr>\n<td>/media/</td>\n<td>挂载目录，媒体设备</td>\n</tr>\n<tr>\n<td>/mnt/</td>\n<td>挂在如优盘、移动硬盘</td>\n</tr>\n<tr>\n<td>/misc/</td>\n<td>挂在NFS服务的共享目录</td>\n</tr>\n<tr>\n<td>/opt/</td>\n<td>第三方安装的软件保存位置。现在的习惯是，放在/usr/local/，类似于win中的Program Files文件夹。</td>\n</tr>\n<tr>\n<td>/proc/</td>\n<td>虚拟文件系统。存放在内存中，保存系统的内核、今后曾、外部设备状态、网络状态。不要再这里面写东西</td>\n</tr>\n<tr>\n<td>/sys/</td>\n<td>虚拟文件系统。内存中，保存内核相关</td>\n</tr>\n<tr>\n<td>/root/</td>\n<td>超级用户的家目录。普通用户在/home/</td>\n</tr>\n<tr>\n<td>/srv/</td>\n<td>服务数据目录。</td>\n</tr>\n<tr>\n<td>/tmp/</td>\n<td>临时目录。可以清空</td>\n</tr>\n<tr>\n<td>/usr/</td>\n<td>系统软件资源目录。unix software resource</td>\n</tr>\n<tr>\n<td>/var/</td>\n<td>动态数据保存目录。保存缓存、日志以及软件运行产生的文件。</td>\n</tr>\n</tbody></table>\n<h1 id=\"2：Linux常用命令\"><a href=\"#2：Linux常用命令\" class=\"headerlink\" title=\"2：Linux常用命令\"></a>2：Linux常用命令</h1><p><strong>命令格式</strong></p>\n<p>命令 [-选项] [参数]</p>\n<p>例： ls -la /etc</p>\n<p>说明：</p>\n<ol>\n<li><p>个别命令不遵守此格式</p>\n</li>\n<li><p>当有多个选项时，可以写在一起</p>\n</li>\n<li><p>简写选项与完整选项</p>\n<p>-a 等于 –all</p>\n</li>\n</ol>\n<h2 id=\"2-1-目录处理命令\"><a href=\"#2-1-目录处理命令\" class=\"headerlink\" title=\"2.1 目录处理命令\"></a>2.1 目录处理命令</h2><h3 id=\"2-1-1-展示子目录：ls\"><a href=\"#2-1-1-展示子目录：ls\" class=\"headerlink\" title=\"2.1.1 展示子目录：ls\"></a>2.1.1 展示子目录：ls</h3><p>命令名称：ls</p>\n<p>命令原意：list</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls\t#显示当前目录的非隐藏文件</span><br><span class=\"line\">ls -a\t#all，显示隐藏文件和非隐藏文件，隐藏文件文件名格式：.abc</span><br><span class=\"line\">ls /\t#查看根目录，/+文件路径可以查看任意位置</span><br><span class=\"line\">ls -l\t#long，长格式显示，显示文件的详细信息</span><br><span class=\"line\">ls -h\t#human,比如将文件大小单位列出来，人性化显示</span><br><span class=\"line\">ls -d\t#direct，只显示目录本身</span><br><span class=\"line\">ls -i\t#inode，展示i节点，文件的唯一身份标识</span><br></pre></td></tr></table></figure>\n\n<p>ls -l的结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">total 31056</span><br><span class=\"line\">-rwxr-xr-x  1 root root     3612 Jun 23 19:17 Aria2Drive.sh</span><br><span class=\"line\">权限 引用次数 文件所有者 文件所属组 文件大小(单位字节) 文件最近修改时间 文件名</span><br></pre></td></tr></table></figure>\n<p><strong>权限：-rw-r–r–</strong></p>\n<p>权限第一个参数：</p>\n<table>\n<thead>\n<tr>\n<th>-</th>\n<th>d</th>\n<th>l</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>文件</td>\n<td>文件夹</td>\n<td>软连接</td>\n</tr>\n</tbody></table>\n<p>剩余九个参数：</p>\n<table>\n<thead>\n<tr>\n<th>rw-</th>\n<th>r–</th>\n<th>r–</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u所有者权限</td>\n<td>g所属组权限</td>\n<td>o其他人</td>\n</tr>\n<tr>\n<td>r读</td>\n<td>w写</td>\n<td>x执行</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-1-2-新建目录：mkdir\"><a href=\"#2-1-2-新建目录：mkdir\" class=\"headerlink\" title=\"2.1.2 新建目录：mkdir\"></a>2.1.2 新建目录：mkdir</h3><p>命令名称：mkdir</p>\n<p>命令原意：创建文件目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /tmp/123</span><br><span class=\"line\">mkdir -p /tmp/japan/123\t#递归创建目录，japan目录原来也没有</span><br><span class=\"line\">mkdir -p /tmp/japan/123 /temp/japan/456\t#创建多个目录</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-1-3-切换目录：cd\"><a href=\"#2-1-3-切换目录：cd\" class=\"headerlink\" title=\"2.1.3 切换目录：cd\"></a>2.1.3 切换目录：cd</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /tmp/japan/123\t#切换到指定目录</span><br><span class=\"line\">cd .\t#表示当前目录</span><br><span class=\"line\">cd ..\t#回到上级目录</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-4-展示当前完整路径：pwd\"><a href=\"#2-1-4-展示当前完整路径：pwd\" class=\"headerlink\" title=\"2.1.4 展示当前完整路径：pwd\"></a>2.1.4 展示当前完整路径：pwd</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pwd\t#显示当前位置的完整路径</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-5-删除空目录：rmdir\"><a href=\"#2-1-5-删除空目录：rmdir\" class=\"headerlink\" title=\"2.1.5 删除空目录：rmdir\"></a>2.1.5 删除空目录：rmdir</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rmdir /tmp/japan/123</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-6-复制：cp\"><a href=\"#2-1-6-复制：cp\" class=\"headerlink\" title=\"2.1.6 复制：cp\"></a>2.1.6 复制：cp</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /etc/grab.conf /root\t#复制文件</span><br><span class=\"line\">cp -r /tmp/japan/123 /root\t#复制目录</span><br><span class=\"line\">cp /tmp/japan/123.log /tmp/japan/456.log /tmp\t#复制多个文件</span><br><span class=\"line\">cp -p /tmp/abc.log /tmp\t#保存文件的属性不变，比如最近修改的时间。</span><br><span class=\"line\">cp /tmp/japan/abc.log /tmp/gaiming.log\t#拷贝并改名</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-7-移动、剪切：mv\"><a href=\"#2-1-7-移动、剪切：mv\" class=\"headerlink\" title=\"2.1.7 移动、剪切：mv\"></a>2.1.7 移动、剪切：mv</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /tmp/japan/123 /tmp\t#把123移动到/tmp目录下</span><br><span class=\"line\">mv /tmp/japan/123 /tmp/us\t#移动并改名</span><br><span class=\"line\">mv 123 456\t#当前目录下移动并改名，则是重命名</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-8-删除：rm\"><a href=\"#2-1-8-删除：rm\" class=\"headerlink\" title=\"2.1.8 删除：rm\"></a>2.1.8 删除：rm</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm grab.conf\t#删除文件</span><br><span class=\"line\">rm -f grab.conf\t#强制删除文件，不会询问是否确认。</span><br><span class=\"line\">rm -r /tmp/japan\t#删除目录</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-文件处理命令\"><a href=\"#2-2-文件处理命令\" class=\"headerlink\" title=\"2.2 文件处理命令\"></a>2.2 文件处理命令</h2><h3 id=\"2-2-1-新建文件：touch\"><a href=\"#2-2-1-新建文件：touch\" class=\"headerlink\" title=\"2.2.1 新建文件：touch\"></a>2.2.1 新建文件：touch</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch japanlovestory.list\t#新建文件</span><br><span class=\"line\">touch &quot;program files&quot; #创建带空格文件，不推荐带空格文件名</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-2-浏览短文件：cat\"><a href=\"#2-2-2-浏览短文件：cat\" class=\"headerlink\" title=\"2.2.2 浏览短文件：cat\"></a>2.2.2 浏览短文件：cat</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/issue\t#显示内容</span><br><span class=\"line\">cat -n /etc/issue\t#显示行号</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-3-按行反向显示浏览：tac\"><a href=\"#2-2-3-按行反向显示浏览：tac\" class=\"headerlink\" title=\"2.2.3 按行反向显示浏览：tac\"></a>2.2.3 按行反向显示浏览：tac</h3><h3 id=\"2-2-4-分页浏览长文件：more\"><a href=\"#2-2-4-分页浏览长文件：more\" class=\"headerlink\" title=\"2.2.4 分页浏览长文件：more\"></a>2.2.4 分页浏览长文件：more</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">more /etc/services\t#空格或f向下翻页，按行向下翻，按q退出，帮助信息都是调用more命令。</span><br></pre></td></tr></table></figure>\n\n<p>不能往上翻。</p>\n<h3 id=\"2-2-5-可向上分页浏览：less\"><a href=\"#2-2-5-可向上分页浏览：less\" class=\"headerlink\" title=\"2.2.5 可向上分页浏览：less\"></a>2.2.5 可向上分页浏览：less</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">less /etc/services\t#向下翻页和more相同，按pgup向上翻页，上箭头向上一行。</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">搜索功能，浏览状态，输入“/service”，按“n”向下找搜索结果。</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-6-浏览文件前几行：head\"><a href=\"#2-2-6-浏览文件前几行：head\" class=\"headerlink\" title=\"2.2.6 浏览文件前几行：head\"></a>2.2.6 浏览文件前几行：head</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">head /etc/services\t#默认显示前十行</span><br><span class=\"line\">head -n 7 /etc/services\t#显示前七行</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-7-浏览文件末尾几行：tail\"><a href=\"#2-2-7-浏览文件末尾几行：tail\" class=\"headerlink\" title=\"2.2.7 浏览文件末尾几行：tail\"></a>2.2.7 浏览文件末尾几行：tail</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail /etc/services\t#显示末尾几行</span><br><span class=\"line\">tail -n 7 /etc/services\t#显示指定行</span><br><span class=\"line\">tail -f /var/log/messages\t#动态显示文件末尾几行</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-链接命令\"><a href=\"#2-3-链接命令\" class=\"headerlink\" title=\"2.3 链接命令\"></a>2.3 链接命令</h2><p><strong>生成链接文件：ln</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /etc/issue /tmp/issue.soft\t#创建文件的软连接</span><br><span class=\"line\">ln /etc/issue /tmp/issue.hard\t#创建文件的硬链接</span><br></pre></td></tr></table></figure>\n\n<p>软连接：类似windows的快捷方式</p>\n<p>硬链接：硬链接和源文件属性相同，且同步更新，可以向硬链接中写入内容，删除源文件后，硬链接任然存在。硬链接的i节点与源文件相同。</p>\n<p>硬链接不能跨分区，生成对象不能是目录</p>\n<h2 id=\"2-4-权限管理命令\"><a href=\"#2-4-权限管理命令\" class=\"headerlink\" title=\"2.4 权限管理命令\"></a>2.4 权限管理命令</h2><h2 id=\"2-4-1-文件权限变更：chmod\"><a href=\"#2-4-1-文件权限变更：chmod\" class=\"headerlink\" title=\"2.4.1 文件权限变更：chmod\"></a>2.4.1 文件权限变更：chmod</h2><p>命令名称：chmod（change the permissions mode of a file）</p>\n<p>语法： chmod [{ugoa}]{+-=}[文件或目录]</p>\n<p>​                            [mode=421][文件或目录]</p>\n<p>​                            -R 递归修改</p>\n<p>权限只有管理员root和所有者可以修改。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod g+w,o-r japan.list\t#所属组加读权限，其他人减少读权限</span><br><span class=\"line\">chmod g=rwx japn.list</span><br></pre></td></tr></table></figure>\n\n<p>数字表述法：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">r</th>\n<th align=\"center\">w</th>\n<th align=\"center\">x</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">4</td>\n<td align=\"center\">2</td>\n<td align=\"center\">1</td>\n</tr>\n</tbody></table>\n<p>rwxrw-r–对应权限：(4+2+1)(4+2)(4)=764</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod -R 777 /tmp/abc\t#修改/tmp/abc及其下面的的所有文件的权限为777</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>root用户创建的644权限文件，其他用户能否删除？</p>\n<p>答案取决于用户是否具有文件所属的目录的写权限。</p>\n</blockquote>\n<p>比如：<br>一个目录/temp权限为777</p>\n<p>文件/temp/testfile的权限为644。</p>\n<p>那么普通用户任然可以删除/temp/testfile，因为所有人都有/tmp目录的写权限，所以可以再/temp目录下新建文件、目录、删除目录和删除文件。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>r读权限</th>\n<th>w写权限</th>\n<th>x执行权限</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>file</td>\n<td>cat/more/less/head/tail</td>\n<td>vim</td>\n<td>script command</td>\n</tr>\n<tr>\n<td>directory</td>\n<td>ls</td>\n<td>touch/mkdir/rmdir/rm</td>\n<td>cd</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-4-2-文件所有者变更：chown\"><a href=\"#2-4-2-文件所有者变更：chown\" class=\"headerlink\" title=\"2.4.2 文件所有者变更：chown\"></a>2.4.2 文件所有者变更：chown</h2><p>语法： chown [用户] [文件或目录]</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd shenchao\t#添加一个用户</span><br><span class=\"line\">chown shenchao /tmp/japan\t#改变所有者</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-3-文件所属组变更：chgrp\"><a href=\"#2-4-3-文件所属组变更：chgrp\" class=\"headerlink\" title=\"2.4.3 文件所属组变更：chgrp\"></a>2.4.3 文件所属组变更：chgrp</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd lampbrother\t#新建组</span><br><span class=\"line\">chgrp lampbrother /tmp/japan\t#更改所属组</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-4-显示新建文件的缺省权限：umask\"><a href=\"#2-4-4-显示新建文件的缺省权限：umask\" class=\"headerlink\" title=\"2.4.4 显示新建文件的缺省权限：umask\"></a>2.4.4 显示新建文件的缺省权限：umask</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">umask -S\t#显示新建目录缺省权限</span><br><span class=\"line\">umask\t#显示新建目录缺省权限的与值</span><br><span class=\"line\">umask 077\t#修改新建文件的缺省权限为700.原理为，777与077得700</span><br></pre></td></tr></table></figure>\n\n<p>0022</p>\n<p>0：特殊权限</p>\n<p>022：— -w- -w-</p>\n<p>则目录的权限为：777和022逻辑与的结果，等于755</p>\n<h2 id=\"2-5-文件搜索命令\"><a href=\"#2-5-文件搜索命令\" class=\"headerlink\" title=\"2.5 文件搜索命令\"></a>2.5 文件搜索命令</h2><h3 id=\"2-5-1-文件搜索命令：find\"><a href=\"#2-5-1-文件搜索命令：find\" class=\"headerlink\" title=\"2.5.1 文件搜索命令：find\"></a>2.5.1 文件搜索命令：find</h3><p>语法：find [搜索范围] [匹配条件]</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -name init\t#在/etc目录下搜索名为init的文件，initab不能被搜索到。</span><br><span class=\"line\">find /etc -name *init*\t#名字包含init就会被搜索，*作为通配符</span><br><span class=\"line\">find /etc -name int???\t#?</span><br><span class=\"line\">find /etc -iname init???\t#搜索名字不区分大小写。</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -size +204800\t#查找大于100MB文件，按数据块算，一个数据块=0.5K。204800个数据块=100MB</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -user shenchao\t#根据所有者查找</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -cmin -5\t#根据文件属性5分钟内被改的文件查找 change</span><br><span class=\"line\">find /etc -amin -5\t#根据访问时间 access</span><br><span class=\"line\">find /etc -mmin -5\t#根据文件内容被改变 modify</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -size +163840 -a -size -204800\t#查找大于80MB并且小于100MB的文件</span><br><span class=\"line\">find /etc -size +163840 -o -size -204800\t#查找大于80MB或者小于100MB的文件</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -name init* -a -type f\t#查找类型为文件的init*对象</span><br></pre></td></tr></table></figure>\n<p>-exec/-ok 对搜索结果进行处理。-ok比-exec多了询问是否操作过程</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -name inittab -exec ls -l &#123;&#125; \\;\t#-exec 命令 &#123;&#125; \\;为固定格式</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -inum 3442\t#根据i节点查找文件</span><br><span class=\"line\">find /etc -inum 3442 -exec rm &#123;&#125; \\;\t#删除i节点为3442的文件。可用于名字奇怪的文件</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-2-其他文件搜索命令：locate\"><a href=\"#2-5-2-其他文件搜索命令：locate\" class=\"headerlink\" title=\"2.5.2 其他文件搜索命令：locate\"></a>2.5.2 其他文件搜索命令：locate</h3><p>在文件资料库中查找文件，速度非常快。但是不能及时更新。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">locate inittab\t#查找inittab的位置</span><br><span class=\"line\">locate -i inittab\t#查找时不区分大小写</span><br></pre></td></tr></table></figure>\n\n<p>更新资料库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">updatedb</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>locate无法收录/tmp目录下的文件</p>\n</blockquote>\n<h3 id=\"2-5-3-命令文件搜索命令：which\"><a href=\"#2-5-3-命令文件搜索命令：which\" class=\"headerlink\" title=\"2.5.3 命令文件搜索命令：which\"></a>2.5.3 命令文件搜索命令：which</h3><p>对命令使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which cp\t#查找命令绝对路径的位置，并且得到命令是否有别命</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-4-命令文件搜索命令：whereis\"><a href=\"#2-5-4-命令文件搜索命令：whereis\" class=\"headerlink\" title=\"2.5.4 命令文件搜索命令：whereis\"></a>2.5.4 命令文件搜索命令：whereis</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whereis rm\t#找到命令绝对路径，和命令的帮助文档所在位置</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-5-文件内容搜索命令：grep\"><a href=\"#2-5-5-文件内容搜索命令：grep\" class=\"headerlink\" title=\"2.5.5 文件内容搜索命令：grep\"></a>2.5.5 文件内容搜索命令：grep</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>-i</td>\n<td>不区分大小写</td>\n</tr>\n<tr>\n<td>-v</td>\n<td>排除指定字串</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep multiuser /etc/inittab\t#查找文件中multiuser所在的行。</span><br><span class=\"line\">grep -v ^# /etc/inittab\t#排除指定字串所在的行，即以#开头的行，不希显示。</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：Linux简介\"><a href=\"#1：Linux简介\" class=\"headerlink\" title=\"1：Linux简介\"></a>1：Linux简介</h1><p>开源软件：</p>\n<ul>\n<li>使用自由</li>\n<li>研究自由</li>\n<li>散布及改良的自由</li>\n</ul>\n<p>LAMP：Linux+Apache+Mysql+PHP</p>\n<p>网络配置：</p>\n<ul>\n<li>桥接：像一台真实电脑一样直接连接互联网</li>\n<li>NAT：类似于使用真实电脑的热点</li>\n<li>host only：只允许和真实机通行</li>\n</ul>\n<p><code>ifconfig eth0 192.168.118.2</code>//配置网卡和ip，如果配置为桥接，需要设置为局域网相同网段。此设置重启后失效。</p>\n<p>注意事项：</p>\n<ul>\n<li>Linux严格区分大小写</li>\n<li>Linux所有内容以文件形式保存，包括硬件。</li>\n</ul>\n<p><strong>Linux目录的作用</strong></p>\n<table>\n<thead>\n<tr>\n<th>目录名</th>\n<th>目录的作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>/bin/</td>\n<td>存放系统命令的目录，普通和超级用户都可以执行</td>\n</tr>\n<tr>\n<td>/sbin/</td>\n<td>保存和系统环境设置相关的指令，只有超级用户root能使用，但普通用户可以查看</td>\n</tr>\n<tr>\n<td>/usr/bin/</td>\n<td>单用户模式下不能使用，类似于win的安全模式</td>\n</tr>\n<tr>\n<td>/usr/sbin/</td>\n<td>超级用户才能使用</td>\n</tr>\n<tr>\n<td>/boot/</td>\n<td>系统启动目录，保存系统启动相关文件，如内核文件和启动引导程序</td>\n</tr>\n<tr>\n<td>/dev/</td>\n<td>设备文件保存位置，</td>\n</tr>\n<tr>\n<td>/etc/</td>\n<td>配置文件，默认保存在这</td>\n</tr>\n<tr>\n<td>/home/</td>\n<td>普通用户的家目录</td>\n</tr>\n<tr>\n<td>/lib/</td>\n<td>系统调用的函数库</td>\n</tr>\n<tr>\n<td>/lost+found/</td>\n<td>当系统意外崩溃或关机，产生一些文件碎片放在这里。系统启动时，fsck工具会检测这里。每个分区下都有自己的此文件</td>\n</tr>\n<tr>\n<td>/media/</td>\n<td>挂载目录，媒体设备</td>\n</tr>\n<tr>\n<td>/mnt/</td>\n<td>挂在如优盘、移动硬盘</td>\n</tr>\n<tr>\n<td>/misc/</td>\n<td>挂在NFS服务的共享目录</td>\n</tr>\n<tr>\n<td>/opt/</td>\n<td>第三方安装的软件保存位置。现在的习惯是，放在/usr/local/，类似于win中的Program Files文件夹。</td>\n</tr>\n<tr>\n<td>/proc/</td>\n<td>虚拟文件系统。存放在内存中，保存系统的内核、今后曾、外部设备状态、网络状态。不要再这里面写东西</td>\n</tr>\n<tr>\n<td>/sys/</td>\n<td>虚拟文件系统。内存中，保存内核相关</td>\n</tr>\n<tr>\n<td>/root/</td>\n<td>超级用户的家目录。普通用户在/home/</td>\n</tr>\n<tr>\n<td>/srv/</td>\n<td>服务数据目录。</td>\n</tr>\n<tr>\n<td>/tmp/</td>\n<td>临时目录。可以清空</td>\n</tr>\n<tr>\n<td>/usr/</td>\n<td>系统软件资源目录。unix software resource</td>\n</tr>\n<tr>\n<td>/var/</td>\n<td>动态数据保存目录。保存缓存、日志以及软件运行产生的文件。</td>\n</tr>\n</tbody></table>\n<h1 id=\"2：Linux常用命令\"><a href=\"#2：Linux常用命令\" class=\"headerlink\" title=\"2：Linux常用命令\"></a>2：Linux常用命令</h1><p><strong>命令格式</strong></p>\n<p>命令 [-选项] [参数]</p>\n<p>例： ls -la /etc</p>\n<p>说明：</p>\n<ol>\n<li><p>个别命令不遵守此格式</p>\n</li>\n<li><p>当有多个选项时，可以写在一起</p>\n</li>\n<li><p>简写选项与完整选项</p>\n<p>-a 等于 –all</p>\n</li>\n</ol>\n<h2 id=\"2-1-目录处理命令\"><a href=\"#2-1-目录处理命令\" class=\"headerlink\" title=\"2.1 目录处理命令\"></a>2.1 目录处理命令</h2><h3 id=\"2-1-1-展示子目录：ls\"><a href=\"#2-1-1-展示子目录：ls\" class=\"headerlink\" title=\"2.1.1 展示子目录：ls\"></a>2.1.1 展示子目录：ls</h3><p>命令名称：ls</p>\n<p>命令原意：list</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls\t#显示当前目录的非隐藏文件</span><br><span class=\"line\">ls -a\t#all，显示隐藏文件和非隐藏文件，隐藏文件文件名格式：.abc</span><br><span class=\"line\">ls /\t#查看根目录，/+文件路径可以查看任意位置</span><br><span class=\"line\">ls -l\t#long，长格式显示，显示文件的详细信息</span><br><span class=\"line\">ls -h\t#human,比如将文件大小单位列出来，人性化显示</span><br><span class=\"line\">ls -d\t#direct，只显示目录本身</span><br><span class=\"line\">ls -i\t#inode，展示i节点，文件的唯一身份标识</span><br></pre></td></tr></table></figure>\n\n<p>ls -l的结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">total 31056</span><br><span class=\"line\">-rwxr-xr-x  1 root root     3612 Jun 23 19:17 Aria2Drive.sh</span><br><span class=\"line\">权限 引用次数 文件所有者 文件所属组 文件大小(单位字节) 文件最近修改时间 文件名</span><br></pre></td></tr></table></figure>\n<p><strong>权限：-rw-r–r–</strong></p>\n<p>权限第一个参数：</p>\n<table>\n<thead>\n<tr>\n<th>-</th>\n<th>d</th>\n<th>l</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>文件</td>\n<td>文件夹</td>\n<td>软连接</td>\n</tr>\n</tbody></table>\n<p>剩余九个参数：</p>\n<table>\n<thead>\n<tr>\n<th>rw-</th>\n<th>r–</th>\n<th>r–</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u所有者权限</td>\n<td>g所属组权限</td>\n<td>o其他人</td>\n</tr>\n<tr>\n<td>r读</td>\n<td>w写</td>\n<td>x执行</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-1-2-新建目录：mkdir\"><a href=\"#2-1-2-新建目录：mkdir\" class=\"headerlink\" title=\"2.1.2 新建目录：mkdir\"></a>2.1.2 新建目录：mkdir</h3><p>命令名称：mkdir</p>\n<p>命令原意：创建文件目录</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /tmp/123</span><br><span class=\"line\">mkdir -p /tmp/japan/123\t#递归创建目录，japan目录原来也没有</span><br><span class=\"line\">mkdir -p /tmp/japan/123 /temp/japan/456\t#创建多个目录</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-1-3-切换目录：cd\"><a href=\"#2-1-3-切换目录：cd\" class=\"headerlink\" title=\"2.1.3 切换目录：cd\"></a>2.1.3 切换目录：cd</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /tmp/japan/123\t#切换到指定目录</span><br><span class=\"line\">cd .\t#表示当前目录</span><br><span class=\"line\">cd ..\t#回到上级目录</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-4-展示当前完整路径：pwd\"><a href=\"#2-1-4-展示当前完整路径：pwd\" class=\"headerlink\" title=\"2.1.4 展示当前完整路径：pwd\"></a>2.1.4 展示当前完整路径：pwd</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pwd\t#显示当前位置的完整路径</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-5-删除空目录：rmdir\"><a href=\"#2-1-5-删除空目录：rmdir\" class=\"headerlink\" title=\"2.1.5 删除空目录：rmdir\"></a>2.1.5 删除空目录：rmdir</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rmdir /tmp/japan/123</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-6-复制：cp\"><a href=\"#2-1-6-复制：cp\" class=\"headerlink\" title=\"2.1.6 复制：cp\"></a>2.1.6 复制：cp</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /etc/grab.conf /root\t#复制文件</span><br><span class=\"line\">cp -r /tmp/japan/123 /root\t#复制目录</span><br><span class=\"line\">cp /tmp/japan/123.log /tmp/japan/456.log /tmp\t#复制多个文件</span><br><span class=\"line\">cp -p /tmp/abc.log /tmp\t#保存文件的属性不变，比如最近修改的时间。</span><br><span class=\"line\">cp /tmp/japan/abc.log /tmp/gaiming.log\t#拷贝并改名</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-7-移动、剪切：mv\"><a href=\"#2-1-7-移动、剪切：mv\" class=\"headerlink\" title=\"2.1.7 移动、剪切：mv\"></a>2.1.7 移动、剪切：mv</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /tmp/japan/123 /tmp\t#把123移动到/tmp目录下</span><br><span class=\"line\">mv /tmp/japan/123 /tmp/us\t#移动并改名</span><br><span class=\"line\">mv 123 456\t#当前目录下移动并改名，则是重命名</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-8-删除：rm\"><a href=\"#2-1-8-删除：rm\" class=\"headerlink\" title=\"2.1.8 删除：rm\"></a>2.1.8 删除：rm</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm grab.conf\t#删除文件</span><br><span class=\"line\">rm -f grab.conf\t#强制删除文件，不会询问是否确认。</span><br><span class=\"line\">rm -r /tmp/japan\t#删除目录</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-文件处理命令\"><a href=\"#2-2-文件处理命令\" class=\"headerlink\" title=\"2.2 文件处理命令\"></a>2.2 文件处理命令</h2><h3 id=\"2-2-1-新建文件：touch\"><a href=\"#2-2-1-新建文件：touch\" class=\"headerlink\" title=\"2.2.1 新建文件：touch\"></a>2.2.1 新建文件：touch</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch japanlovestory.list\t#新建文件</span><br><span class=\"line\">touch &quot;program files&quot; #创建带空格文件，不推荐带空格文件名</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-2-浏览短文件：cat\"><a href=\"#2-2-2-浏览短文件：cat\" class=\"headerlink\" title=\"2.2.2 浏览短文件：cat\"></a>2.2.2 浏览短文件：cat</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/issue\t#显示内容</span><br><span class=\"line\">cat -n /etc/issue\t#显示行号</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-3-按行反向显示浏览：tac\"><a href=\"#2-2-3-按行反向显示浏览：tac\" class=\"headerlink\" title=\"2.2.3 按行反向显示浏览：tac\"></a>2.2.3 按行反向显示浏览：tac</h3><h3 id=\"2-2-4-分页浏览长文件：more\"><a href=\"#2-2-4-分页浏览长文件：more\" class=\"headerlink\" title=\"2.2.4 分页浏览长文件：more\"></a>2.2.4 分页浏览长文件：more</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">more /etc/services\t#空格或f向下翻页，按行向下翻，按q退出，帮助信息都是调用more命令。</span><br></pre></td></tr></table></figure>\n\n<p>不能往上翻。</p>\n<h3 id=\"2-2-5-可向上分页浏览：less\"><a href=\"#2-2-5-可向上分页浏览：less\" class=\"headerlink\" title=\"2.2.5 可向上分页浏览：less\"></a>2.2.5 可向上分页浏览：less</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">less /etc/services\t#向下翻页和more相同，按pgup向上翻页，上箭头向上一行。</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">搜索功能，浏览状态，输入“/service”，按“n”向下找搜索结果。</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-6-浏览文件前几行：head\"><a href=\"#2-2-6-浏览文件前几行：head\" class=\"headerlink\" title=\"2.2.6 浏览文件前几行：head\"></a>2.2.6 浏览文件前几行：head</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">head /etc/services\t#默认显示前十行</span><br><span class=\"line\">head -n 7 /etc/services\t#显示前七行</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-7-浏览文件末尾几行：tail\"><a href=\"#2-2-7-浏览文件末尾几行：tail\" class=\"headerlink\" title=\"2.2.7 浏览文件末尾几行：tail\"></a>2.2.7 浏览文件末尾几行：tail</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail /etc/services\t#显示末尾几行</span><br><span class=\"line\">tail -n 7 /etc/services\t#显示指定行</span><br><span class=\"line\">tail -f /var/log/messages\t#动态显示文件末尾几行</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-链接命令\"><a href=\"#2-3-链接命令\" class=\"headerlink\" title=\"2.3 链接命令\"></a>2.3 链接命令</h2><p><strong>生成链接文件：ln</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /etc/issue /tmp/issue.soft\t#创建文件的软连接</span><br><span class=\"line\">ln /etc/issue /tmp/issue.hard\t#创建文件的硬链接</span><br></pre></td></tr></table></figure>\n\n<p>软连接：类似windows的快捷方式</p>\n<p>硬链接：硬链接和源文件属性相同，且同步更新，可以向硬链接中写入内容，删除源文件后，硬链接任然存在。硬链接的i节点与源文件相同。</p>\n<p>硬链接不能跨分区，生成对象不能是目录</p>\n<h2 id=\"2-4-权限管理命令\"><a href=\"#2-4-权限管理命令\" class=\"headerlink\" title=\"2.4 权限管理命令\"></a>2.4 权限管理命令</h2><h2 id=\"2-4-1-文件权限变更：chmod\"><a href=\"#2-4-1-文件权限变更：chmod\" class=\"headerlink\" title=\"2.4.1 文件权限变更：chmod\"></a>2.4.1 文件权限变更：chmod</h2><p>命令名称：chmod（change the permissions mode of a file）</p>\n<p>语法： chmod [{ugoa}]{+-=}[文件或目录]</p>\n<p>​                            [mode=421][文件或目录]</p>\n<p>​                            -R 递归修改</p>\n<p>权限只有管理员root和所有者可以修改。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod g+w,o-r japan.list\t#所属组加读权限，其他人减少读权限</span><br><span class=\"line\">chmod g=rwx japn.list</span><br></pre></td></tr></table></figure>\n\n<p>数字表述法：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">r</th>\n<th align=\"center\">w</th>\n<th align=\"center\">x</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">4</td>\n<td align=\"center\">2</td>\n<td align=\"center\">1</td>\n</tr>\n</tbody></table>\n<p>rwxrw-r–对应权限：(4+2+1)(4+2)(4)=764</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod -R 777 /tmp/abc\t#修改/tmp/abc及其下面的的所有文件的权限为777</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>root用户创建的644权限文件，其他用户能否删除？</p>\n<p>答案取决于用户是否具有文件所属的目录的写权限。</p>\n</blockquote>\n<p>比如：<br>一个目录/temp权限为777</p>\n<p>文件/temp/testfile的权限为644。</p>\n<p>那么普通用户任然可以删除/temp/testfile，因为所有人都有/tmp目录的写权限，所以可以再/temp目录下新建文件、目录、删除目录和删除文件。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>r读权限</th>\n<th>w写权限</th>\n<th>x执行权限</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>file</td>\n<td>cat/more/less/head/tail</td>\n<td>vim</td>\n<td>script command</td>\n</tr>\n<tr>\n<td>directory</td>\n<td>ls</td>\n<td>touch/mkdir/rmdir/rm</td>\n<td>cd</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-4-2-文件所有者变更：chown\"><a href=\"#2-4-2-文件所有者变更：chown\" class=\"headerlink\" title=\"2.4.2 文件所有者变更：chown\"></a>2.4.2 文件所有者变更：chown</h2><p>语法： chown [用户] [文件或目录]</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd shenchao\t#添加一个用户</span><br><span class=\"line\">chown shenchao /tmp/japan\t#改变所有者</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-3-文件所属组变更：chgrp\"><a href=\"#2-4-3-文件所属组变更：chgrp\" class=\"headerlink\" title=\"2.4.3 文件所属组变更：chgrp\"></a>2.4.3 文件所属组变更：chgrp</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd lampbrother\t#新建组</span><br><span class=\"line\">chgrp lampbrother /tmp/japan\t#更改所属组</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-4-显示新建文件的缺省权限：umask\"><a href=\"#2-4-4-显示新建文件的缺省权限：umask\" class=\"headerlink\" title=\"2.4.4 显示新建文件的缺省权限：umask\"></a>2.4.4 显示新建文件的缺省权限：umask</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">umask -S\t#显示新建目录缺省权限</span><br><span class=\"line\">umask\t#显示新建目录缺省权限的与值</span><br><span class=\"line\">umask 077\t#修改新建文件的缺省权限为700.原理为，777与077得700</span><br></pre></td></tr></table></figure>\n\n<p>0022</p>\n<p>0：特殊权限</p>\n<p>022：— -w- -w-</p>\n<p>则目录的权限为：777和022逻辑与的结果，等于755</p>\n<h2 id=\"2-5-文件搜索命令\"><a href=\"#2-5-文件搜索命令\" class=\"headerlink\" title=\"2.5 文件搜索命令\"></a>2.5 文件搜索命令</h2><h3 id=\"2-5-1-文件搜索命令：find\"><a href=\"#2-5-1-文件搜索命令：find\" class=\"headerlink\" title=\"2.5.1 文件搜索命令：find\"></a>2.5.1 文件搜索命令：find</h3><p>语法：find [搜索范围] [匹配条件]</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -name init\t#在/etc目录下搜索名为init的文件，initab不能被搜索到。</span><br><span class=\"line\">find /etc -name *init*\t#名字包含init就会被搜索，*作为通配符</span><br><span class=\"line\">find /etc -name int???\t#?</span><br><span class=\"line\">find /etc -iname init???\t#搜索名字不区分大小写。</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -size +204800\t#查找大于100MB文件，按数据块算，一个数据块=0.5K。204800个数据块=100MB</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -user shenchao\t#根据所有者查找</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -cmin -5\t#根据文件属性5分钟内被改的文件查找 change</span><br><span class=\"line\">find /etc -amin -5\t#根据访问时间 access</span><br><span class=\"line\">find /etc -mmin -5\t#根据文件内容被改变 modify</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -size +163840 -a -size -204800\t#查找大于80MB并且小于100MB的文件</span><br><span class=\"line\">find /etc -size +163840 -o -size -204800\t#查找大于80MB或者小于100MB的文件</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -name init* -a -type f\t#查找类型为文件的init*对象</span><br></pre></td></tr></table></figure>\n<p>-exec/-ok 对搜索结果进行处理。-ok比-exec多了询问是否操作过程</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -name inittab -exec ls -l &#123;&#125; \\;\t#-exec 命令 &#123;&#125; \\;为固定格式</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /etc -inum 3442\t#根据i节点查找文件</span><br><span class=\"line\">find /etc -inum 3442 -exec rm &#123;&#125; \\;\t#删除i节点为3442的文件。可用于名字奇怪的文件</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-2-其他文件搜索命令：locate\"><a href=\"#2-5-2-其他文件搜索命令：locate\" class=\"headerlink\" title=\"2.5.2 其他文件搜索命令：locate\"></a>2.5.2 其他文件搜索命令：locate</h3><p>在文件资料库中查找文件，速度非常快。但是不能及时更新。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">locate inittab\t#查找inittab的位置</span><br><span class=\"line\">locate -i inittab\t#查找时不区分大小写</span><br></pre></td></tr></table></figure>\n\n<p>更新资料库</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">updatedb</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>locate无法收录/tmp目录下的文件</p>\n</blockquote>\n<h3 id=\"2-5-3-命令文件搜索命令：which\"><a href=\"#2-5-3-命令文件搜索命令：which\" class=\"headerlink\" title=\"2.5.3 命令文件搜索命令：which\"></a>2.5.3 命令文件搜索命令：which</h3><p>对命令使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which cp\t#查找命令绝对路径的位置，并且得到命令是否有别命</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-4-命令文件搜索命令：whereis\"><a href=\"#2-5-4-命令文件搜索命令：whereis\" class=\"headerlink\" title=\"2.5.4 命令文件搜索命令：whereis\"></a>2.5.4 命令文件搜索命令：whereis</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whereis rm\t#找到命令绝对路径，和命令的帮助文档所在位置</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-5-文件内容搜索命令：grep\"><a href=\"#2-5-5-文件内容搜索命令：grep\" class=\"headerlink\" title=\"2.5.5 文件内容搜索命令：grep\"></a>2.5.5 文件内容搜索命令：grep</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>-i</td>\n<td>不区分大小写</td>\n</tr>\n<tr>\n<td>-v</td>\n<td>排除指定字串</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep multiuser /etc/inittab\t#查找文件中multiuser所在的行。</span><br><span class=\"line\">grep -v ^# /etc/inittab\t#排除指定字串所在的行，即以#开头的行，不希显示。</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Sep 05 2020 15:29:52 GMT+0200 (GMT+02:00)","title":"Linux操作系统","path":"2020/02/20/Linux操作系统学习笔记/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-02-20T16:40:28.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-20T16:40:28.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Linux"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Oneindex+YAAW增加后台离线上传","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-25T09:07:03.000Z","password":null,"summary":"将Yaaw嵌入到Oneindex后台，同时，利用在服务器上部署的Aria2+Rclone，实现离线上床文件到Onedrive","_content":"\n\n\n# 一：简介\n\nYaaw是个开源的aria2的WebUI，通过这个UI可以使用aria2的rpc功能，向aria2发送下载某文件的指令。我将yaaw嵌入到了Oneindex后台，同时在前台也部署了yaaw供游客使用。\n\n项目地址：https://github.com/xieqifei/OneindexN\n\nDemo：https://pan.sci.ci\n\n后台预览：\n\n![](https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png)\n\n# 二：部署网站\n\n网站环境尽量使用nginx。后面会用nginx做反代，可以避免修改yaaw的rpc参数。\n\n在github上将网站下载下来。可以直接下载为zip压缩包\n\n![](https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png)\n\n将文件解压到网站根目录。\n\n进入网站首页。配置网站。\n\n# 三：修改Nginx配置\n\n添加\n\n```\nlocation /jsonrpc {\n        proxy_pass http://localhost:6800/jsonrpc;\n        proxy_redirect off;\n        proxy_set_header        X-Real-IP       $remote_addr;\n        proxy_set_header        X-Forwarded-For\n        $proxy_add_x_forwarded_for;\n        proxy_set_header Host $host;\n\t}\n```\n\n这样RPC可以配置为`http://yoursite/jsonrpc`。网站后台默认的RPC就是`http://yoursite/jsonrpc`\n\n![](https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png)\n\n**关闭aria2远程RPC**\n\n仅本地也就是443转发的请求能到达6800。\n\n```shell\nvim /root/.aria2c/aria2.conf\n```\n\n修改aria2配置内容\n\n```\n# 启用RPC, 默认:false\nenable-rpc=true\n# 接受所有远程请求, 默认:false\nrpc-allow-origin-all=false\n# 允许外部访问, 默认:false\nrpc-listen-all=false\n# RPC监听端口, 端口被占用时可以修改, 默认:6800\nrpc-listen-port=6800\n```\n\n> 如果不配置nginx，需要自己修改RPC设置。并且aria2配置需要开放远程RPC\n\n# 四：参考资料\n\n《[github YAAW项目](https://github.com/binux/yaaw)》\n\n《[Issue：一旦使用HTTPS协议就无法连接](https://github.com/mayswind/AriaNg/issues/62)》\n\n《[Nginx 反向代理 Aria2 JSONRPC](https://kenvix.com/post/nginx-proxy-aria2/)》","source":"_posts/Oneindex-YAAW增加后台离线上传.md","raw":"---\ntitle: Oneindex+YAAW增加后台离线上传\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-25 11:07:03\npassword:\nsummary: 将Yaaw嵌入到Oneindex后台，同时，利用在服务器上部署的Aria2+Rclone，实现离线上床文件到Onedrive\ntags:\n - YAAW\n - Oneindex\ncategories: 网站编程\n---\n\n\n\n# 一：简介\n\nYaaw是个开源的aria2的WebUI，通过这个UI可以使用aria2的rpc功能，向aria2发送下载某文件的指令。我将yaaw嵌入到了Oneindex后台，同时在前台也部署了yaaw供游客使用。\n\n项目地址：https://github.com/xieqifei/OneindexN\n\nDemo：https://pan.sci.ci\n\n后台预览：\n\n![](https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png)\n\n# 二：部署网站\n\n网站环境尽量使用nginx。后面会用nginx做反代，可以避免修改yaaw的rpc参数。\n\n在github上将网站下载下来。可以直接下载为zip压缩包\n\n![](https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png)\n\n将文件解压到网站根目录。\n\n进入网站首页。配置网站。\n\n# 三：修改Nginx配置\n\n添加\n\n```\nlocation /jsonrpc {\n        proxy_pass http://localhost:6800/jsonrpc;\n        proxy_redirect off;\n        proxy_set_header        X-Real-IP       $remote_addr;\n        proxy_set_header        X-Forwarded-For\n        $proxy_add_x_forwarded_for;\n        proxy_set_header Host $host;\n\t}\n```\n\n这样RPC可以配置为`http://yoursite/jsonrpc`。网站后台默认的RPC就是`http://yoursite/jsonrpc`\n\n![](https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png)\n\n**关闭aria2远程RPC**\n\n仅本地也就是443转发的请求能到达6800。\n\n```shell\nvim /root/.aria2c/aria2.conf\n```\n\n修改aria2配置内容\n\n```\n# 启用RPC, 默认:false\nenable-rpc=true\n# 接受所有远程请求, 默认:false\nrpc-allow-origin-all=false\n# 允许外部访问, 默认:false\nrpc-listen-all=false\n# RPC监听端口, 端口被占用时可以修改, 默认:6800\nrpc-listen-port=6800\n```\n\n> 如果不配置nginx，需要自己修改RPC设置。并且aria2配置需要开放远程RPC\n\n# 四：参考资料\n\n《[github YAAW项目](https://github.com/binux/yaaw)》\n\n《[Issue：一旦使用HTTPS协议就无法连接](https://github.com/mayswind/AriaNg/issues/62)》\n\n《[Nginx 反向代理 Aria2 JSONRPC](https://kenvix.com/post/nginx-proxy-aria2/)》","slug":"Oneindex-YAAW增加后台离线上传","published":1,"updated":"2020-06-25T04:05:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaav000ip0vzd8v28eo1","content":"<h1 id=\"一：简介\"><a href=\"#一：简介\" class=\"headerlink\" title=\"一：简介\"></a>一：简介</h1><p>Yaaw是个开源的aria2的WebUI，通过这个UI可以使用aria2的rpc功能，向aria2发送下载某文件的指令。我将yaaw嵌入到了Oneindex后台，同时在前台也部署了yaaw供游客使用。</p>\n<p>项目地址：<a href=\"https://github.com/xieqifei/OneindexN\">https://github.com/xieqifei/OneindexN</a></p>\n<p>Demo：<a href=\"https://pan.sci.ci/\">https://pan.sci.ci</a></p>\n<p>后台预览：</p>\n<p><img src=\"https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h1 id=\"二：部署网站\"><a href=\"#二：部署网站\" class=\"headerlink\" title=\"二：部署网站\"></a>二：部署网站</h1><p>网站环境尽量使用nginx。后面会用nginx做反代，可以避免修改yaaw的rpc参数。</p>\n<p>在github上将网站下载下来。可以直接下载为zip压缩包</p>\n<p><img src=\"https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>将文件解压到网站根目录。</p>\n<p>进入网站首页。配置网站。</p>\n<h1 id=\"三：修改Nginx配置\"><a href=\"#三：修改Nginx配置\" class=\"headerlink\" title=\"三：修改Nginx配置\"></a>三：修改Nginx配置</h1><p>添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location &#x2F;jsonrpc &#123;</span><br><span class=\"line\">        proxy_pass http:&#x2F;&#x2F;localhost:6800&#x2F;jsonrpc;</span><br><span class=\"line\">        proxy_redirect off;</span><br><span class=\"line\">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class=\"line\">        proxy_set_header        X-Forwarded-For</span><br><span class=\"line\">        $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样RPC可以配置为<code>http://yoursite/jsonrpc</code>。网站后台默认的RPC就是<code>http://yoursite/jsonrpc</code></p>\n<p><img src=\"https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>关闭aria2远程RPC</strong></p>\n<p>仅本地也就是443转发的请求能到达6800。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /root/.aria2c/aria2.conf</span><br></pre></td></tr></table></figure>\n\n<p>修改aria2配置内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 启用RPC, 默认:false</span><br><span class=\"line\">enable-rpc&#x3D;true</span><br><span class=\"line\"># 接受所有远程请求, 默认:false</span><br><span class=\"line\">rpc-allow-origin-all&#x3D;false</span><br><span class=\"line\"># 允许外部访问, 默认:false</span><br><span class=\"line\">rpc-listen-all&#x3D;false</span><br><span class=\"line\"># RPC监听端口, 端口被占用时可以修改, 默认:6800</span><br><span class=\"line\">rpc-listen-port&#x3D;6800</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>如果不配置nginx，需要自己修改RPC设置。并且aria2配置需要开放远程RPC</p>\n</blockquote>\n<h1 id=\"四：参考资料\"><a href=\"#四：参考资料\" class=\"headerlink\" title=\"四：参考资料\"></a>四：参考资料</h1><p>《<a href=\"https://github.com/binux/yaaw\">github YAAW项目</a>》</p>\n<p>《<a href=\"https://github.com/mayswind/AriaNg/issues/62\">Issue：一旦使用HTTPS协议就无法连接</a>》</p>\n<p>《<a href=\"https://kenvix.com/post/nginx-proxy-aria2/\">Nginx 反向代理 Aria2 JSONRPC</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"一：简介\"><a href=\"#一：简介\" class=\"headerlink\" title=\"一：简介\"></a>一：简介</h1><p>Yaaw是个开源的aria2的WebUI，通过这个UI可以使用aria2的rpc功能，向aria2发送下载某文件的指令。我将yaaw嵌入到了Oneindex后台，同时在前台也部署了yaaw供游客使用。</p>\n<p>项目地址：<a href=\"https://github.com/xieqifei/OneindexN\">https://github.com/xieqifei/OneindexN</a></p>\n<p>Demo：<a href=\"https://pan.sci.ci/\">https://pan.sci.ci</a></p>\n<p>后台预览：</p>\n<p><img src=\"https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png\"></p>\n<h1 id=\"二：部署网站\"><a href=\"#二：部署网站\" class=\"headerlink\" title=\"二：部署网站\"></a>二：部署网站</h1><p>网站环境尽量使用nginx。后面会用nginx做反代，可以避免修改yaaw的rpc参数。</p>\n<p>在github上将网站下载下来。可以直接下载为zip压缩包</p>\n<p><img src=\"https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png\"></p>\n<p>将文件解压到网站根目录。</p>\n<p>进入网站首页。配置网站。</p>\n<h1 id=\"三：修改Nginx配置\"><a href=\"#三：修改Nginx配置\" class=\"headerlink\" title=\"三：修改Nginx配置\"></a>三：修改Nginx配置</h1><p>添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location &#x2F;jsonrpc &#123;</span><br><span class=\"line\">        proxy_pass http:&#x2F;&#x2F;localhost:6800&#x2F;jsonrpc;</span><br><span class=\"line\">        proxy_redirect off;</span><br><span class=\"line\">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class=\"line\">        proxy_set_header        X-Forwarded-For</span><br><span class=\"line\">        $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样RPC可以配置为<code>http://yoursite/jsonrpc</code>。网站后台默认的RPC就是<code>http://yoursite/jsonrpc</code></p>\n<p><img src=\"https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png\"></p>\n<p><strong>关闭aria2远程RPC</strong></p>\n<p>仅本地也就是443转发的请求能到达6800。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /root/.aria2c/aria2.conf</span><br></pre></td></tr></table></figure>\n\n<p>修改aria2配置内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 启用RPC, 默认:false</span><br><span class=\"line\">enable-rpc&#x3D;true</span><br><span class=\"line\"># 接受所有远程请求, 默认:false</span><br><span class=\"line\">rpc-allow-origin-all&#x3D;false</span><br><span class=\"line\"># 允许外部访问, 默认:false</span><br><span class=\"line\">rpc-listen-all&#x3D;false</span><br><span class=\"line\"># RPC监听端口, 端口被占用时可以修改, 默认:6800</span><br><span class=\"line\">rpc-listen-port&#x3D;6800</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>如果不配置nginx，需要自己修改RPC设置。并且aria2配置需要开放远程RPC</p>\n</blockquote>\n<h1 id=\"四：参考资料\"><a href=\"#四：参考资料\" class=\"headerlink\" title=\"四：参考资料\"></a>四：参考资料</h1><p>《<a href=\"https://github.com/binux/yaaw\">github YAAW项目</a>》</p>\n<p>《<a href=\"https://github.com/mayswind/AriaNg/issues/62\">Issue：一旦使用HTTPS协议就无法连接</a>》</p>\n<p>《<a href=\"https://kenvix.com/post/nginx-proxy-aria2/\">Nginx 反向代理 Aria2 JSONRPC</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png","popularPost_tmp_gaData":{"updated":"Thu Jun 25 2020 06:05:20 GMT+0200 (GMT+02:00)","title":"Oneindex+YAAW增加后台离线上传","path":"2020/06/25/Oneindex-YAAW增加后台离线上传/","eyeCatchImage":"https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-25T09:07:03.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-25T09:07:03.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["YAAW","Oneindex"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Oneindex自建不限速网盘","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-22T09:46:34.000Z","password":null,"summary":"使用免费的000webhost虚拟主机，搭建一个小型的在线网盘。用到github上的开源程序Oneindex，以及微软的onedrive网盘。onedrive，提供5g的容量，通过邀请好友加入可以扩容到最多15G，也可以花钱升级。网盘支持文件夹加密，README，更换主题，后台管理。","_content":"\n![](https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png)\n\n不占用服务器空间，不走服务器流量，  \n\n直接列出 OneDrive 目录，文件直链下载。\n\n# 一：注册申请000webhost免费主机\n\n进入 https://www.000webhost.com/\n\n注册后，在我的网站里创建新网站。\n\n![](https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png)\n\n创建成功后，打开网站后台。\n\n点击`File Manager`，或者直接输入网址 https://files.000webhost.com \n\n![](https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png)\n\n连接你的网站ftp\n\n输入你的网站名称和密码\n\n![](https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png)\n\n![](https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png)\n\n`/public_html`就是网站的根目录。将网页的index应放在此目录下\n\n# 二：下载和上传网页\n\n下载程序源码：https://wwa.lanzous.com/ikFHMdxgkeb\n\n确保`public_html`目录里没有任何文件。\n\n在网站文件管理页面，点击上传文件(upload files)的图标。将压缩包上传到`public_html`。\n\n选择文件右键选择解压(extract)。将解压后的所有文件即index.php所在的文件目录下所有的文件移动到`public_html`\n\n最终结果应如图所示。\n\n![](https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png)\n\n# 三：绑定自己的域名\n\nwebhost给的免费域名是`webname.000webhostapp.com`，需要自行设置cname解析。解析步骤就不说了。不会的可自行百度。\n\ncname添加后，还需要在webhost后台设置白名单才能生效。\n\n在000webhost网站管理后台中，点击`Website Settings`->`General`。\n\n![](https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png)\n\n在`Website Name`下面有一段英文，`you can change the name of your website here `。点击here。进入修改域名界面\n\n![](https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png)\n\n添加你cname解析的域名\n\n![](https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png)\n\n# 四：安装配置oneindex\n\n打开你的网盘网页，比如我的 http://pan.sci.ci\n\n按照提示配置。\n\n其中应用密钥和id，需要你点击网站给的链接获取。密钥获取结束后，点击密钥界面的回退按钮，在回退的网页里就能找到应用id。\n\n<img width=\"658\" alt=\"image\" src=\"https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif\">  \n\n# 五：oneindex其他操作\n\nonedrive文件管理：https://onedrive.live.com\n\n## 5.1 计划任务  \n\n[可选]**推荐配置**，非必需。后台定时刷新缓存，可增加前台访问的速度。  \n\n```\n# 每小时刷新一次token\n0 * * * * /具体路径/php /程序具体路径/one.php token:refresh\n\n# 每十分钟后台刷新一遍缓存\n*/10 * * * * /具体路径/php /程序具体路径/one.php cache:refresh\n```\n\n## 5.2 Docker 安装运行\n\n- 请参考[TimeBye/oneindex](https://github.com/TimeBye/oneindex)\n\n## 5.3 特殊文件实现功能  \n\n` README.md `、`HEAD.md` 、 `.password`特殊文件使用  \n\n可以参考[https://github.com/donwa/oneindex/tree/files](https://github.com/donwa/oneindex/tree/files)  \n\n**在文件夹底部添加说明:**  \n\n>在 OneDrive 的文件夹中添加` README.md `文件，使用 Markdown 语法。  \n\n**在文件夹头部添加说明:**  \n\n>在 OneDrive 的文件夹中添加`HEAD.md` 文件，使用 Markdown 语法。  \n\n**加密文件夹:**  \n\n>在 OneDrive 的文件夹中添加`.password`文件，填入密码，密码不能为空。  \n\n**直接输出网页:**  \n\n>在 OneDrive 的文件夹中添加`index.html` 文件，程序会直接输出网页而不列目录。  \n>配合 文件展示设置-直接输出 效果更佳。  \n\n## 5.4 命令行功能  \n\n仅能在PHP CLI模式下运行  \n\n**清除缓存:**  \n\n```\nphp one.php cache:clear\n```\n\n**刷新缓存:**  \n\n```\nphp one.php cache:refresh\n```\n\n**刷新令牌:**  \n\n```\nphp one.php token:refresh\n```\n\n**上传文件:**  \n\n```\nphp one.php upload:file 本地文件 [OneDrive文件]\n```\n\n\n**上传文件夹:**  \n\n```\nphp one.php upload:folder 本地文件夹 [OneDrive文件夹]\n```\n\n例如：  \n\n```\n//上传demo.zip 到OneDrive 根目录  \nphp one.php upload:file demo.zip  \n\n//上传demo.zip 到OneDrive /test/目录  \nphp one.php upload:file demo.zip /test/  \n\n//上传demo.zip 到OneDrive /test/目录并将其命名为 d.zip  \nphp one.php upload:file demo.zip /test/d.zip  \n\n//上传up/ 到OneDrive /test/ 目录  \nphp one.php upload:file up/ /test/\n```\n\n","source":"_posts/Oneindex自建不限速网盘.md","raw":"---\ntitle: Oneindex自建不限速网盘\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-22 11:46:34\npassword:\nsummary: 使用免费的000webhost虚拟主机，搭建一个小型的在线网盘。用到github上的开源程序Oneindex，以及微软的onedrive网盘。onedrive，提供5g的容量，通过邀请好友加入可以扩容到最多15G，也可以花钱升级。网盘支持文件夹加密，README，更换主题，后台管理。\ntags: Oneindex\ncategories: 网站编程\n---\n\n![](https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png)\n\n不占用服务器空间，不走服务器流量，  \n\n直接列出 OneDrive 目录，文件直链下载。\n\n# 一：注册申请000webhost免费主机\n\n进入 https://www.000webhost.com/\n\n注册后，在我的网站里创建新网站。\n\n![](https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png)\n\n创建成功后，打开网站后台。\n\n点击`File Manager`，或者直接输入网址 https://files.000webhost.com \n\n![](https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png)\n\n连接你的网站ftp\n\n输入你的网站名称和密码\n\n![](https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png)\n\n![](https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png)\n\n`/public_html`就是网站的根目录。将网页的index应放在此目录下\n\n# 二：下载和上传网页\n\n下载程序源码：https://wwa.lanzous.com/ikFHMdxgkeb\n\n确保`public_html`目录里没有任何文件。\n\n在网站文件管理页面，点击上传文件(upload files)的图标。将压缩包上传到`public_html`。\n\n选择文件右键选择解压(extract)。将解压后的所有文件即index.php所在的文件目录下所有的文件移动到`public_html`\n\n最终结果应如图所示。\n\n![](https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png)\n\n# 三：绑定自己的域名\n\nwebhost给的免费域名是`webname.000webhostapp.com`，需要自行设置cname解析。解析步骤就不说了。不会的可自行百度。\n\ncname添加后，还需要在webhost后台设置白名单才能生效。\n\n在000webhost网站管理后台中，点击`Website Settings`->`General`。\n\n![](https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png)\n\n在`Website Name`下面有一段英文，`you can change the name of your website here `。点击here。进入修改域名界面\n\n![](https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png)\n\n添加你cname解析的域名\n\n![](https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png)\n\n# 四：安装配置oneindex\n\n打开你的网盘网页，比如我的 http://pan.sci.ci\n\n按照提示配置。\n\n其中应用密钥和id，需要你点击网站给的链接获取。密钥获取结束后，点击密钥界面的回退按钮，在回退的网页里就能找到应用id。\n\n<img width=\"658\" alt=\"image\" src=\"https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif\">  \n\n# 五：oneindex其他操作\n\nonedrive文件管理：https://onedrive.live.com\n\n## 5.1 计划任务  \n\n[可选]**推荐配置**，非必需。后台定时刷新缓存，可增加前台访问的速度。  \n\n```\n# 每小时刷新一次token\n0 * * * * /具体路径/php /程序具体路径/one.php token:refresh\n\n# 每十分钟后台刷新一遍缓存\n*/10 * * * * /具体路径/php /程序具体路径/one.php cache:refresh\n```\n\n## 5.2 Docker 安装运行\n\n- 请参考[TimeBye/oneindex](https://github.com/TimeBye/oneindex)\n\n## 5.3 特殊文件实现功能  \n\n` README.md `、`HEAD.md` 、 `.password`特殊文件使用  \n\n可以参考[https://github.com/donwa/oneindex/tree/files](https://github.com/donwa/oneindex/tree/files)  \n\n**在文件夹底部添加说明:**  \n\n>在 OneDrive 的文件夹中添加` README.md `文件，使用 Markdown 语法。  \n\n**在文件夹头部添加说明:**  \n\n>在 OneDrive 的文件夹中添加`HEAD.md` 文件，使用 Markdown 语法。  \n\n**加密文件夹:**  \n\n>在 OneDrive 的文件夹中添加`.password`文件，填入密码，密码不能为空。  \n\n**直接输出网页:**  \n\n>在 OneDrive 的文件夹中添加`index.html` 文件，程序会直接输出网页而不列目录。  \n>配合 文件展示设置-直接输出 效果更佳。  \n\n## 5.4 命令行功能  \n\n仅能在PHP CLI模式下运行  \n\n**清除缓存:**  \n\n```\nphp one.php cache:clear\n```\n\n**刷新缓存:**  \n\n```\nphp one.php cache:refresh\n```\n\n**刷新令牌:**  \n\n```\nphp one.php token:refresh\n```\n\n**上传文件:**  \n\n```\nphp one.php upload:file 本地文件 [OneDrive文件]\n```\n\n\n**上传文件夹:**  \n\n```\nphp one.php upload:folder 本地文件夹 [OneDrive文件夹]\n```\n\n例如：  \n\n```\n//上传demo.zip 到OneDrive 根目录  \nphp one.php upload:file demo.zip  \n\n//上传demo.zip 到OneDrive /test/目录  \nphp one.php upload:file demo.zip /test/  \n\n//上传demo.zip 到OneDrive /test/目录并将其命名为 d.zip  \nphp one.php upload:file demo.zip /test/d.zip  \n\n//上传up/ 到OneDrive /test/ 目录  \nphp one.php upload:file up/ /test/\n```\n\n","slug":"Oneindex自建不限速网盘","published":1,"updated":"2020-06-25T04:00:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaax000mp0vz515h06v8","content":"<p><img src=\"https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>不占用服务器空间，不走服务器流量，  </p>\n<p>直接列出 OneDrive 目录，文件直链下载。</p>\n<h1 id=\"一：注册申请000webhost免费主机\"><a href=\"#一：注册申请000webhost免费主机\" class=\"headerlink\" title=\"一：注册申请000webhost免费主机\"></a>一：注册申请000webhost免费主机</h1><p>进入 <a href=\"https://www.000webhost.com/\">https://www.000webhost.com/</a></p>\n<p>注册后，在我的网站里创建新网站。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>创建成功后，打开网站后台。</p>\n<p>点击<code>File Manager</code>，或者直接输入网址 <a href=\"https://files.000webhost.com/\">https://files.000webhost.com</a> </p>\n<p><img src=\"https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>连接你的网站ftp</p>\n<p>输入你的网站名称和密码</p>\n<p><img src=\"https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><code>/public_html</code>就是网站的根目录。将网页的index应放在此目录下</p>\n<h1 id=\"二：下载和上传网页\"><a href=\"#二：下载和上传网页\" class=\"headerlink\" title=\"二：下载和上传网页\"></a>二：下载和上传网页</h1><p>下载程序源码：<a href=\"https://wwa.lanzous.com/ikFHMdxgkeb\">https://wwa.lanzous.com/ikFHMdxgkeb</a></p>\n<p>确保<code>public_html</code>目录里没有任何文件。</p>\n<p>在网站文件管理页面，点击上传文件(upload files)的图标。将压缩包上传到<code>public_html</code>。</p>\n<p>选择文件右键选择解压(extract)。将解压后的所有文件即index.php所在的文件目录下所有的文件移动到<code>public_html</code></p>\n<p>最终结果应如图所示。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h1 id=\"三：绑定自己的域名\"><a href=\"#三：绑定自己的域名\" class=\"headerlink\" title=\"三：绑定自己的域名\"></a>三：绑定自己的域名</h1><p>webhost给的免费域名是<code>webname.000webhostapp.com</code>，需要自行设置cname解析。解析步骤就不说了。不会的可自行百度。</p>\n<p>cname添加后，还需要在webhost后台设置白名单才能生效。</p>\n<p>在000webhost网站管理后台中，点击<code>Website Settings</code>-&gt;<code>General</code>。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>在<code>Website Name</code>下面有一段英文，<code>you can change the name of your website here </code>。点击here。进入修改域名界面</p>\n<p><img src=\"https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>添加你cname解析的域名</p>\n<p><img src=\"https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h1 id=\"四：安装配置oneindex\"><a href=\"#四：安装配置oneindex\" class=\"headerlink\" title=\"四：安装配置oneindex\"></a>四：安装配置oneindex</h1><p>打开你的网盘网页，比如我的 <a href=\"http://pan.sci.ci/\">http://pan.sci.ci</a></p>\n<p>按照提示配置。</p>\n<p>其中应用密钥和id，需要你点击网站给的链接获取。密钥获取结束后，点击密钥界面的回退按钮，在回退的网页里就能找到应用id。</p>\n<img width=\"658\" alt=\"image\" src=\"https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif\" class=\"lazyload\" data-srcset=\"https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\">  \n\n<h1 id=\"五：oneindex其他操作\"><a href=\"#五：oneindex其他操作\" class=\"headerlink\" title=\"五：oneindex其他操作\"></a>五：oneindex其他操作</h1><p>onedrive文件管理：<a href=\"https://onedrive.live.com/\">https://onedrive.live.com</a></p>\n<h2 id=\"5-1-计划任务\"><a href=\"#5-1-计划任务\" class=\"headerlink\" title=\"5.1 计划任务  \"></a>5.1 计划任务  </h2><p>[可选]<strong>推荐配置</strong>，非必需。后台定时刷新缓存，可增加前台访问的速度。  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 每小时刷新一次token</span><br><span class=\"line\">0 * * * * &#x2F;具体路径&#x2F;php &#x2F;程序具体路径&#x2F;one.php token:refresh</span><br><span class=\"line\"></span><br><span class=\"line\"># 每十分钟后台刷新一遍缓存</span><br><span class=\"line\">*&#x2F;10 * * * * &#x2F;具体路径&#x2F;php &#x2F;程序具体路径&#x2F;one.php cache:refresh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-Docker-安装运行\"><a href=\"#5-2-Docker-安装运行\" class=\"headerlink\" title=\"5.2 Docker 安装运行\"></a>5.2 Docker 安装运行</h2><ul>\n<li>请参考<a href=\"https://github.com/TimeBye/oneindex\">TimeBye/oneindex</a></li>\n</ul>\n<h2 id=\"5-3-特殊文件实现功能\"><a href=\"#5-3-特殊文件实现功能\" class=\"headerlink\" title=\"5.3 特殊文件实现功能  \"></a>5.3 特殊文件实现功能  </h2><p><code>README.md</code>、<code>HEAD.md</code> 、 <code>.password</code>特殊文件使用  </p>\n<p>可以参考<a href=\"https://github.com/donwa/oneindex/tree/files\">https://github.com/donwa/oneindex/tree/files</a>  </p>\n<p><strong>在文件夹底部添加说明:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>README.md</code>文件，使用 Markdown 语法。  </p>\n</blockquote>\n<p><strong>在文件夹头部添加说明:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>HEAD.md</code> 文件，使用 Markdown 语法。  </p>\n</blockquote>\n<p><strong>加密文件夹:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>.password</code>文件，填入密码，密码不能为空。  </p>\n</blockquote>\n<p><strong>直接输出网页:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>index.html</code> 文件，程序会直接输出网页而不列目录。<br>配合 文件展示设置-直接输出 效果更佳。  </p>\n</blockquote>\n<h2 id=\"5-4-命令行功能\"><a href=\"#5-4-命令行功能\" class=\"headerlink\" title=\"5.4 命令行功能  \"></a>5.4 命令行功能  </h2><p>仅能在PHP CLI模式下运行  </p>\n<p><strong>清除缓存:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php cache:clear</span><br></pre></td></tr></table></figure>\n\n<p><strong>刷新缓存:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php cache:refresh</span><br></pre></td></tr></table></figure>\n\n<p><strong>刷新令牌:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php token:refresh</span><br></pre></td></tr></table></figure>\n\n<p><strong>上传文件:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php upload:file 本地文件 [OneDrive文件]</span><br></pre></td></tr></table></figure>\n\n\n<p><strong>上传文件夹:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php upload:folder 本地文件夹 [OneDrive文件夹]</span><br></pre></td></tr></table></figure>\n\n<p>例如：  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;上传demo.zip 到OneDrive 根目录  </span><br><span class=\"line\">php one.php upload:file demo.zip  </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传demo.zip 到OneDrive &#x2F;test&#x2F;目录  </span><br><span class=\"line\">php one.php upload:file demo.zip &#x2F;test&#x2F;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传demo.zip 到OneDrive &#x2F;test&#x2F;目录并将其命名为 d.zip  </span><br><span class=\"line\">php one.php upload:file demo.zip &#x2F;test&#x2F;d.zip  </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传up&#x2F; 到OneDrive &#x2F;test&#x2F; 目录  </span><br><span class=\"line\">php one.php upload:file up&#x2F; &#x2F;test&#x2F;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p><img src=\"https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png\"></p>\n<p>不占用服务器空间，不走服务器流量，  </p>\n<p>直接列出 OneDrive 目录，文件直链下载。</p>\n<h1 id=\"一：注册申请000webhost免费主机\"><a href=\"#一：注册申请000webhost免费主机\" class=\"headerlink\" title=\"一：注册申请000webhost免费主机\"></a>一：注册申请000webhost免费主机</h1><p>进入 <a href=\"https://www.000webhost.com/\">https://www.000webhost.com/</a></p>\n<p>注册后，在我的网站里创建新网站。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png\"></p>\n<p>创建成功后，打开网站后台。</p>\n<p>点击<code>File Manager</code>，或者直接输入网址 <a href=\"https://files.000webhost.com/\">https://files.000webhost.com</a> </p>\n<p><img src=\"https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png\"></p>\n<p>连接你的网站ftp</p>\n<p>输入你的网站名称和密码</p>\n<p><img src=\"https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png\"></p>\n<p><img src=\"https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png\"></p>\n<p><code>/public_html</code>就是网站的根目录。将网页的index应放在此目录下</p>\n<h1 id=\"二：下载和上传网页\"><a href=\"#二：下载和上传网页\" class=\"headerlink\" title=\"二：下载和上传网页\"></a>二：下载和上传网页</h1><p>下载程序源码：<a href=\"https://wwa.lanzous.com/ikFHMdxgkeb\">https://wwa.lanzous.com/ikFHMdxgkeb</a></p>\n<p>确保<code>public_html</code>目录里没有任何文件。</p>\n<p>在网站文件管理页面，点击上传文件(upload files)的图标。将压缩包上传到<code>public_html</code>。</p>\n<p>选择文件右键选择解压(extract)。将解压后的所有文件即index.php所在的文件目录下所有的文件移动到<code>public_html</code></p>\n<p>最终结果应如图所示。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png\"></p>\n<h1 id=\"三：绑定自己的域名\"><a href=\"#三：绑定自己的域名\" class=\"headerlink\" title=\"三：绑定自己的域名\"></a>三：绑定自己的域名</h1><p>webhost给的免费域名是<code>webname.000webhostapp.com</code>，需要自行设置cname解析。解析步骤就不说了。不会的可自行百度。</p>\n<p>cname添加后，还需要在webhost后台设置白名单才能生效。</p>\n<p>在000webhost网站管理后台中，点击<code>Website Settings</code>-&gt;<code>General</code>。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png\"></p>\n<p>在<code>Website Name</code>下面有一段英文，<code>you can change the name of your website here </code>。点击here。进入修改域名界面</p>\n<p><img src=\"https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png\"></p>\n<p>添加你cname解析的域名</p>\n<p><img src=\"https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png\"></p>\n<h1 id=\"四：安装配置oneindex\"><a href=\"#四：安装配置oneindex\" class=\"headerlink\" title=\"四：安装配置oneindex\"></a>四：安装配置oneindex</h1><p>打开你的网盘网页，比如我的 <a href=\"http://pan.sci.ci/\">http://pan.sci.ci</a></p>\n<p>按照提示配置。</p>\n<p>其中应用密钥和id，需要你点击网站给的链接获取。密钥获取结束后，点击密钥界面的回退按钮，在回退的网页里就能找到应用id。</p>\n<img width=\"658\" alt=\"image\" src=\"https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif\">  \n\n<h1 id=\"五：oneindex其他操作\"><a href=\"#五：oneindex其他操作\" class=\"headerlink\" title=\"五：oneindex其他操作\"></a>五：oneindex其他操作</h1><p>onedrive文件管理：<a href=\"https://onedrive.live.com/\">https://onedrive.live.com</a></p>\n<h2 id=\"5-1-计划任务\"><a href=\"#5-1-计划任务\" class=\"headerlink\" title=\"5.1 计划任务  \"></a>5.1 计划任务  </h2><p>[可选]<strong>推荐配置</strong>，非必需。后台定时刷新缓存，可增加前台访问的速度。  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 每小时刷新一次token</span><br><span class=\"line\">0 * * * * &#x2F;具体路径&#x2F;php &#x2F;程序具体路径&#x2F;one.php token:refresh</span><br><span class=\"line\"></span><br><span class=\"line\"># 每十分钟后台刷新一遍缓存</span><br><span class=\"line\">*&#x2F;10 * * * * &#x2F;具体路径&#x2F;php &#x2F;程序具体路径&#x2F;one.php cache:refresh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-Docker-安装运行\"><a href=\"#5-2-Docker-安装运行\" class=\"headerlink\" title=\"5.2 Docker 安装运行\"></a>5.2 Docker 安装运行</h2><ul>\n<li>请参考<a href=\"https://github.com/TimeBye/oneindex\">TimeBye/oneindex</a></li>\n</ul>\n<h2 id=\"5-3-特殊文件实现功能\"><a href=\"#5-3-特殊文件实现功能\" class=\"headerlink\" title=\"5.3 特殊文件实现功能  \"></a>5.3 特殊文件实现功能  </h2><p><code>README.md</code>、<code>HEAD.md</code> 、 <code>.password</code>特殊文件使用  </p>\n<p>可以参考<a href=\"https://github.com/donwa/oneindex/tree/files\">https://github.com/donwa/oneindex/tree/files</a>  </p>\n<p><strong>在文件夹底部添加说明:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>README.md</code>文件，使用 Markdown 语法。  </p>\n</blockquote>\n<p><strong>在文件夹头部添加说明:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>HEAD.md</code> 文件，使用 Markdown 语法。  </p>\n</blockquote>\n<p><strong>加密文件夹:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>.password</code>文件，填入密码，密码不能为空。  </p>\n</blockquote>\n<p><strong>直接输出网页:</strong>  </p>\n<blockquote>\n<p>在 OneDrive 的文件夹中添加<code>index.html</code> 文件，程序会直接输出网页而不列目录。<br>配合 文件展示设置-直接输出 效果更佳。  </p>\n</blockquote>\n<h2 id=\"5-4-命令行功能\"><a href=\"#5-4-命令行功能\" class=\"headerlink\" title=\"5.4 命令行功能  \"></a>5.4 命令行功能  </h2><p>仅能在PHP CLI模式下运行  </p>\n<p><strong>清除缓存:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php cache:clear</span><br></pre></td></tr></table></figure>\n\n<p><strong>刷新缓存:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php cache:refresh</span><br></pre></td></tr></table></figure>\n\n<p><strong>刷新令牌:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php token:refresh</span><br></pre></td></tr></table></figure>\n\n<p><strong>上传文件:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php upload:file 本地文件 [OneDrive文件]</span><br></pre></td></tr></table></figure>\n\n\n<p><strong>上传文件夹:</strong>  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php one.php upload:folder 本地文件夹 [OneDrive文件夹]</span><br></pre></td></tr></table></figure>\n\n<p>例如：  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;上传demo.zip 到OneDrive 根目录  </span><br><span class=\"line\">php one.php upload:file demo.zip  </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传demo.zip 到OneDrive &#x2F;test&#x2F;目录  </span><br><span class=\"line\">php one.php upload:file demo.zip &#x2F;test&#x2F;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传demo.zip 到OneDrive &#x2F;test&#x2F;目录并将其命名为 d.zip  </span><br><span class=\"line\">php one.php upload:file demo.zip &#x2F;test&#x2F;d.zip  </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;上传up&#x2F; 到OneDrive &#x2F;test&#x2F; 目录  </span><br><span class=\"line\">php one.php upload:file up&#x2F; &#x2F;test&#x2F;</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png","popularPost_tmp_gaData":{"updated":"Thu Jun 25 2020 06:00:50 GMT+0200 (GMT+02:00)","title":"Oneindex自建不限速网盘","path":"2020/06/22/Oneindex自建不限速网盘/","eyeCatchImage":"https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-22T09:46:34.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-22T09:46:34.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["Oneindex"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"PyTorch学习笔记","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-06-16T14:14:08.000Z","password":null,"summary":"PyTorch是一个开源的Python机器学习库，基于Torch，底层由C++实现，应用于人工智能领域，如自然语言处理。它最初由Facebook的人工智能研究团队开发，并且被用于Uber的概率编程软件Pyro。PyTorch主要有两大特征：类似于NumPy的张量计算，可使用GPU加速；基于带自动微分系统的深度神经网络。","_content":"\nPyTorch的用处：GPU加速、求导、常用API\n\n## P1：开发环境\n\n> - Python 3.7+Anaconda 5.3.1\n>\n> - CUDA 10.0\n> - Pycharm Community\n\n1. 下载安装Anaconda，勾选“添加ana到路径环境”\n\ncmd输入，查看ana安装的包。\n\n```shell\nconda list\n```\n\n2. 安装nvidia CUDA\n\n确保有nvidia的GPU\n\n配置系统环境变量，确保CUDA的bin目录在`PATH`行里，在cmd里\n\n```shell\nnvcc -v\n```\n\n3. pytorch.org里下载pytorch\n\n4. 下载pycharm，这是一个python的IDE\n\n配置编译器为Python\n\n## P2：梯度下降算法\n\n![](https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg)\n\n求解线性方程，如果存在噪声？\n\n求取近似值w,b。\n\n![](https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg)\n\n假设采样数据输入x和理论真实输出y满足 y=wx+b的线性回归函数。Linear Regression\n\n那么\n$$\nloss\\ function=\\sum(wx+b-y)^2\n$$\n\n> 梯度下降算法：有若干个wb不同的函数y=wx+b，这些函数能够将采样输入x得出一个若干个输出值w1x+b1、w2x+b2等等，这个输出值wx+b与理论输出值y存在误差，于是我们定义了一个loss function来表示w和b不同时，wx+b与真实值y之间的误差。通过对loss function做运算能找到一组w和b，这组w和b可以使wx+b最接近y。\n>\n> 对loss function的运算方式叫梯度下降算法，将若干个采样输入和理论输出带入loss function，形成一个诸如L(w,b)的方程。要找使得L(w,b)最小的w和b。\n\n## P3：梯度Ⅱ\n\n对线性回归y=wx+b\n\n计算loss function：\n\n```python\ndef compute_error_for_line_given_points(b,w,points)：\n\ttotalError=0\n    for i in range(0,len(points)):\n        x = points[i,0]\n        y = points[i,1]\n        totalError += (y-(w*x+b))**2\n    return totalError / float(len(points))\n```\n\n输入上一个w和b值，计算梯度，返回下一个w和b：\n\n```python\ndef step_gradient(b_current,w_current,points,learningRate):\n    b_gradient = 0\n    w_gradient = 0\n    N = float(len(points))\n    for i in range(0,len(points)):\n        x = points[i,0]\n        y = points[i,1]\n        b_gradient += -(2/N) * (y - ((w_current*x) + b_current))\n        w_gradient += -(2/N) * x * (y-((w_current*x)+b_current))\n    new_b = b_current - (learningRate * b_gradient)\n    new_w = w_current - (learningRate * w_gradient)\n    return [new_b,new_w]\n```\n\n计算最优解：\n\n```python\ndef gradient_descent_runner(points,starting_b,starting_w,learning_rate,num_iterations):\n    b = starting_b\n    w = starting_w\n    for i in range(num_iterations):\n        b,w = step_gradient(b,w,np.array(points),learning_rate)\n    return [b,w]\n```\n\n## P4：手写数字问题\n\n手写0~9，输出手写数字\n\n## P5：Pytorch基本数据类型\n\nInt: IntTensor of size()\n\nfloat: FloatTensor of size()\n\nInt array: IntTensor of size [d1,d2……]\n\n> 没有String类型，只能用向量来表示[0,0,1,0……]\n\n------\n\n## P6：张量 Tensor\n\nTensor或者Numpy的ndarrays\n\n```python\nfrom __future__ import print_function\nimport torch\n```\n\n构造空矩阵,五行三列\n\n```python\nx = torch.empty(5,3)\nprint(x)\n```\n\n> tensor(1.00000e-04 *\n>        [[-0.0000,  0.0000,  1.5135],\n>         [ 0.0000,  0.0000,  0.0000],\n>         [ 0.0000,  0.0000,  0.0000],\n>         [ 0.0000,  0.0000,  0.0000],\n>         [ 0.0000,  0.0000,  0.0000]])\n\n构造一个随机数矩阵，随机数都在0到1之间\n\n```python\nx = torch.rand(5, 3) \nprint(x)\n```\n\n> tensor([[ 0.6291,  0.2581,  0.6414],\n>         [ 0.9739,  0.8243,  0.2276],\n>         [ 0.4184,  0.1815,  0.5131],\n>         [ 0.5533,  0.5440,  0.0718],\n>         [ 0.2908,  0.1850,  0.5297]])\n\n构造一个全0矩阵，字符类型为long。\n\n```python\nx = torch.zeros(5, 3, dtype=torch.long)\nprint(x)\n```\n\n> tensor([[ 0,  0,  0],\n>         [ 0,  0,  0],\n>         [ 0,  0,  0],\n>         [ 0,  0,  0],\n>         [ 0,  0,  0]])\n\n直接输入数据创建一个张量。\n\n```python\nx = torch.tensor([5.5, 3])\nprint(x)\n```\n\n> tensor([ 5.5000,  3.0000])\n\n创建一个张量，基于已存在的张量\n\n```python\nx = x.new_ones(5, 3, dtype=torch.double)    \n\n# new_* methods take in sizes\nprint(x)\n\nx = torch.randn_like(x, dtype=torch.float)  \n\n# override dtype!\nprint(x)                                    \n\n# result has the same size\n```\n\n> tensor([[ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.]], dtype=torch.float64)\n> tensor([[-0.2183,  0.4477, -0.4053],\n>         [ 1.7353, -0.0048,  1.2177],\n>         [-1.1111,  1.0878,  0.9722],\n>         [-0.7771, -0.2174,  0.0412],\n>         [-2.1750,  1.3609, -0.3322]])\n\n获取维度\n\n```python\nprint(x.size())\n```\n\n> torch.Size([5, 3])","source":"_posts/PyTorch学习笔记.md","raw":"---\ntitle: PyTorch学习笔记\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-06-16 16:14:08\npassword:\nsummary: PyTorch是一个开源的Python机器学习库，基于Torch，底层由C++实现，应用于人工智能领域，如自然语言处理。它最初由Facebook的人工智能研究团队开发，并且被用于Uber的概率编程软件Pyro。PyTorch主要有两大特征：类似于NumPy的张量计算，可使用GPU加速；基于带自动微分系统的深度神经网络。\ntags: \n - 深度学习\n - PyTorch\ncategories: 学习笔记\n---\n\nPyTorch的用处：GPU加速、求导、常用API\n\n## P1：开发环境\n\n> - Python 3.7+Anaconda 5.3.1\n>\n> - CUDA 10.0\n> - Pycharm Community\n\n1. 下载安装Anaconda，勾选“添加ana到路径环境”\n\ncmd输入，查看ana安装的包。\n\n```shell\nconda list\n```\n\n2. 安装nvidia CUDA\n\n确保有nvidia的GPU\n\n配置系统环境变量，确保CUDA的bin目录在`PATH`行里，在cmd里\n\n```shell\nnvcc -v\n```\n\n3. pytorch.org里下载pytorch\n\n4. 下载pycharm，这是一个python的IDE\n\n配置编译器为Python\n\n## P2：梯度下降算法\n\n![](https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg)\n\n求解线性方程，如果存在噪声？\n\n求取近似值w,b。\n\n![](https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg)\n\n假设采样数据输入x和理论真实输出y满足 y=wx+b的线性回归函数。Linear Regression\n\n那么\n$$\nloss\\ function=\\sum(wx+b-y)^2\n$$\n\n> 梯度下降算法：有若干个wb不同的函数y=wx+b，这些函数能够将采样输入x得出一个若干个输出值w1x+b1、w2x+b2等等，这个输出值wx+b与理论输出值y存在误差，于是我们定义了一个loss function来表示w和b不同时，wx+b与真实值y之间的误差。通过对loss function做运算能找到一组w和b，这组w和b可以使wx+b最接近y。\n>\n> 对loss function的运算方式叫梯度下降算法，将若干个采样输入和理论输出带入loss function，形成一个诸如L(w,b)的方程。要找使得L(w,b)最小的w和b。\n\n## P3：梯度Ⅱ\n\n对线性回归y=wx+b\n\n计算loss function：\n\n```python\ndef compute_error_for_line_given_points(b,w,points)：\n\ttotalError=0\n    for i in range(0,len(points)):\n        x = points[i,0]\n        y = points[i,1]\n        totalError += (y-(w*x+b))**2\n    return totalError / float(len(points))\n```\n\n输入上一个w和b值，计算梯度，返回下一个w和b：\n\n```python\ndef step_gradient(b_current,w_current,points,learningRate):\n    b_gradient = 0\n    w_gradient = 0\n    N = float(len(points))\n    for i in range(0,len(points)):\n        x = points[i,0]\n        y = points[i,1]\n        b_gradient += -(2/N) * (y - ((w_current*x) + b_current))\n        w_gradient += -(2/N) * x * (y-((w_current*x)+b_current))\n    new_b = b_current - (learningRate * b_gradient)\n    new_w = w_current - (learningRate * w_gradient)\n    return [new_b,new_w]\n```\n\n计算最优解：\n\n```python\ndef gradient_descent_runner(points,starting_b,starting_w,learning_rate,num_iterations):\n    b = starting_b\n    w = starting_w\n    for i in range(num_iterations):\n        b,w = step_gradient(b,w,np.array(points),learning_rate)\n    return [b,w]\n```\n\n## P4：手写数字问题\n\n手写0~9，输出手写数字\n\n## P5：Pytorch基本数据类型\n\nInt: IntTensor of size()\n\nfloat: FloatTensor of size()\n\nInt array: IntTensor of size [d1,d2……]\n\n> 没有String类型，只能用向量来表示[0,0,1,0……]\n\n------\n\n## P6：张量 Tensor\n\nTensor或者Numpy的ndarrays\n\n```python\nfrom __future__ import print_function\nimport torch\n```\n\n构造空矩阵,五行三列\n\n```python\nx = torch.empty(5,3)\nprint(x)\n```\n\n> tensor(1.00000e-04 *\n>        [[-0.0000,  0.0000,  1.5135],\n>         [ 0.0000,  0.0000,  0.0000],\n>         [ 0.0000,  0.0000,  0.0000],\n>         [ 0.0000,  0.0000,  0.0000],\n>         [ 0.0000,  0.0000,  0.0000]])\n\n构造一个随机数矩阵，随机数都在0到1之间\n\n```python\nx = torch.rand(5, 3) \nprint(x)\n```\n\n> tensor([[ 0.6291,  0.2581,  0.6414],\n>         [ 0.9739,  0.8243,  0.2276],\n>         [ 0.4184,  0.1815,  0.5131],\n>         [ 0.5533,  0.5440,  0.0718],\n>         [ 0.2908,  0.1850,  0.5297]])\n\n构造一个全0矩阵，字符类型为long。\n\n```python\nx = torch.zeros(5, 3, dtype=torch.long)\nprint(x)\n```\n\n> tensor([[ 0,  0,  0],\n>         [ 0,  0,  0],\n>         [ 0,  0,  0],\n>         [ 0,  0,  0],\n>         [ 0,  0,  0]])\n\n直接输入数据创建一个张量。\n\n```python\nx = torch.tensor([5.5, 3])\nprint(x)\n```\n\n> tensor([ 5.5000,  3.0000])\n\n创建一个张量，基于已存在的张量\n\n```python\nx = x.new_ones(5, 3, dtype=torch.double)    \n\n# new_* methods take in sizes\nprint(x)\n\nx = torch.randn_like(x, dtype=torch.float)  \n\n# override dtype!\nprint(x)                                    \n\n# result has the same size\n```\n\n> tensor([[ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.],\n>         [ 1.,  1.,  1.]], dtype=torch.float64)\n> tensor([[-0.2183,  0.4477, -0.4053],\n>         [ 1.7353, -0.0048,  1.2177],\n>         [-1.1111,  1.0878,  0.9722],\n>         [-0.7771, -0.2174,  0.0412],\n>         [-2.1750,  1.3609, -0.3322]])\n\n获取维度\n\n```python\nprint(x.size())\n```\n\n> torch.Size([5, 3])","slug":"PyTorch学习笔记","published":1,"updated":"2020-06-21T08:52:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaaz000op0vz6vpnag4o","content":"<p>PyTorch的用处：GPU加速、求导、常用API</p>\n<h2 id=\"P1：开发环境\"><a href=\"#P1：开发环境\" class=\"headerlink\" title=\"P1：开发环境\"></a>P1：开发环境</h2><blockquote>\n<ul>\n<li><p>Python 3.7+Anaconda 5.3.1</p>\n</li>\n<li><p>CUDA 10.0</p>\n</li>\n<li><p>Pycharm Community</p>\n</li>\n</ul>\n</blockquote>\n<ol>\n<li>下载安装Anaconda，勾选“添加ana到路径环境”</li>\n</ol>\n<p>cmd输入，查看ana安装的包。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conda list</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>安装nvidia CUDA</li>\n</ol>\n<p>确保有nvidia的GPU</p>\n<p>配置系统环境变量，确保CUDA的bin目录在<code>PATH</code>行里，在cmd里</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvcc -v</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>pytorch.org里下载pytorch</p>\n</li>\n<li><p>下载pycharm，这是一个python的IDE</p>\n</li>\n</ol>\n<p>配置编译器为Python</p>\n<h2 id=\"P2：梯度下降算法\"><a href=\"#P2：梯度下降算法\" class=\"headerlink\" title=\"P2：梯度下降算法\"></a>P2：梯度下降算法</h2><p><img src=\"https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>求解线性方程，如果存在噪声？</p>\n<p>求取近似值w,b。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>假设采样数据输入x和理论真实输出y满足 y=wx+b的线性回归函数。Linear Regression</p>\n<p>那么<br>$$<br>loss\\ function=\\sum(wx+b-y)^2<br>$$</p>\n<blockquote>\n<p>梯度下降算法：有若干个wb不同的函数y=wx+b，这些函数能够将采样输入x得出一个若干个输出值w1x+b1、w2x+b2等等，这个输出值wx+b与理论输出值y存在误差，于是我们定义了一个loss function来表示w和b不同时，wx+b与真实值y之间的误差。通过对loss function做运算能找到一组w和b，这组w和b可以使wx+b最接近y。</p>\n<p>对loss function的运算方式叫梯度下降算法，将若干个采样输入和理论输出带入loss function，形成一个诸如L(w,b)的方程。要找使得L(w,b)最小的w和b。</p>\n</blockquote>\n<h2 id=\"P3：梯度Ⅱ\"><a href=\"#P3：梯度Ⅱ\" class=\"headerlink\" title=\"P3：梯度Ⅱ\"></a>P3：梯度Ⅱ</h2><p>对线性回归y=wx+b</p>\n<p>计算loss function：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">compute_error_for_line_given_points</span>(<span class=\"params\">b,w,points</span>)：</span></span><br><span class=\"line\">\ttotalError=0</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,len(points)):</span><br><span class=\"line\">        x = points[i,<span class=\"number\">0</span>]</span><br><span class=\"line\">        y = points[i,<span class=\"number\">1</span>]</span><br><span class=\"line\">        totalError += (y-(w*x+b))**<span class=\"number\">2</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> totalError / float(len(points))</span><br></pre></td></tr></table></figure>\n\n<p>输入上一个w和b值，计算梯度，返回下一个w和b：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">step_gradient</span>(<span class=\"params\">b_current,w_current,points,learningRate</span>):</span></span><br><span class=\"line\">    b_gradient = <span class=\"number\">0</span></span><br><span class=\"line\">    w_gradient = <span class=\"number\">0</span></span><br><span class=\"line\">    N = float(len(points))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,len(points)):</span><br><span class=\"line\">        x = points[i,<span class=\"number\">0</span>]</span><br><span class=\"line\">        y = points[i,<span class=\"number\">1</span>]</span><br><span class=\"line\">        b_gradient += -(<span class=\"number\">2</span>/N) * (y - ((w_current*x) + b_current))</span><br><span class=\"line\">        w_gradient += -(<span class=\"number\">2</span>/N) * x * (y-((w_current*x)+b_current))</span><br><span class=\"line\">    new_b = b_current - (learningRate * b_gradient)</span><br><span class=\"line\">    new_w = w_current - (learningRate * w_gradient)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [new_b,new_w]</span><br></pre></td></tr></table></figure>\n\n<p>计算最优解：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">gradient_descent_runner</span>(<span class=\"params\">points,starting_b,starting_w,learning_rate,num_iterations</span>):</span></span><br><span class=\"line\">    b = starting_b</span><br><span class=\"line\">    w = starting_w</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(num_iterations):</span><br><span class=\"line\">        b,w = step_gradient(b,w,np.array(points),learning_rate)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [b,w]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"P4：手写数字问题\"><a href=\"#P4：手写数字问题\" class=\"headerlink\" title=\"P4：手写数字问题\"></a>P4：手写数字问题</h2><p>手写0~9，输出手写数字</p>\n<h2 id=\"P5：Pytorch基本数据类型\"><a href=\"#P5：Pytorch基本数据类型\" class=\"headerlink\" title=\"P5：Pytorch基本数据类型\"></a>P5：Pytorch基本数据类型</h2><p>Int: IntTensor of size()</p>\n<p>float: FloatTensor of size()</p>\n<p>Int array: IntTensor of size [d1,d2……]</p>\n<blockquote>\n<p>没有String类型，只能用向量来表示[0,0,1,0……]</p>\n</blockquote>\n<hr>\n<h2 id=\"P6：张量-Tensor\"><a href=\"#P6：张量-Tensor\" class=\"headerlink\" title=\"P6：张量 Tensor\"></a>P6：张量 Tensor</h2><p>Tensor或者Numpy的ndarrays</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> print_function</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch</span><br></pre></td></tr></table></figure>\n\n<p>构造空矩阵,五行三列</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.empty(<span class=\"number\">5</span>,<span class=\"number\">3</span>)</span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor(1.00000e-04 *<br>       [[-0.0000,  0.0000,  1.5135],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000]])</p>\n</blockquote>\n<p>构造一个随机数矩阵，随机数都在0到1之间</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.rand(<span class=\"number\">5</span>, <span class=\"number\">3</span>) </span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([[ 0.6291,  0.2581,  0.6414],<br>        [ 0.9739,  0.8243,  0.2276],<br>        [ 0.4184,  0.1815,  0.5131],<br>        [ 0.5533,  0.5440,  0.0718],<br>        [ 0.2908,  0.1850,  0.5297]])</p>\n</blockquote>\n<p>构造一个全0矩阵，字符类型为long。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.zeros(<span class=\"number\">5</span>, <span class=\"number\">3</span>, dtype=torch.long)</span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([[ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0]])</p>\n</blockquote>\n<p>直接输入数据创建一个张量。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.tensor([<span class=\"number\">5.5</span>, <span class=\"number\">3</span>])</span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([ 5.5000,  3.0000])</p>\n</blockquote>\n<p>创建一个张量，基于已存在的张量</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = x.new_ones(<span class=\"number\">5</span>, <span class=\"number\">3</span>, dtype=torch.double)    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># new_* methods take in sizes</span></span><br><span class=\"line\">print(x)</span><br><span class=\"line\"></span><br><span class=\"line\">x = torch.randn_like(x, dtype=torch.float)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># override dtype!</span></span><br><span class=\"line\">print(x)                                    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># result has the same size</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([[ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.]], dtype=torch.float64)<br>tensor([[-0.2183,  0.4477, -0.4053],<br>        [ 1.7353, -0.0048,  1.2177],<br>        [-1.1111,  1.0878,  0.9722],<br>        [-0.7771, -0.2174,  0.0412],<br>        [-2.1750,  1.3609, -0.3322]])</p>\n</blockquote>\n<p>获取维度</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(x.size())</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>torch.Size([5, 3])</p>\n</blockquote>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>PyTorch的用处：GPU加速、求导、常用API</p>\n<h2 id=\"P1：开发环境\"><a href=\"#P1：开发环境\" class=\"headerlink\" title=\"P1：开发环境\"></a>P1：开发环境</h2><blockquote>\n<ul>\n<li><p>Python 3.7+Anaconda 5.3.1</p>\n</li>\n<li><p>CUDA 10.0</p>\n</li>\n<li><p>Pycharm Community</p>\n</li>\n</ul>\n</blockquote>\n<ol>\n<li>下载安装Anaconda，勾选“添加ana到路径环境”</li>\n</ol>\n<p>cmd输入，查看ana安装的包。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conda list</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>安装nvidia CUDA</li>\n</ol>\n<p>确保有nvidia的GPU</p>\n<p>配置系统环境变量，确保CUDA的bin目录在<code>PATH</code>行里，在cmd里</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvcc -v</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>pytorch.org里下载pytorch</p>\n</li>\n<li><p>下载pycharm，这是一个python的IDE</p>\n</li>\n</ol>\n<p>配置编译器为Python</p>\n<h2 id=\"P2：梯度下降算法\"><a href=\"#P2：梯度下降算法\" class=\"headerlink\" title=\"P2：梯度下降算法\"></a>P2：梯度下降算法</h2><p><img src=\"https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg\"></p>\n<p>求解线性方程，如果存在噪声？</p>\n<p>求取近似值w,b。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg\"></p>\n<p>假设采样数据输入x和理论真实输出y满足 y=wx+b的线性回归函数。Linear Regression</p>\n<p>那么<br>$$<br>loss\\ function=\\sum(wx+b-y)^2<br>$$</p>\n<blockquote>\n<p>梯度下降算法：有若干个wb不同的函数y=wx+b，这些函数能够将采样输入x得出一个若干个输出值w1x+b1、w2x+b2等等，这个输出值wx+b与理论输出值y存在误差，于是我们定义了一个loss function来表示w和b不同时，wx+b与真实值y之间的误差。通过对loss function做运算能找到一组w和b，这组w和b可以使wx+b最接近y。</p>\n<p>对loss function的运算方式叫梯度下降算法，将若干个采样输入和理论输出带入loss function，形成一个诸如L(w,b)的方程。要找使得L(w,b)最小的w和b。</p>\n</blockquote>\n<h2 id=\"P3：梯度Ⅱ\"><a href=\"#P3：梯度Ⅱ\" class=\"headerlink\" title=\"P3：梯度Ⅱ\"></a>P3：梯度Ⅱ</h2><p>对线性回归y=wx+b</p>\n<p>计算loss function：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">compute_error_for_line_given_points</span>(<span class=\"params\">b,w,points</span>)：</span></span><br><span class=\"line\">\ttotalError=0</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,len(points)):</span><br><span class=\"line\">        x = points[i,<span class=\"number\">0</span>]</span><br><span class=\"line\">        y = points[i,<span class=\"number\">1</span>]</span><br><span class=\"line\">        totalError += (y-(w*x+b))**<span class=\"number\">2</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> totalError / float(len(points))</span><br></pre></td></tr></table></figure>\n\n<p>输入上一个w和b值，计算梯度，返回下一个w和b：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">step_gradient</span>(<span class=\"params\">b_current,w_current,points,learningRate</span>):</span></span><br><span class=\"line\">    b_gradient = <span class=\"number\">0</span></span><br><span class=\"line\">    w_gradient = <span class=\"number\">0</span></span><br><span class=\"line\">    N = float(len(points))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,len(points)):</span><br><span class=\"line\">        x = points[i,<span class=\"number\">0</span>]</span><br><span class=\"line\">        y = points[i,<span class=\"number\">1</span>]</span><br><span class=\"line\">        b_gradient += -(<span class=\"number\">2</span>/N) * (y - ((w_current*x) + b_current))</span><br><span class=\"line\">        w_gradient += -(<span class=\"number\">2</span>/N) * x * (y-((w_current*x)+b_current))</span><br><span class=\"line\">    new_b = b_current - (learningRate * b_gradient)</span><br><span class=\"line\">    new_w = w_current - (learningRate * w_gradient)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [new_b,new_w]</span><br></pre></td></tr></table></figure>\n\n<p>计算最优解：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">gradient_descent_runner</span>(<span class=\"params\">points,starting_b,starting_w,learning_rate,num_iterations</span>):</span></span><br><span class=\"line\">    b = starting_b</span><br><span class=\"line\">    w = starting_w</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(num_iterations):</span><br><span class=\"line\">        b,w = step_gradient(b,w,np.array(points),learning_rate)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [b,w]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"P4：手写数字问题\"><a href=\"#P4：手写数字问题\" class=\"headerlink\" title=\"P4：手写数字问题\"></a>P4：手写数字问题</h2><p>手写0~9，输出手写数字</p>\n<h2 id=\"P5：Pytorch基本数据类型\"><a href=\"#P5：Pytorch基本数据类型\" class=\"headerlink\" title=\"P5：Pytorch基本数据类型\"></a>P5：Pytorch基本数据类型</h2><p>Int: IntTensor of size()</p>\n<p>float: FloatTensor of size()</p>\n<p>Int array: IntTensor of size [d1,d2……]</p>\n<blockquote>\n<p>没有String类型，只能用向量来表示[0,0,1,0……]</p>\n</blockquote>\n<hr>\n<h2 id=\"P6：张量-Tensor\"><a href=\"#P6：张量-Tensor\" class=\"headerlink\" title=\"P6：张量 Tensor\"></a>P6：张量 Tensor</h2><p>Tensor或者Numpy的ndarrays</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> print_function</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch</span><br></pre></td></tr></table></figure>\n\n<p>构造空矩阵,五行三列</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.empty(<span class=\"number\">5</span>,<span class=\"number\">3</span>)</span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor(1.00000e-04 *<br>       [[-0.0000,  0.0000,  1.5135],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000]])</p>\n</blockquote>\n<p>构造一个随机数矩阵，随机数都在0到1之间</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.rand(<span class=\"number\">5</span>, <span class=\"number\">3</span>) </span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([[ 0.6291,  0.2581,  0.6414],<br>        [ 0.9739,  0.8243,  0.2276],<br>        [ 0.4184,  0.1815,  0.5131],<br>        [ 0.5533,  0.5440,  0.0718],<br>        [ 0.2908,  0.1850,  0.5297]])</p>\n</blockquote>\n<p>构造一个全0矩阵，字符类型为long。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.zeros(<span class=\"number\">5</span>, <span class=\"number\">3</span>, dtype=torch.long)</span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([[ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0]])</p>\n</blockquote>\n<p>直接输入数据创建一个张量。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = torch.tensor([<span class=\"number\">5.5</span>, <span class=\"number\">3</span>])</span><br><span class=\"line\">print(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([ 5.5000,  3.0000])</p>\n</blockquote>\n<p>创建一个张量，基于已存在的张量</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = x.new_ones(<span class=\"number\">5</span>, <span class=\"number\">3</span>, dtype=torch.double)    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># new_* methods take in sizes</span></span><br><span class=\"line\">print(x)</span><br><span class=\"line\"></span><br><span class=\"line\">x = torch.randn_like(x, dtype=torch.float)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># override dtype!</span></span><br><span class=\"line\">print(x)                                    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># result has the same size</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tensor([[ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.]], dtype=torch.float64)<br>tensor([[-0.2183,  0.4477, -0.4053],<br>        [ 1.7353, -0.0048,  1.2177],<br>        [-1.1111,  1.0878,  0.9722],<br>        [-0.7771, -0.2174,  0.0412],<br>        [-2.1750,  1.3609, -0.3322]])</p>\n</blockquote>\n<p>获取维度</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(x.size())</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>torch.Size([5, 3])</p>\n</blockquote>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg","popularPost_tmp_gaData":{"updated":"Sun Jun 21 2020 10:52:06 GMT+0200 (GMT+02:00)","title":"PyTorch学习笔记","path":"2020/06/16/PyTorch学习笔记/","eyeCatchImage":"https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-16T14:14:08.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-16T14:14:08.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["深度学习","PyTorch"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Pandas知识总结","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-10-14T16:45:54.000Z","password":null,"summary":null,"_content":"\n# 1：简介\n\n在我看来，Pandas是一款数据处理工具，它相比于numpy而言，更加具有针对性。比如说，Pandas提供了两种数据结构，Series和DataFrame，分别表示一维数据和二维数据，而numpy则还有更多维数据。Pandas的特色是，它可以使用自定义的索引来表示数据的特点，这和Excel表格很类似。而numpy只有固定的整数索引。\n\n在数据中，我们可能会有这种情况，一个二维表格，每一行，表示不同的学生，每一列表示学生的不同信息。如下表所示，\n\n|      | 年龄 | 班级 |\n| ---- | ---- | ---- |\n| 小明 | 19   | 4班  |\n| 小张 | 15   | 2班  |\n| 小华 | 17   | 1班  |\n\n由年龄和班级构成的二维数组，在numpy中是无法建立的，因为numpy无法建立班级的字符串格式数据，且数组内不能含有多种属性的数据，比如年龄的数据格式是int，而班级则是string。\n\n此时Pandas的作用就出来了。Pandas可以指定上述数据每一行的意义为名字，所以其行索引`Index`可以设置为['小明','小张','小华']，而其纵坐标的索引`columns`设置为['年龄','班级']。然后再向这个DataFrame中添加数据即可。\n\n# 2：入门\n\n## 2.1 生成对象\n\n引入Pandas：\n\n```python \nimport numpy as np\nimport pandas as pd\n```\n\n生成Series：\n\n```python\ns = pd.Series([1,4,1,np.nan,8])\n```\n\n生成DataFrame：\n\n```python\ndates = pd.date_range('20130101',periods=6)\n#生成六个以20130101开始，间隔为一天的时间序列\ndf = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list('ABCD'))\n```\n\n> date_range函数可以生成一个时间序列，参数有，开始时间，结束时间，序列个数，间隔单位等。\n\ndf为：\n\n```\n                   A         B         C         D\n2013-01-01  0.469112 -0.282863 -1.509059 -1.135632\n2013-01-02  1.212112 -0.173215  0.119209 -1.044236\n2013-01-03 -0.861849 -2.104569 -0.494929  1.071804\n2013-01-04  0.721555 -0.706771 -1.039575  0.271860\n2013-01-05 -0.424972  0.567020  0.276232 -1.087401\n2013-01-06 -0.673690  0.113648 -1.478427  0.524988\n```\n\n使用字典对象生成DataFrame：\n\n```python\ndf2 = pd.DataFrame({'A':1,\n                    'B':pd.Timestamp('20130102'), \n                    'C':pd.Series(1, index=list(range(4)),dtype='float332'),\n                    'D':np.array([3]*4,dtype='int32'),\n                    'E':pd.Categorical([\"test\",\"train\",\"test\",\"train\"]),\n                    'F':'foo'})\n```\n\n## 2.2 查看数据\n\n查看DataFrame头部和尾部数据：\n\n```python\ndf.head()\ndf.tail(3)\n#可指定查看头尾部的数据行数\n```\n\n显示索引和列名：\n\n```python\ndf.index\ndf.columns\n```\n\n`df.to_numpy()`将DataFrame数据转为numpy数据\n\n`df.describe()`查看数据统计摘要\n\n`df.T`转置\n\n`df.sort_index(axis=1,ascending=False)`按轴上升排序\n\n`df.sort_values(by='B')`按轴排序\n\n## 2.3 选择数据\n\n产生`Series`\n\n```python\ndf['A']\ndf.A\n```\n\n切片：\n\n```python\ndf[0:3]\n#选择1到3行\n```\n\n```python\ndf['20130102':'20130104']\n```\n\n**按标签选择**：\n\n```python\ndf.loc[dates[0]]\n```\n\n用标签选多列：\n\n```python\ndf.loc[:,['A','B']]\n```\n\n用标签切片：\n\n```python\ndf.loc['20130102':'20130104',['A','B']]\n```\n\n提取标量：\n\n```python\ndf.loc[dates[0],'A']\ndf.at[dates[0],'A']\n```\n\n**按位置选**：\n\n```python\ndf.iloc[3]\n```\n\n用整数切片：\n\n```python\ndf.iloc[3:5,0:2]\n```\n\n用整数列表按位置切片：\n\n```python\ndf.iloc[[1,2,4],[0,2]]\n```\n\n按位置访问标量：\n\n```python\ndf.iloc[1,1]\ndf.iat[1,1]\n```\n\n**布尔索引**：\n\n用单列的值：\n\n```python\ndf[df.A>0]\n```\n\n```python\nOut[39]: \n                   A         B         C         D\n2013-01-01  0.469112 -0.282863 -1.509059 -1.135632\n2013-01-02  1.212112 -0.173215  0.119209 -1.044236\n2013-01-04  0.721555 -0.706771 -1.039575  0.271860\n```\n\n选择满足条件的值：\n\n```python\ndf[df>0]\n```\n\n```python\nOut[40]: \n                   A         B         C         D\n2013-01-01  0.469112       NaN       NaN       NaN\n2013-01-02  1.212112       NaN  0.119209       NaN\n2013-01-03       NaN       NaN       NaN  1.071804\n2013-01-04  0.721555       NaN       NaN  0.271860\n2013-01-05       NaN  0.567020  0.276232       NaN\n2013-01-06       NaN  0.113648       NaN  0.524988\n```\n\n`isin()`筛选\n\n```python\ndf2 = df.copy()\ndf2['E'] = ['one','two','three'……]\ndf2[df2['E'].isin(['one','two'])]\n```\n\n## 2.4 缺失值Nan\n\n`reindex`重建索引，不会修改源数据\n\n```python\ndf1 = df.reindex(index = dates[0:4],columns=list(df.columns)+['E'])\ndf1.loc[dates[0]:dates[1],'E'] = 1\n```\n\n```python\nOut[57]: \n                   A         B         C  D    F    E\n2013-01-01  0.000000  0.000000 -1.509059  5  NaN  1.0\n2013-01-02  1.212112 -0.173215  0.119209  5  1.0  1.0\n2013-01-03 -0.861849 -2.104569 -0.494929  5  2.0  NaN\n2013-01-04  0.721555 -0.706771 -1.039575  5  3.0  NaN\n```\n\n删除含缺失值的行：\n\n```python\ndf1.dropna(how='any')\n```\n\n填充缺失值：\n\n```python\ndf1.fillna(value=5)\n```\n\n提取缺失值的布尔掩码：\n\n```python\npd.isna(df1)\n```\n\n## 2.5 运算\n\n一般，运算时会排除缺失值\n\n在列上计算**平均值**：\n\n```python\ndf.mean()\n```\n\n在行上计算：\n\n```python\ndf.mean(1)\n```\n\n```python\nOut[62]: \n2013-01-01    0.872735\n2013-01-02    1.431621\n2013-01-03    0.707731\n2013-01-04    1.395042\n2013-01-05    1.883656\n2013-01-06    1.592306\nFreq: D, dtype: float64\n```\n\n**减法：**\n\n```python\ns = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)\ndf.sub(s,axis='index')\n```\n\ns与df的index轴是相同的，或者说在行上他们数据的个数相同，所以，sub第二个参数填写index或者0，计算时，df每列都会减去s。\n\n`shift`函数是平移函数，s各个位置上的数向下平移，由于向下平移了两个位置，0和1位置上的数没有内容可以补，用nan自动替补。\n\n**Apply函数**：\n\n`DataFrame.apply()` 函数则会依次将每行或列取出来作为一个Series传递到apply指定的函数中。\n\n```python\nmatrix = [\n    [1,2,3],\n    [4,5,6],\n    [7,8,9]\n]\n\ndf = pd.DataFrame(matrix, columns=list('xyz'), index=list('abc'))\ndf.apply(np.square)\n```\n\n具体使用方法：\n\n[pandas apply() 函数用法](https://www.jianshu.com/p/4fdd6eee1b06)\n\n**直方图与离散化：**\n\n```python\ns = pd.Series(np.random.randint(0,7,size=10))\ns.value_counts()\t#统计s中整数的分布情况，比如4有5个\n```\n\n**字符串方法：**\n\n```python\n s = pd.Series(['A', 'B', 'C', 'Aaba', 'Baca', np.nan, 'CABA', 'dog', 'cat'])\n s.str.lower()\t#字符串小写\n```\n\n## 2.6 合并\n\n**结合：**\n\n`contact()`将零散的df合并，合并原则根据index和columns，相同合并，不同连接。\n\n```python\ndf = pd.DataFrame(np.random.randn(10, 4))\npieces = [df[:3], df[3:7], df[7:]]\npd.concat(pieces)\n```\n\n连接：\n\n`join()`直接将连个df连接起来。\n\n```python\nIn [79]: left\nOut[79]: \n   key  lval\n0  foo     1\n1  foo     2\n\nIn [80]: right\nOut[80]: \n   key  rval\n0  foo     4\n1  foo     5\n\nIn [81]: pd.merge(left, right, on='key')\nOut[81]: \n   key  lval  rval\n0  foo     1     4\n1  foo     1     5\n2  foo     2     4\n3  foo     2     5\n```\n\n```python\nIn [84]: left\nOut[84]: \n   key  lval\n0  foo     1\n1  bar     2\n\nIn [85]: right\nOut[85]: \n   key  rval\n0  foo     4\n1  bar     5\n\nIn [86]: pd.merge(left, right, on='key')\nOut[86]: \n   key  lval  rval\n0  foo     1     4\n1  bar     2     5\n```\n\n**追加：**\n\n`append()`为df追加行\n\n```python\ndf.append(s,ignore_index=True)\n```\n\n## 2.7 分组\n\n按照某个column或columns，将df分组，然后结合df的函数分别计算各个分组。\n\n```python\nIn [92]: df\nOut[92]: \n     A      B         C         D\n0  foo    one -1.202872 -0.055224\n1  bar    one -1.814470  2.395985\n2  foo    two  1.018601  1.552825\n3  bar  three -0.595447  0.166599\n4  foo    two  1.395433  0.047609\n5  bar    two -0.392670 -0.136473\n6  foo    one  0.007207 -0.561757\n7  foo  three  1.928123 -1.623033\n\nIn [93]: df.groupby('A').sum()\nOut[93]: \n            C        D\nA                     \nbar -2.802588  2.42611\nfoo  3.146492 -0.63958\n\nIn [94]: df.groupby(['A', 'B']).sum()\nOut[94]: \n                  C         D\nA   B                        \nbar one   -1.814470  2.395985\n    three -0.595447  0.166599\n    two   -0.392670 -0.136473\nfoo one   -1.195665 -0.616981\n    three  1.928123 -1.623033\n    two    2.414034  1.600434\n```\n\n## 2.8 重塑","source":"_posts/Pandas知识总结.md","raw":"---\ntitle: Pandas知识总结\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-10-14 18:45:54\npassword:\nsummary:\ntags: \n- Pandas\n- 数据处理\ncategories: 学习笔记\n---\n\n# 1：简介\n\n在我看来，Pandas是一款数据处理工具，它相比于numpy而言，更加具有针对性。比如说，Pandas提供了两种数据结构，Series和DataFrame，分别表示一维数据和二维数据，而numpy则还有更多维数据。Pandas的特色是，它可以使用自定义的索引来表示数据的特点，这和Excel表格很类似。而numpy只有固定的整数索引。\n\n在数据中，我们可能会有这种情况，一个二维表格，每一行，表示不同的学生，每一列表示学生的不同信息。如下表所示，\n\n|      | 年龄 | 班级 |\n| ---- | ---- | ---- |\n| 小明 | 19   | 4班  |\n| 小张 | 15   | 2班  |\n| 小华 | 17   | 1班  |\n\n由年龄和班级构成的二维数组，在numpy中是无法建立的，因为numpy无法建立班级的字符串格式数据，且数组内不能含有多种属性的数据，比如年龄的数据格式是int，而班级则是string。\n\n此时Pandas的作用就出来了。Pandas可以指定上述数据每一行的意义为名字，所以其行索引`Index`可以设置为['小明','小张','小华']，而其纵坐标的索引`columns`设置为['年龄','班级']。然后再向这个DataFrame中添加数据即可。\n\n# 2：入门\n\n## 2.1 生成对象\n\n引入Pandas：\n\n```python \nimport numpy as np\nimport pandas as pd\n```\n\n生成Series：\n\n```python\ns = pd.Series([1,4,1,np.nan,8])\n```\n\n生成DataFrame：\n\n```python\ndates = pd.date_range('20130101',periods=6)\n#生成六个以20130101开始，间隔为一天的时间序列\ndf = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list('ABCD'))\n```\n\n> date_range函数可以生成一个时间序列，参数有，开始时间，结束时间，序列个数，间隔单位等。\n\ndf为：\n\n```\n                   A         B         C         D\n2013-01-01  0.469112 -0.282863 -1.509059 -1.135632\n2013-01-02  1.212112 -0.173215  0.119209 -1.044236\n2013-01-03 -0.861849 -2.104569 -0.494929  1.071804\n2013-01-04  0.721555 -0.706771 -1.039575  0.271860\n2013-01-05 -0.424972  0.567020  0.276232 -1.087401\n2013-01-06 -0.673690  0.113648 -1.478427  0.524988\n```\n\n使用字典对象生成DataFrame：\n\n```python\ndf2 = pd.DataFrame({'A':1,\n                    'B':pd.Timestamp('20130102'), \n                    'C':pd.Series(1, index=list(range(4)),dtype='float332'),\n                    'D':np.array([3]*4,dtype='int32'),\n                    'E':pd.Categorical([\"test\",\"train\",\"test\",\"train\"]),\n                    'F':'foo'})\n```\n\n## 2.2 查看数据\n\n查看DataFrame头部和尾部数据：\n\n```python\ndf.head()\ndf.tail(3)\n#可指定查看头尾部的数据行数\n```\n\n显示索引和列名：\n\n```python\ndf.index\ndf.columns\n```\n\n`df.to_numpy()`将DataFrame数据转为numpy数据\n\n`df.describe()`查看数据统计摘要\n\n`df.T`转置\n\n`df.sort_index(axis=1,ascending=False)`按轴上升排序\n\n`df.sort_values(by='B')`按轴排序\n\n## 2.3 选择数据\n\n产生`Series`\n\n```python\ndf['A']\ndf.A\n```\n\n切片：\n\n```python\ndf[0:3]\n#选择1到3行\n```\n\n```python\ndf['20130102':'20130104']\n```\n\n**按标签选择**：\n\n```python\ndf.loc[dates[0]]\n```\n\n用标签选多列：\n\n```python\ndf.loc[:,['A','B']]\n```\n\n用标签切片：\n\n```python\ndf.loc['20130102':'20130104',['A','B']]\n```\n\n提取标量：\n\n```python\ndf.loc[dates[0],'A']\ndf.at[dates[0],'A']\n```\n\n**按位置选**：\n\n```python\ndf.iloc[3]\n```\n\n用整数切片：\n\n```python\ndf.iloc[3:5,0:2]\n```\n\n用整数列表按位置切片：\n\n```python\ndf.iloc[[1,2,4],[0,2]]\n```\n\n按位置访问标量：\n\n```python\ndf.iloc[1,1]\ndf.iat[1,1]\n```\n\n**布尔索引**：\n\n用单列的值：\n\n```python\ndf[df.A>0]\n```\n\n```python\nOut[39]: \n                   A         B         C         D\n2013-01-01  0.469112 -0.282863 -1.509059 -1.135632\n2013-01-02  1.212112 -0.173215  0.119209 -1.044236\n2013-01-04  0.721555 -0.706771 -1.039575  0.271860\n```\n\n选择满足条件的值：\n\n```python\ndf[df>0]\n```\n\n```python\nOut[40]: \n                   A         B         C         D\n2013-01-01  0.469112       NaN       NaN       NaN\n2013-01-02  1.212112       NaN  0.119209       NaN\n2013-01-03       NaN       NaN       NaN  1.071804\n2013-01-04  0.721555       NaN       NaN  0.271860\n2013-01-05       NaN  0.567020  0.276232       NaN\n2013-01-06       NaN  0.113648       NaN  0.524988\n```\n\n`isin()`筛选\n\n```python\ndf2 = df.copy()\ndf2['E'] = ['one','two','three'……]\ndf2[df2['E'].isin(['one','two'])]\n```\n\n## 2.4 缺失值Nan\n\n`reindex`重建索引，不会修改源数据\n\n```python\ndf1 = df.reindex(index = dates[0:4],columns=list(df.columns)+['E'])\ndf1.loc[dates[0]:dates[1],'E'] = 1\n```\n\n```python\nOut[57]: \n                   A         B         C  D    F    E\n2013-01-01  0.000000  0.000000 -1.509059  5  NaN  1.0\n2013-01-02  1.212112 -0.173215  0.119209  5  1.0  1.0\n2013-01-03 -0.861849 -2.104569 -0.494929  5  2.0  NaN\n2013-01-04  0.721555 -0.706771 -1.039575  5  3.0  NaN\n```\n\n删除含缺失值的行：\n\n```python\ndf1.dropna(how='any')\n```\n\n填充缺失值：\n\n```python\ndf1.fillna(value=5)\n```\n\n提取缺失值的布尔掩码：\n\n```python\npd.isna(df1)\n```\n\n## 2.5 运算\n\n一般，运算时会排除缺失值\n\n在列上计算**平均值**：\n\n```python\ndf.mean()\n```\n\n在行上计算：\n\n```python\ndf.mean(1)\n```\n\n```python\nOut[62]: \n2013-01-01    0.872735\n2013-01-02    1.431621\n2013-01-03    0.707731\n2013-01-04    1.395042\n2013-01-05    1.883656\n2013-01-06    1.592306\nFreq: D, dtype: float64\n```\n\n**减法：**\n\n```python\ns = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2)\ndf.sub(s,axis='index')\n```\n\ns与df的index轴是相同的，或者说在行上他们数据的个数相同，所以，sub第二个参数填写index或者0，计算时，df每列都会减去s。\n\n`shift`函数是平移函数，s各个位置上的数向下平移，由于向下平移了两个位置，0和1位置上的数没有内容可以补，用nan自动替补。\n\n**Apply函数**：\n\n`DataFrame.apply()` 函数则会依次将每行或列取出来作为一个Series传递到apply指定的函数中。\n\n```python\nmatrix = [\n    [1,2,3],\n    [4,5,6],\n    [7,8,9]\n]\n\ndf = pd.DataFrame(matrix, columns=list('xyz'), index=list('abc'))\ndf.apply(np.square)\n```\n\n具体使用方法：\n\n[pandas apply() 函数用法](https://www.jianshu.com/p/4fdd6eee1b06)\n\n**直方图与离散化：**\n\n```python\ns = pd.Series(np.random.randint(0,7,size=10))\ns.value_counts()\t#统计s中整数的分布情况，比如4有5个\n```\n\n**字符串方法：**\n\n```python\n s = pd.Series(['A', 'B', 'C', 'Aaba', 'Baca', np.nan, 'CABA', 'dog', 'cat'])\n s.str.lower()\t#字符串小写\n```\n\n## 2.6 合并\n\n**结合：**\n\n`contact()`将零散的df合并，合并原则根据index和columns，相同合并，不同连接。\n\n```python\ndf = pd.DataFrame(np.random.randn(10, 4))\npieces = [df[:3], df[3:7], df[7:]]\npd.concat(pieces)\n```\n\n连接：\n\n`join()`直接将连个df连接起来。\n\n```python\nIn [79]: left\nOut[79]: \n   key  lval\n0  foo     1\n1  foo     2\n\nIn [80]: right\nOut[80]: \n   key  rval\n0  foo     4\n1  foo     5\n\nIn [81]: pd.merge(left, right, on='key')\nOut[81]: \n   key  lval  rval\n0  foo     1     4\n1  foo     1     5\n2  foo     2     4\n3  foo     2     5\n```\n\n```python\nIn [84]: left\nOut[84]: \n   key  lval\n0  foo     1\n1  bar     2\n\nIn [85]: right\nOut[85]: \n   key  rval\n0  foo     4\n1  bar     5\n\nIn [86]: pd.merge(left, right, on='key')\nOut[86]: \n   key  lval  rval\n0  foo     1     4\n1  bar     2     5\n```\n\n**追加：**\n\n`append()`为df追加行\n\n```python\ndf.append(s,ignore_index=True)\n```\n\n## 2.7 分组\n\n按照某个column或columns，将df分组，然后结合df的函数分别计算各个分组。\n\n```python\nIn [92]: df\nOut[92]: \n     A      B         C         D\n0  foo    one -1.202872 -0.055224\n1  bar    one -1.814470  2.395985\n2  foo    two  1.018601  1.552825\n3  bar  three -0.595447  0.166599\n4  foo    two  1.395433  0.047609\n5  bar    two -0.392670 -0.136473\n6  foo    one  0.007207 -0.561757\n7  foo  three  1.928123 -1.623033\n\nIn [93]: df.groupby('A').sum()\nOut[93]: \n            C        D\nA                     \nbar -2.802588  2.42611\nfoo  3.146492 -0.63958\n\nIn [94]: df.groupby(['A', 'B']).sum()\nOut[94]: \n                  C         D\nA   B                        \nbar one   -1.814470  2.395985\n    three -0.595447  0.166599\n    two   -0.392670 -0.136473\nfoo one   -1.195665 -0.616981\n    three  1.928123 -1.623033\n    two    2.414034  1.600434\n```\n\n## 2.8 重塑","slug":"Pandas知识总结","published":1,"updated":"2020-10-15T16:01:54.543Z","_id":"ckgaxsab2000sp0vz7ltp7v7s","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1：简介\"><a href=\"#1：简介\" class=\"headerlink\" title=\"1：简介\"></a>1：简介</h1><p>在我看来，Pandas是一款数据处理工具，它相比于numpy而言，更加具有针对性。比如说，Pandas提供了两种数据结构，Series和DataFrame，分别表示一维数据和二维数据，而numpy则还有更多维数据。Pandas的特色是，它可以使用自定义的索引来表示数据的特点，这和Excel表格很类似。而numpy只有固定的整数索引。</p>\n<p>在数据中，我们可能会有这种情况，一个二维表格，每一行，表示不同的学生，每一列表示学生的不同信息。如下表所示，</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>年龄</th>\n<th>班级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>小明</td>\n<td>19</td>\n<td>4班</td>\n</tr>\n<tr>\n<td>小张</td>\n<td>15</td>\n<td>2班</td>\n</tr>\n<tr>\n<td>小华</td>\n<td>17</td>\n<td>1班</td>\n</tr>\n</tbody></table>\n<p>由年龄和班级构成的二维数组，在numpy中是无法建立的，因为numpy无法建立班级的字符串格式数据，且数组内不能含有多种属性的数据，比如年龄的数据格式是int，而班级则是string。</p>\n<p>此时Pandas的作用就出来了。Pandas可以指定上述数据每一行的意义为名字，所以其行索引<code>Index</code>可以设置为[‘小明’,’小张’,’小华’]，而其纵坐标的索引<code>columns</code>设置为[‘年龄’,’班级’]。然后再向这个DataFrame中添加数据即可。</p>\n<h1 id=\"2：入门\"><a href=\"#2：入门\" class=\"headerlink\" title=\"2：入门\"></a>2：入门</h1><h2 id=\"2-1-生成对象\"><a href=\"#2-1-生成对象\" class=\"headerlink\" title=\"2.1 生成对象\"></a>2.1 生成对象</h2><p>引入Pandas：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br></pre></td></tr></table></figure>\n\n<p>生成Series：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series([<span class=\"number\">1</span>,<span class=\"number\">4</span>,<span class=\"number\">1</span>,np.nan,<span class=\"number\">8</span>])</span><br></pre></td></tr></table></figure>\n\n<p>生成DataFrame：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dates = pd.date_range(<span class=\"string\">&#x27;20130101&#x27;</span>,periods=<span class=\"number\">6</span>)</span><br><span class=\"line\"><span class=\"comment\">#生成六个以20130101开始，间隔为一天的时间序列</span></span><br><span class=\"line\">df = pd.DataFrame(np.random.randn(<span class=\"number\">6</span>,<span class=\"number\">4</span>), index=dates, columns=list(<span class=\"string\">&#x27;ABCD&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>date_range函数可以生成一个时间序列，参数有，开始时间，结束时间，序列个数，间隔单位等。</p>\n</blockquote>\n<p>df为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                   A         B         C         D</span><br><span class=\"line\">2013-01-01  0.469112 -0.282863 -1.509059 -1.135632</span><br><span class=\"line\">2013-01-02  1.212112 -0.173215  0.119209 -1.044236</span><br><span class=\"line\">2013-01-03 -0.861849 -2.104569 -0.494929  1.071804</span><br><span class=\"line\">2013-01-04  0.721555 -0.706771 -1.039575  0.271860</span><br><span class=\"line\">2013-01-05 -0.424972  0.567020  0.276232 -1.087401</span><br><span class=\"line\">2013-01-06 -0.673690  0.113648 -1.478427  0.524988</span><br></pre></td></tr></table></figure>\n\n<p>使用字典对象生成DataFrame：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df2 = pd.DataFrame(&#123;<span class=\"string\">&#x27;A&#x27;</span>:<span class=\"number\">1</span>,</span><br><span class=\"line\">                    <span class=\"string\">&#x27;B&#x27;</span>:pd.Timestamp(<span class=\"string\">&#x27;20130102&#x27;</span>), </span><br><span class=\"line\">                    <span class=\"string\">&#x27;C&#x27;</span>:pd.Series(<span class=\"number\">1</span>, index=list(range(<span class=\"number\">4</span>)),dtype=<span class=\"string\">&#x27;float332&#x27;</span>),</span><br><span class=\"line\">                    <span class=\"string\">&#x27;D&#x27;</span>:np.array([<span class=\"number\">3</span>]*<span class=\"number\">4</span>,dtype=<span class=\"string\">&#x27;int32&#x27;</span>),</span><br><span class=\"line\">                    <span class=\"string\">&#x27;E&#x27;</span>:pd.Categorical([<span class=\"string\">&quot;test&quot;</span>,<span class=\"string\">&quot;train&quot;</span>,<span class=\"string\">&quot;test&quot;</span>,<span class=\"string\">&quot;train&quot;</span>]),</span><br><span class=\"line\">                    <span class=\"string\">&#x27;F&#x27;</span>:<span class=\"string\">&#x27;foo&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-查看数据\"><a href=\"#2-2-查看数据\" class=\"headerlink\" title=\"2.2 查看数据\"></a>2.2 查看数据</h2><p>查看DataFrame头部和尾部数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.head()</span><br><span class=\"line\">df.tail(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"comment\">#可指定查看头尾部的数据行数</span></span><br></pre></td></tr></table></figure>\n\n<p>显示索引和列名：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.index</span><br><span class=\"line\">df.columns</span><br></pre></td></tr></table></figure>\n\n<p><code>df.to_numpy()</code>将DataFrame数据转为numpy数据</p>\n<p><code>df.describe()</code>查看数据统计摘要</p>\n<p><code>df.T</code>转置</p>\n<p><code>df.sort_index(axis=1,ascending=False)</code>按轴上升排序</p>\n<p><code>df.sort_values(by=&#39;B&#39;)</code>按轴排序</p>\n<h2 id=\"2-3-选择数据\"><a href=\"#2-3-选择数据\" class=\"headerlink\" title=\"2.3 选择数据\"></a>2.3 选择数据</h2><p>产生<code>Series</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[<span class=\"string\">&#x27;A&#x27;</span>]</span><br><span class=\"line\">df.A</span><br></pre></td></tr></table></figure>\n\n<p>切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[<span class=\"number\">0</span>:<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"comment\">#选择1到3行</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[<span class=\"string\">&#x27;20130102&#x27;</span>:<span class=\"string\">&#x27;20130104&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>按标签选择</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[dates[<span class=\"number\">0</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>用标签选多列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[:,[<span class=\"string\">&#x27;A&#x27;</span>,<span class=\"string\">&#x27;B&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>用标签切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[<span class=\"string\">&#x27;20130102&#x27;</span>:<span class=\"string\">&#x27;20130104&#x27;</span>,[<span class=\"string\">&#x27;A&#x27;</span>,<span class=\"string\">&#x27;B&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>提取标量：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[dates[<span class=\"number\">0</span>],<span class=\"string\">&#x27;A&#x27;</span>]</span><br><span class=\"line\">df.at[dates[<span class=\"number\">0</span>],<span class=\"string\">&#x27;A&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>按位置选</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[<span class=\"number\">3</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用整数切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[<span class=\"number\">3</span>:<span class=\"number\">5</span>,<span class=\"number\">0</span>:<span class=\"number\">2</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用整数列表按位置切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">4</span>],[<span class=\"number\">0</span>,<span class=\"number\">2</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>按位置访问标量：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[<span class=\"number\">1</span>,<span class=\"number\">1</span>]</span><br><span class=\"line\">df.iat[<span class=\"number\">1</span>,<span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>布尔索引</strong>：</p>\n<p>用单列的值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[df.A&gt;<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">39</span>]: </span><br><span class=\"line\">                   A         B         C         D</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>  <span class=\"number\">0.469112</span> <span class=\"number\">-0.282863</span> <span class=\"number\">-1.509059</span> <span class=\"number\">-1.135632</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>  <span class=\"number\">1.212112</span> <span class=\"number\">-0.173215</span>  <span class=\"number\">0.119209</span> <span class=\"number\">-1.044236</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>  <span class=\"number\">0.721555</span> <span class=\"number\">-0.706771</span> <span class=\"number\">-1.039575</span>  <span class=\"number\">0.271860</span></span><br></pre></td></tr></table></figure>\n\n<p>选择满足条件的值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[df&gt;<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">40</span>]: </span><br><span class=\"line\">                   A         B         C         D</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>  <span class=\"number\">0.469112</span>       NaN       NaN       NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>  <span class=\"number\">1.212112</span>       NaN  <span class=\"number\">0.119209</span>       NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-03</span>       NaN       NaN       NaN  <span class=\"number\">1.071804</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>  <span class=\"number\">0.721555</span>       NaN       NaN  <span class=\"number\">0.271860</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-05</span>       NaN  <span class=\"number\">0.567020</span>  <span class=\"number\">0.276232</span>       NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-06</span>       NaN  <span class=\"number\">0.113648</span>       NaN  <span class=\"number\">0.524988</span></span><br></pre></td></tr></table></figure>\n\n<p><code>isin()</code>筛选</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df2 = df.copy()</span><br><span class=\"line\">df2[<span class=\"string\">&#x27;E&#x27;</span>] = [<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>……]</span><br><span class=\"line\">df2[df2[<span class=\"string\">&#x27;E&#x27;</span>].isin([<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>])]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-缺失值Nan\"><a href=\"#2-4-缺失值Nan\" class=\"headerlink\" title=\"2.4 缺失值Nan\"></a>2.4 缺失值Nan</h2><p><code>reindex</code>重建索引，不会修改源数据</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df1 = df.reindex(index = dates[<span class=\"number\">0</span>:<span class=\"number\">4</span>],columns=list(df.columns)+[<span class=\"string\">&#x27;E&#x27;</span>])</span><br><span class=\"line\">df1.loc[dates[<span class=\"number\">0</span>]:dates[<span class=\"number\">1</span>],<span class=\"string\">&#x27;E&#x27;</span>] = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">57</span>]: </span><br><span class=\"line\">                   A         B         C  D    F    E</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>  <span class=\"number\">0.000000</span>  <span class=\"number\">0.000000</span> <span class=\"number\">-1.509059</span>  <span class=\"number\">5</span>  NaN  <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>  <span class=\"number\">1.212112</span> <span class=\"number\">-0.173215</span>  <span class=\"number\">0.119209</span>  <span class=\"number\">5</span>  <span class=\"number\">1.0</span>  <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-03</span> <span class=\"number\">-0.861849</span> <span class=\"number\">-2.104569</span> <span class=\"number\">-0.494929</span>  <span class=\"number\">5</span>  <span class=\"number\">2.0</span>  NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>  <span class=\"number\">0.721555</span> <span class=\"number\">-0.706771</span> <span class=\"number\">-1.039575</span>  <span class=\"number\">5</span>  <span class=\"number\">3.0</span>  NaN</span><br></pre></td></tr></table></figure>\n\n<p>删除含缺失值的行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df1.dropna(how=<span class=\"string\">&#x27;any&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>填充缺失值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df1.fillna(value=<span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<p>提取缺失值的布尔掩码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pd.isna(df1)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-运算\"><a href=\"#2-5-运算\" class=\"headerlink\" title=\"2.5 运算\"></a>2.5 运算</h2><p>一般，运算时会排除缺失值</p>\n<p>在列上计算<strong>平均值</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.mean()</span><br></pre></td></tr></table></figure>\n\n<p>在行上计算：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.mean(<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">62</span>]: </span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>    <span class=\"number\">0.872735</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>    <span class=\"number\">1.431621</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-03</span>    <span class=\"number\">0.707731</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>    <span class=\"number\">1.395042</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-05</span>    <span class=\"number\">1.883656</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-06</span>    <span class=\"number\">1.592306</span></span><br><span class=\"line\">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure>\n\n<p><strong>减法：</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series([<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">5</span>,np.nan,<span class=\"number\">6</span>,<span class=\"number\">8</span>], index=dates).shift(<span class=\"number\">2</span>)</span><br><span class=\"line\">df.sub(s,axis=<span class=\"string\">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>s与df的index轴是相同的，或者说在行上他们数据的个数相同，所以，sub第二个参数填写index或者0，计算时，df每列都会减去s。</p>\n<p><code>shift</code>函数是平移函数，s各个位置上的数向下平移，由于向下平移了两个位置，0和1位置上的数没有内容可以补，用nan自动替补。</p>\n<p><strong>Apply函数</strong>：</p>\n<p><code>DataFrame.apply()</code> 函数则会依次将每行或列取出来作为一个Series传递到apply指定的函数中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">matrix = [</span><br><span class=\"line\">    [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],</span><br><span class=\"line\">    [<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>],</span><br><span class=\"line\">    [<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">df = pd.DataFrame(matrix, columns=list(<span class=\"string\">&#x27;xyz&#x27;</span>), index=list(<span class=\"string\">&#x27;abc&#x27;</span>))</span><br><span class=\"line\">df.apply(np.square)</span><br></pre></td></tr></table></figure>\n\n<p>具体使用方法：</p>\n<p><a href=\"https://www.jianshu.com/p/4fdd6eee1b06\">pandas apply() 函数用法</a></p>\n<p><strong>直方图与离散化：</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series(np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">7</span>,size=<span class=\"number\">10</span>))</span><br><span class=\"line\">s.value_counts()\t<span class=\"comment\">#统计s中整数的分布情况，比如4有5个</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>字符串方法：</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series([<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>, <span class=\"string\">&#x27;C&#x27;</span>, <span class=\"string\">&#x27;Aaba&#x27;</span>, <span class=\"string\">&#x27;Baca&#x27;</span>, np.nan, <span class=\"string\">&#x27;CABA&#x27;</span>, <span class=\"string\">&#x27;dog&#x27;</span>, <span class=\"string\">&#x27;cat&#x27;</span>])</span><br><span class=\"line\">s.str.lower()\t<span class=\"comment\">#字符串小写</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-合并\"><a href=\"#2-6-合并\" class=\"headerlink\" title=\"2.6 合并\"></a>2.6 合并</h2><p><strong>结合：</strong></p>\n<p><code>contact()</code>将零散的df合并，合并原则根据index和columns，相同合并，不同连接。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df = pd.DataFrame(np.random.randn(<span class=\"number\">10</span>, <span class=\"number\">4</span>))</span><br><span class=\"line\">pieces = [df[:<span class=\"number\">3</span>], df[<span class=\"number\">3</span>:<span class=\"number\">7</span>], df[<span class=\"number\">7</span>:]]</span><br><span class=\"line\">pd.concat(pieces)</span><br></pre></td></tr></table></figure>\n\n<p>连接：</p>\n<p><code>join()</code>直接将连个df连接起来。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">79</span>]: left</span><br><span class=\"line\">Out[<span class=\"number\">79</span>]: </span><br><span class=\"line\">   key  lval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>  foo     <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">80</span>]: right</span><br><span class=\"line\">Out[<span class=\"number\">80</span>]: </span><br><span class=\"line\">   key  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  foo     <span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">81</span>]: pd.merge(left, right, on=<span class=\"string\">&#x27;key&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">81</span>]: </span><br><span class=\"line\">   key  lval  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span>     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  foo     <span class=\"number\">1</span>     <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">2</span>  foo     <span class=\"number\">2</span>     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">3</span>  foo     <span class=\"number\">2</span>     <span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">84</span>]: left</span><br><span class=\"line\">Out[<span class=\"number\">84</span>]: </span><br><span class=\"line\">   key  lval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar     <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">85</span>]: right</span><br><span class=\"line\">Out[<span class=\"number\">85</span>]: </span><br><span class=\"line\">   key  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar     <span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">86</span>]: pd.merge(left, right, on=<span class=\"string\">&#x27;key&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">86</span>]: </span><br><span class=\"line\">   key  lval  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span>     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar     <span class=\"number\">2</span>     <span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>追加：</strong></p>\n<p><code>append()</code>为df追加行</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.append(s,ignore_index=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-分组\"><a href=\"#2-7-分组\" class=\"headerlink\" title=\"2.7 分组\"></a>2.7 分组</h2><p>按照某个column或columns，将df分组，然后结合df的函数分别计算各个分组。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">92</span>]: df</span><br><span class=\"line\">Out[<span class=\"number\">92</span>]: </span><br><span class=\"line\">     A      B         C         D</span><br><span class=\"line\"><span class=\"number\">0</span>  foo    one <span class=\"number\">-1.202872</span> <span class=\"number\">-0.055224</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar    one <span class=\"number\">-1.814470</span>  <span class=\"number\">2.395985</span></span><br><span class=\"line\"><span class=\"number\">2</span>  foo    two  <span class=\"number\">1.018601</span>  <span class=\"number\">1.552825</span></span><br><span class=\"line\"><span class=\"number\">3</span>  bar  three <span class=\"number\">-0.595447</span>  <span class=\"number\">0.166599</span></span><br><span class=\"line\"><span class=\"number\">4</span>  foo    two  <span class=\"number\">1.395433</span>  <span class=\"number\">0.047609</span></span><br><span class=\"line\"><span class=\"number\">5</span>  bar    two <span class=\"number\">-0.392670</span> <span class=\"number\">-0.136473</span></span><br><span class=\"line\"><span class=\"number\">6</span>  foo    one  <span class=\"number\">0.007207</span> <span class=\"number\">-0.561757</span></span><br><span class=\"line\"><span class=\"number\">7</span>  foo  three  <span class=\"number\">1.928123</span> <span class=\"number\">-1.623033</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">93</span>]: df.groupby(<span class=\"string\">&#x27;A&#x27;</span>).sum()</span><br><span class=\"line\">Out[<span class=\"number\">93</span>]: </span><br><span class=\"line\">            C        D</span><br><span class=\"line\">A                     </span><br><span class=\"line\">bar <span class=\"number\">-2.802588</span>  <span class=\"number\">2.42611</span></span><br><span class=\"line\">foo  <span class=\"number\">3.146492</span> <span class=\"number\">-0.63958</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">94</span>]: df.groupby([<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>]).sum()</span><br><span class=\"line\">Out[<span class=\"number\">94</span>]: </span><br><span class=\"line\">                  C         D</span><br><span class=\"line\">A   B                        </span><br><span class=\"line\">bar one   <span class=\"number\">-1.814470</span>  <span class=\"number\">2.395985</span></span><br><span class=\"line\">    three <span class=\"number\">-0.595447</span>  <span class=\"number\">0.166599</span></span><br><span class=\"line\">    two   <span class=\"number\">-0.392670</span> <span class=\"number\">-0.136473</span></span><br><span class=\"line\">foo one   <span class=\"number\">-1.195665</span> <span class=\"number\">-0.616981</span></span><br><span class=\"line\">    three  <span class=\"number\">1.928123</span> <span class=\"number\">-1.623033</span></span><br><span class=\"line\">    two    <span class=\"number\">2.414034</span>  <span class=\"number\">1.600434</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-重塑\"><a href=\"#2-8-重塑\" class=\"headerlink\" title=\"2.8 重塑\"></a>2.8 重塑</h2>","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：简介\"><a href=\"#1：简介\" class=\"headerlink\" title=\"1：简介\"></a>1：简介</h1><p>在我看来，Pandas是一款数据处理工具，它相比于numpy而言，更加具有针对性。比如说，Pandas提供了两种数据结构，Series和DataFrame，分别表示一维数据和二维数据，而numpy则还有更多维数据。Pandas的特色是，它可以使用自定义的索引来表示数据的特点，这和Excel表格很类似。而numpy只有固定的整数索引。</p>\n<p>在数据中，我们可能会有这种情况，一个二维表格，每一行，表示不同的学生，每一列表示学生的不同信息。如下表所示，</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>年龄</th>\n<th>班级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>小明</td>\n<td>19</td>\n<td>4班</td>\n</tr>\n<tr>\n<td>小张</td>\n<td>15</td>\n<td>2班</td>\n</tr>\n<tr>\n<td>小华</td>\n<td>17</td>\n<td>1班</td>\n</tr>\n</tbody></table>\n<p>由年龄和班级构成的二维数组，在numpy中是无法建立的，因为numpy无法建立班级的字符串格式数据，且数组内不能含有多种属性的数据，比如年龄的数据格式是int，而班级则是string。</p>\n<p>此时Pandas的作用就出来了。Pandas可以指定上述数据每一行的意义为名字，所以其行索引<code>Index</code>可以设置为[‘小明’,’小张’,’小华’]，而其纵坐标的索引<code>columns</code>设置为[‘年龄’,’班级’]。然后再向这个DataFrame中添加数据即可。</p>\n<h1 id=\"2：入门\"><a href=\"#2：入门\" class=\"headerlink\" title=\"2：入门\"></a>2：入门</h1><h2 id=\"2-1-生成对象\"><a href=\"#2-1-生成对象\" class=\"headerlink\" title=\"2.1 生成对象\"></a>2.1 生成对象</h2><p>引入Pandas：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br></pre></td></tr></table></figure>\n\n<p>生成Series：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series([<span class=\"number\">1</span>,<span class=\"number\">4</span>,<span class=\"number\">1</span>,np.nan,<span class=\"number\">8</span>])</span><br></pre></td></tr></table></figure>\n\n<p>生成DataFrame：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dates = pd.date_range(<span class=\"string\">&#x27;20130101&#x27;</span>,periods=<span class=\"number\">6</span>)</span><br><span class=\"line\"><span class=\"comment\">#生成六个以20130101开始，间隔为一天的时间序列</span></span><br><span class=\"line\">df = pd.DataFrame(np.random.randn(<span class=\"number\">6</span>,<span class=\"number\">4</span>), index=dates, columns=list(<span class=\"string\">&#x27;ABCD&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>date_range函数可以生成一个时间序列，参数有，开始时间，结束时间，序列个数，间隔单位等。</p>\n</blockquote>\n<p>df为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                   A         B         C         D</span><br><span class=\"line\">2013-01-01  0.469112 -0.282863 -1.509059 -1.135632</span><br><span class=\"line\">2013-01-02  1.212112 -0.173215  0.119209 -1.044236</span><br><span class=\"line\">2013-01-03 -0.861849 -2.104569 -0.494929  1.071804</span><br><span class=\"line\">2013-01-04  0.721555 -0.706771 -1.039575  0.271860</span><br><span class=\"line\">2013-01-05 -0.424972  0.567020  0.276232 -1.087401</span><br><span class=\"line\">2013-01-06 -0.673690  0.113648 -1.478427  0.524988</span><br></pre></td></tr></table></figure>\n\n<p>使用字典对象生成DataFrame：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df2 = pd.DataFrame(&#123;<span class=\"string\">&#x27;A&#x27;</span>:<span class=\"number\">1</span>,</span><br><span class=\"line\">                    <span class=\"string\">&#x27;B&#x27;</span>:pd.Timestamp(<span class=\"string\">&#x27;20130102&#x27;</span>), </span><br><span class=\"line\">                    <span class=\"string\">&#x27;C&#x27;</span>:pd.Series(<span class=\"number\">1</span>, index=list(range(<span class=\"number\">4</span>)),dtype=<span class=\"string\">&#x27;float332&#x27;</span>),</span><br><span class=\"line\">                    <span class=\"string\">&#x27;D&#x27;</span>:np.array([<span class=\"number\">3</span>]*<span class=\"number\">4</span>,dtype=<span class=\"string\">&#x27;int32&#x27;</span>),</span><br><span class=\"line\">                    <span class=\"string\">&#x27;E&#x27;</span>:pd.Categorical([<span class=\"string\">&quot;test&quot;</span>,<span class=\"string\">&quot;train&quot;</span>,<span class=\"string\">&quot;test&quot;</span>,<span class=\"string\">&quot;train&quot;</span>]),</span><br><span class=\"line\">                    <span class=\"string\">&#x27;F&#x27;</span>:<span class=\"string\">&#x27;foo&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-查看数据\"><a href=\"#2-2-查看数据\" class=\"headerlink\" title=\"2.2 查看数据\"></a>2.2 查看数据</h2><p>查看DataFrame头部和尾部数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.head()</span><br><span class=\"line\">df.tail(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"comment\">#可指定查看头尾部的数据行数</span></span><br></pre></td></tr></table></figure>\n\n<p>显示索引和列名：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.index</span><br><span class=\"line\">df.columns</span><br></pre></td></tr></table></figure>\n\n<p><code>df.to_numpy()</code>将DataFrame数据转为numpy数据</p>\n<p><code>df.describe()</code>查看数据统计摘要</p>\n<p><code>df.T</code>转置</p>\n<p><code>df.sort_index(axis=1,ascending=False)</code>按轴上升排序</p>\n<p><code>df.sort_values(by=&#39;B&#39;)</code>按轴排序</p>\n<h2 id=\"2-3-选择数据\"><a href=\"#2-3-选择数据\" class=\"headerlink\" title=\"2.3 选择数据\"></a>2.3 选择数据</h2><p>产生<code>Series</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[<span class=\"string\">&#x27;A&#x27;</span>]</span><br><span class=\"line\">df.A</span><br></pre></td></tr></table></figure>\n\n<p>切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[<span class=\"number\">0</span>:<span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"comment\">#选择1到3行</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[<span class=\"string\">&#x27;20130102&#x27;</span>:<span class=\"string\">&#x27;20130104&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>按标签选择</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[dates[<span class=\"number\">0</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>用标签选多列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[:,[<span class=\"string\">&#x27;A&#x27;</span>,<span class=\"string\">&#x27;B&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>用标签切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[<span class=\"string\">&#x27;20130102&#x27;</span>:<span class=\"string\">&#x27;20130104&#x27;</span>,[<span class=\"string\">&#x27;A&#x27;</span>,<span class=\"string\">&#x27;B&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>提取标量：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.loc[dates[<span class=\"number\">0</span>],<span class=\"string\">&#x27;A&#x27;</span>]</span><br><span class=\"line\">df.at[dates[<span class=\"number\">0</span>],<span class=\"string\">&#x27;A&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>按位置选</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[<span class=\"number\">3</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用整数切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[<span class=\"number\">3</span>:<span class=\"number\">5</span>,<span class=\"number\">0</span>:<span class=\"number\">2</span>]</span><br></pre></td></tr></table></figure>\n\n<p>用整数列表按位置切片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">4</span>],[<span class=\"number\">0</span>,<span class=\"number\">2</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>按位置访问标量：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.iloc[<span class=\"number\">1</span>,<span class=\"number\">1</span>]</span><br><span class=\"line\">df.iat[<span class=\"number\">1</span>,<span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>布尔索引</strong>：</p>\n<p>用单列的值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[df.A&gt;<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">39</span>]: </span><br><span class=\"line\">                   A         B         C         D</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>  <span class=\"number\">0.469112</span> <span class=\"number\">-0.282863</span> <span class=\"number\">-1.509059</span> <span class=\"number\">-1.135632</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>  <span class=\"number\">1.212112</span> <span class=\"number\">-0.173215</span>  <span class=\"number\">0.119209</span> <span class=\"number\">-1.044236</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>  <span class=\"number\">0.721555</span> <span class=\"number\">-0.706771</span> <span class=\"number\">-1.039575</span>  <span class=\"number\">0.271860</span></span><br></pre></td></tr></table></figure>\n\n<p>选择满足条件的值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df[df&gt;<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">40</span>]: </span><br><span class=\"line\">                   A         B         C         D</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>  <span class=\"number\">0.469112</span>       NaN       NaN       NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>  <span class=\"number\">1.212112</span>       NaN  <span class=\"number\">0.119209</span>       NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-03</span>       NaN       NaN       NaN  <span class=\"number\">1.071804</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>  <span class=\"number\">0.721555</span>       NaN       NaN  <span class=\"number\">0.271860</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-05</span>       NaN  <span class=\"number\">0.567020</span>  <span class=\"number\">0.276232</span>       NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-06</span>       NaN  <span class=\"number\">0.113648</span>       NaN  <span class=\"number\">0.524988</span></span><br></pre></td></tr></table></figure>\n\n<p><code>isin()</code>筛选</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df2 = df.copy()</span><br><span class=\"line\">df2[<span class=\"string\">&#x27;E&#x27;</span>] = [<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>……]</span><br><span class=\"line\">df2[df2[<span class=\"string\">&#x27;E&#x27;</span>].isin([<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>])]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-缺失值Nan\"><a href=\"#2-4-缺失值Nan\" class=\"headerlink\" title=\"2.4 缺失值Nan\"></a>2.4 缺失值Nan</h2><p><code>reindex</code>重建索引，不会修改源数据</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df1 = df.reindex(index = dates[<span class=\"number\">0</span>:<span class=\"number\">4</span>],columns=list(df.columns)+[<span class=\"string\">&#x27;E&#x27;</span>])</span><br><span class=\"line\">df1.loc[dates[<span class=\"number\">0</span>]:dates[<span class=\"number\">1</span>],<span class=\"string\">&#x27;E&#x27;</span>] = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">57</span>]: </span><br><span class=\"line\">                   A         B         C  D    F    E</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>  <span class=\"number\">0.000000</span>  <span class=\"number\">0.000000</span> <span class=\"number\">-1.509059</span>  <span class=\"number\">5</span>  NaN  <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>  <span class=\"number\">1.212112</span> <span class=\"number\">-0.173215</span>  <span class=\"number\">0.119209</span>  <span class=\"number\">5</span>  <span class=\"number\">1.0</span>  <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-03</span> <span class=\"number\">-0.861849</span> <span class=\"number\">-2.104569</span> <span class=\"number\">-0.494929</span>  <span class=\"number\">5</span>  <span class=\"number\">2.0</span>  NaN</span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>  <span class=\"number\">0.721555</span> <span class=\"number\">-0.706771</span> <span class=\"number\">-1.039575</span>  <span class=\"number\">5</span>  <span class=\"number\">3.0</span>  NaN</span><br></pre></td></tr></table></figure>\n\n<p>删除含缺失值的行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df1.dropna(how=<span class=\"string\">&#x27;any&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>填充缺失值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df1.fillna(value=<span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<p>提取缺失值的布尔掩码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pd.isna(df1)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-运算\"><a href=\"#2-5-运算\" class=\"headerlink\" title=\"2.5 运算\"></a>2.5 运算</h2><p>一般，运算时会排除缺失值</p>\n<p>在列上计算<strong>平均值</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.mean()</span><br></pre></td></tr></table></figure>\n\n<p>在行上计算：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.mean(<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Out[<span class=\"number\">62</span>]: </span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-01</span>    <span class=\"number\">0.872735</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-02</span>    <span class=\"number\">1.431621</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-03</span>    <span class=\"number\">0.707731</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-04</span>    <span class=\"number\">1.395042</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-05</span>    <span class=\"number\">1.883656</span></span><br><span class=\"line\"><span class=\"number\">2013</span><span class=\"number\">-01</span><span class=\"number\">-06</span>    <span class=\"number\">1.592306</span></span><br><span class=\"line\">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure>\n\n<p><strong>减法：</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series([<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">5</span>,np.nan,<span class=\"number\">6</span>,<span class=\"number\">8</span>], index=dates).shift(<span class=\"number\">2</span>)</span><br><span class=\"line\">df.sub(s,axis=<span class=\"string\">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>s与df的index轴是相同的，或者说在行上他们数据的个数相同，所以，sub第二个参数填写index或者0，计算时，df每列都会减去s。</p>\n<p><code>shift</code>函数是平移函数，s各个位置上的数向下平移，由于向下平移了两个位置，0和1位置上的数没有内容可以补，用nan自动替补。</p>\n<p><strong>Apply函数</strong>：</p>\n<p><code>DataFrame.apply()</code> 函数则会依次将每行或列取出来作为一个Series传递到apply指定的函数中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">matrix = [</span><br><span class=\"line\">    [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],</span><br><span class=\"line\">    [<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>],</span><br><span class=\"line\">    [<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>]</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">df = pd.DataFrame(matrix, columns=list(<span class=\"string\">&#x27;xyz&#x27;</span>), index=list(<span class=\"string\">&#x27;abc&#x27;</span>))</span><br><span class=\"line\">df.apply(np.square)</span><br></pre></td></tr></table></figure>\n\n<p>具体使用方法：</p>\n<p><a href=\"https://www.jianshu.com/p/4fdd6eee1b06\">pandas apply() 函数用法</a></p>\n<p><strong>直方图与离散化：</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series(np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">7</span>,size=<span class=\"number\">10</span>))</span><br><span class=\"line\">s.value_counts()\t<span class=\"comment\">#统计s中整数的分布情况，比如4有5个</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>字符串方法：</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = pd.Series([<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>, <span class=\"string\">&#x27;C&#x27;</span>, <span class=\"string\">&#x27;Aaba&#x27;</span>, <span class=\"string\">&#x27;Baca&#x27;</span>, np.nan, <span class=\"string\">&#x27;CABA&#x27;</span>, <span class=\"string\">&#x27;dog&#x27;</span>, <span class=\"string\">&#x27;cat&#x27;</span>])</span><br><span class=\"line\">s.str.lower()\t<span class=\"comment\">#字符串小写</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-合并\"><a href=\"#2-6-合并\" class=\"headerlink\" title=\"2.6 合并\"></a>2.6 合并</h2><p><strong>结合：</strong></p>\n<p><code>contact()</code>将零散的df合并，合并原则根据index和columns，相同合并，不同连接。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df = pd.DataFrame(np.random.randn(<span class=\"number\">10</span>, <span class=\"number\">4</span>))</span><br><span class=\"line\">pieces = [df[:<span class=\"number\">3</span>], df[<span class=\"number\">3</span>:<span class=\"number\">7</span>], df[<span class=\"number\">7</span>:]]</span><br><span class=\"line\">pd.concat(pieces)</span><br></pre></td></tr></table></figure>\n\n<p>连接：</p>\n<p><code>join()</code>直接将连个df连接起来。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">79</span>]: left</span><br><span class=\"line\">Out[<span class=\"number\">79</span>]: </span><br><span class=\"line\">   key  lval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>  foo     <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">80</span>]: right</span><br><span class=\"line\">Out[<span class=\"number\">80</span>]: </span><br><span class=\"line\">   key  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  foo     <span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">81</span>]: pd.merge(left, right, on=<span class=\"string\">&#x27;key&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">81</span>]: </span><br><span class=\"line\">   key  lval  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span>     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  foo     <span class=\"number\">1</span>     <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">2</span>  foo     <span class=\"number\">2</span>     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">3</span>  foo     <span class=\"number\">2</span>     <span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">84</span>]: left</span><br><span class=\"line\">Out[<span class=\"number\">84</span>]: </span><br><span class=\"line\">   key  lval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar     <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">85</span>]: right</span><br><span class=\"line\">Out[<span class=\"number\">85</span>]: </span><br><span class=\"line\">   key  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar     <span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">86</span>]: pd.merge(left, right, on=<span class=\"string\">&#x27;key&#x27;</span>)</span><br><span class=\"line\">Out[<span class=\"number\">86</span>]: </span><br><span class=\"line\">   key  lval  rval</span><br><span class=\"line\"><span class=\"number\">0</span>  foo     <span class=\"number\">1</span>     <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar     <span class=\"number\">2</span>     <span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>追加：</strong></p>\n<p><code>append()</code>为df追加行</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df.append(s,ignore_index=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-分组\"><a href=\"#2-7-分组\" class=\"headerlink\" title=\"2.7 分组\"></a>2.7 分组</h2><p>按照某个column或columns，将df分组，然后结合df的函数分别计算各个分组。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In [<span class=\"number\">92</span>]: df</span><br><span class=\"line\">Out[<span class=\"number\">92</span>]: </span><br><span class=\"line\">     A      B         C         D</span><br><span class=\"line\"><span class=\"number\">0</span>  foo    one <span class=\"number\">-1.202872</span> <span class=\"number\">-0.055224</span></span><br><span class=\"line\"><span class=\"number\">1</span>  bar    one <span class=\"number\">-1.814470</span>  <span class=\"number\">2.395985</span></span><br><span class=\"line\"><span class=\"number\">2</span>  foo    two  <span class=\"number\">1.018601</span>  <span class=\"number\">1.552825</span></span><br><span class=\"line\"><span class=\"number\">3</span>  bar  three <span class=\"number\">-0.595447</span>  <span class=\"number\">0.166599</span></span><br><span class=\"line\"><span class=\"number\">4</span>  foo    two  <span class=\"number\">1.395433</span>  <span class=\"number\">0.047609</span></span><br><span class=\"line\"><span class=\"number\">5</span>  bar    two <span class=\"number\">-0.392670</span> <span class=\"number\">-0.136473</span></span><br><span class=\"line\"><span class=\"number\">6</span>  foo    one  <span class=\"number\">0.007207</span> <span class=\"number\">-0.561757</span></span><br><span class=\"line\"><span class=\"number\">7</span>  foo  three  <span class=\"number\">1.928123</span> <span class=\"number\">-1.623033</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">93</span>]: df.groupby(<span class=\"string\">&#x27;A&#x27;</span>).sum()</span><br><span class=\"line\">Out[<span class=\"number\">93</span>]: </span><br><span class=\"line\">            C        D</span><br><span class=\"line\">A                     </span><br><span class=\"line\">bar <span class=\"number\">-2.802588</span>  <span class=\"number\">2.42611</span></span><br><span class=\"line\">foo  <span class=\"number\">3.146492</span> <span class=\"number\">-0.63958</span></span><br><span class=\"line\"></span><br><span class=\"line\">In [<span class=\"number\">94</span>]: df.groupby([<span class=\"string\">&#x27;A&#x27;</span>, <span class=\"string\">&#x27;B&#x27;</span>]).sum()</span><br><span class=\"line\">Out[<span class=\"number\">94</span>]: </span><br><span class=\"line\">                  C         D</span><br><span class=\"line\">A   B                        </span><br><span class=\"line\">bar one   <span class=\"number\">-1.814470</span>  <span class=\"number\">2.395985</span></span><br><span class=\"line\">    three <span class=\"number\">-0.595447</span>  <span class=\"number\">0.166599</span></span><br><span class=\"line\">    two   <span class=\"number\">-0.392670</span> <span class=\"number\">-0.136473</span></span><br><span class=\"line\">foo one   <span class=\"number\">-1.195665</span> <span class=\"number\">-0.616981</span></span><br><span class=\"line\">    three  <span class=\"number\">1.928123</span> <span class=\"number\">-1.623033</span></span><br><span class=\"line\">    two    <span class=\"number\">2.414034</span>  <span class=\"number\">1.600434</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-重塑\"><a href=\"#2-8-重塑\" class=\"headerlink\" title=\"2.8 重塑\"></a>2.8 重塑</h2>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Thu Oct 15 2020 18:01:54 GMT+0200 (GMT+02:00)","title":"Pandas知识总结","path":"2020/10/14/Pandas知识总结/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-10-14T16:45:54.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-10-14T16:45:54.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Pandas","数据处理"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Python基础","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-07-22T11:51:02.000Z","password":null,"summary":"在网络编程中，Python和爬虫是非常有用的辅助工具。许多网站后端需要用到的工具都基于Python编写，而许多数据的采集发布，也离不开Python，Python也是目前爬虫程序使用最多的机器语言。之前在学习机器学习，Python作为其不可或缺的学习部分，由于我的知识缺乏，使之变得特别困难。因此，我希望通过爬虫学习，重新系统地学习Python，同时巩固并亲手实践编写爬虫程序。本文是Python基础，爬虫的准备工作。","_content":"\n# 1: Hello World\n\nwindows `win`+`R`打开运行菜单，输入`CMD`，进入终端。输入`python`进入python终端程序。输入`print(\"hello,world\")`打印文字。\n\n`import this`打印python之禅\n\n结束命令提示符：\n\n`exit()`\n\n`ctrl`+`z`\n\n> 命令提示符中的每一行是相关联的。\n\n执行以`.py`结尾文件。\n\n命令提示符中输入`python hello.world.py`\n\n# 2: 基础\n\n## 2.1 注释\n\n`#注释`：单行注释\n\n`***注释***`：多行注释 \n\n## 2.2 标准化输出 \n\n```python\n#常规输出\nprint(\"标准化输出字符串\")\na = 10\n#字符连接变量\nprint(\"这是变量\", a)\n#变量占位\nprint(\"我的年纪是：%d 岁\"%a)\n#多变量占位\nprint(\"我的名字是%s，我的国籍是%s\"%(\"小张\",\"中国\"))\n#多个字符串，空格隔开\nprint(\"aaa\",\"bbb\",\"ccc\")\n#多个字符串，指定.隔开\nprint(\"www\",\"baidu\",\"com\",sep=\".\")\n#无字符串结尾\nprint(\"hello\",end=\"\")\n#以空格结尾\nprint(\"world\",end=\"\\t\")\n#以回车符结尾\nprint(\"python\",end=\"\\n\")\n```\n\n输出：\n\n> 标准化输出字符串\n> 这是变量 10\n> 我的年纪是：10 岁\n> 我的名字是小张，我的国籍是中国\n> aaa bbb ccc\n> www.baidu.com\n> helloworld      python\n\n占位符：\n\n![image-20200722151300301](https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png)\n\n## 2.3 标准化输入\n\n```python\npassword = input(\"请输入密码\")\nprint(\"您刚才输入的密码是\",password)\n#测试变量类型\nprint(type(password))\n```\n\n输出：\n\n> 请输入密码123\n> 您刚才输入的密码是 123\n> <class 'str'>\n\n**即使输入数字，input也是字符串**\n\n如果想要输入整型数。使用强制类型转换\n\n```python\na = int(\"123\")\nprint(type(a))\nprint(\"输出的是整型%d\"%a)\n```\n\n## 2.4 运算符\n\n![image-20200722153157538](https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png)\n\n![image-20200722153241400](https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png)\n\n![image-20200722153320987](https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png)\n\n# 3: 判断和循环语句\n\n## 3.1 判断语句：\n\n```python\nif conditino1:\n\tcodes\nelif condition2:\n\tcodes\nelse:\n\tcodes\n```\n\n:warning:**缩进**、**冒号**很重要\n\n## 3.2 随机生成数：\n\n```python\nimport random\n#随机生成[0,2]之间的整数，0、1、2\nx = random.randint(0,2) \n```\n\n## 3.3 导入模块和函数\n\n导入整个模块：`import module`\n\n从某个模块中导入某个函数：`from module import function`\n\n从某个模块导入多个函数：`from module import function1, function2`\n\n将某个模块的函数全部导入：`from module import *`\n\n## 3.4 循环\n\n### 3.4.1 for循环\n\n```python\n#[0,4]\nfor i in range(5):\n\tprint(i)\n\n#步长为3，[0,10]\nfor i in range(0,10,3):\n    print(i) \n\n#打印每个字符 \nname = \"chengdu\"\nfor x in name:\n    print(x,end=\"\\t\")\n\n#打印列表\na = [\"aa\",\"bb\",\"cc\"]\nfor i in range(len(a)):\n\tprint(i,a[i])\n```\n\n### 3.4.2 while循环\n\n```python\ni=0\nwhile i<5 :\n\tprint(i)\n\ti += 1\nelse:\n\tprint(\"while结束\")\n```\n\n### 3.4.3 break和continue\n\nbreak：结束所有循环；\n\ncontinue：结束本次循环，进入下次循环。\n\npass：占位，什么也不执行，但pass后的同级语句会执行，和空行没区别。\n\n# 4: 核心数据类型\n\n## 4.1 字符串\n\n可使用：单引号、双引号和三引号（三个单或双引号），使用反斜杠`\\`转义\n\n### 4.1.1 字符串作为数组\n\n```python\nstr = \"chengdu\"\nprint(str)\nprint(str[0])\nprint(str[5:])      #从索引5到最后\nprint(str[0:5:2])   #[起始位置:结束位置:步进值]\n```\n\n> chengdu\n>\n> c\n>\n> du\n>\n> ceg\n\n### 4.1.2 字符串连接\n\n```python\nprint(str+\",nihao\")   #chengdu,nihao\nprint(str*3)   #连续打印三次\nprint(\"hello\\nchengdu\")    #\\n转义为换行\nprint(r\"hello\\nchengdu\")     #转义字符不起作用，直接显示\n```\n\n### 4.1.3 字符串操作函数\n\n`bytes.decode`字符串解码\n\n`isalnum()`包含至少一个字母或数字 \n\n`isalpha()`至少一个且全为字母\n\n`isdigit()`至少一个且全为数字\n\n`join(seq)`指定字符串做分隔符，合并新的字符串\n\n`split()`拆分字符串\n\n`lstrip()`截掉字符串左边的空格或指定字符\n\n`rstrip()`截掉右边\n\n## 4.2 列表\n\n### 4.2.1 定义列表\n\n```python\nlist = []\nnamelist = [\"zhang\",\"wang\",3]   #列表中可以存储混合类型\n```\n\n### 4.2.2 打印\n\n```python\nprint(namelist[0])\nprint(namelist[1])\nprint(namelist[2])\n```\n\n### 4.2.3 遍历列表\n\nfor:\n\n```python\nfor name in namelist:\n\tprint(name)\nprint(len(namelist))   #len()获取列表长度\n```\n\nwhile:\n\n```python\ni = 0\nwhile i<len(namelist):\n\tprint(namelist[i])\n\ti++\n```\n\n### 4.2.4 列表操作函数\n\n`[ : : ]`列表切片\n\n`append`新增数据到列表尾部\n\n```python\nnamelist.append(\"qian\")\n\na=[1,2]\nb=[3,4]\na.append(b)\n#输出[1,2,[3,4]]   将列表作为一个元素加入到a中\n\na.extend(b)    #将b中的每个元素逐一追加到a中\n#输出[1,2,[3,4],3,4]\n```\n\n`insert`指定下标位置插入元素，\n\n```python\na = [0,1,2]\na.insert(1,3)\t#第一个表示索引下标，第二个表示插入的元素（对象）\n#输出[0,3,1,2]\n```\n\n`del list[index]` 在指定位置删除元素\n\n`list.pop()`弹出末尾最后一个元素\n\n`list.remove(\"钢铁侠\")`直接删除第一个指定内容的元素，还有的同名元素不会被删除。\n\n```python\nmovieName = [\"加勒比海盗\",\"复仇者\",\"钢铁侠\",\"蜘蛛侠\"]\ndel movieName[2]\t#删除钢铁侠\n```\n\n`in`某元素是否在列表中\n\n`not in`不在列表中\n\n```python\nname = \"wang\"\nif name in namelist:\n\tprint(\"找到名字wang\")\nelse:\n\tprint(\"没找到\")\n```\n\n`index`查找指定下标范围的元素，返回元素在列表中的索引下标，范围区间，左闭右开\n\n```python\na = [\"a\",\"b\",\"c\",\"d\",\"e\"]\na.index(\"c\",1,4)   #范围是[1,4)\n#输出2\n#如果没找到会报错\n```\n\n`count()`查找有多少个元素\n\n```python\na.count(\"c\")   \n#输出1\n```\n\n`reverse()`将列表元素从后向前反转\n\n```python\na = [1,4,2,3]\na.reverce()\n#输出[3,2,4,1]\n```\n\n`sort()`排序\n\n```python\na.sort()\n#输出[1,2,3,4]\na.sort(reverse=True)\n#输出[4,3,2,1]\n```\n\n## 4.3 元组\n\ntuple(元组):与list相似，但tuple元素不能修改。\n\n元组的元素不能改，但包含的对象可以修改。\n\n```python\ntup1 = ()\t#创建空元组，带引成tuple类型\ntup2 = (58)\t#会打印成整型\ntup3 = (58,)\t#打印成tuple类型\n```\n\n元组寻址：\n\n```python\ntup1 = (\"abc\",\"def\",1421)\nprint(tup1[0])\nprint(tup1[-1])\t#倒数第一个\n```\n\n元组不能修改：\n\n~~tup[0] = 1;~~\n\n元组增：\n\n```python\ntup1 = (12,34,56)\ntup2 = (\"abc\",xyz)\ntup3 = tup1 + tup2\n```\n\n元组删：\n\n```python\ndel tup\n```\n\n## 4.4 字典\n\n无序的对象集合，使用键值储存。\n\n```python\ninfo = {\"name\":\"吴彦祖\",\"age\":18}\nprint(info[\"name\"])\n```\n\n访问可能不存在的键：\n\n```python\nprint(info[\"gender\"])\n#报错\nprint(info.get(\"gender\"))\n#输出None\nprint(info,get(\"gender\",\"m\"))\n#没找到默认为m，找到时显示找到的值\n```\n\n字典增：\n\n```python\ninfo[\"id\"] = 12\n```\n\n字典删：\n\n```python\ndel info[\"name\"]\t#删除键值对。直接访问键会报错。\ninfo.clear\t#清空数组，打印：info = {}\n```\n\n字典改：\n\n```python\ninfo[\"name\"] = \"成龙\"\n```\n\n字典查：\n\n```python\ninfo.keys()\t\t#得到所有的键，列表形式\ninfo.values()\t#得到所有的值\ninfo.items()\t#得到所有的项\n\n#遍历\nfor key in info.keys():\n\tprint(key)\nfor values in info.values():\n    print(value)\nfor key,value in info.items():\n    print(\"key=$s,value=%s\"%(key,value))\n\nmylist = [\"a\",\"b\",\"c\"]\n#enumerate枚举类型对象\nfor i,x in enumerate(mylist):\n    print(i,x)\n```\n\n## 4.5 集合\n\n与字典相似，是key的集合，但是key不能重复。\n\nset可以用来去重。\n\n\n\n小结：\n\n![image-20200726090258027](https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png)\n\n# 5: 函数\n\n```python\ndef printInfo():\n    print(\"---------------------------\")\n    print(\"     人生苦短，我用python    \")\n    print(\"---------------------------\")\nprintInfo()\n```\n\n带参数的函数：\n\n```python\ndef add2Num(a,b):\n\tc = a + b\n    print(c)\nadd2Num(11,22)\n```\n\n带返回值的函数：\n\n```python\ndef add2Num(a,b):\n\treturn a+b\nresult = add2Num(1,2)\nprint(result)\n```\n\n返回多个值：\n\n```python\ndef divid(a,b):\n\tshang = a/b\n    yushu = a%b\n    return shang,yushu\nsh,yu = divid(5,2)\nprint(sh,yu)\n```\n\n> 函数类，局部变量优先于全局变量\n\n在函数中使用全局变量：\n\n```python\na = 100\ndef test1():\n\tglobal a\t#全局变量标识符\n    print(a)\n    a = 200\nprint(a)\n```\n\n# 6: 文件操作\n\n## 6.1 打开关闭\n\n```python\nf = open(\"test.txt\",\"w\")\t#打开文件，写模式，不存在文件时，在函数目录路径新建这个文件。\nf.close()\t#关闭文件\n```\n\n| 模式 | 描述                                                         |\n| :--- | :----------------------------------------------------------- |\n| t    | 文本模式 (默认)。                                            |\n| x    | 写模式，新建一个文件，如果该文件已存在则会报错。             |\n| b    | 二进制模式。                                                 |\n| +    | 打开一个文件进行更新(可读可写)。                             |\n| U    | 通用换行模式（不推荐）。                                     |\n| r    | 以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。 |\n| rb   | 以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。 |\n| r+   | 打开一个文件用于读写。文件指针将会放在文件的开头。           |\n| rb+  | 以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。 |\n| w    | 打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |\n| wb   | 以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |\n| w+   | 打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |\n| wb+  | 以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |\n| a    | 打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |\n| ab   | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |\n| a+   | 打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。 |\n| ab+  | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。 |\n\n## 6.2 读取字符\n\n读取全部行\n\n```python\nf = open(\"test.txt\",\"r\")\ncontent = f.read(5)\t#读五个字符，读取后，指针向后移到5的位置\ncontent1 = f.readlines()\t#将文档全部读取出来，按行作为一个元素放在列表里。\nf.close()\n```\n\n读取一行：\n\n```python\nf = open(\"test.txt\",\"r\")\ncontent1 = f.readline()\t#读取一行，指针后移\nf.close()\n```\n\n## 6.3 os库\n\n```\nimport os\nos.rename(\"test.txt\",\"abc.txt\")\n```\n\n\n\n# 7: 错误与异常\n\n```python\nf = open(\"123.txt\",\"r\")\t#如果没有这个文件，就会报错\n```\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept IOError:\t#文件没找到属于IO异常\n    pass\t#捕获异常后的处理\n```\n\n要捕获异常类型，才不会报错\n\n捕获多个异常：\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept (IOError,NameError):\t\n    pass\n```\n\n获取错误描述：\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept IOError as result:\n    print(result)\n```\n\n捕获所有异常：\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept Exception as result:\n    print(result)\t#捕获异常后的处理\n```\n\ntry finally:\n\n```python\ntry:\n\tf = open(\"123.txt\",\"r\")\nexcept Exception as result:\n\tprint(result)\nfinally:\n\tf.close()\n```\n\n","source":"_posts/Python基础.md","raw":"---\n\ntitle: Python基础\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-07-22 13:51:02\npassword:\nsummary: 在网络编程中，Python和爬虫是非常有用的辅助工具。许多网站后端需要用到的工具都基于Python编写，而许多数据的采集发布，也离不开Python，Python也是目前爬虫程序使用最多的机器语言。之前在学习机器学习，Python作为其不可或缺的学习部分，由于我的知识缺乏，使之变得特别困难。因此，我希望通过爬虫学习，重新系统地学习Python，同时巩固并亲手实践编写爬虫程序。本文是Python基础，爬虫的准备工作。\ntags: \n - Python\ncategories: 学习笔记\n---\n\n# 1: Hello World\n\nwindows `win`+`R`打开运行菜单，输入`CMD`，进入终端。输入`python`进入python终端程序。输入`print(\"hello,world\")`打印文字。\n\n`import this`打印python之禅\n\n结束命令提示符：\n\n`exit()`\n\n`ctrl`+`z`\n\n> 命令提示符中的每一行是相关联的。\n\n执行以`.py`结尾文件。\n\n命令提示符中输入`python hello.world.py`\n\n# 2: 基础\n\n## 2.1 注释\n\n`#注释`：单行注释\n\n`***注释***`：多行注释 \n\n## 2.2 标准化输出 \n\n```python\n#常规输出\nprint(\"标准化输出字符串\")\na = 10\n#字符连接变量\nprint(\"这是变量\", a)\n#变量占位\nprint(\"我的年纪是：%d 岁\"%a)\n#多变量占位\nprint(\"我的名字是%s，我的国籍是%s\"%(\"小张\",\"中国\"))\n#多个字符串，空格隔开\nprint(\"aaa\",\"bbb\",\"ccc\")\n#多个字符串，指定.隔开\nprint(\"www\",\"baidu\",\"com\",sep=\".\")\n#无字符串结尾\nprint(\"hello\",end=\"\")\n#以空格结尾\nprint(\"world\",end=\"\\t\")\n#以回车符结尾\nprint(\"python\",end=\"\\n\")\n```\n\n输出：\n\n> 标准化输出字符串\n> 这是变量 10\n> 我的年纪是：10 岁\n> 我的名字是小张，我的国籍是中国\n> aaa bbb ccc\n> www.baidu.com\n> helloworld      python\n\n占位符：\n\n![image-20200722151300301](https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png)\n\n## 2.3 标准化输入\n\n```python\npassword = input(\"请输入密码\")\nprint(\"您刚才输入的密码是\",password)\n#测试变量类型\nprint(type(password))\n```\n\n输出：\n\n> 请输入密码123\n> 您刚才输入的密码是 123\n> <class 'str'>\n\n**即使输入数字，input也是字符串**\n\n如果想要输入整型数。使用强制类型转换\n\n```python\na = int(\"123\")\nprint(type(a))\nprint(\"输出的是整型%d\"%a)\n```\n\n## 2.4 运算符\n\n![image-20200722153157538](https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png)\n\n![image-20200722153241400](https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png)\n\n![image-20200722153320987](https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png)\n\n# 3: 判断和循环语句\n\n## 3.1 判断语句：\n\n```python\nif conditino1:\n\tcodes\nelif condition2:\n\tcodes\nelse:\n\tcodes\n```\n\n:warning:**缩进**、**冒号**很重要\n\n## 3.2 随机生成数：\n\n```python\nimport random\n#随机生成[0,2]之间的整数，0、1、2\nx = random.randint(0,2) \n```\n\n## 3.3 导入模块和函数\n\n导入整个模块：`import module`\n\n从某个模块中导入某个函数：`from module import function`\n\n从某个模块导入多个函数：`from module import function1, function2`\n\n将某个模块的函数全部导入：`from module import *`\n\n## 3.4 循环\n\n### 3.4.1 for循环\n\n```python\n#[0,4]\nfor i in range(5):\n\tprint(i)\n\n#步长为3，[0,10]\nfor i in range(0,10,3):\n    print(i) \n\n#打印每个字符 \nname = \"chengdu\"\nfor x in name:\n    print(x,end=\"\\t\")\n\n#打印列表\na = [\"aa\",\"bb\",\"cc\"]\nfor i in range(len(a)):\n\tprint(i,a[i])\n```\n\n### 3.4.2 while循环\n\n```python\ni=0\nwhile i<5 :\n\tprint(i)\n\ti += 1\nelse:\n\tprint(\"while结束\")\n```\n\n### 3.4.3 break和continue\n\nbreak：结束所有循环；\n\ncontinue：结束本次循环，进入下次循环。\n\npass：占位，什么也不执行，但pass后的同级语句会执行，和空行没区别。\n\n# 4: 核心数据类型\n\n## 4.1 字符串\n\n可使用：单引号、双引号和三引号（三个单或双引号），使用反斜杠`\\`转义\n\n### 4.1.1 字符串作为数组\n\n```python\nstr = \"chengdu\"\nprint(str)\nprint(str[0])\nprint(str[5:])      #从索引5到最后\nprint(str[0:5:2])   #[起始位置:结束位置:步进值]\n```\n\n> chengdu\n>\n> c\n>\n> du\n>\n> ceg\n\n### 4.1.2 字符串连接\n\n```python\nprint(str+\",nihao\")   #chengdu,nihao\nprint(str*3)   #连续打印三次\nprint(\"hello\\nchengdu\")    #\\n转义为换行\nprint(r\"hello\\nchengdu\")     #转义字符不起作用，直接显示\n```\n\n### 4.1.3 字符串操作函数\n\n`bytes.decode`字符串解码\n\n`isalnum()`包含至少一个字母或数字 \n\n`isalpha()`至少一个且全为字母\n\n`isdigit()`至少一个且全为数字\n\n`join(seq)`指定字符串做分隔符，合并新的字符串\n\n`split()`拆分字符串\n\n`lstrip()`截掉字符串左边的空格或指定字符\n\n`rstrip()`截掉右边\n\n## 4.2 列表\n\n### 4.2.1 定义列表\n\n```python\nlist = []\nnamelist = [\"zhang\",\"wang\",3]   #列表中可以存储混合类型\n```\n\n### 4.2.2 打印\n\n```python\nprint(namelist[0])\nprint(namelist[1])\nprint(namelist[2])\n```\n\n### 4.2.3 遍历列表\n\nfor:\n\n```python\nfor name in namelist:\n\tprint(name)\nprint(len(namelist))   #len()获取列表长度\n```\n\nwhile:\n\n```python\ni = 0\nwhile i<len(namelist):\n\tprint(namelist[i])\n\ti++\n```\n\n### 4.2.4 列表操作函数\n\n`[ : : ]`列表切片\n\n`append`新增数据到列表尾部\n\n```python\nnamelist.append(\"qian\")\n\na=[1,2]\nb=[3,4]\na.append(b)\n#输出[1,2,[3,4]]   将列表作为一个元素加入到a中\n\na.extend(b)    #将b中的每个元素逐一追加到a中\n#输出[1,2,[3,4],3,4]\n```\n\n`insert`指定下标位置插入元素，\n\n```python\na = [0,1,2]\na.insert(1,3)\t#第一个表示索引下标，第二个表示插入的元素（对象）\n#输出[0,3,1,2]\n```\n\n`del list[index]` 在指定位置删除元素\n\n`list.pop()`弹出末尾最后一个元素\n\n`list.remove(\"钢铁侠\")`直接删除第一个指定内容的元素，还有的同名元素不会被删除。\n\n```python\nmovieName = [\"加勒比海盗\",\"复仇者\",\"钢铁侠\",\"蜘蛛侠\"]\ndel movieName[2]\t#删除钢铁侠\n```\n\n`in`某元素是否在列表中\n\n`not in`不在列表中\n\n```python\nname = \"wang\"\nif name in namelist:\n\tprint(\"找到名字wang\")\nelse:\n\tprint(\"没找到\")\n```\n\n`index`查找指定下标范围的元素，返回元素在列表中的索引下标，范围区间，左闭右开\n\n```python\na = [\"a\",\"b\",\"c\",\"d\",\"e\"]\na.index(\"c\",1,4)   #范围是[1,4)\n#输出2\n#如果没找到会报错\n```\n\n`count()`查找有多少个元素\n\n```python\na.count(\"c\")   \n#输出1\n```\n\n`reverse()`将列表元素从后向前反转\n\n```python\na = [1,4,2,3]\na.reverce()\n#输出[3,2,4,1]\n```\n\n`sort()`排序\n\n```python\na.sort()\n#输出[1,2,3,4]\na.sort(reverse=True)\n#输出[4,3,2,1]\n```\n\n## 4.3 元组\n\ntuple(元组):与list相似，但tuple元素不能修改。\n\n元组的元素不能改，但包含的对象可以修改。\n\n```python\ntup1 = ()\t#创建空元组，带引成tuple类型\ntup2 = (58)\t#会打印成整型\ntup3 = (58,)\t#打印成tuple类型\n```\n\n元组寻址：\n\n```python\ntup1 = (\"abc\",\"def\",1421)\nprint(tup1[0])\nprint(tup1[-1])\t#倒数第一个\n```\n\n元组不能修改：\n\n~~tup[0] = 1;~~\n\n元组增：\n\n```python\ntup1 = (12,34,56)\ntup2 = (\"abc\",xyz)\ntup3 = tup1 + tup2\n```\n\n元组删：\n\n```python\ndel tup\n```\n\n## 4.4 字典\n\n无序的对象集合，使用键值储存。\n\n```python\ninfo = {\"name\":\"吴彦祖\",\"age\":18}\nprint(info[\"name\"])\n```\n\n访问可能不存在的键：\n\n```python\nprint(info[\"gender\"])\n#报错\nprint(info.get(\"gender\"))\n#输出None\nprint(info,get(\"gender\",\"m\"))\n#没找到默认为m，找到时显示找到的值\n```\n\n字典增：\n\n```python\ninfo[\"id\"] = 12\n```\n\n字典删：\n\n```python\ndel info[\"name\"]\t#删除键值对。直接访问键会报错。\ninfo.clear\t#清空数组，打印：info = {}\n```\n\n字典改：\n\n```python\ninfo[\"name\"] = \"成龙\"\n```\n\n字典查：\n\n```python\ninfo.keys()\t\t#得到所有的键，列表形式\ninfo.values()\t#得到所有的值\ninfo.items()\t#得到所有的项\n\n#遍历\nfor key in info.keys():\n\tprint(key)\nfor values in info.values():\n    print(value)\nfor key,value in info.items():\n    print(\"key=$s,value=%s\"%(key,value))\n\nmylist = [\"a\",\"b\",\"c\"]\n#enumerate枚举类型对象\nfor i,x in enumerate(mylist):\n    print(i,x)\n```\n\n## 4.5 集合\n\n与字典相似，是key的集合，但是key不能重复。\n\nset可以用来去重。\n\n\n\n小结：\n\n![image-20200726090258027](https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png)\n\n# 5: 函数\n\n```python\ndef printInfo():\n    print(\"---------------------------\")\n    print(\"     人生苦短，我用python    \")\n    print(\"---------------------------\")\nprintInfo()\n```\n\n带参数的函数：\n\n```python\ndef add2Num(a,b):\n\tc = a + b\n    print(c)\nadd2Num(11,22)\n```\n\n带返回值的函数：\n\n```python\ndef add2Num(a,b):\n\treturn a+b\nresult = add2Num(1,2)\nprint(result)\n```\n\n返回多个值：\n\n```python\ndef divid(a,b):\n\tshang = a/b\n    yushu = a%b\n    return shang,yushu\nsh,yu = divid(5,2)\nprint(sh,yu)\n```\n\n> 函数类，局部变量优先于全局变量\n\n在函数中使用全局变量：\n\n```python\na = 100\ndef test1():\n\tglobal a\t#全局变量标识符\n    print(a)\n    a = 200\nprint(a)\n```\n\n# 6: 文件操作\n\n## 6.1 打开关闭\n\n```python\nf = open(\"test.txt\",\"w\")\t#打开文件，写模式，不存在文件时，在函数目录路径新建这个文件。\nf.close()\t#关闭文件\n```\n\n| 模式 | 描述                                                         |\n| :--- | :----------------------------------------------------------- |\n| t    | 文本模式 (默认)。                                            |\n| x    | 写模式，新建一个文件，如果该文件已存在则会报错。             |\n| b    | 二进制模式。                                                 |\n| +    | 打开一个文件进行更新(可读可写)。                             |\n| U    | 通用换行模式（不推荐）。                                     |\n| r    | 以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。 |\n| rb   | 以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。 |\n| r+   | 打开一个文件用于读写。文件指针将会放在文件的开头。           |\n| rb+  | 以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。 |\n| w    | 打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |\n| wb   | 以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |\n| w+   | 打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |\n| wb+  | 以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。 |\n| a    | 打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |\n| ab   | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |\n| a+   | 打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。 |\n| ab+  | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。 |\n\n## 6.2 读取字符\n\n读取全部行\n\n```python\nf = open(\"test.txt\",\"r\")\ncontent = f.read(5)\t#读五个字符，读取后，指针向后移到5的位置\ncontent1 = f.readlines()\t#将文档全部读取出来，按行作为一个元素放在列表里。\nf.close()\n```\n\n读取一行：\n\n```python\nf = open(\"test.txt\",\"r\")\ncontent1 = f.readline()\t#读取一行，指针后移\nf.close()\n```\n\n## 6.3 os库\n\n```\nimport os\nos.rename(\"test.txt\",\"abc.txt\")\n```\n\n\n\n# 7: 错误与异常\n\n```python\nf = open(\"123.txt\",\"r\")\t#如果没有这个文件，就会报错\n```\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept IOError:\t#文件没找到属于IO异常\n    pass\t#捕获异常后的处理\n```\n\n要捕获异常类型，才不会报错\n\n捕获多个异常：\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept (IOError,NameError):\t\n    pass\n```\n\n获取错误描述：\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept IOError as result:\n    print(result)\n```\n\n捕获所有异常：\n\n```python\ntry:\n\tprint(\"---1---\")\n\tf = open(\"123.txt\",\"r\")\n\tprint(\"---2---\")\nexcept Exception as result:\n    print(result)\t#捕获异常后的处理\n```\n\ntry finally:\n\n```python\ntry:\n\tf = open(\"123.txt\",\"r\")\nexcept Exception as result:\n\tprint(result)\nfinally:\n\tf.close()\n```\n\n","slug":"Python基础","published":1,"updated":"2020-07-26T08:53:55.359Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsab3000vp0vz7ak33wcc","content":"<h1 id=\"1-Hello-World\"><a href=\"#1-Hello-World\" class=\"headerlink\" title=\"1: Hello World\"></a>1: Hello World</h1><p>windows <code>win</code>+<code>R</code>打开运行菜单，输入<code>CMD</code>，进入终端。输入<code>python</code>进入python终端程序。输入<code>print(&quot;hello,world&quot;)</code>打印文字。</p>\n<p><code>import this</code>打印python之禅</p>\n<p>结束命令提示符：</p>\n<p><code>exit()</code></p>\n<p><code>ctrl</code>+<code>z</code></p>\n<blockquote>\n<p>命令提示符中的每一行是相关联的。</p>\n</blockquote>\n<p>执行以<code>.py</code>结尾文件。</p>\n<p>命令提示符中输入<code>python hello.world.py</code></p>\n<h1 id=\"2-基础\"><a href=\"#2-基础\" class=\"headerlink\" title=\"2: 基础\"></a>2: 基础</h1><h2 id=\"2-1-注释\"><a href=\"#2-1-注释\" class=\"headerlink\" title=\"2.1 注释\"></a>2.1 注释</h2><p><code>#注释</code>：单行注释</p>\n<p><code>***注释***</code>：多行注释 </p>\n<h2 id=\"2-2-标准化输出\"><a href=\"#2-2-标准化输出\" class=\"headerlink\" title=\"2.2 标准化输出\"></a>2.2 标准化输出</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#常规输出</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;标准化输出字符串&quot;</span>)</span><br><span class=\"line\">a = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"comment\">#字符连接变量</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;这是变量&quot;</span>, a)</span><br><span class=\"line\"><span class=\"comment\">#变量占位</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;我的年纪是：%d 岁&quot;</span>%a)</span><br><span class=\"line\"><span class=\"comment\">#多变量占位</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;我的名字是%s，我的国籍是%s&quot;</span>%(<span class=\"string\">&quot;小张&quot;</span>,<span class=\"string\">&quot;中国&quot;</span>))</span><br><span class=\"line\"><span class=\"comment\">#多个字符串，空格隔开</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;aaa&quot;</span>,<span class=\"string\">&quot;bbb&quot;</span>,<span class=\"string\">&quot;ccc&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#多个字符串，指定.隔开</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;www&quot;</span>,<span class=\"string\">&quot;baidu&quot;</span>,<span class=\"string\">&quot;com&quot;</span>,sep=<span class=\"string\">&quot;.&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#无字符串结尾</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;hello&quot;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#以空格结尾</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;world&quot;</span>,end=<span class=\"string\">&quot;\\t&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#以回车符结尾</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;python&quot;</span>,end=<span class=\"string\">&quot;\\n&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<blockquote>\n<p>标准化输出字符串<br>这是变量 10<br>我的年纪是：10 岁<br>我的名字是小张，我的国籍是中国<br>aaa bbb ccc<br><a href=\"http://www.baidu.com/\">www.baidu.com</a><br>helloworld      python</p>\n</blockquote>\n<p>占位符：</p>\n<p><img src=\"https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200722151300301\"></p>\n<h2 id=\"2-3-标准化输入\"><a href=\"#2-3-标准化输入\" class=\"headerlink\" title=\"2.3 标准化输入\"></a>2.3 标准化输入</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">password = input(<span class=\"string\">&quot;请输入密码&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;您刚才输入的密码是&quot;</span>,password)</span><br><span class=\"line\"><span class=\"comment\">#测试变量类型</span></span><br><span class=\"line\">print(type(password))</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<blockquote>\n<p>请输入密码123<br>您刚才输入的密码是 123<br>&lt;class ‘str’&gt;</p>\n</blockquote>\n<p><strong>即使输入数字，input也是字符串</strong></p>\n<p>如果想要输入整型数。使用强制类型转换</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = int(<span class=\"string\">&quot;123&quot;</span>)</span><br><span class=\"line\">print(type(a))</span><br><span class=\"line\">print(<span class=\"string\">&quot;输出的是整型%d&quot;</span>%a)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-运算符\"><a href=\"#2-4-运算符\" class=\"headerlink\" title=\"2.4 运算符\"></a>2.4 运算符</h2><p><img src=\"https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200722153157538\"></p>\n<p><img src=\"https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200722153241400\"></p>\n<p><img src=\"https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200722153320987\"></p>\n<h1 id=\"3-判断和循环语句\"><a href=\"#3-判断和循环语句\" class=\"headerlink\" title=\"3: 判断和循环语句\"></a>3: 判断和循环语句</h1><h2 id=\"3-1-判断语句：\"><a href=\"#3-1-判断语句：\" class=\"headerlink\" title=\"3.1 判断语句：\"></a>3.1 判断语句：</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> conditino1:</span><br><span class=\"line\">\tcodes</span><br><span class=\"line\"><span class=\"keyword\">elif</span> condition2:</span><br><span class=\"line\">\tcodes</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">\tcodes</span><br></pre></td></tr></table></figure>\n\n<p>:warning:<strong>缩进</strong>、<strong>冒号</strong>很重要</p>\n<h2 id=\"3-2-随机生成数：\"><a href=\"#3-2-随机生成数：\" class=\"headerlink\" title=\"3.2 随机生成数：\"></a>3.2 随机生成数：</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"comment\">#随机生成[0,2]之间的整数，0、1、2</span></span><br><span class=\"line\">x = random.randint(<span class=\"number\">0</span>,<span class=\"number\">2</span>) </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-导入模块和函数\"><a href=\"#3-3-导入模块和函数\" class=\"headerlink\" title=\"3.3 导入模块和函数\"></a>3.3 导入模块和函数</h2><p>导入整个模块：<code>import module</code></p>\n<p>从某个模块中导入某个函数：<code>from module import function</code></p>\n<p>从某个模块导入多个函数：<code>from module import function1, function2</code></p>\n<p>将某个模块的函数全部导入：<code>from module import *</code></p>\n<h2 id=\"3-4-循环\"><a href=\"#3-4-循环\" class=\"headerlink\" title=\"3.4 循环\"></a>3.4 循环</h2><h3 id=\"3-4-1-for循环\"><a href=\"#3-4-1-for循环\" class=\"headerlink\" title=\"3.4.1 for循环\"></a>3.4.1 for循环</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#[0,4]</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">5</span>):</span><br><span class=\"line\">\tprint(i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#步长为3，[0,10]</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,<span class=\"number\">10</span>,<span class=\"number\">3</span>):</span><br><span class=\"line\">    print(i) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#打印每个字符 </span></span><br><span class=\"line\">name = <span class=\"string\">&quot;chengdu&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> name:</span><br><span class=\"line\">    print(x,end=<span class=\"string\">&quot;\\t&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#打印列表</span></span><br><span class=\"line\">a = [<span class=\"string\">&quot;aa&quot;</span>,<span class=\"string\">&quot;bb&quot;</span>,<span class=\"string\">&quot;cc&quot;</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(a)):</span><br><span class=\"line\">\tprint(i,a[i])</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-2-while循环\"><a href=\"#3-4-2-while循环\" class=\"headerlink\" title=\"3.4.2 while循环\"></a>3.4.2 while循环</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;<span class=\"number\">5</span> :</span><br><span class=\"line\">\tprint(i)</span><br><span class=\"line\">\ti += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;while结束&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-3-break和continue\"><a href=\"#3-4-3-break和continue\" class=\"headerlink\" title=\"3.4.3 break和continue\"></a>3.4.3 break和continue</h3><p>break：结束所有循环；</p>\n<p>continue：结束本次循环，进入下次循环。</p>\n<p>pass：占位，什么也不执行，但pass后的同级语句会执行，和空行没区别。</p>\n<h1 id=\"4-核心数据类型\"><a href=\"#4-核心数据类型\" class=\"headerlink\" title=\"4: 核心数据类型\"></a>4: 核心数据类型</h1><h2 id=\"4-1-字符串\"><a href=\"#4-1-字符串\" class=\"headerlink\" title=\"4.1 字符串\"></a>4.1 字符串</h2><p>可使用：单引号、双引号和三引号（三个单或双引号），使用反斜杠<code>\\</code>转义</p>\n<h3 id=\"4-1-1-字符串作为数组\"><a href=\"#4-1-1-字符串作为数组\" class=\"headerlink\" title=\"4.1.1 字符串作为数组\"></a>4.1.1 字符串作为数组</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">&quot;chengdu&quot;</span></span><br><span class=\"line\">print(str)</span><br><span class=\"line\">print(str[<span class=\"number\">0</span>])</span><br><span class=\"line\">print(str[<span class=\"number\">5</span>:])      <span class=\"comment\">#从索引5到最后</span></span><br><span class=\"line\">print(str[<span class=\"number\">0</span>:<span class=\"number\">5</span>:<span class=\"number\">2</span>])   <span class=\"comment\">#[起始位置:结束位置:步进值]</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>chengdu</p>\n<p>c</p>\n<p>du</p>\n<p>ceg</p>\n</blockquote>\n<h3 id=\"4-1-2-字符串连接\"><a href=\"#4-1-2-字符串连接\" class=\"headerlink\" title=\"4.1.2 字符串连接\"></a>4.1.2 字符串连接</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(str+<span class=\"string\">&quot;,nihao&quot;</span>)   <span class=\"comment\">#chengdu,nihao</span></span><br><span class=\"line\">print(str*<span class=\"number\">3</span>)   <span class=\"comment\">#连续打印三次</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;hello\\nchengdu&quot;</span>)    <span class=\"comment\">#\\n转义为换行</span></span><br><span class=\"line\">print(<span class=\"string\">r&quot;hello\\nchengdu&quot;</span>)     <span class=\"comment\">#转义字符不起作用，直接显示</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-1-3-字符串操作函数\"><a href=\"#4-1-3-字符串操作函数\" class=\"headerlink\" title=\"4.1.3 字符串操作函数\"></a>4.1.3 字符串操作函数</h3><p><code>bytes.decode</code>字符串解码</p>\n<p><code>isalnum()</code>包含至少一个字母或数字 </p>\n<p><code>isalpha()</code>至少一个且全为字母</p>\n<p><code>isdigit()</code>至少一个且全为数字</p>\n<p><code>join(seq)</code>指定字符串做分隔符，合并新的字符串</p>\n<p><code>split()</code>拆分字符串</p>\n<p><code>lstrip()</code>截掉字符串左边的空格或指定字符</p>\n<p><code>rstrip()</code>截掉右边</p>\n<h2 id=\"4-2-列表\"><a href=\"#4-2-列表\" class=\"headerlink\" title=\"4.2 列表\"></a>4.2 列表</h2><h3 id=\"4-2-1-定义列表\"><a href=\"#4-2-1-定义列表\" class=\"headerlink\" title=\"4.2.1 定义列表\"></a>4.2.1 定义列表</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list = []</span><br><span class=\"line\">namelist = [<span class=\"string\">&quot;zhang&quot;</span>,<span class=\"string\">&quot;wang&quot;</span>,<span class=\"number\">3</span>]   <span class=\"comment\">#列表中可以存储混合类型</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-2-打印\"><a href=\"#4-2-2-打印\" class=\"headerlink\" title=\"4.2.2 打印\"></a>4.2.2 打印</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(namelist[<span class=\"number\">0</span>])</span><br><span class=\"line\">print(namelist[<span class=\"number\">1</span>])</span><br><span class=\"line\">print(namelist[<span class=\"number\">2</span>])</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-3-遍历列表\"><a href=\"#4-2-3-遍历列表\" class=\"headerlink\" title=\"4.2.3 遍历列表\"></a>4.2.3 遍历列表</h3><p>for:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> namelist:</span><br><span class=\"line\">\tprint(name)</span><br><span class=\"line\">print(len(namelist))   <span class=\"comment\">#len()获取列表长度</span></span><br></pre></td></tr></table></figure>\n\n<p>while:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;len(namelist):</span><br><span class=\"line\">\tprint(namelist[i])</span><br><span class=\"line\">\ti++</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-4-列表操作函数\"><a href=\"#4-2-4-列表操作函数\" class=\"headerlink\" title=\"4.2.4 列表操作函数\"></a>4.2.4 列表操作函数</h3><p><code>[ : : ]</code>列表切片</p>\n<p><code>append</code>新增数据到列表尾部</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">namelist.append(<span class=\"string\">&quot;qian&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">a=[<span class=\"number\">1</span>,<span class=\"number\">2</span>]</span><br><span class=\"line\">b=[<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br><span class=\"line\">a.append(b)</span><br><span class=\"line\"><span class=\"comment\">#输出[1,2,[3,4]]   将列表作为一个元素加入到a中</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.extend(b)    <span class=\"comment\">#将b中的每个元素逐一追加到a中</span></span><br><span class=\"line\"><span class=\"comment\">#输出[1,2,[3,4],3,4]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>insert</code>指定下标位置插入元素，</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>]</span><br><span class=\"line\">a.insert(<span class=\"number\">1</span>,<span class=\"number\">3</span>)\t<span class=\"comment\">#第一个表示索引下标，第二个表示插入的元素（对象）</span></span><br><span class=\"line\"><span class=\"comment\">#输出[0,3,1,2]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>del list[index]</code> 在指定位置删除元素</p>\n<p><code>list.pop()</code>弹出末尾最后一个元素</p>\n<p><code>list.remove(&quot;钢铁侠&quot;)</code>直接删除第一个指定内容的元素，还有的同名元素不会被删除。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movieName = [<span class=\"string\">&quot;加勒比海盗&quot;</span>,<span class=\"string\">&quot;复仇者&quot;</span>,<span class=\"string\">&quot;钢铁侠&quot;</span>,<span class=\"string\">&quot;蜘蛛侠&quot;</span>]</span><br><span class=\"line\"><span class=\"keyword\">del</span> movieName[<span class=\"number\">2</span>]\t<span class=\"comment\">#删除钢铁侠</span></span><br></pre></td></tr></table></figure>\n\n<p><code>in</code>某元素是否在列表中</p>\n<p><code>not in</code>不在列表中</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = <span class=\"string\">&quot;wang&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> name <span class=\"keyword\">in</span> namelist:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;找到名字wang&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;没找到&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>index</code>查找指定下标范围的元素，返回元素在列表中的索引下标，范围区间，左闭右开</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"string\">&quot;a&quot;</span>,<span class=\"string\">&quot;b&quot;</span>,<span class=\"string\">&quot;c&quot;</span>,<span class=\"string\">&quot;d&quot;</span>,<span class=\"string\">&quot;e&quot;</span>]</span><br><span class=\"line\">a.index(<span class=\"string\">&quot;c&quot;</span>,<span class=\"number\">1</span>,<span class=\"number\">4</span>)   <span class=\"comment\">#范围是[1,4)</span></span><br><span class=\"line\"><span class=\"comment\">#输出2</span></span><br><span class=\"line\"><span class=\"comment\">#如果没找到会报错</span></span><br></pre></td></tr></table></figure>\n\n<p><code>count()</code>查找有多少个元素</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a.count(<span class=\"string\">&quot;c&quot;</span>)   </span><br><span class=\"line\"><span class=\"comment\">#输出1</span></span><br></pre></td></tr></table></figure>\n\n<p><code>reverse()</code>将列表元素从后向前反转</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>,<span class=\"number\">4</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\">a.reverce()</span><br><span class=\"line\"><span class=\"comment\">#输出[3,2,4,1]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>sort()</code>排序</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a.sort()</span><br><span class=\"line\"><span class=\"comment\">#输出[1,2,3,4]</span></span><br><span class=\"line\">a.sort(reverse=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"comment\">#输出[4,3,2,1]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-元组\"><a href=\"#4-3-元组\" class=\"headerlink\" title=\"4.3 元组\"></a>4.3 元组</h2><p>tuple(元组):与list相似，但tuple元素不能修改。</p>\n<p>元组的元素不能改，但包含的对象可以修改。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tup1 = ()\t<span class=\"comment\">#创建空元组，带引成tuple类型</span></span><br><span class=\"line\">tup2 = (<span class=\"number\">58</span>)\t<span class=\"comment\">#会打印成整型</span></span><br><span class=\"line\">tup3 = (<span class=\"number\">58</span>,)\t<span class=\"comment\">#打印成tuple类型</span></span><br></pre></td></tr></table></figure>\n\n<p>元组寻址：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tup1 = (<span class=\"string\">&quot;abc&quot;</span>,<span class=\"string\">&quot;def&quot;</span>,<span class=\"number\">1421</span>)</span><br><span class=\"line\">print(tup1[<span class=\"number\">0</span>])</span><br><span class=\"line\">print(tup1[<span class=\"number\">-1</span>])\t<span class=\"comment\">#倒数第一个</span></span><br></pre></td></tr></table></figure>\n\n<p>元组不能修改：</p>\n<p><del>tup[0] = 1;</del></p>\n<p>元组增：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tup1 = (<span class=\"number\">12</span>,<span class=\"number\">34</span>,<span class=\"number\">56</span>)</span><br><span class=\"line\">tup2 = (<span class=\"string\">&quot;abc&quot;</span>,xyz)</span><br><span class=\"line\">tup3 = tup1 + tup2</span><br></pre></td></tr></table></figure>\n\n<p>元组删：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">del</span> tup</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-字典\"><a href=\"#4-4-字典\" class=\"headerlink\" title=\"4.4 字典\"></a>4.4 字典</h2><p>无序的对象集合，使用键值储存。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info = &#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;吴彦祖&quot;</span>,<span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">18</span>&#125;</span><br><span class=\"line\">print(info[<span class=\"string\">&quot;name&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<p>访问可能不存在的键：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(info[<span class=\"string\">&quot;gender&quot;</span>])</span><br><span class=\"line\"><span class=\"comment\">#报错</span></span><br><span class=\"line\">print(info.get(<span class=\"string\">&quot;gender&quot;</span>))</span><br><span class=\"line\"><span class=\"comment\">#输出None</span></span><br><span class=\"line\">print(info,get(<span class=\"string\">&quot;gender&quot;</span>,<span class=\"string\">&quot;m&quot;</span>))</span><br><span class=\"line\"><span class=\"comment\">#没找到默认为m，找到时显示找到的值</span></span><br></pre></td></tr></table></figure>\n\n<p>字典增：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info[<span class=\"string\">&quot;id&quot;</span>] = <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n\n<p>字典删：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">del</span> info[<span class=\"string\">&quot;name&quot;</span>]\t<span class=\"comment\">#删除键值对。直接访问键会报错。</span></span><br><span class=\"line\">info.clear\t<span class=\"comment\">#清空数组，打印：info = &#123;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>字典改：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info[<span class=\"string\">&quot;name&quot;</span>] = <span class=\"string\">&quot;成龙&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>字典查：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info.keys()\t\t<span class=\"comment\">#得到所有的键，列表形式</span></span><br><span class=\"line\">info.values()\t<span class=\"comment\">#得到所有的值</span></span><br><span class=\"line\">info.items()\t<span class=\"comment\">#得到所有的项</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#遍历</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> info.keys():</span><br><span class=\"line\">\tprint(key)</span><br><span class=\"line\"><span class=\"keyword\">for</span> values <span class=\"keyword\">in</span> info.values():</span><br><span class=\"line\">    print(value)</span><br><span class=\"line\"><span class=\"keyword\">for</span> key,value <span class=\"keyword\">in</span> info.items():</span><br><span class=\"line\">    print(<span class=\"string\">&quot;key=$s,value=%s&quot;</span>%(key,value))</span><br><span class=\"line\"></span><br><span class=\"line\">mylist = [<span class=\"string\">&quot;a&quot;</span>,<span class=\"string\">&quot;b&quot;</span>,<span class=\"string\">&quot;c&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\">#enumerate枚举类型对象</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i,x <span class=\"keyword\">in</span> enumerate(mylist):</span><br><span class=\"line\">    print(i,x)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-5-集合\"><a href=\"#4-5-集合\" class=\"headerlink\" title=\"4.5 集合\"></a>4.5 集合</h2><p>与字典相似，是key的集合，但是key不能重复。</p>\n<p>set可以用来去重。</p>\n<p>小结：</p>\n<p><img src=\"https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200726090258027\"></p>\n<h1 id=\"5-函数\"><a href=\"#5-函数\" class=\"headerlink\" title=\"5: 函数\"></a>5: 函数</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">printInfo</span>():</span></span><br><span class=\"line\">    print(<span class=\"string\">&quot;---------------------------&quot;</span>)</span><br><span class=\"line\">    print(<span class=\"string\">&quot;     人生苦短，我用python    &quot;</span>)</span><br><span class=\"line\">    print(<span class=\"string\">&quot;---------------------------&quot;</span>)</span><br><span class=\"line\">printInfo()</span><br></pre></td></tr></table></figure>\n\n<p>带参数的函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add2Num</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\tc = a + b</span><br><span class=\"line\">    print(c)</span><br><span class=\"line\">add2Num(<span class=\"number\">11</span>,<span class=\"number\">22</span>)</span><br></pre></td></tr></table></figure>\n\n<p>带返回值的函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add2Num</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">result = add2Num(<span class=\"number\">1</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">print(result)</span><br></pre></td></tr></table></figure>\n\n<p>返回多个值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">divid</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\tshang = a/b</span><br><span class=\"line\">    yushu = a%b</span><br><span class=\"line\">    <span class=\"keyword\">return</span> shang,yushu</span><br><span class=\"line\">sh,yu = divid(<span class=\"number\">5</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">print(sh,yu)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>函数类，局部变量优先于全局变量</p>\n</blockquote>\n<p>在函数中使用全局变量：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test1</span>():</span></span><br><span class=\"line\">\t<span class=\"keyword\">global</span> a\t<span class=\"comment\">#全局变量标识符</span></span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    a = <span class=\"number\">200</span></span><br><span class=\"line\">print(a)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6-文件操作\"><a href=\"#6-文件操作\" class=\"headerlink\" title=\"6: 文件操作\"></a>6: 文件操作</h1><h2 id=\"6-1-打开关闭\"><a href=\"#6-1-打开关闭\" class=\"headerlink\" title=\"6.1 打开关闭\"></a>6.1 打开关闭</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;test.txt&quot;</span>,<span class=\"string\">&quot;w&quot;</span>)\t<span class=\"comment\">#打开文件，写模式，不存在文件时，在函数目录路径新建这个文件。</span></span><br><span class=\"line\">f.close()\t<span class=\"comment\">#关闭文件</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">模式</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">t</td>\n<td align=\"left\">文本模式 (默认)。</td>\n</tr>\n<tr>\n<td align=\"left\">x</td>\n<td align=\"left\">写模式，新建一个文件，如果该文件已存在则会报错。</td>\n</tr>\n<tr>\n<td align=\"left\">b</td>\n<td align=\"left\">二进制模式。</td>\n</tr>\n<tr>\n<td align=\"left\">+</td>\n<td align=\"left\">打开一个文件进行更新(可读可写)。</td>\n</tr>\n<tr>\n<td align=\"left\">U</td>\n<td align=\"left\">通用换行模式（不推荐）。</td>\n</tr>\n<tr>\n<td align=\"left\">r</td>\n<td align=\"left\">以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</td>\n</tr>\n<tr>\n<td align=\"left\">rb</td>\n<td align=\"left\">以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">r+</td>\n<td align=\"left\">打开一个文件用于读写。文件指针将会放在文件的开头。</td>\n</tr>\n<tr>\n<td align=\"left\">rb+</td>\n<td align=\"left\">以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">w</td>\n<td align=\"left\">打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>\n</tr>\n<tr>\n<td align=\"left\">wb</td>\n<td align=\"left\">以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">w+</td>\n<td align=\"left\">打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>\n</tr>\n<tr>\n<td align=\"left\">wb+</td>\n<td align=\"left\">以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">a</td>\n<td align=\"left\">打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>\n</tr>\n<tr>\n<td align=\"left\">ab</td>\n<td align=\"left\">以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>\n</tr>\n<tr>\n<td align=\"left\">a+</td>\n<td align=\"left\">打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。</td>\n</tr>\n<tr>\n<td align=\"left\">ab+</td>\n<td align=\"left\">以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。</td>\n</tr>\n</tbody></table>\n<h2 id=\"6-2-读取字符\"><a href=\"#6-2-读取字符\" class=\"headerlink\" title=\"6.2 读取字符\"></a>6.2 读取字符</h2><p>读取全部行</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;test.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">content = f.read(<span class=\"number\">5</span>)\t<span class=\"comment\">#读五个字符，读取后，指针向后移到5的位置</span></span><br><span class=\"line\">content1 = f.readlines()\t<span class=\"comment\">#将文档全部读取出来，按行作为一个元素放在列表里。</span></span><br><span class=\"line\">f.close()</span><br></pre></td></tr></table></figure>\n\n<p>读取一行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;test.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">content1 = f.readline()\t<span class=\"comment\">#读取一行，指针后移</span></span><br><span class=\"line\">f.close()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-3-os库\"><a href=\"#6-3-os库\" class=\"headerlink\" title=\"6.3 os库\"></a>6.3 os库</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import os</span><br><span class=\"line\">os.rename(&quot;test.txt&quot;,&quot;abc.txt&quot;)</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"7-错误与异常\"><a href=\"#7-错误与异常\" class=\"headerlink\" title=\"7: 错误与异常\"></a>7: 错误与异常</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)\t<span class=\"comment\">#如果没有这个文件，就会报错</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> IOError:\t<span class=\"comment\">#文件没找到属于IO异常</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span>\t<span class=\"comment\">#捕获异常后的处理</span></span><br></pre></td></tr></table></figure>\n\n<p>要捕获异常类型，才不会报错</p>\n<p>捕获多个异常：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> (IOError,NameError):\t</span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<p>获取错误描述：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> IOError <span class=\"keyword\">as</span> result:</span><br><span class=\"line\">    print(result)</span><br></pre></td></tr></table></figure>\n\n<p>捕获所有异常：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> result:</span><br><span class=\"line\">    print(result)\t<span class=\"comment\">#捕获异常后的处理</span></span><br></pre></td></tr></table></figure>\n\n<p>try finally:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> result:</span><br><span class=\"line\">\tprint(result)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\tf.close()</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1-Hello-World\"><a href=\"#1-Hello-World\" class=\"headerlink\" title=\"1: Hello World\"></a>1: Hello World</h1><p>windows <code>win</code>+<code>R</code>打开运行菜单，输入<code>CMD</code>，进入终端。输入<code>python</code>进入python终端程序。输入<code>print(&quot;hello,world&quot;)</code>打印文字。</p>\n<p><code>import this</code>打印python之禅</p>\n<p>结束命令提示符：</p>\n<p><code>exit()</code></p>\n<p><code>ctrl</code>+<code>z</code></p>\n<blockquote>\n<p>命令提示符中的每一行是相关联的。</p>\n</blockquote>\n<p>执行以<code>.py</code>结尾文件。</p>\n<p>命令提示符中输入<code>python hello.world.py</code></p>\n<h1 id=\"2-基础\"><a href=\"#2-基础\" class=\"headerlink\" title=\"2: 基础\"></a>2: 基础</h1><h2 id=\"2-1-注释\"><a href=\"#2-1-注释\" class=\"headerlink\" title=\"2.1 注释\"></a>2.1 注释</h2><p><code>#注释</code>：单行注释</p>\n<p><code>***注释***</code>：多行注释 </p>\n<h2 id=\"2-2-标准化输出\"><a href=\"#2-2-标准化输出\" class=\"headerlink\" title=\"2.2 标准化输出\"></a>2.2 标准化输出</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#常规输出</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;标准化输出字符串&quot;</span>)</span><br><span class=\"line\">a = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"comment\">#字符连接变量</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;这是变量&quot;</span>, a)</span><br><span class=\"line\"><span class=\"comment\">#变量占位</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;我的年纪是：%d 岁&quot;</span>%a)</span><br><span class=\"line\"><span class=\"comment\">#多变量占位</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;我的名字是%s，我的国籍是%s&quot;</span>%(<span class=\"string\">&quot;小张&quot;</span>,<span class=\"string\">&quot;中国&quot;</span>))</span><br><span class=\"line\"><span class=\"comment\">#多个字符串，空格隔开</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;aaa&quot;</span>,<span class=\"string\">&quot;bbb&quot;</span>,<span class=\"string\">&quot;ccc&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#多个字符串，指定.隔开</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;www&quot;</span>,<span class=\"string\">&quot;baidu&quot;</span>,<span class=\"string\">&quot;com&quot;</span>,sep=<span class=\"string\">&quot;.&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#无字符串结尾</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;hello&quot;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#以空格结尾</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;world&quot;</span>,end=<span class=\"string\">&quot;\\t&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#以回车符结尾</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;python&quot;</span>,end=<span class=\"string\">&quot;\\n&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<blockquote>\n<p>标准化输出字符串<br>这是变量 10<br>我的年纪是：10 岁<br>我的名字是小张，我的国籍是中国<br>aaa bbb ccc<br><a href=\"http://www.baidu.com/\">www.baidu.com</a><br>helloworld      python</p>\n</blockquote>\n<p>占位符：</p>\n<p><img src=\"https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png\" alt=\"image-20200722151300301\"></p>\n<h2 id=\"2-3-标准化输入\"><a href=\"#2-3-标准化输入\" class=\"headerlink\" title=\"2.3 标准化输入\"></a>2.3 标准化输入</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">password = input(<span class=\"string\">&quot;请输入密码&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;您刚才输入的密码是&quot;</span>,password)</span><br><span class=\"line\"><span class=\"comment\">#测试变量类型</span></span><br><span class=\"line\">print(type(password))</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<blockquote>\n<p>请输入密码123<br>您刚才输入的密码是 123<br>&lt;class ‘str’&gt;</p>\n</blockquote>\n<p><strong>即使输入数字，input也是字符串</strong></p>\n<p>如果想要输入整型数。使用强制类型转换</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = int(<span class=\"string\">&quot;123&quot;</span>)</span><br><span class=\"line\">print(type(a))</span><br><span class=\"line\">print(<span class=\"string\">&quot;输出的是整型%d&quot;</span>%a)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-运算符\"><a href=\"#2-4-运算符\" class=\"headerlink\" title=\"2.4 运算符\"></a>2.4 运算符</h2><p><img src=\"https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png\" alt=\"image-20200722153157538\"></p>\n<p><img src=\"https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png\" alt=\"image-20200722153241400\"></p>\n<p><img src=\"https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png\" alt=\"image-20200722153320987\"></p>\n<h1 id=\"3-判断和循环语句\"><a href=\"#3-判断和循环语句\" class=\"headerlink\" title=\"3: 判断和循环语句\"></a>3: 判断和循环语句</h1><h2 id=\"3-1-判断语句：\"><a href=\"#3-1-判断语句：\" class=\"headerlink\" title=\"3.1 判断语句：\"></a>3.1 判断语句：</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> conditino1:</span><br><span class=\"line\">\tcodes</span><br><span class=\"line\"><span class=\"keyword\">elif</span> condition2:</span><br><span class=\"line\">\tcodes</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">\tcodes</span><br></pre></td></tr></table></figure>\n\n<p>:warning:<strong>缩进</strong>、<strong>冒号</strong>很重要</p>\n<h2 id=\"3-2-随机生成数：\"><a href=\"#3-2-随机生成数：\" class=\"headerlink\" title=\"3.2 随机生成数：\"></a>3.2 随机生成数：</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"comment\">#随机生成[0,2]之间的整数，0、1、2</span></span><br><span class=\"line\">x = random.randint(<span class=\"number\">0</span>,<span class=\"number\">2</span>) </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-导入模块和函数\"><a href=\"#3-3-导入模块和函数\" class=\"headerlink\" title=\"3.3 导入模块和函数\"></a>3.3 导入模块和函数</h2><p>导入整个模块：<code>import module</code></p>\n<p>从某个模块中导入某个函数：<code>from module import function</code></p>\n<p>从某个模块导入多个函数：<code>from module import function1, function2</code></p>\n<p>将某个模块的函数全部导入：<code>from module import *</code></p>\n<h2 id=\"3-4-循环\"><a href=\"#3-4-循环\" class=\"headerlink\" title=\"3.4 循环\"></a>3.4 循环</h2><h3 id=\"3-4-1-for循环\"><a href=\"#3-4-1-for循环\" class=\"headerlink\" title=\"3.4.1 for循环\"></a>3.4.1 for循环</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#[0,4]</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">5</span>):</span><br><span class=\"line\">\tprint(i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#步长为3，[0,10]</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,<span class=\"number\">10</span>,<span class=\"number\">3</span>):</span><br><span class=\"line\">    print(i) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#打印每个字符 </span></span><br><span class=\"line\">name = <span class=\"string\">&quot;chengdu&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> name:</span><br><span class=\"line\">    print(x,end=<span class=\"string\">&quot;\\t&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#打印列表</span></span><br><span class=\"line\">a = [<span class=\"string\">&quot;aa&quot;</span>,<span class=\"string\">&quot;bb&quot;</span>,<span class=\"string\">&quot;cc&quot;</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(a)):</span><br><span class=\"line\">\tprint(i,a[i])</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-2-while循环\"><a href=\"#3-4-2-while循环\" class=\"headerlink\" title=\"3.4.2 while循环\"></a>3.4.2 while循环</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;<span class=\"number\">5</span> :</span><br><span class=\"line\">\tprint(i)</span><br><span class=\"line\">\ti += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;while结束&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-3-break和continue\"><a href=\"#3-4-3-break和continue\" class=\"headerlink\" title=\"3.4.3 break和continue\"></a>3.4.3 break和continue</h3><p>break：结束所有循环；</p>\n<p>continue：结束本次循环，进入下次循环。</p>\n<p>pass：占位，什么也不执行，但pass后的同级语句会执行，和空行没区别。</p>\n<h1 id=\"4-核心数据类型\"><a href=\"#4-核心数据类型\" class=\"headerlink\" title=\"4: 核心数据类型\"></a>4: 核心数据类型</h1><h2 id=\"4-1-字符串\"><a href=\"#4-1-字符串\" class=\"headerlink\" title=\"4.1 字符串\"></a>4.1 字符串</h2><p>可使用：单引号、双引号和三引号（三个单或双引号），使用反斜杠<code>\\</code>转义</p>\n<h3 id=\"4-1-1-字符串作为数组\"><a href=\"#4-1-1-字符串作为数组\" class=\"headerlink\" title=\"4.1.1 字符串作为数组\"></a>4.1.1 字符串作为数组</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">&quot;chengdu&quot;</span></span><br><span class=\"line\">print(str)</span><br><span class=\"line\">print(str[<span class=\"number\">0</span>])</span><br><span class=\"line\">print(str[<span class=\"number\">5</span>:])      <span class=\"comment\">#从索引5到最后</span></span><br><span class=\"line\">print(str[<span class=\"number\">0</span>:<span class=\"number\">5</span>:<span class=\"number\">2</span>])   <span class=\"comment\">#[起始位置:结束位置:步进值]</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>chengdu</p>\n<p>c</p>\n<p>du</p>\n<p>ceg</p>\n</blockquote>\n<h3 id=\"4-1-2-字符串连接\"><a href=\"#4-1-2-字符串连接\" class=\"headerlink\" title=\"4.1.2 字符串连接\"></a>4.1.2 字符串连接</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(str+<span class=\"string\">&quot;,nihao&quot;</span>)   <span class=\"comment\">#chengdu,nihao</span></span><br><span class=\"line\">print(str*<span class=\"number\">3</span>)   <span class=\"comment\">#连续打印三次</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;hello\\nchengdu&quot;</span>)    <span class=\"comment\">#\\n转义为换行</span></span><br><span class=\"line\">print(<span class=\"string\">r&quot;hello\\nchengdu&quot;</span>)     <span class=\"comment\">#转义字符不起作用，直接显示</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-1-3-字符串操作函数\"><a href=\"#4-1-3-字符串操作函数\" class=\"headerlink\" title=\"4.1.3 字符串操作函数\"></a>4.1.3 字符串操作函数</h3><p><code>bytes.decode</code>字符串解码</p>\n<p><code>isalnum()</code>包含至少一个字母或数字 </p>\n<p><code>isalpha()</code>至少一个且全为字母</p>\n<p><code>isdigit()</code>至少一个且全为数字</p>\n<p><code>join(seq)</code>指定字符串做分隔符，合并新的字符串</p>\n<p><code>split()</code>拆分字符串</p>\n<p><code>lstrip()</code>截掉字符串左边的空格或指定字符</p>\n<p><code>rstrip()</code>截掉右边</p>\n<h2 id=\"4-2-列表\"><a href=\"#4-2-列表\" class=\"headerlink\" title=\"4.2 列表\"></a>4.2 列表</h2><h3 id=\"4-2-1-定义列表\"><a href=\"#4-2-1-定义列表\" class=\"headerlink\" title=\"4.2.1 定义列表\"></a>4.2.1 定义列表</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list = []</span><br><span class=\"line\">namelist = [<span class=\"string\">&quot;zhang&quot;</span>,<span class=\"string\">&quot;wang&quot;</span>,<span class=\"number\">3</span>]   <span class=\"comment\">#列表中可以存储混合类型</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-2-打印\"><a href=\"#4-2-2-打印\" class=\"headerlink\" title=\"4.2.2 打印\"></a>4.2.2 打印</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(namelist[<span class=\"number\">0</span>])</span><br><span class=\"line\">print(namelist[<span class=\"number\">1</span>])</span><br><span class=\"line\">print(namelist[<span class=\"number\">2</span>])</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-3-遍历列表\"><a href=\"#4-2-3-遍历列表\" class=\"headerlink\" title=\"4.2.3 遍历列表\"></a>4.2.3 遍历列表</h3><p>for:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> namelist:</span><br><span class=\"line\">\tprint(name)</span><br><span class=\"line\">print(len(namelist))   <span class=\"comment\">#len()获取列表长度</span></span><br></pre></td></tr></table></figure>\n\n<p>while:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;len(namelist):</span><br><span class=\"line\">\tprint(namelist[i])</span><br><span class=\"line\">\ti++</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-4-列表操作函数\"><a href=\"#4-2-4-列表操作函数\" class=\"headerlink\" title=\"4.2.4 列表操作函数\"></a>4.2.4 列表操作函数</h3><p><code>[ : : ]</code>列表切片</p>\n<p><code>append</code>新增数据到列表尾部</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">namelist.append(<span class=\"string\">&quot;qian&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">a=[<span class=\"number\">1</span>,<span class=\"number\">2</span>]</span><br><span class=\"line\">b=[<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br><span class=\"line\">a.append(b)</span><br><span class=\"line\"><span class=\"comment\">#输出[1,2,[3,4]]   将列表作为一个元素加入到a中</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.extend(b)    <span class=\"comment\">#将b中的每个元素逐一追加到a中</span></span><br><span class=\"line\"><span class=\"comment\">#输出[1,2,[3,4],3,4]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>insert</code>指定下标位置插入元素，</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>]</span><br><span class=\"line\">a.insert(<span class=\"number\">1</span>,<span class=\"number\">3</span>)\t<span class=\"comment\">#第一个表示索引下标，第二个表示插入的元素（对象）</span></span><br><span class=\"line\"><span class=\"comment\">#输出[0,3,1,2]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>del list[index]</code> 在指定位置删除元素</p>\n<p><code>list.pop()</code>弹出末尾最后一个元素</p>\n<p><code>list.remove(&quot;钢铁侠&quot;)</code>直接删除第一个指定内容的元素，还有的同名元素不会被删除。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movieName = [<span class=\"string\">&quot;加勒比海盗&quot;</span>,<span class=\"string\">&quot;复仇者&quot;</span>,<span class=\"string\">&quot;钢铁侠&quot;</span>,<span class=\"string\">&quot;蜘蛛侠&quot;</span>]</span><br><span class=\"line\"><span class=\"keyword\">del</span> movieName[<span class=\"number\">2</span>]\t<span class=\"comment\">#删除钢铁侠</span></span><br></pre></td></tr></table></figure>\n\n<p><code>in</code>某元素是否在列表中</p>\n<p><code>not in</code>不在列表中</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = <span class=\"string\">&quot;wang&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> name <span class=\"keyword\">in</span> namelist:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;找到名字wang&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;没找到&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>index</code>查找指定下标范围的元素，返回元素在列表中的索引下标，范围区间，左闭右开</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"string\">&quot;a&quot;</span>,<span class=\"string\">&quot;b&quot;</span>,<span class=\"string\">&quot;c&quot;</span>,<span class=\"string\">&quot;d&quot;</span>,<span class=\"string\">&quot;e&quot;</span>]</span><br><span class=\"line\">a.index(<span class=\"string\">&quot;c&quot;</span>,<span class=\"number\">1</span>,<span class=\"number\">4</span>)   <span class=\"comment\">#范围是[1,4)</span></span><br><span class=\"line\"><span class=\"comment\">#输出2</span></span><br><span class=\"line\"><span class=\"comment\">#如果没找到会报错</span></span><br></pre></td></tr></table></figure>\n\n<p><code>count()</code>查找有多少个元素</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a.count(<span class=\"string\">&quot;c&quot;</span>)   </span><br><span class=\"line\"><span class=\"comment\">#输出1</span></span><br></pre></td></tr></table></figure>\n\n<p><code>reverse()</code>将列表元素从后向前反转</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>,<span class=\"number\">4</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]</span><br><span class=\"line\">a.reverce()</span><br><span class=\"line\"><span class=\"comment\">#输出[3,2,4,1]</span></span><br></pre></td></tr></table></figure>\n\n<p><code>sort()</code>排序</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a.sort()</span><br><span class=\"line\"><span class=\"comment\">#输出[1,2,3,4]</span></span><br><span class=\"line\">a.sort(reverse=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"comment\">#输出[4,3,2,1]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-元组\"><a href=\"#4-3-元组\" class=\"headerlink\" title=\"4.3 元组\"></a>4.3 元组</h2><p>tuple(元组):与list相似，但tuple元素不能修改。</p>\n<p>元组的元素不能改，但包含的对象可以修改。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tup1 = ()\t<span class=\"comment\">#创建空元组，带引成tuple类型</span></span><br><span class=\"line\">tup2 = (<span class=\"number\">58</span>)\t<span class=\"comment\">#会打印成整型</span></span><br><span class=\"line\">tup3 = (<span class=\"number\">58</span>,)\t<span class=\"comment\">#打印成tuple类型</span></span><br></pre></td></tr></table></figure>\n\n<p>元组寻址：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tup1 = (<span class=\"string\">&quot;abc&quot;</span>,<span class=\"string\">&quot;def&quot;</span>,<span class=\"number\">1421</span>)</span><br><span class=\"line\">print(tup1[<span class=\"number\">0</span>])</span><br><span class=\"line\">print(tup1[<span class=\"number\">-1</span>])\t<span class=\"comment\">#倒数第一个</span></span><br></pre></td></tr></table></figure>\n\n<p>元组不能修改：</p>\n<p><del>tup[0] = 1;</del></p>\n<p>元组增：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tup1 = (<span class=\"number\">12</span>,<span class=\"number\">34</span>,<span class=\"number\">56</span>)</span><br><span class=\"line\">tup2 = (<span class=\"string\">&quot;abc&quot;</span>,xyz)</span><br><span class=\"line\">tup3 = tup1 + tup2</span><br></pre></td></tr></table></figure>\n\n<p>元组删：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">del</span> tup</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-字典\"><a href=\"#4-4-字典\" class=\"headerlink\" title=\"4.4 字典\"></a>4.4 字典</h2><p>无序的对象集合，使用键值储存。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info = &#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;吴彦祖&quot;</span>,<span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">18</span>&#125;</span><br><span class=\"line\">print(info[<span class=\"string\">&quot;name&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<p>访问可能不存在的键：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(info[<span class=\"string\">&quot;gender&quot;</span>])</span><br><span class=\"line\"><span class=\"comment\">#报错</span></span><br><span class=\"line\">print(info.get(<span class=\"string\">&quot;gender&quot;</span>))</span><br><span class=\"line\"><span class=\"comment\">#输出None</span></span><br><span class=\"line\">print(info,get(<span class=\"string\">&quot;gender&quot;</span>,<span class=\"string\">&quot;m&quot;</span>))</span><br><span class=\"line\"><span class=\"comment\">#没找到默认为m，找到时显示找到的值</span></span><br></pre></td></tr></table></figure>\n\n<p>字典增：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info[<span class=\"string\">&quot;id&quot;</span>] = <span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n\n<p>字典删：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">del</span> info[<span class=\"string\">&quot;name&quot;</span>]\t<span class=\"comment\">#删除键值对。直接访问键会报错。</span></span><br><span class=\"line\">info.clear\t<span class=\"comment\">#清空数组，打印：info = &#123;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>字典改：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info[<span class=\"string\">&quot;name&quot;</span>] = <span class=\"string\">&quot;成龙&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>字典查：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info.keys()\t\t<span class=\"comment\">#得到所有的键，列表形式</span></span><br><span class=\"line\">info.values()\t<span class=\"comment\">#得到所有的值</span></span><br><span class=\"line\">info.items()\t<span class=\"comment\">#得到所有的项</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#遍历</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> info.keys():</span><br><span class=\"line\">\tprint(key)</span><br><span class=\"line\"><span class=\"keyword\">for</span> values <span class=\"keyword\">in</span> info.values():</span><br><span class=\"line\">    print(value)</span><br><span class=\"line\"><span class=\"keyword\">for</span> key,value <span class=\"keyword\">in</span> info.items():</span><br><span class=\"line\">    print(<span class=\"string\">&quot;key=$s,value=%s&quot;</span>%(key,value))</span><br><span class=\"line\"></span><br><span class=\"line\">mylist = [<span class=\"string\">&quot;a&quot;</span>,<span class=\"string\">&quot;b&quot;</span>,<span class=\"string\">&quot;c&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\">#enumerate枚举类型对象</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i,x <span class=\"keyword\">in</span> enumerate(mylist):</span><br><span class=\"line\">    print(i,x)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-5-集合\"><a href=\"#4-5-集合\" class=\"headerlink\" title=\"4.5 集合\"></a>4.5 集合</h2><p>与字典相似，是key的集合，但是key不能重复。</p>\n<p>set可以用来去重。</p>\n<p>小结：</p>\n<p><img src=\"https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png\" alt=\"image-20200726090258027\"></p>\n<h1 id=\"5-函数\"><a href=\"#5-函数\" class=\"headerlink\" title=\"5: 函数\"></a>5: 函数</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">printInfo</span>():</span></span><br><span class=\"line\">    print(<span class=\"string\">&quot;---------------------------&quot;</span>)</span><br><span class=\"line\">    print(<span class=\"string\">&quot;     人生苦短，我用python    &quot;</span>)</span><br><span class=\"line\">    print(<span class=\"string\">&quot;---------------------------&quot;</span>)</span><br><span class=\"line\">printInfo()</span><br></pre></td></tr></table></figure>\n\n<p>带参数的函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add2Num</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\tc = a + b</span><br><span class=\"line\">    print(c)</span><br><span class=\"line\">add2Num(<span class=\"number\">11</span>,<span class=\"number\">22</span>)</span><br></pre></td></tr></table></figure>\n\n<p>带返回值的函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add2Num</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">result = add2Num(<span class=\"number\">1</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">print(result)</span><br></pre></td></tr></table></figure>\n\n<p>返回多个值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">divid</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\tshang = a/b</span><br><span class=\"line\">    yushu = a%b</span><br><span class=\"line\">    <span class=\"keyword\">return</span> shang,yushu</span><br><span class=\"line\">sh,yu = divid(<span class=\"number\">5</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">print(sh,yu)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>函数类，局部变量优先于全局变量</p>\n</blockquote>\n<p>在函数中使用全局变量：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">test1</span>():</span></span><br><span class=\"line\">\t<span class=\"keyword\">global</span> a\t<span class=\"comment\">#全局变量标识符</span></span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    a = <span class=\"number\">200</span></span><br><span class=\"line\">print(a)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6-文件操作\"><a href=\"#6-文件操作\" class=\"headerlink\" title=\"6: 文件操作\"></a>6: 文件操作</h1><h2 id=\"6-1-打开关闭\"><a href=\"#6-1-打开关闭\" class=\"headerlink\" title=\"6.1 打开关闭\"></a>6.1 打开关闭</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;test.txt&quot;</span>,<span class=\"string\">&quot;w&quot;</span>)\t<span class=\"comment\">#打开文件，写模式，不存在文件时，在函数目录路径新建这个文件。</span></span><br><span class=\"line\">f.close()\t<span class=\"comment\">#关闭文件</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">模式</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">t</td>\n<td align=\"left\">文本模式 (默认)。</td>\n</tr>\n<tr>\n<td align=\"left\">x</td>\n<td align=\"left\">写模式，新建一个文件，如果该文件已存在则会报错。</td>\n</tr>\n<tr>\n<td align=\"left\">b</td>\n<td align=\"left\">二进制模式。</td>\n</tr>\n<tr>\n<td align=\"left\">+</td>\n<td align=\"left\">打开一个文件进行更新(可读可写)。</td>\n</tr>\n<tr>\n<td align=\"left\">U</td>\n<td align=\"left\">通用换行模式（不推荐）。</td>\n</tr>\n<tr>\n<td align=\"left\">r</td>\n<td align=\"left\">以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</td>\n</tr>\n<tr>\n<td align=\"left\">rb</td>\n<td align=\"left\">以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">r+</td>\n<td align=\"left\">打开一个文件用于读写。文件指针将会放在文件的开头。</td>\n</tr>\n<tr>\n<td align=\"left\">rb+</td>\n<td align=\"left\">以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">w</td>\n<td align=\"left\">打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>\n</tr>\n<tr>\n<td align=\"left\">wb</td>\n<td align=\"left\">以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">w+</td>\n<td align=\"left\">打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td>\n</tr>\n<tr>\n<td align=\"left\">wb+</td>\n<td align=\"left\">以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。</td>\n</tr>\n<tr>\n<td align=\"left\">a</td>\n<td align=\"left\">打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>\n</tr>\n<tr>\n<td align=\"left\">ab</td>\n<td align=\"left\">以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>\n</tr>\n<tr>\n<td align=\"left\">a+</td>\n<td align=\"left\">打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。</td>\n</tr>\n<tr>\n<td align=\"left\">ab+</td>\n<td align=\"left\">以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。</td>\n</tr>\n</tbody></table>\n<h2 id=\"6-2-读取字符\"><a href=\"#6-2-读取字符\" class=\"headerlink\" title=\"6.2 读取字符\"></a>6.2 读取字符</h2><p>读取全部行</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;test.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">content = f.read(<span class=\"number\">5</span>)\t<span class=\"comment\">#读五个字符，读取后，指针向后移到5的位置</span></span><br><span class=\"line\">content1 = f.readlines()\t<span class=\"comment\">#将文档全部读取出来，按行作为一个元素放在列表里。</span></span><br><span class=\"line\">f.close()</span><br></pre></td></tr></table></figure>\n\n<p>读取一行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;test.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">content1 = f.readline()\t<span class=\"comment\">#读取一行，指针后移</span></span><br><span class=\"line\">f.close()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-3-os库\"><a href=\"#6-3-os库\" class=\"headerlink\" title=\"6.3 os库\"></a>6.3 os库</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import os</span><br><span class=\"line\">os.rename(&quot;test.txt&quot;,&quot;abc.txt&quot;)</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"7-错误与异常\"><a href=\"#7-错误与异常\" class=\"headerlink\" title=\"7: 错误与异常\"></a>7: 错误与异常</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)\t<span class=\"comment\">#如果没有这个文件，就会报错</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> IOError:\t<span class=\"comment\">#文件没找到属于IO异常</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span>\t<span class=\"comment\">#捕获异常后的处理</span></span><br></pre></td></tr></table></figure>\n\n<p>要捕获异常类型，才不会报错</p>\n<p>捕获多个异常：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> (IOError,NameError):\t</span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<p>获取错误描述：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> IOError <span class=\"keyword\">as</span> result:</span><br><span class=\"line\">    print(result)</span><br></pre></td></tr></table></figure>\n\n<p>捕获所有异常：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---1---&quot;</span>)</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;---2---&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> result:</span><br><span class=\"line\">    print(result)\t<span class=\"comment\">#捕获异常后的处理</span></span><br></pre></td></tr></table></figure>\n\n<p>try finally:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tf = open(<span class=\"string\">&quot;123.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> result:</span><br><span class=\"line\">\tprint(result)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\tf.close()</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png","popularPost_tmp_gaData":{"updated":"Sun Jul 26 2020 10:53:55 GMT+0200 (GMT+02:00)","title":"Python基础","path":"2020/07/22/Python基础/","eyeCatchImage":"https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-07-22T11:51:02.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-22T11:51:02.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Python"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Python数据分析","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-29T15:56:45.000Z","password":null,"summary":null,"_content":"\n\n\n# 1：综述\n\n**为什么学习数据分析**\n\n1. 岗位需求\n2. python数据科学的基础\n3. 机器学习的课程基础\n\n**什么是数据分析**\n\n用适当的方法对收集的大量数据进行分析\n\n帮助人们做出判断，以便采取适当的行动\n\n**jupyter notebook：**\n\nPython笔记软件\n\n# 2：Matplotlib\n\n1. 将数据**可视化**，更**直观**的呈现\n\n2. 使数据更加**客观**、更具**说服力**\n\n最流行的python底层绘图库，主要做数据可视化，模仿matlab构建\n\n![](https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png)\n\n```python\nfrom matplotlib import pyplot as plt\t#导入pyplot\n\nx = range(2,26,2)\t#数据在x轴的位置，是一个可迭代的对\ny = [15,13,14,17,20,25,26,26,25,22,18,15]\t#数据在y轴的位置，是一个可迭代的对象\nplt.plot(x,y)\t#传入x和y，通过plot绘制出折线图\nplt.show()\t#执行程序的时候展现图像\n```\n\n**目前存在的问题：**\n\n1. 图片大小\n2. 保存到本地\n3. 描述信息，比如x，y轴表示什么\n4. 刻度\n5. 线条样式\n6. 标记特殊点\n\n## 2.1 设置图片大小-figure\n\n```python\nfig = plt.figure(figsize=(20,8),dpi=80)\n#figure图形图标的意思，这里指画的图\n#通过实例化一个figure并且传入参数\n#传入像素值，dpi，让图片更清晰\nplt.plot(x,y)\nplt.savefig(\"./t1.png\")\t#保存图片\n#可以保存为svg矢量图格式，放大不会失真\n```\n\n## 2.2 设置x，y轴步长-xticks/yticks\n\n```python\nplt.xticks(x)\t#设置步长\nplt.xticks(range(2,25))\n_xticks_labels = [i/2 for i in range(4,49)]\nplt.xticks(_xticks_labels[::3])\n\nplt.yticks(range(min(y),max(y)+1))\n\n#显示字符串\n_x = list(x)[::3]\n_xticks_labels = [\"10点{}分\".format(i) for i in range(60)]\n_xticks_labels += [\"11点{}分\".format(i) for i in range(60)]\nplt.xticks(list(_x)[::3],_xticks_labels[::3],rotation=90)\t#,前为步长列表，，后为字符串列表，与步长列表一一对应，并把刻度旋转90度显示。\n```\n\n**上述绘图，无法显示中文**\n\n## 2.3 加入中文字体支持-FontProperties\n\n方法1：\n\n```python\nimport matplotlib\nfont = {'family':'MicroSoft YaHei',\n       'weight':'bold',\n       'size':'larger'}\nmatplotlib.rc(\"font\",**font)\t#**可以把字典转为xx=xx格式\nmatplotlib.rc(\"font\",family='MicroSoft YaHei',weight='bold')\n```\n\n方法2：\n\n```python\nfrom matplotlib import font_manager\nmy_font = font_manager.FontProperties(fname=\"/System/Library/Fonts/PingFang.ttc\")\t#设定字体位置\n#查找系统字体存放位置\nplt.xticks(list(_x)[::3],_xticks_labels[::3],rotation=90,fontproperties=my_font)\n#使用字体\n```\n\n## 2.4 加入描述信息-xlabel/ylabel/title\n\n```python\nplt.xlabel(\"时间\",fontproperties=my_font)\nplt.ylabel(\"温度 单位（℃）\",fontproperties=my_font)\nplt.title(\"10点到12点的请问变化\",fontproperties=my_font)\n```\n\n## 2.5 设置网格-grid\n\n```python\nplt.grid()\nplt.grid(alpha=0.4)\t#设置网格透明度，1不透明，0透明\n```\n\n## 2.6 绘制两个图形-legend\n\n```python\nplt.plot(x,y1,label=\"自己\",color=\"orange\",linestyle=\":\")\nplt.plot(x,y2,label=\"同桌\",color=\"r\",linestyle=\"--\")\n\n#添加图例，解释哪个线表示哪个数据集，显示中文，格式不再是FontProperties\n#prop字体，loc位置：0最好的位置，不设置参数则默认0\nplt.legend(prop=my_font,loc=0)\n\n```\n\n> color='r'\t颜色\n>\n> linestyle='--'\t线条风格：-实线；--虚线；-.点划线；:点虚线；留空或空格，表示无线条\n>\n> linewidth=5\t线粗细\n>\n> alpha=0.4\t透明度\n\n## 2.7 绘制散点图-scatter\n\n```python\nplt.scatter(x, y)\nplt.show()\n```\n\n## 2.8 绘制柱状图-bar\n\n```python\n#绘制电影与其对应票房\na=[\"战狼2\",\"速度与激情8\",\"功夫瑜伽\",\"西游附魔篇\"]\nb=[56,61,26,94]\nplt.figure(figsize=(20,15),dpi=80)\n#绘制柱状图\nplt.bar(range(a),b,width=0.3)\n#设置横轴字符串\nplt.xticks(range(a),a,rotation=45)\nplt.show()\n```\n\n## 2.9 绘制条形图-barh\n\n```python\nplt.barh(range(len(a)),b,height=0.3,color='orange')\nplt.yticks(range(len(a)),a)\n```\n\n![](https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png)\n\n## 2.10 绘制直方图-hist\n\n有250部电影的时长，统计时长分布的数量，比如100到120分钟的电影数。\n\n组数=极差/组距。\n\n```python\na = [120,76,124,161……]\t#250部电影的时长。\n#计算组数\ntheory_d = 3\t#假定组距\nnum_bins = (max(a)-min(a))//d\t#计算组数\n\nplt.figure(figsize = (20,8),dpi=80)\nplt.hist(a,num_bins)\t#频数分布直方图\nplt.hist(a,num_bins,normed=True)\t#频率分布直方图\n#设置x刻度\nplt.xticks(range(min(a),max(a)+d,d))\nplt.grid()\nplt.show()\n```\n\n> 当（最大值-最小值）/假定组距 无法除尽时，根据假定组距绘制的x刻度会偏移。\n\n2.11 绘制其他图形\n\nhttps://matplotlib.org/gallery/index.html\n\n前端画图库js——echarts：\n\nhttps://echarts.apache.org/examples/zh/index.html\n\n图表代码托管——Plotly:\nhttps://plot.ly/python\n\n# 2：Numpy\n\n**什么时numpy？**\n\n一个再python中做科学计算的基础库，重在数值计算，也是大部分python科学计算库的基础库，多用于在大型、多维数组上执行数值计算。\n\n## 2.1 创建数组：\n\n```python\nimport numpy as np\na = np.array([1,2,3])\nb = np.array(range(10))\nc = np.arange(10)\t#作用与b的表达式相同\n\nprint(a)\nprint(type(a))\n\n```\n\n> 结果：\n>\n> [1 2 3]\n>\n> <class 'nmpy.ndarray'>\n\n## 2.2 数据类型\n\n```python\nd = np.array(range(1,4),dtype=\"float32\")\t#dtype指定数组中数据的数据类型\ne = np.array([1,1,0,0,0,1],dtype=bool)\nprint(e.dtype)\t#打印数组中数据的数据类型\n\n#调整数据类型\nf = d.astype(\"int8\")\n```\n\n修改浮点型的小数位数\n\n```\na = np.array(random.random() for i in range(10))\nnp.round(a,2)\n```\n\n## 2.3 数组形状\n\n```python\nt1 = np.array([[1,2,3],[3,4,5]])\nt1.shape\t\n#out:(2,3)\n```\n\n**数组的形状**\n\n```python\nt2 = np.arange(12)\t#新建一维数组\nt3 = t2.reshape(3,4)\t#变为二维的\nt4 = t2.reshape(24,)\t#变一维数组\nt5 = t2.flatten()\t#变一维数组\n```\n\n## 2.4 数组计算\n\n**数组和数**\n\n```python\nt6 = np.arange(24)\nt7 = t6.reshape(4,6)\nt7+2\t#数组中每个数都加2\nt7*2\t#每个数都乘2\nt7/2\t#每个数都除2，会得到浮点数\n```\n\n**数组和数组**\n\n形状相同：(4,6)与(4,6)\n\n```python\nt8 = np.arange(100,124).reshape(4,6)\nt7+t8\t#形状相同，行列相同的数值进行运算\nt7*t8\n```\n\n(4,6)与(,6)\n\n![](https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png)\n\n(4,6)与(4,1)\n\n![](https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png)\n\n**广播原则：**\n\n如果两个数组的后缘维度，即从末尾开始算起的维度的轴长度相符或其中一方的长度为1，则认为他们是广播兼容的。广播会在缺失和或长度为1的维度上进行\n\n## 2.5 读取数据\n\n**轴**\n\n一维数组只有一个轴，即0轴\n\n二维数组有两个轴，0和1轴。(2,5)，2是0轴长度，5是1轴长度\n\n三维数组有三个轴，0，1，2轴\n\n**读取数据**\n\n```python\nnp.loadtxt(frame,dtype=np.float,delimiter=None,skiprows=0,usecols=None,unpack=False)\n```\n\nframe：文件、字符串或产生器\n\ndtype：数据类型\n\ndlimiter：分割字符串，默认是空格\n\nskiprows：跳过前x行\n\nusecols：读取指定的列\n\nunpack：True表示，读入属性将分别写入不同的数组变量，False 读入数据只写入一个数组变量，默认False。**转置效果**。\n\n读取的文件内容格式：\n\n```\n1241,1241,15346,2451\n125415,235,4135,1351\n12516,15326,1361,616\n……\n```\n\n读取时可以按`,`分割。按行划分\n\n## 2.6 矩阵转置\n\n```python\nt2.transpose()\nt2.T\nt2.swapaxes(1,0)\t#交换轴，也能实现转置效果\n```\n\n## 2.7 索引和切片\n\n取第二行：\n\n```python\nt2[2]\n```\n\n取连续的多行：\n\n```python\nt2[2:]\n```\n\n取不连续的多行：\n\n```python\nt2[[2,8,10]]\n```\n\n取第一列：\n\n```python\nt2[:,0]\n```\n\n取连续多列：\n\n```python\nt2[:,2:]\n```\n\n取不连续的多列：\n\n```python\nt2[:,[0,2,5]]\n```\n\n取3行四列的值：\n\n```python\nt2[3,4]\n```\n\n取多行多列：3行到5行，2列到4列，因为`:`左右是左闭右开区间，行数为索引+1\n\n```python\nt2[2:5,1:4]\n```\n\n取多个不连续的点：(0,0)  (2,1)  (5,5)\n\n```\nt2[[0,2,5],[0,1,5]]\n```\n\n## 2.8 修改数值\n\n```python\nt[:,2:4] = 0\n```\n\n**布尔索引**\n\n```python\nt2<10\t#相同的矩阵，矩阵值为布尔类型，对应位置满足值小于10，则为1，否则为0\nt2[t2<10] = 3\t#t2中小于10的位置，赋值为3\nt2[t2<10]\t#取t2中小于10的数组成新矩阵\n```\n\n**三元运算符**\n\n```python\nnp.where(t<10,0,10)\t#如果小于10，替换为0，否则替换为10\n```\n\n**裁剪**\n\n```python\nt.clip(10,18)\t#小于10的替换为10，大于18的替换为18\n```\n\n```python\nt2 = t2.astype(float)\nt2[3,3] = np.nan\n```\n\n## 2.9 拼接数组\n\n```python\nnp.vstack(t1,t2)\t#竖直拼接\nnp.hstack(t1,t2)\t#水平拼接\n```\n\n![](https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png)\n\n## 2.10 行列交换\n\n行交换：\n\n```python\nt[[1,2],:] = t[[2,1],:]\n```\n\n列交换：\n\n```python\nt[:,[0,2]] = t[:,[2,0]]\n```\n\n## 2.11 其他方法\n\n```python\n#获取最大最小值\nnp.argmax(t,axis=0)\nnp.argmin(t,axis=1)\n#创建一个全0的数组\nnp.zeros((3,4))\n#创建全1数组\nnp.ones((3,4))\n#创建一个对角线为1的正方形数组（方阵）\nnp.eye(3)\n```\n\n## 2.12 生成随机数\n\n```\nnp.random.rand(3,4)\t#均匀分布\nnp.random.randn(3,4)\t#标准正太分布的随机数，平均数为0，标准差为1\nnp.random.randint(low,high,(shape))\t#产生[low,high)之间的数\n```\n\n种子：\n\n```python\nnp.random.seed(10)\nt = np.random.randint(0,20,(3,4))\t#每次随机的结果相同\n```\n\n## 2.13 copy和view\n\n1. a=b完全不复制，a和b相互影响。\n2. a = b[:]，视图操作，创建新对象a，但a的数据完全由b保管，两者数据变化一致。\n3. a = b.copy()复制，a和b互不影响。\n\n## 2.14 nan和inf\n\nnan(NAN,Nan)：not a number表示不是一个数字\n\ninf(-inf,inf)：infinity，正无穷，-inf表示负无穷\n\n一个数字除以0，python中会报错，numpy中是一个inf\n\n**nan：**\n\n1. 两个nan不相等\n\n```python\nnp.nan !=np.nan\n#True\n```\n\n2. 计算nan个数\n\n```python\nnp.count_nonzero(t2!=t2)\t#t2!=t2，得到新矩阵，每个位置是bool类型，true表示该位置是nan\nnp.count_nonzero(np.isnan(t2))\t#\n```\n\n3. 计算矩阵和\n\n```python\nnp.sum(t3)\nnp.sum(t3, axis=0)\t#数组元素个数，与列数相同。，计算对应列上的和\n```\n\n## 2.15 常用统计函数\n\n求和：t.sum(axis=0)\n\n均值：t.mean(axis=0)\n\n中值：t.median(axis)\n\n最大值：t.max\n\n最小值:t.min\n\n极值：np.ptp(t,axis=None)\t最大值和最小值之差\n\n标准差：t.std(axis=None)\n\n**默认返回多维数组的全部统计结果**","source":"_posts/Python数据分析.md","raw":"---\ntitle: Python数据分析\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-29 17:56:45\npassword:\nsummary:\ntags:\n- Matplotlib\n- Numpy\n- Pandas\ncategories: Python\n---\n\n\n\n# 1：综述\n\n**为什么学习数据分析**\n\n1. 岗位需求\n2. python数据科学的基础\n3. 机器学习的课程基础\n\n**什么是数据分析**\n\n用适当的方法对收集的大量数据进行分析\n\n帮助人们做出判断，以便采取适当的行动\n\n**jupyter notebook：**\n\nPython笔记软件\n\n# 2：Matplotlib\n\n1. 将数据**可视化**，更**直观**的呈现\n\n2. 使数据更加**客观**、更具**说服力**\n\n最流行的python底层绘图库，主要做数据可视化，模仿matlab构建\n\n![](https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png)\n\n```python\nfrom matplotlib import pyplot as plt\t#导入pyplot\n\nx = range(2,26,2)\t#数据在x轴的位置，是一个可迭代的对\ny = [15,13,14,17,20,25,26,26,25,22,18,15]\t#数据在y轴的位置，是一个可迭代的对象\nplt.plot(x,y)\t#传入x和y，通过plot绘制出折线图\nplt.show()\t#执行程序的时候展现图像\n```\n\n**目前存在的问题：**\n\n1. 图片大小\n2. 保存到本地\n3. 描述信息，比如x，y轴表示什么\n4. 刻度\n5. 线条样式\n6. 标记特殊点\n\n## 2.1 设置图片大小-figure\n\n```python\nfig = plt.figure(figsize=(20,8),dpi=80)\n#figure图形图标的意思，这里指画的图\n#通过实例化一个figure并且传入参数\n#传入像素值，dpi，让图片更清晰\nplt.plot(x,y)\nplt.savefig(\"./t1.png\")\t#保存图片\n#可以保存为svg矢量图格式，放大不会失真\n```\n\n## 2.2 设置x，y轴步长-xticks/yticks\n\n```python\nplt.xticks(x)\t#设置步长\nplt.xticks(range(2,25))\n_xticks_labels = [i/2 for i in range(4,49)]\nplt.xticks(_xticks_labels[::3])\n\nplt.yticks(range(min(y),max(y)+1))\n\n#显示字符串\n_x = list(x)[::3]\n_xticks_labels = [\"10点{}分\".format(i) for i in range(60)]\n_xticks_labels += [\"11点{}分\".format(i) for i in range(60)]\nplt.xticks(list(_x)[::3],_xticks_labels[::3],rotation=90)\t#,前为步长列表，，后为字符串列表，与步长列表一一对应，并把刻度旋转90度显示。\n```\n\n**上述绘图，无法显示中文**\n\n## 2.3 加入中文字体支持-FontProperties\n\n方法1：\n\n```python\nimport matplotlib\nfont = {'family':'MicroSoft YaHei',\n       'weight':'bold',\n       'size':'larger'}\nmatplotlib.rc(\"font\",**font)\t#**可以把字典转为xx=xx格式\nmatplotlib.rc(\"font\",family='MicroSoft YaHei',weight='bold')\n```\n\n方法2：\n\n```python\nfrom matplotlib import font_manager\nmy_font = font_manager.FontProperties(fname=\"/System/Library/Fonts/PingFang.ttc\")\t#设定字体位置\n#查找系统字体存放位置\nplt.xticks(list(_x)[::3],_xticks_labels[::3],rotation=90,fontproperties=my_font)\n#使用字体\n```\n\n## 2.4 加入描述信息-xlabel/ylabel/title\n\n```python\nplt.xlabel(\"时间\",fontproperties=my_font)\nplt.ylabel(\"温度 单位（℃）\",fontproperties=my_font)\nplt.title(\"10点到12点的请问变化\",fontproperties=my_font)\n```\n\n## 2.5 设置网格-grid\n\n```python\nplt.grid()\nplt.grid(alpha=0.4)\t#设置网格透明度，1不透明，0透明\n```\n\n## 2.6 绘制两个图形-legend\n\n```python\nplt.plot(x,y1,label=\"自己\",color=\"orange\",linestyle=\":\")\nplt.plot(x,y2,label=\"同桌\",color=\"r\",linestyle=\"--\")\n\n#添加图例，解释哪个线表示哪个数据集，显示中文，格式不再是FontProperties\n#prop字体，loc位置：0最好的位置，不设置参数则默认0\nplt.legend(prop=my_font,loc=0)\n\n```\n\n> color='r'\t颜色\n>\n> linestyle='--'\t线条风格：-实线；--虚线；-.点划线；:点虚线；留空或空格，表示无线条\n>\n> linewidth=5\t线粗细\n>\n> alpha=0.4\t透明度\n\n## 2.7 绘制散点图-scatter\n\n```python\nplt.scatter(x, y)\nplt.show()\n```\n\n## 2.8 绘制柱状图-bar\n\n```python\n#绘制电影与其对应票房\na=[\"战狼2\",\"速度与激情8\",\"功夫瑜伽\",\"西游附魔篇\"]\nb=[56,61,26,94]\nplt.figure(figsize=(20,15),dpi=80)\n#绘制柱状图\nplt.bar(range(a),b,width=0.3)\n#设置横轴字符串\nplt.xticks(range(a),a,rotation=45)\nplt.show()\n```\n\n## 2.9 绘制条形图-barh\n\n```python\nplt.barh(range(len(a)),b,height=0.3,color='orange')\nplt.yticks(range(len(a)),a)\n```\n\n![](https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png)\n\n## 2.10 绘制直方图-hist\n\n有250部电影的时长，统计时长分布的数量，比如100到120分钟的电影数。\n\n组数=极差/组距。\n\n```python\na = [120,76,124,161……]\t#250部电影的时长。\n#计算组数\ntheory_d = 3\t#假定组距\nnum_bins = (max(a)-min(a))//d\t#计算组数\n\nplt.figure(figsize = (20,8),dpi=80)\nplt.hist(a,num_bins)\t#频数分布直方图\nplt.hist(a,num_bins,normed=True)\t#频率分布直方图\n#设置x刻度\nplt.xticks(range(min(a),max(a)+d,d))\nplt.grid()\nplt.show()\n```\n\n> 当（最大值-最小值）/假定组距 无法除尽时，根据假定组距绘制的x刻度会偏移。\n\n2.11 绘制其他图形\n\nhttps://matplotlib.org/gallery/index.html\n\n前端画图库js——echarts：\n\nhttps://echarts.apache.org/examples/zh/index.html\n\n图表代码托管——Plotly:\nhttps://plot.ly/python\n\n# 2：Numpy\n\n**什么时numpy？**\n\n一个再python中做科学计算的基础库，重在数值计算，也是大部分python科学计算库的基础库，多用于在大型、多维数组上执行数值计算。\n\n## 2.1 创建数组：\n\n```python\nimport numpy as np\na = np.array([1,2,3])\nb = np.array(range(10))\nc = np.arange(10)\t#作用与b的表达式相同\n\nprint(a)\nprint(type(a))\n\n```\n\n> 结果：\n>\n> [1 2 3]\n>\n> <class 'nmpy.ndarray'>\n\n## 2.2 数据类型\n\n```python\nd = np.array(range(1,4),dtype=\"float32\")\t#dtype指定数组中数据的数据类型\ne = np.array([1,1,0,0,0,1],dtype=bool)\nprint(e.dtype)\t#打印数组中数据的数据类型\n\n#调整数据类型\nf = d.astype(\"int8\")\n```\n\n修改浮点型的小数位数\n\n```\na = np.array(random.random() for i in range(10))\nnp.round(a,2)\n```\n\n## 2.3 数组形状\n\n```python\nt1 = np.array([[1,2,3],[3,4,5]])\nt1.shape\t\n#out:(2,3)\n```\n\n**数组的形状**\n\n```python\nt2 = np.arange(12)\t#新建一维数组\nt3 = t2.reshape(3,4)\t#变为二维的\nt4 = t2.reshape(24,)\t#变一维数组\nt5 = t2.flatten()\t#变一维数组\n```\n\n## 2.4 数组计算\n\n**数组和数**\n\n```python\nt6 = np.arange(24)\nt7 = t6.reshape(4,6)\nt7+2\t#数组中每个数都加2\nt7*2\t#每个数都乘2\nt7/2\t#每个数都除2，会得到浮点数\n```\n\n**数组和数组**\n\n形状相同：(4,6)与(4,6)\n\n```python\nt8 = np.arange(100,124).reshape(4,6)\nt7+t8\t#形状相同，行列相同的数值进行运算\nt7*t8\n```\n\n(4,6)与(,6)\n\n![](https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png)\n\n(4,6)与(4,1)\n\n![](https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png)\n\n**广播原则：**\n\n如果两个数组的后缘维度，即从末尾开始算起的维度的轴长度相符或其中一方的长度为1，则认为他们是广播兼容的。广播会在缺失和或长度为1的维度上进行\n\n## 2.5 读取数据\n\n**轴**\n\n一维数组只有一个轴，即0轴\n\n二维数组有两个轴，0和1轴。(2,5)，2是0轴长度，5是1轴长度\n\n三维数组有三个轴，0，1，2轴\n\n**读取数据**\n\n```python\nnp.loadtxt(frame,dtype=np.float,delimiter=None,skiprows=0,usecols=None,unpack=False)\n```\n\nframe：文件、字符串或产生器\n\ndtype：数据类型\n\ndlimiter：分割字符串，默认是空格\n\nskiprows：跳过前x行\n\nusecols：读取指定的列\n\nunpack：True表示，读入属性将分别写入不同的数组变量，False 读入数据只写入一个数组变量，默认False。**转置效果**。\n\n读取的文件内容格式：\n\n```\n1241,1241,15346,2451\n125415,235,4135,1351\n12516,15326,1361,616\n……\n```\n\n读取时可以按`,`分割。按行划分\n\n## 2.6 矩阵转置\n\n```python\nt2.transpose()\nt2.T\nt2.swapaxes(1,0)\t#交换轴，也能实现转置效果\n```\n\n## 2.7 索引和切片\n\n取第二行：\n\n```python\nt2[2]\n```\n\n取连续的多行：\n\n```python\nt2[2:]\n```\n\n取不连续的多行：\n\n```python\nt2[[2,8,10]]\n```\n\n取第一列：\n\n```python\nt2[:,0]\n```\n\n取连续多列：\n\n```python\nt2[:,2:]\n```\n\n取不连续的多列：\n\n```python\nt2[:,[0,2,5]]\n```\n\n取3行四列的值：\n\n```python\nt2[3,4]\n```\n\n取多行多列：3行到5行，2列到4列，因为`:`左右是左闭右开区间，行数为索引+1\n\n```python\nt2[2:5,1:4]\n```\n\n取多个不连续的点：(0,0)  (2,1)  (5,5)\n\n```\nt2[[0,2,5],[0,1,5]]\n```\n\n## 2.8 修改数值\n\n```python\nt[:,2:4] = 0\n```\n\n**布尔索引**\n\n```python\nt2<10\t#相同的矩阵，矩阵值为布尔类型，对应位置满足值小于10，则为1，否则为0\nt2[t2<10] = 3\t#t2中小于10的位置，赋值为3\nt2[t2<10]\t#取t2中小于10的数组成新矩阵\n```\n\n**三元运算符**\n\n```python\nnp.where(t<10,0,10)\t#如果小于10，替换为0，否则替换为10\n```\n\n**裁剪**\n\n```python\nt.clip(10,18)\t#小于10的替换为10，大于18的替换为18\n```\n\n```python\nt2 = t2.astype(float)\nt2[3,3] = np.nan\n```\n\n## 2.9 拼接数组\n\n```python\nnp.vstack(t1,t2)\t#竖直拼接\nnp.hstack(t1,t2)\t#水平拼接\n```\n\n![](https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png)\n\n## 2.10 行列交换\n\n行交换：\n\n```python\nt[[1,2],:] = t[[2,1],:]\n```\n\n列交换：\n\n```python\nt[:,[0,2]] = t[:,[2,0]]\n```\n\n## 2.11 其他方法\n\n```python\n#获取最大最小值\nnp.argmax(t,axis=0)\nnp.argmin(t,axis=1)\n#创建一个全0的数组\nnp.zeros((3,4))\n#创建全1数组\nnp.ones((3,4))\n#创建一个对角线为1的正方形数组（方阵）\nnp.eye(3)\n```\n\n## 2.12 生成随机数\n\n```\nnp.random.rand(3,4)\t#均匀分布\nnp.random.randn(3,4)\t#标准正太分布的随机数，平均数为0，标准差为1\nnp.random.randint(low,high,(shape))\t#产生[low,high)之间的数\n```\n\n种子：\n\n```python\nnp.random.seed(10)\nt = np.random.randint(0,20,(3,4))\t#每次随机的结果相同\n```\n\n## 2.13 copy和view\n\n1. a=b完全不复制，a和b相互影响。\n2. a = b[:]，视图操作，创建新对象a，但a的数据完全由b保管，两者数据变化一致。\n3. a = b.copy()复制，a和b互不影响。\n\n## 2.14 nan和inf\n\nnan(NAN,Nan)：not a number表示不是一个数字\n\ninf(-inf,inf)：infinity，正无穷，-inf表示负无穷\n\n一个数字除以0，python中会报错，numpy中是一个inf\n\n**nan：**\n\n1. 两个nan不相等\n\n```python\nnp.nan !=np.nan\n#True\n```\n\n2. 计算nan个数\n\n```python\nnp.count_nonzero(t2!=t2)\t#t2!=t2，得到新矩阵，每个位置是bool类型，true表示该位置是nan\nnp.count_nonzero(np.isnan(t2))\t#\n```\n\n3. 计算矩阵和\n\n```python\nnp.sum(t3)\nnp.sum(t3, axis=0)\t#数组元素个数，与列数相同。，计算对应列上的和\n```\n\n## 2.15 常用统计函数\n\n求和：t.sum(axis=0)\n\n均值：t.mean(axis=0)\n\n中值：t.median(axis)\n\n最大值：t.max\n\n最小值:t.min\n\n极值：np.ptp(t,axis=None)\t最大值和最小值之差\n\n标准差：t.std(axis=None)\n\n**默认返回多维数组的全部统计结果**","slug":"Python数据分析","published":1,"updated":"2020-10-13T21:14:00.346Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsab5000zp0vz15et60f2","content":"<h1 id=\"1：综述\"><a href=\"#1：综述\" class=\"headerlink\" title=\"1：综述\"></a>1：综述</h1><p><strong>为什么学习数据分析</strong></p>\n<ol>\n<li>岗位需求</li>\n<li>python数据科学的基础</li>\n<li>机器学习的课程基础</li>\n</ol>\n<p><strong>什么是数据分析</strong></p>\n<p>用适当的方法对收集的大量数据进行分析</p>\n<p>帮助人们做出判断，以便采取适当的行动</p>\n<p><strong>jupyter notebook：</strong></p>\n<p>Python笔记软件</p>\n<h1 id=\"2：Matplotlib\"><a href=\"#2：Matplotlib\" class=\"headerlink\" title=\"2：Matplotlib\"></a>2：Matplotlib</h1><ol>\n<li><p>将数据<strong>可视化</strong>，更<strong>直观</strong>的呈现</p>\n</li>\n<li><p>使数据更加<strong>客观</strong>、更具<strong>说服力</strong></p>\n</li>\n</ol>\n<p>最流行的python底层绘图库，主要做数据可视化，模仿matlab构建</p>\n<p><img src=\"https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> pyplot <span class=\"keyword\">as</span> plt\t<span class=\"comment\">#导入pyplot</span></span><br><span class=\"line\"></span><br><span class=\"line\">x = range(<span class=\"number\">2</span>,<span class=\"number\">26</span>,<span class=\"number\">2</span>)\t<span class=\"comment\">#数据在x轴的位置，是一个可迭代的对</span></span><br><span class=\"line\">y = [<span class=\"number\">15</span>,<span class=\"number\">13</span>,<span class=\"number\">14</span>,<span class=\"number\">17</span>,<span class=\"number\">20</span>,<span class=\"number\">25</span>,<span class=\"number\">26</span>,<span class=\"number\">26</span>,<span class=\"number\">25</span>,<span class=\"number\">22</span>,<span class=\"number\">18</span>,<span class=\"number\">15</span>]\t<span class=\"comment\">#数据在y轴的位置，是一个可迭代的对象</span></span><br><span class=\"line\">plt.plot(x,y)\t<span class=\"comment\">#传入x和y，通过plot绘制出折线图</span></span><br><span class=\"line\">plt.show()\t<span class=\"comment\">#执行程序的时候展现图像</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>目前存在的问题：</strong></p>\n<ol>\n<li>图片大小</li>\n<li>保存到本地</li>\n<li>描述信息，比如x，y轴表示什么</li>\n<li>刻度</li>\n<li>线条样式</li>\n<li>标记特殊点</li>\n</ol>\n<h2 id=\"2-1-设置图片大小-figure\"><a href=\"#2-1-设置图片大小-figure\" class=\"headerlink\" title=\"2.1 设置图片大小-figure\"></a>2.1 设置图片大小-figure</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fig = plt.figure(figsize=(<span class=\"number\">20</span>,<span class=\"number\">8</span>),dpi=<span class=\"number\">80</span>)</span><br><span class=\"line\"><span class=\"comment\">#figure图形图标的意思，这里指画的图</span></span><br><span class=\"line\"><span class=\"comment\">#通过实例化一个figure并且传入参数</span></span><br><span class=\"line\"><span class=\"comment\">#传入像素值，dpi，让图片更清晰</span></span><br><span class=\"line\">plt.plot(x,y)</span><br><span class=\"line\">plt.savefig(<span class=\"string\">&quot;./t1.png&quot;</span>)\t<span class=\"comment\">#保存图片</span></span><br><span class=\"line\"><span class=\"comment\">#可以保存为svg矢量图格式，放大不会失真</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-设置x，y轴步长-xticks-yticks\"><a href=\"#2-2-设置x，y轴步长-xticks-yticks\" class=\"headerlink\" title=\"2.2 设置x，y轴步长-xticks/yticks\"></a>2.2 设置x，y轴步长-xticks/yticks</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.xticks(x)\t<span class=\"comment\">#设置步长</span></span><br><span class=\"line\">plt.xticks(range(<span class=\"number\">2</span>,<span class=\"number\">25</span>))</span><br><span class=\"line\">_xticks_labels = [i/<span class=\"number\">2</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">4</span>,<span class=\"number\">49</span>)]</span><br><span class=\"line\">plt.xticks(_xticks_labels[::<span class=\"number\">3</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">plt.yticks(range(min(y),max(y)+<span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#显示字符串</span></span><br><span class=\"line\">_x = list(x)[::<span class=\"number\">3</span>]</span><br><span class=\"line\">_xticks_labels = [<span class=\"string\">&quot;10点&#123;&#125;分&quot;</span>.format(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">60</span>)]</span><br><span class=\"line\">_xticks_labels += [<span class=\"string\">&quot;11点&#123;&#125;分&quot;</span>.format(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">60</span>)]</span><br><span class=\"line\">plt.xticks(list(_x)[::<span class=\"number\">3</span>],_xticks_labels[::<span class=\"number\">3</span>],rotation=<span class=\"number\">90</span>)\t<span class=\"comment\">#,前为步长列表，，后为字符串列表，与步长列表一一对应，并把刻度旋转90度显示。</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>上述绘图，无法显示中文</strong></p>\n<h2 id=\"2-3-加入中文字体支持-FontProperties\"><a href=\"#2-3-加入中文字体支持-FontProperties\" class=\"headerlink\" title=\"2.3 加入中文字体支持-FontProperties\"></a>2.3 加入中文字体支持-FontProperties</h2><p>方法1：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> matplotlib</span><br><span class=\"line\">font = &#123;<span class=\"string\">&#x27;family&#x27;</span>:<span class=\"string\">&#x27;MicroSoft YaHei&#x27;</span>,</span><br><span class=\"line\">       <span class=\"string\">&#x27;weight&#x27;</span>:<span class=\"string\">&#x27;bold&#x27;</span>,</span><br><span class=\"line\">       <span class=\"string\">&#x27;size&#x27;</span>:<span class=\"string\">&#x27;larger&#x27;</span>&#125;</span><br><span class=\"line\">matplotlib.rc(<span class=\"string\">&quot;font&quot;</span>,**font)\t<span class=\"comment\">#**可以把字典转为xx=xx格式</span></span><br><span class=\"line\">matplotlib.rc(<span class=\"string\">&quot;font&quot;</span>,family=<span class=\"string\">&#x27;MicroSoft YaHei&#x27;</span>,weight=<span class=\"string\">&#x27;bold&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>方法2：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> font_manager</span><br><span class=\"line\">my_font = font_manager.FontProperties(fname=<span class=\"string\">&quot;/System/Library/Fonts/PingFang.ttc&quot;</span>)\t<span class=\"comment\">#设定字体位置</span></span><br><span class=\"line\"><span class=\"comment\">#查找系统字体存放位置</span></span><br><span class=\"line\">plt.xticks(list(_x)[::<span class=\"number\">3</span>],_xticks_labels[::<span class=\"number\">3</span>],rotation=<span class=\"number\">90</span>,fontproperties=my_font)</span><br><span class=\"line\"><span class=\"comment\">#使用字体</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-加入描述信息-xlabel-ylabel-title\"><a href=\"#2-4-加入描述信息-xlabel-ylabel-title\" class=\"headerlink\" title=\"2.4 加入描述信息-xlabel/ylabel/title\"></a>2.4 加入描述信息-xlabel/ylabel/title</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.xlabel(<span class=\"string\">&quot;时间&quot;</span>,fontproperties=my_font)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&quot;温度 单位（℃）&quot;</span>,fontproperties=my_font)</span><br><span class=\"line\">plt.title(<span class=\"string\">&quot;10点到12点的请问变化&quot;</span>,fontproperties=my_font)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-设置网格-grid\"><a href=\"#2-5-设置网格-grid\" class=\"headerlink\" title=\"2.5 设置网格-grid\"></a>2.5 设置网格-grid</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.grid()</span><br><span class=\"line\">plt.grid(alpha=<span class=\"number\">0.4</span>)\t<span class=\"comment\">#设置网格透明度，1不透明，0透明</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-绘制两个图形-legend\"><a href=\"#2-6-绘制两个图形-legend\" class=\"headerlink\" title=\"2.6 绘制两个图形-legend\"></a>2.6 绘制两个图形-legend</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.plot(x,y1,label=<span class=\"string\">&quot;自己&quot;</span>,color=<span class=\"string\">&quot;orange&quot;</span>,linestyle=<span class=\"string\">&quot;:&quot;</span>)</span><br><span class=\"line\">plt.plot(x,y2,label=<span class=\"string\">&quot;同桌&quot;</span>,color=<span class=\"string\">&quot;r&quot;</span>,linestyle=<span class=\"string\">&quot;--&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加图例，解释哪个线表示哪个数据集，显示中文，格式不再是FontProperties</span></span><br><span class=\"line\"><span class=\"comment\">#prop字体，loc位置：0最好的位置，不设置参数则默认0</span></span><br><span class=\"line\">plt.legend(prop=my_font,loc=<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>color=’r’    颜色</p>\n<p>linestyle=’–’    线条风格：-实线；–虚线；-.点划线；:点虚线；留空或空格，表示无线条</p>\n<p>linewidth=5    线粗细</p>\n<p>alpha=0.4    透明度</p>\n</blockquote>\n<h2 id=\"2-7-绘制散点图-scatter\"><a href=\"#2-7-绘制散点图-scatter\" class=\"headerlink\" title=\"2.7 绘制散点图-scatter\"></a>2.7 绘制散点图-scatter</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.scatter(x, y)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-绘制柱状图-bar\"><a href=\"#2-8-绘制柱状图-bar\" class=\"headerlink\" title=\"2.8 绘制柱状图-bar\"></a>2.8 绘制柱状图-bar</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#绘制电影与其对应票房</span></span><br><span class=\"line\">a=[<span class=\"string\">&quot;战狼2&quot;</span>,<span class=\"string\">&quot;速度与激情8&quot;</span>,<span class=\"string\">&quot;功夫瑜伽&quot;</span>,<span class=\"string\">&quot;西游附魔篇&quot;</span>]</span><br><span class=\"line\">b=[<span class=\"number\">56</span>,<span class=\"number\">61</span>,<span class=\"number\">26</span>,<span class=\"number\">94</span>]</span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">20</span>,<span class=\"number\">15</span>),dpi=<span class=\"number\">80</span>)</span><br><span class=\"line\"><span class=\"comment\">#绘制柱状图</span></span><br><span class=\"line\">plt.bar(range(a),b,width=<span class=\"number\">0.3</span>)</span><br><span class=\"line\"><span class=\"comment\">#设置横轴字符串</span></span><br><span class=\"line\">plt.xticks(range(a),a,rotation=<span class=\"number\">45</span>)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-9-绘制条形图-barh\"><a href=\"#2-9-绘制条形图-barh\" class=\"headerlink\" title=\"2.9 绘制条形图-barh\"></a>2.9 绘制条形图-barh</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.barh(range(len(a)),b,height=<span class=\"number\">0.3</span>,color=<span class=\"string\">&#x27;orange&#x27;</span>)</span><br><span class=\"line\">plt.yticks(range(len(a)),a)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"2-10-绘制直方图-hist\"><a href=\"#2-10-绘制直方图-hist\" class=\"headerlink\" title=\"2.10 绘制直方图-hist\"></a>2.10 绘制直方图-hist</h2><p>有250部电影的时长，统计时长分布的数量，比如100到120分钟的电影数。</p>\n<p>组数=极差/组距。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">120</span>,<span class=\"number\">76</span>,<span class=\"number\">124</span>,<span class=\"number\">161</span>……]\t<span class=\"comment\">#250部电影的时长。</span></span><br><span class=\"line\"><span class=\"comment\">#计算组数</span></span><br><span class=\"line\">theory_d = <span class=\"number\">3</span>\t<span class=\"comment\">#假定组距</span></span><br><span class=\"line\">num_bins = (max(a)-min(a))//d\t<span class=\"comment\">#计算组数</span></span><br><span class=\"line\"></span><br><span class=\"line\">plt.figure(figsize = (<span class=\"number\">20</span>,<span class=\"number\">8</span>),dpi=<span class=\"number\">80</span>)</span><br><span class=\"line\">plt.hist(a,num_bins)\t<span class=\"comment\">#频数分布直方图</span></span><br><span class=\"line\">plt.hist(a,num_bins,normed=<span class=\"literal\">True</span>)\t<span class=\"comment\">#频率分布直方图</span></span><br><span class=\"line\"><span class=\"comment\">#设置x刻度</span></span><br><span class=\"line\">plt.xticks(range(min(a),max(a)+d,d))</span><br><span class=\"line\">plt.grid()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当（最大值-最小值）/假定组距 无法除尽时，根据假定组距绘制的x刻度会偏移。</p>\n</blockquote>\n<p>2.11 绘制其他图形</p>\n<p><a href=\"https://matplotlib.org/gallery/index.html\">https://matplotlib.org/gallery/index.html</a></p>\n<p>前端画图库js——echarts：</p>\n<p><a href=\"https://echarts.apache.org/examples/zh/index.html\">https://echarts.apache.org/examples/zh/index.html</a></p>\n<p>图表代码托管——Plotly:<br><a href=\"https://plot.ly/python\">https://plot.ly/python</a></p>\n<h1 id=\"2：Numpy\"><a href=\"#2：Numpy\" class=\"headerlink\" title=\"2：Numpy\"></a>2：Numpy</h1><p><strong>什么时numpy？</strong></p>\n<p>一个再python中做科学计算的基础库，重在数值计算，也是大部分python科学计算库的基础库，多用于在大型、多维数组上执行数值计算。</p>\n<h2 id=\"2-1-创建数组：\"><a href=\"#2-1-创建数组：\" class=\"headerlink\" title=\"2.1 创建数组：\"></a>2.1 创建数组：</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">a = np.array([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>])</span><br><span class=\"line\">b = np.array(range(<span class=\"number\">10</span>))</span><br><span class=\"line\">c = np.arange(<span class=\"number\">10</span>)\t<span class=\"comment\">#作用与b的表达式相同</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(type(a))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>结果：</p>\n<p>[1 2 3]</p>\n<p>&lt;class ‘nmpy.ndarray’&gt;</p>\n</blockquote>\n<h2 id=\"2-2-数据类型\"><a href=\"#2-2-数据类型\" class=\"headerlink\" title=\"2.2 数据类型\"></a>2.2 数据类型</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d = np.array(range(<span class=\"number\">1</span>,<span class=\"number\">4</span>),dtype=<span class=\"string\">&quot;float32&quot;</span>)\t<span class=\"comment\">#dtype指定数组中数据的数据类型</span></span><br><span class=\"line\">e = np.array([<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">1</span>],dtype=bool)</span><br><span class=\"line\">print(e.dtype)\t<span class=\"comment\">#打印数组中数据的数据类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#调整数据类型</span></span><br><span class=\"line\">f = d.astype(<span class=\"string\">&quot;int8&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>修改浮点型的小数位数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a &#x3D; np.array(random.random() for i in range(10))</span><br><span class=\"line\">np.round(a,2)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-数组形状\"><a href=\"#2-3-数组形状\" class=\"headerlink\" title=\"2.3 数组形状\"></a>2.3 数组形状</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 = np.array([[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],[<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>]])</span><br><span class=\"line\">t1.shape\t</span><br><span class=\"line\"><span class=\"comment\">#out:(2,3)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>数组的形状</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2 = np.arange(<span class=\"number\">12</span>)\t<span class=\"comment\">#新建一维数组</span></span><br><span class=\"line\">t3 = t2.reshape(<span class=\"number\">3</span>,<span class=\"number\">4</span>)\t<span class=\"comment\">#变为二维的</span></span><br><span class=\"line\">t4 = t2.reshape(<span class=\"number\">24</span>,)\t<span class=\"comment\">#变一维数组</span></span><br><span class=\"line\">t5 = t2.flatten()\t<span class=\"comment\">#变一维数组</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-数组计算\"><a href=\"#2-4-数组计算\" class=\"headerlink\" title=\"2.4 数组计算\"></a>2.4 数组计算</h2><p><strong>数组和数</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t6 = np.arange(<span class=\"number\">24</span>)</span><br><span class=\"line\">t7 = t6.reshape(<span class=\"number\">4</span>,<span class=\"number\">6</span>)</span><br><span class=\"line\">t7+<span class=\"number\">2</span>\t<span class=\"comment\">#数组中每个数都加2</span></span><br><span class=\"line\">t7*<span class=\"number\">2</span>\t<span class=\"comment\">#每个数都乘2</span></span><br><span class=\"line\">t7/<span class=\"number\">2</span>\t<span class=\"comment\">#每个数都除2，会得到浮点数</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>数组和数组</strong></p>\n<p>形状相同：(4,6)与(4,6)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t8 = np.arange(<span class=\"number\">100</span>,<span class=\"number\">124</span>).reshape(<span class=\"number\">4</span>,<span class=\"number\">6</span>)</span><br><span class=\"line\">t7+t8\t<span class=\"comment\">#形状相同，行列相同的数值进行运算</span></span><br><span class=\"line\">t7*t8</span><br></pre></td></tr></table></figure>\n\n<p>(4,6)与(,6)</p>\n<p><img src=\"https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>(4,6)与(4,1)</p>\n<p><img src=\"https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>广播原则：</strong></p>\n<p>如果两个数组的后缘维度，即从末尾开始算起的维度的轴长度相符或其中一方的长度为1，则认为他们是广播兼容的。广播会在缺失和或长度为1的维度上进行</p>\n<h2 id=\"2-5-读取数据\"><a href=\"#2-5-读取数据\" class=\"headerlink\" title=\"2.5 读取数据\"></a>2.5 读取数据</h2><p><strong>轴</strong></p>\n<p>一维数组只有一个轴，即0轴</p>\n<p>二维数组有两个轴，0和1轴。(2,5)，2是0轴长度，5是1轴长度</p>\n<p>三维数组有三个轴，0，1，2轴</p>\n<p><strong>读取数据</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.loadtxt(frame,dtype=np.float,delimiter=<span class=\"literal\">None</span>,skiprows=<span class=\"number\">0</span>,usecols=<span class=\"literal\">None</span>,unpack=<span class=\"literal\">False</span>)</span><br></pre></td></tr></table></figure>\n\n<p>frame：文件、字符串或产生器</p>\n<p>dtype：数据类型</p>\n<p>dlimiter：分割字符串，默认是空格</p>\n<p>skiprows：跳过前x行</p>\n<p>usecols：读取指定的列</p>\n<p>unpack：True表示，读入属性将分别写入不同的数组变量，False 读入数据只写入一个数组变量，默认False。<strong>转置效果</strong>。</p>\n<p>读取的文件内容格式：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1241,1241,15346,2451</span><br><span class=\"line\">125415,235,4135,1351</span><br><span class=\"line\">12516,15326,1361,616</span><br><span class=\"line\">……</span><br></pre></td></tr></table></figure>\n\n<p>读取时可以按<code>,</code>分割。按行划分</p>\n<h2 id=\"2-6-矩阵转置\"><a href=\"#2-6-矩阵转置\" class=\"headerlink\" title=\"2.6 矩阵转置\"></a>2.6 矩阵转置</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2.transpose()</span><br><span class=\"line\">t2.T</span><br><span class=\"line\">t2.swapaxes(<span class=\"number\">1</span>,<span class=\"number\">0</span>)\t<span class=\"comment\">#交换轴，也能实现转置效果</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-索引和切片\"><a href=\"#2-7-索引和切片\" class=\"headerlink\" title=\"2.7 索引和切片\"></a>2.7 索引和切片</h2><p>取第二行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">2</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取连续的多行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">2</span>:]</span><br></pre></td></tr></table></figure>\n\n<p>取不连续的多行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[[<span class=\"number\">2</span>,<span class=\"number\">8</span>,<span class=\"number\">10</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>取第一列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[:,<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取连续多列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[:,<span class=\"number\">2</span>:]</span><br></pre></td></tr></table></figure>\n\n<p>取不连续的多列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[:,[<span class=\"number\">0</span>,<span class=\"number\">2</span>,<span class=\"number\">5</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>取3行四列的值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取多行多列：3行到5行，2列到4列，因为<code>:</code>左右是左闭右开区间，行数为索引+1</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">2</span>:<span class=\"number\">5</span>,<span class=\"number\">1</span>:<span class=\"number\">4</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取多个不连续的点：(0,0)  (2,1)  (5,5)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[[0,2,5],[0,1,5]]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-修改数值\"><a href=\"#2-8-修改数值\" class=\"headerlink\" title=\"2.8 修改数值\"></a>2.8 修改数值</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t[:,<span class=\"number\">2</span>:<span class=\"number\">4</span>] = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>布尔索引</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2&lt;<span class=\"number\">10</span>\t<span class=\"comment\">#相同的矩阵，矩阵值为布尔类型，对应位置满足值小于10，则为1，否则为0</span></span><br><span class=\"line\">t2[t2&lt;<span class=\"number\">10</span>] = <span class=\"number\">3</span>\t<span class=\"comment\">#t2中小于10的位置，赋值为3</span></span><br><span class=\"line\">t2[t2&lt;<span class=\"number\">10</span>]\t<span class=\"comment\">#取t2中小于10的数组成新矩阵</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>三元运算符</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.where(t&lt;<span class=\"number\">10</span>,<span class=\"number\">0</span>,<span class=\"number\">10</span>)\t<span class=\"comment\">#如果小于10，替换为0，否则替换为10</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>裁剪</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t.clip(<span class=\"number\">10</span>,<span class=\"number\">18</span>)\t<span class=\"comment\">#小于10的替换为10，大于18的替换为18</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2 = t2.astype(float)</span><br><span class=\"line\">t2[<span class=\"number\">3</span>,<span class=\"number\">3</span>] = np.nan</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-9-拼接数组\"><a href=\"#2-9-拼接数组\" class=\"headerlink\" title=\"2.9 拼接数组\"></a>2.9 拼接数组</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.vstack(t1,t2)\t<span class=\"comment\">#竖直拼接</span></span><br><span class=\"line\">np.hstack(t1,t2)\t<span class=\"comment\">#水平拼接</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"2-10-行列交换\"><a href=\"#2-10-行列交换\" class=\"headerlink\" title=\"2.10 行列交换\"></a>2.10 行列交换</h2><p>行交换：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t[[<span class=\"number\">1</span>,<span class=\"number\">2</span>],:] = t[[<span class=\"number\">2</span>,<span class=\"number\">1</span>],:]</span><br></pre></td></tr></table></figure>\n\n<p>列交换：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t[:,[<span class=\"number\">0</span>,<span class=\"number\">2</span>]] = t[:,[<span class=\"number\">2</span>,<span class=\"number\">0</span>]]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-11-其他方法\"><a href=\"#2-11-其他方法\" class=\"headerlink\" title=\"2.11 其他方法\"></a>2.11 其他方法</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取最大最小值</span></span><br><span class=\"line\">np.argmax(t,axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">np.argmin(t,axis=<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#创建一个全0的数组</span></span><br><span class=\"line\">np.zeros((<span class=\"number\">3</span>,<span class=\"number\">4</span>))</span><br><span class=\"line\"><span class=\"comment\">#创建全1数组</span></span><br><span class=\"line\">np.ones((<span class=\"number\">3</span>,<span class=\"number\">4</span>))</span><br><span class=\"line\"><span class=\"comment\">#创建一个对角线为1的正方形数组（方阵）</span></span><br><span class=\"line\">np.eye(<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-12-生成随机数\"><a href=\"#2-12-生成随机数\" class=\"headerlink\" title=\"2.12 生成随机数\"></a>2.12 生成随机数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.random.rand(3,4)\t#均匀分布</span><br><span class=\"line\">np.random.randn(3,4)\t#标准正太分布的随机数，平均数为0，标准差为1</span><br><span class=\"line\">np.random.randint(low,high,(shape))\t#产生[low,high)之间的数</span><br></pre></td></tr></table></figure>\n\n<p>种子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.random.seed(<span class=\"number\">10</span>)</span><br><span class=\"line\">t = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">20</span>,(<span class=\"number\">3</span>,<span class=\"number\">4</span>))\t<span class=\"comment\">#每次随机的结果相同</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-13-copy和view\"><a href=\"#2-13-copy和view\" class=\"headerlink\" title=\"2.13 copy和view\"></a>2.13 copy和view</h2><ol>\n<li>a=b完全不复制，a和b相互影响。</li>\n<li>a = b[:]，视图操作，创建新对象a，但a的数据完全由b保管，两者数据变化一致。</li>\n<li>a = b.copy()复制，a和b互不影响。</li>\n</ol>\n<h2 id=\"2-14-nan和inf\"><a href=\"#2-14-nan和inf\" class=\"headerlink\" title=\"2.14 nan和inf\"></a>2.14 nan和inf</h2><p>nan(NAN,Nan)：not a number表示不是一个数字</p>\n<p>inf(-inf,inf)：infinity，正无穷，-inf表示负无穷</p>\n<p>一个数字除以0，python中会报错，numpy中是一个inf</p>\n<p><strong>nan：</strong></p>\n<ol>\n<li>两个nan不相等</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.nan !=np.nan</span><br><span class=\"line\"><span class=\"comment\">#True</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>计算nan个数</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.count_nonzero(t2!=t2)\t<span class=\"comment\">#t2!=t2，得到新矩阵，每个位置是bool类型，true表示该位置是nan</span></span><br><span class=\"line\">np.count_nonzero(np.isnan(t2))\t<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>计算矩阵和</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.sum(t3)</span><br><span class=\"line\">np.sum(t3, axis=<span class=\"number\">0</span>)\t<span class=\"comment\">#数组元素个数，与列数相同。，计算对应列上的和</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-15-常用统计函数\"><a href=\"#2-15-常用统计函数\" class=\"headerlink\" title=\"2.15 常用统计函数\"></a>2.15 常用统计函数</h2><p>求和：t.sum(axis=0)</p>\n<p>均值：t.mean(axis=0)</p>\n<p>中值：t.median(axis)</p>\n<p>最大值：t.max</p>\n<p>最小值:t.min</p>\n<p>极值：np.ptp(t,axis=None)    最大值和最小值之差</p>\n<p>标准差：t.std(axis=None)</p>\n<p><strong>默认返回多维数组的全部统计结果</strong></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：综述\"><a href=\"#1：综述\" class=\"headerlink\" title=\"1：综述\"></a>1：综述</h1><p><strong>为什么学习数据分析</strong></p>\n<ol>\n<li>岗位需求</li>\n<li>python数据科学的基础</li>\n<li>机器学习的课程基础</li>\n</ol>\n<p><strong>什么是数据分析</strong></p>\n<p>用适当的方法对收集的大量数据进行分析</p>\n<p>帮助人们做出判断，以便采取适当的行动</p>\n<p><strong>jupyter notebook：</strong></p>\n<p>Python笔记软件</p>\n<h1 id=\"2：Matplotlib\"><a href=\"#2：Matplotlib\" class=\"headerlink\" title=\"2：Matplotlib\"></a>2：Matplotlib</h1><ol>\n<li><p>将数据<strong>可视化</strong>，更<strong>直观</strong>的呈现</p>\n</li>\n<li><p>使数据更加<strong>客观</strong>、更具<strong>说服力</strong></p>\n</li>\n</ol>\n<p>最流行的python底层绘图库，主要做数据可视化，模仿matlab构建</p>\n<p><img src=\"https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> pyplot <span class=\"keyword\">as</span> plt\t<span class=\"comment\">#导入pyplot</span></span><br><span class=\"line\"></span><br><span class=\"line\">x = range(<span class=\"number\">2</span>,<span class=\"number\">26</span>,<span class=\"number\">2</span>)\t<span class=\"comment\">#数据在x轴的位置，是一个可迭代的对</span></span><br><span class=\"line\">y = [<span class=\"number\">15</span>,<span class=\"number\">13</span>,<span class=\"number\">14</span>,<span class=\"number\">17</span>,<span class=\"number\">20</span>,<span class=\"number\">25</span>,<span class=\"number\">26</span>,<span class=\"number\">26</span>,<span class=\"number\">25</span>,<span class=\"number\">22</span>,<span class=\"number\">18</span>,<span class=\"number\">15</span>]\t<span class=\"comment\">#数据在y轴的位置，是一个可迭代的对象</span></span><br><span class=\"line\">plt.plot(x,y)\t<span class=\"comment\">#传入x和y，通过plot绘制出折线图</span></span><br><span class=\"line\">plt.show()\t<span class=\"comment\">#执行程序的时候展现图像</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>目前存在的问题：</strong></p>\n<ol>\n<li>图片大小</li>\n<li>保存到本地</li>\n<li>描述信息，比如x，y轴表示什么</li>\n<li>刻度</li>\n<li>线条样式</li>\n<li>标记特殊点</li>\n</ol>\n<h2 id=\"2-1-设置图片大小-figure\"><a href=\"#2-1-设置图片大小-figure\" class=\"headerlink\" title=\"2.1 设置图片大小-figure\"></a>2.1 设置图片大小-figure</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fig = plt.figure(figsize=(<span class=\"number\">20</span>,<span class=\"number\">8</span>),dpi=<span class=\"number\">80</span>)</span><br><span class=\"line\"><span class=\"comment\">#figure图形图标的意思，这里指画的图</span></span><br><span class=\"line\"><span class=\"comment\">#通过实例化一个figure并且传入参数</span></span><br><span class=\"line\"><span class=\"comment\">#传入像素值，dpi，让图片更清晰</span></span><br><span class=\"line\">plt.plot(x,y)</span><br><span class=\"line\">plt.savefig(<span class=\"string\">&quot;./t1.png&quot;</span>)\t<span class=\"comment\">#保存图片</span></span><br><span class=\"line\"><span class=\"comment\">#可以保存为svg矢量图格式，放大不会失真</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-设置x，y轴步长-xticks-yticks\"><a href=\"#2-2-设置x，y轴步长-xticks-yticks\" class=\"headerlink\" title=\"2.2 设置x，y轴步长-xticks/yticks\"></a>2.2 设置x，y轴步长-xticks/yticks</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.xticks(x)\t<span class=\"comment\">#设置步长</span></span><br><span class=\"line\">plt.xticks(range(<span class=\"number\">2</span>,<span class=\"number\">25</span>))</span><br><span class=\"line\">_xticks_labels = [i/<span class=\"number\">2</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">4</span>,<span class=\"number\">49</span>)]</span><br><span class=\"line\">plt.xticks(_xticks_labels[::<span class=\"number\">3</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">plt.yticks(range(min(y),max(y)+<span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#显示字符串</span></span><br><span class=\"line\">_x = list(x)[::<span class=\"number\">3</span>]</span><br><span class=\"line\">_xticks_labels = [<span class=\"string\">&quot;10点&#123;&#125;分&quot;</span>.format(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">60</span>)]</span><br><span class=\"line\">_xticks_labels += [<span class=\"string\">&quot;11点&#123;&#125;分&quot;</span>.format(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">60</span>)]</span><br><span class=\"line\">plt.xticks(list(_x)[::<span class=\"number\">3</span>],_xticks_labels[::<span class=\"number\">3</span>],rotation=<span class=\"number\">90</span>)\t<span class=\"comment\">#,前为步长列表，，后为字符串列表，与步长列表一一对应，并把刻度旋转90度显示。</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>上述绘图，无法显示中文</strong></p>\n<h2 id=\"2-3-加入中文字体支持-FontProperties\"><a href=\"#2-3-加入中文字体支持-FontProperties\" class=\"headerlink\" title=\"2.3 加入中文字体支持-FontProperties\"></a>2.3 加入中文字体支持-FontProperties</h2><p>方法1：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> matplotlib</span><br><span class=\"line\">font = &#123;<span class=\"string\">&#x27;family&#x27;</span>:<span class=\"string\">&#x27;MicroSoft YaHei&#x27;</span>,</span><br><span class=\"line\">       <span class=\"string\">&#x27;weight&#x27;</span>:<span class=\"string\">&#x27;bold&#x27;</span>,</span><br><span class=\"line\">       <span class=\"string\">&#x27;size&#x27;</span>:<span class=\"string\">&#x27;larger&#x27;</span>&#125;</span><br><span class=\"line\">matplotlib.rc(<span class=\"string\">&quot;font&quot;</span>,**font)\t<span class=\"comment\">#**可以把字典转为xx=xx格式</span></span><br><span class=\"line\">matplotlib.rc(<span class=\"string\">&quot;font&quot;</span>,family=<span class=\"string\">&#x27;MicroSoft YaHei&#x27;</span>,weight=<span class=\"string\">&#x27;bold&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>方法2：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> font_manager</span><br><span class=\"line\">my_font = font_manager.FontProperties(fname=<span class=\"string\">&quot;/System/Library/Fonts/PingFang.ttc&quot;</span>)\t<span class=\"comment\">#设定字体位置</span></span><br><span class=\"line\"><span class=\"comment\">#查找系统字体存放位置</span></span><br><span class=\"line\">plt.xticks(list(_x)[::<span class=\"number\">3</span>],_xticks_labels[::<span class=\"number\">3</span>],rotation=<span class=\"number\">90</span>,fontproperties=my_font)</span><br><span class=\"line\"><span class=\"comment\">#使用字体</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-加入描述信息-xlabel-ylabel-title\"><a href=\"#2-4-加入描述信息-xlabel-ylabel-title\" class=\"headerlink\" title=\"2.4 加入描述信息-xlabel/ylabel/title\"></a>2.4 加入描述信息-xlabel/ylabel/title</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.xlabel(<span class=\"string\">&quot;时间&quot;</span>,fontproperties=my_font)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&quot;温度 单位（℃）&quot;</span>,fontproperties=my_font)</span><br><span class=\"line\">plt.title(<span class=\"string\">&quot;10点到12点的请问变化&quot;</span>,fontproperties=my_font)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-设置网格-grid\"><a href=\"#2-5-设置网格-grid\" class=\"headerlink\" title=\"2.5 设置网格-grid\"></a>2.5 设置网格-grid</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.grid()</span><br><span class=\"line\">plt.grid(alpha=<span class=\"number\">0.4</span>)\t<span class=\"comment\">#设置网格透明度，1不透明，0透明</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-绘制两个图形-legend\"><a href=\"#2-6-绘制两个图形-legend\" class=\"headerlink\" title=\"2.6 绘制两个图形-legend\"></a>2.6 绘制两个图形-legend</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.plot(x,y1,label=<span class=\"string\">&quot;自己&quot;</span>,color=<span class=\"string\">&quot;orange&quot;</span>,linestyle=<span class=\"string\">&quot;:&quot;</span>)</span><br><span class=\"line\">plt.plot(x,y2,label=<span class=\"string\">&quot;同桌&quot;</span>,color=<span class=\"string\">&quot;r&quot;</span>,linestyle=<span class=\"string\">&quot;--&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加图例，解释哪个线表示哪个数据集，显示中文，格式不再是FontProperties</span></span><br><span class=\"line\"><span class=\"comment\">#prop字体，loc位置：0最好的位置，不设置参数则默认0</span></span><br><span class=\"line\">plt.legend(prop=my_font,loc=<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>color=’r’    颜色</p>\n<p>linestyle=’–’    线条风格：-实线；–虚线；-.点划线；:点虚线；留空或空格，表示无线条</p>\n<p>linewidth=5    线粗细</p>\n<p>alpha=0.4    透明度</p>\n</blockquote>\n<h2 id=\"2-7-绘制散点图-scatter\"><a href=\"#2-7-绘制散点图-scatter\" class=\"headerlink\" title=\"2.7 绘制散点图-scatter\"></a>2.7 绘制散点图-scatter</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.scatter(x, y)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-绘制柱状图-bar\"><a href=\"#2-8-绘制柱状图-bar\" class=\"headerlink\" title=\"2.8 绘制柱状图-bar\"></a>2.8 绘制柱状图-bar</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#绘制电影与其对应票房</span></span><br><span class=\"line\">a=[<span class=\"string\">&quot;战狼2&quot;</span>,<span class=\"string\">&quot;速度与激情8&quot;</span>,<span class=\"string\">&quot;功夫瑜伽&quot;</span>,<span class=\"string\">&quot;西游附魔篇&quot;</span>]</span><br><span class=\"line\">b=[<span class=\"number\">56</span>,<span class=\"number\">61</span>,<span class=\"number\">26</span>,<span class=\"number\">94</span>]</span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">20</span>,<span class=\"number\">15</span>),dpi=<span class=\"number\">80</span>)</span><br><span class=\"line\"><span class=\"comment\">#绘制柱状图</span></span><br><span class=\"line\">plt.bar(range(a),b,width=<span class=\"number\">0.3</span>)</span><br><span class=\"line\"><span class=\"comment\">#设置横轴字符串</span></span><br><span class=\"line\">plt.xticks(range(a),a,rotation=<span class=\"number\">45</span>)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-9-绘制条形图-barh\"><a href=\"#2-9-绘制条形图-barh\" class=\"headerlink\" title=\"2.9 绘制条形图-barh\"></a>2.9 绘制条形图-barh</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.barh(range(len(a)),b,height=<span class=\"number\">0.3</span>,color=<span class=\"string\">&#x27;orange&#x27;</span>)</span><br><span class=\"line\">plt.yticks(range(len(a)),a)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png\"></p>\n<h2 id=\"2-10-绘制直方图-hist\"><a href=\"#2-10-绘制直方图-hist\" class=\"headerlink\" title=\"2.10 绘制直方图-hist\"></a>2.10 绘制直方图-hist</h2><p>有250部电影的时长，统计时长分布的数量，比如100到120分钟的电影数。</p>\n<p>组数=极差/组距。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">120</span>,<span class=\"number\">76</span>,<span class=\"number\">124</span>,<span class=\"number\">161</span>……]\t<span class=\"comment\">#250部电影的时长。</span></span><br><span class=\"line\"><span class=\"comment\">#计算组数</span></span><br><span class=\"line\">theory_d = <span class=\"number\">3</span>\t<span class=\"comment\">#假定组距</span></span><br><span class=\"line\">num_bins = (max(a)-min(a))//d\t<span class=\"comment\">#计算组数</span></span><br><span class=\"line\"></span><br><span class=\"line\">plt.figure(figsize = (<span class=\"number\">20</span>,<span class=\"number\">8</span>),dpi=<span class=\"number\">80</span>)</span><br><span class=\"line\">plt.hist(a,num_bins)\t<span class=\"comment\">#频数分布直方图</span></span><br><span class=\"line\">plt.hist(a,num_bins,normed=<span class=\"literal\">True</span>)\t<span class=\"comment\">#频率分布直方图</span></span><br><span class=\"line\"><span class=\"comment\">#设置x刻度</span></span><br><span class=\"line\">plt.xticks(range(min(a),max(a)+d,d))</span><br><span class=\"line\">plt.grid()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当（最大值-最小值）/假定组距 无法除尽时，根据假定组距绘制的x刻度会偏移。</p>\n</blockquote>\n<p>2.11 绘制其他图形</p>\n<p><a href=\"https://matplotlib.org/gallery/index.html\">https://matplotlib.org/gallery/index.html</a></p>\n<p>前端画图库js——echarts：</p>\n<p><a href=\"https://echarts.apache.org/examples/zh/index.html\">https://echarts.apache.org/examples/zh/index.html</a></p>\n<p>图表代码托管——Plotly:<br><a href=\"https://plot.ly/python\">https://plot.ly/python</a></p>\n<h1 id=\"2：Numpy\"><a href=\"#2：Numpy\" class=\"headerlink\" title=\"2：Numpy\"></a>2：Numpy</h1><p><strong>什么时numpy？</strong></p>\n<p>一个再python中做科学计算的基础库，重在数值计算，也是大部分python科学计算库的基础库，多用于在大型、多维数组上执行数值计算。</p>\n<h2 id=\"2-1-创建数组：\"><a href=\"#2-1-创建数组：\" class=\"headerlink\" title=\"2.1 创建数组：\"></a>2.1 创建数组：</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">a = np.array([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>])</span><br><span class=\"line\">b = np.array(range(<span class=\"number\">10</span>))</span><br><span class=\"line\">c = np.arange(<span class=\"number\">10</span>)\t<span class=\"comment\">#作用与b的表达式相同</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(type(a))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>结果：</p>\n<p>[1 2 3]</p>\n<p>&lt;class ‘nmpy.ndarray’&gt;</p>\n</blockquote>\n<h2 id=\"2-2-数据类型\"><a href=\"#2-2-数据类型\" class=\"headerlink\" title=\"2.2 数据类型\"></a>2.2 数据类型</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d = np.array(range(<span class=\"number\">1</span>,<span class=\"number\">4</span>),dtype=<span class=\"string\">&quot;float32&quot;</span>)\t<span class=\"comment\">#dtype指定数组中数据的数据类型</span></span><br><span class=\"line\">e = np.array([<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">1</span>],dtype=bool)</span><br><span class=\"line\">print(e.dtype)\t<span class=\"comment\">#打印数组中数据的数据类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#调整数据类型</span></span><br><span class=\"line\">f = d.astype(<span class=\"string\">&quot;int8&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>修改浮点型的小数位数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a &#x3D; np.array(random.random() for i in range(10))</span><br><span class=\"line\">np.round(a,2)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-数组形状\"><a href=\"#2-3-数组形状\" class=\"headerlink\" title=\"2.3 数组形状\"></a>2.3 数组形状</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1 = np.array([[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>],[<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>]])</span><br><span class=\"line\">t1.shape\t</span><br><span class=\"line\"><span class=\"comment\">#out:(2,3)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>数组的形状</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2 = np.arange(<span class=\"number\">12</span>)\t<span class=\"comment\">#新建一维数组</span></span><br><span class=\"line\">t3 = t2.reshape(<span class=\"number\">3</span>,<span class=\"number\">4</span>)\t<span class=\"comment\">#变为二维的</span></span><br><span class=\"line\">t4 = t2.reshape(<span class=\"number\">24</span>,)\t<span class=\"comment\">#变一维数组</span></span><br><span class=\"line\">t5 = t2.flatten()\t<span class=\"comment\">#变一维数组</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-数组计算\"><a href=\"#2-4-数组计算\" class=\"headerlink\" title=\"2.4 数组计算\"></a>2.4 数组计算</h2><p><strong>数组和数</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t6 = np.arange(<span class=\"number\">24</span>)</span><br><span class=\"line\">t7 = t6.reshape(<span class=\"number\">4</span>,<span class=\"number\">6</span>)</span><br><span class=\"line\">t7+<span class=\"number\">2</span>\t<span class=\"comment\">#数组中每个数都加2</span></span><br><span class=\"line\">t7*<span class=\"number\">2</span>\t<span class=\"comment\">#每个数都乘2</span></span><br><span class=\"line\">t7/<span class=\"number\">2</span>\t<span class=\"comment\">#每个数都除2，会得到浮点数</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>数组和数组</strong></p>\n<p>形状相同：(4,6)与(4,6)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t8 = np.arange(<span class=\"number\">100</span>,<span class=\"number\">124</span>).reshape(<span class=\"number\">4</span>,<span class=\"number\">6</span>)</span><br><span class=\"line\">t7+t8\t<span class=\"comment\">#形状相同，行列相同的数值进行运算</span></span><br><span class=\"line\">t7*t8</span><br></pre></td></tr></table></figure>\n\n<p>(4,6)与(,6)</p>\n<p><img src=\"https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png\"></p>\n<p>(4,6)与(4,1)</p>\n<p><img src=\"https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png\"></p>\n<p><strong>广播原则：</strong></p>\n<p>如果两个数组的后缘维度，即从末尾开始算起的维度的轴长度相符或其中一方的长度为1，则认为他们是广播兼容的。广播会在缺失和或长度为1的维度上进行</p>\n<h2 id=\"2-5-读取数据\"><a href=\"#2-5-读取数据\" class=\"headerlink\" title=\"2.5 读取数据\"></a>2.5 读取数据</h2><p><strong>轴</strong></p>\n<p>一维数组只有一个轴，即0轴</p>\n<p>二维数组有两个轴，0和1轴。(2,5)，2是0轴长度，5是1轴长度</p>\n<p>三维数组有三个轴，0，1，2轴</p>\n<p><strong>读取数据</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.loadtxt(frame,dtype=np.float,delimiter=<span class=\"literal\">None</span>,skiprows=<span class=\"number\">0</span>,usecols=<span class=\"literal\">None</span>,unpack=<span class=\"literal\">False</span>)</span><br></pre></td></tr></table></figure>\n\n<p>frame：文件、字符串或产生器</p>\n<p>dtype：数据类型</p>\n<p>dlimiter：分割字符串，默认是空格</p>\n<p>skiprows：跳过前x行</p>\n<p>usecols：读取指定的列</p>\n<p>unpack：True表示，读入属性将分别写入不同的数组变量，False 读入数据只写入一个数组变量，默认False。<strong>转置效果</strong>。</p>\n<p>读取的文件内容格式：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1241,1241,15346,2451</span><br><span class=\"line\">125415,235,4135,1351</span><br><span class=\"line\">12516,15326,1361,616</span><br><span class=\"line\">……</span><br></pre></td></tr></table></figure>\n\n<p>读取时可以按<code>,</code>分割。按行划分</p>\n<h2 id=\"2-6-矩阵转置\"><a href=\"#2-6-矩阵转置\" class=\"headerlink\" title=\"2.6 矩阵转置\"></a>2.6 矩阵转置</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2.transpose()</span><br><span class=\"line\">t2.T</span><br><span class=\"line\">t2.swapaxes(<span class=\"number\">1</span>,<span class=\"number\">0</span>)\t<span class=\"comment\">#交换轴，也能实现转置效果</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-索引和切片\"><a href=\"#2-7-索引和切片\" class=\"headerlink\" title=\"2.7 索引和切片\"></a>2.7 索引和切片</h2><p>取第二行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">2</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取连续的多行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">2</span>:]</span><br></pre></td></tr></table></figure>\n\n<p>取不连续的多行：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[[<span class=\"number\">2</span>,<span class=\"number\">8</span>,<span class=\"number\">10</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>取第一列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[:,<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取连续多列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[:,<span class=\"number\">2</span>:]</span><br></pre></td></tr></table></figure>\n\n<p>取不连续的多列：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[:,[<span class=\"number\">0</span>,<span class=\"number\">2</span>,<span class=\"number\">5</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>取3行四列的值：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取多行多列：3行到5行，2列到4列，因为<code>:</code>左右是左闭右开区间，行数为索引+1</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[<span class=\"number\">2</span>:<span class=\"number\">5</span>,<span class=\"number\">1</span>:<span class=\"number\">4</span>]</span><br></pre></td></tr></table></figure>\n\n<p>取多个不连续的点：(0,0)  (2,1)  (5,5)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2[[0,2,5],[0,1,5]]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-修改数值\"><a href=\"#2-8-修改数值\" class=\"headerlink\" title=\"2.8 修改数值\"></a>2.8 修改数值</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t[:,<span class=\"number\">2</span>:<span class=\"number\">4</span>] = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>布尔索引</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2&lt;<span class=\"number\">10</span>\t<span class=\"comment\">#相同的矩阵，矩阵值为布尔类型，对应位置满足值小于10，则为1，否则为0</span></span><br><span class=\"line\">t2[t2&lt;<span class=\"number\">10</span>] = <span class=\"number\">3</span>\t<span class=\"comment\">#t2中小于10的位置，赋值为3</span></span><br><span class=\"line\">t2[t2&lt;<span class=\"number\">10</span>]\t<span class=\"comment\">#取t2中小于10的数组成新矩阵</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>三元运算符</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.where(t&lt;<span class=\"number\">10</span>,<span class=\"number\">0</span>,<span class=\"number\">10</span>)\t<span class=\"comment\">#如果小于10，替换为0，否则替换为10</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>裁剪</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t.clip(<span class=\"number\">10</span>,<span class=\"number\">18</span>)\t<span class=\"comment\">#小于10的替换为10，大于18的替换为18</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t2 = t2.astype(float)</span><br><span class=\"line\">t2[<span class=\"number\">3</span>,<span class=\"number\">3</span>] = np.nan</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-9-拼接数组\"><a href=\"#2-9-拼接数组\" class=\"headerlink\" title=\"2.9 拼接数组\"></a>2.9 拼接数组</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.vstack(t1,t2)\t<span class=\"comment\">#竖直拼接</span></span><br><span class=\"line\">np.hstack(t1,t2)\t<span class=\"comment\">#水平拼接</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png\"></p>\n<h2 id=\"2-10-行列交换\"><a href=\"#2-10-行列交换\" class=\"headerlink\" title=\"2.10 行列交换\"></a>2.10 行列交换</h2><p>行交换：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t[[<span class=\"number\">1</span>,<span class=\"number\">2</span>],:] = t[[<span class=\"number\">2</span>,<span class=\"number\">1</span>],:]</span><br></pre></td></tr></table></figure>\n\n<p>列交换：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t[:,[<span class=\"number\">0</span>,<span class=\"number\">2</span>]] = t[:,[<span class=\"number\">2</span>,<span class=\"number\">0</span>]]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-11-其他方法\"><a href=\"#2-11-其他方法\" class=\"headerlink\" title=\"2.11 其他方法\"></a>2.11 其他方法</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取最大最小值</span></span><br><span class=\"line\">np.argmax(t,axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">np.argmin(t,axis=<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#创建一个全0的数组</span></span><br><span class=\"line\">np.zeros((<span class=\"number\">3</span>,<span class=\"number\">4</span>))</span><br><span class=\"line\"><span class=\"comment\">#创建全1数组</span></span><br><span class=\"line\">np.ones((<span class=\"number\">3</span>,<span class=\"number\">4</span>))</span><br><span class=\"line\"><span class=\"comment\">#创建一个对角线为1的正方形数组（方阵）</span></span><br><span class=\"line\">np.eye(<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-12-生成随机数\"><a href=\"#2-12-生成随机数\" class=\"headerlink\" title=\"2.12 生成随机数\"></a>2.12 生成随机数</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.random.rand(3,4)\t#均匀分布</span><br><span class=\"line\">np.random.randn(3,4)\t#标准正太分布的随机数，平均数为0，标准差为1</span><br><span class=\"line\">np.random.randint(low,high,(shape))\t#产生[low,high)之间的数</span><br></pre></td></tr></table></figure>\n\n<p>种子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.random.seed(<span class=\"number\">10</span>)</span><br><span class=\"line\">t = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">20</span>,(<span class=\"number\">3</span>,<span class=\"number\">4</span>))\t<span class=\"comment\">#每次随机的结果相同</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-13-copy和view\"><a href=\"#2-13-copy和view\" class=\"headerlink\" title=\"2.13 copy和view\"></a>2.13 copy和view</h2><ol>\n<li>a=b完全不复制，a和b相互影响。</li>\n<li>a = b[:]，视图操作，创建新对象a，但a的数据完全由b保管，两者数据变化一致。</li>\n<li>a = b.copy()复制，a和b互不影响。</li>\n</ol>\n<h2 id=\"2-14-nan和inf\"><a href=\"#2-14-nan和inf\" class=\"headerlink\" title=\"2.14 nan和inf\"></a>2.14 nan和inf</h2><p>nan(NAN,Nan)：not a number表示不是一个数字</p>\n<p>inf(-inf,inf)：infinity，正无穷，-inf表示负无穷</p>\n<p>一个数字除以0，python中会报错，numpy中是一个inf</p>\n<p><strong>nan：</strong></p>\n<ol>\n<li>两个nan不相等</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.nan !=np.nan</span><br><span class=\"line\"><span class=\"comment\">#True</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>计算nan个数</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.count_nonzero(t2!=t2)\t<span class=\"comment\">#t2!=t2，得到新矩阵，每个位置是bool类型，true表示该位置是nan</span></span><br><span class=\"line\">np.count_nonzero(np.isnan(t2))\t<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>计算矩阵和</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.sum(t3)</span><br><span class=\"line\">np.sum(t3, axis=<span class=\"number\">0</span>)\t<span class=\"comment\">#数组元素个数，与列数相同。，计算对应列上的和</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-15-常用统计函数\"><a href=\"#2-15-常用统计函数\" class=\"headerlink\" title=\"2.15 常用统计函数\"></a>2.15 常用统计函数</h2><p>求和：t.sum(axis=0)</p>\n<p>均值：t.mean(axis=0)</p>\n<p>中值：t.median(axis)</p>\n<p>最大值：t.max</p>\n<p>最小值:t.min</p>\n<p>极值：np.ptp(t,axis=None)    最大值和最小值之差</p>\n<p>标准差：t.std(axis=None)</p>\n<p><strong>默认返回多维数组的全部统计结果</strong></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png","popularPost_tmp_gaData":{"updated":"Tue Oct 13 2020 23:14:00 GMT+0200 (GMT+02:00)","title":"Python数据分析","path":"2020/09/29/Python数据分析/","eyeCatchImage":"https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-29T15:56:45.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-29T15:56:45.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Python","tags":["Pandas","Matplotlib","Numpy"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Rclone在win上挂在Onedrive","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-22T18:07:26.000Z","password":null,"summary":"Windows自带的Onedrive同步上传速度非常慢，与Oneindex配合使用效果并不理想。为了提高同步速度，实现文件及时上传、下载和删除。使用Github上的开源项目Rclone，将Onedrive挂载到Windows系统上。","_content":"\n## 一：Rclone下载\n\n首先下载适用于 Windows 的 rclone 👇\n\n官网下载：https://rclone.org/downloads/\nGitHub下载：https://github.com/ncw/rclone\n\n在[rclone官网](https://rclone.org/downloads/)中，Windows 平台下选择下载 AMD64 - 64 Bit\n\n![](https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png)\n\n或者在[github](https://github.com/rclone/rclone/releases)下载。\n\n![](https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png)\n\n下载后解压到一个英文路径中。\n\n![](https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png)\n\n另外在Windows平台使用rclone还需要另一个依赖工具`winfsp`，下载地址：http://www.secfs.net/winfsp/download/ ，下载后一路安装即可。\n\n![](https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png)\n\n## 二： 配置环境变量\n\n1. 在电脑桌面右键点击“此电脑”的“属性”选项\n2. 选择“高级系统设置”选项\n3. 在系统变量中找到path，新建添加刚才解压后的路径\n\n![](https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png)\n\n检查环境变量是否配置成功。\n\n按`win`+`X`，然后按`A` 打开 `powershell` ，当然也可以去打开 `cmd` ，输入`rclone --version`，如果出现下面的输出则安装成功，否则检查上面步骤的环境变量是否配置正确。\n\n## 三：配置Rclone\n\n在终端中依次输入以下命令行，请根据我下的步骤进操作。\n\n下载\n```powershell\nPS C:\\WINDOWS\\system32> rclone config                // 第一步在终端输入 rclone config\n2020/06/22 19:36:22 NOTICE: Config file \"C:\\\\Users\\\\12412\\\\.config\\\\rclone\\\\rclone.conf\" not found - using defaults\nNo remotes found - make a new one\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q> n                                  //第二步输入n创建新的配置， \nname> Onedrive_local                      //第三步 输入一个英文名称 ，中间也不要有空格\nType of storage to configure.\nEnter a string value. Press Enter for the default (\"\").\nChoose a number from below, or type in your own value\n 1 / 1Fichier\n   \\ \"fichier\"\n 2 / Alias for an existing remote\n   \\ \"alias\"\n 3 / Amazon Drive\n   \\ \"amazon cloud drive\"\n 4 / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)\n   \\ \"s3\"\n 5 / Backblaze B2\n   \\ \"b2\"\n 6 / Box\n   \\ \"box\"\n 7 / Cache a remote\n   \\ \"cache\"\n 8 / Citrix Sharefile\n   \\ \"sharefile\"\n 9 / Dropbox\n   \\ \"dropbox\"\n10 / Encrypt/Decrypt a remote\n   \\ \"crypt\"\n11 / FTP Connection\n   \\ \"ftp\"\n12 / Google Cloud Storage (this is not Google Drive)\n   \\ \"google cloud storage\"\n13 / Google Drive\n   \\ \"drive\"\n14 / Google Photos\n   \\ \"google photos\"\n15 / Hubic\n   \\ \"hubic\"\n16 / In memory object storage system.\n   \\ \"memory\"\n17 / Jottacloud\n   \\ \"jottacloud\"\n18 / Koofr\n   \\ \"koofr\"\n19 / Local Disk\n   \\ \"local\"\n20 / Mail.ru Cloud\n   \\ \"mailru\"\n21 / Mega\n   \\ \"mega\"\n22 / Microsoft Azure Blob Storage\n   \\ \"azureblob\"\n23 / Microsoft OneDrive\n   \\ \"onedrive\"\n24 / OpenDrive\n   \\ \"opendrive\"\n25 / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)\n   \\ \"swift\"\n26 / Pcloud\n   \\ \"pcloud\"\n27 / Put.io\n   \\ \"putio\"\n28 / QingCloud Object Storage\n   \\ \"qingstor\"\n29 / SSH/SFTP Connection\n   \\ \"sftp\"\n30 / Sugarsync\n   \\ \"sugarsync\"\n31 / Tardigrade Decentralized Cloud Storage\n   \\ \"tardigrade\"\n32 / Transparently chunk/split large files\n   \\ \"chunker\"\n33 / Union merges the contents of several upstream fs\n   \\ \"union\"\n34 / Webdav\n   \\ \"webdav\"\n35 / Yandex Disk\n   \\ \"yandex\"\n36 / http Connection\n   \\ \"http\"\n37 / premiumize.me\n   \\ \"premiumizeme\"\n38 / seafile\n   \\ \"seafile\"\nStorage> 23                 //第四步 输入要配置的网盘类型 因为我们要配置Microsoft OneDrive 因此输入23\n** See help for onedrive backend at: https://rclone.org/onedrive/ **\n\nMicrosoft App Client Id\nLeave blank normally.\nEnter a string value. Press Enter for the default (\"\").\nclient_id>                //第五步 直接回车\nMicrosoft App Client Secret\nLeave blank normally.\nEnter a string value. Press Enter for the default (\"\").\nclient_secret>            //第六步 直接回车 \nEdit advanced config? (y/n)\ny) Yes\nn) No (default)\ny/n> n                   //第七步 输入n 不进行高级配置 \nRemote config\nUse auto config?\n * Say Y if not sure\n * Say N if you are working on a remote or headless machine\ny) Yes (default)\nn) No\ny/n> y                  //第八步 输入y 使用自动配置授权\nIf your browser doesn't open automatically go to the following link: http://127.0.0.1:53682/auth?state=DWKiZ1cLZoWl9buxJbPXgw\nLog in and authorize rclone for access\nWaiting for code...\nGot code\nChoose a number from below, or type in an existing value\n 1 / OneDrive Personal or Business\n   \\ \"onedrive\"\n 2 / Root Sharepoint site\n   \\ \"sharepoint\"\n 3 / Type in driveID\n   \\ \"driveid\"\n 4 / Type in SiteID\n   \\ \"siteid\"\n 5 / Search a Sharepoint site\n   \\ \"search\"\nYour choice> 1              //第九步 输入1 因为现在我配置的是 OneDrive Personal or Business 类型的网盘\nFound 1 drives, please select the one you want to use:\n0:  (personal) id=58719e3298535c9\nChose drive to use:> 0     //第十步 输入0\nFound drive 'root' of type 'personal', URL: https://onedrive.live.com/?cid=058719e3298535c9\nIs that okay?\ny) Yes (default)\nn) No                    //第十一步 直接回车\ny/n>\n--------------------\n[Onedrive_local]\ntype = onedrive\ntoken = {\"access_token\":\"BAAUO9chh8cJscQLmU+LSWpbnr0vmwwAAZ6th5X8qdv3jqko0KCKeFVHdJigXdmpkGf3aO/W9HQahNAmDTxEVF2TnPtPNCw7M/me6FRz4mD9+x/jfJIb8Qewi8NpYMfYXdmPyUUVcPp1G+bwKOIFfJlNa6Can21gaGhTKgdEaz27GwetIvwjy7Qo/eDh/jarwoHEKljM8fN3UF1xz/RS0Ir+DC6CrvNIP3MUpbBF31/qUWJekWn3XqdT1j6m9bBfJ9Xk8heaY1/MT+1SA6fs6IPV5mO5m6dtjfsr1wO3xLGuaEutBPlNT9t219R55MZibwt746mw+VRTMCLsMrFZqVGK6IHzXyG3t+5NOrdP9yelb0AVQDZgAACJVvxd1cmt0LOAKEWlmYeQi3Eo6NKs9l5Abb4AsL2V02tbQt3AheMGLOxpOfyWOUUNaqvFAdSWRGQU8JLgFOA0YWy+UtYHSBG8SIy40jFI5czeqFoCzXguNijP2eiE+JdJREz9fO0q947/QK0K4MxVBqQxmlD1RDujCtnIDsT5r1ICG2AN40wSWqGvanKyctRNPdEm0BjmTrmXh0qTinmJ+BBVe70AU3ZigEzfMULxP+i+vwI2rA7VbiAuXnDUE75t49RGBiCMS+p00x0smGI685pmbPYQoOcMuVLHVdIxSDCO+YLSgpaHaBrruIvFbhto0OczwvYKn8XXEIp0CM6XEy55UYTuLkJFRDWX9VB/mSHarvexYqtEi4EYK2nABm4KrngexH0IdyhdwDKx7gNnLcMP9YYXG0cybppINxx67jFxjQM8/TWQPAz4cADt/FfPPVvuVABOZdhKmpuScj6qOhWsCfh6KH385UiM2Z+Rn2t9hZaXt3ZRmu+W5XAx9+E1SnlewdTiH5/VwB8QhCuRvS89hK/51BeMz4cJ5R9dLEqjGDxZ0HHay52DDhQYta/yG0VN2pkWTg0+T7rVdXbgC607y47sWmqP540tigNZPc0AgrWK3TXFOAJAEAoV9Xg+QUhJKYQNnrtFWI9nKbSFVHEeg8vvl5efZviF2szVI4wProgIHpUydqfnMlR3vRZlei/rmGUC9IICjdNTKPWSGmilJdbdxHMUc/MDyfYhxJA69cwI=\",\"token_type\":\"Bearer\",\"refresh_token\":\"MCeVIl4QGaJb!yGdTF6FLD!8N7hR4D8Z1bV4mpta08v64kR!MLcolxhea*NOv24M5V!uqHzBvi5dSW9wVHXGqALSe9kML5HKxV12XougeYafX2dcdyxvZ*cYEa6D0l6hIzovUwFpVjv3lqiP66jpzY4KxYMtZqQHf5PN!VGJf52xDKcsIUseoKD98z7olU3E2kyaZqJW8j6o5dBTV!Lmo5DVc31VpGrfeUnwhOcZkO7xN7IUEy8Vs9YXKQ0C4cin4qpyDSQ3pLpwy09ZpVE2bKOt4XQP7JLWQa6iGQ*r8zgewRo7ULYoEpRXYsqSBdwX6pJEQnRzCDcJimHxXBEV59rE*Ykwc9SijTkBN4haK6br9y2YVQ2UKegfQiErCHY33kzmSMAPJUwiooUNc6GytUz5O6ZxsBMghhb6B6NiSBCs!U5xRon1y*zzOsh9EArHk4y2rihu7BkkC13bJqxeMvhw$\",\"expiry\":\"2020-06-22T20:38:09.8687266+08:00\"}\ndrive_id = 58719e3298825c9\ndrive_type = personal\n--------------------\ny) Yes this is OK (default)\ne) Edit this remote\nd) Delete this remote\ny/e/d>                   //第十二步 回车\nCurrent remotes:\n\nName                 Type\n====                 ====\nOnedrive_local       onedrive          //显示你的设置则成功！\n\ne) Edit existing remote\nn) New remote\nd) Delete remote\nr) Rename remote\nc) Copy remote\ns) Set configuration password\nq) Quit config\ne/n/d/r/c/s/q> q           //第十三步 输入q结束配置\n```\n\n## 四：挂载Onedrive到本地\n\n1. ~~自行下载安装git~~\n\n~~此时请使用 `git bash` 的终端执行以下命令，因为我使用`cmd` 和 `powershell` 都出现关闭终端后挂载程序退出、本地挂载的OneDrive退出的现象。 如果你的windows没有安装git ， 请[自行安装](https://www.baidu.com/s?wd=windows 安装git&ie=utf-8)。若你使用 `cmd` 的话 ，`cmd` 是不能退出的，要保持 `cmd` 不退出本地硬盘才一直挂载着。~~\n\n2. ~~桌面新建txt文本文件。编辑内容为：~~\n\n```powershell\nstart \"\" \"%ProgramFiles%\\Git\\git-bash.exe\" -c \"rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes &\"\n```\n\n~~`Onedrive_local` 替换为你自己前面设置的名称 。~~\n\n~~`Q:` 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。~~\n\n~~`C:\\Users\\97532\\Rclone` 为本地缓存目录，可自行设置 。~~\n\n~~上述代码，使用git bash程序执行rclone挂载磁盘的指令。cmd无法识别`&`，也就是退出程序继续挂载指令。~~\n\n3. ~~重命名txt文件为`rclone_startup.bat`~~\n4. ~~双击运行~~\n\n~~![image-20200622210455993](C:\\Users\\97532\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200622210455993.png)~~\n\n~~出现：`The service rclone has been started` 或者磁盘列表出现Onedrive，则说明挂载成功。~~\n\n5. ~~设置开机启动~~\n\n~~由于git程序在重启后会停止，需要将`rclone_startup.bat`移动到开机启动文件里，每次开机让磁盘自动挂载。~~\n\n~~将`rclone_startup.bat`放在`C:\\Users\\用户名\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup` 中~~\n\n~~![](https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png)237.png)~~\n\n~~现在试试重启电脑。。重启后需要等待十几秒，才会运行git bash程序挂载Onedrive。~~\n\n~~git bash运行后会有一闪而过的黑色窗口。此时磁盘应该挂载成功了~~。\n\n> 删掉上面的方法，是由于步骤太过冗杂，需要安装git bash，而且开机启动时存在一闪而过的黑色窗口，运行后的挂载盘也存在问题。\n\n------\n\n挂载操作在退出cmd后就自动结束了，所以我们需要让它后台运行。\nrclone虽然提供了`--daemon`参数来实行后台运行，但是该参数并不适合于windows环境中。会有如下提示：\n\n```\nλ rclone mount GDrive:/ x: --cache-dir F:\\Temp --vfs-cache-mode writes --daemon\n2018/05/01 09:54:19 background mode not supported on windows platform\n```\n\n所以，我们需要另外想个办法让rclone能够后端运行以及开机自动挂载。\n\n1. **新建一个文本文件。**\n\n填入以下内容，**请注意修改倒数第二行的`WS.Run`中相关命令为你上步成功执行的命令**，然后将该文件名改为`rclone.vbs` （后缀名为`.vbs`即可）\n\n```vbscript\nOption Explicit\nDim WMIService, Process, Processes, Flag, WS\nSet WMIService = GetObject(\"winmgmts:{impersonationlevel=impersonate}!\\\\.\\root\\cimv2\")\nSet Processes = WMIService.ExecQuery(\"select * from win32_process\")\nFlag = true\nfor each Process in Processes\n    if strcomp(Process.name, \"rclone.exe\") = 0 then\n        Flag = false\n        exit for\n    end if\nnext\nSet WMIService = nothing\nif Flag then\n    Set WS = Wscript.CreateObject(\"Wscript.Shell\")\n    WS.Run \"rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes\", 0\nend if\n```\n\n> `Onedrive_local` 替换为你自己前面设置的名称 。\n>\n> `Q:` 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。\n>\n> `C:\\Users\\97532\\Rclone` 为本地缓存目录，可自行设置 。\n>\n> 关于`vfs-cache-mode`项设置，还是建议看下官方的说明根据自己的需求和网络情况来进行选择 https://rclone.org/commands/rclone_mount/#file-caching 。这里只做简单说明：\n>\n> - `off`： 本地不做任何缓存，所有文件直接从云端获取并写入。**建议网速特别好时（复制粘贴大文件时建议至少100M管以上速度）使用。**\n> - `minimal`：（和off类似，但是已经打开的文件会被缓存到本地。**个人推荐，小文件基本够用，但是如果你的网络情况（梯子）不是特别好的话，用writes也行**\n> - `writes`：（如果文件属性为`只读`则只从云端获取，不然先缓存在本地进行读写操作，随后被同步。**个人推荐使用，但是在直接从本地复制文件到GDrive时还是看网络情况**\n> - `full`：（所有的读写操作都会缓存到磁盘中。然后才会同步。**不是很推荐。会导致所有文件均被缓存到本地。直到达到你缓存总额（--cache-total-chunk-size，默认大小10G）。但是你网速特别差时也可以使用。**\n\n如果你需要中断这个挂载操作，请直接在任务管理器中kill掉`rclone.exe`进程即可。\n\n2. **开机自启**\n\n将这个文件`rclone.vbs`复制（或者剪贴）到开机项中`C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp`（Windows 10）即可实现开机自动挂载~\n\n## 五：参考资料\n\n《[Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘](https://www.lifeee.top/posts/14654.html)》\n\n《[CMD打开Git Bash](https://blog.csdn.net/lilongsy/article/details/89916797)》\n\n《[Windows-如何从DOS命令行启动Git Bash？](http://www.itkeyword.com/doc/9018080391155886x507/how-to-launch-git-bash-from-dos-command-line)》\n\n《[使用rclone在Windows下挂载Google个人/团队云盘](https://blog.rhilip.info/archives/874/)》","source":"_posts/Rclone在win上挂在Onedrive.md","raw":"---\ntitle: Rclone在win上挂在Onedrive\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-22 20:07:26\npassword:\nsummary: Windows自带的Onedrive同步上传速度非常慢，与Oneindex配合使用效果并不理想。为了提高同步速度，实现文件及时上传、下载和删除。使用Github上的开源项目Rclone，将Onedrive挂载到Windows系统上。\ntags: Rclone\ncategories: Windows\n\n---\n\n## 一：Rclone下载\n\n首先下载适用于 Windows 的 rclone 👇\n\n官网下载：https://rclone.org/downloads/\nGitHub下载：https://github.com/ncw/rclone\n\n在[rclone官网](https://rclone.org/downloads/)中，Windows 平台下选择下载 AMD64 - 64 Bit\n\n![](https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png)\n\n或者在[github](https://github.com/rclone/rclone/releases)下载。\n\n![](https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png)\n\n下载后解压到一个英文路径中。\n\n![](https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png)\n\n另外在Windows平台使用rclone还需要另一个依赖工具`winfsp`，下载地址：http://www.secfs.net/winfsp/download/ ，下载后一路安装即可。\n\n![](https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png)\n\n## 二： 配置环境变量\n\n1. 在电脑桌面右键点击“此电脑”的“属性”选项\n2. 选择“高级系统设置”选项\n3. 在系统变量中找到path，新建添加刚才解压后的路径\n\n![](https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png)\n\n检查环境变量是否配置成功。\n\n按`win`+`X`，然后按`A` 打开 `powershell` ，当然也可以去打开 `cmd` ，输入`rclone --version`，如果出现下面的输出则安装成功，否则检查上面步骤的环境变量是否配置正确。\n\n## 三：配置Rclone\n\n在终端中依次输入以下命令行，请根据我下的步骤进操作。\n\n下载\n```powershell\nPS C:\\WINDOWS\\system32> rclone config                // 第一步在终端输入 rclone config\n2020/06/22 19:36:22 NOTICE: Config file \"C:\\\\Users\\\\12412\\\\.config\\\\rclone\\\\rclone.conf\" not found - using defaults\nNo remotes found - make a new one\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q> n                                  //第二步输入n创建新的配置， \nname> Onedrive_local                      //第三步 输入一个英文名称 ，中间也不要有空格\nType of storage to configure.\nEnter a string value. Press Enter for the default (\"\").\nChoose a number from below, or type in your own value\n 1 / 1Fichier\n   \\ \"fichier\"\n 2 / Alias for an existing remote\n   \\ \"alias\"\n 3 / Amazon Drive\n   \\ \"amazon cloud drive\"\n 4 / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)\n   \\ \"s3\"\n 5 / Backblaze B2\n   \\ \"b2\"\n 6 / Box\n   \\ \"box\"\n 7 / Cache a remote\n   \\ \"cache\"\n 8 / Citrix Sharefile\n   \\ \"sharefile\"\n 9 / Dropbox\n   \\ \"dropbox\"\n10 / Encrypt/Decrypt a remote\n   \\ \"crypt\"\n11 / FTP Connection\n   \\ \"ftp\"\n12 / Google Cloud Storage (this is not Google Drive)\n   \\ \"google cloud storage\"\n13 / Google Drive\n   \\ \"drive\"\n14 / Google Photos\n   \\ \"google photos\"\n15 / Hubic\n   \\ \"hubic\"\n16 / In memory object storage system.\n   \\ \"memory\"\n17 / Jottacloud\n   \\ \"jottacloud\"\n18 / Koofr\n   \\ \"koofr\"\n19 / Local Disk\n   \\ \"local\"\n20 / Mail.ru Cloud\n   \\ \"mailru\"\n21 / Mega\n   \\ \"mega\"\n22 / Microsoft Azure Blob Storage\n   \\ \"azureblob\"\n23 / Microsoft OneDrive\n   \\ \"onedrive\"\n24 / OpenDrive\n   \\ \"opendrive\"\n25 / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)\n   \\ \"swift\"\n26 / Pcloud\n   \\ \"pcloud\"\n27 / Put.io\n   \\ \"putio\"\n28 / QingCloud Object Storage\n   \\ \"qingstor\"\n29 / SSH/SFTP Connection\n   \\ \"sftp\"\n30 / Sugarsync\n   \\ \"sugarsync\"\n31 / Tardigrade Decentralized Cloud Storage\n   \\ \"tardigrade\"\n32 / Transparently chunk/split large files\n   \\ \"chunker\"\n33 / Union merges the contents of several upstream fs\n   \\ \"union\"\n34 / Webdav\n   \\ \"webdav\"\n35 / Yandex Disk\n   \\ \"yandex\"\n36 / http Connection\n   \\ \"http\"\n37 / premiumize.me\n   \\ \"premiumizeme\"\n38 / seafile\n   \\ \"seafile\"\nStorage> 23                 //第四步 输入要配置的网盘类型 因为我们要配置Microsoft OneDrive 因此输入23\n** See help for onedrive backend at: https://rclone.org/onedrive/ **\n\nMicrosoft App Client Id\nLeave blank normally.\nEnter a string value. Press Enter for the default (\"\").\nclient_id>                //第五步 直接回车\nMicrosoft App Client Secret\nLeave blank normally.\nEnter a string value. Press Enter for the default (\"\").\nclient_secret>            //第六步 直接回车 \nEdit advanced config? (y/n)\ny) Yes\nn) No (default)\ny/n> n                   //第七步 输入n 不进行高级配置 \nRemote config\nUse auto config?\n * Say Y if not sure\n * Say N if you are working on a remote or headless machine\ny) Yes (default)\nn) No\ny/n> y                  //第八步 输入y 使用自动配置授权\nIf your browser doesn't open automatically go to the following link: http://127.0.0.1:53682/auth?state=DWKiZ1cLZoWl9buxJbPXgw\nLog in and authorize rclone for access\nWaiting for code...\nGot code\nChoose a number from below, or type in an existing value\n 1 / OneDrive Personal or Business\n   \\ \"onedrive\"\n 2 / Root Sharepoint site\n   \\ \"sharepoint\"\n 3 / Type in driveID\n   \\ \"driveid\"\n 4 / Type in SiteID\n   \\ \"siteid\"\n 5 / Search a Sharepoint site\n   \\ \"search\"\nYour choice> 1              //第九步 输入1 因为现在我配置的是 OneDrive Personal or Business 类型的网盘\nFound 1 drives, please select the one you want to use:\n0:  (personal) id=58719e3298535c9\nChose drive to use:> 0     //第十步 输入0\nFound drive 'root' of type 'personal', URL: https://onedrive.live.com/?cid=058719e3298535c9\nIs that okay?\ny) Yes (default)\nn) No                    //第十一步 直接回车\ny/n>\n--------------------\n[Onedrive_local]\ntype = onedrive\ntoken = {\"access_token\":\"BAAUO9chh8cJscQLmU+LSWpbnr0vmwwAAZ6th5X8qdv3jqko0KCKeFVHdJigXdmpkGf3aO/W9HQahNAmDTxEVF2TnPtPNCw7M/me6FRz4mD9+x/jfJIb8Qewi8NpYMfYXdmPyUUVcPp1G+bwKOIFfJlNa6Can21gaGhTKgdEaz27GwetIvwjy7Qo/eDh/jarwoHEKljM8fN3UF1xz/RS0Ir+DC6CrvNIP3MUpbBF31/qUWJekWn3XqdT1j6m9bBfJ9Xk8heaY1/MT+1SA6fs6IPV5mO5m6dtjfsr1wO3xLGuaEutBPlNT9t219R55MZibwt746mw+VRTMCLsMrFZqVGK6IHzXyG3t+5NOrdP9yelb0AVQDZgAACJVvxd1cmt0LOAKEWlmYeQi3Eo6NKs9l5Abb4AsL2V02tbQt3AheMGLOxpOfyWOUUNaqvFAdSWRGQU8JLgFOA0YWy+UtYHSBG8SIy40jFI5czeqFoCzXguNijP2eiE+JdJREz9fO0q947/QK0K4MxVBqQxmlD1RDujCtnIDsT5r1ICG2AN40wSWqGvanKyctRNPdEm0BjmTrmXh0qTinmJ+BBVe70AU3ZigEzfMULxP+i+vwI2rA7VbiAuXnDUE75t49RGBiCMS+p00x0smGI685pmbPYQoOcMuVLHVdIxSDCO+YLSgpaHaBrruIvFbhto0OczwvYKn8XXEIp0CM6XEy55UYTuLkJFRDWX9VB/mSHarvexYqtEi4EYK2nABm4KrngexH0IdyhdwDKx7gNnLcMP9YYXG0cybppINxx67jFxjQM8/TWQPAz4cADt/FfPPVvuVABOZdhKmpuScj6qOhWsCfh6KH385UiM2Z+Rn2t9hZaXt3ZRmu+W5XAx9+E1SnlewdTiH5/VwB8QhCuRvS89hK/51BeMz4cJ5R9dLEqjGDxZ0HHay52DDhQYta/yG0VN2pkWTg0+T7rVdXbgC607y47sWmqP540tigNZPc0AgrWK3TXFOAJAEAoV9Xg+QUhJKYQNnrtFWI9nKbSFVHEeg8vvl5efZviF2szVI4wProgIHpUydqfnMlR3vRZlei/rmGUC9IICjdNTKPWSGmilJdbdxHMUc/MDyfYhxJA69cwI=\",\"token_type\":\"Bearer\",\"refresh_token\":\"MCeVIl4QGaJb!yGdTF6FLD!8N7hR4D8Z1bV4mpta08v64kR!MLcolxhea*NOv24M5V!uqHzBvi5dSW9wVHXGqALSe9kML5HKxV12XougeYafX2dcdyxvZ*cYEa6D0l6hIzovUwFpVjv3lqiP66jpzY4KxYMtZqQHf5PN!VGJf52xDKcsIUseoKD98z7olU3E2kyaZqJW8j6o5dBTV!Lmo5DVc31VpGrfeUnwhOcZkO7xN7IUEy8Vs9YXKQ0C4cin4qpyDSQ3pLpwy09ZpVE2bKOt4XQP7JLWQa6iGQ*r8zgewRo7ULYoEpRXYsqSBdwX6pJEQnRzCDcJimHxXBEV59rE*Ykwc9SijTkBN4haK6br9y2YVQ2UKegfQiErCHY33kzmSMAPJUwiooUNc6GytUz5O6ZxsBMghhb6B6NiSBCs!U5xRon1y*zzOsh9EArHk4y2rihu7BkkC13bJqxeMvhw$\",\"expiry\":\"2020-06-22T20:38:09.8687266+08:00\"}\ndrive_id = 58719e3298825c9\ndrive_type = personal\n--------------------\ny) Yes this is OK (default)\ne) Edit this remote\nd) Delete this remote\ny/e/d>                   //第十二步 回车\nCurrent remotes:\n\nName                 Type\n====                 ====\nOnedrive_local       onedrive          //显示你的设置则成功！\n\ne) Edit existing remote\nn) New remote\nd) Delete remote\nr) Rename remote\nc) Copy remote\ns) Set configuration password\nq) Quit config\ne/n/d/r/c/s/q> q           //第十三步 输入q结束配置\n```\n\n## 四：挂载Onedrive到本地\n\n1. ~~自行下载安装git~~\n\n~~此时请使用 `git bash` 的终端执行以下命令，因为我使用`cmd` 和 `powershell` 都出现关闭终端后挂载程序退出、本地挂载的OneDrive退出的现象。 如果你的windows没有安装git ， 请[自行安装](https://www.baidu.com/s?wd=windows 安装git&ie=utf-8)。若你使用 `cmd` 的话 ，`cmd` 是不能退出的，要保持 `cmd` 不退出本地硬盘才一直挂载着。~~\n\n2. ~~桌面新建txt文本文件。编辑内容为：~~\n\n```powershell\nstart \"\" \"%ProgramFiles%\\Git\\git-bash.exe\" -c \"rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes &\"\n```\n\n~~`Onedrive_local` 替换为你自己前面设置的名称 。~~\n\n~~`Q:` 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。~~\n\n~~`C:\\Users\\97532\\Rclone` 为本地缓存目录，可自行设置 。~~\n\n~~上述代码，使用git bash程序执行rclone挂载磁盘的指令。cmd无法识别`&`，也就是退出程序继续挂载指令。~~\n\n3. ~~重命名txt文件为`rclone_startup.bat`~~\n4. ~~双击运行~~\n\n~~![image-20200622210455993](C:\\Users\\97532\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200622210455993.png)~~\n\n~~出现：`The service rclone has been started` 或者磁盘列表出现Onedrive，则说明挂载成功。~~\n\n5. ~~设置开机启动~~\n\n~~由于git程序在重启后会停止，需要将`rclone_startup.bat`移动到开机启动文件里，每次开机让磁盘自动挂载。~~\n\n~~将`rclone_startup.bat`放在`C:\\Users\\用户名\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup` 中~~\n\n~~![](https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png)237.png)~~\n\n~~现在试试重启电脑。。重启后需要等待十几秒，才会运行git bash程序挂载Onedrive。~~\n\n~~git bash运行后会有一闪而过的黑色窗口。此时磁盘应该挂载成功了~~。\n\n> 删掉上面的方法，是由于步骤太过冗杂，需要安装git bash，而且开机启动时存在一闪而过的黑色窗口，运行后的挂载盘也存在问题。\n\n------\n\n挂载操作在退出cmd后就自动结束了，所以我们需要让它后台运行。\nrclone虽然提供了`--daemon`参数来实行后台运行，但是该参数并不适合于windows环境中。会有如下提示：\n\n```\nλ rclone mount GDrive:/ x: --cache-dir F:\\Temp --vfs-cache-mode writes --daemon\n2018/05/01 09:54:19 background mode not supported on windows platform\n```\n\n所以，我们需要另外想个办法让rclone能够后端运行以及开机自动挂载。\n\n1. **新建一个文本文件。**\n\n填入以下内容，**请注意修改倒数第二行的`WS.Run`中相关命令为你上步成功执行的命令**，然后将该文件名改为`rclone.vbs` （后缀名为`.vbs`即可）\n\n```vbscript\nOption Explicit\nDim WMIService, Process, Processes, Flag, WS\nSet WMIService = GetObject(\"winmgmts:{impersonationlevel=impersonate}!\\\\.\\root\\cimv2\")\nSet Processes = WMIService.ExecQuery(\"select * from win32_process\")\nFlag = true\nfor each Process in Processes\n    if strcomp(Process.name, \"rclone.exe\") = 0 then\n        Flag = false\n        exit for\n    end if\nnext\nSet WMIService = nothing\nif Flag then\n    Set WS = Wscript.CreateObject(\"Wscript.Shell\")\n    WS.Run \"rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes\", 0\nend if\n```\n\n> `Onedrive_local` 替换为你自己前面设置的名称 。\n>\n> `Q:` 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。\n>\n> `C:\\Users\\97532\\Rclone` 为本地缓存目录，可自行设置 。\n>\n> 关于`vfs-cache-mode`项设置，还是建议看下官方的说明根据自己的需求和网络情况来进行选择 https://rclone.org/commands/rclone_mount/#file-caching 。这里只做简单说明：\n>\n> - `off`： 本地不做任何缓存，所有文件直接从云端获取并写入。**建议网速特别好时（复制粘贴大文件时建议至少100M管以上速度）使用。**\n> - `minimal`：（和off类似，但是已经打开的文件会被缓存到本地。**个人推荐，小文件基本够用，但是如果你的网络情况（梯子）不是特别好的话，用writes也行**\n> - `writes`：（如果文件属性为`只读`则只从云端获取，不然先缓存在本地进行读写操作，随后被同步。**个人推荐使用，但是在直接从本地复制文件到GDrive时还是看网络情况**\n> - `full`：（所有的读写操作都会缓存到磁盘中。然后才会同步。**不是很推荐。会导致所有文件均被缓存到本地。直到达到你缓存总额（--cache-total-chunk-size，默认大小10G）。但是你网速特别差时也可以使用。**\n\n如果你需要中断这个挂载操作，请直接在任务管理器中kill掉`rclone.exe`进程即可。\n\n2. **开机自启**\n\n将这个文件`rclone.vbs`复制（或者剪贴）到开机项中`C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp`（Windows 10）即可实现开机自动挂载~\n\n## 五：参考资料\n\n《[Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘](https://www.lifeee.top/posts/14654.html)》\n\n《[CMD打开Git Bash](https://blog.csdn.net/lilongsy/article/details/89916797)》\n\n《[Windows-如何从DOS命令行启动Git Bash？](http://www.itkeyword.com/doc/9018080391155886x507/how-to-launch-git-bash-from-dos-command-line)》\n\n《[使用rclone在Windows下挂载Google个人/团队云盘](https://blog.rhilip.info/archives/874/)》","slug":"Rclone在win上挂在Onedrive","published":1,"updated":"2020-06-22T14:57:05.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsab60012p0vz31u4daz9","content":"<h2 id=\"一：Rclone下载\"><a href=\"#一：Rclone下载\" class=\"headerlink\" title=\"一：Rclone下载\"></a>一：Rclone下载</h2><p>首先下载适用于 Windows 的 rclone 👇</p>\n<p>官网下载：<a href=\"https://rclone.org/downloads/\">https://rclone.org/downloads/</a><br>GitHub下载：<a href=\"https://github.com/ncw/rclone\">https://github.com/ncw/rclone</a></p>\n<p>在<a href=\"https://rclone.org/downloads/\">rclone官网</a>中，Windows 平台下选择下载 AMD64 - 64 Bit</p>\n<p><img src=\"https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>或者在<a href=\"https://github.com/rclone/rclone/releases\">github</a>下载。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>下载后解压到一个英文路径中。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>另外在Windows平台使用rclone还需要另一个依赖工具<code>winfsp</code>，下载地址：<a href=\"http://www.secfs.net/winfsp/download/\">http://www.secfs.net/winfsp/download/</a> ，下载后一路安装即可。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"二：-配置环境变量\"><a href=\"#二：-配置环境变量\" class=\"headerlink\" title=\"二： 配置环境变量\"></a>二： 配置环境变量</h2><ol>\n<li>在电脑桌面右键点击“此电脑”的“属性”选项</li>\n<li>选择“高级系统设置”选项</li>\n<li>在系统变量中找到path，新建添加刚才解压后的路径</li>\n</ol>\n<p><img src=\"https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>检查环境变量是否配置成功。</p>\n<p>按<code>win</code>+<code>X</code>，然后按<code>A</code> 打开 <code>powershell</code> ，当然也可以去打开 <code>cmd</code> ，输入<code>rclone --version</code>，如果出现下面的输出则安装成功，否则检查上面步骤的环境变量是否配置正确。</p>\n<h2 id=\"三：配置Rclone\"><a href=\"#三：配置Rclone\" class=\"headerlink\" title=\"三：配置Rclone\"></a>三：配置Rclone</h2><p>在终端中依次输入以下命令行，请根据我下的步骤进操作。</p>\n<p>下载</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">PS</span> C:\\WINDOWS\\system32&gt; rclone config                // 第一步在终端输入 rclone config</span><br><span class=\"line\"><span class=\"number\">2020</span>/<span class=\"number\">06</span>/<span class=\"number\">22</span> <span class=\"number\">19</span>:<span class=\"number\">36</span>:<span class=\"number\">22</span> NOTICE: Config file <span class=\"string\">&quot;C:\\\\Users\\\\12412\\\\.config\\\\rclone\\\\rclone.conf&quot;</span> not found - <span class=\"keyword\">using</span> defaults</span><br><span class=\"line\">No remotes found - make a new one</span><br><span class=\"line\">n) New remote</span><br><span class=\"line\">s) <span class=\"built_in\">Set</span> configuration password</span><br><span class=\"line\">q) Quit config</span><br><span class=\"line\">n/s/q&gt; n                                  //第二步输入n创建新的配置， </span><br><span class=\"line\">name&gt; Onedrive_local                      //第三步 输入一个英文名称 ，中间也不要有空格</span><br><span class=\"line\"><span class=\"built_in\">Type</span> of storage to configure.</span><br><span class=\"line\">Enter a string value. Press Enter <span class=\"keyword\">for</span> the default (<span class=\"string\">&quot;&quot;</span>).</span><br><span class=\"line\">Choose a number from below, or <span class=\"built_in\">type</span> <span class=\"keyword\">in</span> your own value</span><br><span class=\"line\"> <span class=\"number\">1</span> / <span class=\"number\">1</span>Fichier</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;fichier&quot;</span></span><br><span class=\"line\"> <span class=\"number\">2</span> / Alias <span class=\"keyword\">for</span> an existing remote</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;alias&quot;</span></span><br><span class=\"line\"> <span class=\"number\">3</span> / Amazon Drive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;amazon cloud drive&quot;</span></span><br><span class=\"line\"> <span class=\"number\">4</span> / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;s3&quot;</span></span><br><span class=\"line\"> <span class=\"number\">5</span> / Backblaze B2</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;b2&quot;</span></span><br><span class=\"line\"> <span class=\"number\">6</span> / Box</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;box&quot;</span></span><br><span class=\"line\"> <span class=\"number\">7</span> / Cache a remote</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;cache&quot;</span></span><br><span class=\"line\"> <span class=\"number\">8</span> / Citrix Sharefile</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;sharefile&quot;</span></span><br><span class=\"line\"> <span class=\"number\">9</span> / Dropbox</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;dropbox&quot;</span></span><br><span class=\"line\"><span class=\"number\">10</span> / Encrypt/Decrypt a remote</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;crypt&quot;</span></span><br><span class=\"line\"><span class=\"number\">11</span> / FTP Connection</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;ftp&quot;</span></span><br><span class=\"line\"><span class=\"number\">12</span> / Google Cloud Storage (this is not Google Drive)</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;google cloud storage&quot;</span></span><br><span class=\"line\"><span class=\"number\">13</span> / Google Drive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;drive&quot;</span></span><br><span class=\"line\"><span class=\"number\">14</span> / Google Photos</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;google photos&quot;</span></span><br><span class=\"line\"><span class=\"number\">15</span> / Hubic</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;hubic&quot;</span></span><br><span class=\"line\"><span class=\"number\">16</span> / <span class=\"keyword\">In</span> memory object storage system.</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;memory&quot;</span></span><br><span class=\"line\"><span class=\"number\">17</span> / Jottacloud</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;jottacloud&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span> / Koofr</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;koofr&quot;</span></span><br><span class=\"line\"><span class=\"number\">19</span> / Local Disk</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;local&quot;</span></span><br><span class=\"line\"><span class=\"number\">20</span> / Mail.ru Cloud</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;mailru&quot;</span></span><br><span class=\"line\"><span class=\"number\">21</span> / Mega</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;mega&quot;</span></span><br><span class=\"line\"><span class=\"number\">22</span> / Microsoft Azure Blob Storage</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;azureblob&quot;</span></span><br><span class=\"line\"><span class=\"number\">23</span> / Microsoft OneDrive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;onedrive&quot;</span></span><br><span class=\"line\"><span class=\"number\">24</span> / OpenDrive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;opendrive&quot;</span></span><br><span class=\"line\"><span class=\"number\">25</span> / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;swift&quot;</span></span><br><span class=\"line\"><span class=\"number\">26</span> / Pcloud</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;pcloud&quot;</span></span><br><span class=\"line\"><span class=\"number\">27</span> / Put.io</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;putio&quot;</span></span><br><span class=\"line\"><span class=\"number\">28</span> / QingCloud Object Storage</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;qingstor&quot;</span></span><br><span class=\"line\"><span class=\"number\">29</span> / SSH/SFTP Connection</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;sftp&quot;</span></span><br><span class=\"line\"><span class=\"number\">30</span> / Sugarsync</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;sugarsync&quot;</span></span><br><span class=\"line\"><span class=\"number\">31</span> / Tardigrade Decentralized Cloud Storage</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;tardigrade&quot;</span></span><br><span class=\"line\"><span class=\"number\">32</span> / Transparently chunk/split large files</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;chunker&quot;</span></span><br><span class=\"line\"><span class=\"number\">33</span> / Union merges the contents of several upstream fs</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;union&quot;</span></span><br><span class=\"line\"><span class=\"number\">34</span> / Webdav</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;webdav&quot;</span></span><br><span class=\"line\"><span class=\"number\">35</span> / Yandex Disk</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;yandex&quot;</span></span><br><span class=\"line\"><span class=\"number\">36</span> / http Connection</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;http&quot;</span></span><br><span class=\"line\"><span class=\"number\">37</span> / premiumize.me</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;premiumizeme&quot;</span></span><br><span class=\"line\"><span class=\"number\">38</span> / seafile</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;seafile&quot;</span></span><br><span class=\"line\">Storage&gt; <span class=\"number\">23</span>                 //第四步 输入要配置的网盘类型 因为我们要配置Microsoft OneDrive 因此输入<span class=\"number\">23</span></span><br><span class=\"line\">** See help <span class=\"keyword\">for</span> onedrive backend at: https://rclone.org/onedrive/ **</span><br><span class=\"line\"></span><br><span class=\"line\">Microsoft App Client Id</span><br><span class=\"line\">Leave blank normally.</span><br><span class=\"line\">Enter a string value. Press Enter <span class=\"keyword\">for</span> the default (<span class=\"string\">&quot;&quot;</span>).</span><br><span class=\"line\">client_id&gt;                //第五步 直接回车</span><br><span class=\"line\">Microsoft App Client Secret</span><br><span class=\"line\">Leave blank normally.</span><br><span class=\"line\">Enter a string value. Press Enter <span class=\"keyword\">for</span> the default (<span class=\"string\">&quot;&quot;</span>).</span><br><span class=\"line\">client_secret&gt;            //第六步 直接回车 </span><br><span class=\"line\">Edit advanced config? (y/n)</span><br><span class=\"line\">y) Yes</span><br><span class=\"line\">n) No (default)</span><br><span class=\"line\">y/n&gt; n                   //第七步 输入n 不进行高级配置 </span><br><span class=\"line\">Remote config</span><br><span class=\"line\">Use auto config?</span><br><span class=\"line\"> * Say Y <span class=\"keyword\">if</span> not sure</span><br><span class=\"line\"> * Say N <span class=\"keyword\">if</span> you are working on a remote or headless machine</span><br><span class=\"line\">y) Yes (default)</span><br><span class=\"line\">n) No</span><br><span class=\"line\">y/n&gt; y                  //第八步 输入y 使用自动配置授权</span><br><span class=\"line\"><span class=\"keyword\">If</span> your browser doesn<span class=\"string\">&#x27;t open automatically go to the following link: http://127.0.0.1:53682/auth?state=DWKiZ1cLZoWl9buxJbPXgw</span></span><br><span class=\"line\"><span class=\"string\">Log in and authorize rclone for access</span></span><br><span class=\"line\"><span class=\"string\">Waiting for code...</span></span><br><span class=\"line\"><span class=\"string\">Got code</span></span><br><span class=\"line\"><span class=\"string\">Choose a number from below, or type in an existing value</span></span><br><span class=\"line\"><span class=\"string\"> 1 / OneDrive Personal or Business</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;onedrive&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 2 / Root Sharepoint site</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;sharepoint&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 3 / Type in driveID</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;driveid&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 4 / Type in SiteID</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;siteid&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 5 / Search a Sharepoint site</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;search&quot;</span></span><br><span class=\"line\"><span class=\"string\">Your choice&gt; 1              //第九步 输入1 因为现在我配置的是 OneDrive Personal or Business 类型的网盘</span></span><br><span class=\"line\"><span class=\"string\">Found 1 drives, please select the one you want to use:</span></span><br><span class=\"line\"><span class=\"string\">0:  (personal) id=58719e3298535c9</span></span><br><span class=\"line\"><span class=\"string\">Chose drive to use:&gt; 0     //第十步 输入0</span></span><br><span class=\"line\"><span class=\"string\">Found drive &#x27;</span>root<span class=\"string\">&#x27; of type &#x27;</span>personal<span class=\"string\">&#x27;, URL: https://onedrive.live.com/?cid=058719e3298535c9</span></span><br><span class=\"line\"><span class=\"string\">Is that okay?</span></span><br><span class=\"line\"><span class=\"string\">y) Yes (default)</span></span><br><span class=\"line\"><span class=\"string\">n) No                    //第十一步 直接回车</span></span><br><span class=\"line\"><span class=\"string\">y/n&gt;</span></span><br><span class=\"line\"><span class=\"string\">--------------------</span></span><br><span class=\"line\"><span class=\"string\">[Onedrive_local]</span></span><br><span class=\"line\"><span class=\"string\">type = onedrive</span></span><br><span class=\"line\"><span class=\"string\">token = &#123;&quot;access_token&quot;:&quot;BAAUO9chh8cJscQLmU+LSWpbnr0vmwwAAZ6th5X8qdv3jqko0KCKeFVHdJigXdmpkGf3aO/W9HQahNAmDTxEVF2TnPtPNCw7M/me6FRz4mD9+x/jfJIb8Qewi8NpYMfYXdmPyUUVcPp1G+bwKOIFfJlNa6Can21gaGhTKgdEaz27GwetIvwjy7Qo/eDh/jarwoHEKljM8fN3UF1xz/RS0Ir+DC6CrvNIP3MUpbBF31/qUWJekWn3XqdT1j6m9bBfJ9Xk8heaY1/MT+1SA6fs6IPV5mO5m6dtjfsr1wO3xLGuaEutBPlNT9t219R55MZibwt746mw+VRTMCLsMrFZqVGK6IHzXyG3t+5NOrdP9yelb0AVQDZgAACJVvxd1cmt0LOAKEWlmYeQi3Eo6NKs9l5Abb4AsL2V02tbQt3AheMGLOxpOfyWOUUNaqvFAdSWRGQU8JLgFOA0YWy+UtYHSBG8SIy40jFI5czeqFoCzXguNijP2eiE+JdJREz9fO0q947/QK0K4MxVBqQxmlD1RDujCtnIDsT5r1ICG2AN40wSWqGvanKyctRNPdEm0BjmTrmXh0qTinmJ+BBVe70AU3ZigEzfMULxP+i+vwI2rA7VbiAuXnDUE75t49RGBiCMS+p00x0smGI685pmbPYQoOcMuVLHVdIxSDCO+YLSgpaHaBrruIvFbhto0OczwvYKn8XXEIp0CM6XEy55UYTuLkJFRDWX9VB/mSHarvexYqtEi4EYK2nABm4KrngexH0IdyhdwDKx7gNnLcMP9YYXG0cybppINxx67jFxjQM8/TWQPAz4cADt/FfPPVvuVABOZdhKmpuScj6qOhWsCfh6KH385UiM2Z+Rn2t9hZaXt3ZRmu+W5XAx9+E1SnlewdTiH5/VwB8QhCuRvS89hK/51BeMz4cJ5R9dLEqjGDxZ0HHay52DDhQYta/yG0VN2pkWTg0+T7rVdXbgC607y47sWmqP540tigNZPc0AgrWK3TXFOAJAEAoV9Xg+QUhJKYQNnrtFWI9nKbSFVHEeg8vvl5efZviF2szVI4wProgIHpUydqfnMlR3vRZlei/rmGUC9IICjdNTKPWSGmilJdbdxHMUc/MDyfYhxJA69cwI=&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;MCeVIl4QGaJb!yGdTF6FLD!8N7hR4D8Z1bV4mpta08v64kR!MLcolxhea*NOv24M5V!uqHzBvi5dSW9wVHXGqALSe9kML5HKxV12XougeYafX2dcdyxvZ*cYEa6D0l6hIzovUwFpVjv3lqiP66jpzY4KxYMtZqQHf5PN!VGJf52xDKcsIUseoKD98z7olU3E2kyaZqJW8j6o5dBTV!Lmo5DVc31VpGrfeUnwhOcZkO7xN7IUEy8Vs9YXKQ0C4cin4qpyDSQ3pLpwy09ZpVE2bKOt4XQP7JLWQa6iGQ*r8zgewRo7ULYoEpRXYsqSBdwX6pJEQnRzCDcJimHxXBEV59rE*Ykwc9SijTkBN4haK6br9y2YVQ2UKegfQiErCHY33kzmSMAPJUwiooUNc6GytUz5O6ZxsBMghhb6B6NiSBCs!U5xRon1y*zzOsh9EArHk4y2rihu7BkkC13bJqxeMvhw$&quot;,&quot;expiry&quot;:&quot;2020-06-22T20:38:09.8687266+08:00&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">drive_id = 58719e3298825c9</span></span><br><span class=\"line\"><span class=\"string\">drive_type = personal</span></span><br><span class=\"line\"><span class=\"string\">--------------------</span></span><br><span class=\"line\"><span class=\"string\">y) Yes this is OK (default)</span></span><br><span class=\"line\"><span class=\"string\">e) Edit this remote</span></span><br><span class=\"line\"><span class=\"string\">d) Delete this remote</span></span><br><span class=\"line\"><span class=\"string\">y/e/d&gt;                   //第十二步 回车</span></span><br><span class=\"line\"><span class=\"string\">Current remotes:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Name                 Type</span></span><br><span class=\"line\"><span class=\"string\">====                 ====</span></span><br><span class=\"line\"><span class=\"string\">Onedrive_local       onedrive          //显示你的设置则成功！</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">e) Edit existing remote</span></span><br><span class=\"line\"><span class=\"string\">n) New remote</span></span><br><span class=\"line\"><span class=\"string\">d) Delete remote</span></span><br><span class=\"line\"><span class=\"string\">r) Rename remote</span></span><br><span class=\"line\"><span class=\"string\">c) Copy remote</span></span><br><span class=\"line\"><span class=\"string\">s) Set configuration password</span></span><br><span class=\"line\"><span class=\"string\">q) Quit config</span></span><br><span class=\"line\"><span class=\"string\">e/n/d/r/c/s/q&gt; q           //第十三步 输入q结束配置</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四：挂载Onedrive到本地\"><a href=\"#四：挂载Onedrive到本地\" class=\"headerlink\" title=\"四：挂载Onedrive到本地\"></a>四：挂载Onedrive到本地</h2><ol>\n<li><del>自行下载安装git</del></li>\n</ol>\n<p><del>此时请使用 <code>git bash</code> 的终端执行以下命令，因为我使用<code>cmd</code> 和 <code>powershell</code> 都出现关闭终端后挂载程序退出、本地挂载的OneDrive退出的现象。 如果你的windows没有安装git ， 请[自行安装](<a href=\"https://www.baidu.com/s?wd=windows\">https://www.baidu.com/s?wd=windows</a> 安装git&amp;ie=utf-8)。若你使用 <code>cmd</code> 的话 ，<code>cmd</code> 是不能退出的，要保持 <code>cmd</code> 不退出本地硬盘才一直挂载着。</del></p>\n<ol start=\"2\">\n<li><del>桌面新建txt文本文件。编辑内容为：</del></li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">start</span> <span class=\"string\">&quot;&quot;</span> <span class=\"string\">&quot;%ProgramFiles%\\Git\\git-bash.exe&quot;</span> <span class=\"literal\">-c</span> <span class=\"string\">&quot;rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes &amp;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><del><code>Onedrive_local</code> 替换为你自己前面设置的名称 。</del></p>\n<p><del><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</del></p>\n<p><del><code>C:\\Users\\97532\\Rclone</code> 为本地缓存目录，可自行设置 。</del></p>\n<p><del>上述代码，使用git bash程序执行rclone挂载磁盘的指令。cmd无法识别<code>&amp;</code>，也就是退出程序继续挂载指令。</del></p>\n<ol start=\"3\">\n<li><del>重命名txt文件为<code>rclone_startup.bat</code></del></li>\n<li><del>双击运行</del></li>\n</ol>\n<p><del><img src=\"C:\\Users\\97532\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200622210455993.png\" class=\"lazyload\" data-srcset=\"C:\\Users\\97532\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200622210455993.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200622210455993\"></del></p>\n<p><del>出现：<code>The service rclone has been started</code> 或者磁盘列表出现Onedrive，则说明挂载成功。</del></p>\n<ol start=\"5\">\n<li><del>设置开机启动</del></li>\n</ol>\n<p><del>由于git程序在重启后会停止，需要将<code>rclone_startup.bat</code>移动到开机启动文件里，每次开机让磁盘自动挂载。</del></p>\n<p><del>将<code>rclone_startup.bat</code>放在<code>C:\\Users\\用户名\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</code> 中</del></p>\n<p><del><img src=\"https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\">237.png)</del></p>\n<p><del>现在试试重启电脑。。重启后需要等待十几秒，才会运行git bash程序挂载Onedrive。</del></p>\n<p><del>git bash运行后会有一闪而过的黑色窗口。此时磁盘应该挂载成功了</del>。</p>\n<blockquote>\n<p>删掉上面的方法，是由于步骤太过冗杂，需要安装git bash，而且开机启动时存在一闪而过的黑色窗口，运行后的挂载盘也存在问题。</p>\n</blockquote>\n<hr>\n<p>挂载操作在退出cmd后就自动结束了，所以我们需要让它后台运行。<br>rclone虽然提供了<code>--daemon</code>参数来实行后台运行，但是该参数并不适合于windows环境中。会有如下提示：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ rclone mount GDrive:&#x2F; x: --cache-dir F:\\Temp --vfs-cache-mode writes --daemon</span><br><span class=\"line\">2018&#x2F;05&#x2F;01 09:54:19 background mode not supported on windows platform</span><br></pre></td></tr></table></figure>\n\n<p>所以，我们需要另外想个办法让rclone能够后端运行以及开机自动挂载。</p>\n<ol>\n<li><strong>新建一个文本文件。</strong></li>\n</ol>\n<p>填入以下内容，<strong>请注意修改倒数第二行的<code>WS.Run</code>中相关命令为你上步成功执行的命令</strong>，然后将该文件名改为<code>rclone.vbs</code> （后缀名为<code>.vbs</code>即可）</p>\n<figure class=\"highlight vbscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Option</span> <span class=\"keyword\">Explicit</span></span><br><span class=\"line\"><span class=\"keyword\">Dim</span> WMIService, Process, Processes, Flag, WS</span><br><span class=\"line\"><span class=\"keyword\">Set</span> WMIService = <span class=\"built_in\">GetObject</span>(<span class=\"string\">&quot;winmgmts:&#123;impersonationlevel=impersonate&#125;!\\\\.\\root\\cimv2&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">Set</span> Processes = WMIService.ExecQuery(<span class=\"string\">&quot;select * from win32_process&quot;</span>)</span><br><span class=\"line\">Flag = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"keyword\">each</span> Process <span class=\"keyword\">in</span> Processes</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">strcomp</span>(Process.name, <span class=\"string\">&quot;rclone.exe&quot;</span>) = <span class=\"number\">0</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">        Flag = <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"keyword\">exit</span> <span class=\"keyword\">for</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">if</span></span><br><span class=\"line\"><span class=\"keyword\">next</span></span><br><span class=\"line\"><span class=\"keyword\">Set</span> WMIService = <span class=\"literal\">nothing</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> Flag <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">Set</span> WS = Wscript.<span class=\"built_in\">CreateObject</span>(<span class=\"string\">&quot;Wscript.Shell&quot;</span>)</span><br><span class=\"line\">    WS.Run <span class=\"string\">&quot;rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes&quot;</span>, <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">if</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><code>Onedrive_local</code> 替换为你自己前面设置的名称 。</p>\n<p><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</p>\n<p><code>C:\\Users\\97532\\Rclone</code> 为本地缓存目录，可自行设置 。</p>\n<p>关于<code>vfs-cache-mode</code>项设置，还是建议看下官方的说明根据自己的需求和网络情况来进行选择 <a href=\"https://rclone.org/commands/rclone_mount/#file-caching\">https://rclone.org/commands/rclone_mount/#file-caching</a> 。这里只做简单说明：</p>\n<ul>\n<li><code>off</code>： 本地不做任何缓存，所有文件直接从云端获取并写入。<strong>建议网速特别好时（复制粘贴大文件时建议至少100M管以上速度）使用。</strong></li>\n<li><code>minimal</code>：（和off类似，但是已经打开的文件会被缓存到本地。<strong>个人推荐，小文件基本够用，但是如果你的网络情况（梯子）不是特别好的话，用writes也行</strong></li>\n<li><code>writes</code>：（如果文件属性为<code>只读</code>则只从云端获取，不然先缓存在本地进行读写操作，随后被同步。<strong>个人推荐使用，但是在直接从本地复制文件到GDrive时还是看网络情况</strong></li>\n<li><code>full</code>：（所有的读写操作都会缓存到磁盘中。然后才会同步。<strong>不是很推荐。会导致所有文件均被缓存到本地。直到达到你缓存总额（–cache-total-chunk-size，默认大小10G）。但是你网速特别差时也可以使用。</strong></li>\n</ul>\n</blockquote>\n<p>如果你需要中断这个挂载操作，请直接在任务管理器中kill掉<code>rclone.exe</code>进程即可。</p>\n<ol start=\"2\">\n<li><strong>开机自启</strong></li>\n</ol>\n<p>将这个文件<code>rclone.vbs</code>复制（或者剪贴）到开机项中<code>C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp</code>（Windows 10）即可实现开机自动挂载~</p>\n<h2 id=\"五：参考资料\"><a href=\"#五：参考资料\" class=\"headerlink\" title=\"五：参考资料\"></a>五：参考资料</h2><p>《<a href=\"https://www.lifeee.top/posts/14654.html\">Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/lilongsy/article/details/89916797\">CMD打开Git Bash</a>》</p>\n<p>《<a href=\"http://www.itkeyword.com/doc/9018080391155886x507/how-to-launch-git-bash-from-dos-command-line\">Windows-如何从DOS命令行启动Git Bash？</a>》</p>\n<p>《<a href=\"https://blog.rhilip.info/archives/874/\">使用rclone在Windows下挂载Google个人/团队云盘</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h2 id=\"一：Rclone下载\"><a href=\"#一：Rclone下载\" class=\"headerlink\" title=\"一：Rclone下载\"></a>一：Rclone下载</h2><p>首先下载适用于 Windows 的 rclone 👇</p>\n<p>官网下载：<a href=\"https://rclone.org/downloads/\">https://rclone.org/downloads/</a><br>GitHub下载：<a href=\"https://github.com/ncw/rclone\">https://github.com/ncw/rclone</a></p>\n<p>在<a href=\"https://rclone.org/downloads/\">rclone官网</a>中，Windows 平台下选择下载 AMD64 - 64 Bit</p>\n<p><img src=\"https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png\"></p>\n<p>或者在<a href=\"https://github.com/rclone/rclone/releases\">github</a>下载。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png\"></p>\n<p>下载后解压到一个英文路径中。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png\"></p>\n<p>另外在Windows平台使用rclone还需要另一个依赖工具<code>winfsp</code>，下载地址：<a href=\"http://www.secfs.net/winfsp/download/\">http://www.secfs.net/winfsp/download/</a> ，下载后一路安装即可。</p>\n<p><img src=\"https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png\"></p>\n<h2 id=\"二：-配置环境变量\"><a href=\"#二：-配置环境变量\" class=\"headerlink\" title=\"二： 配置环境变量\"></a>二： 配置环境变量</h2><ol>\n<li>在电脑桌面右键点击“此电脑”的“属性”选项</li>\n<li>选择“高级系统设置”选项</li>\n<li>在系统变量中找到path，新建添加刚才解压后的路径</li>\n</ol>\n<p><img src=\"https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png\"></p>\n<p>检查环境变量是否配置成功。</p>\n<p>按<code>win</code>+<code>X</code>，然后按<code>A</code> 打开 <code>powershell</code> ，当然也可以去打开 <code>cmd</code> ，输入<code>rclone --version</code>，如果出现下面的输出则安装成功，否则检查上面步骤的环境变量是否配置正确。</p>\n<h2 id=\"三：配置Rclone\"><a href=\"#三：配置Rclone\" class=\"headerlink\" title=\"三：配置Rclone\"></a>三：配置Rclone</h2><p>在终端中依次输入以下命令行，请根据我下的步骤进操作。</p>\n<p>下载</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">PS</span> C:\\WINDOWS\\system32&gt; rclone config                // 第一步在终端输入 rclone config</span><br><span class=\"line\"><span class=\"number\">2020</span>/<span class=\"number\">06</span>/<span class=\"number\">22</span> <span class=\"number\">19</span>:<span class=\"number\">36</span>:<span class=\"number\">22</span> NOTICE: Config file <span class=\"string\">&quot;C:\\\\Users\\\\12412\\\\.config\\\\rclone\\\\rclone.conf&quot;</span> not found - <span class=\"keyword\">using</span> defaults</span><br><span class=\"line\">No remotes found - make a new one</span><br><span class=\"line\">n) New remote</span><br><span class=\"line\">s) <span class=\"built_in\">Set</span> configuration password</span><br><span class=\"line\">q) Quit config</span><br><span class=\"line\">n/s/q&gt; n                                  //第二步输入n创建新的配置， </span><br><span class=\"line\">name&gt; Onedrive_local                      //第三步 输入一个英文名称 ，中间也不要有空格</span><br><span class=\"line\"><span class=\"built_in\">Type</span> of storage to configure.</span><br><span class=\"line\">Enter a string value. Press Enter <span class=\"keyword\">for</span> the default (<span class=\"string\">&quot;&quot;</span>).</span><br><span class=\"line\">Choose a number from below, or <span class=\"built_in\">type</span> <span class=\"keyword\">in</span> your own value</span><br><span class=\"line\"> <span class=\"number\">1</span> / <span class=\"number\">1</span>Fichier</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;fichier&quot;</span></span><br><span class=\"line\"> <span class=\"number\">2</span> / Alias <span class=\"keyword\">for</span> an existing remote</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;alias&quot;</span></span><br><span class=\"line\"> <span class=\"number\">3</span> / Amazon Drive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;amazon cloud drive&quot;</span></span><br><span class=\"line\"> <span class=\"number\">4</span> / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;s3&quot;</span></span><br><span class=\"line\"> <span class=\"number\">5</span> / Backblaze B2</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;b2&quot;</span></span><br><span class=\"line\"> <span class=\"number\">6</span> / Box</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;box&quot;</span></span><br><span class=\"line\"> <span class=\"number\">7</span> / Cache a remote</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;cache&quot;</span></span><br><span class=\"line\"> <span class=\"number\">8</span> / Citrix Sharefile</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;sharefile&quot;</span></span><br><span class=\"line\"> <span class=\"number\">9</span> / Dropbox</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;dropbox&quot;</span></span><br><span class=\"line\"><span class=\"number\">10</span> / Encrypt/Decrypt a remote</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;crypt&quot;</span></span><br><span class=\"line\"><span class=\"number\">11</span> / FTP Connection</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;ftp&quot;</span></span><br><span class=\"line\"><span class=\"number\">12</span> / Google Cloud Storage (this is not Google Drive)</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;google cloud storage&quot;</span></span><br><span class=\"line\"><span class=\"number\">13</span> / Google Drive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;drive&quot;</span></span><br><span class=\"line\"><span class=\"number\">14</span> / Google Photos</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;google photos&quot;</span></span><br><span class=\"line\"><span class=\"number\">15</span> / Hubic</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;hubic&quot;</span></span><br><span class=\"line\"><span class=\"number\">16</span> / <span class=\"keyword\">In</span> memory object storage system.</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;memory&quot;</span></span><br><span class=\"line\"><span class=\"number\">17</span> / Jottacloud</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;jottacloud&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span> / Koofr</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;koofr&quot;</span></span><br><span class=\"line\"><span class=\"number\">19</span> / Local Disk</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;local&quot;</span></span><br><span class=\"line\"><span class=\"number\">20</span> / Mail.ru Cloud</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;mailru&quot;</span></span><br><span class=\"line\"><span class=\"number\">21</span> / Mega</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;mega&quot;</span></span><br><span class=\"line\"><span class=\"number\">22</span> / Microsoft Azure Blob Storage</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;azureblob&quot;</span></span><br><span class=\"line\"><span class=\"number\">23</span> / Microsoft OneDrive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;onedrive&quot;</span></span><br><span class=\"line\"><span class=\"number\">24</span> / OpenDrive</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;opendrive&quot;</span></span><br><span class=\"line\"><span class=\"number\">25</span> / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;swift&quot;</span></span><br><span class=\"line\"><span class=\"number\">26</span> / Pcloud</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;pcloud&quot;</span></span><br><span class=\"line\"><span class=\"number\">27</span> / Put.io</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;putio&quot;</span></span><br><span class=\"line\"><span class=\"number\">28</span> / QingCloud Object Storage</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;qingstor&quot;</span></span><br><span class=\"line\"><span class=\"number\">29</span> / SSH/SFTP Connection</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;sftp&quot;</span></span><br><span class=\"line\"><span class=\"number\">30</span> / Sugarsync</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;sugarsync&quot;</span></span><br><span class=\"line\"><span class=\"number\">31</span> / Tardigrade Decentralized Cloud Storage</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;tardigrade&quot;</span></span><br><span class=\"line\"><span class=\"number\">32</span> / Transparently chunk/split large files</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;chunker&quot;</span></span><br><span class=\"line\"><span class=\"number\">33</span> / Union merges the contents of several upstream fs</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;union&quot;</span></span><br><span class=\"line\"><span class=\"number\">34</span> / Webdav</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;webdav&quot;</span></span><br><span class=\"line\"><span class=\"number\">35</span> / Yandex Disk</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;yandex&quot;</span></span><br><span class=\"line\"><span class=\"number\">36</span> / http Connection</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;http&quot;</span></span><br><span class=\"line\"><span class=\"number\">37</span> / premiumize.me</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;premiumizeme&quot;</span></span><br><span class=\"line\"><span class=\"number\">38</span> / seafile</span><br><span class=\"line\">   \\ <span class=\"string\">&quot;seafile&quot;</span></span><br><span class=\"line\">Storage&gt; <span class=\"number\">23</span>                 //第四步 输入要配置的网盘类型 因为我们要配置Microsoft OneDrive 因此输入<span class=\"number\">23</span></span><br><span class=\"line\">** See help <span class=\"keyword\">for</span> onedrive backend at: https://rclone.org/onedrive/ **</span><br><span class=\"line\"></span><br><span class=\"line\">Microsoft App Client Id</span><br><span class=\"line\">Leave blank normally.</span><br><span class=\"line\">Enter a string value. Press Enter <span class=\"keyword\">for</span> the default (<span class=\"string\">&quot;&quot;</span>).</span><br><span class=\"line\">client_id&gt;                //第五步 直接回车</span><br><span class=\"line\">Microsoft App Client Secret</span><br><span class=\"line\">Leave blank normally.</span><br><span class=\"line\">Enter a string value. Press Enter <span class=\"keyword\">for</span> the default (<span class=\"string\">&quot;&quot;</span>).</span><br><span class=\"line\">client_secret&gt;            //第六步 直接回车 </span><br><span class=\"line\">Edit advanced config? (y/n)</span><br><span class=\"line\">y) Yes</span><br><span class=\"line\">n) No (default)</span><br><span class=\"line\">y/n&gt; n                   //第七步 输入n 不进行高级配置 </span><br><span class=\"line\">Remote config</span><br><span class=\"line\">Use auto config?</span><br><span class=\"line\"> * Say Y <span class=\"keyword\">if</span> not sure</span><br><span class=\"line\"> * Say N <span class=\"keyword\">if</span> you are working on a remote or headless machine</span><br><span class=\"line\">y) Yes (default)</span><br><span class=\"line\">n) No</span><br><span class=\"line\">y/n&gt; y                  //第八步 输入y 使用自动配置授权</span><br><span class=\"line\"><span class=\"keyword\">If</span> your browser doesn<span class=\"string\">&#x27;t open automatically go to the following link: http://127.0.0.1:53682/auth?state=DWKiZ1cLZoWl9buxJbPXgw</span></span><br><span class=\"line\"><span class=\"string\">Log in and authorize rclone for access</span></span><br><span class=\"line\"><span class=\"string\">Waiting for code...</span></span><br><span class=\"line\"><span class=\"string\">Got code</span></span><br><span class=\"line\"><span class=\"string\">Choose a number from below, or type in an existing value</span></span><br><span class=\"line\"><span class=\"string\"> 1 / OneDrive Personal or Business</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;onedrive&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 2 / Root Sharepoint site</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;sharepoint&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 3 / Type in driveID</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;driveid&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 4 / Type in SiteID</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;siteid&quot;</span></span><br><span class=\"line\"><span class=\"string\"> 5 / Search a Sharepoint site</span></span><br><span class=\"line\"><span class=\"string\">   \\ &quot;search&quot;</span></span><br><span class=\"line\"><span class=\"string\">Your choice&gt; 1              //第九步 输入1 因为现在我配置的是 OneDrive Personal or Business 类型的网盘</span></span><br><span class=\"line\"><span class=\"string\">Found 1 drives, please select the one you want to use:</span></span><br><span class=\"line\"><span class=\"string\">0:  (personal) id=58719e3298535c9</span></span><br><span class=\"line\"><span class=\"string\">Chose drive to use:&gt; 0     //第十步 输入0</span></span><br><span class=\"line\"><span class=\"string\">Found drive &#x27;</span>root<span class=\"string\">&#x27; of type &#x27;</span>personal<span class=\"string\">&#x27;, URL: https://onedrive.live.com/?cid=058719e3298535c9</span></span><br><span class=\"line\"><span class=\"string\">Is that okay?</span></span><br><span class=\"line\"><span class=\"string\">y) Yes (default)</span></span><br><span class=\"line\"><span class=\"string\">n) No                    //第十一步 直接回车</span></span><br><span class=\"line\"><span class=\"string\">y/n&gt;</span></span><br><span class=\"line\"><span class=\"string\">--------------------</span></span><br><span class=\"line\"><span class=\"string\">[Onedrive_local]</span></span><br><span class=\"line\"><span class=\"string\">type = onedrive</span></span><br><span class=\"line\"><span class=\"string\">token = &#123;&quot;access_token&quot;:&quot;BAAUO9chh8cJscQLmU+LSWpbnr0vmwwAAZ6th5X8qdv3jqko0KCKeFVHdJigXdmpkGf3aO/W9HQahNAmDTxEVF2TnPtPNCw7M/me6FRz4mD9+x/jfJIb8Qewi8NpYMfYXdmPyUUVcPp1G+bwKOIFfJlNa6Can21gaGhTKgdEaz27GwetIvwjy7Qo/eDh/jarwoHEKljM8fN3UF1xz/RS0Ir+DC6CrvNIP3MUpbBF31/qUWJekWn3XqdT1j6m9bBfJ9Xk8heaY1/MT+1SA6fs6IPV5mO5m6dtjfsr1wO3xLGuaEutBPlNT9t219R55MZibwt746mw+VRTMCLsMrFZqVGK6IHzXyG3t+5NOrdP9yelb0AVQDZgAACJVvxd1cmt0LOAKEWlmYeQi3Eo6NKs9l5Abb4AsL2V02tbQt3AheMGLOxpOfyWOUUNaqvFAdSWRGQU8JLgFOA0YWy+UtYHSBG8SIy40jFI5czeqFoCzXguNijP2eiE+JdJREz9fO0q947/QK0K4MxVBqQxmlD1RDujCtnIDsT5r1ICG2AN40wSWqGvanKyctRNPdEm0BjmTrmXh0qTinmJ+BBVe70AU3ZigEzfMULxP+i+vwI2rA7VbiAuXnDUE75t49RGBiCMS+p00x0smGI685pmbPYQoOcMuVLHVdIxSDCO+YLSgpaHaBrruIvFbhto0OczwvYKn8XXEIp0CM6XEy55UYTuLkJFRDWX9VB/mSHarvexYqtEi4EYK2nABm4KrngexH0IdyhdwDKx7gNnLcMP9YYXG0cybppINxx67jFxjQM8/TWQPAz4cADt/FfPPVvuVABOZdhKmpuScj6qOhWsCfh6KH385UiM2Z+Rn2t9hZaXt3ZRmu+W5XAx9+E1SnlewdTiH5/VwB8QhCuRvS89hK/51BeMz4cJ5R9dLEqjGDxZ0HHay52DDhQYta/yG0VN2pkWTg0+T7rVdXbgC607y47sWmqP540tigNZPc0AgrWK3TXFOAJAEAoV9Xg+QUhJKYQNnrtFWI9nKbSFVHEeg8vvl5efZviF2szVI4wProgIHpUydqfnMlR3vRZlei/rmGUC9IICjdNTKPWSGmilJdbdxHMUc/MDyfYhxJA69cwI=&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;MCeVIl4QGaJb!yGdTF6FLD!8N7hR4D8Z1bV4mpta08v64kR!MLcolxhea*NOv24M5V!uqHzBvi5dSW9wVHXGqALSe9kML5HKxV12XougeYafX2dcdyxvZ*cYEa6D0l6hIzovUwFpVjv3lqiP66jpzY4KxYMtZqQHf5PN!VGJf52xDKcsIUseoKD98z7olU3E2kyaZqJW8j6o5dBTV!Lmo5DVc31VpGrfeUnwhOcZkO7xN7IUEy8Vs9YXKQ0C4cin4qpyDSQ3pLpwy09ZpVE2bKOt4XQP7JLWQa6iGQ*r8zgewRo7ULYoEpRXYsqSBdwX6pJEQnRzCDcJimHxXBEV59rE*Ykwc9SijTkBN4haK6br9y2YVQ2UKegfQiErCHY33kzmSMAPJUwiooUNc6GytUz5O6ZxsBMghhb6B6NiSBCs!U5xRon1y*zzOsh9EArHk4y2rihu7BkkC13bJqxeMvhw$&quot;,&quot;expiry&quot;:&quot;2020-06-22T20:38:09.8687266+08:00&quot;&#125;</span></span><br><span class=\"line\"><span class=\"string\">drive_id = 58719e3298825c9</span></span><br><span class=\"line\"><span class=\"string\">drive_type = personal</span></span><br><span class=\"line\"><span class=\"string\">--------------------</span></span><br><span class=\"line\"><span class=\"string\">y) Yes this is OK (default)</span></span><br><span class=\"line\"><span class=\"string\">e) Edit this remote</span></span><br><span class=\"line\"><span class=\"string\">d) Delete this remote</span></span><br><span class=\"line\"><span class=\"string\">y/e/d&gt;                   //第十二步 回车</span></span><br><span class=\"line\"><span class=\"string\">Current remotes:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Name                 Type</span></span><br><span class=\"line\"><span class=\"string\">====                 ====</span></span><br><span class=\"line\"><span class=\"string\">Onedrive_local       onedrive          //显示你的设置则成功！</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">e) Edit existing remote</span></span><br><span class=\"line\"><span class=\"string\">n) New remote</span></span><br><span class=\"line\"><span class=\"string\">d) Delete remote</span></span><br><span class=\"line\"><span class=\"string\">r) Rename remote</span></span><br><span class=\"line\"><span class=\"string\">c) Copy remote</span></span><br><span class=\"line\"><span class=\"string\">s) Set configuration password</span></span><br><span class=\"line\"><span class=\"string\">q) Quit config</span></span><br><span class=\"line\"><span class=\"string\">e/n/d/r/c/s/q&gt; q           //第十三步 输入q结束配置</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四：挂载Onedrive到本地\"><a href=\"#四：挂载Onedrive到本地\" class=\"headerlink\" title=\"四：挂载Onedrive到本地\"></a>四：挂载Onedrive到本地</h2><ol>\n<li><del>自行下载安装git</del></li>\n</ol>\n<p><del>此时请使用 <code>git bash</code> 的终端执行以下命令，因为我使用<code>cmd</code> 和 <code>powershell</code> 都出现关闭终端后挂载程序退出、本地挂载的OneDrive退出的现象。 如果你的windows没有安装git ， 请[自行安装](<a href=\"https://www.baidu.com/s?wd=windows\">https://www.baidu.com/s?wd=windows</a> 安装git&amp;ie=utf-8)。若你使用 <code>cmd</code> 的话 ，<code>cmd</code> 是不能退出的，要保持 <code>cmd</code> 不退出本地硬盘才一直挂载着。</del></p>\n<ol start=\"2\">\n<li><del>桌面新建txt文本文件。编辑内容为：</del></li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">start</span> <span class=\"string\">&quot;&quot;</span> <span class=\"string\">&quot;%ProgramFiles%\\Git\\git-bash.exe&quot;</span> <span class=\"literal\">-c</span> <span class=\"string\">&quot;rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes &amp;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><del><code>Onedrive_local</code> 替换为你自己前面设置的名称 。</del></p>\n<p><del><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</del></p>\n<p><del><code>C:\\Users\\97532\\Rclone</code> 为本地缓存目录，可自行设置 。</del></p>\n<p><del>上述代码，使用git bash程序执行rclone挂载磁盘的指令。cmd无法识别<code>&amp;</code>，也就是退出程序继续挂载指令。</del></p>\n<ol start=\"3\">\n<li><del>重命名txt文件为<code>rclone_startup.bat</code></del></li>\n<li><del>双击运行</del></li>\n</ol>\n<p><del><img src=\"C:\\Users\\97532\\AppData\\Roaming\\Typora\\typora-user-images\\image-20200622210455993.png\" alt=\"image-20200622210455993\"></del></p>\n<p><del>出现：<code>The service rclone has been started</code> 或者磁盘列表出现Onedrive，则说明挂载成功。</del></p>\n<ol start=\"5\">\n<li><del>设置开机启动</del></li>\n</ol>\n<p><del>由于git程序在重启后会停止，需要将<code>rclone_startup.bat</code>移动到开机启动文件里，每次开机让磁盘自动挂载。</del></p>\n<p><del>将<code>rclone_startup.bat</code>放在<code>C:\\Users\\用户名\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</code> 中</del></p>\n<p><del><img src=\"https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png\">237.png)</del></p>\n<p><del>现在试试重启电脑。。重启后需要等待十几秒，才会运行git bash程序挂载Onedrive。</del></p>\n<p><del>git bash运行后会有一闪而过的黑色窗口。此时磁盘应该挂载成功了</del>。</p>\n<blockquote>\n<p>删掉上面的方法，是由于步骤太过冗杂，需要安装git bash，而且开机启动时存在一闪而过的黑色窗口，运行后的挂载盘也存在问题。</p>\n</blockquote>\n<hr>\n<p>挂载操作在退出cmd后就自动结束了，所以我们需要让它后台运行。<br>rclone虽然提供了<code>--daemon</code>参数来实行后台运行，但是该参数并不适合于windows环境中。会有如下提示：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ rclone mount GDrive:&#x2F; x: --cache-dir F:\\Temp --vfs-cache-mode writes --daemon</span><br><span class=\"line\">2018&#x2F;05&#x2F;01 09:54:19 background mode not supported on windows platform</span><br></pre></td></tr></table></figure>\n\n<p>所以，我们需要另外想个办法让rclone能够后端运行以及开机自动挂载。</p>\n<ol>\n<li><strong>新建一个文本文件。</strong></li>\n</ol>\n<p>填入以下内容，<strong>请注意修改倒数第二行的<code>WS.Run</code>中相关命令为你上步成功执行的命令</strong>，然后将该文件名改为<code>rclone.vbs</code> （后缀名为<code>.vbs</code>即可）</p>\n<figure class=\"highlight vbscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Option</span> <span class=\"keyword\">Explicit</span></span><br><span class=\"line\"><span class=\"keyword\">Dim</span> WMIService, Process, Processes, Flag, WS</span><br><span class=\"line\"><span class=\"keyword\">Set</span> WMIService = <span class=\"built_in\">GetObject</span>(<span class=\"string\">&quot;winmgmts:&#123;impersonationlevel=impersonate&#125;!\\\\.\\root\\cimv2&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">Set</span> Processes = WMIService.ExecQuery(<span class=\"string\">&quot;select * from win32_process&quot;</span>)</span><br><span class=\"line\">Flag = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> <span class=\"keyword\">each</span> Process <span class=\"keyword\">in</span> Processes</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">strcomp</span>(Process.name, <span class=\"string\">&quot;rclone.exe&quot;</span>) = <span class=\"number\">0</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">        Flag = <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"keyword\">exit</span> <span class=\"keyword\">for</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span> <span class=\"keyword\">if</span></span><br><span class=\"line\"><span class=\"keyword\">next</span></span><br><span class=\"line\"><span class=\"keyword\">Set</span> WMIService = <span class=\"literal\">nothing</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> Flag <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">Set</span> WS = Wscript.<span class=\"built_in\">CreateObject</span>(<span class=\"string\">&quot;Wscript.Shell&quot;</span>)</span><br><span class=\"line\">    WS.Run <span class=\"string\">&quot;rclone mount Onedrive_local:/  Q: --cache-dir C:\\Users\\97532\\Rclone --vfs-cache-mode writes&quot;</span>, <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">if</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><code>Onedrive_local</code> 替换为你自己前面设置的名称 。</p>\n<p><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</p>\n<p><code>C:\\Users\\97532\\Rclone</code> 为本地缓存目录，可自行设置 。</p>\n<p>关于<code>vfs-cache-mode</code>项设置，还是建议看下官方的说明根据自己的需求和网络情况来进行选择 <a href=\"https://rclone.org/commands/rclone_mount/#file-caching\">https://rclone.org/commands/rclone_mount/#file-caching</a> 。这里只做简单说明：</p>\n<ul>\n<li><code>off</code>： 本地不做任何缓存，所有文件直接从云端获取并写入。<strong>建议网速特别好时（复制粘贴大文件时建议至少100M管以上速度）使用。</strong></li>\n<li><code>minimal</code>：（和off类似，但是已经打开的文件会被缓存到本地。<strong>个人推荐，小文件基本够用，但是如果你的网络情况（梯子）不是特别好的话，用writes也行</strong></li>\n<li><code>writes</code>：（如果文件属性为<code>只读</code>则只从云端获取，不然先缓存在本地进行读写操作，随后被同步。<strong>个人推荐使用，但是在直接从本地复制文件到GDrive时还是看网络情况</strong></li>\n<li><code>full</code>：（所有的读写操作都会缓存到磁盘中。然后才会同步。<strong>不是很推荐。会导致所有文件均被缓存到本地。直到达到你缓存总额（–cache-total-chunk-size，默认大小10G）。但是你网速特别差时也可以使用。</strong></li>\n</ul>\n</blockquote>\n<p>如果你需要中断这个挂载操作，请直接在任务管理器中kill掉<code>rclone.exe</code>进程即可。</p>\n<ol start=\"2\">\n<li><strong>开机自启</strong></li>\n</ol>\n<p>将这个文件<code>rclone.vbs</code>复制（或者剪贴）到开机项中<code>C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp</code>（Windows 10）即可实现开机自动挂载~</p>\n<h2 id=\"五：参考资料\"><a href=\"#五：参考资料\" class=\"headerlink\" title=\"五：参考资料\"></a>五：参考资料</h2><p>《<a href=\"https://www.lifeee.top/posts/14654.html\">Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/lilongsy/article/details/89916797\">CMD打开Git Bash</a>》</p>\n<p>《<a href=\"http://www.itkeyword.com/doc/9018080391155886x507/how-to-launch-git-bash-from-dos-command-line\">Windows-如何从DOS命令行启动Git Bash？</a>》</p>\n<p>《<a href=\"https://blog.rhilip.info/archives/874/\">使用rclone在Windows下挂载Google个人/团队云盘</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png","popularPost_tmp_gaData":{"updated":"Mon Jun 22 2020 16:57:05 GMT+0200 (GMT+02:00)","title":"Rclone在win上挂在Onedrive","path":"2020/06/22/Rclone在win上挂在Onedrive/","eyeCatchImage":"https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-22T18:07:26.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-22T18:07:26.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Windows","tags":["Rclone"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"SSR加速和降低服务器端口被封风险","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-08T13:22:38.000Z","password":null,"summary":"在使用ssr进行外网连接时，可能会遇到访问特别慢，youtube 1080P缓冲缓慢的问题。而如果用的服务器是自己租用的，ssr也是自己搭建的。按照服务器给的带宽，不应该存在如此慢的播放速度。如果存在，你需要查看，你正在连接ssr的手机或wifi网络是不是中国移动。https://speedtest.cn 可以帮助你检查你正在使用的是不是移动网络，如果是，那你很有必要阅读此文章对ssr进行加速。非BBR内核加速，需要一台国内电信优化的服务器。","_content":"\n另外需要说明的是，购买的国内服务器，不需要进行备案，你可以帮定一个域名到此服务器上，填写ssr客户端也只需要使用这个域名，ssr会自动帮你查询dns，此后即便国外ssr出现端口或ip被封，也不需要更改ssr客户端的配置信息。而只需要另起一台国外服务器，修改国内中转服务器的配置信息。\n\n如果你懂得更多编程知识，你可以在国内国外的两台服务器上进行编程，实现，当国外服务器端口被封，国内和国外服务器自动检测，若检测到端口被封，则国外服务器修改ssr配置端口，而国内服务器修改stunnel配置信息。这样，无需人为干预，也能实现长久而稳定的连接。如果有空的话，我会去探索这个方案。\n\n# 1：原理说明\n\n简单了解，可以提高你对网络的认识。\n\n## 1.1 ssr网络加速原理\n\n由于中国移动对普通用户的海外流量随机高概率丢包，导致国外流量进入国内时，走移动线路，就会有很高的丢包率。所以我们希望借助一台，属于移动vip级别的国内服务器（这样移动出海线路优先级高，不容易丢包），或者出入海走联通电信线路的服务器。通常，阿里云、腾讯云服务器都能满足要求。\n\n国内服务器上安装stunnel，并配置为客户端。国外服务器安装stunnel服务端和ssr服务端。\n\n![](https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg)\n\n## 1.2 降低端口被封的风险原理\n\nstunnel是一个将流量利用ssl证书加密的软件，加密后的流量，出国时将会被识别为tls协议，因此不再具有ssr流量特点，我们常使用的https请求便基于ssl证书，此时国外服务器端口被封锁的几率将大大减小。出国后，stunnel将流量解密，再传递给ssr服务端。\n\n通过抓取ssr流量，可以看到，ssr流量在传输过程中，由于协议加密，它不具备任何常见的网络请求特征，而你在使用ssr与海外服务器进行数据往来时，长时间的使用不具有网络请求特征的流量进行连接，很容易被防火墙识别为翻墙软件。因此被封。使用tls协议，就能够伪装为https请求，https(http协议+tls协议)。当然为了更有迷惑性，在ssr服务器端口加一个能被访问的网站是最好的。因为虽然tls协议作为https的一部分，但在实际使用中，由于没有http协议的流量，那么是能被推断出使用stunnel这类加密隧道的。如果长时间大流量访问，也有被封锁的风险。\n\n而使用中转服务器，所付出的代价，仅仅是国内月租几块钱的服务器(阿里云、腾讯云等有学生服务器，一年一百块左右)，和相当低的stunnel加解密过程所导致的延迟，此延迟几乎不可见。\n\n# 2：stunnel和ssr安装\n\n## 2.1 stunnel安装和配置\n\nstunnel安装，请参见我之间的文章《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》。\n\n> 3.2节是在国外服务器上安装stunnel服务端。第四章，在国内服务器上安装stunnel客户端。\n\n将ssr的流量通过stunnel加密，你需要修改配置文件。在《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》安装后的stunnel基础上修改。\n\n\n\n修改国外服务器上的stunnel服务端配置文件，在`/etc/stunnel/stunnel.conf`文件里，\n\n删除\n\n```\n[squid-proxy]\n; 服务监听的端口，client要连接这个端口与server通信\naccept = 3129\n; 服务要连接的端口，连接到squid的3128端口，将数据发给squid\nconnect = localhost:3128\n```\n\n添加\n\n```shell\n[tls2socks]\n;服务端监听一个端口，这个端口用于接收stunnel客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放，例如设置为：accept = 12345\naccpet = your accept port 1\n;连接到，ssr的服务器端口上，与ssr服务端配置的端口保持一致\nconnect = localhost:your ssr server port\n```\n\n\n\n修改国内中转服务器上的stunnel客户端配置文件，在`/etc/stunnel/stunnel.conf`文件里，\n\n删除\n\n```shell\n[squid-proxy]\n; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128\naccept = 3128\n; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器\nconnect = xx.xx.xx.xx:3129\n```\n\n添加\n\n```shell\n[socks2tls]\n;服务端监听一个端口，这个端口用于接收ssr客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放。例如 accept = 34567\naccpet = your accept port 2\n;连接到，stunnel服务端接收端口上。按照该服务端的例如配置，这里应该为：connect = xx.xx.xx.xx:12345。xx表示国外服务器ip地址。\nconnect = stunnel server ip:your accept port 1\n```\n\n## 2.2 ssr安装和配置\n\nssr安装，可以参考《[SSR 一键安装脚本](https://ssr.tools/31)》，在国外的服务器上安装。\n\nssr服务端端口需要和stunnel服务端的`connect`端口保持一致。\n\nssr客户端配置，客户端地址，应该填写为国内服务器ip，服务端口，应填写为stunnel客户端的`accept`端口(国内服务器上配置的accept = your accept port 2)，例子中给的34567端口。\n\n配置完成后，就可以连接上网了。\n\n即便使用移动网络，也能产生非常好的连接效果，而且应该在非常久得时间里，端口都不会被封。\n\n# 3：可能出现的问题\n\n如果配置后无法上网，请检查你设置得端口，通过 https://port.ping.pe 网址检测你的端口是否开启，如果测试未开启，请修改防火墙配置，在《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》中第4章有介绍。若任然没有导通，请检查云服务商的安全组是否开启了端口。\n\n如果端口开放，而无法连接，请尝试，终止stunnel进程并重新启用。\n\n方法1：\n\n```shell\nservicer stunnel restart\n```\n\n方法2:\n\n检查stunnel的进程\n\n```shell\nps aux | grep -i stunnel\n```\n\n找到进程号pid，在第二列\n\n杀掉进程\n\n```\nkill -9 替换为pid\n```\n\n然后重新启用stunnel\n\n```shell\nstunnel\n```\n\n如果没有任何显示，则stunnel重启成功，且配置文件没有任何问题。否则将显示错误信息。","source":"_posts/SSR加速和降低服务器端口被封风险.md","raw":"---\ntitle: SSR加速和降低服务器端口被封风险\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-08 15:22:38\npassword:\nsummary: 在使用ssr进行外网连接时，可能会遇到访问特别慢，youtube 1080P缓冲缓慢的问题。而如果用的服务器是自己租用的，ssr也是自己搭建的。按照服务器给的带宽，不应该存在如此慢的播放速度。如果存在，你需要查看，你正在连接ssr的手机或wifi网络是不是中国移动。https://speedtest.cn 可以帮助你检查你正在使用的是不是移动网络，如果是，那你很有必要阅读此文章对ssr进行加速。非BBR内核加速，需要一台国内电信优化的服务器。\ntags: \n  - SSR\n  - Stunnel\ncategories: Linux\n---\n\n另外需要说明的是，购买的国内服务器，不需要进行备案，你可以帮定一个域名到此服务器上，填写ssr客户端也只需要使用这个域名，ssr会自动帮你查询dns，此后即便国外ssr出现端口或ip被封，也不需要更改ssr客户端的配置信息。而只需要另起一台国外服务器，修改国内中转服务器的配置信息。\n\n如果你懂得更多编程知识，你可以在国内国外的两台服务器上进行编程，实现，当国外服务器端口被封，国内和国外服务器自动检测，若检测到端口被封，则国外服务器修改ssr配置端口，而国内服务器修改stunnel配置信息。这样，无需人为干预，也能实现长久而稳定的连接。如果有空的话，我会去探索这个方案。\n\n# 1：原理说明\n\n简单了解，可以提高你对网络的认识。\n\n## 1.1 ssr网络加速原理\n\n由于中国移动对普通用户的海外流量随机高概率丢包，导致国外流量进入国内时，走移动线路，就会有很高的丢包率。所以我们希望借助一台，属于移动vip级别的国内服务器（这样移动出海线路优先级高，不容易丢包），或者出入海走联通电信线路的服务器。通常，阿里云、腾讯云服务器都能满足要求。\n\n国内服务器上安装stunnel，并配置为客户端。国外服务器安装stunnel服务端和ssr服务端。\n\n![](https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg)\n\n## 1.2 降低端口被封的风险原理\n\nstunnel是一个将流量利用ssl证书加密的软件，加密后的流量，出国时将会被识别为tls协议，因此不再具有ssr流量特点，我们常使用的https请求便基于ssl证书，此时国外服务器端口被封锁的几率将大大减小。出国后，stunnel将流量解密，再传递给ssr服务端。\n\n通过抓取ssr流量，可以看到，ssr流量在传输过程中，由于协议加密，它不具备任何常见的网络请求特征，而你在使用ssr与海外服务器进行数据往来时，长时间的使用不具有网络请求特征的流量进行连接，很容易被防火墙识别为翻墙软件。因此被封。使用tls协议，就能够伪装为https请求，https(http协议+tls协议)。当然为了更有迷惑性，在ssr服务器端口加一个能被访问的网站是最好的。因为虽然tls协议作为https的一部分，但在实际使用中，由于没有http协议的流量，那么是能被推断出使用stunnel这类加密隧道的。如果长时间大流量访问，也有被封锁的风险。\n\n而使用中转服务器，所付出的代价，仅仅是国内月租几块钱的服务器(阿里云、腾讯云等有学生服务器，一年一百块左右)，和相当低的stunnel加解密过程所导致的延迟，此延迟几乎不可见。\n\n# 2：stunnel和ssr安装\n\n## 2.1 stunnel安装和配置\n\nstunnel安装，请参见我之间的文章《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》。\n\n> 3.2节是在国外服务器上安装stunnel服务端。第四章，在国内服务器上安装stunnel客户端。\n\n将ssr的流量通过stunnel加密，你需要修改配置文件。在《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》安装后的stunnel基础上修改。\n\n\n\n修改国外服务器上的stunnel服务端配置文件，在`/etc/stunnel/stunnel.conf`文件里，\n\n删除\n\n```\n[squid-proxy]\n; 服务监听的端口，client要连接这个端口与server通信\naccept = 3129\n; 服务要连接的端口，连接到squid的3128端口，将数据发给squid\nconnect = localhost:3128\n```\n\n添加\n\n```shell\n[tls2socks]\n;服务端监听一个端口，这个端口用于接收stunnel客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放，例如设置为：accept = 12345\naccpet = your accept port 1\n;连接到，ssr的服务器端口上，与ssr服务端配置的端口保持一致\nconnect = localhost:your ssr server port\n```\n\n\n\n修改国内中转服务器上的stunnel客户端配置文件，在`/etc/stunnel/stunnel.conf`文件里，\n\n删除\n\n```shell\n[squid-proxy]\n; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128\naccept = 3128\n; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器\nconnect = xx.xx.xx.xx:3129\n```\n\n添加\n\n```shell\n[socks2tls]\n;服务端监听一个端口，这个端口用于接收ssr客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放。例如 accept = 34567\naccpet = your accept port 2\n;连接到，stunnel服务端接收端口上。按照该服务端的例如配置，这里应该为：connect = xx.xx.xx.xx:12345。xx表示国外服务器ip地址。\nconnect = stunnel server ip:your accept port 1\n```\n\n## 2.2 ssr安装和配置\n\nssr安装，可以参考《[SSR 一键安装脚本](https://ssr.tools/31)》，在国外的服务器上安装。\n\nssr服务端端口需要和stunnel服务端的`connect`端口保持一致。\n\nssr客户端配置，客户端地址，应该填写为国内服务器ip，服务端口，应填写为stunnel客户端的`accept`端口(国内服务器上配置的accept = your accept port 2)，例子中给的34567端口。\n\n配置完成后，就可以连接上网了。\n\n即便使用移动网络，也能产生非常好的连接效果，而且应该在非常久得时间里，端口都不会被封。\n\n# 3：可能出现的问题\n\n如果配置后无法上网，请检查你设置得端口，通过 https://port.ping.pe 网址检测你的端口是否开启，如果测试未开启，请修改防火墙配置，在《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》中第4章有介绍。若任然没有导通，请检查云服务商的安全组是否开启了端口。\n\n如果端口开放，而无法连接，请尝试，终止stunnel进程并重新启用。\n\n方法1：\n\n```shell\nservicer stunnel restart\n```\n\n方法2:\n\n检查stunnel的进程\n\n```shell\nps aux | grep -i stunnel\n```\n\n找到进程号pid，在第二列\n\n杀掉进程\n\n```\nkill -9 替换为pid\n```\n\n然后重新启用stunnel\n\n```shell\nstunnel\n```\n\n如果没有任何显示，则stunnel重启成功，且配置文件没有任何问题。否则将显示错误信息。","slug":"SSR加速和降低服务器端口被封风险","published":1,"updated":"2020-11-15T08:59:29.616Z","_id":"ckgaxsab80015p0vzalaq5bcz","comments":1,"layout":"post","photos":[],"link":"","content":"<p>另外需要说明的是，购买的国内服务器，不需要进行备案，你可以帮定一个域名到此服务器上，填写ssr客户端也只需要使用这个域名，ssr会自动帮你查询dns，此后即便国外ssr出现端口或ip被封，也不需要更改ssr客户端的配置信息。而只需要另起一台国外服务器，修改国内中转服务器的配置信息。</p>\n<p>如果你懂得更多编程知识，你可以在国内国外的两台服务器上进行编程，实现，当国外服务器端口被封，国内和国外服务器自动检测，若检测到端口被封，则国外服务器修改ssr配置端口，而国内服务器修改stunnel配置信息。这样，无需人为干预，也能实现长久而稳定的连接。如果有空的话，我会去探索这个方案。</p>\n<h1 id=\"1：原理说明\"><a href=\"#1：原理说明\" class=\"headerlink\" title=\"1：原理说明\"></a>1：原理说明</h1><p>简单了解，可以提高你对网络的认识。</p>\n<h2 id=\"1-1-ssr网络加速原理\"><a href=\"#1-1-ssr网络加速原理\" class=\"headerlink\" title=\"1.1 ssr网络加速原理\"></a>1.1 ssr网络加速原理</h2><p>由于中国移动对普通用户的海外流量随机高概率丢包，导致国外流量进入国内时，走移动线路，就会有很高的丢包率。所以我们希望借助一台，属于移动vip级别的国内服务器（这样移动出海线路优先级高，不容易丢包），或者出入海走联通电信线路的服务器。通常，阿里云、腾讯云服务器都能满足要求。</p>\n<p>国内服务器上安装stunnel，并配置为客户端。国外服务器安装stunnel服务端和ssr服务端。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"1-2-降低端口被封的风险原理\"><a href=\"#1-2-降低端口被封的风险原理\" class=\"headerlink\" title=\"1.2 降低端口被封的风险原理\"></a>1.2 降低端口被封的风险原理</h2><p>stunnel是一个将流量利用ssl证书加密的软件，加密后的流量，出国时将会被识别为tls协议，因此不再具有ssr流量特点，我们常使用的https请求便基于ssl证书，此时国外服务器端口被封锁的几率将大大减小。出国后，stunnel将流量解密，再传递给ssr服务端。</p>\n<p>通过抓取ssr流量，可以看到，ssr流量在传输过程中，由于协议加密，它不具备任何常见的网络请求特征，而你在使用ssr与海外服务器进行数据往来时，长时间的使用不具有网络请求特征的流量进行连接，很容易被防火墙识别为翻墙软件。因此被封。使用tls协议，就能够伪装为https请求，https(http协议+tls协议)。当然为了更有迷惑性，在ssr服务器端口加一个能被访问的网站是最好的。因为虽然tls协议作为https的一部分，但在实际使用中，由于没有http协议的流量，那么是能被推断出使用stunnel这类加密隧道的。如果长时间大流量访问，也有被封锁的风险。</p>\n<p>而使用中转服务器，所付出的代价，仅仅是国内月租几块钱的服务器(阿里云、腾讯云等有学生服务器，一年一百块左右)，和相当低的stunnel加解密过程所导致的延迟，此延迟几乎不可见。</p>\n<h1 id=\"2：stunnel和ssr安装\"><a href=\"#2：stunnel和ssr安装\" class=\"headerlink\" title=\"2：stunnel和ssr安装\"></a>2：stunnel和ssr安装</h1><h2 id=\"2-1-stunnel安装和配置\"><a href=\"#2-1-stunnel安装和配置\" class=\"headerlink\" title=\"2.1 stunnel安装和配置\"></a>2.1 stunnel安装和配置</h2><p>stunnel安装，请参见我之间的文章《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》。</p>\n<blockquote>\n<p>3.2节是在国外服务器上安装stunnel服务端。第四章，在国内服务器上安装stunnel客户端。</p>\n</blockquote>\n<p>将ssr的流量通过stunnel加密，你需要修改配置文件。在《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》安装后的stunnel基础上修改。</p>\n<p>修改国外服务器上的stunnel服务端配置文件，在<code>/etc/stunnel/stunnel.conf</code>文件里，</p>\n<p>删除</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class=\"line\">accept &#x3D; 3129</span><br><span class=\"line\">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class=\"line\">connect &#x3D; localhost:3128</span><br></pre></td></tr></table></figure>\n\n<p>添加</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[tls2socks]</span><br><span class=\"line\">;服务端监听一个端口，这个端口用于接收stunnel客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放，例如设置为：accept = 12345</span><br><span class=\"line\">accpet = your accept port 1</span><br><span class=\"line\">;连接到，ssr的服务器端口上，与ssr服务端配置的端口保持一致</span><br><span class=\"line\">connect = localhost:your ssr server port</span><br></pre></td></tr></table></figure>\n\n\n\n<p>修改国内中转服务器上的stunnel客户端配置文件，在<code>/etc/stunnel/stunnel.conf</code>文件里，</p>\n<p>删除</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class=\"line\">accept = 3128</span><br><span class=\"line\">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class=\"line\">connect = xx.xx.xx.xx:3129</span><br></pre></td></tr></table></figure>\n\n<p>添加</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[socks2tls]</span><br><span class=\"line\">;服务端监听一个端口，这个端口用于接收ssr客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放。例如 accept = 34567</span><br><span class=\"line\">accpet = your accept port 2</span><br><span class=\"line\">;连接到，stunnel服务端接收端口上。按照该服务端的例如配置，这里应该为：connect = xx.xx.xx.xx:12345。xx表示国外服务器ip地址。</span><br><span class=\"line\">connect = stunnel server ip:your accept port 1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-ssr安装和配置\"><a href=\"#2-2-ssr安装和配置\" class=\"headerlink\" title=\"2.2 ssr安装和配置\"></a>2.2 ssr安装和配置</h2><p>ssr安装，可以参考《<a href=\"https://ssr.tools/31\">SSR 一键安装脚本</a>》，在国外的服务器上安装。</p>\n<p>ssr服务端端口需要和stunnel服务端的<code>connect</code>端口保持一致。</p>\n<p>ssr客户端配置，客户端地址，应该填写为国内服务器ip，服务端口，应填写为stunnel客户端的<code>accept</code>端口(国内服务器上配置的accept = your accept port 2)，例子中给的34567端口。</p>\n<p>配置完成后，就可以连接上网了。</p>\n<p>即便使用移动网络，也能产生非常好的连接效果，而且应该在非常久得时间里，端口都不会被封。</p>\n<h1 id=\"3：可能出现的问题\"><a href=\"#3：可能出现的问题\" class=\"headerlink\" title=\"3：可能出现的问题\"></a>3：可能出现的问题</h1><p>如果配置后无法上网，请检查你设置得端口，通过 <a href=\"https://port.ping.pe/\">https://port.ping.pe</a> 网址检测你的端口是否开启，如果测试未开启，请修改防火墙配置，在《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》中第4章有介绍。若任然没有导通，请检查云服务商的安全组是否开启了端口。</p>\n<p>如果端口开放，而无法连接，请尝试，终止stunnel进程并重新启用。</p>\n<p>方法1：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">servicer stunnel restart</span><br></pre></td></tr></table></figure>\n\n<p>方法2:</p>\n<p>检查stunnel的进程</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps aux | grep -i stunnel</span><br></pre></td></tr></table></figure>\n\n<p>找到进程号pid，在第二列</p>\n<p>杀掉进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kill -9 替换为pid</span><br></pre></td></tr></table></figure>\n\n<p>然后重新启用stunnel</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stunnel</span><br></pre></td></tr></table></figure>\n\n<p>如果没有任何显示，则stunnel重启成功，且配置文件没有任何问题。否则将显示错误信息。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>另外需要说明的是，购买的国内服务器，不需要进行备案，你可以帮定一个域名到此服务器上，填写ssr客户端也只需要使用这个域名，ssr会自动帮你查询dns，此后即便国外ssr出现端口或ip被封，也不需要更改ssr客户端的配置信息。而只需要另起一台国外服务器，修改国内中转服务器的配置信息。</p>\n<p>如果你懂得更多编程知识，你可以在国内国外的两台服务器上进行编程，实现，当国外服务器端口被封，国内和国外服务器自动检测，若检测到端口被封，则国外服务器修改ssr配置端口，而国内服务器修改stunnel配置信息。这样，无需人为干预，也能实现长久而稳定的连接。如果有空的话，我会去探索这个方案。</p>\n<h1 id=\"1：原理说明\"><a href=\"#1：原理说明\" class=\"headerlink\" title=\"1：原理说明\"></a>1：原理说明</h1><p>简单了解，可以提高你对网络的认识。</p>\n<h2 id=\"1-1-ssr网络加速原理\"><a href=\"#1-1-ssr网络加速原理\" class=\"headerlink\" title=\"1.1 ssr网络加速原理\"></a>1.1 ssr网络加速原理</h2><p>由于中国移动对普通用户的海外流量随机高概率丢包，导致国外流量进入国内时，走移动线路，就会有很高的丢包率。所以我们希望借助一台，属于移动vip级别的国内服务器（这样移动出海线路优先级高，不容易丢包），或者出入海走联通电信线路的服务器。通常，阿里云、腾讯云服务器都能满足要求。</p>\n<p>国内服务器上安装stunnel，并配置为客户端。国外服务器安装stunnel服务端和ssr服务端。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg\"></p>\n<h2 id=\"1-2-降低端口被封的风险原理\"><a href=\"#1-2-降低端口被封的风险原理\" class=\"headerlink\" title=\"1.2 降低端口被封的风险原理\"></a>1.2 降低端口被封的风险原理</h2><p>stunnel是一个将流量利用ssl证书加密的软件，加密后的流量，出国时将会被识别为tls协议，因此不再具有ssr流量特点，我们常使用的https请求便基于ssl证书，此时国外服务器端口被封锁的几率将大大减小。出国后，stunnel将流量解密，再传递给ssr服务端。</p>\n<p>通过抓取ssr流量，可以看到，ssr流量在传输过程中，由于协议加密，它不具备任何常见的网络请求特征，而你在使用ssr与海外服务器进行数据往来时，长时间的使用不具有网络请求特征的流量进行连接，很容易被防火墙识别为翻墙软件。因此被封。使用tls协议，就能够伪装为https请求，https(http协议+tls协议)。当然为了更有迷惑性，在ssr服务器端口加一个能被访问的网站是最好的。因为虽然tls协议作为https的一部分，但在实际使用中，由于没有http协议的流量，那么是能被推断出使用stunnel这类加密隧道的。如果长时间大流量访问，也有被封锁的风险。</p>\n<p>而使用中转服务器，所付出的代价，仅仅是国内月租几块钱的服务器(阿里云、腾讯云等有学生服务器，一年一百块左右)，和相当低的stunnel加解密过程所导致的延迟，此延迟几乎不可见。</p>\n<h1 id=\"2：stunnel和ssr安装\"><a href=\"#2：stunnel和ssr安装\" class=\"headerlink\" title=\"2：stunnel和ssr安装\"></a>2：stunnel和ssr安装</h1><h2 id=\"2-1-stunnel安装和配置\"><a href=\"#2-1-stunnel安装和配置\" class=\"headerlink\" title=\"2.1 stunnel安装和配置\"></a>2.1 stunnel安装和配置</h2><p>stunnel安装，请参见我之间的文章《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》。</p>\n<blockquote>\n<p>3.2节是在国外服务器上安装stunnel服务端。第四章，在国内服务器上安装stunnel客户端。</p>\n</blockquote>\n<p>将ssr的流量通过stunnel加密，你需要修改配置文件。在《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》安装后的stunnel基础上修改。</p>\n<p>修改国外服务器上的stunnel服务端配置文件，在<code>/etc/stunnel/stunnel.conf</code>文件里，</p>\n<p>删除</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class=\"line\">accept &#x3D; 3129</span><br><span class=\"line\">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class=\"line\">connect &#x3D; localhost:3128</span><br></pre></td></tr></table></figure>\n\n<p>添加</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[tls2socks]</span><br><span class=\"line\">;服务端监听一个端口，这个端口用于接收stunnel客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放，例如设置为：accept = 12345</span><br><span class=\"line\">accpet = your accept port 1</span><br><span class=\"line\">;连接到，ssr的服务器端口上，与ssr服务端配置的端口保持一致</span><br><span class=\"line\">connect = localhost:your ssr server port</span><br></pre></td></tr></table></figure>\n\n\n\n<p>修改国内中转服务器上的stunnel客户端配置文件，在<code>/etc/stunnel/stunnel.conf</code>文件里，</p>\n<p>删除</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class=\"line\">accept = 3128</span><br><span class=\"line\">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class=\"line\">connect = xx.xx.xx.xx:3129</span><br></pre></td></tr></table></figure>\n\n<p>添加</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[socks2tls]</span><br><span class=\"line\">;服务端监听一个端口，这个端口用于接收ssr客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放。例如 accept = 34567</span><br><span class=\"line\">accpet = your accept port 2</span><br><span class=\"line\">;连接到，stunnel服务端接收端口上。按照该服务端的例如配置，这里应该为：connect = xx.xx.xx.xx:12345。xx表示国外服务器ip地址。</span><br><span class=\"line\">connect = stunnel server ip:your accept port 1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-ssr安装和配置\"><a href=\"#2-2-ssr安装和配置\" class=\"headerlink\" title=\"2.2 ssr安装和配置\"></a>2.2 ssr安装和配置</h2><p>ssr安装，可以参考《<a href=\"https://ssr.tools/31\">SSR 一键安装脚本</a>》，在国外的服务器上安装。</p>\n<p>ssr服务端端口需要和stunnel服务端的<code>connect</code>端口保持一致。</p>\n<p>ssr客户端配置，客户端地址，应该填写为国内服务器ip，服务端口，应填写为stunnel客户端的<code>accept</code>端口(国内服务器上配置的accept = your accept port 2)，例子中给的34567端口。</p>\n<p>配置完成后，就可以连接上网了。</p>\n<p>即便使用移动网络，也能产生非常好的连接效果，而且应该在非常久得时间里，端口都不会被封。</p>\n<h1 id=\"3：可能出现的问题\"><a href=\"#3：可能出现的问题\" class=\"headerlink\" title=\"3：可能出现的问题\"></a>3：可能出现的问题</h1><p>如果配置后无法上网，请检查你设置得端口，通过 <a href=\"https://port.ping.pe/\">https://port.ping.pe</a> 网址检测你的端口是否开启，如果测试未开启，请修改防火墙配置，在《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》中第4章有介绍。若任然没有导通，请检查云服务商的安全组是否开启了端口。</p>\n<p>如果端口开放，而无法连接，请尝试，终止stunnel进程并重新启用。</p>\n<p>方法1：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">servicer stunnel restart</span><br></pre></td></tr></table></figure>\n\n<p>方法2:</p>\n<p>检查stunnel的进程</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps aux | grep -i stunnel</span><br></pre></td></tr></table></figure>\n\n<p>找到进程号pid，在第二列</p>\n<p>杀掉进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kill -9 替换为pid</span><br></pre></td></tr></table></figure>\n\n<p>然后重新启用stunnel</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stunnel</span><br></pre></td></tr></table></figure>\n\n<p>如果没有任何显示，则stunnel重启成功，且配置文件没有任何问题。否则将显示错误信息。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg","popularPost_tmp_gaData":{"updated":"Sun Nov 15 2020 09:59:29 GMT+0100 (GMT+01:00)","title":"SSR加速和降低服务器端口被封风险","path":"2020/06/08/SSR加速和降低服务器端口被封风险/","eyeCatchImage":"https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-08T13:22:38.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-08T13:22:38.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Linux","tags":["SSR","Stunnel"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"SSR负载均衡实现自动切换端口","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-15T23:09:41.000Z","password":null,"summary":"如果使用ssr自带的协议和加密算法连接外网，会经常性被封锁端口。多次端口封锁后，会被封锁ip。后来我引入了tls协议，在国内服务器上对ssr流量使用ssl证书加密，伪装成常见的https流量，再转发给国外ssr服务器。这种方案，极大地降低了端口被封锁的风险。为了确保ssr长期存活，我又决定利用负载均衡技术，在国内中转服务器上加一个代理软件haproxy。haproxy能自动检测国外服务器端口是否被封锁，如果被封锁则切换端口。我在国外服务器上预留了三个长期开放的端口，只有某个端口被封时，另外两个端口才可能被使用。这种方法也适用于多个ip。可在一个ip被封锁后，切换为另一个ip。","_content":"\n# 1：准备工作\n\n- 一台国内服务器。\n\n国内服务器可以监控到国外的服务器ip或者端口是否被封锁。如果你用国外的服务器，也能做到负载均衡，但是如果这台服务器被封锁，那SSR还是会断开连接。国内服务器不会被封锁。\n\n- SSR添加多个端口或者多台SSR服务器\n\n修改SSR配置文件，监听多个端口《[SSR添加多用户多端口教程](https://ssr.tools/194)》，我监听的是34567、34568、34569。\n\n> 注意：不同端口或者IP的密码和协议等等都必须相同。\n\n# 2：haproxy下载和配置\n\n在Ubuntu上下载：\n\n```shell\napt-get -y install haproxy\n```\n\n在centos上：\n\n```shell\nyum -y install haproxy\n```\n\n安装完毕后，打开haproxy配置文件`/etc/haproxy/haproxy.cfg`，修改配置为：\n\n```\nglobal\n    log /dev/log local0\n    log /dev/log local1 notice\n    user root\n    group root\n    daemon\n\ndefaults\n    log global\n    mode tcp\n    timeout connect 5s\n    timeout client 5s\n    timeout server 5s\n    option      dontlognull\n    option      redispatch\n    retries     3\n\nlisten status\n  bind *:1111\n  mode  http\n  stats refresh 30s\n  stats uri /status\n  stats realm Haproxy  \n  stats auth admin:admin\n  stats hide-version\n  stats admin if TRUE\n\nfrontend shadowsocks-in\n    mode tcp\n    bind *:8388\n    default_backend shadowsocks-out\n\nbackend shadowsocks-out\n    mode tcp\n    option      tcp-check\n    balance roundrobin\n    server  servername1    xxxxx1.com:8088  check\n    server  servername2    xxxxx2.net:8080  check\n    server  servername3    12.34.56.78:9999  check\n    server  servername4    123.234.234.123:443  check\n```\n\n配置分为五大部分：\n\n- **global**：全局配置，这里主要是配置了日志\n- **默认值**：默认配置，也是一些分布式配置\n- **听**：监听配置，我在`1111`端口配置了http监控页面，访问`ip:1111/status`，认证用户名和密码都是`admin`，具体含义参考博客[“ haproxy监控页面和页面详细参数”](https://www.centos.bz/2018/01/haproxy监控页面-和页面详细参数/)\n- **frontend**：前端配置，Shadowsocks数据流从这里进入，流向指定标题，注意这里的端口号，即为ss客户端的输入端口\n- **backend**：调整配置，`balance`指定负载平衡方式，每个服务器写一个服务器行，服务器支持域名或IP。如果使用域名，重启服务出现问题，可以参考博客[“解决Haproxy用Systemd启动失败的问题”](https://www.solarck.com/systemd-wait-network-online.html)。\n\n# 3：其他负载均衡方式\n\n《[shadowsocks借助nginx实现负载均衡，自动切换“零”宕机](https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/)》介绍了使用nginx的方法。也可以尝试。\n\n我之前使用过apache来做负载均衡，但是无法连接，查看apache日志后提示如下：\n\n```verilog\n[Tue Jun 16 00:07:30.557609 2020] [core:debug] [pid 25543:tid 140127116449536] protocol.c(1335): [client 127.0.0.1:57310] AH00566: request failed: malformed request line\n```\n\n意思是请求行格式错误。刚开始以为配置错了。阅读apache的相关资料后才知道。\n\n> apache在做负载均衡时，只是对子目录进行了替换，比如说，你监听1234端口，将发送给主机1234端口的数据均衡发送给192.1.1.1:5678、192.1.1.2:6789。那么你在访问baidu.com/test 时，将你的请求发送给1234端口，而apache做的仅仅只是将请求HOST替换掉。真实请求地址是192.1.1.1:5678/test 或者192.1.1.2:6789/test 。。而ssr加密后的数据，是没有http请求头的，这便导致了，日志所显示的请求行格式错误。所以apache并不适合做单纯的数据转发。\n\n# 4：参考文献\n\n《[用Haproxy实现多VPS线路负载均衡](https://tianws.github.io/skill/2019/07/11/gfw/)》\n\n《[shadowsocks借助nginx实现负载均衡，自动切换“零”宕机](https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/)》\n\n《[Haproxy（二）之负载均衡配置详解](https://www.jianshu.com/p/a7e3199a0a09)》\n\n《[Apache 正向代理与反向代理配置](https://blog.csdn.net/sforiz/article/details/79651643)》\n\n","source":"_posts/SSR负载均衡实现自动切换端口.md","raw":"---\ntitle: SSR负载均衡实现自动切换端口\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-16 01:09:41\npassword:\nsummary: 如果使用ssr自带的协议和加密算法连接外网，会经常性被封锁端口。多次端口封锁后，会被封锁ip。后来我引入了tls协议，在国内服务器上对ssr流量使用ssl证书加密，伪装成常见的https流量，再转发给国外ssr服务器。这种方案，极大地降低了端口被封锁的风险。为了确保ssr长期存活，我又决定利用负载均衡技术，在国内中转服务器上加一个代理软件haproxy。haproxy能自动检测国外服务器端口是否被封锁，如果被封锁则切换端口。我在国外服务器上预留了三个长期开放的端口，只有某个端口被封时，另外两个端口才可能被使用。这种方法也适用于多个ip。可在一个ip被封锁后，切换为另一个ip。\ntags: \n - SSR\n - haproxy\n - 负载均衡\ncategories: Linux\n---\n\n# 1：准备工作\n\n- 一台国内服务器。\n\n国内服务器可以监控到国外的服务器ip或者端口是否被封锁。如果你用国外的服务器，也能做到负载均衡，但是如果这台服务器被封锁，那SSR还是会断开连接。国内服务器不会被封锁。\n\n- SSR添加多个端口或者多台SSR服务器\n\n修改SSR配置文件，监听多个端口《[SSR添加多用户多端口教程](https://ssr.tools/194)》，我监听的是34567、34568、34569。\n\n> 注意：不同端口或者IP的密码和协议等等都必须相同。\n\n# 2：haproxy下载和配置\n\n在Ubuntu上下载：\n\n```shell\napt-get -y install haproxy\n```\n\n在centos上：\n\n```shell\nyum -y install haproxy\n```\n\n安装完毕后，打开haproxy配置文件`/etc/haproxy/haproxy.cfg`，修改配置为：\n\n```\nglobal\n    log /dev/log local0\n    log /dev/log local1 notice\n    user root\n    group root\n    daemon\n\ndefaults\n    log global\n    mode tcp\n    timeout connect 5s\n    timeout client 5s\n    timeout server 5s\n    option      dontlognull\n    option      redispatch\n    retries     3\n\nlisten status\n  bind *:1111\n  mode  http\n  stats refresh 30s\n  stats uri /status\n  stats realm Haproxy  \n  stats auth admin:admin\n  stats hide-version\n  stats admin if TRUE\n\nfrontend shadowsocks-in\n    mode tcp\n    bind *:8388\n    default_backend shadowsocks-out\n\nbackend shadowsocks-out\n    mode tcp\n    option      tcp-check\n    balance roundrobin\n    server  servername1    xxxxx1.com:8088  check\n    server  servername2    xxxxx2.net:8080  check\n    server  servername3    12.34.56.78:9999  check\n    server  servername4    123.234.234.123:443  check\n```\n\n配置分为五大部分：\n\n- **global**：全局配置，这里主要是配置了日志\n- **默认值**：默认配置，也是一些分布式配置\n- **听**：监听配置，我在`1111`端口配置了http监控页面，访问`ip:1111/status`，认证用户名和密码都是`admin`，具体含义参考博客[“ haproxy监控页面和页面详细参数”](https://www.centos.bz/2018/01/haproxy监控页面-和页面详细参数/)\n- **frontend**：前端配置，Shadowsocks数据流从这里进入，流向指定标题，注意这里的端口号，即为ss客户端的输入端口\n- **backend**：调整配置，`balance`指定负载平衡方式，每个服务器写一个服务器行，服务器支持域名或IP。如果使用域名，重启服务出现问题，可以参考博客[“解决Haproxy用Systemd启动失败的问题”](https://www.solarck.com/systemd-wait-network-online.html)。\n\n# 3：其他负载均衡方式\n\n《[shadowsocks借助nginx实现负载均衡，自动切换“零”宕机](https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/)》介绍了使用nginx的方法。也可以尝试。\n\n我之前使用过apache来做负载均衡，但是无法连接，查看apache日志后提示如下：\n\n```verilog\n[Tue Jun 16 00:07:30.557609 2020] [core:debug] [pid 25543:tid 140127116449536] protocol.c(1335): [client 127.0.0.1:57310] AH00566: request failed: malformed request line\n```\n\n意思是请求行格式错误。刚开始以为配置错了。阅读apache的相关资料后才知道。\n\n> apache在做负载均衡时，只是对子目录进行了替换，比如说，你监听1234端口，将发送给主机1234端口的数据均衡发送给192.1.1.1:5678、192.1.1.2:6789。那么你在访问baidu.com/test 时，将你的请求发送给1234端口，而apache做的仅仅只是将请求HOST替换掉。真实请求地址是192.1.1.1:5678/test 或者192.1.1.2:6789/test 。。而ssr加密后的数据，是没有http请求头的，这便导致了，日志所显示的请求行格式错误。所以apache并不适合做单纯的数据转发。\n\n# 4：参考文献\n\n《[用Haproxy实现多VPS线路负载均衡](https://tianws.github.io/skill/2019/07/11/gfw/)》\n\n《[shadowsocks借助nginx实现负载均衡，自动切换“零”宕机](https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/)》\n\n《[Haproxy（二）之负载均衡配置详解](https://www.jianshu.com/p/a7e3199a0a09)》\n\n《[Apache 正向代理与反向代理配置](https://blog.csdn.net/sforiz/article/details/79651643)》\n\n","slug":"SSR负载均衡实现自动切换端口","published":1,"updated":"2020-11-15T08:59:39.216Z","_id":"ckgaxsab90019p0vz6kcrbn3x","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1：准备工作\"><a href=\"#1：准备工作\" class=\"headerlink\" title=\"1：准备工作\"></a>1：准备工作</h1><ul>\n<li>一台国内服务器。</li>\n</ul>\n<p>国内服务器可以监控到国外的服务器ip或者端口是否被封锁。如果你用国外的服务器，也能做到负载均衡，但是如果这台服务器被封锁，那SSR还是会断开连接。国内服务器不会被封锁。</p>\n<ul>\n<li>SSR添加多个端口或者多台SSR服务器</li>\n</ul>\n<p>修改SSR配置文件，监听多个端口《<a href=\"https://ssr.tools/194\">SSR添加多用户多端口教程</a>》，我监听的是34567、34568、34569。</p>\n<blockquote>\n<p>注意：不同端口或者IP的密码和协议等等都必须相同。</p>\n</blockquote>\n<h1 id=\"2：haproxy下载和配置\"><a href=\"#2：haproxy下载和配置\" class=\"headerlink\" title=\"2：haproxy下载和配置\"></a>2：haproxy下载和配置</h1><p>在Ubuntu上下载：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get -y install haproxy</span><br></pre></td></tr></table></figure>\n\n<p>在centos上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install haproxy</span><br></pre></td></tr></table></figure>\n\n<p>安装完毕后，打开haproxy配置文件<code>/etc/haproxy/haproxy.cfg</code>，修改配置为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global</span><br><span class=\"line\">    log &#x2F;dev&#x2F;log local0</span><br><span class=\"line\">    log &#x2F;dev&#x2F;log local1 notice</span><br><span class=\"line\">    user root</span><br><span class=\"line\">    group root</span><br><span class=\"line\">    daemon</span><br><span class=\"line\"></span><br><span class=\"line\">defaults</span><br><span class=\"line\">    log global</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    timeout connect 5s</span><br><span class=\"line\">    timeout client 5s</span><br><span class=\"line\">    timeout server 5s</span><br><span class=\"line\">    option      dontlognull</span><br><span class=\"line\">    option      redispatch</span><br><span class=\"line\">    retries     3</span><br><span class=\"line\"></span><br><span class=\"line\">listen status</span><br><span class=\"line\">  bind *:1111</span><br><span class=\"line\">  mode  http</span><br><span class=\"line\">  stats refresh 30s</span><br><span class=\"line\">  stats uri &#x2F;status</span><br><span class=\"line\">  stats realm Haproxy  </span><br><span class=\"line\">  stats auth admin:admin</span><br><span class=\"line\">  stats hide-version</span><br><span class=\"line\">  stats admin if TRUE</span><br><span class=\"line\"></span><br><span class=\"line\">frontend shadowsocks-in</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    bind *:8388</span><br><span class=\"line\">    default_backend shadowsocks-out</span><br><span class=\"line\"></span><br><span class=\"line\">backend shadowsocks-out</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    option      tcp-check</span><br><span class=\"line\">    balance roundrobin</span><br><span class=\"line\">    server  servername1    xxxxx1.com:8088  check</span><br><span class=\"line\">    server  servername2    xxxxx2.net:8080  check</span><br><span class=\"line\">    server  servername3    12.34.56.78:9999  check</span><br><span class=\"line\">    server  servername4    123.234.234.123:443  check</span><br></pre></td></tr></table></figure>\n\n<p>配置分为五大部分：</p>\n<ul>\n<li><strong>global</strong>：全局配置，这里主要是配置了日志</li>\n<li><strong>默认值</strong>：默认配置，也是一些分布式配置</li>\n<li><strong>听</strong>：监听配置，我在<code>1111</code>端口配置了http监控页面，访问<code>ip:1111/status</code>，认证用户名和密码都是<code>admin</code>，具体含义参考博客<a href=\"https://www.centos.bz/2018/01/haproxy%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2-%E5%92%8C%E9%A1%B5%E9%9D%A2%E8%AF%A6%E7%BB%86%E5%8F%82%E6%95%B0/\">“ haproxy监控页面和页面详细参数”</a></li>\n<li><strong>frontend</strong>：前端配置，Shadowsocks数据流从这里进入，流向指定标题，注意这里的端口号，即为ss客户端的输入端口</li>\n<li><strong>backend</strong>：调整配置，<code>balance</code>指定负载平衡方式，每个服务器写一个服务器行，服务器支持域名或IP。如果使用域名，重启服务出现问题，可以参考博客<a href=\"https://www.solarck.com/systemd-wait-network-online.html\">“解决Haproxy用Systemd启动失败的问题”</a>。</li>\n</ul>\n<h1 id=\"3：其他负载均衡方式\"><a href=\"#3：其他负载均衡方式\" class=\"headerlink\" title=\"3：其他负载均衡方式\"></a>3：其他负载均衡方式</h1><p>《<a href=\"https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/\">shadowsocks借助nginx实现负载均衡，自动切换“零”宕机</a>》介绍了使用nginx的方法。也可以尝试。</p>\n<p>我之前使用过apache来做负载均衡，但是无法连接，查看apache日志后提示如下：</p>\n<figure class=\"highlight verilog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Tue Jun <span class=\"number\">16</span> <span class=\"number\">00</span>:<span class=\"number\">07</span>:<span class=\"number\">30</span><span class=\"variable\">.557609</span> <span class=\"number\">2020</span>] [core:debug] [pid <span class=\"number\">25543</span>:tid <span class=\"number\">140127116449536</span>] protocol<span class=\"variable\">.c</span>(<span class=\"number\">1335</span>): [client <span class=\"number\">127</span><span class=\"variable\">.0</span><span class=\"variable\">.0</span><span class=\"variable\">.1</span>:<span class=\"number\">57310</span>] AH00566: request failed: malformed request line</span><br></pre></td></tr></table></figure>\n\n<p>意思是请求行格式错误。刚开始以为配置错了。阅读apache的相关资料后才知道。</p>\n<blockquote>\n<p>apache在做负载均衡时，只是对子目录进行了替换，比如说，你监听1234端口，将发送给主机1234端口的数据均衡发送给192.1.1.1:5678、192.1.1.2:6789。那么你在访问baidu.com/test 时，将你的请求发送给1234端口，而apache做的仅仅只是将请求HOST替换掉。真实请求地址是192.1.1.1:5678/test 或者192.1.1.2:6789/test 。。而ssr加密后的数据，是没有http请求头的，这便导致了，日志所显示的请求行格式错误。所以apache并不适合做单纯的数据转发。</p>\n</blockquote>\n<h1 id=\"4：参考文献\"><a href=\"#4：参考文献\" class=\"headerlink\" title=\"4：参考文献\"></a>4：参考文献</h1><p>《<a href=\"https://tianws.github.io/skill/2019/07/11/gfw/\">用Haproxy实现多VPS线路负载均衡</a>》</p>\n<p>《<a href=\"https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/\">shadowsocks借助nginx实现负载均衡，自动切换“零”宕机</a>》</p>\n<p>《<a href=\"https://www.jianshu.com/p/a7e3199a0a09\">Haproxy（二）之负载均衡配置详解</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/sforiz/article/details/79651643\">Apache 正向代理与反向代理配置</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：准备工作\"><a href=\"#1：准备工作\" class=\"headerlink\" title=\"1：准备工作\"></a>1：准备工作</h1><ul>\n<li>一台国内服务器。</li>\n</ul>\n<p>国内服务器可以监控到国外的服务器ip或者端口是否被封锁。如果你用国外的服务器，也能做到负载均衡，但是如果这台服务器被封锁，那SSR还是会断开连接。国内服务器不会被封锁。</p>\n<ul>\n<li>SSR添加多个端口或者多台SSR服务器</li>\n</ul>\n<p>修改SSR配置文件，监听多个端口《<a href=\"https://ssr.tools/194\">SSR添加多用户多端口教程</a>》，我监听的是34567、34568、34569。</p>\n<blockquote>\n<p>注意：不同端口或者IP的密码和协议等等都必须相同。</p>\n</blockquote>\n<h1 id=\"2：haproxy下载和配置\"><a href=\"#2：haproxy下载和配置\" class=\"headerlink\" title=\"2：haproxy下载和配置\"></a>2：haproxy下载和配置</h1><p>在Ubuntu上下载：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get -y install haproxy</span><br></pre></td></tr></table></figure>\n\n<p>在centos上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install haproxy</span><br></pre></td></tr></table></figure>\n\n<p>安装完毕后，打开haproxy配置文件<code>/etc/haproxy/haproxy.cfg</code>，修改配置为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">global</span><br><span class=\"line\">    log &#x2F;dev&#x2F;log local0</span><br><span class=\"line\">    log &#x2F;dev&#x2F;log local1 notice</span><br><span class=\"line\">    user root</span><br><span class=\"line\">    group root</span><br><span class=\"line\">    daemon</span><br><span class=\"line\"></span><br><span class=\"line\">defaults</span><br><span class=\"line\">    log global</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    timeout connect 5s</span><br><span class=\"line\">    timeout client 5s</span><br><span class=\"line\">    timeout server 5s</span><br><span class=\"line\">    option      dontlognull</span><br><span class=\"line\">    option      redispatch</span><br><span class=\"line\">    retries     3</span><br><span class=\"line\"></span><br><span class=\"line\">listen status</span><br><span class=\"line\">  bind *:1111</span><br><span class=\"line\">  mode  http</span><br><span class=\"line\">  stats refresh 30s</span><br><span class=\"line\">  stats uri &#x2F;status</span><br><span class=\"line\">  stats realm Haproxy  </span><br><span class=\"line\">  stats auth admin:admin</span><br><span class=\"line\">  stats hide-version</span><br><span class=\"line\">  stats admin if TRUE</span><br><span class=\"line\"></span><br><span class=\"line\">frontend shadowsocks-in</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    bind *:8388</span><br><span class=\"line\">    default_backend shadowsocks-out</span><br><span class=\"line\"></span><br><span class=\"line\">backend shadowsocks-out</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    option      tcp-check</span><br><span class=\"line\">    balance roundrobin</span><br><span class=\"line\">    server  servername1    xxxxx1.com:8088  check</span><br><span class=\"line\">    server  servername2    xxxxx2.net:8080  check</span><br><span class=\"line\">    server  servername3    12.34.56.78:9999  check</span><br><span class=\"line\">    server  servername4    123.234.234.123:443  check</span><br></pre></td></tr></table></figure>\n\n<p>配置分为五大部分：</p>\n<ul>\n<li><strong>global</strong>：全局配置，这里主要是配置了日志</li>\n<li><strong>默认值</strong>：默认配置，也是一些分布式配置</li>\n<li><strong>听</strong>：监听配置，我在<code>1111</code>端口配置了http监控页面，访问<code>ip:1111/status</code>，认证用户名和密码都是<code>admin</code>，具体含义参考博客<a href=\"https://www.centos.bz/2018/01/haproxy%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2-%E5%92%8C%E9%A1%B5%E9%9D%A2%E8%AF%A6%E7%BB%86%E5%8F%82%E6%95%B0/\">“ haproxy监控页面和页面详细参数”</a></li>\n<li><strong>frontend</strong>：前端配置，Shadowsocks数据流从这里进入，流向指定标题，注意这里的端口号，即为ss客户端的输入端口</li>\n<li><strong>backend</strong>：调整配置，<code>balance</code>指定负载平衡方式，每个服务器写一个服务器行，服务器支持域名或IP。如果使用域名，重启服务出现问题，可以参考博客<a href=\"https://www.solarck.com/systemd-wait-network-online.html\">“解决Haproxy用Systemd启动失败的问题”</a>。</li>\n</ul>\n<h1 id=\"3：其他负载均衡方式\"><a href=\"#3：其他负载均衡方式\" class=\"headerlink\" title=\"3：其他负载均衡方式\"></a>3：其他负载均衡方式</h1><p>《<a href=\"https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/\">shadowsocks借助nginx实现负载均衡，自动切换“零”宕机</a>》介绍了使用nginx的方法。也可以尝试。</p>\n<p>我之前使用过apache来做负载均衡，但是无法连接，查看apache日志后提示如下：</p>\n<figure class=\"highlight verilog\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Tue Jun <span class=\"number\">16</span> <span class=\"number\">00</span>:<span class=\"number\">07</span>:<span class=\"number\">30</span><span class=\"variable\">.557609</span> <span class=\"number\">2020</span>] [core:debug] [pid <span class=\"number\">25543</span>:tid <span class=\"number\">140127116449536</span>] protocol<span class=\"variable\">.c</span>(<span class=\"number\">1335</span>): [client <span class=\"number\">127</span><span class=\"variable\">.0</span><span class=\"variable\">.0</span><span class=\"variable\">.1</span>:<span class=\"number\">57310</span>] AH00566: request failed: malformed request line</span><br></pre></td></tr></table></figure>\n\n<p>意思是请求行格式错误。刚开始以为配置错了。阅读apache的相关资料后才知道。</p>\n<blockquote>\n<p>apache在做负载均衡时，只是对子目录进行了替换，比如说，你监听1234端口，将发送给主机1234端口的数据均衡发送给192.1.1.1:5678、192.1.1.2:6789。那么你在访问baidu.com/test 时，将你的请求发送给1234端口，而apache做的仅仅只是将请求HOST替换掉。真实请求地址是192.1.1.1:5678/test 或者192.1.1.2:6789/test 。。而ssr加密后的数据，是没有http请求头的，这便导致了，日志所显示的请求行格式错误。所以apache并不适合做单纯的数据转发。</p>\n</blockquote>\n<h1 id=\"4：参考文献\"><a href=\"#4：参考文献\" class=\"headerlink\" title=\"4：参考文献\"></a>4：参考文献</h1><p>《<a href=\"https://tianws.github.io/skill/2019/07/11/gfw/\">用Haproxy实现多VPS线路负载均衡</a>》</p>\n<p>《<a href=\"https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/\">shadowsocks借助nginx实现负载均衡，自动切换“零”宕机</a>》</p>\n<p>《<a href=\"https://www.jianshu.com/p/a7e3199a0a09\">Haproxy（二）之负载均衡配置详解</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/sforiz/article/details/79651643\">Apache 正向代理与反向代理配置</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Nov 15 2020 09:59:39 GMT+0100 (GMT+01:00)","title":"SSR负载均衡实现自动切换端口","path":"2020/06/16/SSR负载均衡实现自动切换端口/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-15T23:09:41.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-15T23:09:41.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Linux","tags":["SSR","haproxy","负载均衡"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"ShopXO商城优化-商城后台、小程序、飞鹅订单打印、公众号新订单推送","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-05-26T09:40:33.000Z","password":null,"summary":"ShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。","_content":"\n# 1：内容梗概\n\nShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。\n\n特别说明：此篇文章建议有一定前后端基础的朋友阅读，否则，你在按照本文修改你的网站时，可能由于我在写作时，将某个环节遗漏，而导致你的网站无法做到像我修改后一样的结果。此时，会得不偿失。同时，若你对本文内容有任何疑问，欢迎你通过邮箱与我联系。邮箱几乎每天一看。\n\n在进行下面修改时，建议你先将你的网站压缩打包，保存一下。避免操作失误无法修复。如果你的修改在达到理想效果后，建议你都进行一下保存操作\n\n# 2：商城后台优化\n\n## 2.1 优化说明\n\n> 优化说明：\n>\n> 1. 手机端显示商品缩率图\n> 2. 直接点击价格，弹出价格修改框，快速改价。\n> 3. 隐藏“查看更多”按钮。（给缩略图让空间）\n\n对比：\n\n![](https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg)\n\n优化后点击商品价格改价：\n\n![](https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg)\n\n## 2.2 优化工作\n\n- 首先在手机端显示缩率图和价格。隐藏查看更多。\n\n核心代码：替换原有的价格显示样式，并添加一个js控制的弹窗。\n\n```php+HTML\n<td >\n    <button class=\"am-btn am-btn-success price-changed am-btn-xs am-radius\" data-id=\"{{$v.id}}\" data-url=\"{{:MyUrl('admin/goods/pricechanged')}}\" id=\"doc-prompt-toggle{{$v.id}}\" >{{$v.price}}</button>\n    <div class=\"am-modal am-modal-prompt\" tabindex=\"-1\" id=\"my-prompt{{$v.id}}\">\n        <div class=\"am-modal-dialog\">\n            <div class=\"am-modal-hd\">{{$v.title}}</div>\n            <div class=\"am-modal-bd\">\n                <img src=\"{{$v['images']}}\" class=\"am-radius\" style=\"width:100%\"/>\n                <input type=\"number\" class=\"am-modal-prompt-input\"  pattern=\"^([0-9]{1}\\d{0,6})(\\.\\d{1,2})?$\" data-validation-message=\"请填写有效的销售金额\" placeholder=\"{{$v.price}}\">元\n            </div>\n            <div class=\"am-modal-footer\">\n                <span class=\"am-modal-btn\" data-am-modal-cancel>取消</span>\n                <span class=\"am-modal-btn\" data-am-modal-confirm>提交</span>\n            </div>\n        </div>\n    </div>\n\n    {{if !empty($v['original_price']) and $v['original_price'] gt 0}}\n    <br /><span class=\"am-badge am-radius\">原价 {{$v.original_price}}</span>\n    {{/if}}\n</td>\n```\n\n完整`index.html`代码链接：https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html\n\n将此链接中的代码下载下来，替换原后台商品管理的html代码。替换`你的网站根目录/application/admin/view/default/goods/index.html`。\n\n- 修改js文件，实现点击价格，弹出对话框，提交发送post请求修改数据库\n\n```javascript\n\t/**\n\t * [doc-prompt-toggle 价格修改弹窗]\n\t * @author   Qifei\n\t * @blog     https://sci.ci/\n\t * @version  0.0.1\n\t * @datetime 2020-05-25T14:22:39+0800\n\t * @param    {[int] \t[data-id] \t[数据id]}\n\t * @param    {[int] \t[data-field][数据库内容]}\n\t * @param    {[string] \t[data-url] \t[请求地址]}\n\t */\n\t $(document).on('click','.price-changed', function() {\n\t \tvar tag = $(this);\n\t \tvar id = tag.attr('data-id');\n\t \tvar $my_prompt='#my-prompt'+id;\n\t \tvar url = tag.attr('data-url');\n\t\tvar field = tag.attr('data-field') || '';\n\t    $($my_prompt).modal({\n\t      relatedElement: this,\n\t      onConfirm: function(data) {\n            //获取input标签中的value值\n\t      \tprice=data['data'];\n\t      \tif(id == undefined || url == undefined)\n\t\t\t{\n\t\t\t\tPrompt('参数配置有误');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// 请求更新数据\n\t\t\t$.ajax({\n\t\t\t\turl:url,\n\t\t\t\ttype:'POST',\n\t\t\t\tdataType:\"json\",\n\t\t\t\ttimeout:tag.attr('data-timeout') || 30000,\n\t\t\t\tdata:{\"id\":id, \"price\":price, \"field\":field},\n\t\t\t\tsuccess:function(result)\n\t\t\t\t{\n\t\t\t\t\tif(result.code == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tPrompt(result.msg, 'success');\n\t\t\t\t\t\t// 成功则更新价格\n\t\t\t\t\t\ttag.html(price);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tPrompt(result.msg);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror:function(xhr, type)\n\t\t\t\t{\n\t\t\t\t\tPrompt('网络异常出错');\n\t\t\t\t}\n\t\t\t});\n\t      },\n\t      onCancel: function() {\n\t      }\n\t    });\n\t  });\n  \n```\n\n> 以上代码加入到common.js文件中，或者下载我的commonjs完全替换这个文件\n\n替换`你的网站/public/static/common/js/common.js`\n\n完整代码：https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js\n\n- 在Goods控制器里新建一个控制器函数PriceChanged()。实现接收POST数据。\n\n在`application/admin/controller/Goods.php`里添加下面的代码。或者完全替换为我的`Goods.php`。\n\n```php\n\t/**\n\t * [PriceChanged 修改商品价格]\n\t * @author   Qifei\n\t * @blog     https://sci.ci/\n\t * @version  0.0.1\n\t * @datetime 2020-05-25T22:23:06+0800\n\t */\n\t public function PriceChanged()\n\t{\n\t\t// 是否ajax\n\t\tif(!IS_AJAX)\n\t\t{\n\t\t\treturn $this->error('非法访问');\n\t\t}\n\t\t$filename=\"a.txt\";\n\t\t$handle=fopen($filename,\"a+\");\n\t\t$str=fwrite($handle,\"test\\n\");\n\t\t fclose($handle);\n\t\t// 开始操作\n\t\t$params = input('post.');\n\t\t$params['admin'] = $this->admin;\n\t\t$params['field'] = 'price';\n         //调用商品管理服务，更新数据库。\n\t\treturn GoodsService::GoodsPriceUpdate($params);\n\t}\n```\n\n替换`你的网站/application/admin/controller/Goods.php`\n\n完整的Goods.php代码：https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php\n\n- 在商品后台服务中添加更新价格的服务函数\n\n将以下代码添加到`你的网站/application/service/GoodsService.php`,或者下载我的`GoodsService.php`文件，完全替换它。\n\n```php\n/**\n     * 修改商品价格\n     * @author   Qifei\n     * @blog    https://sci.ci/\n     * @version 1.0.0\n     * @date    2020-05-25\n     * @desc    description\n     * @param   [int]          $goods_id [商品id]\n     */\n    public static function GoodsPriceUpdate($params = [])\n    {\n        // 请求参数\n        $p = [\n            [\n                'checked_type'      => 'empty',\n                'key_name'          => 'id',\n                'error_msg'         => '操作id有误',\n            ],\n            [\n                'checked_type'      => 'empty',\n                'key_name'          => 'field',\n                'error_msg'         => '未指定操作字段',\n            ],\n            [//价格在0到5000这个区间\n                'checked_type'      => 'between',\n                'key_name'          => 'price',\n                'checked_data'      => [0,5000],\n                'error_msg'         => '价格不能小于0，大于5000',\n            ],\n        ];\n        $ret = ParamsChecked($params, $p);\n        if($ret !== true)\n        {\n            return DataReturn($ret, -1);\n        }\n\t\t\n        // 数据更新\n        if(Db::name('Goods')->where(['id'=>intval($params['id'])])->update([$params['field']=>number_format($params['price'],2),'min_price'=>number_format($params['price'],2),'max_price'=>number_format($params['price'],2), 'upd_time'=>time()])&&Db::name('GoodsSpecBase')->where(['goods_id'=>intval($params['id'])])->update([$params['field']=>number_format($params['price'],2)]))\n        {\n            return DataReturn('操作成功');\n        }\n        return DataReturn('操作失败', -100);\n    }\n```\n\n完整`GoodsService.php`地址：https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php\n\n替换`你的网站/application/service/GoodsService.php`\n\n- 最后，你需要给新的控制器方法添加访问数据库权限。\n\n打开ShopXO网站后台`你的网站网址/admin.php`\n\n![](https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg)\n\n添加权限：![](https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg)\n\n点击保存。至此商品后台优化已经完成。\n\n# 3：WX小程序优化\n\n## 3.1 优化说明\n\n> 优化内容：\n>\n> 1. 修改首页导航栏上传图片，显示太小\n> 2. 修改分类无法查看一级分类。\n\n修改前后对比\n\n![](https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg)\n\n![](https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg)\n\n## 3.2 优化工作\n\n- 导航栏修改\n\n1. 打开小程序源代码，找到`components`->`icon-nav`\n\n替换`icon-nav.wxml`内容为：\n\n```html\n<view wx:if=\"{{propData.length > 0}}\">\n  <view class=\"data-list\">\n    <view class=\"items\" wx:for=\"{{propData}}\" wx:key=\"key\">\n      <view wx:if=\"{{item.bg_color==='#FFFFFF'}}\" class=\"items-content\" data-value=\"{{item.event_value}}\" data-type=\"{{item.event_type}}\" bindtap=\"navigation_event\" style=\"background-color:#fff;padding:0;height:110rpx;width:110rpx;border-radius:0%\">\n        <image src=\"{{item.images_url}}\" mode=\"aspectFit\" style=\"width:110rpx;height:110rpx\"/>\n      </view>\n      <view wx:else class=\"items-content\" data-value=\"{{item.event_value}}\" data-type=\"{{item.event_type}}\" bindtap=\"navigation_event\" style=\"background-color:{{item.bg_color}};\">\n        <image src=\"{{item.images_url}}\" mode=\"aspectFit\" style=\"\"/>\n      </view>\n      <view class=\"title\">{{item.name}}</view>\n    </view>\n  </view>\n</view>\n```\n\n> 代码逻辑：当检测到导航栏背景颜色为白色时，设置图片上一层View标签的内边距padding 为0（原为20rpx）高宽设置为110rpx。并且将图片高宽均增加40rpx（原为70rpx），弥补内边距。\n\n2. 修改`icon-nav.wxss`文件\n\n```css\n.data-list .items image {\n  width: 60rpx ;\n  height: 60rpx ;\n  margin-top: 5rpx;\n}\n```\n\n将原来的高宽后面的`!important`去掉，为了使步骤1中内联的高宽样式生效。\n\n最后，特别注意：你在网站后台修改导航栏图片时，必须设置导航栏背景色为白色。不设置或者设置为其他颜色，则采用默认的样式。此时图片会比较小。\n\n修改导航栏：`你的网站/admin.php`->`手机端管理`->`首页导航`,修改导航栏\n\n![](https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg)\n\n确保颜色代码为`#FFFFFF`\n\n![](https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg)\n\n- 添加分类`全部`选项\n\n完全替换小程序源代码中`pages`->`goods-category`->`goods-category.wxml`文件\n\n```php+HTML\n<view class='left-nav'>\n  <block wx:for=\"{{data_list}}\" wx:key=\"key\">\n    <view class='items {{item.active || \"\"}}' data-index=\"{{index}}\" bindtap='nav_event'>\n      <text>{{item.name}}</text>\n    </view>\n  </block>\n</view>\n<view class='right-content bg-white'>\n  <view class=\"content-items\" data-value=\"{{data_first_class['id']}}\" bindtap=\"category_event\">\n        <view class=\"text single-text\">全部</view>\n  </view>\n  <block wx:if=\"{{data_content.length > 0}}\">\n    <block wx:for=\"{{data_content}}\" wx:key=\"keys\" wx:for-item=\"v\">\n      <view class=\"content-items\" data-value=\"{{v.id}}\" bindtap=\"category_event\">\n        <image wx:if=\"{{(v.icon || null) != null}}\" src=\"{{v.icon}}\" mode=\"aspectFit\" class=\"icon\" />\n        <view class=\"text single-text\">{{v.name}}</view>\n      </view>\n    </block>\n  </block>\n</view>\n\n<view wx:if=\"{{data_list.length == 0 && data_list_loding_status != 0}}\">\n  <import src=\"/pages/common/nodata.wxml\" />\n  <template is=\"nodata\" data=\"{{status: data_list_loding_status}}\">\n  </template>\n</view>\n```\n\n修改`pages`->`goods-category`->`goods-category.js`中部分代码\n\n```js\n// 导航事件\n  nav_event(e) {\n    var index = e.currentTarget.dataset.index;\n    var temp_data = this.data.data_list;\n    for(var i in temp_data)\n    {\n      temp_data[i]['active'] = (index == i) ? 'nav-active' : '';\n    }\n    this.setData({\n      data_list: temp_data,\n      data_first_class: temp_data[index],\n      data_content: temp_data[index]['items'],\n    });\n  },\n```\n\n编译运行，即修改完毕。\n\n> 有个小bug，打开分类页面，第一个一级分类的“全部”，在第一次打开时，会指向全部商品，而不是一级分类的商品。切换到第二个一级分类，再回来，此时点击“全部”，就变正常了。。后续再修复吧。\n\n# 4：新订单通知推送\n\n新订单推送，是为了方便商家，接收各个端下单消息。通常，通常都是使用短信和邮箱方式来接收消息，但是邮箱接收效率太低。短信又需要收费。\n\n这里我们使用两种及时的推送方式，第一种，飞鹅打印机。入住美团、饿了么的商家，通常都会购买这个打印机，因为他是全平台的，而且可以调用它的API接口，自定义打印内容。\n\n第二种，微信公众号推送。当网站后台接收到新订单，即通过微信公众号的模板消息功能，向指定微信推送新订单消息。\n\n当然如果你具备一些编程知识，还可以自己写个程序，向下单的用户推送订单的进展。（开发一个插件，调用订单的相关钩子。）\n\n![](https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg)\n\n为了减少工作量，消息通知，是在原有插件`新订单提醒`基础上进行的修改。新的插件具有了除邮箱和短信以外的公众号和飞鹅打印功能。\n\n![](https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg)","source":"_posts/ShopXO商城优化商品价格修改.md","raw":"---\ntitle: ShopXO商城优化-商城后台、小程序、飞鹅订单打印、公众号新订单推送\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-05-26 11:40:33\npassword:\nsummary: ShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。\ntags: ShopXO\ncategories: 网站编程\n---\n\n# 1：内容梗概\n\nShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。\n\n特别说明：此篇文章建议有一定前后端基础的朋友阅读，否则，你在按照本文修改你的网站时，可能由于我在写作时，将某个环节遗漏，而导致你的网站无法做到像我修改后一样的结果。此时，会得不偿失。同时，若你对本文内容有任何疑问，欢迎你通过邮箱与我联系。邮箱几乎每天一看。\n\n在进行下面修改时，建议你先将你的网站压缩打包，保存一下。避免操作失误无法修复。如果你的修改在达到理想效果后，建议你都进行一下保存操作\n\n# 2：商城后台优化\n\n## 2.1 优化说明\n\n> 优化说明：\n>\n> 1. 手机端显示商品缩率图\n> 2. 直接点击价格，弹出价格修改框，快速改价。\n> 3. 隐藏“查看更多”按钮。（给缩略图让空间）\n\n对比：\n\n![](https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg)\n\n优化后点击商品价格改价：\n\n![](https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg)\n\n## 2.2 优化工作\n\n- 首先在手机端显示缩率图和价格。隐藏查看更多。\n\n核心代码：替换原有的价格显示样式，并添加一个js控制的弹窗。\n\n```php+HTML\n<td >\n    <button class=\"am-btn am-btn-success price-changed am-btn-xs am-radius\" data-id=\"{{$v.id}}\" data-url=\"{{:MyUrl('admin/goods/pricechanged')}}\" id=\"doc-prompt-toggle{{$v.id}}\" >{{$v.price}}</button>\n    <div class=\"am-modal am-modal-prompt\" tabindex=\"-1\" id=\"my-prompt{{$v.id}}\">\n        <div class=\"am-modal-dialog\">\n            <div class=\"am-modal-hd\">{{$v.title}}</div>\n            <div class=\"am-modal-bd\">\n                <img src=\"{{$v['images']}}\" class=\"am-radius\" style=\"width:100%\"/>\n                <input type=\"number\" class=\"am-modal-prompt-input\"  pattern=\"^([0-9]{1}\\d{0,6})(\\.\\d{1,2})?$\" data-validation-message=\"请填写有效的销售金额\" placeholder=\"{{$v.price}}\">元\n            </div>\n            <div class=\"am-modal-footer\">\n                <span class=\"am-modal-btn\" data-am-modal-cancel>取消</span>\n                <span class=\"am-modal-btn\" data-am-modal-confirm>提交</span>\n            </div>\n        </div>\n    </div>\n\n    {{if !empty($v['original_price']) and $v['original_price'] gt 0}}\n    <br /><span class=\"am-badge am-radius\">原价 {{$v.original_price}}</span>\n    {{/if}}\n</td>\n```\n\n完整`index.html`代码链接：https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html\n\n将此链接中的代码下载下来，替换原后台商品管理的html代码。替换`你的网站根目录/application/admin/view/default/goods/index.html`。\n\n- 修改js文件，实现点击价格，弹出对话框，提交发送post请求修改数据库\n\n```javascript\n\t/**\n\t * [doc-prompt-toggle 价格修改弹窗]\n\t * @author   Qifei\n\t * @blog     https://sci.ci/\n\t * @version  0.0.1\n\t * @datetime 2020-05-25T14:22:39+0800\n\t * @param    {[int] \t[data-id] \t[数据id]}\n\t * @param    {[int] \t[data-field][数据库内容]}\n\t * @param    {[string] \t[data-url] \t[请求地址]}\n\t */\n\t $(document).on('click','.price-changed', function() {\n\t \tvar tag = $(this);\n\t \tvar id = tag.attr('data-id');\n\t \tvar $my_prompt='#my-prompt'+id;\n\t \tvar url = tag.attr('data-url');\n\t\tvar field = tag.attr('data-field') || '';\n\t    $($my_prompt).modal({\n\t      relatedElement: this,\n\t      onConfirm: function(data) {\n            //获取input标签中的value值\n\t      \tprice=data['data'];\n\t      \tif(id == undefined || url == undefined)\n\t\t\t{\n\t\t\t\tPrompt('参数配置有误');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// 请求更新数据\n\t\t\t$.ajax({\n\t\t\t\turl:url,\n\t\t\t\ttype:'POST',\n\t\t\t\tdataType:\"json\",\n\t\t\t\ttimeout:tag.attr('data-timeout') || 30000,\n\t\t\t\tdata:{\"id\":id, \"price\":price, \"field\":field},\n\t\t\t\tsuccess:function(result)\n\t\t\t\t{\n\t\t\t\t\tif(result.code == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tPrompt(result.msg, 'success');\n\t\t\t\t\t\t// 成功则更新价格\n\t\t\t\t\t\ttag.html(price);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tPrompt(result.msg);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror:function(xhr, type)\n\t\t\t\t{\n\t\t\t\t\tPrompt('网络异常出错');\n\t\t\t\t}\n\t\t\t});\n\t      },\n\t      onCancel: function() {\n\t      }\n\t    });\n\t  });\n  \n```\n\n> 以上代码加入到common.js文件中，或者下载我的commonjs完全替换这个文件\n\n替换`你的网站/public/static/common/js/common.js`\n\n完整代码：https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js\n\n- 在Goods控制器里新建一个控制器函数PriceChanged()。实现接收POST数据。\n\n在`application/admin/controller/Goods.php`里添加下面的代码。或者完全替换为我的`Goods.php`。\n\n```php\n\t/**\n\t * [PriceChanged 修改商品价格]\n\t * @author   Qifei\n\t * @blog     https://sci.ci/\n\t * @version  0.0.1\n\t * @datetime 2020-05-25T22:23:06+0800\n\t */\n\t public function PriceChanged()\n\t{\n\t\t// 是否ajax\n\t\tif(!IS_AJAX)\n\t\t{\n\t\t\treturn $this->error('非法访问');\n\t\t}\n\t\t$filename=\"a.txt\";\n\t\t$handle=fopen($filename,\"a+\");\n\t\t$str=fwrite($handle,\"test\\n\");\n\t\t fclose($handle);\n\t\t// 开始操作\n\t\t$params = input('post.');\n\t\t$params['admin'] = $this->admin;\n\t\t$params['field'] = 'price';\n         //调用商品管理服务，更新数据库。\n\t\treturn GoodsService::GoodsPriceUpdate($params);\n\t}\n```\n\n替换`你的网站/application/admin/controller/Goods.php`\n\n完整的Goods.php代码：https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php\n\n- 在商品后台服务中添加更新价格的服务函数\n\n将以下代码添加到`你的网站/application/service/GoodsService.php`,或者下载我的`GoodsService.php`文件，完全替换它。\n\n```php\n/**\n     * 修改商品价格\n     * @author   Qifei\n     * @blog    https://sci.ci/\n     * @version 1.0.0\n     * @date    2020-05-25\n     * @desc    description\n     * @param   [int]          $goods_id [商品id]\n     */\n    public static function GoodsPriceUpdate($params = [])\n    {\n        // 请求参数\n        $p = [\n            [\n                'checked_type'      => 'empty',\n                'key_name'          => 'id',\n                'error_msg'         => '操作id有误',\n            ],\n            [\n                'checked_type'      => 'empty',\n                'key_name'          => 'field',\n                'error_msg'         => '未指定操作字段',\n            ],\n            [//价格在0到5000这个区间\n                'checked_type'      => 'between',\n                'key_name'          => 'price',\n                'checked_data'      => [0,5000],\n                'error_msg'         => '价格不能小于0，大于5000',\n            ],\n        ];\n        $ret = ParamsChecked($params, $p);\n        if($ret !== true)\n        {\n            return DataReturn($ret, -1);\n        }\n\t\t\n        // 数据更新\n        if(Db::name('Goods')->where(['id'=>intval($params['id'])])->update([$params['field']=>number_format($params['price'],2),'min_price'=>number_format($params['price'],2),'max_price'=>number_format($params['price'],2), 'upd_time'=>time()])&&Db::name('GoodsSpecBase')->where(['goods_id'=>intval($params['id'])])->update([$params['field']=>number_format($params['price'],2)]))\n        {\n            return DataReturn('操作成功');\n        }\n        return DataReturn('操作失败', -100);\n    }\n```\n\n完整`GoodsService.php`地址：https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php\n\n替换`你的网站/application/service/GoodsService.php`\n\n- 最后，你需要给新的控制器方法添加访问数据库权限。\n\n打开ShopXO网站后台`你的网站网址/admin.php`\n\n![](https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg)\n\n添加权限：![](https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg)\n\n点击保存。至此商品后台优化已经完成。\n\n# 3：WX小程序优化\n\n## 3.1 优化说明\n\n> 优化内容：\n>\n> 1. 修改首页导航栏上传图片，显示太小\n> 2. 修改分类无法查看一级分类。\n\n修改前后对比\n\n![](https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg)\n\n![](https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg)\n\n## 3.2 优化工作\n\n- 导航栏修改\n\n1. 打开小程序源代码，找到`components`->`icon-nav`\n\n替换`icon-nav.wxml`内容为：\n\n```html\n<view wx:if=\"{{propData.length > 0}}\">\n  <view class=\"data-list\">\n    <view class=\"items\" wx:for=\"{{propData}}\" wx:key=\"key\">\n      <view wx:if=\"{{item.bg_color==='#FFFFFF'}}\" class=\"items-content\" data-value=\"{{item.event_value}}\" data-type=\"{{item.event_type}}\" bindtap=\"navigation_event\" style=\"background-color:#fff;padding:0;height:110rpx;width:110rpx;border-radius:0%\">\n        <image src=\"{{item.images_url}}\" mode=\"aspectFit\" style=\"width:110rpx;height:110rpx\"/>\n      </view>\n      <view wx:else class=\"items-content\" data-value=\"{{item.event_value}}\" data-type=\"{{item.event_type}}\" bindtap=\"navigation_event\" style=\"background-color:{{item.bg_color}};\">\n        <image src=\"{{item.images_url}}\" mode=\"aspectFit\" style=\"\"/>\n      </view>\n      <view class=\"title\">{{item.name}}</view>\n    </view>\n  </view>\n</view>\n```\n\n> 代码逻辑：当检测到导航栏背景颜色为白色时，设置图片上一层View标签的内边距padding 为0（原为20rpx）高宽设置为110rpx。并且将图片高宽均增加40rpx（原为70rpx），弥补内边距。\n\n2. 修改`icon-nav.wxss`文件\n\n```css\n.data-list .items image {\n  width: 60rpx ;\n  height: 60rpx ;\n  margin-top: 5rpx;\n}\n```\n\n将原来的高宽后面的`!important`去掉，为了使步骤1中内联的高宽样式生效。\n\n最后，特别注意：你在网站后台修改导航栏图片时，必须设置导航栏背景色为白色。不设置或者设置为其他颜色，则采用默认的样式。此时图片会比较小。\n\n修改导航栏：`你的网站/admin.php`->`手机端管理`->`首页导航`,修改导航栏\n\n![](https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg)\n\n确保颜色代码为`#FFFFFF`\n\n![](https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg)\n\n- 添加分类`全部`选项\n\n完全替换小程序源代码中`pages`->`goods-category`->`goods-category.wxml`文件\n\n```php+HTML\n<view class='left-nav'>\n  <block wx:for=\"{{data_list}}\" wx:key=\"key\">\n    <view class='items {{item.active || \"\"}}' data-index=\"{{index}}\" bindtap='nav_event'>\n      <text>{{item.name}}</text>\n    </view>\n  </block>\n</view>\n<view class='right-content bg-white'>\n  <view class=\"content-items\" data-value=\"{{data_first_class['id']}}\" bindtap=\"category_event\">\n        <view class=\"text single-text\">全部</view>\n  </view>\n  <block wx:if=\"{{data_content.length > 0}}\">\n    <block wx:for=\"{{data_content}}\" wx:key=\"keys\" wx:for-item=\"v\">\n      <view class=\"content-items\" data-value=\"{{v.id}}\" bindtap=\"category_event\">\n        <image wx:if=\"{{(v.icon || null) != null}}\" src=\"{{v.icon}}\" mode=\"aspectFit\" class=\"icon\" />\n        <view class=\"text single-text\">{{v.name}}</view>\n      </view>\n    </block>\n  </block>\n</view>\n\n<view wx:if=\"{{data_list.length == 0 && data_list_loding_status != 0}}\">\n  <import src=\"/pages/common/nodata.wxml\" />\n  <template is=\"nodata\" data=\"{{status: data_list_loding_status}}\">\n  </template>\n</view>\n```\n\n修改`pages`->`goods-category`->`goods-category.js`中部分代码\n\n```js\n// 导航事件\n  nav_event(e) {\n    var index = e.currentTarget.dataset.index;\n    var temp_data = this.data.data_list;\n    for(var i in temp_data)\n    {\n      temp_data[i]['active'] = (index == i) ? 'nav-active' : '';\n    }\n    this.setData({\n      data_list: temp_data,\n      data_first_class: temp_data[index],\n      data_content: temp_data[index]['items'],\n    });\n  },\n```\n\n编译运行，即修改完毕。\n\n> 有个小bug，打开分类页面，第一个一级分类的“全部”，在第一次打开时，会指向全部商品，而不是一级分类的商品。切换到第二个一级分类，再回来，此时点击“全部”，就变正常了。。后续再修复吧。\n\n# 4：新订单通知推送\n\n新订单推送，是为了方便商家，接收各个端下单消息。通常，通常都是使用短信和邮箱方式来接收消息，但是邮箱接收效率太低。短信又需要收费。\n\n这里我们使用两种及时的推送方式，第一种，飞鹅打印机。入住美团、饿了么的商家，通常都会购买这个打印机，因为他是全平台的，而且可以调用它的API接口，自定义打印内容。\n\n第二种，微信公众号推送。当网站后台接收到新订单，即通过微信公众号的模板消息功能，向指定微信推送新订单消息。\n\n当然如果你具备一些编程知识，还可以自己写个程序，向下单的用户推送订单的进展。（开发一个插件，调用订单的相关钩子。）\n\n![](https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg)\n\n为了减少工作量，消息通知，是在原有插件`新订单提醒`基础上进行的修改。新的插件具有了除邮箱和短信以外的公众号和飞鹅打印功能。\n\n![](https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg)","slug":"ShopXO商城优化商品价格修改","published":1,"updated":"2020-06-20T06:46:22.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabd001cp0vzb02d6v7u","content":"<h1 id=\"1：内容梗概\"><a href=\"#1：内容梗概\" class=\"headerlink\" title=\"1：内容梗概\"></a>1：内容梗概</h1><p>ShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。</p>\n<p>特别说明：此篇文章建议有一定前后端基础的朋友阅读，否则，你在按照本文修改你的网站时，可能由于我在写作时，将某个环节遗漏，而导致你的网站无法做到像我修改后一样的结果。此时，会得不偿失。同时，若你对本文内容有任何疑问，欢迎你通过邮箱与我联系。邮箱几乎每天一看。</p>\n<p>在进行下面修改时，建议你先将你的网站压缩打包，保存一下。避免操作失误无法修复。如果你的修改在达到理想效果后，建议你都进行一下保存操作</p>\n<h1 id=\"2：商城后台优化\"><a href=\"#2：商城后台优化\" class=\"headerlink\" title=\"2：商城后台优化\"></a>2：商城后台优化</h1><h2 id=\"2-1-优化说明\"><a href=\"#2-1-优化说明\" class=\"headerlink\" title=\"2.1 优化说明\"></a>2.1 优化说明</h2><blockquote>\n<p>优化说明：</p>\n<ol>\n<li>手机端显示商品缩率图</li>\n<li>直接点击价格，弹出价格修改框，快速改价。</li>\n<li>隐藏“查看更多”按钮。（给缩略图让空间）</li>\n</ol>\n</blockquote>\n<p>对比：</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>优化后点击商品价格改价：</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"2-2-优化工作\"><a href=\"#2-2-优化工作\" class=\"headerlink\" title=\"2.2 优化工作\"></a>2.2 优化工作</h2><ul>\n<li>首先在手机端显示缩率图和价格。隐藏查看更多。</li>\n</ul>\n<p>核心代码：替换原有的价格显示样式，并添加一个js控制的弹窗。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;td &gt;</span><br><span class=\"line\">    &lt;button class&#x3D;&quot;am-btn am-btn-success price-changed am-btn-xs am-radius&quot; data-id&#x3D;&quot;&#123;&#123;$v.id&#125;&#125;&quot; data-url&#x3D;&quot;&#123;&#123;:MyUrl(&#39;admin&#x2F;goods&#x2F;pricechanged&#39;)&#125;&#125;&quot; id&#x3D;&quot;doc-prompt-toggle&#123;&#123;$v.id&#125;&#125;&quot; &gt;&#123;&#123;$v.price&#125;&#125;&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;am-modal am-modal-prompt&quot; tabindex&#x3D;&quot;-1&quot; id&#x3D;&quot;my-prompt&#123;&#123;$v.id&#125;&#125;&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;am-modal-dialog&quot;&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;am-modal-hd&quot;&gt;&#123;&#123;$v.title&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;am-modal-bd&quot;&gt;</span><br><span class=\"line\">                &lt;img src&#x3D;&quot;&#123;&#123;$v[&#39;images&#39;]&#125;&#125;&quot; class&#x3D;&quot;am-radius&quot; style&#x3D;&quot;width:100%&quot;&#x2F;&gt;</span><br><span class=\"line\">                &lt;input type&#x3D;&quot;number&quot; class&#x3D;&quot;am-modal-prompt-input&quot;  pattern&#x3D;&quot;^([0-9]&#123;1&#125;\\d&#123;0,6&#125;)(\\.\\d&#123;1,2&#125;)?$&quot; data-validation-message&#x3D;&quot;请填写有效的销售金额&quot; placeholder&#x3D;&quot;&#123;&#123;$v.price&#125;&#125;&quot;&gt;元</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;am-modal-footer&quot;&gt;</span><br><span class=\"line\">                &lt;span class&#x3D;&quot;am-modal-btn&quot; data-am-modal-cancel&gt;取消&lt;&#x2F;span&gt;</span><br><span class=\"line\">                &lt;span class&#x3D;&quot;am-modal-btn&quot; data-am-modal-confirm&gt;提交&lt;&#x2F;span&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#123;&#123;if !empty($v[&#39;original_price&#39;]) and $v[&#39;original_price&#39;] gt 0&#125;&#125;</span><br><span class=\"line\">    &lt;br &#x2F;&gt;&lt;span class&#x3D;&quot;am-badge am-radius&quot;&gt;原价 &#123;&#123;$v.original_price&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class=\"line\">    &#123;&#123;&#x2F;if&#125;&#125;</span><br><span class=\"line\">&lt;&#x2F;td&gt;</span><br></pre></td></tr></table></figure>\n\n<p>完整<code>index.html</code>代码链接：<a href=\"https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html\">https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html</a></p>\n<p>将此链接中的代码下载下来，替换原后台商品管理的html代码。替换<code>你的网站根目录/application/admin/view/default/goods/index.html</code>。</p>\n<ul>\n<li>修改js文件，实现点击价格，弹出对话框，提交发送post请求修改数据库</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [doc-prompt-toggle 价格修改弹窗]</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author   <span class=\"variable\">Qifei</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@blog     </span>https://sci.ci/</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version  </span>0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@datetime </span>2020-05-25T14:22:39+0800</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param    <span class=\"type\">&#123;[int] \t[data-id] \t[数据id]&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param    <span class=\"type\">&#123;[int] \t[data-field][数据库内容]&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param    <span class=\"type\">&#123;[string] \t[data-url] \t[请求地址]&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> $(<span class=\"built_in\">document</span>).on(<span class=\"string\">&#x27;click&#x27;</span>,<span class=\"string\">&#x27;.price-changed&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> tag = $(<span class=\"built_in\">this</span>);</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> id = tag.attr(<span class=\"string\">&#x27;data-id&#x27;</span>);</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> $my_prompt=<span class=\"string\">&#x27;#my-prompt&#x27;</span>+id;</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> url = tag.attr(<span class=\"string\">&#x27;data-url&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> field = tag.attr(<span class=\"string\">&#x27;data-field&#x27;</span>) || <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    $($my_prompt).modal(&#123;</span><br><span class=\"line\">      relatedElement: <span class=\"built_in\">this</span>,</span><br><span class=\"line\">      onConfirm: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"comment\">//获取input标签中的value值</span></span><br><span class=\"line\">      \tprice=data[<span class=\"string\">&#x27;data&#x27;</span>];</span><br><span class=\"line\">      \t<span class=\"keyword\">if</span>(id == <span class=\"literal\">undefined</span> || url == <span class=\"literal\">undefined</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tPrompt(<span class=\"string\">&#x27;参数配置有误&#x27;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 请求更新数据</span></span><br><span class=\"line\">\t\t$.ajax(&#123;</span><br><span class=\"line\">\t\t\turl:url,</span><br><span class=\"line\">\t\t\ttype:<span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">\t\t\tdataType:<span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">\t\t\ttimeout:tag.attr(<span class=\"string\">&#x27;data-timeout&#x27;</span>) || <span class=\"number\">30000</span>,</span><br><span class=\"line\">\t\t\tdata:&#123;<span class=\"string\">&quot;id&quot;</span>:id, <span class=\"string\">&quot;price&quot;</span>:price, <span class=\"string\">&quot;field&quot;</span>:field&#125;,</span><br><span class=\"line\">\t\t\tsuccess:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>)</span></span><br><span class=\"line\"><span class=\"function\">\t\t\t</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(result.code == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t\tPrompt(result.msg, <span class=\"string\">&#x27;success&#x27;</span>);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 成功则更新价格</span></span><br><span class=\"line\">\t\t\t\t\ttag.html(price);</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tPrompt(result.msg);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\terror:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xhr, type</span>)</span></span><br><span class=\"line\"><span class=\"function\">\t\t\t</span>&#123;</span><br><span class=\"line\">\t\t\t\tPrompt(<span class=\"string\">&#x27;网络异常出错&#x27;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      onCancel: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>以上代码加入到common.js文件中，或者下载我的commonjs完全替换这个文件</p>\n</blockquote>\n<p>替换<code>你的网站/public/static/common/js/common.js</code></p>\n<p>完整代码：<a href=\"https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js\">https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js</a></p>\n<ul>\n<li>在Goods控制器里新建一个控制器函数PriceChanged()。实现接收POST数据。</li>\n</ul>\n<p>在<code>application/admin/controller/Goods.php</code>里添加下面的代码。或者完全替换为我的<code>Goods.php</code>。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [PriceChanged 修改商品价格]</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>   Qifei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@blog</span>     https://sci.ci/</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version</span>  0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@datetime</span> 2020-05-25T22:23:06+0800</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PriceChanged</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 是否ajax</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(!IS_AJAX)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;error(<span class=\"string\">&#x27;非法访问&#x27;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t$filename=<span class=\"string\">&quot;a.txt&quot;</span>;</span><br><span class=\"line\">\t$handle=fopen($filename,<span class=\"string\">&quot;a+&quot;</span>);</span><br><span class=\"line\">\t$str=fwrite($handle,<span class=\"string\">&quot;test\\n&quot;</span>);</span><br><span class=\"line\">\t fclose($handle);</span><br><span class=\"line\">\t<span class=\"comment\">// 开始操作</span></span><br><span class=\"line\">\t$params = input(<span class=\"string\">&#x27;post.&#x27;</span>);</span><br><span class=\"line\">\t$params[<span class=\"string\">&#x27;admin&#x27;</span>] = <span class=\"keyword\">$this</span>-&gt;admin;</span><br><span class=\"line\">\t$params[<span class=\"string\">&#x27;field&#x27;</span>] = <span class=\"string\">&#x27;price&#x27;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//调用商品管理服务，更新数据库。</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> GoodsService::GoodsPriceUpdate($params);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>替换<code>你的网站/application/admin/controller/Goods.php</code></p>\n<p>完整的Goods.php代码：<a href=\"https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php\">https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php</a></p>\n<ul>\n<li>在商品后台服务中添加更新价格的服务函数</li>\n</ul>\n<p>将以下代码添加到<code>你的网站/application/service/GoodsService.php</code>,或者下载我的<code>GoodsService.php</code>文件，完全替换它。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 修改商品价格</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span>   Qifei</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@blog</span>    https://sci.ci/</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@version</span> 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@date</span>    2020-05-25</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@desc</span>    description</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>   [int]          $goods_id [商品id]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">GoodsPriceUpdate</span>(<span class=\"params\">$params = []</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 请求参数</span></span><br><span class=\"line\">        $p = [</span><br><span class=\"line\">            [</span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_type&#x27;</span>      =&gt; <span class=\"string\">&#x27;empty&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;key_name&#x27;</span>          =&gt; <span class=\"string\">&#x27;id&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;error_msg&#x27;</span>         =&gt; <span class=\"string\">&#x27;操作id有误&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            [</span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_type&#x27;</span>      =&gt; <span class=\"string\">&#x27;empty&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;key_name&#x27;</span>          =&gt; <span class=\"string\">&#x27;field&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;error_msg&#x27;</span>         =&gt; <span class=\"string\">&#x27;未指定操作字段&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            [<span class=\"comment\">//价格在0到5000这个区间</span></span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_type&#x27;</span>      =&gt; <span class=\"string\">&#x27;between&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;key_name&#x27;</span>          =&gt; <span class=\"string\">&#x27;price&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_data&#x27;</span>      =&gt; [<span class=\"number\">0</span>,<span class=\"number\">5000</span>],</span><br><span class=\"line\">                <span class=\"string\">&#x27;error_msg&#x27;</span>         =&gt; <span class=\"string\">&#x27;价格不能小于0，大于5000&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        $ret = ParamsChecked($params, $p);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($ret !== <span class=\"literal\">true</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> DataReturn($ret, <span class=\"number\">-1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"comment\">// 数据更新</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(Db::name(<span class=\"string\">&#x27;Goods&#x27;</span>)-&gt;where([<span class=\"string\">&#x27;id&#x27;</span>=&gt;intval($params[<span class=\"string\">&#x27;id&#x27;</span>])])-&gt;update([$params[<span class=\"string\">&#x27;field&#x27;</span>]=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>),<span class=\"string\">&#x27;min_price&#x27;</span>=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>),<span class=\"string\">&#x27;max_price&#x27;</span>=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>), <span class=\"string\">&#x27;upd_time&#x27;</span>=&gt;time()])&amp;&amp;Db::name(<span class=\"string\">&#x27;GoodsSpecBase&#x27;</span>)-&gt;where([<span class=\"string\">&#x27;goods_id&#x27;</span>=&gt;intval($params[<span class=\"string\">&#x27;id&#x27;</span>])])-&gt;update([$params[<span class=\"string\">&#x27;field&#x27;</span>]=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>)]))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> DataReturn(<span class=\"string\">&#x27;操作成功&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> DataReturn(<span class=\"string\">&#x27;操作失败&#x27;</span>, <span class=\"number\">-100</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>完整<code>GoodsService.php</code>地址：<a href=\"https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php\">https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php</a></p>\n<p>替换<code>你的网站/application/service/GoodsService.php</code></p>\n<ul>\n<li>最后，你需要给新的控制器方法添加访问数据库权限。</li>\n</ul>\n<p>打开ShopXO网站后台<code>你的网站网址/admin.php</code></p>\n<p><img src=\"https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>添加权限：<img src=\"https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>点击保存。至此商品后台优化已经完成。</p>\n<h1 id=\"3：WX小程序优化\"><a href=\"#3：WX小程序优化\" class=\"headerlink\" title=\"3：WX小程序优化\"></a>3：WX小程序优化</h1><h2 id=\"3-1-优化说明\"><a href=\"#3-1-优化说明\" class=\"headerlink\" title=\"3.1 优化说明\"></a>3.1 优化说明</h2><blockquote>\n<p>优化内容：</p>\n<ol>\n<li>修改首页导航栏上传图片，显示太小</li>\n<li>修改分类无法查看一级分类。</li>\n</ol>\n</blockquote>\n<p>修改前后对比</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"3-2-优化工作\"><a href=\"#3-2-优化工作\" class=\"headerlink\" title=\"3.2 优化工作\"></a>3.2 优化工作</h2><ul>\n<li>导航栏修改</li>\n</ul>\n<ol>\n<li>打开小程序源代码，找到<code>components</code>-&gt;<code>icon-nav</code></li>\n</ol>\n<p>替换<code>icon-nav.wxml</code>内容为：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;propData.length &gt; 0&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;data-list&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;items&quot;</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">&quot;&#123;&#123;propData&#125;&#125;&quot;</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">&quot;key&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;item.bg_color===&#x27;#FFFFFF&#x27;&#125;&#125;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;items-content&quot;</span> <span class=\"attr\">data-value</span>=<span class=\"string\">&quot;&#123;&#123;item.event_value&#125;&#125;&quot;</span> <span class=\"attr\">data-type</span>=<span class=\"string\">&quot;&#123;&#123;item.event_type&#125;&#125;&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;navigation_event&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color:#fff;padding:0;height:110rpx;width:110rpx;border-radius:0%&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;item.images_url&#125;&#125;&quot;</span> <span class=\"attr\">mode</span>=<span class=\"string\">&quot;aspectFit&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width:110rpx;height:110rpx&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;items-content&quot;</span> <span class=\"attr\">data-value</span>=<span class=\"string\">&quot;&#123;&#123;item.event_value&#125;&#125;&quot;</span> <span class=\"attr\">data-type</span>=<span class=\"string\">&quot;&#123;&#123;item.event_type&#125;&#125;&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;navigation_event&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color:&#123;&#123;item.bg_color&#125;&#125;;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;item.images_url&#125;&#125;&quot;</span> <span class=\"attr\">mode</span>=<span class=\"string\">&quot;aspectFit&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>代码逻辑：当检测到导航栏背景颜色为白色时，设置图片上一层View标签的内边距padding 为0（原为20rpx）高宽设置为110rpx。并且将图片高宽均增加40rpx（原为70rpx），弥补内边距。</p>\n</blockquote>\n<ol start=\"2\">\n<li>修改<code>icon-nav.wxss</code>文件</li>\n</ol>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.data-list</span> <span class=\"selector-class\">.items</span> <span class=\"selector-tag\">image</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">60</span>rpx ;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">60</span>rpx ;</span><br><span class=\"line\">  <span class=\"attribute\">margin-top</span>: <span class=\"number\">5</span>rpx;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将原来的高宽后面的<code>!important</code>去掉，为了使步骤1中内联的高宽样式生效。</p>\n<p>最后，特别注意：你在网站后台修改导航栏图片时，必须设置导航栏背景色为白色。不设置或者设置为其他颜色，则采用默认的样式。此时图片会比较小。</p>\n<p>修改导航栏：<code>你的网站/admin.php</code>-&gt;<code>手机端管理</code>-&gt;<code>首页导航</code>,修改导航栏</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>确保颜色代码为<code>#FFFFFF</code></p>\n<p><img src=\"https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ul>\n<li>添加分类<code>全部</code>选项</li>\n</ul>\n<p>完全替换小程序源代码中<code>pages</code>-&gt;<code>goods-category</code>-&gt;<code>goods-category.wxml</code>文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;view class&#x3D;&#39;left-nav&#39;&gt;</span><br><span class=\"line\">  &lt;block wx:for&#x3D;&quot;&#123;&#123;data_list&#125;&#125;&quot; wx:key&#x3D;&quot;key&quot;&gt;</span><br><span class=\"line\">    &lt;view class&#x3D;&#39;items &#123;&#123;item.active || &quot;&quot;&#125;&#125;&#39; data-index&#x3D;&quot;&#123;&#123;index&#125;&#125;&quot; bindtap&#x3D;&#39;nav_event&#39;&gt;</span><br><span class=\"line\">      &lt;text&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class=\"line\">    &lt;&#x2F;view&gt;</span><br><span class=\"line\">  &lt;&#x2F;block&gt;</span><br><span class=\"line\">&lt;&#x2F;view&gt;</span><br><span class=\"line\">&lt;view class&#x3D;&#39;right-content bg-white&#39;&gt;</span><br><span class=\"line\">  &lt;view class&#x3D;&quot;content-items&quot; data-value&#x3D;&quot;&#123;&#123;data_first_class[&#39;id&#39;]&#125;&#125;&quot; bindtap&#x3D;&quot;category_event&quot;&gt;</span><br><span class=\"line\">        &lt;view class&#x3D;&quot;text single-text&quot;&gt;全部&lt;&#x2F;view&gt;</span><br><span class=\"line\">  &lt;&#x2F;view&gt;</span><br><span class=\"line\">  &lt;block wx:if&#x3D;&quot;&#123;&#123;data_content.length &gt; 0&#125;&#125;&quot;&gt;</span><br><span class=\"line\">    &lt;block wx:for&#x3D;&quot;&#123;&#123;data_content&#125;&#125;&quot; wx:key&#x3D;&quot;keys&quot; wx:for-item&#x3D;&quot;v&quot;&gt;</span><br><span class=\"line\">      &lt;view class&#x3D;&quot;content-items&quot; data-value&#x3D;&quot;&#123;&#123;v.id&#125;&#125;&quot; bindtap&#x3D;&quot;category_event&quot;&gt;</span><br><span class=\"line\">        &lt;image wx:if&#x3D;&quot;&#123;&#123;(v.icon || null) !&#x3D; null&#125;&#125;&quot; src&#x3D;&quot;&#123;&#123;v.icon&#125;&#125;&quot; mode&#x3D;&quot;aspectFit&quot; class&#x3D;&quot;icon&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;view class&#x3D;&quot;text single-text&quot;&gt;&#123;&#123;v.name&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class=\"line\">      &lt;&#x2F;view&gt;</span><br><span class=\"line\">    &lt;&#x2F;block&gt;</span><br><span class=\"line\">  &lt;&#x2F;block&gt;</span><br><span class=\"line\">&lt;&#x2F;view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;view wx:if&#x3D;&quot;&#123;&#123;data_list.length &#x3D;&#x3D; 0 &amp;&amp; data_list_loding_status !&#x3D; 0&#125;&#125;&quot;&gt;</span><br><span class=\"line\">  &lt;import src&#x3D;&quot;&#x2F;pages&#x2F;common&#x2F;nodata.wxml&quot; &#x2F;&gt;</span><br><span class=\"line\">  &lt;template is&#x3D;&quot;nodata&quot; data&#x3D;&quot;&#123;&#123;status: data_list_loding_status&#125;&#125;&quot;&gt;</span><br><span class=\"line\">  &lt;&#x2F;template&gt;</span><br><span class=\"line\">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>\n\n<p>修改<code>pages</code>-&gt;<code>goods-category</code>-&gt;<code>goods-category.js</code>中部分代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 导航事件</span></span><br><span class=\"line\">  nav_event(e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index = e.currentTarget.dataset.index;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> temp_data = <span class=\"built_in\">this</span>.data.data_list;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> temp_data)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      temp_data[i][<span class=\"string\">&#x27;active&#x27;</span>] = (index == i) ? <span class=\"string\">&#x27;nav-active&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">      data_list: temp_data,</span><br><span class=\"line\">      data_first_class: temp_data[index],</span><br><span class=\"line\">      data_content: temp_data[index][<span class=\"string\">&#x27;items&#x27;</span>],</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>编译运行，即修改完毕。</p>\n<blockquote>\n<p>有个小bug，打开分类页面，第一个一级分类的“全部”，在第一次打开时，会指向全部商品，而不是一级分类的商品。切换到第二个一级分类，再回来，此时点击“全部”，就变正常了。。后续再修复吧。</p>\n</blockquote>\n<h1 id=\"4：新订单通知推送\"><a href=\"#4：新订单通知推送\" class=\"headerlink\" title=\"4：新订单通知推送\"></a>4：新订单通知推送</h1><p>新订单推送，是为了方便商家，接收各个端下单消息。通常，通常都是使用短信和邮箱方式来接收消息，但是邮箱接收效率太低。短信又需要收费。</p>\n<p>这里我们使用两种及时的推送方式，第一种，飞鹅打印机。入住美团、饿了么的商家，通常都会购买这个打印机，因为他是全平台的，而且可以调用它的API接口，自定义打印内容。</p>\n<p>第二种，微信公众号推送。当网站后台接收到新订单，即通过微信公众号的模板消息功能，向指定微信推送新订单消息。</p>\n<p>当然如果你具备一些编程知识，还可以自己写个程序，向下单的用户推送订单的进展。（开发一个插件，调用订单的相关钩子。）</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>为了减少工作量，消息通知，是在原有插件<code>新订单提醒</code>基础上进行的修改。新的插件具有了除邮箱和短信以外的公众号和飞鹅打印功能。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：内容梗概\"><a href=\"#1：内容梗概\" class=\"headerlink\" title=\"1：内容梗概\"></a>1：内容梗概</h1><p>ShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。</p>\n<p>特别说明：此篇文章建议有一定前后端基础的朋友阅读，否则，你在按照本文修改你的网站时，可能由于我在写作时，将某个环节遗漏，而导致你的网站无法做到像我修改后一样的结果。此时，会得不偿失。同时，若你对本文内容有任何疑问，欢迎你通过邮箱与我联系。邮箱几乎每天一看。</p>\n<p>在进行下面修改时，建议你先将你的网站压缩打包，保存一下。避免操作失误无法修复。如果你的修改在达到理想效果后，建议你都进行一下保存操作</p>\n<h1 id=\"2：商城后台优化\"><a href=\"#2：商城后台优化\" class=\"headerlink\" title=\"2：商城后台优化\"></a>2：商城后台优化</h1><h2 id=\"2-1-优化说明\"><a href=\"#2-1-优化说明\" class=\"headerlink\" title=\"2.1 优化说明\"></a>2.1 优化说明</h2><blockquote>\n<p>优化说明：</p>\n<ol>\n<li>手机端显示商品缩率图</li>\n<li>直接点击价格，弹出价格修改框，快速改价。</li>\n<li>隐藏“查看更多”按钮。（给缩略图让空间）</li>\n</ol>\n</blockquote>\n<p>对比：</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg\"></p>\n<p>优化后点击商品价格改价：</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg\"></p>\n<h2 id=\"2-2-优化工作\"><a href=\"#2-2-优化工作\" class=\"headerlink\" title=\"2.2 优化工作\"></a>2.2 优化工作</h2><ul>\n<li>首先在手机端显示缩率图和价格。隐藏查看更多。</li>\n</ul>\n<p>核心代码：替换原有的价格显示样式，并添加一个js控制的弹窗。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;td &gt;</span><br><span class=\"line\">    &lt;button class&#x3D;&quot;am-btn am-btn-success price-changed am-btn-xs am-radius&quot; data-id&#x3D;&quot;&#123;&#123;$v.id&#125;&#125;&quot; data-url&#x3D;&quot;&#123;&#123;:MyUrl(&#39;admin&#x2F;goods&#x2F;pricechanged&#39;)&#125;&#125;&quot; id&#x3D;&quot;doc-prompt-toggle&#123;&#123;$v.id&#125;&#125;&quot; &gt;&#123;&#123;$v.price&#125;&#125;&lt;&#x2F;button&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;am-modal am-modal-prompt&quot; tabindex&#x3D;&quot;-1&quot; id&#x3D;&quot;my-prompt&#123;&#123;$v.id&#125;&#125;&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;am-modal-dialog&quot;&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;am-modal-hd&quot;&gt;&#123;&#123;$v.title&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;am-modal-bd&quot;&gt;</span><br><span class=\"line\">                &lt;img src&#x3D;&quot;&#123;&#123;$v[&#39;images&#39;]&#125;&#125;&quot; class&#x3D;&quot;am-radius&quot; style&#x3D;&quot;width:100%&quot;&#x2F;&gt;</span><br><span class=\"line\">                &lt;input type&#x3D;&quot;number&quot; class&#x3D;&quot;am-modal-prompt-input&quot;  pattern&#x3D;&quot;^([0-9]&#123;1&#125;\\d&#123;0,6&#125;)(\\.\\d&#123;1,2&#125;)?$&quot; data-validation-message&#x3D;&quot;请填写有效的销售金额&quot; placeholder&#x3D;&quot;&#123;&#123;$v.price&#125;&#125;&quot;&gt;元</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;am-modal-footer&quot;&gt;</span><br><span class=\"line\">                &lt;span class&#x3D;&quot;am-modal-btn&quot; data-am-modal-cancel&gt;取消&lt;&#x2F;span&gt;</span><br><span class=\"line\">                &lt;span class&#x3D;&quot;am-modal-btn&quot; data-am-modal-confirm&gt;提交&lt;&#x2F;span&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#123;&#123;if !empty($v[&#39;original_price&#39;]) and $v[&#39;original_price&#39;] gt 0&#125;&#125;</span><br><span class=\"line\">    &lt;br &#x2F;&gt;&lt;span class&#x3D;&quot;am-badge am-radius&quot;&gt;原价 &#123;&#123;$v.original_price&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class=\"line\">    &#123;&#123;&#x2F;if&#125;&#125;</span><br><span class=\"line\">&lt;&#x2F;td&gt;</span><br></pre></td></tr></table></figure>\n\n<p>完整<code>index.html</code>代码链接：<a href=\"https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html\">https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html</a></p>\n<p>将此链接中的代码下载下来，替换原后台商品管理的html代码。替换<code>你的网站根目录/application/admin/view/default/goods/index.html</code>。</p>\n<ul>\n<li>修改js文件，实现点击价格，弹出对话框，提交发送post请求修改数据库</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [doc-prompt-toggle 价格修改弹窗]</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author   <span class=\"variable\">Qifei</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@blog     </span>https://sci.ci/</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version  </span>0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@datetime </span>2020-05-25T14:22:39+0800</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param    <span class=\"type\">&#123;[int] \t[data-id] \t[数据id]&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param    <span class=\"type\">&#123;[int] \t[data-field][数据库内容]&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param    <span class=\"type\">&#123;[string] \t[data-url] \t[请求地址]&#125;</span></span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> $(<span class=\"built_in\">document</span>).on(<span class=\"string\">&#x27;click&#x27;</span>,<span class=\"string\">&#x27;.price-changed&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> tag = $(<span class=\"built_in\">this</span>);</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> id = tag.attr(<span class=\"string\">&#x27;data-id&#x27;</span>);</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> $my_prompt=<span class=\"string\">&#x27;#my-prompt&#x27;</span>+id;</span><br><span class=\"line\"> \t<span class=\"keyword\">var</span> url = tag.attr(<span class=\"string\">&#x27;data-url&#x27;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> field = tag.attr(<span class=\"string\">&#x27;data-field&#x27;</span>) || <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    $($my_prompt).modal(&#123;</span><br><span class=\"line\">      relatedElement: <span class=\"built_in\">this</span>,</span><br><span class=\"line\">      onConfirm: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">           <span class=\"comment\">//获取input标签中的value值</span></span><br><span class=\"line\">      \tprice=data[<span class=\"string\">&#x27;data&#x27;</span>];</span><br><span class=\"line\">      \t<span class=\"keyword\">if</span>(id == <span class=\"literal\">undefined</span> || url == <span class=\"literal\">undefined</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tPrompt(<span class=\"string\">&#x27;参数配置有误&#x27;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 请求更新数据</span></span><br><span class=\"line\">\t\t$.ajax(&#123;</span><br><span class=\"line\">\t\t\turl:url,</span><br><span class=\"line\">\t\t\ttype:<span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">\t\t\tdataType:<span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">\t\t\ttimeout:tag.attr(<span class=\"string\">&#x27;data-timeout&#x27;</span>) || <span class=\"number\">30000</span>,</span><br><span class=\"line\">\t\t\tdata:&#123;<span class=\"string\">&quot;id&quot;</span>:id, <span class=\"string\">&quot;price&quot;</span>:price, <span class=\"string\">&quot;field&quot;</span>:field&#125;,</span><br><span class=\"line\">\t\t\tsuccess:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>)</span></span><br><span class=\"line\"><span class=\"function\">\t\t\t</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(result.code == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t\tPrompt(result.msg, <span class=\"string\">&#x27;success&#x27;</span>);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 成功则更新价格</span></span><br><span class=\"line\">\t\t\t\t\ttag.html(price);</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tPrompt(result.msg);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\terror:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xhr, type</span>)</span></span><br><span class=\"line\"><span class=\"function\">\t\t\t</span>&#123;</span><br><span class=\"line\">\t\t\t\tPrompt(<span class=\"string\">&#x27;网络异常出错&#x27;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      onCancel: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>以上代码加入到common.js文件中，或者下载我的commonjs完全替换这个文件</p>\n</blockquote>\n<p>替换<code>你的网站/public/static/common/js/common.js</code></p>\n<p>完整代码：<a href=\"https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js\">https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js</a></p>\n<ul>\n<li>在Goods控制器里新建一个控制器函数PriceChanged()。实现接收POST数据。</li>\n</ul>\n<p>在<code>application/admin/controller/Goods.php</code>里添加下面的代码。或者完全替换为我的<code>Goods.php</code>。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * [PriceChanged 修改商品价格]</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>   Qifei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@blog</span>     https://sci.ci/</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version</span>  0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@datetime</span> 2020-05-25T22:23:06+0800</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">PriceChanged</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 是否ajax</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(!IS_AJAX)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;error(<span class=\"string\">&#x27;非法访问&#x27;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t$filename=<span class=\"string\">&quot;a.txt&quot;</span>;</span><br><span class=\"line\">\t$handle=fopen($filename,<span class=\"string\">&quot;a+&quot;</span>);</span><br><span class=\"line\">\t$str=fwrite($handle,<span class=\"string\">&quot;test\\n&quot;</span>);</span><br><span class=\"line\">\t fclose($handle);</span><br><span class=\"line\">\t<span class=\"comment\">// 开始操作</span></span><br><span class=\"line\">\t$params = input(<span class=\"string\">&#x27;post.&#x27;</span>);</span><br><span class=\"line\">\t$params[<span class=\"string\">&#x27;admin&#x27;</span>] = <span class=\"keyword\">$this</span>-&gt;admin;</span><br><span class=\"line\">\t$params[<span class=\"string\">&#x27;field&#x27;</span>] = <span class=\"string\">&#x27;price&#x27;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//调用商品管理服务，更新数据库。</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> GoodsService::GoodsPriceUpdate($params);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>替换<code>你的网站/application/admin/controller/Goods.php</code></p>\n<p>完整的Goods.php代码：<a href=\"https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php\">https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php</a></p>\n<ul>\n<li>在商品后台服务中添加更新价格的服务函数</li>\n</ul>\n<p>将以下代码添加到<code>你的网站/application/service/GoodsService.php</code>,或者下载我的<code>GoodsService.php</code>文件，完全替换它。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 修改商品价格</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span>   Qifei</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@blog</span>    https://sci.ci/</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@version</span> 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@date</span>    2020-05-25</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@desc</span>    description</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>   [int]          $goods_id [商品id]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">GoodsPriceUpdate</span>(<span class=\"params\">$params = []</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 请求参数</span></span><br><span class=\"line\">        $p = [</span><br><span class=\"line\">            [</span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_type&#x27;</span>      =&gt; <span class=\"string\">&#x27;empty&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;key_name&#x27;</span>          =&gt; <span class=\"string\">&#x27;id&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;error_msg&#x27;</span>         =&gt; <span class=\"string\">&#x27;操作id有误&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            [</span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_type&#x27;</span>      =&gt; <span class=\"string\">&#x27;empty&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;key_name&#x27;</span>          =&gt; <span class=\"string\">&#x27;field&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;error_msg&#x27;</span>         =&gt; <span class=\"string\">&#x27;未指定操作字段&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            [<span class=\"comment\">//价格在0到5000这个区间</span></span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_type&#x27;</span>      =&gt; <span class=\"string\">&#x27;between&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;key_name&#x27;</span>          =&gt; <span class=\"string\">&#x27;price&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;checked_data&#x27;</span>      =&gt; [<span class=\"number\">0</span>,<span class=\"number\">5000</span>],</span><br><span class=\"line\">                <span class=\"string\">&#x27;error_msg&#x27;</span>         =&gt; <span class=\"string\">&#x27;价格不能小于0，大于5000&#x27;</span>,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        $ret = ParamsChecked($params, $p);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>($ret !== <span class=\"literal\">true</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> DataReturn($ret, <span class=\"number\">-1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"comment\">// 数据更新</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(Db::name(<span class=\"string\">&#x27;Goods&#x27;</span>)-&gt;where([<span class=\"string\">&#x27;id&#x27;</span>=&gt;intval($params[<span class=\"string\">&#x27;id&#x27;</span>])])-&gt;update([$params[<span class=\"string\">&#x27;field&#x27;</span>]=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>),<span class=\"string\">&#x27;min_price&#x27;</span>=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>),<span class=\"string\">&#x27;max_price&#x27;</span>=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>), <span class=\"string\">&#x27;upd_time&#x27;</span>=&gt;time()])&amp;&amp;Db::name(<span class=\"string\">&#x27;GoodsSpecBase&#x27;</span>)-&gt;where([<span class=\"string\">&#x27;goods_id&#x27;</span>=&gt;intval($params[<span class=\"string\">&#x27;id&#x27;</span>])])-&gt;update([$params[<span class=\"string\">&#x27;field&#x27;</span>]=&gt;number_format($params[<span class=\"string\">&#x27;price&#x27;</span>],<span class=\"number\">2</span>)]))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> DataReturn(<span class=\"string\">&#x27;操作成功&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> DataReturn(<span class=\"string\">&#x27;操作失败&#x27;</span>, <span class=\"number\">-100</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>完整<code>GoodsService.php</code>地址：<a href=\"https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php\">https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php</a></p>\n<p>替换<code>你的网站/application/service/GoodsService.php</code></p>\n<ul>\n<li>最后，你需要给新的控制器方法添加访问数据库权限。</li>\n</ul>\n<p>打开ShopXO网站后台<code>你的网站网址/admin.php</code></p>\n<p><img src=\"https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg\"></p>\n<p>添加权限：<img src=\"https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg\"></p>\n<p>点击保存。至此商品后台优化已经完成。</p>\n<h1 id=\"3：WX小程序优化\"><a href=\"#3：WX小程序优化\" class=\"headerlink\" title=\"3：WX小程序优化\"></a>3：WX小程序优化</h1><h2 id=\"3-1-优化说明\"><a href=\"#3-1-优化说明\" class=\"headerlink\" title=\"3.1 优化说明\"></a>3.1 优化说明</h2><blockquote>\n<p>优化内容：</p>\n<ol>\n<li>修改首页导航栏上传图片，显示太小</li>\n<li>修改分类无法查看一级分类。</li>\n</ol>\n</blockquote>\n<p>修改前后对比</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg\"></p>\n<p><img src=\"https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg\"></p>\n<h2 id=\"3-2-优化工作\"><a href=\"#3-2-优化工作\" class=\"headerlink\" title=\"3.2 优化工作\"></a>3.2 优化工作</h2><ul>\n<li>导航栏修改</li>\n</ul>\n<ol>\n<li>打开小程序源代码，找到<code>components</code>-&gt;<code>icon-nav</code></li>\n</ol>\n<p>替换<code>icon-nav.wxml</code>内容为：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;propData.length &gt; 0&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;data-list&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;items&quot;</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">&quot;&#123;&#123;propData&#125;&#125;&quot;</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">&quot;key&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;item.bg_color===&#x27;#FFFFFF&#x27;&#125;&#125;&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;items-content&quot;</span> <span class=\"attr\">data-value</span>=<span class=\"string\">&quot;&#123;&#123;item.event_value&#125;&#125;&quot;</span> <span class=\"attr\">data-type</span>=<span class=\"string\">&quot;&#123;&#123;item.event_type&#125;&#125;&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;navigation_event&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color:#fff;padding:0;height:110rpx;width:110rpx;border-radius:0%&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;item.images_url&#125;&#125;&quot;</span> <span class=\"attr\">mode</span>=<span class=\"string\">&quot;aspectFit&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width:110rpx;height:110rpx&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;items-content&quot;</span> <span class=\"attr\">data-value</span>=<span class=\"string\">&quot;&#123;&#123;item.event_value&#125;&#125;&quot;</span> <span class=\"attr\">data-type</span>=<span class=\"string\">&quot;&#123;&#123;item.event_type&#125;&#125;&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;navigation_event&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color:&#123;&#123;item.bg_color&#125;&#125;;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;item.images_url&#125;&#125;&quot;</span> <span class=\"attr\">mode</span>=<span class=\"string\">&quot;aspectFit&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;&quot;</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>代码逻辑：当检测到导航栏背景颜色为白色时，设置图片上一层View标签的内边距padding 为0（原为20rpx）高宽设置为110rpx。并且将图片高宽均增加40rpx（原为70rpx），弥补内边距。</p>\n</blockquote>\n<ol start=\"2\">\n<li>修改<code>icon-nav.wxss</code>文件</li>\n</ol>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.data-list</span> <span class=\"selector-class\">.items</span> <span class=\"selector-tag\">image</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">60</span>rpx ;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">60</span>rpx ;</span><br><span class=\"line\">  <span class=\"attribute\">margin-top</span>: <span class=\"number\">5</span>rpx;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将原来的高宽后面的<code>!important</code>去掉，为了使步骤1中内联的高宽样式生效。</p>\n<p>最后，特别注意：你在网站后台修改导航栏图片时，必须设置导航栏背景色为白色。不设置或者设置为其他颜色，则采用默认的样式。此时图片会比较小。</p>\n<p>修改导航栏：<code>你的网站/admin.php</code>-&gt;<code>手机端管理</code>-&gt;<code>首页导航</code>,修改导航栏</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg\"></p>\n<p>确保颜色代码为<code>#FFFFFF</code></p>\n<p><img src=\"https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg\"></p>\n<ul>\n<li>添加分类<code>全部</code>选项</li>\n</ul>\n<p>完全替换小程序源代码中<code>pages</code>-&gt;<code>goods-category</code>-&gt;<code>goods-category.wxml</code>文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;view class&#x3D;&#39;left-nav&#39;&gt;</span><br><span class=\"line\">  &lt;block wx:for&#x3D;&quot;&#123;&#123;data_list&#125;&#125;&quot; wx:key&#x3D;&quot;key&quot;&gt;</span><br><span class=\"line\">    &lt;view class&#x3D;&#39;items &#123;&#123;item.active || &quot;&quot;&#125;&#125;&#39; data-index&#x3D;&quot;&#123;&#123;index&#125;&#125;&quot; bindtap&#x3D;&#39;nav_event&#39;&gt;</span><br><span class=\"line\">      &lt;text&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class=\"line\">    &lt;&#x2F;view&gt;</span><br><span class=\"line\">  &lt;&#x2F;block&gt;</span><br><span class=\"line\">&lt;&#x2F;view&gt;</span><br><span class=\"line\">&lt;view class&#x3D;&#39;right-content bg-white&#39;&gt;</span><br><span class=\"line\">  &lt;view class&#x3D;&quot;content-items&quot; data-value&#x3D;&quot;&#123;&#123;data_first_class[&#39;id&#39;]&#125;&#125;&quot; bindtap&#x3D;&quot;category_event&quot;&gt;</span><br><span class=\"line\">        &lt;view class&#x3D;&quot;text single-text&quot;&gt;全部&lt;&#x2F;view&gt;</span><br><span class=\"line\">  &lt;&#x2F;view&gt;</span><br><span class=\"line\">  &lt;block wx:if&#x3D;&quot;&#123;&#123;data_content.length &gt; 0&#125;&#125;&quot;&gt;</span><br><span class=\"line\">    &lt;block wx:for&#x3D;&quot;&#123;&#123;data_content&#125;&#125;&quot; wx:key&#x3D;&quot;keys&quot; wx:for-item&#x3D;&quot;v&quot;&gt;</span><br><span class=\"line\">      &lt;view class&#x3D;&quot;content-items&quot; data-value&#x3D;&quot;&#123;&#123;v.id&#125;&#125;&quot; bindtap&#x3D;&quot;category_event&quot;&gt;</span><br><span class=\"line\">        &lt;image wx:if&#x3D;&quot;&#123;&#123;(v.icon || null) !&#x3D; null&#125;&#125;&quot; src&#x3D;&quot;&#123;&#123;v.icon&#125;&#125;&quot; mode&#x3D;&quot;aspectFit&quot; class&#x3D;&quot;icon&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;view class&#x3D;&quot;text single-text&quot;&gt;&#123;&#123;v.name&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class=\"line\">      &lt;&#x2F;view&gt;</span><br><span class=\"line\">    &lt;&#x2F;block&gt;</span><br><span class=\"line\">  &lt;&#x2F;block&gt;</span><br><span class=\"line\">&lt;&#x2F;view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;view wx:if&#x3D;&quot;&#123;&#123;data_list.length &#x3D;&#x3D; 0 &amp;&amp; data_list_loding_status !&#x3D; 0&#125;&#125;&quot;&gt;</span><br><span class=\"line\">  &lt;import src&#x3D;&quot;&#x2F;pages&#x2F;common&#x2F;nodata.wxml&quot; &#x2F;&gt;</span><br><span class=\"line\">  &lt;template is&#x3D;&quot;nodata&quot; data&#x3D;&quot;&#123;&#123;status: data_list_loding_status&#125;&#125;&quot;&gt;</span><br><span class=\"line\">  &lt;&#x2F;template&gt;</span><br><span class=\"line\">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>\n\n<p>修改<code>pages</code>-&gt;<code>goods-category</code>-&gt;<code>goods-category.js</code>中部分代码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 导航事件</span></span><br><span class=\"line\">  nav_event(e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index = e.currentTarget.dataset.index;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> temp_data = <span class=\"built_in\">this</span>.data.data_list;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> temp_data)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      temp_data[i][<span class=\"string\">&#x27;active&#x27;</span>] = (index == i) ? <span class=\"string\">&#x27;nav-active&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">      data_list: temp_data,</span><br><span class=\"line\">      data_first_class: temp_data[index],</span><br><span class=\"line\">      data_content: temp_data[index][<span class=\"string\">&#x27;items&#x27;</span>],</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>编译运行，即修改完毕。</p>\n<blockquote>\n<p>有个小bug，打开分类页面，第一个一级分类的“全部”，在第一次打开时，会指向全部商品，而不是一级分类的商品。切换到第二个一级分类，再回来，此时点击“全部”，就变正常了。。后续再修复吧。</p>\n</blockquote>\n<h1 id=\"4：新订单通知推送\"><a href=\"#4：新订单通知推送\" class=\"headerlink\" title=\"4：新订单通知推送\"></a>4：新订单通知推送</h1><p>新订单推送，是为了方便商家，接收各个端下单消息。通常，通常都是使用短信和邮箱方式来接收消息，但是邮箱接收效率太低。短信又需要收费。</p>\n<p>这里我们使用两种及时的推送方式，第一种，飞鹅打印机。入住美团、饿了么的商家，通常都会购买这个打印机，因为他是全平台的，而且可以调用它的API接口，自定义打印内容。</p>\n<p>第二种，微信公众号推送。当网站后台接收到新订单，即通过微信公众号的模板消息功能，向指定微信推送新订单消息。</p>\n<p>当然如果你具备一些编程知识，还可以自己写个程序，向下单的用户推送订单的进展。（开发一个插件，调用订单的相关钩子。）</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg\"></p>\n<p>为了减少工作量，消息通知，是在原有插件<code>新订单提醒</code>基础上进行的修改。新的插件具有了除邮箱和短信以外的公众号和飞鹅打印功能。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg\"></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg","popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:46:22 GMT+0200 (GMT+02:00)","title":"ShopXO商城优化-商城后台、小程序、飞鹅订单打印、公众号新订单推送","path":"2020/05/26/ShopXO商城优化商品价格修改/","eyeCatchImage":"https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-05-26T09:40:33.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-05-26T09:40:33.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["ShopXO"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Squid+MySQL储存用户验证通过的IP","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-02T10:02:54.000Z","password":null,"summary":"在文章《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。","_content":"\n# 0：前文\n\n在文章《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。\n\n阅读本文，请确保你已经安装了squid 3.5以上版本。`squid -v`可以查看你的安装版本。\n\n# 1：配置基本环境MySQL和Python\n\n## 1.1 数据库\n\nMysql被广泛用于网站数据库，网上的支持文档很多，重要的是，MySQL在python编程上具有非常好的支持。也就是mysqldb库。\n\n使用数据库，主要是用来存放通过验证器验证的客户端ip，ACL辅助器可以通过读取这个ip，从而acl辅助器通过的ip不再需要验证器验证密码。所以，你使用任何其他数据库都是可以的。建议你选用你自己熟悉的数据库。因为本文对于如何在mysql下，创建数据表，只做大概说明。\n\n我建议使用宝塔面板[bt.cn](bt.cn)安装mysql。这样可以可视化的安装mysql和创建数据库和数据表。也可以规避许多由于数据库权限问题导致的不可控因素。宝塔面板安装和在宝塔面板中安装mysql数据库，可以自行百度。非常简单。\n\n在完成数据库安装后，请你在mysql里添加一个，库名为：squid。用户名为：squid。的数据库。用于存放squid数据。\n\n![](https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg)\n\n数据库新建成功后，点击右边的管理。进入phpmyadmin，新建一个数据表。表名为：sq_client_ip。\n\n![](https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg)\n\n表的结构：\n\n![](https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg)\n\n注意，id项，新建表时，勾选`AI`，AI表示设置id为自增主键。这样每添加一个数据进去，id都会自行增加。\n\n## 1.2 Python\n\n安装Python，简单的安装python，你只需要输入下面指令\n\ncentos:\n\n```shell\nyum -y install python\n```\n\nUbuntu:\n\n```\napt-get -y install python\n```\n\n安装完python，需要安装python的mysqldb库。\n\n```\npip install mysqldb\n```\n\n# 2：自定义基本验证器\n\n新建一个python文件`AuthPro.py`。在里面添加如下内容：\n\n```python\n#!/usr/bin/python\n# coding=UTF-8\nimport sys\nimport MySQLdb\n\"\"\"\"\"\"\ndef matchpasswd(login,passwd):\n    #用户名和密码，用于验证输入的用户名和密码。\n    #你可以自定义验证通过的要求，验证通过，返回True，验证不通过返回False\n    if (login == '修改为你的用户名' and passwd == '修改为你的验证密码'):\n        return True\n    else:\n        return False\ndef write_client_ip_to_db(username,client_ip):\n    #数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式\n    db=MySQLdb.connect(\"localhost\",\"squid\",\"修改为你的密码\",\"squid\",charset='utf8')\n    # 使用cursor()方法获取操作游标 \n    cursor = db.cursor()\n    # 向sq_client_ip表中插入用户名和用户ip\n    sql = \"INSERT INTO sq_client_ip(username, client_ip) VALUES ('%s', '%s')\" % (username,client_ip)\n    try:\n       # 执行sql语句\n       cursor.execute(sql)\n       #Ok 后面的print语句可以向cache日志中输出提示。/var/log/squid/cache.log查看\n       print(\"执行sql语句\")\n       # 提交到数据库执行\n       db.commit()\n    except:\n       #打印错误内容\n       info = sys.exc_info()  \n       print( info[0], \":\", info[1]) \n\t   #发生错误时回滚\n       db.rollback()\n\n    # 关闭数据库连接\n    db.close()\n    return\nwhile True:\n    # read a line from stdin\n    line = sys.stdin.readline()\n    line = line.strip()\n    #提取输入参数。\n    username,password,client_ip = line.split()\n    #判断密码是否匹配\n    if matchpasswd(username, password):\n        #输出ok表示验证通过\n        sys.stdout.write('OK\\n 密码验证通过')\n      \t#将客户端ip添加至数据库ip白名单\n      \twrite_client_ip_to_db(username,client_ip)\n      \t\n    else:\n        sys.stdout.write('ERR\\n 密码验证失败')\n    # Flush the output to stdout.\n    sys.stdout.flush()\n```\n\n将`AuthPro.py`文件拷贝到squid的配置文件夹`/etc/squid`里\n\n# 3：外部ACL辅助器\n\n新建一个python文件`AclHelper.py`。在里面添加如下内容:\n\n```python\n#!/usr/bin/python\n# coding=UTF-8\nimport sys\nimport MySQLdb\n\"\"\"当用户连接squid，传递用户客户端ip地址到外部辅助器，辅助器通过标准输入读取。辅助器查询数据库符合客户端ip的所有项，如果查询结果，显示客户ip在数据库中，则输出ok，否则输出ERR\"\"\"\ndef matchclientip(client_ip):\n    #数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式\n    db=MySQLdb.connect(\"localhost\",\"squid\",\"你的数据库密码\",\"squid\",charset='utf8')\n    # 使用cursor()方法获取操作游标 \n    cursor = db.cursor()\n    # SQL 插入语句\n    sql = \"SELECT * FROM sq_client_ip  WHERE client_ip = '%s'\" % (client_ip)\n    try:\n       # 执行sql语句\n       cursor.execute(sql)\n       result = cursor.fetchone()\n       if result:\n          exist_ip = True\n       else:\n          exist_ip = False\n    except:\n       # 发生错误时回滚\n       db.rollback()\n       exist_ip = False\n\n    # 关闭数据库连接\n    db.close()\n    return exist_ip\nwhile True:\n    # 从标准输入读取一行，“client_ip”\n    line = sys.stdin.readline()\n    #提取输入参数。squid，输入给辅助器的字符串是\"0 xx.xx.xx.xx\"格式\n    #利用split分割字符串，得到0和client_ip的list\n    client_ip = line.strip().split()[1]\n    #判断密码是否匹配\n    if matchclientip(client_ip):\n        #输出ok表示验证通过\n        sys.stdout.write('OK\\n')\n        #print会将信息输出到/var/log/squid/cache.log中。\n        print(\"Acl辅助器验证成功\")\n    else:\n        sys.stdout.write('ERR\\n')\n        print(\"ACL辅助器验证失败\")\n    # Flush the output to stdout.\n    sys.stdout.flush()\n```\n\n将`AclHelper.py`文件拷贝到squid的配置文件夹`/etc/squid`里\n\n# 4：修改squid配置文件\n\n```shell\n# http_port 设置监听端口，默认为3128\nhttp_port 6666\n\n#父squid配置，配合国外服务器server2使用\nnonhierarchical_direct off\n#转发请求通过stunnel至父squid\ncache_peer localhost parent 3128 0 default\nnever_direct allow all\n\n# access_log 设置access日志，daemon表示在后台将日志写入/var/log/squid/access.log文件, \n# combined是一个预定义的logformat，也可以使用自定义的logformat\naccess_log daemon:/var/log/squid/access.log combined\n \n\n# ACLs all, manager, localhost, and to_localhost are predefined.\nacl SSL_ports port 443\nacl Safe_ports port 80\t\t# http\nacl Safe_ports port 21\t\t# ftp\nacl Safe_ports port 443\t\t# https\nacl Safe_ports port 70\t\t# gopher\nacl Safe_ports port 210\t\t# wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280\t\t# http-mgmt\nacl Safe_ports port 488\t\t# gss-http\nacl Safe_ports port 591\t\t# filemaker\nacl Safe_ports port 777\t\t# multiling http\nacl CONNECT method CONNECT\n \n# 拒绝所有非Safe_ports的请求\nhttp_access deny !Safe_ports\n# 拒绝所有非SSL_prots的CONNECT请求\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\n#http_access deny manager\n# 允许来自本地的请求\nhttp_access allow localhost\n\n######################################\n#定义一个外部ACL辅助器\n#使用python解释器，negativettl表示验证错误时的缓存时间单位秒，concurrency表示最多接收的认证通过用户，ipv4必须，如果没有ipv4会报错。\nexternal_acl_type MyAclHelper negative_ttl=1 concurrency=30 ipv4 %SRC /usr/bin/python /etc/squid/AclHelper.py\nacl MyAcl external MyAclHelper\nhttp_access allow MyAcl\n\n#定义一个验证器\n#指定python运行目录，和python程序的目录\nauth_param basic program /usr/bin/python /etc/squid/AuthPro.py\n#向python程序中输入key_extras变量客户端ip\"%>a\"\nauth_param basic key_extras \"%>a\"\n#允许多少个子程序\nauth_param basic children 30\n#输入框提示信息\nauth_param basic realm 输入用户名和密码\n#验证信息的缓存时长\nauth_param basic credentialsttl 1 second\n#用户名和密码是否区分大小写\nauth_param basic casesensitive on\n#强制用户验证\nacl authenticated proxy_auth REQUIRED\nhttp_access allow authenticated\n################################################\n\n# 拒绝所有请求，最后兜底的规则\nhttp_access deny all\n```\n\n> 特别需要注意的是：\n>\n> 1. 必须辅助器配置在前，而验证器配置在后。由于squid特殊的处理机制，当squid从配置文件指定的http_access中找到了符合的条件的allow或deny信息，则后续的判断将不会再生效，也就是说，只有在用户无法通过辅助器验证时，才会进行验证器验证。\n>\n> 2. 辅助器必须设置negative_ttl项，而且设置的不通过验证时间不易过长，最好在几秒内。原因是，当用户连接squid后，首先通过辅助器查找数据库是否有此ip，如果没有辅助器会缓存此ip信息，并将其标记为未通过验证，再进入验证器。而通常，我们首先于squid连接上网的并不是浏览器，可能收微博软件等，这些软件由于无法弹出验证窗口，而导致验证器验证失败。此后即便你打开浏览器，而由于上一次的验证失败而缓存了失败信息，致使，squid不会再进行辅助器和验证器验证，而直接拒绝访问。因此设置验证失败缓存时间短点，可以保证我们打开浏览器时，还能进入辅助器验证和验证器验证。\n>\n> 3. 验证器必须设置credentialsttl项，且设置时间不易过长，最好在几秒内。之所以验证器验证成功的缓存不能太长，是因为当我们首次通过验证器验证后，squid缓存成功验证的用户信息，下次用户则无需再次经过验证器密码验证，直接读取用户名和ip。但是由于squid缓存的是用户的ip和用户名，如果你使用了微博等没有验证框的软件，由于没有向squid发送用户名，会导致无法联网。\n>\n>    所以，我们利用验证器，只是为了保存成功验证的用户ip，然后通过辅助器来验证用户。所以，通过后则清除验证器的缓存。\n>\n>    用户再次上网，便会首先经过辅助器，此时辅助器已经能从数据库读取到刚才验证器保存的客户ip。辅助器，可以设置比较久的成功ttl时长，如果没有设置，默认是一个小时。\n\n# 5：参考资料\n\n《[squid中文权威指南](http://blog.zyan.cc/book/squid/)》\n\n《[用Python脚本打造Squid权限认证后端程序以及Squid3.5 auth_param key_extras新特性介绍](http://www.site-digger.com/html/articles/20161012/132.html)》\n\n《[使用squid搭建代理服务器](https://www.hawu.me/operation/852)》\n\n《[Feature: Add-On Helpers for Request Manipulation](https://wiki.squid-cache.org/Features/AddonHelpers)》\n\n《[stackoverflow上关于自定义验证器输入客户端IP的回答](https://stackoverflow.com/questions/26601943/how-to-configure-squid-to-pass-client-ip-to-authenticate-program?rq=1)》\n\n> 最后，感谢https://www.hawu.me  站长，提供的一些帮助。\n\n","source":"_posts/Squid-MySQL储存用户验证通过的IP.md","raw":"---\n\ntitle: Squid+MySQL储存用户验证通过的IP\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-02 12:02:54\npassword:\nsummary: 在文章《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。\ntags: \n - Squid\n - Mysql\ncategories: 其他\n---\n\n# 0：前文\n\n在文章《[利用Stunnel+squid代理实现国内无客户端访问外网](https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/)》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。\n\n阅读本文，请确保你已经安装了squid 3.5以上版本。`squid -v`可以查看你的安装版本。\n\n# 1：配置基本环境MySQL和Python\n\n## 1.1 数据库\n\nMysql被广泛用于网站数据库，网上的支持文档很多，重要的是，MySQL在python编程上具有非常好的支持。也就是mysqldb库。\n\n使用数据库，主要是用来存放通过验证器验证的客户端ip，ACL辅助器可以通过读取这个ip，从而acl辅助器通过的ip不再需要验证器验证密码。所以，你使用任何其他数据库都是可以的。建议你选用你自己熟悉的数据库。因为本文对于如何在mysql下，创建数据表，只做大概说明。\n\n我建议使用宝塔面板[bt.cn](bt.cn)安装mysql。这样可以可视化的安装mysql和创建数据库和数据表。也可以规避许多由于数据库权限问题导致的不可控因素。宝塔面板安装和在宝塔面板中安装mysql数据库，可以自行百度。非常简单。\n\n在完成数据库安装后，请你在mysql里添加一个，库名为：squid。用户名为：squid。的数据库。用于存放squid数据。\n\n![](https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg)\n\n数据库新建成功后，点击右边的管理。进入phpmyadmin，新建一个数据表。表名为：sq_client_ip。\n\n![](https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg)\n\n表的结构：\n\n![](https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg)\n\n注意，id项，新建表时，勾选`AI`，AI表示设置id为自增主键。这样每添加一个数据进去，id都会自行增加。\n\n## 1.2 Python\n\n安装Python，简单的安装python，你只需要输入下面指令\n\ncentos:\n\n```shell\nyum -y install python\n```\n\nUbuntu:\n\n```\napt-get -y install python\n```\n\n安装完python，需要安装python的mysqldb库。\n\n```\npip install mysqldb\n```\n\n# 2：自定义基本验证器\n\n新建一个python文件`AuthPro.py`。在里面添加如下内容：\n\n```python\n#!/usr/bin/python\n# coding=UTF-8\nimport sys\nimport MySQLdb\n\"\"\"\"\"\"\ndef matchpasswd(login,passwd):\n    #用户名和密码，用于验证输入的用户名和密码。\n    #你可以自定义验证通过的要求，验证通过，返回True，验证不通过返回False\n    if (login == '修改为你的用户名' and passwd == '修改为你的验证密码'):\n        return True\n    else:\n        return False\ndef write_client_ip_to_db(username,client_ip):\n    #数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式\n    db=MySQLdb.connect(\"localhost\",\"squid\",\"修改为你的密码\",\"squid\",charset='utf8')\n    # 使用cursor()方法获取操作游标 \n    cursor = db.cursor()\n    # 向sq_client_ip表中插入用户名和用户ip\n    sql = \"INSERT INTO sq_client_ip(username, client_ip) VALUES ('%s', '%s')\" % (username,client_ip)\n    try:\n       # 执行sql语句\n       cursor.execute(sql)\n       #Ok 后面的print语句可以向cache日志中输出提示。/var/log/squid/cache.log查看\n       print(\"执行sql语句\")\n       # 提交到数据库执行\n       db.commit()\n    except:\n       #打印错误内容\n       info = sys.exc_info()  \n       print( info[0], \":\", info[1]) \n\t   #发生错误时回滚\n       db.rollback()\n\n    # 关闭数据库连接\n    db.close()\n    return\nwhile True:\n    # read a line from stdin\n    line = sys.stdin.readline()\n    line = line.strip()\n    #提取输入参数。\n    username,password,client_ip = line.split()\n    #判断密码是否匹配\n    if matchpasswd(username, password):\n        #输出ok表示验证通过\n        sys.stdout.write('OK\\n 密码验证通过')\n      \t#将客户端ip添加至数据库ip白名单\n      \twrite_client_ip_to_db(username,client_ip)\n      \t\n    else:\n        sys.stdout.write('ERR\\n 密码验证失败')\n    # Flush the output to stdout.\n    sys.stdout.flush()\n```\n\n将`AuthPro.py`文件拷贝到squid的配置文件夹`/etc/squid`里\n\n# 3：外部ACL辅助器\n\n新建一个python文件`AclHelper.py`。在里面添加如下内容:\n\n```python\n#!/usr/bin/python\n# coding=UTF-8\nimport sys\nimport MySQLdb\n\"\"\"当用户连接squid，传递用户客户端ip地址到外部辅助器，辅助器通过标准输入读取。辅助器查询数据库符合客户端ip的所有项，如果查询结果，显示客户ip在数据库中，则输出ok，否则输出ERR\"\"\"\ndef matchclientip(client_ip):\n    #数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式\n    db=MySQLdb.connect(\"localhost\",\"squid\",\"你的数据库密码\",\"squid\",charset='utf8')\n    # 使用cursor()方法获取操作游标 \n    cursor = db.cursor()\n    # SQL 插入语句\n    sql = \"SELECT * FROM sq_client_ip  WHERE client_ip = '%s'\" % (client_ip)\n    try:\n       # 执行sql语句\n       cursor.execute(sql)\n       result = cursor.fetchone()\n       if result:\n          exist_ip = True\n       else:\n          exist_ip = False\n    except:\n       # 发生错误时回滚\n       db.rollback()\n       exist_ip = False\n\n    # 关闭数据库连接\n    db.close()\n    return exist_ip\nwhile True:\n    # 从标准输入读取一行，“client_ip”\n    line = sys.stdin.readline()\n    #提取输入参数。squid，输入给辅助器的字符串是\"0 xx.xx.xx.xx\"格式\n    #利用split分割字符串，得到0和client_ip的list\n    client_ip = line.strip().split()[1]\n    #判断密码是否匹配\n    if matchclientip(client_ip):\n        #输出ok表示验证通过\n        sys.stdout.write('OK\\n')\n        #print会将信息输出到/var/log/squid/cache.log中。\n        print(\"Acl辅助器验证成功\")\n    else:\n        sys.stdout.write('ERR\\n')\n        print(\"ACL辅助器验证失败\")\n    # Flush the output to stdout.\n    sys.stdout.flush()\n```\n\n将`AclHelper.py`文件拷贝到squid的配置文件夹`/etc/squid`里\n\n# 4：修改squid配置文件\n\n```shell\n# http_port 设置监听端口，默认为3128\nhttp_port 6666\n\n#父squid配置，配合国外服务器server2使用\nnonhierarchical_direct off\n#转发请求通过stunnel至父squid\ncache_peer localhost parent 3128 0 default\nnever_direct allow all\n\n# access_log 设置access日志，daemon表示在后台将日志写入/var/log/squid/access.log文件, \n# combined是一个预定义的logformat，也可以使用自定义的logformat\naccess_log daemon:/var/log/squid/access.log combined\n \n\n# ACLs all, manager, localhost, and to_localhost are predefined.\nacl SSL_ports port 443\nacl Safe_ports port 80\t\t# http\nacl Safe_ports port 21\t\t# ftp\nacl Safe_ports port 443\t\t# https\nacl Safe_ports port 70\t\t# gopher\nacl Safe_ports port 210\t\t# wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280\t\t# http-mgmt\nacl Safe_ports port 488\t\t# gss-http\nacl Safe_ports port 591\t\t# filemaker\nacl Safe_ports port 777\t\t# multiling http\nacl CONNECT method CONNECT\n \n# 拒绝所有非Safe_ports的请求\nhttp_access deny !Safe_ports\n# 拒绝所有非SSL_prots的CONNECT请求\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\n#http_access deny manager\n# 允许来自本地的请求\nhttp_access allow localhost\n\n######################################\n#定义一个外部ACL辅助器\n#使用python解释器，negativettl表示验证错误时的缓存时间单位秒，concurrency表示最多接收的认证通过用户，ipv4必须，如果没有ipv4会报错。\nexternal_acl_type MyAclHelper negative_ttl=1 concurrency=30 ipv4 %SRC /usr/bin/python /etc/squid/AclHelper.py\nacl MyAcl external MyAclHelper\nhttp_access allow MyAcl\n\n#定义一个验证器\n#指定python运行目录，和python程序的目录\nauth_param basic program /usr/bin/python /etc/squid/AuthPro.py\n#向python程序中输入key_extras变量客户端ip\"%>a\"\nauth_param basic key_extras \"%>a\"\n#允许多少个子程序\nauth_param basic children 30\n#输入框提示信息\nauth_param basic realm 输入用户名和密码\n#验证信息的缓存时长\nauth_param basic credentialsttl 1 second\n#用户名和密码是否区分大小写\nauth_param basic casesensitive on\n#强制用户验证\nacl authenticated proxy_auth REQUIRED\nhttp_access allow authenticated\n################################################\n\n# 拒绝所有请求，最后兜底的规则\nhttp_access deny all\n```\n\n> 特别需要注意的是：\n>\n> 1. 必须辅助器配置在前，而验证器配置在后。由于squid特殊的处理机制，当squid从配置文件指定的http_access中找到了符合的条件的allow或deny信息，则后续的判断将不会再生效，也就是说，只有在用户无法通过辅助器验证时，才会进行验证器验证。\n>\n> 2. 辅助器必须设置negative_ttl项，而且设置的不通过验证时间不易过长，最好在几秒内。原因是，当用户连接squid后，首先通过辅助器查找数据库是否有此ip，如果没有辅助器会缓存此ip信息，并将其标记为未通过验证，再进入验证器。而通常，我们首先于squid连接上网的并不是浏览器，可能收微博软件等，这些软件由于无法弹出验证窗口，而导致验证器验证失败。此后即便你打开浏览器，而由于上一次的验证失败而缓存了失败信息，致使，squid不会再进行辅助器和验证器验证，而直接拒绝访问。因此设置验证失败缓存时间短点，可以保证我们打开浏览器时，还能进入辅助器验证和验证器验证。\n>\n> 3. 验证器必须设置credentialsttl项，且设置时间不易过长，最好在几秒内。之所以验证器验证成功的缓存不能太长，是因为当我们首次通过验证器验证后，squid缓存成功验证的用户信息，下次用户则无需再次经过验证器密码验证，直接读取用户名和ip。但是由于squid缓存的是用户的ip和用户名，如果你使用了微博等没有验证框的软件，由于没有向squid发送用户名，会导致无法联网。\n>\n>    所以，我们利用验证器，只是为了保存成功验证的用户ip，然后通过辅助器来验证用户。所以，通过后则清除验证器的缓存。\n>\n>    用户再次上网，便会首先经过辅助器，此时辅助器已经能从数据库读取到刚才验证器保存的客户ip。辅助器，可以设置比较久的成功ttl时长，如果没有设置，默认是一个小时。\n\n# 5：参考资料\n\n《[squid中文权威指南](http://blog.zyan.cc/book/squid/)》\n\n《[用Python脚本打造Squid权限认证后端程序以及Squid3.5 auth_param key_extras新特性介绍](http://www.site-digger.com/html/articles/20161012/132.html)》\n\n《[使用squid搭建代理服务器](https://www.hawu.me/operation/852)》\n\n《[Feature: Add-On Helpers for Request Manipulation](https://wiki.squid-cache.org/Features/AddonHelpers)》\n\n《[stackoverflow上关于自定义验证器输入客户端IP的回答](https://stackoverflow.com/questions/26601943/how-to-configure-squid-to-pass-client-ip-to-authenticate-program?rq=1)》\n\n> 最后，感谢https://www.hawu.me  站长，提供的一些帮助。\n\n","slug":"Squid-MySQL储存用户验证通过的IP","published":1,"updated":"2020-06-20T06:48:28.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabf001fp0vz6lzc6l3h","content":"<h1 id=\"0：前文\"><a href=\"#0：前文\" class=\"headerlink\" title=\"0：前文\"></a>0：前文</h1><p>在文章《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。</p>\n<p>阅读本文，请确保你已经安装了squid 3.5以上版本。<code>squid -v</code>可以查看你的安装版本。</p>\n<h1 id=\"1：配置基本环境MySQL和Python\"><a href=\"#1：配置基本环境MySQL和Python\" class=\"headerlink\" title=\"1：配置基本环境MySQL和Python\"></a>1：配置基本环境MySQL和Python</h1><h2 id=\"1-1-数据库\"><a href=\"#1-1-数据库\" class=\"headerlink\" title=\"1.1 数据库\"></a>1.1 数据库</h2><p>Mysql被广泛用于网站数据库，网上的支持文档很多，重要的是，MySQL在python编程上具有非常好的支持。也就是mysqldb库。</p>\n<p>使用数据库，主要是用来存放通过验证器验证的客户端ip，ACL辅助器可以通过读取这个ip，从而acl辅助器通过的ip不再需要验证器验证密码。所以，你使用任何其他数据库都是可以的。建议你选用你自己熟悉的数据库。因为本文对于如何在mysql下，创建数据表，只做大概说明。</p>\n<p>我建议使用宝塔面板<a href=\"bt.cn\">bt.cn</a>安装mysql。这样可以可视化的安装mysql和创建数据库和数据表。也可以规避许多由于数据库权限问题导致的不可控因素。宝塔面板安装和在宝塔面板中安装mysql数据库，可以自行百度。非常简单。</p>\n<p>在完成数据库安装后，请你在mysql里添加一个，库名为：squid。用户名为：squid。的数据库。用于存放squid数据。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>数据库新建成功后，点击右边的管理。进入phpmyadmin，新建一个数据表。表名为：sq_client_ip。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>表的结构：</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>注意，id项，新建表时，勾选<code>AI</code>，AI表示设置id为自增主键。这样每添加一个数据进去，id都会自行增加。</p>\n<h2 id=\"1-2-Python\"><a href=\"#1-2-Python\" class=\"headerlink\" title=\"1.2 Python\"></a>1.2 Python</h2><p>安装Python，简单的安装python，你只需要输入下面指令</p>\n<p>centos:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install python</span><br></pre></td></tr></table></figure>\n\n<p>Ubuntu:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get -y install python</span><br></pre></td></tr></table></figure>\n\n<p>安装完python，需要安装python的mysqldb库。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install mysqldb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2：自定义基本验证器\"><a href=\"#2：自定义基本验证器\" class=\"headerlink\" title=\"2：自定义基本验证器\"></a>2：自定义基本验证器</h1><p>新建一个python文件<code>AuthPro.py</code>。在里面添加如下内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\"># coding=UTF-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> MySQLdb</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">matchpasswd</span>(<span class=\"params\">login,passwd</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#用户名和密码，用于验证输入的用户名和密码。</span></span><br><span class=\"line\">    <span class=\"comment\">#你可以自定义验证通过的要求，验证通过，返回True，验证不通过返回False</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (login == <span class=\"string\">&#x27;修改为你的用户名&#x27;</span> <span class=\"keyword\">and</span> passwd == <span class=\"string\">&#x27;修改为你的验证密码&#x27;</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">write_client_ip_to_db</span>(<span class=\"params\">username,client_ip</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式</span></span><br><span class=\"line\">    db=MySQLdb.connect(<span class=\"string\">&quot;localhost&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,<span class=\"string\">&quot;修改为你的密码&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,charset=<span class=\"string\">&#x27;utf8&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 使用cursor()方法获取操作游标 </span></span><br><span class=\"line\">    cursor = db.cursor()</span><br><span class=\"line\">    <span class=\"comment\"># 向sq_client_ip表中插入用户名和用户ip</span></span><br><span class=\"line\">    sql = <span class=\"string\">&quot;INSERT INTO sq_client_ip(username, client_ip) VALUES (&#x27;%s&#x27;, &#x27;%s&#x27;)&quot;</span> % (username,client_ip)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">       <span class=\"comment\"># 执行sql语句</span></span><br><span class=\"line\">       cursor.execute(sql)</span><br><span class=\"line\">       <span class=\"comment\">#Ok 后面的print语句可以向cache日志中输出提示。/var/log/squid/cache.log查看</span></span><br><span class=\"line\">       print(<span class=\"string\">&quot;执行sql语句&quot;</span>)</span><br><span class=\"line\">       <span class=\"comment\"># 提交到数据库执行</span></span><br><span class=\"line\">       db.commit()</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">       <span class=\"comment\">#打印错误内容</span></span><br><span class=\"line\">       info = sys.exc_info()  </span><br><span class=\"line\">       print( info[<span class=\"number\">0</span>], <span class=\"string\">&quot;:&quot;</span>, info[<span class=\"number\">1</span>]) </span><br><span class=\"line\">\t   <span class=\"comment\">#发生错误时回滚</span></span><br><span class=\"line\">       db.rollback()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 关闭数据库连接</span></span><br><span class=\"line\">    db.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"comment\"># read a line from stdin</span></span><br><span class=\"line\">    line = sys.stdin.readline()</span><br><span class=\"line\">    line = line.strip()</span><br><span class=\"line\">    <span class=\"comment\">#提取输入参数。</span></span><br><span class=\"line\">    username,password,client_ip = line.split()</span><br><span class=\"line\">    <span class=\"comment\">#判断密码是否匹配</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> matchpasswd(username, password):</span><br><span class=\"line\">        <span class=\"comment\">#输出ok表示验证通过</span></span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;OK\\n 密码验证通过&#x27;</span>)</span><br><span class=\"line\">      \t<span class=\"comment\">#将客户端ip添加至数据库ip白名单</span></span><br><span class=\"line\">      \twrite_client_ip_to_db(username,client_ip)</span><br><span class=\"line\">      \t</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;ERR\\n 密码验证失败&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># Flush the output to stdout.</span></span><br><span class=\"line\">    sys.stdout.flush()</span><br></pre></td></tr></table></figure>\n\n<p>将<code>AuthPro.py</code>文件拷贝到squid的配置文件夹<code>/etc/squid</code>里</p>\n<h1 id=\"3：外部ACL辅助器\"><a href=\"#3：外部ACL辅助器\" class=\"headerlink\" title=\"3：外部ACL辅助器\"></a>3：外部ACL辅助器</h1><p>新建一个python文件<code>AclHelper.py</code>。在里面添加如下内容:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\"># coding=UTF-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> MySQLdb</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;当用户连接squid，传递用户客户端ip地址到外部辅助器，辅助器通过标准输入读取。辅助器查询数据库符合客户端ip的所有项，如果查询结果，显示客户ip在数据库中，则输出ok，否则输出ERR&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">matchclientip</span>(<span class=\"params\">client_ip</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式</span></span><br><span class=\"line\">    db=MySQLdb.connect(<span class=\"string\">&quot;localhost&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,<span class=\"string\">&quot;你的数据库密码&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,charset=<span class=\"string\">&#x27;utf8&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 使用cursor()方法获取操作游标 </span></span><br><span class=\"line\">    cursor = db.cursor()</span><br><span class=\"line\">    <span class=\"comment\"># SQL 插入语句</span></span><br><span class=\"line\">    sql = <span class=\"string\">&quot;SELECT * FROM sq_client_ip  WHERE client_ip = &#x27;%s&#x27;&quot;</span> % (client_ip)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">       <span class=\"comment\"># 执行sql语句</span></span><br><span class=\"line\">       cursor.execute(sql)</span><br><span class=\"line\">       result = cursor.fetchone()</span><br><span class=\"line\">       <span class=\"keyword\">if</span> result:</span><br><span class=\"line\">          exist_ip = <span class=\"literal\">True</span></span><br><span class=\"line\">       <span class=\"keyword\">else</span>:</span><br><span class=\"line\">          exist_ip = <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">       <span class=\"comment\"># 发生错误时回滚</span></span><br><span class=\"line\">       db.rollback()</span><br><span class=\"line\">       exist_ip = <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 关闭数据库连接</span></span><br><span class=\"line\">    db.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> exist_ip</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 从标准输入读取一行，“client_ip”</span></span><br><span class=\"line\">    line = sys.stdin.readline()</span><br><span class=\"line\">    <span class=\"comment\">#提取输入参数。squid，输入给辅助器的字符串是&quot;0 xx.xx.xx.xx&quot;格式</span></span><br><span class=\"line\">    <span class=\"comment\">#利用split分割字符串，得到0和client_ip的list</span></span><br><span class=\"line\">    client_ip = line.strip().split()[<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"comment\">#判断密码是否匹配</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> matchclientip(client_ip):</span><br><span class=\"line\">        <span class=\"comment\">#输出ok表示验证通过</span></span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;OK\\n&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\">#print会将信息输出到/var/log/squid/cache.log中。</span></span><br><span class=\"line\">        print(<span class=\"string\">&quot;Acl辅助器验证成功&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;ERR\\n&#x27;</span>)</span><br><span class=\"line\">        print(<span class=\"string\">&quot;ACL辅助器验证失败&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># Flush the output to stdout.</span></span><br><span class=\"line\">    sys.stdout.flush()</span><br></pre></td></tr></table></figure>\n\n<p>将<code>AclHelper.py</code>文件拷贝到squid的配置文件夹<code>/etc/squid</code>里</p>\n<h1 id=\"4：修改squid配置文件\"><a href=\"#4：修改squid配置文件\" class=\"headerlink\" title=\"4：修改squid配置文件\"></a>4：修改squid配置文件</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> http_port 设置监听端口，默认为3128</span></span><br><span class=\"line\">http_port 6666</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">父squid配置，配合国外服务器server2使用</span></span><br><span class=\"line\">nonhierarchical_direct off</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">转发请求通过stunnel至父squid</span></span><br><span class=\"line\">cache_peer localhost parent 3128 0 default</span><br><span class=\"line\">never_direct allow all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class=\"built_in\">log</span>/squid/access.log文件, </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class=\"line\">access_log daemon:/var/log/squid/access.log combined</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80\t\t# http</span><br><span class=\"line\">acl Safe_ports port 21\t\t# ftp</span><br><span class=\"line\">acl Safe_ports port 443\t\t# https</span><br><span class=\"line\">acl Safe_ports port 70\t\t# gopher</span><br><span class=\"line\">acl Safe_ports port 210\t\t# wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280\t\t# http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488\t\t# gss-http</span><br><span class=\"line\">acl Safe_ports port 591\t\t# filemaker</span><br><span class=\"line\">acl Safe_ports port 777\t\t# multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非Safe_ports的请求</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Only allow cachemgr access from localhost</span></span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">http_access deny manager</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许来自本地的请求</span></span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">#####################################</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">定义一个外部ACL辅助器</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">使用python解释器，negativettl表示验证错误时的缓存时间单位秒，concurrency表示最多接收的认证通过用户，ipv4必须，如果没有ipv4会报错。</span></span><br><span class=\"line\">external_acl_type MyAclHelper negative_ttl=1 concurrency=30 ipv4 %SRC /usr/bin/python /etc/squid/AclHelper.py</span><br><span class=\"line\">acl MyAcl external MyAclHelper</span><br><span class=\"line\">http_access allow MyAcl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">定义一个验证器</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">指定python运行目录，和python程序的目录</span></span><br><span class=\"line\">auth_param basic program /usr/bin/python /etc/squid/AuthPro.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">向python程序中输入key_extras变量客户端ip<span class=\"string\">&quot;%&gt;a&quot;</span></span></span><br><span class=\"line\">auth_param basic key_extras &quot;%&gt;a&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">允许多少个子程序</span></span><br><span class=\"line\">auth_param basic children 30</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">输入框提示信息</span></span><br><span class=\"line\">auth_param basic realm 输入用户名和密码</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">验证信息的缓存时长</span></span><br><span class=\"line\">auth_param basic credentialsttl 1 second</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">用户名和密码是否区分大小写</span></span><br><span class=\"line\">auth_param basic casesensitive on</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">强制用户验证</span></span><br><span class=\"line\">acl authenticated proxy_auth REQUIRED</span><br><span class=\"line\">http_access allow authenticated</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">###############################################</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有请求，最后兜底的规则</span></span><br><span class=\"line\">http_access deny all</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>特别需要注意的是：</p>\n<ol>\n<li><p>必须辅助器配置在前，而验证器配置在后。由于squid特殊的处理机制，当squid从配置文件指定的http_access中找到了符合的条件的allow或deny信息，则后续的判断将不会再生效，也就是说，只有在用户无法通过辅助器验证时，才会进行验证器验证。</p>\n</li>\n<li><p>辅助器必须设置negative_ttl项，而且设置的不通过验证时间不易过长，最好在几秒内。原因是，当用户连接squid后，首先通过辅助器查找数据库是否有此ip，如果没有辅助器会缓存此ip信息，并将其标记为未通过验证，再进入验证器。而通常，我们首先于squid连接上网的并不是浏览器，可能收微博软件等，这些软件由于无法弹出验证窗口，而导致验证器验证失败。此后即便你打开浏览器，而由于上一次的验证失败而缓存了失败信息，致使，squid不会再进行辅助器和验证器验证，而直接拒绝访问。因此设置验证失败缓存时间短点，可以保证我们打开浏览器时，还能进入辅助器验证和验证器验证。</p>\n</li>\n<li><p>验证器必须设置credentialsttl项，且设置时间不易过长，最好在几秒内。之所以验证器验证成功的缓存不能太长，是因为当我们首次通过验证器验证后，squid缓存成功验证的用户信息，下次用户则无需再次经过验证器密码验证，直接读取用户名和ip。但是由于squid缓存的是用户的ip和用户名，如果你使用了微博等没有验证框的软件，由于没有向squid发送用户名，会导致无法联网。</p>\n<p>所以，我们利用验证器，只是为了保存成功验证的用户ip，然后通过辅助器来验证用户。所以，通过后则清除验证器的缓存。</p>\n<p>用户再次上网，便会首先经过辅助器，此时辅助器已经能从数据库读取到刚才验证器保存的客户ip。辅助器，可以设置比较久的成功ttl时长，如果没有设置，默认是一个小时。</p>\n</li>\n</ol>\n</blockquote>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"http://blog.zyan.cc/book/squid/\">squid中文权威指南</a>》</p>\n<p>《<a href=\"http://www.site-digger.com/html/articles/20161012/132.html\">用Python脚本打造Squid权限认证后端程序以及Squid3.5 auth_param key_extras新特性介绍</a>》</p>\n<p>《<a href=\"https://www.hawu.me/operation/852\">使用squid搭建代理服务器</a>》</p>\n<p>《<a href=\"https://wiki.squid-cache.org/Features/AddonHelpers\">Feature: Add-On Helpers for Request Manipulation</a>》</p>\n<p>《<a href=\"https://stackoverflow.com/questions/26601943/how-to-configure-squid-to-pass-client-ip-to-authenticate-program?rq=1\">stackoverflow上关于自定义验证器输入客户端IP的回答</a>》</p>\n<blockquote>\n<p>最后，感谢<a href=\"https://www.hawu.me/\">https://www.hawu.me</a>  站长，提供的一些帮助。</p>\n</blockquote>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：前文\"><a href=\"#0：前文\" class=\"headerlink\" title=\"0：前文\"></a>0：前文</h1><p>在文章《<a href=\"https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/\">利用Stunnel+squid代理实现国内无客户端访问外网</a>》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。</p>\n<p>阅读本文，请确保你已经安装了squid 3.5以上版本。<code>squid -v</code>可以查看你的安装版本。</p>\n<h1 id=\"1：配置基本环境MySQL和Python\"><a href=\"#1：配置基本环境MySQL和Python\" class=\"headerlink\" title=\"1：配置基本环境MySQL和Python\"></a>1：配置基本环境MySQL和Python</h1><h2 id=\"1-1-数据库\"><a href=\"#1-1-数据库\" class=\"headerlink\" title=\"1.1 数据库\"></a>1.1 数据库</h2><p>Mysql被广泛用于网站数据库，网上的支持文档很多，重要的是，MySQL在python编程上具有非常好的支持。也就是mysqldb库。</p>\n<p>使用数据库，主要是用来存放通过验证器验证的客户端ip，ACL辅助器可以通过读取这个ip，从而acl辅助器通过的ip不再需要验证器验证密码。所以，你使用任何其他数据库都是可以的。建议你选用你自己熟悉的数据库。因为本文对于如何在mysql下，创建数据表，只做大概说明。</p>\n<p>我建议使用宝塔面板<a href=\"bt.cn\">bt.cn</a>安装mysql。这样可以可视化的安装mysql和创建数据库和数据表。也可以规避许多由于数据库权限问题导致的不可控因素。宝塔面板安装和在宝塔面板中安装mysql数据库，可以自行百度。非常简单。</p>\n<p>在完成数据库安装后，请你在mysql里添加一个，库名为：squid。用户名为：squid。的数据库。用于存放squid数据。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg\"></p>\n<p>数据库新建成功后，点击右边的管理。进入phpmyadmin，新建一个数据表。表名为：sq_client_ip。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg\"></p>\n<p>表的结构：</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg\"></p>\n<p>注意，id项，新建表时，勾选<code>AI</code>，AI表示设置id为自增主键。这样每添加一个数据进去，id都会自行增加。</p>\n<h2 id=\"1-2-Python\"><a href=\"#1-2-Python\" class=\"headerlink\" title=\"1.2 Python\"></a>1.2 Python</h2><p>安装Python，简单的安装python，你只需要输入下面指令</p>\n<p>centos:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install python</span><br></pre></td></tr></table></figure>\n\n<p>Ubuntu:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get -y install python</span><br></pre></td></tr></table></figure>\n\n<p>安装完python，需要安装python的mysqldb库。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install mysqldb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2：自定义基本验证器\"><a href=\"#2：自定义基本验证器\" class=\"headerlink\" title=\"2：自定义基本验证器\"></a>2：自定义基本验证器</h1><p>新建一个python文件<code>AuthPro.py</code>。在里面添加如下内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\"># coding=UTF-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> MySQLdb</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">matchpasswd</span>(<span class=\"params\">login,passwd</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#用户名和密码，用于验证输入的用户名和密码。</span></span><br><span class=\"line\">    <span class=\"comment\">#你可以自定义验证通过的要求，验证通过，返回True，验证不通过返回False</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (login == <span class=\"string\">&#x27;修改为你的用户名&#x27;</span> <span class=\"keyword\">and</span> passwd == <span class=\"string\">&#x27;修改为你的验证密码&#x27;</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">write_client_ip_to_db</span>(<span class=\"params\">username,client_ip</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式</span></span><br><span class=\"line\">    db=MySQLdb.connect(<span class=\"string\">&quot;localhost&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,<span class=\"string\">&quot;修改为你的密码&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,charset=<span class=\"string\">&#x27;utf8&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 使用cursor()方法获取操作游标 </span></span><br><span class=\"line\">    cursor = db.cursor()</span><br><span class=\"line\">    <span class=\"comment\"># 向sq_client_ip表中插入用户名和用户ip</span></span><br><span class=\"line\">    sql = <span class=\"string\">&quot;INSERT INTO sq_client_ip(username, client_ip) VALUES (&#x27;%s&#x27;, &#x27;%s&#x27;)&quot;</span> % (username,client_ip)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">       <span class=\"comment\"># 执行sql语句</span></span><br><span class=\"line\">       cursor.execute(sql)</span><br><span class=\"line\">       <span class=\"comment\">#Ok 后面的print语句可以向cache日志中输出提示。/var/log/squid/cache.log查看</span></span><br><span class=\"line\">       print(<span class=\"string\">&quot;执行sql语句&quot;</span>)</span><br><span class=\"line\">       <span class=\"comment\"># 提交到数据库执行</span></span><br><span class=\"line\">       db.commit()</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">       <span class=\"comment\">#打印错误内容</span></span><br><span class=\"line\">       info = sys.exc_info()  </span><br><span class=\"line\">       print( info[<span class=\"number\">0</span>], <span class=\"string\">&quot;:&quot;</span>, info[<span class=\"number\">1</span>]) </span><br><span class=\"line\">\t   <span class=\"comment\">#发生错误时回滚</span></span><br><span class=\"line\">       db.rollback()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 关闭数据库连接</span></span><br><span class=\"line\">    db.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"comment\"># read a line from stdin</span></span><br><span class=\"line\">    line = sys.stdin.readline()</span><br><span class=\"line\">    line = line.strip()</span><br><span class=\"line\">    <span class=\"comment\">#提取输入参数。</span></span><br><span class=\"line\">    username,password,client_ip = line.split()</span><br><span class=\"line\">    <span class=\"comment\">#判断密码是否匹配</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> matchpasswd(username, password):</span><br><span class=\"line\">        <span class=\"comment\">#输出ok表示验证通过</span></span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;OK\\n 密码验证通过&#x27;</span>)</span><br><span class=\"line\">      \t<span class=\"comment\">#将客户端ip添加至数据库ip白名单</span></span><br><span class=\"line\">      \twrite_client_ip_to_db(username,client_ip)</span><br><span class=\"line\">      \t</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;ERR\\n 密码验证失败&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># Flush the output to stdout.</span></span><br><span class=\"line\">    sys.stdout.flush()</span><br></pre></td></tr></table></figure>\n\n<p>将<code>AuthPro.py</code>文件拷贝到squid的配置文件夹<code>/etc/squid</code>里</p>\n<h1 id=\"3：外部ACL辅助器\"><a href=\"#3：外部ACL辅助器\" class=\"headerlink\" title=\"3：外部ACL辅助器\"></a>3：外部ACL辅助器</h1><p>新建一个python文件<code>AclHelper.py</code>。在里面添加如下内容:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\"># coding=UTF-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> MySQLdb</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;当用户连接squid，传递用户客户端ip地址到外部辅助器，辅助器通过标准输入读取。辅助器查询数据库符合客户端ip的所有项，如果查询结果，显示客户ip在数据库中，则输出ok，否则输出ERR&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">matchclientip</span>(<span class=\"params\">client_ip</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式</span></span><br><span class=\"line\">    db=MySQLdb.connect(<span class=\"string\">&quot;localhost&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,<span class=\"string\">&quot;你的数据库密码&quot;</span>,<span class=\"string\">&quot;squid&quot;</span>,charset=<span class=\"string\">&#x27;utf8&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 使用cursor()方法获取操作游标 </span></span><br><span class=\"line\">    cursor = db.cursor()</span><br><span class=\"line\">    <span class=\"comment\"># SQL 插入语句</span></span><br><span class=\"line\">    sql = <span class=\"string\">&quot;SELECT * FROM sq_client_ip  WHERE client_ip = &#x27;%s&#x27;&quot;</span> % (client_ip)</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">       <span class=\"comment\"># 执行sql语句</span></span><br><span class=\"line\">       cursor.execute(sql)</span><br><span class=\"line\">       result = cursor.fetchone()</span><br><span class=\"line\">       <span class=\"keyword\">if</span> result:</span><br><span class=\"line\">          exist_ip = <span class=\"literal\">True</span></span><br><span class=\"line\">       <span class=\"keyword\">else</span>:</span><br><span class=\"line\">          exist_ip = <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">       <span class=\"comment\"># 发生错误时回滚</span></span><br><span class=\"line\">       db.rollback()</span><br><span class=\"line\">       exist_ip = <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 关闭数据库连接</span></span><br><span class=\"line\">    db.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> exist_ip</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 从标准输入读取一行，“client_ip”</span></span><br><span class=\"line\">    line = sys.stdin.readline()</span><br><span class=\"line\">    <span class=\"comment\">#提取输入参数。squid，输入给辅助器的字符串是&quot;0 xx.xx.xx.xx&quot;格式</span></span><br><span class=\"line\">    <span class=\"comment\">#利用split分割字符串，得到0和client_ip的list</span></span><br><span class=\"line\">    client_ip = line.strip().split()[<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"comment\">#判断密码是否匹配</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> matchclientip(client_ip):</span><br><span class=\"line\">        <span class=\"comment\">#输出ok表示验证通过</span></span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;OK\\n&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\">#print会将信息输出到/var/log/squid/cache.log中。</span></span><br><span class=\"line\">        print(<span class=\"string\">&quot;Acl辅助器验证成功&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        sys.stdout.write(<span class=\"string\">&#x27;ERR\\n&#x27;</span>)</span><br><span class=\"line\">        print(<span class=\"string\">&quot;ACL辅助器验证失败&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># Flush the output to stdout.</span></span><br><span class=\"line\">    sys.stdout.flush()</span><br></pre></td></tr></table></figure>\n\n<p>将<code>AclHelper.py</code>文件拷贝到squid的配置文件夹<code>/etc/squid</code>里</p>\n<h1 id=\"4：修改squid配置文件\"><a href=\"#4：修改squid配置文件\" class=\"headerlink\" title=\"4：修改squid配置文件\"></a>4：修改squid配置文件</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> http_port 设置监听端口，默认为3128</span></span><br><span class=\"line\">http_port 6666</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">父squid配置，配合国外服务器server2使用</span></span><br><span class=\"line\">nonhierarchical_direct off</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">转发请求通过stunnel至父squid</span></span><br><span class=\"line\">cache_peer localhost parent 3128 0 default</span><br><span class=\"line\">never_direct allow all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class=\"built_in\">log</span>/squid/access.log文件, </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class=\"line\">access_log daemon:/var/log/squid/access.log combined</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80\t\t# http</span><br><span class=\"line\">acl Safe_ports port 21\t\t# ftp</span><br><span class=\"line\">acl Safe_ports port 443\t\t# https</span><br><span class=\"line\">acl Safe_ports port 70\t\t# gopher</span><br><span class=\"line\">acl Safe_ports port 210\t\t# wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280\t\t# http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488\t\t# gss-http</span><br><span class=\"line\">acl Safe_ports port 591\t\t# filemaker</span><br><span class=\"line\">acl Safe_ports port 777\t\t# multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非Safe_ports的请求</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Only allow cachemgr access from localhost</span></span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">http_access deny manager</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许来自本地的请求</span></span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">#####################################</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">定义一个外部ACL辅助器</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">使用python解释器，negativettl表示验证错误时的缓存时间单位秒，concurrency表示最多接收的认证通过用户，ipv4必须，如果没有ipv4会报错。</span></span><br><span class=\"line\">external_acl_type MyAclHelper negative_ttl=1 concurrency=30 ipv4 %SRC /usr/bin/python /etc/squid/AclHelper.py</span><br><span class=\"line\">acl MyAcl external MyAclHelper</span><br><span class=\"line\">http_access allow MyAcl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">定义一个验证器</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">指定python运行目录，和python程序的目录</span></span><br><span class=\"line\">auth_param basic program /usr/bin/python /etc/squid/AuthPro.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">向python程序中输入key_extras变量客户端ip<span class=\"string\">&quot;%&gt;a&quot;</span></span></span><br><span class=\"line\">auth_param basic key_extras &quot;%&gt;a&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">允许多少个子程序</span></span><br><span class=\"line\">auth_param basic children 30</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">输入框提示信息</span></span><br><span class=\"line\">auth_param basic realm 输入用户名和密码</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">验证信息的缓存时长</span></span><br><span class=\"line\">auth_param basic credentialsttl 1 second</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">用户名和密码是否区分大小写</span></span><br><span class=\"line\">auth_param basic casesensitive on</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">强制用户验证</span></span><br><span class=\"line\">acl authenticated proxy_auth REQUIRED</span><br><span class=\"line\">http_access allow authenticated</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">###############################################</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有请求，最后兜底的规则</span></span><br><span class=\"line\">http_access deny all</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>特别需要注意的是：</p>\n<ol>\n<li><p>必须辅助器配置在前，而验证器配置在后。由于squid特殊的处理机制，当squid从配置文件指定的http_access中找到了符合的条件的allow或deny信息，则后续的判断将不会再生效，也就是说，只有在用户无法通过辅助器验证时，才会进行验证器验证。</p>\n</li>\n<li><p>辅助器必须设置negative_ttl项，而且设置的不通过验证时间不易过长，最好在几秒内。原因是，当用户连接squid后，首先通过辅助器查找数据库是否有此ip，如果没有辅助器会缓存此ip信息，并将其标记为未通过验证，再进入验证器。而通常，我们首先于squid连接上网的并不是浏览器，可能收微博软件等，这些软件由于无法弹出验证窗口，而导致验证器验证失败。此后即便你打开浏览器，而由于上一次的验证失败而缓存了失败信息，致使，squid不会再进行辅助器和验证器验证，而直接拒绝访问。因此设置验证失败缓存时间短点，可以保证我们打开浏览器时，还能进入辅助器验证和验证器验证。</p>\n</li>\n<li><p>验证器必须设置credentialsttl项，且设置时间不易过长，最好在几秒内。之所以验证器验证成功的缓存不能太长，是因为当我们首次通过验证器验证后，squid缓存成功验证的用户信息，下次用户则无需再次经过验证器密码验证，直接读取用户名和ip。但是由于squid缓存的是用户的ip和用户名，如果你使用了微博等没有验证框的软件，由于没有向squid发送用户名，会导致无法联网。</p>\n<p>所以，我们利用验证器，只是为了保存成功验证的用户ip，然后通过辅助器来验证用户。所以，通过后则清除验证器的缓存。</p>\n<p>用户再次上网，便会首先经过辅助器，此时辅助器已经能从数据库读取到刚才验证器保存的客户ip。辅助器，可以设置比较久的成功ttl时长，如果没有设置，默认是一个小时。</p>\n</li>\n</ol>\n</blockquote>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"http://blog.zyan.cc/book/squid/\">squid中文权威指南</a>》</p>\n<p>《<a href=\"http://www.site-digger.com/html/articles/20161012/132.html\">用Python脚本打造Squid权限认证后端程序以及Squid3.5 auth_param key_extras新特性介绍</a>》</p>\n<p>《<a href=\"https://www.hawu.me/operation/852\">使用squid搭建代理服务器</a>》</p>\n<p>《<a href=\"https://wiki.squid-cache.org/Features/AddonHelpers\">Feature: Add-On Helpers for Request Manipulation</a>》</p>\n<p>《<a href=\"https://stackoverflow.com/questions/26601943/how-to-configure-squid-to-pass-client-ip-to-authenticate-program?rq=1\">stackoverflow上关于自定义验证器输入客户端IP的回答</a>》</p>\n<blockquote>\n<p>最后，感谢<a href=\"https://www.hawu.me/\">https://www.hawu.me</a>  站长，提供的一些帮助。</p>\n</blockquote>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg","popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:48:28 GMT+0200 (GMT+02:00)","title":"Squid+MySQL储存用户验证通过的IP","path":"2020/06/02/Squid-MySQL储存用户验证通过的IP/","eyeCatchImage":"https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-02T10:02:54.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-02T10:02:54.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"其他","tags":["Squid","Mysql"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Volantis主题ReadMore自动截取文章内容","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-18T13:56:09.000Z","password":null,"summary":"Volantis自带的Readmore需要在文章内容里添加一个<!-- more -->标签或者在md文件的description里写内容。才能在主页显示摘要。如果不添加more标签或者描述，就会显示全文。本文介绍如何添加自动截取摘要的办法。","_content":"\n## 1：在主题配置文件里添加键值对\n\n添加键值对的目的是，控制截取长度和自动截取功能是否开启。在你的博客目录`\\themes\\volantis\\_config.yml`下添加\n\n```yaml\n# Excerpt \n## Auto creat excerpt with not <!--more-->\n## Enable will truncate auto_excerpt.lines rows in post head to replace excerpt.\nauto_excerpt:\n    enable: true\n    lines: 5\n```\n\n## 2：修改文章代码\n\n修改`\\themes\\volantis\\layout\\_partial`文件内容为：\n\n```ejs\n<article class=\"post white-box <%- theme.style.body.effect.join(' ') %> reveal <%= (post.title) ? \"\" : \"no-title\" %>\">\n  <%- partial('meta',{post:post, position:'header'}) %>\n  <section class=\"article typo\">\n    <div class=\"article-entry\" itemprop=\"articleBody\">\n      <% var show_all_content = true %>\n      <% if (post.excerpt) { %>\n        <% show_all_content = false %>\n        <%- post.excerpt %>\n      <% }  else if (post.summary) { %>\n        <% show_all_content = false %>\n        <p><%- post.summary %></p>\n      <% } else if (theme.auto_excerpt.enable) { %>\n        <% var br_position = 0 %>\n        <% for (var br_count = 0; br_count < theme.auto_excerpt.lines; br_count++) { %>\n            <% br_position = post.content.indexOf('\\n',br_position + 1) %>\n            <% if(br_position < 0) { break } %>\n        <% } %>\n        <% if(br_position > 0) { %>\n            <% show_all_content = false %>\n            <p><%- post.content.substring(0, br_position + 1) %><p>\n        <% } %>\n      <% } %>\n      <% if (show_all_content) { %>\n        <%- post.content %>\n        <% } %>\n    </div>\n    <% if (theme.layout.on_list.readmore) { %>\n      <% if ((post.readmore != false) && (show_all_content != true)) { %>\n        <div class=\"button readmore\">\n          <a href=\"<%- url_for(post.link || post.path) %>\">\n            <%- theme.layout.on_list.readmore %>\n          </a>\n        </div>\n      <% } %>\n    <% } %>\n  </section>\n</article>\n\n```\n\n> 上面的代码逻辑，是，如果有more标签，则使用more标签前的文字作为摘要，非则使用md文章scaffolds里的summary内容作为摘要，主题原来用的scaffolds是description。如果需要用description，可以自行替换上面的代码。\n>\n> 在`scaffolds\\post.md`里可以修改新建md文件生成的scaffold。\n\n> 重要！！这种方法是直接提取的文章前5行。如果提取到的内容里，包含代码块的一部分，那么由于渲染问题布局将会出现问题。建议如果你的文章前面里有代码，自行在summary里写摘要，或者more标签前写摘要。\n\n## 3：参考文献\n\n《[Hexo 自动给博文添加 ReadMore](https://blog.zthxxx.me/post/hexo-automatic-add-readmore/)》\n\n","source":"_posts/Valantis-ReadMore自动截取文章内容.md","raw":"---\ntitle: Volantis主题ReadMore自动截取文章内容\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-18 15:56:09\npassword:\nsummary: Volantis自带的Readmore需要在文章内容里添加一个<!-- more -->标签或者在md文件的description里写内容。才能在主页显示摘要。如果不添加more标签或者描述，就会显示全文。本文介绍如何添加自动截取摘要的办法。\ntags: Volantis\ncategories: 网站编程\n---\n\n## 1：在主题配置文件里添加键值对\n\n添加键值对的目的是，控制截取长度和自动截取功能是否开启。在你的博客目录`\\themes\\volantis\\_config.yml`下添加\n\n```yaml\n# Excerpt \n## Auto creat excerpt with not <!--more-->\n## Enable will truncate auto_excerpt.lines rows in post head to replace excerpt.\nauto_excerpt:\n    enable: true\n    lines: 5\n```\n\n## 2：修改文章代码\n\n修改`\\themes\\volantis\\layout\\_partial`文件内容为：\n\n```ejs\n<article class=\"post white-box <%- theme.style.body.effect.join(' ') %> reveal <%= (post.title) ? \"\" : \"no-title\" %>\">\n  <%- partial('meta',{post:post, position:'header'}) %>\n  <section class=\"article typo\">\n    <div class=\"article-entry\" itemprop=\"articleBody\">\n      <% var show_all_content = true %>\n      <% if (post.excerpt) { %>\n        <% show_all_content = false %>\n        <%- post.excerpt %>\n      <% }  else if (post.summary) { %>\n        <% show_all_content = false %>\n        <p><%- post.summary %></p>\n      <% } else if (theme.auto_excerpt.enable) { %>\n        <% var br_position = 0 %>\n        <% for (var br_count = 0; br_count < theme.auto_excerpt.lines; br_count++) { %>\n            <% br_position = post.content.indexOf('\\n',br_position + 1) %>\n            <% if(br_position < 0) { break } %>\n        <% } %>\n        <% if(br_position > 0) { %>\n            <% show_all_content = false %>\n            <p><%- post.content.substring(0, br_position + 1) %><p>\n        <% } %>\n      <% } %>\n      <% if (show_all_content) { %>\n        <%- post.content %>\n        <% } %>\n    </div>\n    <% if (theme.layout.on_list.readmore) { %>\n      <% if ((post.readmore != false) && (show_all_content != true)) { %>\n        <div class=\"button readmore\">\n          <a href=\"<%- url_for(post.link || post.path) %>\">\n            <%- theme.layout.on_list.readmore %>\n          </a>\n        </div>\n      <% } %>\n    <% } %>\n  </section>\n</article>\n\n```\n\n> 上面的代码逻辑，是，如果有more标签，则使用more标签前的文字作为摘要，非则使用md文章scaffolds里的summary内容作为摘要，主题原来用的scaffolds是description。如果需要用description，可以自行替换上面的代码。\n>\n> 在`scaffolds\\post.md`里可以修改新建md文件生成的scaffold。\n\n> 重要！！这种方法是直接提取的文章前5行。如果提取到的内容里，包含代码块的一部分，那么由于渲染问题布局将会出现问题。建议如果你的文章前面里有代码，自行在summary里写摘要，或者more标签前写摘要。\n\n## 3：参考文献\n\n《[Hexo 自动给博文添加 ReadMore](https://blog.zthxxx.me/post/hexo-automatic-add-readmore/)》\n\n","slug":"Valantis-ReadMore自动截取文章内容","published":1,"updated":"2020-06-18T08:12:19.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabj001jp0vzgdytcwtc","content":"<h2 id=\"1：在主题配置文件里添加键值对\"><a href=\"#1：在主题配置文件里添加键值对\" class=\"headerlink\" title=\"1：在主题配置文件里添加键值对\"></a>1：在主题配置文件里添加键值对</h2><p>添加键值对的目的是，控制截取长度和自动截取功能是否开启。在你的博客目录<code>\\themes\\volantis\\_config.yml</code>下添加</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Excerpt </span></span><br><span class=\"line\"><span class=\"comment\">## Auto creat excerpt with not &lt;!--more--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">## Enable will truncate auto_excerpt.lines rows in post head to replace excerpt.</span></span><br><span class=\"line\"><span class=\"attr\">auto_excerpt:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">lines:</span> <span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2：修改文章代码\"><a href=\"#2：修改文章代码\" class=\"headerlink\" title=\"2：修改文章代码\"></a>2：修改文章代码</h2><p>修改<code>\\themes\\volantis\\layout\\_partial</code>文件内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;article class&#x3D;&quot;post white-box &lt;%- theme.style.body.effect.join(&#39; &#39;) %&gt; reveal &lt;%&#x3D; (post.title) ? &quot;&quot; : &quot;no-title&quot; %&gt;&quot;&gt;</span><br><span class=\"line\">  &lt;%- partial(&#39;meta&#39;,&#123;post:post, position:&#39;header&#39;&#125;) %&gt;</span><br><span class=\"line\">  &lt;section class&#x3D;&quot;article typo&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;article-entry&quot; itemprop&#x3D;&quot;articleBody&quot;&gt;</span><br><span class=\"line\">      &lt;% var show_all_content &#x3D; true %&gt;</span><br><span class=\"line\">      &lt;% if (post.excerpt) &#123; %&gt;</span><br><span class=\"line\">        &lt;% show_all_content &#x3D; false %&gt;</span><br><span class=\"line\">        &lt;%- post.excerpt %&gt;</span><br><span class=\"line\">      &lt;% &#125;  else if (post.summary) &#123; %&gt;</span><br><span class=\"line\">        &lt;% show_all_content &#x3D; false %&gt;</span><br><span class=\"line\">        &lt;p&gt;&lt;%- post.summary %&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">      &lt;% &#125; else if (theme.auto_excerpt.enable) &#123; %&gt;</span><br><span class=\"line\">        &lt;% var br_position &#x3D; 0 %&gt;</span><br><span class=\"line\">        &lt;% for (var br_count &#x3D; 0; br_count &lt; theme.auto_excerpt.lines; br_count++) &#123; %&gt;</span><br><span class=\"line\">            &lt;% br_position &#x3D; post.content.indexOf(&#39;\\n&#39;,br_position + 1) %&gt;</span><br><span class=\"line\">            &lt;% if(br_position &lt; 0) &#123; break &#125; %&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">        &lt;% if(br_position &gt; 0) &#123; %&gt;</span><br><span class=\"line\">            &lt;% show_all_content &#x3D; false %&gt;</span><br><span class=\"line\">            &lt;p&gt;&lt;%- post.content.substring(0, br_position + 1) %&gt;&lt;p&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">      &lt;% if (show_all_content) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- post.content %&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;% if (theme.layout.on_list.readmore) &#123; %&gt;</span><br><span class=\"line\">      &lt;% if ((post.readmore !&#x3D; false) &amp;&amp; (show_all_content !&#x3D; true)) &#123; %&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;button readmore&quot;&gt;</span><br><span class=\"line\">          &lt;a href&#x3D;&quot;&lt;%- url_for(post.link || post.path) %&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;%- theme.layout.on_list.readmore %&gt;</span><br><span class=\"line\">          &lt;&#x2F;a&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">    &lt;% &#125; %&gt;</span><br><span class=\"line\">  &lt;&#x2F;section&gt;</span><br><span class=\"line\">&lt;&#x2F;article&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>上面的代码逻辑，是，如果有more标签，则使用more标签前的文字作为摘要，非则使用md文章scaffolds里的summary内容作为摘要，主题原来用的scaffolds是description。如果需要用description，可以自行替换上面的代码。</p>\n<p>在<code>scaffolds\\post.md</code>里可以修改新建md文件生成的scaffold。</p>\n</blockquote>\n<blockquote>\n<p>重要！！这种方法是直接提取的文章前5行。如果提取到的内容里，包含代码块的一部分，那么由于渲染问题布局将会出现问题。建议如果你的文章前面里有代码，自行在summary里写摘要，或者more标签前写摘要。</p>\n</blockquote>\n<h2 id=\"3：参考文献\"><a href=\"#3：参考文献\" class=\"headerlink\" title=\"3：参考文献\"></a>3：参考文献</h2><p>《<a href=\"https://blog.zthxxx.me/post/hexo-automatic-add-readmore/\">Hexo 自动给博文添加 ReadMore</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h2 id=\"1：在主题配置文件里添加键值对\"><a href=\"#1：在主题配置文件里添加键值对\" class=\"headerlink\" title=\"1：在主题配置文件里添加键值对\"></a>1：在主题配置文件里添加键值对</h2><p>添加键值对的目的是，控制截取长度和自动截取功能是否开启。在你的博客目录<code>\\themes\\volantis\\_config.yml</code>下添加</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Excerpt </span></span><br><span class=\"line\"><span class=\"comment\">## Auto creat excerpt with not &lt;!--more--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">## Enable will truncate auto_excerpt.lines rows in post head to replace excerpt.</span></span><br><span class=\"line\"><span class=\"attr\">auto_excerpt:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">lines:</span> <span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2：修改文章代码\"><a href=\"#2：修改文章代码\" class=\"headerlink\" title=\"2：修改文章代码\"></a>2：修改文章代码</h2><p>修改<code>\\themes\\volantis\\layout\\_partial</code>文件内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;article class&#x3D;&quot;post white-box &lt;%- theme.style.body.effect.join(&#39; &#39;) %&gt; reveal &lt;%&#x3D; (post.title) ? &quot;&quot; : &quot;no-title&quot; %&gt;&quot;&gt;</span><br><span class=\"line\">  &lt;%- partial(&#39;meta&#39;,&#123;post:post, position:&#39;header&#39;&#125;) %&gt;</span><br><span class=\"line\">  &lt;section class&#x3D;&quot;article typo&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;article-entry&quot; itemprop&#x3D;&quot;articleBody&quot;&gt;</span><br><span class=\"line\">      &lt;% var show_all_content &#x3D; true %&gt;</span><br><span class=\"line\">      &lt;% if (post.excerpt) &#123; %&gt;</span><br><span class=\"line\">        &lt;% show_all_content &#x3D; false %&gt;</span><br><span class=\"line\">        &lt;%- post.excerpt %&gt;</span><br><span class=\"line\">      &lt;% &#125;  else if (post.summary) &#123; %&gt;</span><br><span class=\"line\">        &lt;% show_all_content &#x3D; false %&gt;</span><br><span class=\"line\">        &lt;p&gt;&lt;%- post.summary %&gt;&lt;&#x2F;p&gt;</span><br><span class=\"line\">      &lt;% &#125; else if (theme.auto_excerpt.enable) &#123; %&gt;</span><br><span class=\"line\">        &lt;% var br_position &#x3D; 0 %&gt;</span><br><span class=\"line\">        &lt;% for (var br_count &#x3D; 0; br_count &lt; theme.auto_excerpt.lines; br_count++) &#123; %&gt;</span><br><span class=\"line\">            &lt;% br_position &#x3D; post.content.indexOf(&#39;\\n&#39;,br_position + 1) %&gt;</span><br><span class=\"line\">            &lt;% if(br_position &lt; 0) &#123; break &#125; %&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">        &lt;% if(br_position &gt; 0) &#123; %&gt;</span><br><span class=\"line\">            &lt;% show_all_content &#x3D; false %&gt;</span><br><span class=\"line\">            &lt;p&gt;&lt;%- post.content.substring(0, br_position + 1) %&gt;&lt;p&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">      &lt;% if (show_all_content) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- post.content %&gt;</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;% if (theme.layout.on_list.readmore) &#123; %&gt;</span><br><span class=\"line\">      &lt;% if ((post.readmore !&#x3D; false) &amp;&amp; (show_all_content !&#x3D; true)) &#123; %&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;button readmore&quot;&gt;</span><br><span class=\"line\">          &lt;a href&#x3D;&quot;&lt;%- url_for(post.link || post.path) %&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;%- theme.layout.on_list.readmore %&gt;</span><br><span class=\"line\">          &lt;&#x2F;a&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">    &lt;% &#125; %&gt;</span><br><span class=\"line\">  &lt;&#x2F;section&gt;</span><br><span class=\"line\">&lt;&#x2F;article&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>上面的代码逻辑，是，如果有more标签，则使用more标签前的文字作为摘要，非则使用md文章scaffolds里的summary内容作为摘要，主题原来用的scaffolds是description。如果需要用description，可以自行替换上面的代码。</p>\n<p>在<code>scaffolds\\post.md</code>里可以修改新建md文件生成的scaffold。</p>\n</blockquote>\n<blockquote>\n<p>重要！！这种方法是直接提取的文章前5行。如果提取到的内容里，包含代码块的一部分，那么由于渲染问题布局将会出现问题。建议如果你的文章前面里有代码，自行在summary里写摘要，或者more标签前写摘要。</p>\n</blockquote>\n<h2 id=\"3：参考文献\"><a href=\"#3：参考文献\" class=\"headerlink\" title=\"3：参考文献\"></a>3：参考文献</h2><p>《<a href=\"https://blog.zthxxx.me/post/hexo-automatic-add-readmore/\">Hexo 自动给博文添加 ReadMore</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Thu Jun 18 2020 10:12:19 GMT+0200 (GMT+02:00)","title":"Volantis主题ReadMore自动截取文章内容","path":"2020/06/18/Valantis-ReadMore自动截取文章内容/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-18T13:56:09.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-18T13:56:09.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["Volantis"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"TensorFlow学习笔记","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-06-17T18:35:46.000Z","password":null,"summary":"TensorFlow是一个开源软件库，用于各种感知和语言理解任务的机器学习。目前被50个团队用于研究和生产许多Google商业产品，如语音识别、Gmail、Google 相册和搜索，其中许多产品曾使用过其前任软件DistBelief。","_content":"\n## P1：tensorflow安装\n\n```shell\npip install tensorflow\n```\n\n## P2：Hello World——衣服分类\n\n这个例子训练了一个神经网络模型，用于分类衣服图片，比如tshirt和运动鞋。\n\n需要用到`tf.keras`，它是个用于建立和训练模型的高层次的API\n\n```python\n# TensorFlow and tf.keras\nimport tensorflow as tffrom tensorflow \nimport keras\n# Helper libraries\nimport numpy as np\nimport matplotlib.pyplot as plt\nprint(tf.__version__)\n```\n\n> 2.2.0\n\n**导入Fashion MNIST数据集**\n\n```python\nfashion_mnist = keras.datasets.fashion_mnist\n(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()\n```\n\n导入数据集，返回Numpy数组：\n\n-  `train_images`和`train_labels` 数组是训练集。\n\n- `test_images`和 `test_labels` 数组是测试集。\n\n这些图像是28x28的Numpy数组。可以理解为28x28的像素点，这些像素点在屏幕上显示出来表现为图像。每个像素点的值在0到255之间，表示颜色的深浅。如果你了解颜色的RGB值，那你就明白，所有的颜色都是由不同深浅程度的三种基本色构成，比如白色的RGB为(255.255.255)。标签`labels`是一个整数数组，范围从0到9。表示10个不同的衣服种类`Class`。\n\n| Label | Class       |\n| :---- | :---------- |\n| 0     | T-shirt/top |\n| 1     | Trouser     |\n| 2     | Pullover    |\n| 3     | Dress       |\n| 4     | Coat        |\n| 5     | Sandal      |\n| 6     | Shirt       |\n| 7     | Sneaker     |\n| 8     | Bag         |\n| 9     | Ankle boot  |\n\n这些种类不包括在数据集中，需要单独定义：\n\n```python\nclass_names = ['T-shirt/top', 'Trouser', 'Pullover', 'Dress', 'Coat', 'Sandal', 'Shirt', 'Sneaker', 'Bag', 'Ankle boot']\n```\n\n**研究数据**\n\n在训练模型之前，先研究这些数据格式。比如在训练集中的六万张图片，每张图片由28x28的像素点表示。\n\n```python\ntrain_images.shape\n```\n\n> (60000, 28, 28)\n\n同时还有六万个与之对应的标签：\n\n```python\nlen(train_labels)\n```\n\n> 60000\n\n每个标签都是一个0到9之间的整数：\n\n```python\ntrain_labels\n```\n\n> array([9, 0, 0, ..., 3, 0, 5], dtype=uint8)\n\n还有一万张用于测试的图片：\n\n```python\ntest_images.shape\n```\n\n> (10000, 28, 28)\n\n一万张训练集的标签：\n\n```python\nlen(test_labels)\n```\n\n> 10000\n\n**数据预处理**\n\n在训练模型之前，必须先对数据进行预处理。观察第一张图，我们可以看到图片的像素值在0到255之间。\n\n```python\nplt.figure()\nplt.imshow(train_images[0])\nplt.colorbar()\nplt.grid(False)\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn)\n\n将像素值范围缩小为0到1，所以将像素值都除以255：\n\n```python\ntrain_images = train_images / 255.0\ntest_images = test_images / 255.0\n```\n\n为了确保数据的正确性，先将训练集的前25个图片显示出来，并且在图片下面展示分类名。\n\n```python\nplt.figure(figsize=(10,10))\nfor i in range(25):\n    plt.subplot(5,5,i+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.grid(False)\n    plt.imshow(train_images[i], cmap=plt.cm.binary)\n    plt.xlabel(class_names[train_labels[i]])\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn)\n\n**建立模型**\n\n建立神经网络需要配置模型层，然后编译模型。\n\n**设置层**\n\n基本的神经网络模块是层。层会从它们获取的数据里提取图像。它们希望从这些图像里获取有用的信息。\n\n大多数深度学习都是简单层组合在一起。大多数层比如[`tf.keras.layers.Dense`](https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dense?hl=zh_cn)，拥有在训练时学习到的参数。\n\n```python\nmodel = keras.Sequential([    keras.layers.Flatten(input_shape=(28, 28)),    keras.layers.Dense(128, activation='relu'),    keras.layers.Dense(10)])\n```\n\n这个网络的第一层，tf.keras.layers.Flatten，将图像的格式从二维数组(28 * 28像素)转换为一维数组(28 * 28 = 784像素)。可以将这一层看作是将图像中的像素行展开并排列起来。这一层没有参数需要学习;它只是重新格式化数据。\n\n像素被扁平化后，网络由两个tf.keras.层组成。它们是紧密相连或完全相连的神经层。第一致密层有128个节点(或神经元)。第二个(也是最后一个)层返回长度为10的logits数组。每个节点都包含一个评价值，表示当前图像属于这10个类中的一个。\n\n**编译模型**\n\n在准备训练模型之前，需要进行一些其他设置。 这些是在模型的编译步骤中添加的：\n\n- Loss function——这可以衡量模型在培训期间的准确性。您希望最小化这个函数，以便将模型“引导”到正确的方向。\n- Optimizer——这就是模型如何根据它看到的数据和它的损失函数进行更新。\n- Metrics——用于监控培训和测试步骤。下面的例子使用了准确率，即正确分类的图像的比例。\n\n```python\nmodel.compile(optimizer='adam',              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),              metrics=['accuracy'])\n```\n\n**训练模型**\n\n训练神经网络模型需要以下步骤：\n\n1. 输入训练数据到模型中。\n2. 模型学习关联图像和分类标签。\n3. 让模型预测测试集。\n4. 验证预测结果是否和标签匹配。\n\n**输入数据到模型中**\n\n利用`model.fit`方法。他能将模型用于拟合训练数据。\n\n```python\nmodel.fit(train_images, train_labels, epochs=10)\n```\n\n> Epoch 1/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.4978 - accuracy: 0.8248\n> Epoch 2/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.3767 - accuracy: 0.8637\n> Epoch 3/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.3397 - accuracy: 0.8759\n> Epoch 4/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.3138 - accuracy: 0.8854\n> Epoch 5/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2948 - accuracy: 0.8914\n> Epoch 6/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2803 - accuracy: 0.8958\n> Epoch 7/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2678 - accuracy: 0.9006\n> Epoch 8/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2590 - accuracy: 0.9043\n> Epoch 9/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2464 - accuracy: 0.9078\n> Epoch 10/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2402 - accuracy: 0.9099\n>\n> <tensorflow.python.keras.callbacks.History at 0x7fe472eff4a8>\n\n**评估准确率**\n\n比较模型在测试数据集上的表现：\n\n```python\ntest_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=2)\nprint('\\nTest accuracy:', test_acc)\n```\n\n> 313/313 - 1s - loss: 0.3382 - accuracy: 0.8840 \n>\n> Test accuracy: 0.8840000033378601\n\n结果是测试数据集上的准确性比训练数据集上的准确性稍低。训练准确度和测试准确度之间的差距代表过拟合。当机器学习模型在新的、以前没有看到的输入上的表现不如在训练数据上的表现时，就会发生过拟合。过度拟合的模型“记忆”了训练数据集中的噪音和细节，从而对模型在新数据上的性能产生负面影响。有关更多信息，请参见以下内容\n\n- [证明过度拟合](https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#demonstrate_overfitting)\n- [防止过度拟合策略](https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#strategies_to_prevent_overfitting)\n\n**预测结果**\n\n通过训练模型，你可以使用它来预测某些图像。 模型的线性输出，logits。 附加一个softmax层以将logit转换为更容易解释的概率。\n\n```python\nprobability_model = tf.keras.Sequential([model,                                          tf.keras.layers.Softmax()])\n```\n\n```python\npredictions = probability_model.predict(test_images)\n```\n\n在这里，模型已经预测了测试集中每个图像的标签。 让我们看一下第一个预测：\n\n```python\npredictions[0]\n```\n\n> array([1.2275562e-07, 8.9534730e-08, 7.6224147e-09, 1.9726743e-08,\n>        6.1515345e-07, 4.6329503e-03, 4.1164008e-06, 1.5043605e-02,\n>        2.8817641e-07, 9.8031825e-01], dtype=float32)\n\n预测是一个包含10个数字的数组。它们代表了模型的“自信”，即图像对应着10种不同的服装。你可以看到哪个标签的自信度最高：\n\n```python\nnp.argmax(predictions[0])\n```\n\n> 9\n\n因此，模型最自信的认为这是一个踝靴，或`class_names[9]`。检查测试标签表明这个分类是正确的：\n\n```python\ntest_labels[0]\n```\n\n> 9\n\n绘制图表，看看10个类预测的全部集合。\n\n```python\ndef plot_image(i, predictions_array, true_label, img):\n  predictions_array, true_label, img = predictions_array, true_label[i], img[i]\n  plt.grid(False)\n  plt.xticks([])\n  plt.yticks([])\n\n  plt.imshow(img, cmap=plt.cm.binary)\n\n  predicted_label = np.argmax(predictions_array)\n  if predicted_label == true_label:\n    color = 'blue'\n  else:\n    color = 'red'\n\n  plt.xlabel(\"{} {:2.0f}% ({})\".format(class_names[predicted_label],\n                                100*np.max(predictions_array),\n                                class_names[true_label]),\n                                color=color)\n\ndef plot_value_array(i, predictions_array, true_label):\n  predictions_array, true_label = predictions_array, true_label[i]\n  plt.grid(False)\n  plt.xticks(range(10))\n  plt.yticks([])\n  thisplot = plt.bar(range(10), predictions_array, color=\"#777777\")\n  plt.ylim([0, 1])\n  predicted_label = np.argmax(predictions_array)\n\n  thisplot[predicted_label].set_color('red')\n  thisplot[true_label].set_color('blue')\n```\n\n**验证预测**\n\n通过训练模型，您可以使用它来预测某些图像。\n\n让我们看一下第0张图片，预测和预测数组。 正确的预测标签为蓝色，错误的预测标签为红色。 该数字给出了预测标签的百分比（满分为100）。\n\n```python\ni = 0\nplt.figure(figsize=(6,3))\nplt.subplot(1,2,1)\nplot_image(i, predictions[i], test_labels, test_images)\nplt.subplot(1,2,2)\nplot_value_array(i, predictions[i],  test_labels)\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn)\n\n```python\ni = 12\nplt.figure(figsize=(6,3))\nplt.subplot(1,2,1)\nplot_image(i, predictions[i], test_labels, test_images)\nplt.subplot(1,2,2)\nplot_value_array(i, predictions[i],  test_labels)\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn)\n\n让我们绘制一些带有预测的图像。 请注意，即使非常自信，该模型也可能是错误的。\n\n```python\n# Plot the first X test images, their predicted labels, and the true labels.\n# Color correct predictions in blue and incorrect predictions in red.\nnum_rows = 5\nnum_cols = 3\nnum_images = num_rows*num_cols\nplt.figure(figsize=(2*2*num_cols, 2*num_rows))\nfor i in range(num_images):\n  plt.subplot(num_rows, 2*num_cols, 2*i+1)\n  plot_image(i, predictions[i], test_labels, test_images)\n  plt.subplot(num_rows, 2*num_cols, 2*i+2)\n  plot_value_array(i, predictions[i], test_labels)\nplt.tight_layout()\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn)\n\n**使用训练的模型**\n\n最后，利用训练好的模型对单幅图像进行预测。\n\n```python\n# Grab an image from the test dataset.\nimg = test_images[1]\nprint(img.shape)\n```\n\n> (28, 28)\n\n`tf.keras`模型经过优化，可以立即对一批或一组示例进行预测。因此，即使使用的是单个图像，也需要将其添加到列表中\n\n```python\n# Add the image to a batch where it's the only member.\nimg = (np.expand_dims(img,0))\nprint(img.shape)\n```\n\n> (1, 28, 28)\n\n现在为这个图像预测正确的标签\n\n```python\npredictions_single = probability_model.predict(img)\n\nprint(predictions_single)\n```\n\n> [[2.3256284e-06 5.5768194e-13 9.9955302e-01 3.3701731e-13 4.3444714e-04\n>   3.7890427e-17 1.0105057e-05 4.5671220e-20 8.4883814e-14 9.5599025e-18]]\n\n```python\nplot_value_array(1, predictions_single[0], test_labels)_ = plt.xticks(range(10), class_names, rotation=45)\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn)\n\nkeras.Model.predict返回列表的列表-数据批次中每个图像的列表。 批量获取我们（唯一）图像的预测：\n\n```python\nnp.argmax(predictions_single[0])\n```\n\n> 2\n\n这个模型预测了一个标签。\n\n本指南使用Fashion MNIST数据集，该数据集包含10个类别中的70,000张灰度图像。这些图像以低分辨率(28×28像素)显示了衣服的单个物品，如图所示\n\n![](https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn)\n\nFashion MNIST旨在替代经典MNIST数据集，通常被用作计算机视觉机器学习程序的“ Hello，World”。 MNIST数据集包含手写数字（0、1、2等）的图像，格式与您将在此处使用的衣服的格式相同。\n\n本指南将Fashion MNIST用于多种用途，并且因为它比常规MNIST更具挑战性。 两个数据集都相对较小，用于验证算法是否按预期工作。 它们是测试和调试代码的良好起点。\n\n在这里，使用60,000张图像来训练网络，使用10,000张图像来评估网络学习对图像进行分类的准确程度。 您可以直接从TensorFlow访问Fashion MNIST。 直接从TensorFlow导入和加载Fashion MNIST数据：","source":"_posts/TensorFlow学习笔记.md","raw":"---\ntitle: TensorFlow学习笔记\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-06-17 20:35:46\npassword:\nsummary: TensorFlow是一个开源软件库，用于各种感知和语言理解任务的机器学习。目前被50个团队用于研究和生产许多Google商业产品，如语音识别、Gmail、Google 相册和搜索，其中许多产品曾使用过其前任软件DistBelief。\ntags: TensorFlow\ncategories: 学习笔记\n---\n\n## P1：tensorflow安装\n\n```shell\npip install tensorflow\n```\n\n## P2：Hello World——衣服分类\n\n这个例子训练了一个神经网络模型，用于分类衣服图片，比如tshirt和运动鞋。\n\n需要用到`tf.keras`，它是个用于建立和训练模型的高层次的API\n\n```python\n# TensorFlow and tf.keras\nimport tensorflow as tffrom tensorflow \nimport keras\n# Helper libraries\nimport numpy as np\nimport matplotlib.pyplot as plt\nprint(tf.__version__)\n```\n\n> 2.2.0\n\n**导入Fashion MNIST数据集**\n\n```python\nfashion_mnist = keras.datasets.fashion_mnist\n(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()\n```\n\n导入数据集，返回Numpy数组：\n\n-  `train_images`和`train_labels` 数组是训练集。\n\n- `test_images`和 `test_labels` 数组是测试集。\n\n这些图像是28x28的Numpy数组。可以理解为28x28的像素点，这些像素点在屏幕上显示出来表现为图像。每个像素点的值在0到255之间，表示颜色的深浅。如果你了解颜色的RGB值，那你就明白，所有的颜色都是由不同深浅程度的三种基本色构成，比如白色的RGB为(255.255.255)。标签`labels`是一个整数数组，范围从0到9。表示10个不同的衣服种类`Class`。\n\n| Label | Class       |\n| :---- | :---------- |\n| 0     | T-shirt/top |\n| 1     | Trouser     |\n| 2     | Pullover    |\n| 3     | Dress       |\n| 4     | Coat        |\n| 5     | Sandal      |\n| 6     | Shirt       |\n| 7     | Sneaker     |\n| 8     | Bag         |\n| 9     | Ankle boot  |\n\n这些种类不包括在数据集中，需要单独定义：\n\n```python\nclass_names = ['T-shirt/top', 'Trouser', 'Pullover', 'Dress', 'Coat', 'Sandal', 'Shirt', 'Sneaker', 'Bag', 'Ankle boot']\n```\n\n**研究数据**\n\n在训练模型之前，先研究这些数据格式。比如在训练集中的六万张图片，每张图片由28x28的像素点表示。\n\n```python\ntrain_images.shape\n```\n\n> (60000, 28, 28)\n\n同时还有六万个与之对应的标签：\n\n```python\nlen(train_labels)\n```\n\n> 60000\n\n每个标签都是一个0到9之间的整数：\n\n```python\ntrain_labels\n```\n\n> array([9, 0, 0, ..., 3, 0, 5], dtype=uint8)\n\n还有一万张用于测试的图片：\n\n```python\ntest_images.shape\n```\n\n> (10000, 28, 28)\n\n一万张训练集的标签：\n\n```python\nlen(test_labels)\n```\n\n> 10000\n\n**数据预处理**\n\n在训练模型之前，必须先对数据进行预处理。观察第一张图，我们可以看到图片的像素值在0到255之间。\n\n```python\nplt.figure()\nplt.imshow(train_images[0])\nplt.colorbar()\nplt.grid(False)\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn)\n\n将像素值范围缩小为0到1，所以将像素值都除以255：\n\n```python\ntrain_images = train_images / 255.0\ntest_images = test_images / 255.0\n```\n\n为了确保数据的正确性，先将训练集的前25个图片显示出来，并且在图片下面展示分类名。\n\n```python\nplt.figure(figsize=(10,10))\nfor i in range(25):\n    plt.subplot(5,5,i+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.grid(False)\n    plt.imshow(train_images[i], cmap=plt.cm.binary)\n    plt.xlabel(class_names[train_labels[i]])\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn)\n\n**建立模型**\n\n建立神经网络需要配置模型层，然后编译模型。\n\n**设置层**\n\n基本的神经网络模块是层。层会从它们获取的数据里提取图像。它们希望从这些图像里获取有用的信息。\n\n大多数深度学习都是简单层组合在一起。大多数层比如[`tf.keras.layers.Dense`](https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dense?hl=zh_cn)，拥有在训练时学习到的参数。\n\n```python\nmodel = keras.Sequential([    keras.layers.Flatten(input_shape=(28, 28)),    keras.layers.Dense(128, activation='relu'),    keras.layers.Dense(10)])\n```\n\n这个网络的第一层，tf.keras.layers.Flatten，将图像的格式从二维数组(28 * 28像素)转换为一维数组(28 * 28 = 784像素)。可以将这一层看作是将图像中的像素行展开并排列起来。这一层没有参数需要学习;它只是重新格式化数据。\n\n像素被扁平化后，网络由两个tf.keras.层组成。它们是紧密相连或完全相连的神经层。第一致密层有128个节点(或神经元)。第二个(也是最后一个)层返回长度为10的logits数组。每个节点都包含一个评价值，表示当前图像属于这10个类中的一个。\n\n**编译模型**\n\n在准备训练模型之前，需要进行一些其他设置。 这些是在模型的编译步骤中添加的：\n\n- Loss function——这可以衡量模型在培训期间的准确性。您希望最小化这个函数，以便将模型“引导”到正确的方向。\n- Optimizer——这就是模型如何根据它看到的数据和它的损失函数进行更新。\n- Metrics——用于监控培训和测试步骤。下面的例子使用了准确率，即正确分类的图像的比例。\n\n```python\nmodel.compile(optimizer='adam',              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),              metrics=['accuracy'])\n```\n\n**训练模型**\n\n训练神经网络模型需要以下步骤：\n\n1. 输入训练数据到模型中。\n2. 模型学习关联图像和分类标签。\n3. 让模型预测测试集。\n4. 验证预测结果是否和标签匹配。\n\n**输入数据到模型中**\n\n利用`model.fit`方法。他能将模型用于拟合训练数据。\n\n```python\nmodel.fit(train_images, train_labels, epochs=10)\n```\n\n> Epoch 1/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.4978 - accuracy: 0.8248\n> Epoch 2/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.3767 - accuracy: 0.8637\n> Epoch 3/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.3397 - accuracy: 0.8759\n> Epoch 4/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.3138 - accuracy: 0.8854\n> Epoch 5/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2948 - accuracy: 0.8914\n> Epoch 6/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2803 - accuracy: 0.8958\n> Epoch 7/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2678 - accuracy: 0.9006\n> Epoch 8/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2590 - accuracy: 0.9043\n> Epoch 9/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2464 - accuracy: 0.9078\n> Epoch 10/10\n> 1875/1875 [==============================] - 3s 2ms/step - loss: 0.2402 - accuracy: 0.9099\n>\n> <tensorflow.python.keras.callbacks.History at 0x7fe472eff4a8>\n\n**评估准确率**\n\n比较模型在测试数据集上的表现：\n\n```python\ntest_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=2)\nprint('\\nTest accuracy:', test_acc)\n```\n\n> 313/313 - 1s - loss: 0.3382 - accuracy: 0.8840 \n>\n> Test accuracy: 0.8840000033378601\n\n结果是测试数据集上的准确性比训练数据集上的准确性稍低。训练准确度和测试准确度之间的差距代表过拟合。当机器学习模型在新的、以前没有看到的输入上的表现不如在训练数据上的表现时，就会发生过拟合。过度拟合的模型“记忆”了训练数据集中的噪音和细节，从而对模型在新数据上的性能产生负面影响。有关更多信息，请参见以下内容\n\n- [证明过度拟合](https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#demonstrate_overfitting)\n- [防止过度拟合策略](https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#strategies_to_prevent_overfitting)\n\n**预测结果**\n\n通过训练模型，你可以使用它来预测某些图像。 模型的线性输出，logits。 附加一个softmax层以将logit转换为更容易解释的概率。\n\n```python\nprobability_model = tf.keras.Sequential([model,                                          tf.keras.layers.Softmax()])\n```\n\n```python\npredictions = probability_model.predict(test_images)\n```\n\n在这里，模型已经预测了测试集中每个图像的标签。 让我们看一下第一个预测：\n\n```python\npredictions[0]\n```\n\n> array([1.2275562e-07, 8.9534730e-08, 7.6224147e-09, 1.9726743e-08,\n>        6.1515345e-07, 4.6329503e-03, 4.1164008e-06, 1.5043605e-02,\n>        2.8817641e-07, 9.8031825e-01], dtype=float32)\n\n预测是一个包含10个数字的数组。它们代表了模型的“自信”，即图像对应着10种不同的服装。你可以看到哪个标签的自信度最高：\n\n```python\nnp.argmax(predictions[0])\n```\n\n> 9\n\n因此，模型最自信的认为这是一个踝靴，或`class_names[9]`。检查测试标签表明这个分类是正确的：\n\n```python\ntest_labels[0]\n```\n\n> 9\n\n绘制图表，看看10个类预测的全部集合。\n\n```python\ndef plot_image(i, predictions_array, true_label, img):\n  predictions_array, true_label, img = predictions_array, true_label[i], img[i]\n  plt.grid(False)\n  plt.xticks([])\n  plt.yticks([])\n\n  plt.imshow(img, cmap=plt.cm.binary)\n\n  predicted_label = np.argmax(predictions_array)\n  if predicted_label == true_label:\n    color = 'blue'\n  else:\n    color = 'red'\n\n  plt.xlabel(\"{} {:2.0f}% ({})\".format(class_names[predicted_label],\n                                100*np.max(predictions_array),\n                                class_names[true_label]),\n                                color=color)\n\ndef plot_value_array(i, predictions_array, true_label):\n  predictions_array, true_label = predictions_array, true_label[i]\n  plt.grid(False)\n  plt.xticks(range(10))\n  plt.yticks([])\n  thisplot = plt.bar(range(10), predictions_array, color=\"#777777\")\n  plt.ylim([0, 1])\n  predicted_label = np.argmax(predictions_array)\n\n  thisplot[predicted_label].set_color('red')\n  thisplot[true_label].set_color('blue')\n```\n\n**验证预测**\n\n通过训练模型，您可以使用它来预测某些图像。\n\n让我们看一下第0张图片，预测和预测数组。 正确的预测标签为蓝色，错误的预测标签为红色。 该数字给出了预测标签的百分比（满分为100）。\n\n```python\ni = 0\nplt.figure(figsize=(6,3))\nplt.subplot(1,2,1)\nplot_image(i, predictions[i], test_labels, test_images)\nplt.subplot(1,2,2)\nplot_value_array(i, predictions[i],  test_labels)\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn)\n\n```python\ni = 12\nplt.figure(figsize=(6,3))\nplt.subplot(1,2,1)\nplot_image(i, predictions[i], test_labels, test_images)\nplt.subplot(1,2,2)\nplot_value_array(i, predictions[i],  test_labels)\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn)\n\n让我们绘制一些带有预测的图像。 请注意，即使非常自信，该模型也可能是错误的。\n\n```python\n# Plot the first X test images, their predicted labels, and the true labels.\n# Color correct predictions in blue and incorrect predictions in red.\nnum_rows = 5\nnum_cols = 3\nnum_images = num_rows*num_cols\nplt.figure(figsize=(2*2*num_cols, 2*num_rows))\nfor i in range(num_images):\n  plt.subplot(num_rows, 2*num_cols, 2*i+1)\n  plot_image(i, predictions[i], test_labels, test_images)\n  plt.subplot(num_rows, 2*num_cols, 2*i+2)\n  plot_value_array(i, predictions[i], test_labels)\nplt.tight_layout()\nplt.show()\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn)\n\n**使用训练的模型**\n\n最后，利用训练好的模型对单幅图像进行预测。\n\n```python\n# Grab an image from the test dataset.\nimg = test_images[1]\nprint(img.shape)\n```\n\n> (28, 28)\n\n`tf.keras`模型经过优化，可以立即对一批或一组示例进行预测。因此，即使使用的是单个图像，也需要将其添加到列表中\n\n```python\n# Add the image to a batch where it's the only member.\nimg = (np.expand_dims(img,0))\nprint(img.shape)\n```\n\n> (1, 28, 28)\n\n现在为这个图像预测正确的标签\n\n```python\npredictions_single = probability_model.predict(img)\n\nprint(predictions_single)\n```\n\n> [[2.3256284e-06 5.5768194e-13 9.9955302e-01 3.3701731e-13 4.3444714e-04\n>   3.7890427e-17 1.0105057e-05 4.5671220e-20 8.4883814e-14 9.5599025e-18]]\n\n```python\nplot_value_array(1, predictions_single[0], test_labels)_ = plt.xticks(range(10), class_names, rotation=45)\n```\n\n![](https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn)\n\nkeras.Model.predict返回列表的列表-数据批次中每个图像的列表。 批量获取我们（唯一）图像的预测：\n\n```python\nnp.argmax(predictions_single[0])\n```\n\n> 2\n\n这个模型预测了一个标签。\n\n本指南使用Fashion MNIST数据集，该数据集包含10个类别中的70,000张灰度图像。这些图像以低分辨率(28×28像素)显示了衣服的单个物品，如图所示\n\n![](https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn)\n\nFashion MNIST旨在替代经典MNIST数据集，通常被用作计算机视觉机器学习程序的“ Hello，World”。 MNIST数据集包含手写数字（0、1、2等）的图像，格式与您将在此处使用的衣服的格式相同。\n\n本指南将Fashion MNIST用于多种用途，并且因为它比常规MNIST更具挑战性。 两个数据集都相对较小，用于验证算法是否按预期工作。 它们是测试和调试代码的良好起点。\n\n在这里，使用60,000张图像来训练网络，使用10,000张图像来评估网络学习对图像进行分类的准确程度。 您可以直接从TensorFlow访问Fashion MNIST。 直接从TensorFlow导入和加载Fashion MNIST数据：","slug":"TensorFlow学习笔记","published":1,"updated":"2020-06-18T11:43:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabl001mp0vzgr4yfi61","content":"<h2 id=\"P1：tensorflow安装\"><a href=\"#P1：tensorflow安装\" class=\"headerlink\" title=\"P1：tensorflow安装\"></a>P1：tensorflow安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install tensorflow</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"P2：Hello-World——衣服分类\"><a href=\"#P2：Hello-World——衣服分类\" class=\"headerlink\" title=\"P2：Hello World——衣服分类\"></a>P2：Hello World——衣服分类</h2><p>这个例子训练了一个神经网络模型，用于分类衣服图片，比如tshirt和运动鞋。</p>\n<p>需要用到<code>tf.keras</code>，它是个用于建立和训练模型的高层次的API</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TensorFlow and tf.keras</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> tensorflow <span class=\"keyword\">as</span> tffrom tensorflow </span><br><span class=\"line\"><span class=\"keyword\">import</span> keras</span><br><span class=\"line\"><span class=\"comment\"># Helper libraries</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\">print(tf.__version__)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>2.2.0</p>\n</blockquote>\n<p><strong>导入Fashion MNIST数据集</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fashion_mnist = keras.datasets.fashion_mnist</span><br><span class=\"line\">(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()</span><br></pre></td></tr></table></figure>\n\n<p>导入数据集，返回Numpy数组：</p>\n<ul>\n<li><p><code>train_images</code>和<code>train_labels</code> 数组是训练集。</p>\n</li>\n<li><p><code>test_images</code>和 <code>test_labels</code> 数组是测试集。</p>\n</li>\n</ul>\n<p>这些图像是28x28的Numpy数组。可以理解为28x28的像素点，这些像素点在屏幕上显示出来表现为图像。每个像素点的值在0到255之间，表示颜色的深浅。如果你了解颜色的RGB值，那你就明白，所有的颜色都是由不同深浅程度的三种基本色构成，比如白色的RGB为(255.255.255)。标签<code>labels</code>是一个整数数组，范围从0到9。表示10个不同的衣服种类<code>Class</code>。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Label</th>\n<th align=\"left\">Class</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">0</td>\n<td align=\"left\">T-shirt/top</td>\n</tr>\n<tr>\n<td align=\"left\">1</td>\n<td align=\"left\">Trouser</td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">Pullover</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\">Dress</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\">Coat</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">Sandal</td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">Shirt</td>\n</tr>\n<tr>\n<td align=\"left\">7</td>\n<td align=\"left\">Sneaker</td>\n</tr>\n<tr>\n<td align=\"left\">8</td>\n<td align=\"left\">Bag</td>\n</tr>\n<tr>\n<td align=\"left\">9</td>\n<td align=\"left\">Ankle boot</td>\n</tr>\n</tbody></table>\n<p>这些种类不包括在数据集中，需要单独定义：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class_names = [<span class=\"string\">&#x27;T-shirt/top&#x27;</span>, <span class=\"string\">&#x27;Trouser&#x27;</span>, <span class=\"string\">&#x27;Pullover&#x27;</span>, <span class=\"string\">&#x27;Dress&#x27;</span>, <span class=\"string\">&#x27;Coat&#x27;</span>, <span class=\"string\">&#x27;Sandal&#x27;</span>, <span class=\"string\">&#x27;Shirt&#x27;</span>, <span class=\"string\">&#x27;Sneaker&#x27;</span>, <span class=\"string\">&#x27;Bag&#x27;</span>, <span class=\"string\">&#x27;Ankle boot&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>研究数据</strong></p>\n<p>在训练模型之前，先研究这些数据格式。比如在训练集中的六万张图片，每张图片由28x28的像素点表示。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">train_images.shape</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(60000, 28, 28)</p>\n</blockquote>\n<p>同时还有六万个与之对应的标签：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">len(train_labels)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>60000</p>\n</blockquote>\n<p>每个标签都是一个0到9之间的整数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">train_labels</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>array([9, 0, 0, …, 3, 0, 5], dtype=uint8)</p>\n</blockquote>\n<p>还有一万张用于测试的图片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_images.shape</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(10000, 28, 28)</p>\n</blockquote>\n<p>一万张训练集的标签：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">len(test_labels)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>10000</p>\n</blockquote>\n<p><strong>数据预处理</strong></p>\n<p>在训练模型之前，必须先对数据进行预处理。观察第一张图，我们可以看到图片的像素值在0到255之间。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.figure()</span><br><span class=\"line\">plt.imshow(train_images[<span class=\"number\">0</span>])</span><br><span class=\"line\">plt.colorbar()</span><br><span class=\"line\">plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>将像素值范围缩小为0到1，所以将像素值都除以255：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">train_images = train_images / <span class=\"number\">255.0</span></span><br><span class=\"line\">test_images = test_images / <span class=\"number\">255.0</span></span><br></pre></td></tr></table></figure>\n\n<p>为了确保数据的正确性，先将训练集的前25个图片显示出来，并且在图片下面展示分类名。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.figure(figsize=(<span class=\"number\">10</span>,<span class=\"number\">10</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">25</span>):</span><br><span class=\"line\">    plt.subplot(<span class=\"number\">5</span>,<span class=\"number\">5</span>,i+<span class=\"number\">1</span>)</span><br><span class=\"line\">    plt.xticks([])</span><br><span class=\"line\">    plt.yticks([])</span><br><span class=\"line\">    plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">    plt.imshow(train_images[i], cmap=plt.cm.binary)</span><br><span class=\"line\">    plt.xlabel(class_names[train_labels[i]])</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>建立模型</strong></p>\n<p>建立神经网络需要配置模型层，然后编译模型。</p>\n<p><strong>设置层</strong></p>\n<p>基本的神经网络模块是层。层会从它们获取的数据里提取图像。它们希望从这些图像里获取有用的信息。</p>\n<p>大多数深度学习都是简单层组合在一起。大多数层比如<a href=\"https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dense?hl=zh_cn\"><code>tf.keras.layers.Dense</code></a>，拥有在训练时学习到的参数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = keras.Sequential([    keras.layers.Flatten(input_shape=(<span class=\"number\">28</span>, <span class=\"number\">28</span>)),    keras.layers.Dense(<span class=\"number\">128</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>),    keras.layers.Dense(<span class=\"number\">10</span>)])</span><br></pre></td></tr></table></figure>\n\n<p>这个网络的第一层，tf.keras.layers.Flatten，将图像的格式从二维数组(28 * 28像素)转换为一维数组(28 * 28 = 784像素)。可以将这一层看作是将图像中的像素行展开并排列起来。这一层没有参数需要学习;它只是重新格式化数据。</p>\n<p>像素被扁平化后，网络由两个tf.keras.层组成。它们是紧密相连或完全相连的神经层。第一致密层有128个节点(或神经元)。第二个(也是最后一个)层返回长度为10的logits数组。每个节点都包含一个评价值，表示当前图像属于这10个类中的一个。</p>\n<p><strong>编译模型</strong></p>\n<p>在准备训练模型之前，需要进行一些其他设置。 这些是在模型的编译步骤中添加的：</p>\n<ul>\n<li>Loss function——这可以衡量模型在培训期间的准确性。您希望最小化这个函数，以便将模型“引导”到正确的方向。</li>\n<li>Optimizer——这就是模型如何根据它看到的数据和它的损失函数进行更新。</li>\n<li>Metrics——用于监控培训和测试步骤。下面的例子使用了准确率，即正确分类的图像的比例。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.compile(optimizer=<span class=\"string\">&#x27;adam&#x27;</span>,              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class=\"literal\">True</span>),              metrics=[<span class=\"string\">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>\n\n<p><strong>训练模型</strong></p>\n<p>训练神经网络模型需要以下步骤：</p>\n<ol>\n<li>输入训练数据到模型中。</li>\n<li>模型学习关联图像和分类标签。</li>\n<li>让模型预测测试集。</li>\n<li>验证预测结果是否和标签匹配。</li>\n</ol>\n<p><strong>输入数据到模型中</strong></p>\n<p>利用<code>model.fit</code>方法。他能将模型用于拟合训练数据。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.fit(train_images, train_labels, epochs=<span class=\"number\">10</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Epoch 1/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.4978 - accuracy: 0.8248<br>Epoch 2/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3767 - accuracy: 0.8637<br>Epoch 3/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3397 - accuracy: 0.8759<br>Epoch 4/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3138 - accuracy: 0.8854<br>Epoch 5/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2948 - accuracy: 0.8914<br>Epoch 6/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2803 - accuracy: 0.8958<br>Epoch 7/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2678 - accuracy: 0.9006<br>Epoch 8/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2590 - accuracy: 0.9043<br>Epoch 9/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2464 - accuracy: 0.9078<br>Epoch 10/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2402 - accuracy: 0.9099</p>\n<p>&lt;tensorflow.python.keras.callbacks.History at 0x7fe472eff4a8&gt;</p>\n</blockquote>\n<p><strong>评估准确率</strong></p>\n<p>比较模型在测试数据集上的表现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=<span class=\"number\">2</span>)</span><br><span class=\"line\">print(<span class=\"string\">&#x27;\\nTest accuracy:&#x27;</span>, test_acc)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>313/313 - 1s - loss: 0.3382 - accuracy: 0.8840 </p>\n<p>Test accuracy: 0.8840000033378601</p>\n</blockquote>\n<p>结果是测试数据集上的准确性比训练数据集上的准确性稍低。训练准确度和测试准确度之间的差距代表过拟合。当机器学习模型在新的、以前没有看到的输入上的表现不如在训练数据上的表现时，就会发生过拟合。过度拟合的模型“记忆”了训练数据集中的噪音和细节，从而对模型在新数据上的性能产生负面影响。有关更多信息，请参见以下内容</p>\n<ul>\n<li><a href=\"https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#demonstrate_overfitting\">证明过度拟合</a></li>\n<li><a href=\"https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#strategies_to_prevent_overfitting\">防止过度拟合策略</a></li>\n</ul>\n<p><strong>预测结果</strong></p>\n<p>通过训练模型，你可以使用它来预测某些图像。 模型的线性输出，logits。 附加一个softmax层以将logit转换为更容易解释的概率。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">probability_model = tf.keras.Sequential([model,                                          tf.keras.layers.Softmax()])</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">predictions = probability_model.predict(test_images)</span><br></pre></td></tr></table></figure>\n\n<p>在这里，模型已经预测了测试集中每个图像的标签。 让我们看一下第一个预测：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">predictions[<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>array([1.2275562e-07, 8.9534730e-08, 7.6224147e-09, 1.9726743e-08,<br>       6.1515345e-07, 4.6329503e-03, 4.1164008e-06, 1.5043605e-02,<br>       2.8817641e-07, 9.8031825e-01], dtype=float32)</p>\n</blockquote>\n<p>预测是一个包含10个数字的数组。它们代表了模型的“自信”，即图像对应着10种不同的服装。你可以看到哪个标签的自信度最高：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.argmax(predictions[<span class=\"number\">0</span>])</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>9</p>\n</blockquote>\n<p>因此，模型最自信的认为这是一个踝靴，或<code>class_names[9]</code>。检查测试标签表明这个分类是正确的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_labels[<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>9</p>\n</blockquote>\n<p>绘制图表，看看10个类预测的全部集合。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plot_image</span>(<span class=\"params\">i, predictions_array, true_label, img</span>):</span></span><br><span class=\"line\">  predictions_array, true_label, img = predictions_array, true_label[i], img[i]</span><br><span class=\"line\">  plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">  plt.xticks([])</span><br><span class=\"line\">  plt.yticks([])</span><br><span class=\"line\"></span><br><span class=\"line\">  plt.imshow(img, cmap=plt.cm.binary)</span><br><span class=\"line\"></span><br><span class=\"line\">  predicted_label = np.argmax(predictions_array)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> predicted_label == true_label:</span><br><span class=\"line\">    color = <span class=\"string\">&#x27;blue&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span>:</span><br><span class=\"line\">    color = <span class=\"string\">&#x27;red&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  plt.xlabel(<span class=\"string\">&quot;&#123;&#125; &#123;:2.0f&#125;% (&#123;&#125;)&quot;</span>.format(class_names[predicted_label],</span><br><span class=\"line\">                                <span class=\"number\">100</span>*np.max(predictions_array),</span><br><span class=\"line\">                                class_names[true_label]),</span><br><span class=\"line\">                                color=color)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plot_value_array</span>(<span class=\"params\">i, predictions_array, true_label</span>):</span></span><br><span class=\"line\">  predictions_array, true_label = predictions_array, true_label[i]</span><br><span class=\"line\">  plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">  plt.xticks(range(<span class=\"number\">10</span>))</span><br><span class=\"line\">  plt.yticks([])</span><br><span class=\"line\">  thisplot = plt.bar(range(<span class=\"number\">10</span>), predictions_array, color=<span class=\"string\">&quot;#777777&quot;</span>)</span><br><span class=\"line\">  plt.ylim([<span class=\"number\">0</span>, <span class=\"number\">1</span>])</span><br><span class=\"line\">  predicted_label = np.argmax(predictions_array)</span><br><span class=\"line\"></span><br><span class=\"line\">  thisplot[predicted_label].set_color(<span class=\"string\">&#x27;red&#x27;</span>)</span><br><span class=\"line\">  thisplot[true_label].set_color(<span class=\"string\">&#x27;blue&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>验证预测</strong></p>\n<p>通过训练模型，您可以使用它来预测某些图像。</p>\n<p>让我们看一下第0张图片，预测和预测数组。 正确的预测标签为蓝色，错误的预测标签为红色。 该数字给出了预测标签的百分比（满分为100）。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">6</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">plot_image(i, predictions[i], test_labels, test_images)</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">plot_value_array(i, predictions[i],  test_labels)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">12</span></span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">6</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">plot_image(i, predictions[i], test_labels, test_images)</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">plot_value_array(i, predictions[i],  test_labels)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>让我们绘制一些带有预测的图像。 请注意，即使非常自信，该模型也可能是错误的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Plot the first X test images, their predicted labels, and the true labels.</span></span><br><span class=\"line\"><span class=\"comment\"># Color correct predictions in blue and incorrect predictions in red.</span></span><br><span class=\"line\">num_rows = <span class=\"number\">5</span></span><br><span class=\"line\">num_cols = <span class=\"number\">3</span></span><br><span class=\"line\">num_images = num_rows*num_cols</span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">2</span>*<span class=\"number\">2</span>*num_cols, <span class=\"number\">2</span>*num_rows))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(num_images):</span><br><span class=\"line\">  plt.subplot(num_rows, <span class=\"number\">2</span>*num_cols, <span class=\"number\">2</span>*i+<span class=\"number\">1</span>)</span><br><span class=\"line\">  plot_image(i, predictions[i], test_labels, test_images)</span><br><span class=\"line\">  plt.subplot(num_rows, <span class=\"number\">2</span>*num_cols, <span class=\"number\">2</span>*i+<span class=\"number\">2</span>)</span><br><span class=\"line\">  plot_value_array(i, predictions[i], test_labels)</span><br><span class=\"line\">plt.tight_layout()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>使用训练的模型</strong></p>\n<p>最后，利用训练好的模型对单幅图像进行预测。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Grab an image from the test dataset.</span></span><br><span class=\"line\">img = test_images[<span class=\"number\">1</span>]</span><br><span class=\"line\">print(img.shape)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(28, 28)</p>\n</blockquote>\n<p><code>tf.keras</code>模型经过优化，可以立即对一批或一组示例进行预测。因此，即使使用的是单个图像，也需要将其添加到列表中</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Add the image to a batch where it&#x27;s the only member.</span></span><br><span class=\"line\">img = (np.expand_dims(img,<span class=\"number\">0</span>))</span><br><span class=\"line\">print(img.shape)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(1, 28, 28)</p>\n</blockquote>\n<p>现在为这个图像预测正确的标签</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">predictions_single = probability_model.predict(img)</span><br><span class=\"line\"></span><br><span class=\"line\">print(predictions_single)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>[[2.3256284e-06 5.5768194e-13 9.9955302e-01 3.3701731e-13 4.3444714e-04<br>  3.7890427e-17 1.0105057e-05 4.5671220e-20 8.4883814e-14 9.5599025e-18]]</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plot_value_array(<span class=\"number\">1</span>, predictions_single[<span class=\"number\">0</span>], test_labels)_ = plt.xticks(range(<span class=\"number\">10</span>), class_names, rotation=<span class=\"number\">45</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>keras.Model.predict返回列表的列表-数据批次中每个图像的列表。 批量获取我们（唯一）图像的预测：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.argmax(predictions_single[<span class=\"number\">0</span>])</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>2</p>\n</blockquote>\n<p>这个模型预测了一个标签。</p>\n<p>本指南使用Fashion MNIST数据集，该数据集包含10个类别中的70,000张灰度图像。这些图像以低分辨率(28×28像素)显示了衣服的单个物品，如图所示</p>\n<p><img src=\"https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn\" class=\"lazyload\" data-srcset=\"https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>Fashion MNIST旨在替代经典MNIST数据集，通常被用作计算机视觉机器学习程序的“ Hello，World”。 MNIST数据集包含手写数字（0、1、2等）的图像，格式与您将在此处使用的衣服的格式相同。</p>\n<p>本指南将Fashion MNIST用于多种用途，并且因为它比常规MNIST更具挑战性。 两个数据集都相对较小，用于验证算法是否按预期工作。 它们是测试和调试代码的良好起点。</p>\n<p>在这里，使用60,000张图像来训练网络，使用10,000张图像来评估网络学习对图像进行分类的准确程度。 您可以直接从TensorFlow访问Fashion MNIST。 直接从TensorFlow导入和加载Fashion MNIST数据：</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h2 id=\"P1：tensorflow安装\"><a href=\"#P1：tensorflow安装\" class=\"headerlink\" title=\"P1：tensorflow安装\"></a>P1：tensorflow安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install tensorflow</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"P2：Hello-World——衣服分类\"><a href=\"#P2：Hello-World——衣服分类\" class=\"headerlink\" title=\"P2：Hello World——衣服分类\"></a>P2：Hello World——衣服分类</h2><p>这个例子训练了一个神经网络模型，用于分类衣服图片，比如tshirt和运动鞋。</p>\n<p>需要用到<code>tf.keras</code>，它是个用于建立和训练模型的高层次的API</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TensorFlow and tf.keras</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> tensorflow <span class=\"keyword\">as</span> tffrom tensorflow </span><br><span class=\"line\"><span class=\"keyword\">import</span> keras</span><br><span class=\"line\"><span class=\"comment\"># Helper libraries</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\">print(tf.__version__)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>2.2.0</p>\n</blockquote>\n<p><strong>导入Fashion MNIST数据集</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fashion_mnist = keras.datasets.fashion_mnist</span><br><span class=\"line\">(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()</span><br></pre></td></tr></table></figure>\n\n<p>导入数据集，返回Numpy数组：</p>\n<ul>\n<li><p><code>train_images</code>和<code>train_labels</code> 数组是训练集。</p>\n</li>\n<li><p><code>test_images</code>和 <code>test_labels</code> 数组是测试集。</p>\n</li>\n</ul>\n<p>这些图像是28x28的Numpy数组。可以理解为28x28的像素点，这些像素点在屏幕上显示出来表现为图像。每个像素点的值在0到255之间，表示颜色的深浅。如果你了解颜色的RGB值，那你就明白，所有的颜色都是由不同深浅程度的三种基本色构成，比如白色的RGB为(255.255.255)。标签<code>labels</code>是一个整数数组，范围从0到9。表示10个不同的衣服种类<code>Class</code>。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Label</th>\n<th align=\"left\">Class</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">0</td>\n<td align=\"left\">T-shirt/top</td>\n</tr>\n<tr>\n<td align=\"left\">1</td>\n<td align=\"left\">Trouser</td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">Pullover</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\">Dress</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\">Coat</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">Sandal</td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">Shirt</td>\n</tr>\n<tr>\n<td align=\"left\">7</td>\n<td align=\"left\">Sneaker</td>\n</tr>\n<tr>\n<td align=\"left\">8</td>\n<td align=\"left\">Bag</td>\n</tr>\n<tr>\n<td align=\"left\">9</td>\n<td align=\"left\">Ankle boot</td>\n</tr>\n</tbody></table>\n<p>这些种类不包括在数据集中，需要单独定义：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class_names = [<span class=\"string\">&#x27;T-shirt/top&#x27;</span>, <span class=\"string\">&#x27;Trouser&#x27;</span>, <span class=\"string\">&#x27;Pullover&#x27;</span>, <span class=\"string\">&#x27;Dress&#x27;</span>, <span class=\"string\">&#x27;Coat&#x27;</span>, <span class=\"string\">&#x27;Sandal&#x27;</span>, <span class=\"string\">&#x27;Shirt&#x27;</span>, <span class=\"string\">&#x27;Sneaker&#x27;</span>, <span class=\"string\">&#x27;Bag&#x27;</span>, <span class=\"string\">&#x27;Ankle boot&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><strong>研究数据</strong></p>\n<p>在训练模型之前，先研究这些数据格式。比如在训练集中的六万张图片，每张图片由28x28的像素点表示。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">train_images.shape</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(60000, 28, 28)</p>\n</blockquote>\n<p>同时还有六万个与之对应的标签：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">len(train_labels)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>60000</p>\n</blockquote>\n<p>每个标签都是一个0到9之间的整数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">train_labels</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>array([9, 0, 0, …, 3, 0, 5], dtype=uint8)</p>\n</blockquote>\n<p>还有一万张用于测试的图片：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_images.shape</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(10000, 28, 28)</p>\n</blockquote>\n<p>一万张训练集的标签：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">len(test_labels)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>10000</p>\n</blockquote>\n<p><strong>数据预处理</strong></p>\n<p>在训练模型之前，必须先对数据进行预处理。观察第一张图，我们可以看到图片的像素值在0到255之间。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.figure()</span><br><span class=\"line\">plt.imshow(train_images[<span class=\"number\">0</span>])</span><br><span class=\"line\">plt.colorbar()</span><br><span class=\"line\">plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn\"></p>\n<p>将像素值范围缩小为0到1，所以将像素值都除以255：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">train_images = train_images / <span class=\"number\">255.0</span></span><br><span class=\"line\">test_images = test_images / <span class=\"number\">255.0</span></span><br></pre></td></tr></table></figure>\n\n<p>为了确保数据的正确性，先将训练集的前25个图片显示出来，并且在图片下面展示分类名。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.figure(figsize=(<span class=\"number\">10</span>,<span class=\"number\">10</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">25</span>):</span><br><span class=\"line\">    plt.subplot(<span class=\"number\">5</span>,<span class=\"number\">5</span>,i+<span class=\"number\">1</span>)</span><br><span class=\"line\">    plt.xticks([])</span><br><span class=\"line\">    plt.yticks([])</span><br><span class=\"line\">    plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">    plt.imshow(train_images[i], cmap=plt.cm.binary)</span><br><span class=\"line\">    plt.xlabel(class_names[train_labels[i]])</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn\"></p>\n<p><strong>建立模型</strong></p>\n<p>建立神经网络需要配置模型层，然后编译模型。</p>\n<p><strong>设置层</strong></p>\n<p>基本的神经网络模块是层。层会从它们获取的数据里提取图像。它们希望从这些图像里获取有用的信息。</p>\n<p>大多数深度学习都是简单层组合在一起。大多数层比如<a href=\"https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dense?hl=zh_cn\"><code>tf.keras.layers.Dense</code></a>，拥有在训练时学习到的参数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = keras.Sequential([    keras.layers.Flatten(input_shape=(<span class=\"number\">28</span>, <span class=\"number\">28</span>)),    keras.layers.Dense(<span class=\"number\">128</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>),    keras.layers.Dense(<span class=\"number\">10</span>)])</span><br></pre></td></tr></table></figure>\n\n<p>这个网络的第一层，tf.keras.layers.Flatten，将图像的格式从二维数组(28 * 28像素)转换为一维数组(28 * 28 = 784像素)。可以将这一层看作是将图像中的像素行展开并排列起来。这一层没有参数需要学习;它只是重新格式化数据。</p>\n<p>像素被扁平化后，网络由两个tf.keras.层组成。它们是紧密相连或完全相连的神经层。第一致密层有128个节点(或神经元)。第二个(也是最后一个)层返回长度为10的logits数组。每个节点都包含一个评价值，表示当前图像属于这10个类中的一个。</p>\n<p><strong>编译模型</strong></p>\n<p>在准备训练模型之前，需要进行一些其他设置。 这些是在模型的编译步骤中添加的：</p>\n<ul>\n<li>Loss function——这可以衡量模型在培训期间的准确性。您希望最小化这个函数，以便将模型“引导”到正确的方向。</li>\n<li>Optimizer——这就是模型如何根据它看到的数据和它的损失函数进行更新。</li>\n<li>Metrics——用于监控培训和测试步骤。下面的例子使用了准确率，即正确分类的图像的比例。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.compile(optimizer=<span class=\"string\">&#x27;adam&#x27;</span>,              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class=\"literal\">True</span>),              metrics=[<span class=\"string\">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>\n\n<p><strong>训练模型</strong></p>\n<p>训练神经网络模型需要以下步骤：</p>\n<ol>\n<li>输入训练数据到模型中。</li>\n<li>模型学习关联图像和分类标签。</li>\n<li>让模型预测测试集。</li>\n<li>验证预测结果是否和标签匹配。</li>\n</ol>\n<p><strong>输入数据到模型中</strong></p>\n<p>利用<code>model.fit</code>方法。他能将模型用于拟合训练数据。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.fit(train_images, train_labels, epochs=<span class=\"number\">10</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Epoch 1/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.4978 - accuracy: 0.8248<br>Epoch 2/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3767 - accuracy: 0.8637<br>Epoch 3/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3397 - accuracy: 0.8759<br>Epoch 4/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3138 - accuracy: 0.8854<br>Epoch 5/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2948 - accuracy: 0.8914<br>Epoch 6/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2803 - accuracy: 0.8958<br>Epoch 7/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2678 - accuracy: 0.9006<br>Epoch 8/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2590 - accuracy: 0.9043<br>Epoch 9/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2464 - accuracy: 0.9078<br>Epoch 10/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2402 - accuracy: 0.9099</p>\n<p>&lt;tensorflow.python.keras.callbacks.History at 0x7fe472eff4a8&gt;</p>\n</blockquote>\n<p><strong>评估准确率</strong></p>\n<p>比较模型在测试数据集上的表现：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=<span class=\"number\">2</span>)</span><br><span class=\"line\">print(<span class=\"string\">&#x27;\\nTest accuracy:&#x27;</span>, test_acc)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>313/313 - 1s - loss: 0.3382 - accuracy: 0.8840 </p>\n<p>Test accuracy: 0.8840000033378601</p>\n</blockquote>\n<p>结果是测试数据集上的准确性比训练数据集上的准确性稍低。训练准确度和测试准确度之间的差距代表过拟合。当机器学习模型在新的、以前没有看到的输入上的表现不如在训练数据上的表现时，就会发生过拟合。过度拟合的模型“记忆”了训练数据集中的噪音和细节，从而对模型在新数据上的性能产生负面影响。有关更多信息，请参见以下内容</p>\n<ul>\n<li><a href=\"https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#demonstrate_overfitting\">证明过度拟合</a></li>\n<li><a href=\"https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#strategies_to_prevent_overfitting\">防止过度拟合策略</a></li>\n</ul>\n<p><strong>预测结果</strong></p>\n<p>通过训练模型，你可以使用它来预测某些图像。 模型的线性输出，logits。 附加一个softmax层以将logit转换为更容易解释的概率。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">probability_model = tf.keras.Sequential([model,                                          tf.keras.layers.Softmax()])</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">predictions = probability_model.predict(test_images)</span><br></pre></td></tr></table></figure>\n\n<p>在这里，模型已经预测了测试集中每个图像的标签。 让我们看一下第一个预测：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">predictions[<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>array([1.2275562e-07, 8.9534730e-08, 7.6224147e-09, 1.9726743e-08,<br>       6.1515345e-07, 4.6329503e-03, 4.1164008e-06, 1.5043605e-02,<br>       2.8817641e-07, 9.8031825e-01], dtype=float32)</p>\n</blockquote>\n<p>预测是一个包含10个数字的数组。它们代表了模型的“自信”，即图像对应着10种不同的服装。你可以看到哪个标签的自信度最高：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.argmax(predictions[<span class=\"number\">0</span>])</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>9</p>\n</blockquote>\n<p>因此，模型最自信的认为这是一个踝靴，或<code>class_names[9]</code>。检查测试标签表明这个分类是正确的：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_labels[<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>9</p>\n</blockquote>\n<p>绘制图表，看看10个类预测的全部集合。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plot_image</span>(<span class=\"params\">i, predictions_array, true_label, img</span>):</span></span><br><span class=\"line\">  predictions_array, true_label, img = predictions_array, true_label[i], img[i]</span><br><span class=\"line\">  plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">  plt.xticks([])</span><br><span class=\"line\">  plt.yticks([])</span><br><span class=\"line\"></span><br><span class=\"line\">  plt.imshow(img, cmap=plt.cm.binary)</span><br><span class=\"line\"></span><br><span class=\"line\">  predicted_label = np.argmax(predictions_array)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> predicted_label == true_label:</span><br><span class=\"line\">    color = <span class=\"string\">&#x27;blue&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span>:</span><br><span class=\"line\">    color = <span class=\"string\">&#x27;red&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  plt.xlabel(<span class=\"string\">&quot;&#123;&#125; &#123;:2.0f&#125;% (&#123;&#125;)&quot;</span>.format(class_names[predicted_label],</span><br><span class=\"line\">                                <span class=\"number\">100</span>*np.max(predictions_array),</span><br><span class=\"line\">                                class_names[true_label]),</span><br><span class=\"line\">                                color=color)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plot_value_array</span>(<span class=\"params\">i, predictions_array, true_label</span>):</span></span><br><span class=\"line\">  predictions_array, true_label = predictions_array, true_label[i]</span><br><span class=\"line\">  plt.grid(<span class=\"literal\">False</span>)</span><br><span class=\"line\">  plt.xticks(range(<span class=\"number\">10</span>))</span><br><span class=\"line\">  plt.yticks([])</span><br><span class=\"line\">  thisplot = plt.bar(range(<span class=\"number\">10</span>), predictions_array, color=<span class=\"string\">&quot;#777777&quot;</span>)</span><br><span class=\"line\">  plt.ylim([<span class=\"number\">0</span>, <span class=\"number\">1</span>])</span><br><span class=\"line\">  predicted_label = np.argmax(predictions_array)</span><br><span class=\"line\"></span><br><span class=\"line\">  thisplot[predicted_label].set_color(<span class=\"string\">&#x27;red&#x27;</span>)</span><br><span class=\"line\">  thisplot[true_label].set_color(<span class=\"string\">&#x27;blue&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>验证预测</strong></p>\n<p>通过训练模型，您可以使用它来预测某些图像。</p>\n<p>让我们看一下第0张图片，预测和预测数组。 正确的预测标签为蓝色，错误的预测标签为红色。 该数字给出了预测标签的百分比（满分为100）。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">6</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">plot_image(i, predictions[i], test_labels, test_images)</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">plot_value_array(i, predictions[i],  test_labels)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">12</span></span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">6</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">plot_image(i, predictions[i], test_labels, test_images)</span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">plot_value_array(i, predictions[i],  test_labels)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn\"></p>\n<p>让我们绘制一些带有预测的图像。 请注意，即使非常自信，该模型也可能是错误的。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Plot the first X test images, their predicted labels, and the true labels.</span></span><br><span class=\"line\"><span class=\"comment\"># Color correct predictions in blue and incorrect predictions in red.</span></span><br><span class=\"line\">num_rows = <span class=\"number\">5</span></span><br><span class=\"line\">num_cols = <span class=\"number\">3</span></span><br><span class=\"line\">num_images = num_rows*num_cols</span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">2</span>*<span class=\"number\">2</span>*num_cols, <span class=\"number\">2</span>*num_rows))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(num_images):</span><br><span class=\"line\">  plt.subplot(num_rows, <span class=\"number\">2</span>*num_cols, <span class=\"number\">2</span>*i+<span class=\"number\">1</span>)</span><br><span class=\"line\">  plot_image(i, predictions[i], test_labels, test_images)</span><br><span class=\"line\">  plt.subplot(num_rows, <span class=\"number\">2</span>*num_cols, <span class=\"number\">2</span>*i+<span class=\"number\">2</span>)</span><br><span class=\"line\">  plot_value_array(i, predictions[i], test_labels)</span><br><span class=\"line\">plt.tight_layout()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn\"></p>\n<p><strong>使用训练的模型</strong></p>\n<p>最后，利用训练好的模型对单幅图像进行预测。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Grab an image from the test dataset.</span></span><br><span class=\"line\">img = test_images[<span class=\"number\">1</span>]</span><br><span class=\"line\">print(img.shape)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(28, 28)</p>\n</blockquote>\n<p><code>tf.keras</code>模型经过优化，可以立即对一批或一组示例进行预测。因此，即使使用的是单个图像，也需要将其添加到列表中</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Add the image to a batch where it&#x27;s the only member.</span></span><br><span class=\"line\">img = (np.expand_dims(img,<span class=\"number\">0</span>))</span><br><span class=\"line\">print(img.shape)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>(1, 28, 28)</p>\n</blockquote>\n<p>现在为这个图像预测正确的标签</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">predictions_single = probability_model.predict(img)</span><br><span class=\"line\"></span><br><span class=\"line\">print(predictions_single)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>[[2.3256284e-06 5.5768194e-13 9.9955302e-01 3.3701731e-13 4.3444714e-04<br>  3.7890427e-17 1.0105057e-05 4.5671220e-20 8.4883814e-14 9.5599025e-18]]</p>\n</blockquote>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plot_value_array(<span class=\"number\">1</span>, predictions_single[<span class=\"number\">0</span>], test_labels)_ = plt.xticks(range(<span class=\"number\">10</span>), class_names, rotation=<span class=\"number\">45</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn\"></p>\n<p>keras.Model.predict返回列表的列表-数据批次中每个图像的列表。 批量获取我们（唯一）图像的预测：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.argmax(predictions_single[<span class=\"number\">0</span>])</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>2</p>\n</blockquote>\n<p>这个模型预测了一个标签。</p>\n<p>本指南使用Fashion MNIST数据集，该数据集包含10个类别中的70,000张灰度图像。这些图像以低分辨率(28×28像素)显示了衣服的单个物品，如图所示</p>\n<p><img src=\"https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn\"></p>\n<p>Fashion MNIST旨在替代经典MNIST数据集，通常被用作计算机视觉机器学习程序的“ Hello，World”。 MNIST数据集包含手写数字（0、1、2等）的图像，格式与您将在此处使用的衣服的格式相同。</p>\n<p>本指南将Fashion MNIST用于多种用途，并且因为它比常规MNIST更具挑战性。 两个数据集都相对较小，用于验证算法是否按预期工作。 它们是测试和调试代码的良好起点。</p>\n<p>在这里，使用60,000张图像来训练网络，使用10,000张图像来评估网络学习对图像进行分类的准确程度。 您可以直接从TensorFlow访问Fashion MNIST。 直接从TensorFlow导入和加载Fashion MNIST数据：</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn","popularPost_tmp_gaData":{"updated":"Thu Jun 18 2020 13:43:23 GMT+0200 (GMT+02:00)","title":"TensorFlow学习笔记","path":"2020/06/17/TensorFlow学习笔记/","eyeCatchImage":"https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-17T18:35:46.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-17T18:35:46.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["TensorFlow"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"git使用记录","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-07-11T23:03:53.000Z","password":null,"summary":"这几天在做oneindex的修改版本，对git仓库有了更多的接触。之前使用git仓库都是用来做博客的静态资源托管。最近一段日子才正式使用其作为代码仓库。","_content":"\n\n\n# 1：git指令\n\n```shell\ngit clone https://github.com/user/repo/program.git\n```\n\n将远程仓库克隆到git打开的目录。\n\n```shell\ngit switch -c dev\n```\n\n新建并切换至dev分支。\n\n```shell\ngit switch dev\n```\n\n切换到dev分支\n\n```shell\ngit add .\n```\n\n将所有变更提交至缓冲区\n\n```shell\ngit commit -m \"message\"\n```\n\n为缓冲区的变更添加更新的提示\n\n```shell\ngit push origin dev\n```\n\n将本地缓冲区的变更更新到远程仓库dev分支。\n\n```shell\ngit merge dev\n```\n\n将dev分支的内容更新至当前所在分支。\n\n```shell\ngit pull origin dev\n```\n\n拉去远程仓库dev分支的内容到本地仓库\n\n# 2：.gitignore\n\n在更新远程仓库时，可以指定部分本地仓库的文件/文件夹不推送至远程仓库。\n\n在仓库根目录下新建`.gitignore`文件，直接编辑内容即可\n\n```\n/config/*\n```\n\n忽略根目录下的/config文件夹下的所有文件。\n\n```\nconfig/*\n```\n\n忽略任意路径下的/config文件夹下的所有文件。\n\n```\n/config/*!README.md\n```\n\n忽略根目录下的/config文件夹下除README.md以外的所有文件\n\n```\n/config/README.md\n```\n\n忽略根目录下的/config文件夹下的README.md文件\n\n# 3：版本控制\n\nrelease版本，有助于保存阶段性成果。","source":"_posts/git使用记录.md","raw":"---\ntitle: git使用记录\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-07-12 01:03:53\npassword:\nsummary: 这几天在做oneindex的修改版本，对git仓库有了更多的接触。之前使用git仓库都是用来做博客的静态资源托管。最近一段日子才正式使用其作为代码仓库。\ntags: Git\ncategories: 其他\n---\n\n\n\n# 1：git指令\n\n```shell\ngit clone https://github.com/user/repo/program.git\n```\n\n将远程仓库克隆到git打开的目录。\n\n```shell\ngit switch -c dev\n```\n\n新建并切换至dev分支。\n\n```shell\ngit switch dev\n```\n\n切换到dev分支\n\n```shell\ngit add .\n```\n\n将所有变更提交至缓冲区\n\n```shell\ngit commit -m \"message\"\n```\n\n为缓冲区的变更添加更新的提示\n\n```shell\ngit push origin dev\n```\n\n将本地缓冲区的变更更新到远程仓库dev分支。\n\n```shell\ngit merge dev\n```\n\n将dev分支的内容更新至当前所在分支。\n\n```shell\ngit pull origin dev\n```\n\n拉去远程仓库dev分支的内容到本地仓库\n\n# 2：.gitignore\n\n在更新远程仓库时，可以指定部分本地仓库的文件/文件夹不推送至远程仓库。\n\n在仓库根目录下新建`.gitignore`文件，直接编辑内容即可\n\n```\n/config/*\n```\n\n忽略根目录下的/config文件夹下的所有文件。\n\n```\nconfig/*\n```\n\n忽略任意路径下的/config文件夹下的所有文件。\n\n```\n/config/*!README.md\n```\n\n忽略根目录下的/config文件夹下除README.md以外的所有文件\n\n```\n/config/README.md\n```\n\n忽略根目录下的/config文件夹下的README.md文件\n\n# 3：版本控制\n\nrelease版本，有助于保存阶段性成果。","slug":"git使用记录","published":1,"updated":"2020-07-11T17:21:18.272Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabm001op0vzgw5c8g6y","content":"<h1 id=\"1：git指令\"><a href=\"#1：git指令\" class=\"headerlink\" title=\"1：git指令\"></a>1：git指令</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/user/repo/program.git</span><br></pre></td></tr></table></figure>\n\n<p>将远程仓库克隆到git打开的目录。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git switch -c dev</span><br></pre></td></tr></table></figure>\n\n<p>新建并切换至dev分支。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git switch dev</span><br></pre></td></tr></table></figure>\n\n<p>切换到dev分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n\n<p>将所有变更提交至缓冲区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m &quot;message&quot;</span><br></pre></td></tr></table></figure>\n\n<p>为缓冲区的变更添加更新的提示</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin dev</span><br></pre></td></tr></table></figure>\n\n<p>将本地缓冲区的变更更新到远程仓库dev分支。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge dev</span><br></pre></td></tr></table></figure>\n\n<p>将dev分支的内容更新至当前所在分支。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull origin dev</span><br></pre></td></tr></table></figure>\n\n<p>拉去远程仓库dev分支的内容到本地仓库</p>\n<h1 id=\"2：-gitignore\"><a href=\"#2：-gitignore\" class=\"headerlink\" title=\"2：.gitignore\"></a>2：.gitignore</h1><p>在更新远程仓库时，可以指定部分本地仓库的文件/文件夹不推送至远程仓库。</p>\n<p>在仓库根目录下新建<code>.gitignore</code>文件，直接编辑内容即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;config&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<p>忽略根目录下的/config文件夹下的所有文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<p>忽略任意路径下的/config文件夹下的所有文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;config&#x2F;*!README.md</span><br></pre></td></tr></table></figure>\n\n<p>忽略根目录下的/config文件夹下除README.md以外的所有文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;config&#x2F;README.md</span><br></pre></td></tr></table></figure>\n\n<p>忽略根目录下的/config文件夹下的README.md文件</p>\n<h1 id=\"3：版本控制\"><a href=\"#3：版本控制\" class=\"headerlink\" title=\"3：版本控制\"></a>3：版本控制</h1><p>release版本，有助于保存阶段性成果。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：git指令\"><a href=\"#1：git指令\" class=\"headerlink\" title=\"1：git指令\"></a>1：git指令</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/user/repo/program.git</span><br></pre></td></tr></table></figure>\n\n<p>将远程仓库克隆到git打开的目录。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git switch -c dev</span><br></pre></td></tr></table></figure>\n\n<p>新建并切换至dev分支。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git switch dev</span><br></pre></td></tr></table></figure>\n\n<p>切换到dev分支</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n\n<p>将所有变更提交至缓冲区</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m &quot;message&quot;</span><br></pre></td></tr></table></figure>\n\n<p>为缓冲区的变更添加更新的提示</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin dev</span><br></pre></td></tr></table></figure>\n\n<p>将本地缓冲区的变更更新到远程仓库dev分支。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge dev</span><br></pre></td></tr></table></figure>\n\n<p>将dev分支的内容更新至当前所在分支。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull origin dev</span><br></pre></td></tr></table></figure>\n\n<p>拉去远程仓库dev分支的内容到本地仓库</p>\n<h1 id=\"2：-gitignore\"><a href=\"#2：-gitignore\" class=\"headerlink\" title=\"2：.gitignore\"></a>2：.gitignore</h1><p>在更新远程仓库时，可以指定部分本地仓库的文件/文件夹不推送至远程仓库。</p>\n<p>在仓库根目录下新建<code>.gitignore</code>文件，直接编辑内容即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;config&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<p>忽略根目录下的/config文件夹下的所有文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config&#x2F;*</span><br></pre></td></tr></table></figure>\n\n<p>忽略任意路径下的/config文件夹下的所有文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;config&#x2F;*!README.md</span><br></pre></td></tr></table></figure>\n\n<p>忽略根目录下的/config文件夹下除README.md以外的所有文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;config&#x2F;README.md</span><br></pre></td></tr></table></figure>\n\n<p>忽略根目录下的/config文件夹下的README.md文件</p>\n<h1 id=\"3：版本控制\"><a href=\"#3：版本控制\" class=\"headerlink\" title=\"3：版本控制\"></a>3：版本控制</h1><p>release版本，有助于保存阶段性成果。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jul 11 2020 19:21:18 GMT+0200 (GMT+02:00)","title":"git使用记录","path":"2020/07/12/git使用记录/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-07-11T23:03:53.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-11T23:03:53.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"其他","tags":["Git"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"httponly的Cookie","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-07-22T15:24:14.000Z","password":null,"summary":"今天打算写一个网站的爬虫，但是网站需要登陆才能爬取，我想可以直接发送cookie而跳过登陆，但是在浏览器端使用JS指令获取cookie时，居然是空。然后查阅资料后，了解了cookie还存在一种httponly形式的cookie。","_content":"\n\n\n\n\nJS获取cookie的程序是`document.cookie`，但是为了网站安全。服务器可以设置某些cookie不能使用js获取。这种类型的cookie即使httponly的cookie，而且只有服务器能发送此类cookie。\n\n```php\nsetcookie(\"abc\", \"test\", NULL, NULL, NULL, NULL, TRUE); \n```\n\n在最新php中设置cookie的httponly属性，需要将第七个值设置为true。\n\n在浏览器如何获取httponly属性的cookie呢。需要进入控制台，打开`Application`\n\n![image-20200722173318918](https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png)\n\n设置httponly属性，对于cookie安全非常重要，这样可以防止XSS攻击，攻击者通过植入JS代码，获取网站的cookie，从而以用户身份浏览服务器。\n\n另外设置cookie过期时间与会话Session时间相同，也能有效保护用户信息安全。","source":"_posts/httponly的Cookie.md","raw":"---\ntitle: httponly的Cookie\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-07-22 17:24:14\npassword:\nsummary: 今天打算写一个网站的爬虫，但是网站需要登陆才能爬取，我想可以直接发送cookie而跳过登陆，但是在浏览器端使用JS指令获取cookie时，居然是空。然后查阅资料后，了解了cookie还存在一种httponly形式的cookie。\ntags: Cookie\ncategories: 网站编程\n---\n\n\n\n\n\nJS获取cookie的程序是`document.cookie`，但是为了网站安全。服务器可以设置某些cookie不能使用js获取。这种类型的cookie即使httponly的cookie，而且只有服务器能发送此类cookie。\n\n```php\nsetcookie(\"abc\", \"test\", NULL, NULL, NULL, NULL, TRUE); \n```\n\n在最新php中设置cookie的httponly属性，需要将第七个值设置为true。\n\n在浏览器如何获取httponly属性的cookie呢。需要进入控制台，打开`Application`\n\n![image-20200722173318918](https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png)\n\n设置httponly属性，对于cookie安全非常重要，这样可以防止XSS攻击，攻击者通过植入JS代码，获取网站的cookie，从而以用户身份浏览服务器。\n\n另外设置cookie过期时间与会话Session时间相同，也能有效保护用户信息安全。","slug":"httponly的Cookie","published":1,"updated":"2020-07-22T09:34:59.990Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabp001sp0vz6oub185t","content":"<p>JS获取cookie的程序是<code>document.cookie</code>，但是为了网站安全。服务器可以设置某些cookie不能使用js获取。这种类型的cookie即使httponly的cookie，而且只有服务器能发送此类cookie。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setcookie(<span class=\"string\">&quot;abc&quot;</span>, <span class=\"string\">&quot;test&quot;</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">TRUE</span>); </span><br></pre></td></tr></table></figure>\n\n<p>在最新php中设置cookie的httponly属性，需要将第七个值设置为true。</p>\n<p>在浏览器如何获取httponly属性的cookie呢。需要进入控制台，打开<code>Application</code></p>\n<p><img src=\"https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200722173318918\"></p>\n<p>设置httponly属性，对于cookie安全非常重要，这样可以防止XSS攻击，攻击者通过植入JS代码，获取网站的cookie，从而以用户身份浏览服务器。</p>\n<p>另外设置cookie过期时间与会话Session时间相同，也能有效保护用户信息安全。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>JS获取cookie的程序是<code>document.cookie</code>，但是为了网站安全。服务器可以设置某些cookie不能使用js获取。这种类型的cookie即使httponly的cookie，而且只有服务器能发送此类cookie。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setcookie(<span class=\"string\">&quot;abc&quot;</span>, <span class=\"string\">&quot;test&quot;</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">TRUE</span>); </span><br></pre></td></tr></table></figure>\n\n<p>在最新php中设置cookie的httponly属性，需要将第七个值设置为true。</p>\n<p>在浏览器如何获取httponly属性的cookie呢。需要进入控制台，打开<code>Application</code></p>\n<p><img src=\"https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png\" alt=\"image-20200722173318918\"></p>\n<p>设置httponly属性，对于cookie安全非常重要，这样可以防止XSS攻击，攻击者通过植入JS代码，获取网站的cookie，从而以用户身份浏览服务器。</p>\n<p>另外设置cookie过期时间与会话Session时间相同，也能有效保护用户信息安全。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png","popularPost_tmp_gaData":{"updated":"Wed Jul 22 2020 11:34:59 GMT+0200 (GMT+02:00)","title":"httponly的Cookie","path":"2020/07/22/httponly的Cookie/","eyeCatchImage":"https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-07-22T15:24:14.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-22T15:24:14.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["Cookie"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"亚琛工大教学视频添加中德字幕","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-05-27T20:02:51.000Z","password":null,"summary":null,"_content":"\n# 第一章 插件用户手册\n\n## 1.1 适用场景和功能说明\n\n1. 本插件适用于基于chromium内核开发的浏览器，包括**Chrome浏览器、360安全浏览器、QQ浏览器**等。\n2. 插件只在满足**https://\\*/rwth-aachen.de/\\***域名**匹配**时工作，且除了添加字幕外无其他功能。\n3. 支持**德语、中文、双语**字幕\n4. 插件只能为**数据库里存在的视频**资源**添加字幕**。更多视频字幕，会逐渐上传。\n\n## 1.2 效果图预览\n\n以下仅展示了双语字幕。\n\n![](https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png)\n\n## 1.3 插件安装\n\n1. 下载插件https://lanzous.com/ick15oh\n\n2. 解压插件到桌面。获得以captions-for-moodle为名的文件夹。\n\n   ![](https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg)\n\n3. 打开chrome浏览器，依次点击右上角的三个点图标—>更多工具—>扩展程序。或者在地址栏输入`chrome://extensions/`以打开扩展程序。\n\n   ![](https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg)\n\n4. 单击打开扩展程序右上角的开发者选项。\n\n![](https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg)\n\n然后开发者模式下方将出现`加载已解压的扩展程序`。\n\n![](https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg)\n\n5. 点击**加载已解压的扩展程序**，在弹出页面，选择名称为`captions-for-moodle`文件夹。点击**选择文件夹**。此时页面出现Captions for Moodle RWTH 1.0插件。\n\n![](https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg)\n\n6. 至此插件安装完成，确认插件卡片里的选择按钮为蓝色，表示插件已激活。插件激活后，在浏览器右上角，将出现RWTH的图标。\n\n![](https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg)\n\n且当你打开，`moodle.rwth-aachen.de`时，页面出现绿色浮动按钮。\n\n![](https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg)\n\n## 1.4 插件使用\n\n1. 打开moodle课程视频页面，页面出现绿色悬浮按钮。\n\n![](https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg)\n\n2. 点击播放视频，直到**视频**加载成功且**开始播放**，**单击**绿色悬浮**按钮**，！重要，**等待几秒钟**。待字幕下载完毕，会自动加载到视频上。\n\n![](https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg)\n\n3. 下载完毕的字幕，**默认为德语字幕**，**再次单击**绿色按钮，切换**中文**字幕；再次单击，切换双语字幕；再次单击清除字幕。依次循环。\n\n4. 若当前视频还没有上传字幕，视频字幕会显示\n\n![](https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg)\n\n在出现此字幕时，单击三次按钮，即此清除字幕或当视频播放到两分钟时自动清除。\n\n5. 下载字幕到本地\n\n如果当前视频存在字幕，待页面加载完毕后，点击浏览器右上角插件图标，即可看到字幕下载链接和视频下载链接。\n\n![](https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg)\n\n## 1.5 其他说明\n\n目前已支持的课程有\n\n- Bioenergie\n- Grundoperationen der Energietechnik (VO)\n- Petrochemie und Raffinerietechnik (VU)\n- 待添加\n\n# 第二章 教学视频下载和字幕转换\n\n## 2.1 系统要求和网络要求\n\n插件用户安装我提供的视频下载和字幕转换工具。插件没提供的字幕，用户可自行本地转换，字幕转换成功后，可通过上传接口，将转换的字幕共享给每一位使用插件的用户。\n\n1. 系统要求\n\n此教程仅**适用于windows系统**，若有需求，后续可出Ubuntu系统教程。Mac系统暂不支持。\n\n2. 网络要求⭐\n\n- **软件的安装需要连接外网！**\n- **视频下载不需要连接外网！**\n\n- **生成字幕需连接外网！**字幕转换将请求谷歌的文字翻译API接口。请确保你在进行本章**第5节**内容，即获取字幕时，满足以下两种条件：\n  - 用户电脑网络处于除中国大陆以外的地区。\n  - 用户连接网速较好的VPN网络。**注意：VPN网络不佳，将使字幕转换出现中断。**\n\n## 2.2 软件环境搭建\n\n1. 打开命令管理器。\n\n打开windows桌面右上角搜索功能\n\n![](https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg)\n\n在搜索框输入cmd，并点击“以管理员身份运行”。\n\n![](https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg)\n\n打开后如图。注意：命令行开头是：C:\\WINDOWS\\system32\n\n![](https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg)\n\n2. 安装包管理器chocolatey\n\n**复制以下**指令\n\n```\n@\"%SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command \"iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))\" && SET \"PATH=%PATH%;%ALLUSERSPROFILE%\\chocolatey\\bin\"\n```\n\n⭐⭐⭐**温馨提示：命令提示符里，使用右键单击即可复制和粘贴！**\n\n在命令框里，**右键单击**。如图，然后回车运行。等待安装完成。\n\n![](https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg)\n\n通常，未出现红色提示，则表示安装成功。\n\n当然为了确保成功安装，你可以通过在命令提示符里输入指令，注意V是大写\n\n```\nchoco -V\n```\n\n输出**绿色版本号**。则安装成功，例如:0.10.15。\n\n![](https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg)\n\n3. 安装 git python curl ffmpeg。\n\n```\nchoco install git python curl ffmpeg -y\n```\n\n此安装过程较长，且取决于你当前所处网络环境。请耐心等待，保持电脑激活状态。\n\n安装过程中，未提示红色字体，则表示安装成功。\n\n⭐⭐安装完成后，**退出cmd**，**重新**用管理员权限**打开**，以刷新git、python等的环境变量。\n\n可选：你可通过分别输入`git --version`，`python -V`,`curl -V`，`ffmpeg -V`。依次查看这几个软件是否安装成功，若出现版本号则表示安装成功。\n\n如果某个程序没有安装上，比如python，你可单独使用指令 `choco install python -y`来安装。安装完成后需重启cmd，才能使用`python -V`指令查看版本信息。\n\n4. 下载python程序并安装，⭐此步骤需要**连接外网**，否则会报错\n\n```\npython get-pip.py\npip install git+https://github.com/BingLingGroup/autosub.git@alpha ffmpeg-normalize langcodes\n```\n\n5. 安装成功。输入指令\n\n   ```\n   autosub -V\n   ```\n\n   显示版本号，则安装成功。\n\n![](https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg)\n\n6. 若出现错误提示如下图\n\n![](https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg)\n\n可能是你系统的未安装**Microsoft Visual C++ 14.0**。\n\n打开连接\n\nhttps://964279924.ctfile.com/fs/1445568-239446865\n\n下载**安装VC++**。安装后，**重复第4步**。\n\n## **2.3 获得**视频地址\n\n视频下载地址，将在第一章，1.4节插件使用中有详细介绍。\n\n在打开视频地址后，点击右上角插件图标，即可看到视频下载地址的url。\n\n## 2.4 下载视频\n\n如果你**需要转换字幕，**请**跳过此节**，下节内容，将包括视频的下载和字幕转换。\n\n如果你只想下载视频，而不需要转换字幕，请看此章。\n\n1. 你已经安装了第二节提供的软件，并在第三节**获取到了视频的下载地址**，那么在这节，你将知道，如何利用ffmpeg工具，将m3u8文件转为mp4格式视频。关于m3u8文件，可看本节补充说明。\n2. 打开**命令提示符**，无需用管理员权限打开！在搜索栏输入`cmd`。双击打开。\n\n![](https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg)\n\n3. 复制以下代码，在cmd窗口右键单击，然后回车运行。\n\n```\ncd %USERPROFILE%\\Desktop && curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat && call getcaptions.bat\n```\n\n4. 在选择操作时，输入**2：网络下载视频，但不生成字幕**，\n\n![](https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg)\n\n5. 在输入视频的网络地址里，输入2.3节获取的，以.m3u8结尾的链接。然后回车\n\n![](https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg)\n\n6. 输入保存视频和字幕的地址，这里直接回车，将字幕保存到桌面。此时，软件开始工作。\n\n![](https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg)\n\n![](https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg)\n\n补充说明：m3u8是一个视频片段的地址列表，利用视频处理工具，读取这个地址表，将切割成片段的ts格式视频拼接成一个ts格式视频，在将ts格式视频转化为mp4格式。\n\n## 2.5 转换字幕和上传字幕\n\n⭐请注意，执行本节内容之前，请确保，你的网络已连接外网，并且能打开`https://www.google.com`，否则将无法进行字幕转换操作。\n\n字幕上传功能，仅在你使用此脚本的选项“网络下载视频，并生成中德字幕”时启用。\n\n1. 搜索并打开cmd命令提示符\n\n2. 输入以下命令，下载并执行批处理脚本\n\n```bash\ncd %USERPROFILE%\\Desktop && curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat && call getcaptions.bat\n```\n\n![](https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg)\n\n3. 按照提示开始选择指令。直接回车。选择1：网络下载视频，并生成中德字幕。\n\n![](https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg)\n\n4. 填写视频的下载链接，参照**第三节**内容，复制第三节获取到的视频链接。直接在cmd窗口上右键单击，即可粘贴。\n\n![](https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg)\n\n链接例子：`https://streaming.rwth-aachen.de/rwth/smil:engage-player_0fe26b35-3e44-47f0-acf6-a9c4fd05b0bc_presentation.smil/playlist.m3u8`\n\n![](https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg)\n\n5. 填写视频和字幕的保存地址。直接回车，默认保存到桌面。\n\n![](https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg)\n\n6. 程序将自动开始运行，现在，你可以去泡杯茶，等待视频和字幕转换完成。\n\n![](https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg)\n\n7. 字幕转换完成，检查字幕文件是否正确无误，然后继续回车上传字幕。\n\n出现字幕上传成功字样，则字幕已更新至服务器，可通过插件在线给视频添加字幕，其他用户也可以点击右上角插件按钮下载字幕。\n\n8. 下次运行脚本，可以直接在桌面双击打开`getcaptions.bat`文件,而无需再次下载此脚本。若脚本有更新，可执行步骤2的代码。\n\n","source":"_posts/亚琛工大教学视频添加中德字幕.md","raw":"---\ntitle: 亚琛工大教学视频添加中德字幕\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-05-27 22:02:51\npassword:\nsummary:\ntags: 浏览器插件\ncategories: 其他\n---\n\n# 第一章 插件用户手册\n\n## 1.1 适用场景和功能说明\n\n1. 本插件适用于基于chromium内核开发的浏览器，包括**Chrome浏览器、360安全浏览器、QQ浏览器**等。\n2. 插件只在满足**https://\\*/rwth-aachen.de/\\***域名**匹配**时工作，且除了添加字幕外无其他功能。\n3. 支持**德语、中文、双语**字幕\n4. 插件只能为**数据库里存在的视频**资源**添加字幕**。更多视频字幕，会逐渐上传。\n\n## 1.2 效果图预览\n\n以下仅展示了双语字幕。\n\n![](https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png)\n\n## 1.3 插件安装\n\n1. 下载插件https://lanzous.com/ick15oh\n\n2. 解压插件到桌面。获得以captions-for-moodle为名的文件夹。\n\n   ![](https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg)\n\n3. 打开chrome浏览器，依次点击右上角的三个点图标—>更多工具—>扩展程序。或者在地址栏输入`chrome://extensions/`以打开扩展程序。\n\n   ![](https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg)\n\n4. 单击打开扩展程序右上角的开发者选项。\n\n![](https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg)\n\n然后开发者模式下方将出现`加载已解压的扩展程序`。\n\n![](https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg)\n\n5. 点击**加载已解压的扩展程序**，在弹出页面，选择名称为`captions-for-moodle`文件夹。点击**选择文件夹**。此时页面出现Captions for Moodle RWTH 1.0插件。\n\n![](https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg)\n\n6. 至此插件安装完成，确认插件卡片里的选择按钮为蓝色，表示插件已激活。插件激活后，在浏览器右上角，将出现RWTH的图标。\n\n![](https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg)\n\n且当你打开，`moodle.rwth-aachen.de`时，页面出现绿色浮动按钮。\n\n![](https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg)\n\n## 1.4 插件使用\n\n1. 打开moodle课程视频页面，页面出现绿色悬浮按钮。\n\n![](https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg)\n\n2. 点击播放视频，直到**视频**加载成功且**开始播放**，**单击**绿色悬浮**按钮**，！重要，**等待几秒钟**。待字幕下载完毕，会自动加载到视频上。\n\n![](https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg)\n\n3. 下载完毕的字幕，**默认为德语字幕**，**再次单击**绿色按钮，切换**中文**字幕；再次单击，切换双语字幕；再次单击清除字幕。依次循环。\n\n4. 若当前视频还没有上传字幕，视频字幕会显示\n\n![](https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg)\n\n在出现此字幕时，单击三次按钮，即此清除字幕或当视频播放到两分钟时自动清除。\n\n5. 下载字幕到本地\n\n如果当前视频存在字幕，待页面加载完毕后，点击浏览器右上角插件图标，即可看到字幕下载链接和视频下载链接。\n\n![](https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg)\n\n## 1.5 其他说明\n\n目前已支持的课程有\n\n- Bioenergie\n- Grundoperationen der Energietechnik (VO)\n- Petrochemie und Raffinerietechnik (VU)\n- 待添加\n\n# 第二章 教学视频下载和字幕转换\n\n## 2.1 系统要求和网络要求\n\n插件用户安装我提供的视频下载和字幕转换工具。插件没提供的字幕，用户可自行本地转换，字幕转换成功后，可通过上传接口，将转换的字幕共享给每一位使用插件的用户。\n\n1. 系统要求\n\n此教程仅**适用于windows系统**，若有需求，后续可出Ubuntu系统教程。Mac系统暂不支持。\n\n2. 网络要求⭐\n\n- **软件的安装需要连接外网！**\n- **视频下载不需要连接外网！**\n\n- **生成字幕需连接外网！**字幕转换将请求谷歌的文字翻译API接口。请确保你在进行本章**第5节**内容，即获取字幕时，满足以下两种条件：\n  - 用户电脑网络处于除中国大陆以外的地区。\n  - 用户连接网速较好的VPN网络。**注意：VPN网络不佳，将使字幕转换出现中断。**\n\n## 2.2 软件环境搭建\n\n1. 打开命令管理器。\n\n打开windows桌面右上角搜索功能\n\n![](https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg)\n\n在搜索框输入cmd，并点击“以管理员身份运行”。\n\n![](https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg)\n\n打开后如图。注意：命令行开头是：C:\\WINDOWS\\system32\n\n![](https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg)\n\n2. 安装包管理器chocolatey\n\n**复制以下**指令\n\n```\n@\"%SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command \"iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))\" && SET \"PATH=%PATH%;%ALLUSERSPROFILE%\\chocolatey\\bin\"\n```\n\n⭐⭐⭐**温馨提示：命令提示符里，使用右键单击即可复制和粘贴！**\n\n在命令框里，**右键单击**。如图，然后回车运行。等待安装完成。\n\n![](https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg)\n\n通常，未出现红色提示，则表示安装成功。\n\n当然为了确保成功安装，你可以通过在命令提示符里输入指令，注意V是大写\n\n```\nchoco -V\n```\n\n输出**绿色版本号**。则安装成功，例如:0.10.15。\n\n![](https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg)\n\n3. 安装 git python curl ffmpeg。\n\n```\nchoco install git python curl ffmpeg -y\n```\n\n此安装过程较长，且取决于你当前所处网络环境。请耐心等待，保持电脑激活状态。\n\n安装过程中，未提示红色字体，则表示安装成功。\n\n⭐⭐安装完成后，**退出cmd**，**重新**用管理员权限**打开**，以刷新git、python等的环境变量。\n\n可选：你可通过分别输入`git --version`，`python -V`,`curl -V`，`ffmpeg -V`。依次查看这几个软件是否安装成功，若出现版本号则表示安装成功。\n\n如果某个程序没有安装上，比如python，你可单独使用指令 `choco install python -y`来安装。安装完成后需重启cmd，才能使用`python -V`指令查看版本信息。\n\n4. 下载python程序并安装，⭐此步骤需要**连接外网**，否则会报错\n\n```\npython get-pip.py\npip install git+https://github.com/BingLingGroup/autosub.git@alpha ffmpeg-normalize langcodes\n```\n\n5. 安装成功。输入指令\n\n   ```\n   autosub -V\n   ```\n\n   显示版本号，则安装成功。\n\n![](https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg)\n\n6. 若出现错误提示如下图\n\n![](https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg)\n\n可能是你系统的未安装**Microsoft Visual C++ 14.0**。\n\n打开连接\n\nhttps://964279924.ctfile.com/fs/1445568-239446865\n\n下载**安装VC++**。安装后，**重复第4步**。\n\n## **2.3 获得**视频地址\n\n视频下载地址，将在第一章，1.4节插件使用中有详细介绍。\n\n在打开视频地址后，点击右上角插件图标，即可看到视频下载地址的url。\n\n## 2.4 下载视频\n\n如果你**需要转换字幕，**请**跳过此节**，下节内容，将包括视频的下载和字幕转换。\n\n如果你只想下载视频，而不需要转换字幕，请看此章。\n\n1. 你已经安装了第二节提供的软件，并在第三节**获取到了视频的下载地址**，那么在这节，你将知道，如何利用ffmpeg工具，将m3u8文件转为mp4格式视频。关于m3u8文件，可看本节补充说明。\n2. 打开**命令提示符**，无需用管理员权限打开！在搜索栏输入`cmd`。双击打开。\n\n![](https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg)\n\n3. 复制以下代码，在cmd窗口右键单击，然后回车运行。\n\n```\ncd %USERPROFILE%\\Desktop && curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat && call getcaptions.bat\n```\n\n4. 在选择操作时，输入**2：网络下载视频，但不生成字幕**，\n\n![](https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg)\n\n5. 在输入视频的网络地址里，输入2.3节获取的，以.m3u8结尾的链接。然后回车\n\n![](https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg)\n\n6. 输入保存视频和字幕的地址，这里直接回车，将字幕保存到桌面。此时，软件开始工作。\n\n![](https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg)\n\n![](https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg)\n\n补充说明：m3u8是一个视频片段的地址列表，利用视频处理工具，读取这个地址表，将切割成片段的ts格式视频拼接成一个ts格式视频，在将ts格式视频转化为mp4格式。\n\n## 2.5 转换字幕和上传字幕\n\n⭐请注意，执行本节内容之前，请确保，你的网络已连接外网，并且能打开`https://www.google.com`，否则将无法进行字幕转换操作。\n\n字幕上传功能，仅在你使用此脚本的选项“网络下载视频，并生成中德字幕”时启用。\n\n1. 搜索并打开cmd命令提示符\n\n2. 输入以下命令，下载并执行批处理脚本\n\n```bash\ncd %USERPROFILE%\\Desktop && curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat && call getcaptions.bat\n```\n\n![](https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg)\n\n3. 按照提示开始选择指令。直接回车。选择1：网络下载视频，并生成中德字幕。\n\n![](https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg)\n\n4. 填写视频的下载链接，参照**第三节**内容，复制第三节获取到的视频链接。直接在cmd窗口上右键单击，即可粘贴。\n\n![](https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg)\n\n链接例子：`https://streaming.rwth-aachen.de/rwth/smil:engage-player_0fe26b35-3e44-47f0-acf6-a9c4fd05b0bc_presentation.smil/playlist.m3u8`\n\n![](https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg)\n\n5. 填写视频和字幕的保存地址。直接回车，默认保存到桌面。\n\n![](https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg)\n\n6. 程序将自动开始运行，现在，你可以去泡杯茶，等待视频和字幕转换完成。\n\n![](https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg)\n\n7. 字幕转换完成，检查字幕文件是否正确无误，然后继续回车上传字幕。\n\n出现字幕上传成功字样，则字幕已更新至服务器，可通过插件在线给视频添加字幕，其他用户也可以点击右上角插件按钮下载字幕。\n\n8. 下次运行脚本，可以直接在桌面双击打开`getcaptions.bat`文件,而无需再次下载此脚本。若脚本有更新，可执行步骤2的代码。\n\n","slug":"亚琛工大教学视频添加中德字幕","published":1,"updated":"2020-06-20T06:47:39.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabs001vp0vzb1dy9tql","content":"<h1 id=\"第一章-插件用户手册\"><a href=\"#第一章-插件用户手册\" class=\"headerlink\" title=\"第一章 插件用户手册\"></a>第一章 插件用户手册</h1><h2 id=\"1-1-适用场景和功能说明\"><a href=\"#1-1-适用场景和功能说明\" class=\"headerlink\" title=\"1.1 适用场景和功能说明\"></a>1.1 适用场景和功能说明</h2><ol>\n<li>本插件适用于基于chromium内核开发的浏览器，包括<strong>Chrome浏览器、360安全浏览器、QQ浏览器</strong>等。</li>\n<li>插件只在满足<strong>https://*/rwth-aachen.de/*</strong>域名<strong>匹配</strong>时工作，且除了添加字幕外无其他功能。</li>\n<li>支持<strong>德语、中文、双语</strong>字幕</li>\n<li>插件只能为<strong>数据库里存在的视频</strong>资源<strong>添加字幕</strong>。更多视频字幕，会逐渐上传。</li>\n</ol>\n<h2 id=\"1-2-效果图预览\"><a href=\"#1-2-效果图预览\" class=\"headerlink\" title=\"1.2 效果图预览\"></a>1.2 效果图预览</h2><p>以下仅展示了双语字幕。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"1-3-插件安装\"><a href=\"#1-3-插件安装\" class=\"headerlink\" title=\"1.3 插件安装\"></a>1.3 插件安装</h2><ol>\n<li><p>下载插件<a href=\"https://lanzous.com/ick15oh\">https://lanzous.com/ick15oh</a></p>\n</li>\n<li><p>解压插件到桌面。获得以captions-for-moodle为名的文件夹。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n</li>\n<li><p>打开chrome浏览器，依次点击右上角的三个点图标—&gt;更多工具—&gt;扩展程序。或者在地址栏输入<code>chrome://extensions/</code>以打开扩展程序。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n</li>\n<li><p>单击打开扩展程序右上角的开发者选项。</p>\n</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>然后开发者模式下方将出现<code>加载已解压的扩展程序</code>。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"5\">\n<li>点击<strong>加载已解压的扩展程序</strong>，在弹出页面，选择名称为<code>captions-for-moodle</code>文件夹。点击<strong>选择文件夹</strong>。此时页面出现Captions for Moodle RWTH 1.0插件。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"6\">\n<li>至此插件安装完成，确认插件卡片里的选择按钮为蓝色，表示插件已激活。插件激活后，在浏览器右上角，将出现RWTH的图标。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>且当你打开，<code>moodle.rwth-aachen.de</code>时，页面出现绿色浮动按钮。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"1-4-插件使用\"><a href=\"#1-4-插件使用\" class=\"headerlink\" title=\"1.4 插件使用\"></a>1.4 插件使用</h2><ol>\n<li>打开moodle课程视频页面，页面出现绿色悬浮按钮。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"2\">\n<li>点击播放视频，直到<strong>视频</strong>加载成功且<strong>开始播放</strong>，<strong>单击</strong>绿色悬浮<strong>按钮</strong>，！重要，<strong>等待几秒钟</strong>。待字幕下载完毕，会自动加载到视频上。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li><p>下载完毕的字幕，<strong>默认为德语字幕</strong>，<strong>再次单击</strong>绿色按钮，切换<strong>中文</strong>字幕；再次单击，切换双语字幕；再次单击清除字幕。依次循环。</p>\n</li>\n<li><p>若当前视频还没有上传字幕，视频字幕会显示</p>\n</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>在出现此字幕时，单击三次按钮，即此清除字幕或当视频播放到两分钟时自动清除。</p>\n<ol start=\"5\">\n<li>下载字幕到本地</li>\n</ol>\n<p>如果当前视频存在字幕，待页面加载完毕后，点击浏览器右上角插件图标，即可看到字幕下载链接和视频下载链接。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"1-5-其他说明\"><a href=\"#1-5-其他说明\" class=\"headerlink\" title=\"1.5 其他说明\"></a>1.5 其他说明</h2><p>目前已支持的课程有</p>\n<ul>\n<li>Bioenergie</li>\n<li>Grundoperationen der Energietechnik (VO)</li>\n<li>Petrochemie und Raffinerietechnik (VU)</li>\n<li>待添加</li>\n</ul>\n<h1 id=\"第二章-教学视频下载和字幕转换\"><a href=\"#第二章-教学视频下载和字幕转换\" class=\"headerlink\" title=\"第二章 教学视频下载和字幕转换\"></a>第二章 教学视频下载和字幕转换</h1><h2 id=\"2-1-系统要求和网络要求\"><a href=\"#2-1-系统要求和网络要求\" class=\"headerlink\" title=\"2.1 系统要求和网络要求\"></a>2.1 系统要求和网络要求</h2><p>插件用户安装我提供的视频下载和字幕转换工具。插件没提供的字幕，用户可自行本地转换，字幕转换成功后，可通过上传接口，将转换的字幕共享给每一位使用插件的用户。</p>\n<ol>\n<li>系统要求</li>\n</ol>\n<p>此教程仅<strong>适用于windows系统</strong>，若有需求，后续可出Ubuntu系统教程。Mac系统暂不支持。</p>\n<ol start=\"2\">\n<li>网络要求⭐</li>\n</ol>\n<ul>\n<li><p><strong>软件的安装需要连接外网！</strong></p>\n</li>\n<li><p><strong>视频下载不需要连接外网！</strong></p>\n</li>\n<li><p><strong>生成字幕需连接外网！</strong>字幕转换将请求谷歌的文字翻译API接口。请确保你在进行本章<strong>第5节</strong>内容，即获取字幕时，满足以下两种条件：</p>\n<ul>\n<li>用户电脑网络处于除中国大陆以外的地区。</li>\n<li>用户连接网速较好的VPN网络。<strong>注意：VPN网络不佳，将使字幕转换出现中断。</strong></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-2-软件环境搭建\"><a href=\"#2-2-软件环境搭建\" class=\"headerlink\" title=\"2.2 软件环境搭建\"></a>2.2 软件环境搭建</h2><ol>\n<li>打开命令管理器。</li>\n</ol>\n<p>打开windows桌面右上角搜索功能</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>在搜索框输入cmd，并点击“以管理员身份运行”。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>打开后如图。注意：命令行开头是：C:\\WINDOWS\\system32</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"2\">\n<li>安装包管理器chocolatey</li>\n</ol>\n<p><strong>复制以下</strong>指令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@&quot;%SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe&quot; -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command &quot;iex ((New-Object System.Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;chocolatey.org&#x2F;install.ps1&#39;))&quot; &amp;&amp; SET &quot;PATH&#x3D;%PATH%;%ALLUSERSPROFILE%\\chocolatey\\bin&quot;</span><br></pre></td></tr></table></figure>\n\n<p>⭐⭐⭐<strong>温馨提示：命令提示符里，使用右键单击即可复制和粘贴！</strong></p>\n<p>在命令框里，<strong>右键单击</strong>。如图，然后回车运行。等待安装完成。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>通常，未出现红色提示，则表示安装成功。</p>\n<p>当然为了确保成功安装，你可以通过在命令提示符里输入指令，注意V是大写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco -V</span><br></pre></td></tr></table></figure>\n\n<p>输出<strong>绿色版本号</strong>。则安装成功，例如:0.10.15。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li>安装 git python curl ffmpeg。</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco install git python curl ffmpeg -y</span><br></pre></td></tr></table></figure>\n\n<p>此安装过程较长，且取决于你当前所处网络环境。请耐心等待，保持电脑激活状态。</p>\n<p>安装过程中，未提示红色字体，则表示安装成功。</p>\n<p>⭐⭐安装完成后，<strong>退出cmd</strong>，<strong>重新</strong>用管理员权限<strong>打开</strong>，以刷新git、python等的环境变量。</p>\n<p>可选：你可通过分别输入<code>git --version</code>，<code>python -V</code>,<code>curl -V</code>，<code>ffmpeg -V</code>。依次查看这几个软件是否安装成功，若出现版本号则表示安装成功。</p>\n<p>如果某个程序没有安装上，比如python，你可单独使用指令 <code>choco install python -y</code>来安装。安装完成后需重启cmd，才能使用<code>python -V</code>指令查看版本信息。</p>\n<ol start=\"4\">\n<li>下载python程序并安装，⭐此步骤需要<strong>连接外网</strong>，否则会报错</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python get-pip.py</span><br><span class=\"line\">pip install git+https:&#x2F;&#x2F;github.com&#x2F;BingLingGroup&#x2F;autosub.git@alpha ffmpeg-normalize langcodes</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li><p>安装成功。输入指令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">autosub -V</span><br></pre></td></tr></table></figure>\n\n<p>显示版本号，则安装成功。</p>\n</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"6\">\n<li>若出现错误提示如下图</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>可能是你系统的未安装<strong>Microsoft Visual C++ 14.0</strong>。</p>\n<p>打开连接</p>\n<p><a href=\"https://964279924.ctfile.com/fs/1445568-239446865\">https://964279924.ctfile.com/fs/1445568-239446865</a></p>\n<p>下载<strong>安装VC++**。安装后，</strong>重复第4步**。</p>\n<h2 id=\"2-3-获得视频地址\"><a href=\"#2-3-获得视频地址\" class=\"headerlink\" title=\"2.3 获得视频地址\"></a><strong>2.3 获得</strong>视频地址</h2><p>视频下载地址，将在第一章，1.4节插件使用中有详细介绍。</p>\n<p>在打开视频地址后，点击右上角插件图标，即可看到视频下载地址的url。</p>\n<h2 id=\"2-4-下载视频\"><a href=\"#2-4-下载视频\" class=\"headerlink\" title=\"2.4 下载视频\"></a>2.4 下载视频</h2><p>如果你<strong>需要转换字幕，</strong>请<strong>跳过此节</strong>，下节内容，将包括视频的下载和字幕转换。</p>\n<p>如果你只想下载视频，而不需要转换字幕，请看此章。</p>\n<ol>\n<li>你已经安装了第二节提供的软件，并在第三节<strong>获取到了视频的下载地址</strong>，那么在这节，你将知道，如何利用ffmpeg工具，将m3u8文件转为mp4格式视频。关于m3u8文件，可看本节补充说明。</li>\n<li>打开<strong>命令提示符</strong>，无需用管理员权限打开！在搜索栏输入<code>cmd</code>。双击打开。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li>复制以下代码，在cmd窗口右键单击，然后回车运行。</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd %USERPROFILE%\\Desktop &amp;&amp; curl -O https:&#x2F;&#x2F;gitee.com&#x2F;xieqifei&#x2F;captions_for_moodle&#x2F;raw&#x2F;master&#x2F;getcaptions.bat &amp;&amp; call getcaptions.bat</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>在选择操作时，输入<strong>2：网络下载视频，但不生成字幕</strong>，</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"5\">\n<li>在输入视频的网络地址里，输入2.3节获取的，以.m3u8结尾的链接。然后回车</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"6\">\n<li>输入保存视频和字幕的地址，这里直接回车，将字幕保存到桌面。此时，软件开始工作。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>补充说明：m3u8是一个视频片段的地址列表，利用视频处理工具，读取这个地址表，将切割成片段的ts格式视频拼接成一个ts格式视频，在将ts格式视频转化为mp4格式。</p>\n<h2 id=\"2-5-转换字幕和上传字幕\"><a href=\"#2-5-转换字幕和上传字幕\" class=\"headerlink\" title=\"2.5 转换字幕和上传字幕\"></a>2.5 转换字幕和上传字幕</h2><p>⭐请注意，执行本节内容之前，请确保，你的网络已连接外网，并且能打开<code>https://www.google.com</code>，否则将无法进行字幕转换操作。</p>\n<p>字幕上传功能，仅在你使用此脚本的选项“网络下载视频，并生成中德字幕”时启用。</p>\n<ol>\n<li><p>搜索并打开cmd命令提示符</p>\n</li>\n<li><p>输入以下命令，下载并执行批处理脚本</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> %USERPROFILE%\\Desktop &amp;&amp; curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat &amp;&amp; call getcaptions.bat</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li>按照提示开始选择指令。直接回车。选择1：网络下载视频，并生成中德字幕。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"4\">\n<li>填写视频的下载链接，参照<strong>第三节</strong>内容，复制第三节获取到的视频链接。直接在cmd窗口上右键单击，即可粘贴。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>链接例子：<code>https://streaming.rwth-aachen.de/rwth/smil:engage-player_0fe26b35-3e44-47f0-acf6-a9c4fd05b0bc_presentation.smil/playlist.m3u8</code></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"5\">\n<li>填写视频和字幕的保存地址。直接回车，默认保存到桌面。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"6\">\n<li>程序将自动开始运行，现在，你可以去泡杯茶，等待视频和字幕转换完成。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"7\">\n<li>字幕转换完成，检查字幕文件是否正确无误，然后继续回车上传字幕。</li>\n</ol>\n<p>出现字幕上传成功字样，则字幕已更新至服务器，可通过插件在线给视频添加字幕，其他用户也可以点击右上角插件按钮下载字幕。</p>\n<ol start=\"8\">\n<li>下次运行脚本，可以直接在桌面双击打开<code>getcaptions.bat</code>文件,而无需再次下载此脚本。若脚本有更新，可执行步骤2的代码。</li>\n</ol>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"第一章-插件用户手册\"><a href=\"#第一章-插件用户手册\" class=\"headerlink\" title=\"第一章 插件用户手册\"></a>第一章 插件用户手册</h1><h2 id=\"1-1-适用场景和功能说明\"><a href=\"#1-1-适用场景和功能说明\" class=\"headerlink\" title=\"1.1 适用场景和功能说明\"></a>1.1 适用场景和功能说明</h2><ol>\n<li>本插件适用于基于chromium内核开发的浏览器，包括<strong>Chrome浏览器、360安全浏览器、QQ浏览器</strong>等。</li>\n<li>插件只在满足<strong>https://*/rwth-aachen.de/*</strong>域名<strong>匹配</strong>时工作，且除了添加字幕外无其他功能。</li>\n<li>支持<strong>德语、中文、双语</strong>字幕</li>\n<li>插件只能为<strong>数据库里存在的视频</strong>资源<strong>添加字幕</strong>。更多视频字幕，会逐渐上传。</li>\n</ol>\n<h2 id=\"1-2-效果图预览\"><a href=\"#1-2-效果图预览\" class=\"headerlink\" title=\"1.2 效果图预览\"></a>1.2 效果图预览</h2><p>以下仅展示了双语字幕。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png\"></p>\n<h2 id=\"1-3-插件安装\"><a href=\"#1-3-插件安装\" class=\"headerlink\" title=\"1.3 插件安装\"></a>1.3 插件安装</h2><ol>\n<li><p>下载插件<a href=\"https://lanzous.com/ick15oh\">https://lanzous.com/ick15oh</a></p>\n</li>\n<li><p>解压插件到桌面。获得以captions-for-moodle为名的文件夹。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg\"></p>\n</li>\n<li><p>打开chrome浏览器，依次点击右上角的三个点图标—&gt;更多工具—&gt;扩展程序。或者在地址栏输入<code>chrome://extensions/</code>以打开扩展程序。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg\"></p>\n</li>\n<li><p>单击打开扩展程序右上角的开发者选项。</p>\n</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg\"></p>\n<p>然后开发者模式下方将出现<code>加载已解压的扩展程序</code>。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg\"></p>\n<ol start=\"5\">\n<li>点击<strong>加载已解压的扩展程序</strong>，在弹出页面，选择名称为<code>captions-for-moodle</code>文件夹。点击<strong>选择文件夹</strong>。此时页面出现Captions for Moodle RWTH 1.0插件。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg\"></p>\n<ol start=\"6\">\n<li>至此插件安装完成，确认插件卡片里的选择按钮为蓝色，表示插件已激活。插件激活后，在浏览器右上角，将出现RWTH的图标。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg\"></p>\n<p>且当你打开，<code>moodle.rwth-aachen.de</code>时，页面出现绿色浮动按钮。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg\"></p>\n<h2 id=\"1-4-插件使用\"><a href=\"#1-4-插件使用\" class=\"headerlink\" title=\"1.4 插件使用\"></a>1.4 插件使用</h2><ol>\n<li>打开moodle课程视频页面，页面出现绿色悬浮按钮。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg\"></p>\n<ol start=\"2\">\n<li>点击播放视频，直到<strong>视频</strong>加载成功且<strong>开始播放</strong>，<strong>单击</strong>绿色悬浮<strong>按钮</strong>，！重要，<strong>等待几秒钟</strong>。待字幕下载完毕，会自动加载到视频上。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg\"></p>\n<ol start=\"3\">\n<li><p>下载完毕的字幕，<strong>默认为德语字幕</strong>，<strong>再次单击</strong>绿色按钮，切换<strong>中文</strong>字幕；再次单击，切换双语字幕；再次单击清除字幕。依次循环。</p>\n</li>\n<li><p>若当前视频还没有上传字幕，视频字幕会显示</p>\n</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg\"></p>\n<p>在出现此字幕时，单击三次按钮，即此清除字幕或当视频播放到两分钟时自动清除。</p>\n<ol start=\"5\">\n<li>下载字幕到本地</li>\n</ol>\n<p>如果当前视频存在字幕，待页面加载完毕后，点击浏览器右上角插件图标，即可看到字幕下载链接和视频下载链接。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg\"></p>\n<h2 id=\"1-5-其他说明\"><a href=\"#1-5-其他说明\" class=\"headerlink\" title=\"1.5 其他说明\"></a>1.5 其他说明</h2><p>目前已支持的课程有</p>\n<ul>\n<li>Bioenergie</li>\n<li>Grundoperationen der Energietechnik (VO)</li>\n<li>Petrochemie und Raffinerietechnik (VU)</li>\n<li>待添加</li>\n</ul>\n<h1 id=\"第二章-教学视频下载和字幕转换\"><a href=\"#第二章-教学视频下载和字幕转换\" class=\"headerlink\" title=\"第二章 教学视频下载和字幕转换\"></a>第二章 教学视频下载和字幕转换</h1><h2 id=\"2-1-系统要求和网络要求\"><a href=\"#2-1-系统要求和网络要求\" class=\"headerlink\" title=\"2.1 系统要求和网络要求\"></a>2.1 系统要求和网络要求</h2><p>插件用户安装我提供的视频下载和字幕转换工具。插件没提供的字幕，用户可自行本地转换，字幕转换成功后，可通过上传接口，将转换的字幕共享给每一位使用插件的用户。</p>\n<ol>\n<li>系统要求</li>\n</ol>\n<p>此教程仅<strong>适用于windows系统</strong>，若有需求，后续可出Ubuntu系统教程。Mac系统暂不支持。</p>\n<ol start=\"2\">\n<li>网络要求⭐</li>\n</ol>\n<ul>\n<li><p><strong>软件的安装需要连接外网！</strong></p>\n</li>\n<li><p><strong>视频下载不需要连接外网！</strong></p>\n</li>\n<li><p><strong>生成字幕需连接外网！</strong>字幕转换将请求谷歌的文字翻译API接口。请确保你在进行本章<strong>第5节</strong>内容，即获取字幕时，满足以下两种条件：</p>\n<ul>\n<li>用户电脑网络处于除中国大陆以外的地区。</li>\n<li>用户连接网速较好的VPN网络。<strong>注意：VPN网络不佳，将使字幕转换出现中断。</strong></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-2-软件环境搭建\"><a href=\"#2-2-软件环境搭建\" class=\"headerlink\" title=\"2.2 软件环境搭建\"></a>2.2 软件环境搭建</h2><ol>\n<li>打开命令管理器。</li>\n</ol>\n<p>打开windows桌面右上角搜索功能</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg\"></p>\n<p>在搜索框输入cmd，并点击“以管理员身份运行”。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg\"></p>\n<p>打开后如图。注意：命令行开头是：C:\\WINDOWS\\system32</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg\"></p>\n<ol start=\"2\">\n<li>安装包管理器chocolatey</li>\n</ol>\n<p><strong>复制以下</strong>指令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@&quot;%SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe&quot; -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command &quot;iex ((New-Object System.Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;chocolatey.org&#x2F;install.ps1&#39;))&quot; &amp;&amp; SET &quot;PATH&#x3D;%PATH%;%ALLUSERSPROFILE%\\chocolatey\\bin&quot;</span><br></pre></td></tr></table></figure>\n\n<p>⭐⭐⭐<strong>温馨提示：命令提示符里，使用右键单击即可复制和粘贴！</strong></p>\n<p>在命令框里，<strong>右键单击</strong>。如图，然后回车运行。等待安装完成。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg\"></p>\n<p>通常，未出现红色提示，则表示安装成功。</p>\n<p>当然为了确保成功安装，你可以通过在命令提示符里输入指令，注意V是大写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco -V</span><br></pre></td></tr></table></figure>\n\n<p>输出<strong>绿色版本号</strong>。则安装成功，例如:0.10.15。</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg\"></p>\n<ol start=\"3\">\n<li>安装 git python curl ffmpeg。</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco install git python curl ffmpeg -y</span><br></pre></td></tr></table></figure>\n\n<p>此安装过程较长，且取决于你当前所处网络环境。请耐心等待，保持电脑激活状态。</p>\n<p>安装过程中，未提示红色字体，则表示安装成功。</p>\n<p>⭐⭐安装完成后，<strong>退出cmd</strong>，<strong>重新</strong>用管理员权限<strong>打开</strong>，以刷新git、python等的环境变量。</p>\n<p>可选：你可通过分别输入<code>git --version</code>，<code>python -V</code>,<code>curl -V</code>，<code>ffmpeg -V</code>。依次查看这几个软件是否安装成功，若出现版本号则表示安装成功。</p>\n<p>如果某个程序没有安装上，比如python，你可单独使用指令 <code>choco install python -y</code>来安装。安装完成后需重启cmd，才能使用<code>python -V</code>指令查看版本信息。</p>\n<ol start=\"4\">\n<li>下载python程序并安装，⭐此步骤需要<strong>连接外网</strong>，否则会报错</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python get-pip.py</span><br><span class=\"line\">pip install git+https:&#x2F;&#x2F;github.com&#x2F;BingLingGroup&#x2F;autosub.git@alpha ffmpeg-normalize langcodes</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li><p>安装成功。输入指令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">autosub -V</span><br></pre></td></tr></table></figure>\n\n<p>显示版本号，则安装成功。</p>\n</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg\"></p>\n<ol start=\"6\">\n<li>若出现错误提示如下图</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg\"></p>\n<p>可能是你系统的未安装<strong>Microsoft Visual C++ 14.0</strong>。</p>\n<p>打开连接</p>\n<p><a href=\"https://964279924.ctfile.com/fs/1445568-239446865\">https://964279924.ctfile.com/fs/1445568-239446865</a></p>\n<p>下载<strong>安装VC++**。安装后，</strong>重复第4步**。</p>\n<h2 id=\"2-3-获得视频地址\"><a href=\"#2-3-获得视频地址\" class=\"headerlink\" title=\"2.3 获得视频地址\"></a><strong>2.3 获得</strong>视频地址</h2><p>视频下载地址，将在第一章，1.4节插件使用中有详细介绍。</p>\n<p>在打开视频地址后，点击右上角插件图标，即可看到视频下载地址的url。</p>\n<h2 id=\"2-4-下载视频\"><a href=\"#2-4-下载视频\" class=\"headerlink\" title=\"2.4 下载视频\"></a>2.4 下载视频</h2><p>如果你<strong>需要转换字幕，</strong>请<strong>跳过此节</strong>，下节内容，将包括视频的下载和字幕转换。</p>\n<p>如果你只想下载视频，而不需要转换字幕，请看此章。</p>\n<ol>\n<li>你已经安装了第二节提供的软件，并在第三节<strong>获取到了视频的下载地址</strong>，那么在这节，你将知道，如何利用ffmpeg工具，将m3u8文件转为mp4格式视频。关于m3u8文件，可看本节补充说明。</li>\n<li>打开<strong>命令提示符</strong>，无需用管理员权限打开！在搜索栏输入<code>cmd</code>。双击打开。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg\"></p>\n<ol start=\"3\">\n<li>复制以下代码，在cmd窗口右键单击，然后回车运行。</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd %USERPROFILE%\\Desktop &amp;&amp; curl -O https:&#x2F;&#x2F;gitee.com&#x2F;xieqifei&#x2F;captions_for_moodle&#x2F;raw&#x2F;master&#x2F;getcaptions.bat &amp;&amp; call getcaptions.bat</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>在选择操作时，输入<strong>2：网络下载视频，但不生成字幕</strong>，</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg\"></p>\n<ol start=\"5\">\n<li>在输入视频的网络地址里，输入2.3节获取的，以.m3u8结尾的链接。然后回车</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg\"></p>\n<ol start=\"6\">\n<li>输入保存视频和字幕的地址，这里直接回车，将字幕保存到桌面。此时，软件开始工作。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg\"></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg\"></p>\n<p>补充说明：m3u8是一个视频片段的地址列表，利用视频处理工具，读取这个地址表，将切割成片段的ts格式视频拼接成一个ts格式视频，在将ts格式视频转化为mp4格式。</p>\n<h2 id=\"2-5-转换字幕和上传字幕\"><a href=\"#2-5-转换字幕和上传字幕\" class=\"headerlink\" title=\"2.5 转换字幕和上传字幕\"></a>2.5 转换字幕和上传字幕</h2><p>⭐请注意，执行本节内容之前，请确保，你的网络已连接外网，并且能打开<code>https://www.google.com</code>，否则将无法进行字幕转换操作。</p>\n<p>字幕上传功能，仅在你使用此脚本的选项“网络下载视频，并生成中德字幕”时启用。</p>\n<ol>\n<li><p>搜索并打开cmd命令提示符</p>\n</li>\n<li><p>输入以下命令，下载并执行批处理脚本</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> %USERPROFILE%\\Desktop &amp;&amp; curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat &amp;&amp; call getcaptions.bat</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg\"></p>\n<ol start=\"3\">\n<li>按照提示开始选择指令。直接回车。选择1：网络下载视频，并生成中德字幕。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg\"></p>\n<ol start=\"4\">\n<li>填写视频的下载链接，参照<strong>第三节</strong>内容，复制第三节获取到的视频链接。直接在cmd窗口上右键单击，即可粘贴。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg\"></p>\n<p>链接例子：<code>https://streaming.rwth-aachen.de/rwth/smil:engage-player_0fe26b35-3e44-47f0-acf6-a9c4fd05b0bc_presentation.smil/playlist.m3u8</code></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg\"></p>\n<ol start=\"5\">\n<li>填写视频和字幕的保存地址。直接回车，默认保存到桌面。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg\"></p>\n<ol start=\"6\">\n<li>程序将自动开始运行，现在，你可以去泡杯茶，等待视频和字幕转换完成。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg\"></p>\n<ol start=\"7\">\n<li>字幕转换完成，检查字幕文件是否正确无误，然后继续回车上传字幕。</li>\n</ol>\n<p>出现字幕上传成功字样，则字幕已更新至服务器，可通过插件在线给视频添加字幕，其他用户也可以点击右上角插件按钮下载字幕。</p>\n<ol start=\"8\">\n<li>下次运行脚本，可以直接在桌面双击打开<code>getcaptions.bat</code>文件,而无需再次下载此脚本。若脚本有更新，可执行步骤2的代码。</li>\n</ol>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png","popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:47:39 GMT+0200 (GMT+02:00)","title":"亚琛工大教学视频添加中德字幕","path":"2020/05/27/亚琛工大教学视频添加中德字幕/","eyeCatchImage":"https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-05-27T20:02:51.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-05-27T20:02:51.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"其他","tags":["浏览器插件"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"php和js中的JSON操作","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-07-17T09:45:51.000Z","password":null,"summary":"网站开发中，前后端分离是非常常见的开发方式。在这个方式中，前后端的数据传递非常重要。我在本文中，将对我在开发过程中，对JSON数据传递的体会，进行总结。","_content":"\n\n\n# 1：基本知识\n\n*JSON*(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。这种格式的特点如下：\n\n```\n{[{\"name\":\"zhangsan\",\"age\":54}],\n[{\"name\":\"lisi\",\"age\":56}]}\n```\n\n**说明：**\n\n- 以上JSON数据包含了一个对象，最外侧的`{}`，对象内部包含了两个数组`[]`,每个数组内都有一个结构类似的对象，内侧的`{}`。\n\n- 对象和数组是构成JSON的基本要素，数组的出现是为了让结构相同，即键名`例如：name、age`相同的对象，排列更加整齐，也方便我们用数组的方法提取。\n\n由于前后端数据传递的特点，**对象或者数组格式的数据不能直接从php传递到前端js**。因此，我们将php中的对象/数组数据，转为字符串格式的JSON数据，然后传递到前端，前端js再将其转为对象或数组格式。反之亦然。\n\n# 2：php中的json处理\n\nphp中主要有两个函数处理json数据: `json_encode`、`json_decode`\n\n## 2.1 json_encode\n\njson_encode:将数组、对象转为json格式的字符串。\n\n- 例如：php中有一个数组，其包含键名和键值。\n\n```php\n$arr = [\n    'appid' => '121434352',\n    'appkey' => '19b8b372c501e1fbedead782d46199a',\n    'callback' => 'http://example.com/callback.php',\n    'scope' => 'add_t,add_pic_t,del_t',\n    'errorReport' => true,\n    'storageType' => 'file',\n    'host' => 'localhost',\n    'user' => 'root',\n    'password' => 'root',\n    'database' => 'test'\n];\n```\n\n使用将其转为字符串\n\n```php\n$str = json_encode($arr);\necho $str;\n```\n\n输出：\n\n```json\n{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}\n```\n\n可以看到，数组被转换成了一个对象样式的JSON数据。\n\n- 如果一个数组，索引为数字。\n\n例如：\n\n```php\n$arr = array('a' , 'b', 'c');\njson_encode($arr);\n```\n\n输出：\n\n```php\n[\"a\",\"b\",\"c\"]\n```\n\n可看到其输出仍为数组格式。\n\n- 如果希望将键名键值格式的数组转换后格式仍保留。可以对其排序，排序后，会丢失键名。索引统一变为数字。\n\n```php\n$arr = array('1' => 'a' , '2' => 'b', '3' => 'c');\nsort($arr);\njson_encode($arr);\n```\n\n输出：\n\n```\n[\"a\",\"b\",\"c\"]\n```\n\n## 2.2 json_decode\n\njson_decode:将字符串转为对象/数组格式。\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$obj = json_decode($str);\nprint_r($obj);\n```\n\n由于`echo`只能输出字符串格式数据，`print_r`和`var_dump`可以将数组和对象用特定的格式输出。所以这里使用了print_r。\n\n输出：\n\n```php\nstdClass Object\n(\n    [appid] => 121434352\n    [appkey] => 19b8b372c501e1fbedead782d46199a\n    [callback] => http://example.com/callback.php\n    [scope] => add_t,add_pic_t,del_t\n    [errorReport] => 1\n    [storageType] => file\n    [host] => localhost\n    [user] => root\n    [password] => root\n    [database] => test\n)\n```\n\n可以看到，json数据被转换成了一个对象。\n\n**也可以修改json_decode参数，将json转为数组**\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$arr = json_decode($str, true);\nvar_dump($arr);\n```\n\n这里，再json_decode参数里添加true，表示将json转为数组。并使用var_dump来输出数组。\n\nvar_dump输出结果：\n\n```php\narray(10) {\n  [\"appid\"]=>\n  string(9) \"121434352\"\n  [\"appkey\"]=>\n  string(31) \"19b8b372c501e1fbedead782d46199a\"\n  [\"callback\"]=>\n  string(31) \"http://example.com/callback.php\"\n  [\"scope\"]=>\n  string(21) \"add_t,add_pic_t,del_t\"\n  [\"errorReport\"]=>\n  bool(true)\n  [\"storageType\"]=>\n  string(4) \"file\"\n  [\"host\"]=>\n  string(9) \"localhost\"\n  [\"user\"]=>\n  string(4) \"root\"\n  [\"password\"]=>\n  string(4) \"root\"\n  [\"database\"]=>\n  string(4) \"test\"\n}\n```\n\n对比print_r输出结果：\n\n```php\nArray\n(\n    [appid] => 121434352\n    [appkey] => 19b8b372c501e1fbedead782d46199a\n    [callback] => http://example.com/callback.php\n    [scope] => add_t,add_pic_t,del_t\n    [errorReport] => 1\n    [storageType] => file\n    [host] => localhost\n    [user] => root\n    [password] => root\n    [database] => test\n)\n\n```\n\n## 2.3 对象数组操作\n\n### 2.3.1 对象操作\n\nphp中，根据对象键名获取键值的方式是`->`\n\n比如我们转换了以下对象，\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$obj = json_decode($str);\n```\n\n现在获取appkey\n\n```php\n$appkey = $obj->appkey;\necho $appkey;\n```\n\n输出：\n\n```php\n19b8b372c501e1fbedead782d46199a\n```\n\n### 2.3.2 数组操作\n\n转换的数组：\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$arr = json_decode($str, true);\n```\n\n操作数组，获取appkey：\n\n```php\n$appkey = $arr['appkey'];\necho $appkey\n```\n\n输出：\n\n```\n19b8b372c501e1fbedead782d46199a\n```\n\n# 3：JS中的json处理\n\n与php中处理方式相对应，存在`JSON.stringify`和`JSON.parse`两个函数\n\n## 3.1 JSON.stringify\n\n对象、数组转为字符串格式。\n\n对象字符串化：\n\n```js\nvar Person={};   //等同于var Person =new Object();\nvar Person={\nname:\"Jason\",\nage:21\n}\nvar str=JSON.stringify(Person)\nalert(str);\n```\n\n输出：\n\n```js\n{\"name\":\"Jason\",\"age\":21}\n```\n\n数组字符串化：\n\n```js\nvar mycars=new Array();\nmycars[0]=\"Saab\";\nmycars[1]=\"Volvo\";\nmycars[2]=\"BMW\";\nalert(JSON.stringify(mycars));\n```\n\n输出：\n\n```js\n[\"Saab\",\"Volvo\",\"BMW\"]\n```\n\n## 3.2 JSON.parse\n\n字符串转数组、对象。\n\n- 转对象：\n\n```js\nvar str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\nvar obj= JSON.parse(str);\nalert(obj);\n```\n\n输出：\n\n```js\n[object Object]\n```\n\n以上说明输出的数据格式为对象。\n\n- 转数组：\n\n```js\nvar str = '[\"a\",\"b\",\"c\"]';\nvar arr= JSON.parse(str);\nalert(arr);\n```\n\n输出：\n\n```js\na,b,c\n```\n\n## 3.3 对象数组操作\n\n### 3.3.1 对象操作\n\n创建对象：\n\n```js\nvar Person={};   //等同于var Person =new Object();\nvar Person={\nname:\"Jason\",\nage:21\n}\n```\n\n获取name对应的键值：\n\n```js\nvar name = Person.name;\nalert(name);\n```\n\n或者：\n\n```js\nvar name = Person['name'];\nalert(name);\n```\n\n### 3.3.2 数组操作\n\n```js\nvar arr = ['a','b','c'];\nalert(arr[0]);\n```\n\n","source":"_posts/php和js中的JSON操作.md","raw":"---\ntitle: php和js中的JSON操作\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-07-17 11:45:51\npassword:\nsummary: 网站开发中，前后端分离是非常常见的开发方式。在这个方式中，前后端的数据传递非常重要。我在本文中，将对我在开发过程中，对JSON数据传递的体会，进行总结。\ntags: JSON\ncategories: 网站编程\n---\n\n\n\n# 1：基本知识\n\n*JSON*(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。这种格式的特点如下：\n\n```\n{[{\"name\":\"zhangsan\",\"age\":54}],\n[{\"name\":\"lisi\",\"age\":56}]}\n```\n\n**说明：**\n\n- 以上JSON数据包含了一个对象，最外侧的`{}`，对象内部包含了两个数组`[]`,每个数组内都有一个结构类似的对象，内侧的`{}`。\n\n- 对象和数组是构成JSON的基本要素，数组的出现是为了让结构相同，即键名`例如：name、age`相同的对象，排列更加整齐，也方便我们用数组的方法提取。\n\n由于前后端数据传递的特点，**对象或者数组格式的数据不能直接从php传递到前端js**。因此，我们将php中的对象/数组数据，转为字符串格式的JSON数据，然后传递到前端，前端js再将其转为对象或数组格式。反之亦然。\n\n# 2：php中的json处理\n\nphp中主要有两个函数处理json数据: `json_encode`、`json_decode`\n\n## 2.1 json_encode\n\njson_encode:将数组、对象转为json格式的字符串。\n\n- 例如：php中有一个数组，其包含键名和键值。\n\n```php\n$arr = [\n    'appid' => '121434352',\n    'appkey' => '19b8b372c501e1fbedead782d46199a',\n    'callback' => 'http://example.com/callback.php',\n    'scope' => 'add_t,add_pic_t,del_t',\n    'errorReport' => true,\n    'storageType' => 'file',\n    'host' => 'localhost',\n    'user' => 'root',\n    'password' => 'root',\n    'database' => 'test'\n];\n```\n\n使用将其转为字符串\n\n```php\n$str = json_encode($arr);\necho $str;\n```\n\n输出：\n\n```json\n{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}\n```\n\n可以看到，数组被转换成了一个对象样式的JSON数据。\n\n- 如果一个数组，索引为数字。\n\n例如：\n\n```php\n$arr = array('a' , 'b', 'c');\njson_encode($arr);\n```\n\n输出：\n\n```php\n[\"a\",\"b\",\"c\"]\n```\n\n可看到其输出仍为数组格式。\n\n- 如果希望将键名键值格式的数组转换后格式仍保留。可以对其排序，排序后，会丢失键名。索引统一变为数字。\n\n```php\n$arr = array('1' => 'a' , '2' => 'b', '3' => 'c');\nsort($arr);\njson_encode($arr);\n```\n\n输出：\n\n```\n[\"a\",\"b\",\"c\"]\n```\n\n## 2.2 json_decode\n\njson_decode:将字符串转为对象/数组格式。\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$obj = json_decode($str);\nprint_r($obj);\n```\n\n由于`echo`只能输出字符串格式数据，`print_r`和`var_dump`可以将数组和对象用特定的格式输出。所以这里使用了print_r。\n\n输出：\n\n```php\nstdClass Object\n(\n    [appid] => 121434352\n    [appkey] => 19b8b372c501e1fbedead782d46199a\n    [callback] => http://example.com/callback.php\n    [scope] => add_t,add_pic_t,del_t\n    [errorReport] => 1\n    [storageType] => file\n    [host] => localhost\n    [user] => root\n    [password] => root\n    [database] => test\n)\n```\n\n可以看到，json数据被转换成了一个对象。\n\n**也可以修改json_decode参数，将json转为数组**\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$arr = json_decode($str, true);\nvar_dump($arr);\n```\n\n这里，再json_decode参数里添加true，表示将json转为数组。并使用var_dump来输出数组。\n\nvar_dump输出结果：\n\n```php\narray(10) {\n  [\"appid\"]=>\n  string(9) \"121434352\"\n  [\"appkey\"]=>\n  string(31) \"19b8b372c501e1fbedead782d46199a\"\n  [\"callback\"]=>\n  string(31) \"http://example.com/callback.php\"\n  [\"scope\"]=>\n  string(21) \"add_t,add_pic_t,del_t\"\n  [\"errorReport\"]=>\n  bool(true)\n  [\"storageType\"]=>\n  string(4) \"file\"\n  [\"host\"]=>\n  string(9) \"localhost\"\n  [\"user\"]=>\n  string(4) \"root\"\n  [\"password\"]=>\n  string(4) \"root\"\n  [\"database\"]=>\n  string(4) \"test\"\n}\n```\n\n对比print_r输出结果：\n\n```php\nArray\n(\n    [appid] => 121434352\n    [appkey] => 19b8b372c501e1fbedead782d46199a\n    [callback] => http://example.com/callback.php\n    [scope] => add_t,add_pic_t,del_t\n    [errorReport] => 1\n    [storageType] => file\n    [host] => localhost\n    [user] => root\n    [password] => root\n    [database] => test\n)\n\n```\n\n## 2.3 对象数组操作\n\n### 2.3.1 对象操作\n\nphp中，根据对象键名获取键值的方式是`->`\n\n比如我们转换了以下对象，\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$obj = json_decode($str);\n```\n\n现在获取appkey\n\n```php\n$appkey = $obj->appkey;\necho $appkey;\n```\n\n输出：\n\n```php\n19b8b372c501e1fbedead782d46199a\n```\n\n### 2.3.2 数组操作\n\n转换的数组：\n\n```php\n$str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\n$arr = json_decode($str, true);\n```\n\n操作数组，获取appkey：\n\n```php\n$appkey = $arr['appkey'];\necho $appkey\n```\n\n输出：\n\n```\n19b8b372c501e1fbedead782d46199a\n```\n\n# 3：JS中的json处理\n\n与php中处理方式相对应，存在`JSON.stringify`和`JSON.parse`两个函数\n\n## 3.1 JSON.stringify\n\n对象、数组转为字符串格式。\n\n对象字符串化：\n\n```js\nvar Person={};   //等同于var Person =new Object();\nvar Person={\nname:\"Jason\",\nage:21\n}\nvar str=JSON.stringify(Person)\nalert(str);\n```\n\n输出：\n\n```js\n{\"name\":\"Jason\",\"age\":21}\n```\n\n数组字符串化：\n\n```js\nvar mycars=new Array();\nmycars[0]=\"Saab\";\nmycars[1]=\"Volvo\";\nmycars[2]=\"BMW\";\nalert(JSON.stringify(mycars));\n```\n\n输出：\n\n```js\n[\"Saab\",\"Volvo\",\"BMW\"]\n```\n\n## 3.2 JSON.parse\n\n字符串转数组、对象。\n\n- 转对象：\n\n```js\nvar str = '{\"appid\":\"121434352\",\"appkey\":\"19b8b372c501e1fbedead782d46199a\",\"callback\":\"http:\\/\\/example.com\\/callback.php\",\"scope\":\"add_t,add_pic_t,del_t\",\"errorReport\":true,\"storageType\":\"file\",\"host\":\"localhost\",\"user\":\"root\",\"password\":\"root\",\"database\":\"test\"}';\nvar obj= JSON.parse(str);\nalert(obj);\n```\n\n输出：\n\n```js\n[object Object]\n```\n\n以上说明输出的数据格式为对象。\n\n- 转数组：\n\n```js\nvar str = '[\"a\",\"b\",\"c\"]';\nvar arr= JSON.parse(str);\nalert(arr);\n```\n\n输出：\n\n```js\na,b,c\n```\n\n## 3.3 对象数组操作\n\n### 3.3.1 对象操作\n\n创建对象：\n\n```js\nvar Person={};   //等同于var Person =new Object();\nvar Person={\nname:\"Jason\",\nage:21\n}\n```\n\n获取name对应的键值：\n\n```js\nvar name = Person.name;\nalert(name);\n```\n\n或者：\n\n```js\nvar name = Person['name'];\nalert(name);\n```\n\n### 3.3.2 数组操作\n\n```js\nvar arr = ['a','b','c'];\nalert(arr[0]);\n```\n\n","slug":"php和js中的JSON操作","published":1,"updated":"2020-07-17T05:58:01.473Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsabw0020p0vz3vp9683x","content":"<h1 id=\"1：基本知识\"><a href=\"#1：基本知识\" class=\"headerlink\" title=\"1：基本知识\"></a>1：基本知识</h1><p><em>JSON</em>(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。这种格式的特点如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;[&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:54&#125;],</span><br><span class=\"line\">[&#123;&quot;name&quot;:&quot;lisi&quot;,&quot;age&quot;:56&#125;]&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>说明：</strong></p>\n<ul>\n<li><p>以上JSON数据包含了一个对象，最外侧的<code>&#123;&#125;</code>，对象内部包含了两个数组<code>[]</code>,每个数组内都有一个结构类似的对象，内侧的<code>&#123;&#125;</code>。</p>\n</li>\n<li><p>对象和数组是构成JSON的基本要素，数组的出现是为了让结构相同，即键名<code>例如：name、age</code>相同的对象，排列更加整齐，也方便我们用数组的方法提取。</p>\n</li>\n</ul>\n<p>由于前后端数据传递的特点，<strong>对象或者数组格式的数据不能直接从php传递到前端js</strong>。因此，我们将php中的对象/数组数据，转为字符串格式的JSON数据，然后传递到前端，前端js再将其转为对象或数组格式。反之亦然。</p>\n<h1 id=\"2：php中的json处理\"><a href=\"#2：php中的json处理\" class=\"headerlink\" title=\"2：php中的json处理\"></a>2：php中的json处理</h1><p>php中主要有两个函数处理json数据: <code>json_encode</code>、<code>json_decode</code></p>\n<h2 id=\"2-1-json-encode\"><a href=\"#2-1-json-encode\" class=\"headerlink\" title=\"2.1 json_encode\"></a>2.1 json_encode</h2><p>json_encode:将数组、对象转为json格式的字符串。</p>\n<ul>\n<li>例如：php中有一个数组，其包含键名和键值。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = [</span><br><span class=\"line\">    <span class=\"string\">&#x27;appid&#x27;</span> =&gt; <span class=\"string\">&#x27;121434352&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;appkey&#x27;</span> =&gt; <span class=\"string\">&#x27;19b8b372c501e1fbedead782d46199a&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;callback&#x27;</span> =&gt; <span class=\"string\">&#x27;http://example.com/callback.php&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;scope&#x27;</span> =&gt; <span class=\"string\">&#x27;add_t,add_pic_t,del_t&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;errorReport&#x27;</span> =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;storageType&#x27;</span> =&gt; <span class=\"string\">&#x27;file&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;host&#x27;</span> =&gt; <span class=\"string\">&#x27;localhost&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;user&#x27;</span> =&gt; <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;password&#x27;</span> =&gt; <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;database&#x27;</span> =&gt; <span class=\"string\">&#x27;test&#x27;</span></span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<p>使用将其转为字符串</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = json_encode($arr);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $str;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"attr\">&quot;appid&quot;</span>:<span class=\"string\">&quot;121434352&quot;</span>,<span class=\"attr\">&quot;appkey&quot;</span>:<span class=\"string\">&quot;19b8b372c501e1fbedead782d46199a&quot;</span>,<span class=\"attr\">&quot;callback&quot;</span>:<span class=\"string\">&quot;http:\\/\\/example.com\\/callback.php&quot;</span>,<span class=\"attr\">&quot;scope&quot;</span>:<span class=\"string\">&quot;add_t,add_pic_t,del_t&quot;</span>,<span class=\"attr\">&quot;errorReport&quot;</span>:<span class=\"literal\">true</span>,<span class=\"attr\">&quot;storageType&quot;</span>:<span class=\"string\">&quot;file&quot;</span>,<span class=\"attr\">&quot;host&quot;</span>:<span class=\"string\">&quot;localhost&quot;</span>,<span class=\"attr\">&quot;user&quot;</span>:<span class=\"string\">&quot;root&quot;</span>,<span class=\"attr\">&quot;password&quot;</span>:<span class=\"string\">&quot;root&quot;</span>,<span class=\"attr\">&quot;database&quot;</span>:<span class=\"string\">&quot;test&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，数组被转换成了一个对象样式的JSON数据。</p>\n<ul>\n<li>如果一个数组，索引为数字。</li>\n</ul>\n<p>例如：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;a&#x27;</span> , <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\">json_encode($arr);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&quot;a&quot;</span>,<span class=\"string\">&quot;b&quot;</span>,<span class=\"string\">&quot;c&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>可看到其输出仍为数组格式。</p>\n<ul>\n<li>如果希望将键名键值格式的数组转换后格式仍保留。可以对其排序，排序后，会丢失键名。索引统一变为数字。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;1&#x27;</span> =&gt; <span class=\"string\">&#x27;a&#x27;</span> , <span class=\"string\">&#x27;2&#x27;</span> =&gt; <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span> =&gt; <span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\">sort($arr);</span><br><span class=\"line\">json_encode($arr);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-json-decode\"><a href=\"#2-2-json-decode\" class=\"headerlink\" title=\"2.2 json_decode\"></a>2.2 json_decode</h2><p>json_decode:将字符串转为对象/数组格式。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$obj = json_decode($str);</span><br><span class=\"line\">print_r($obj);</span><br></pre></td></tr></table></figure>\n\n<p>由于<code>echo</code>只能输出字符串格式数据，<code>print_r</code>和<code>var_dump</code>可以将数组和对象用特定的格式输出。所以这里使用了print_r。</p>\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">stdClass</span> <span class=\"keyword\">Object</span></span><br><span class=\"line\">(</span><br><span class=\"line\">    [appid] =&gt; <span class=\"number\">121434352</span></span><br><span class=\"line\">    [appkey] =&gt; <span class=\"number\">19</span>b8b372c501e1fbedead782d46199a</span><br><span class=\"line\">    [callback] =&gt; http:<span class=\"comment\">//example.com/callback.php</span></span><br><span class=\"line\">    [scope] =&gt; add_t,add_pic_t,del_t</span><br><span class=\"line\">    [errorReport] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    [storageType] =&gt; file</span><br><span class=\"line\">    [host] =&gt; localhost</span><br><span class=\"line\">    [user] =&gt; root</span><br><span class=\"line\">    [password] =&gt; root</span><br><span class=\"line\">    [database] =&gt; test</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，json数据被转换成了一个对象。</p>\n<p><strong>也可以修改json_decode参数，将json转为数组</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$arr = json_decode($str, <span class=\"literal\">true</span>);</span><br><span class=\"line\">var_dump($arr);</span><br></pre></td></tr></table></figure>\n\n<p>这里，再json_decode参数里添加true，表示将json转为数组。并使用var_dump来输出数组。</p>\n<p>var_dump输出结果：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">array</span>(<span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">  [<span class=\"string\">&quot;appid&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">9</span>) <span class=\"string\">&quot;121434352&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;appkey&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">31</span>) <span class=\"string\">&quot;19b8b372c501e1fbedead782d46199a&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;callback&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">31</span>) <span class=\"string\">&quot;http://example.com/callback.php&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;scope&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">21</span>) <span class=\"string\">&quot;add_t,add_pic_t,del_t&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;errorReport&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">bool</span>(<span class=\"literal\">true</span>)</span><br><span class=\"line\">  [<span class=\"string\">&quot;storageType&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;file&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;host&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">9</span>) <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;user&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;root&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;password&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;root&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;database&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;test&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对比print_r输出结果：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Array</span></span><br><span class=\"line\">(</span><br><span class=\"line\">    [appid] =&gt; <span class=\"number\">121434352</span></span><br><span class=\"line\">    [appkey] =&gt; <span class=\"number\">19</span>b8b372c501e1fbedead782d46199a</span><br><span class=\"line\">    [callback] =&gt; http:<span class=\"comment\">//example.com/callback.php</span></span><br><span class=\"line\">    [scope] =&gt; add_t,add_pic_t,del_t</span><br><span class=\"line\">    [errorReport] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    [storageType] =&gt; file</span><br><span class=\"line\">    [host] =&gt; localhost</span><br><span class=\"line\">    [user] =&gt; root</span><br><span class=\"line\">    [password] =&gt; root</span><br><span class=\"line\">    [database] =&gt; test</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-对象数组操作\"><a href=\"#2-3-对象数组操作\" class=\"headerlink\" title=\"2.3 对象数组操作\"></a>2.3 对象数组操作</h2><h3 id=\"2-3-1-对象操作\"><a href=\"#2-3-1-对象操作\" class=\"headerlink\" title=\"2.3.1 对象操作\"></a>2.3.1 对象操作</h3><p>php中，根据对象键名获取键值的方式是<code>-&gt;</code></p>\n<p>比如我们转换了以下对象，</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$obj = json_decode($str);</span><br></pre></td></tr></table></figure>\n\n<p>现在获取appkey</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$appkey = $obj-&gt;appkey;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $appkey;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">19</span>b8b372c501e1fbedead782d46199a</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-2-数组操作\"><a href=\"#2-3-2-数组操作\" class=\"headerlink\" title=\"2.3.2 数组操作\"></a>2.3.2 数组操作</h3><p>转换的数组：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$arr = json_decode($str, <span class=\"literal\">true</span>);</span><br></pre></td></tr></table></figure>\n\n<p>操作数组，获取appkey：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$appkey = $arr[<span class=\"string\">&#x27;appkey&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $appkey</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">19b8b372c501e1fbedead782d46199a</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：JS中的json处理\"><a href=\"#3：JS中的json处理\" class=\"headerlink\" title=\"3：JS中的json处理\"></a>3：JS中的json处理</h1><p>与php中处理方式相对应，存在<code>JSON.stringify</code>和<code>JSON.parse</code>两个函数</p>\n<h2 id=\"3-1-JSON-stringify\"><a href=\"#3-1-JSON-stringify\" class=\"headerlink\" title=\"3.1 JSON.stringify\"></a>3.1 JSON.stringify</h2><p>对象、数组转为字符串格式。</p>\n<p>对象字符串化：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;&#125;;   <span class=\"comment\">//等同于var Person =new Object();</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;</span><br><span class=\"line\">name:<span class=\"string\">&quot;Jason&quot;</span>,</span><br><span class=\"line\">age:<span class=\"number\">21</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> str=<span class=\"built_in\">JSON</span>.stringify(Person)</span><br><span class=\"line\">alert(str);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;Jason&quot;</span>,<span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">21</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>数组字符串化：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> mycars=<span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">mycars[<span class=\"number\">0</span>]=<span class=\"string\">&quot;Saab&quot;</span>;</span><br><span class=\"line\">mycars[<span class=\"number\">1</span>]=<span class=\"string\">&quot;Volvo&quot;</span>;</span><br><span class=\"line\">mycars[<span class=\"number\">2</span>]=<span class=\"string\">&quot;BMW&quot;</span>;</span><br><span class=\"line\">alert(<span class=\"built_in\">JSON</span>.stringify(mycars));</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&quot;Saab&quot;</span>,<span class=\"string\">&quot;Volvo&quot;</span>,<span class=\"string\">&quot;BMW&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-JSON-parse\"><a href=\"#3-2-JSON-parse\" class=\"headerlink\" title=\"3.2 JSON.parse\"></a>3.2 JSON.parse</h2><p>字符串转数组、对象。</p>\n<ul>\n<li>转对象：</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj= <span class=\"built_in\">JSON</span>.parse(str);</span><br><span class=\"line\">alert(obj);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[object <span class=\"built_in\">Object</span>]</span><br></pre></td></tr></table></figure>\n\n<p>以上说明输出的数据格式为对象。</p>\n<ul>\n<li>转数组：</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr= <span class=\"built_in\">JSON</span>.parse(str);</span><br><span class=\"line\">alert(arr);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a,b,c</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-对象数组操作\"><a href=\"#3-3-对象数组操作\" class=\"headerlink\" title=\"3.3 对象数组操作\"></a>3.3 对象数组操作</h2><h3 id=\"3-3-1-对象操作\"><a href=\"#3-3-1-对象操作\" class=\"headerlink\" title=\"3.3.1 对象操作\"></a>3.3.1 对象操作</h3><p>创建对象：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;&#125;;   <span class=\"comment\">//等同于var Person =new Object();</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;</span><br><span class=\"line\">name:<span class=\"string\">&quot;Jason&quot;</span>,</span><br><span class=\"line\">age:<span class=\"number\">21</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>获取name对应的键值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = Person.name;</span><br><span class=\"line\">alert(name);</span><br></pre></td></tr></table></figure>\n\n<p>或者：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = Person[<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">alert(name);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3-2-数组操作\"><a href=\"#3-3-2-数组操作\" class=\"headerlink\" title=\"3.3.2 数组操作\"></a>3.3.2 数组操作</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">&#x27;a&#x27;</span>,<span class=\"string\">&#x27;b&#x27;</span>,<span class=\"string\">&#x27;c&#x27;</span>];</span><br><span class=\"line\">alert(arr[<span class=\"number\">0</span>]);</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：基本知识\"><a href=\"#1：基本知识\" class=\"headerlink\" title=\"1：基本知识\"></a>1：基本知识</h1><p><em>JSON</em>(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。这种格式的特点如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;[&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:54&#125;],</span><br><span class=\"line\">[&#123;&quot;name&quot;:&quot;lisi&quot;,&quot;age&quot;:56&#125;]&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>说明：</strong></p>\n<ul>\n<li><p>以上JSON数据包含了一个对象，最外侧的<code>&#123;&#125;</code>，对象内部包含了两个数组<code>[]</code>,每个数组内都有一个结构类似的对象，内侧的<code>&#123;&#125;</code>。</p>\n</li>\n<li><p>对象和数组是构成JSON的基本要素，数组的出现是为了让结构相同，即键名<code>例如：name、age</code>相同的对象，排列更加整齐，也方便我们用数组的方法提取。</p>\n</li>\n</ul>\n<p>由于前后端数据传递的特点，<strong>对象或者数组格式的数据不能直接从php传递到前端js</strong>。因此，我们将php中的对象/数组数据，转为字符串格式的JSON数据，然后传递到前端，前端js再将其转为对象或数组格式。反之亦然。</p>\n<h1 id=\"2：php中的json处理\"><a href=\"#2：php中的json处理\" class=\"headerlink\" title=\"2：php中的json处理\"></a>2：php中的json处理</h1><p>php中主要有两个函数处理json数据: <code>json_encode</code>、<code>json_decode</code></p>\n<h2 id=\"2-1-json-encode\"><a href=\"#2-1-json-encode\" class=\"headerlink\" title=\"2.1 json_encode\"></a>2.1 json_encode</h2><p>json_encode:将数组、对象转为json格式的字符串。</p>\n<ul>\n<li>例如：php中有一个数组，其包含键名和键值。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = [</span><br><span class=\"line\">    <span class=\"string\">&#x27;appid&#x27;</span> =&gt; <span class=\"string\">&#x27;121434352&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;appkey&#x27;</span> =&gt; <span class=\"string\">&#x27;19b8b372c501e1fbedead782d46199a&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;callback&#x27;</span> =&gt; <span class=\"string\">&#x27;http://example.com/callback.php&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;scope&#x27;</span> =&gt; <span class=\"string\">&#x27;add_t,add_pic_t,del_t&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;errorReport&#x27;</span> =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;storageType&#x27;</span> =&gt; <span class=\"string\">&#x27;file&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;host&#x27;</span> =&gt; <span class=\"string\">&#x27;localhost&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;user&#x27;</span> =&gt; <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;password&#x27;</span> =&gt; <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;database&#x27;</span> =&gt; <span class=\"string\">&#x27;test&#x27;</span></span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<p>使用将其转为字符串</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = json_encode($arr);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $str;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"attr\">&quot;appid&quot;</span>:<span class=\"string\">&quot;121434352&quot;</span>,<span class=\"attr\">&quot;appkey&quot;</span>:<span class=\"string\">&quot;19b8b372c501e1fbedead782d46199a&quot;</span>,<span class=\"attr\">&quot;callback&quot;</span>:<span class=\"string\">&quot;http:\\/\\/example.com\\/callback.php&quot;</span>,<span class=\"attr\">&quot;scope&quot;</span>:<span class=\"string\">&quot;add_t,add_pic_t,del_t&quot;</span>,<span class=\"attr\">&quot;errorReport&quot;</span>:<span class=\"literal\">true</span>,<span class=\"attr\">&quot;storageType&quot;</span>:<span class=\"string\">&quot;file&quot;</span>,<span class=\"attr\">&quot;host&quot;</span>:<span class=\"string\">&quot;localhost&quot;</span>,<span class=\"attr\">&quot;user&quot;</span>:<span class=\"string\">&quot;root&quot;</span>,<span class=\"attr\">&quot;password&quot;</span>:<span class=\"string\">&quot;root&quot;</span>,<span class=\"attr\">&quot;database&quot;</span>:<span class=\"string\">&quot;test&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，数组被转换成了一个对象样式的JSON数据。</p>\n<ul>\n<li>如果一个数组，索引为数字。</li>\n</ul>\n<p>例如：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;a&#x27;</span> , <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\">json_encode($arr);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&quot;a&quot;</span>,<span class=\"string\">&quot;b&quot;</span>,<span class=\"string\">&quot;c&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>可看到其输出仍为数组格式。</p>\n<ul>\n<li>如果希望将键名键值格式的数组转换后格式仍保留。可以对其排序，排序后，会丢失键名。索引统一变为数字。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;1&#x27;</span> =&gt; <span class=\"string\">&#x27;a&#x27;</span> , <span class=\"string\">&#x27;2&#x27;</span> =&gt; <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span> =&gt; <span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\">sort($arr);</span><br><span class=\"line\">json_encode($arr);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-json-decode\"><a href=\"#2-2-json-decode\" class=\"headerlink\" title=\"2.2 json_decode\"></a>2.2 json_decode</h2><p>json_decode:将字符串转为对象/数组格式。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$obj = json_decode($str);</span><br><span class=\"line\">print_r($obj);</span><br></pre></td></tr></table></figure>\n\n<p>由于<code>echo</code>只能输出字符串格式数据，<code>print_r</code>和<code>var_dump</code>可以将数组和对象用特定的格式输出。所以这里使用了print_r。</p>\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">stdClass</span> <span class=\"keyword\">Object</span></span><br><span class=\"line\">(</span><br><span class=\"line\">    [appid] =&gt; <span class=\"number\">121434352</span></span><br><span class=\"line\">    [appkey] =&gt; <span class=\"number\">19</span>b8b372c501e1fbedead782d46199a</span><br><span class=\"line\">    [callback] =&gt; http:<span class=\"comment\">//example.com/callback.php</span></span><br><span class=\"line\">    [scope] =&gt; add_t,add_pic_t,del_t</span><br><span class=\"line\">    [errorReport] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    [storageType] =&gt; file</span><br><span class=\"line\">    [host] =&gt; localhost</span><br><span class=\"line\">    [user] =&gt; root</span><br><span class=\"line\">    [password] =&gt; root</span><br><span class=\"line\">    [database] =&gt; test</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，json数据被转换成了一个对象。</p>\n<p><strong>也可以修改json_decode参数，将json转为数组</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$arr = json_decode($str, <span class=\"literal\">true</span>);</span><br><span class=\"line\">var_dump($arr);</span><br></pre></td></tr></table></figure>\n\n<p>这里，再json_decode参数里添加true，表示将json转为数组。并使用var_dump来输出数组。</p>\n<p>var_dump输出结果：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">array</span>(<span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">  [<span class=\"string\">&quot;appid&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">9</span>) <span class=\"string\">&quot;121434352&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;appkey&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">31</span>) <span class=\"string\">&quot;19b8b372c501e1fbedead782d46199a&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;callback&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">31</span>) <span class=\"string\">&quot;http://example.com/callback.php&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;scope&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">21</span>) <span class=\"string\">&quot;add_t,add_pic_t,del_t&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;errorReport&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">bool</span>(<span class=\"literal\">true</span>)</span><br><span class=\"line\">  [<span class=\"string\">&quot;storageType&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;file&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;host&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">9</span>) <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;user&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;root&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;password&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;root&quot;</span></span><br><span class=\"line\">  [<span class=\"string\">&quot;database&quot;</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">string</span>(<span class=\"number\">4</span>) <span class=\"string\">&quot;test&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对比print_r输出结果：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Array</span></span><br><span class=\"line\">(</span><br><span class=\"line\">    [appid] =&gt; <span class=\"number\">121434352</span></span><br><span class=\"line\">    [appkey] =&gt; <span class=\"number\">19</span>b8b372c501e1fbedead782d46199a</span><br><span class=\"line\">    [callback] =&gt; http:<span class=\"comment\">//example.com/callback.php</span></span><br><span class=\"line\">    [scope] =&gt; add_t,add_pic_t,del_t</span><br><span class=\"line\">    [errorReport] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    [storageType] =&gt; file</span><br><span class=\"line\">    [host] =&gt; localhost</span><br><span class=\"line\">    [user] =&gt; root</span><br><span class=\"line\">    [password] =&gt; root</span><br><span class=\"line\">    [database] =&gt; test</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-对象数组操作\"><a href=\"#2-3-对象数组操作\" class=\"headerlink\" title=\"2.3 对象数组操作\"></a>2.3 对象数组操作</h2><h3 id=\"2-3-1-对象操作\"><a href=\"#2-3-1-对象操作\" class=\"headerlink\" title=\"2.3.1 对象操作\"></a>2.3.1 对象操作</h3><p>php中，根据对象键名获取键值的方式是<code>-&gt;</code></p>\n<p>比如我们转换了以下对象，</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$obj = json_decode($str);</span><br></pre></td></tr></table></figure>\n\n<p>现在获取appkey</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$appkey = $obj-&gt;appkey;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $appkey;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">19</span>b8b372c501e1fbedead782d46199a</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-2-数组操作\"><a href=\"#2-3-2-数组操作\" class=\"headerlink\" title=\"2.3.2 数组操作\"></a>2.3.2 数组操作</h3><p>转换的数组：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">$arr = json_decode($str, <span class=\"literal\">true</span>);</span><br></pre></td></tr></table></figure>\n\n<p>操作数组，获取appkey：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$appkey = $arr[<span class=\"string\">&#x27;appkey&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $appkey</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">19b8b372c501e1fbedead782d46199a</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：JS中的json处理\"><a href=\"#3：JS中的json处理\" class=\"headerlink\" title=\"3：JS中的json处理\"></a>3：JS中的json处理</h1><p>与php中处理方式相对应，存在<code>JSON.stringify</code>和<code>JSON.parse</code>两个函数</p>\n<h2 id=\"3-1-JSON-stringify\"><a href=\"#3-1-JSON-stringify\" class=\"headerlink\" title=\"3.1 JSON.stringify\"></a>3.1 JSON.stringify</h2><p>对象、数组转为字符串格式。</p>\n<p>对象字符串化：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;&#125;;   <span class=\"comment\">//等同于var Person =new Object();</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;</span><br><span class=\"line\">name:<span class=\"string\">&quot;Jason&quot;</span>,</span><br><span class=\"line\">age:<span class=\"number\">21</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> str=<span class=\"built_in\">JSON</span>.stringify(Person)</span><br><span class=\"line\">alert(str);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;Jason&quot;</span>,<span class=\"string\">&quot;age&quot;</span>:<span class=\"number\">21</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>数组字符串化：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> mycars=<span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">mycars[<span class=\"number\">0</span>]=<span class=\"string\">&quot;Saab&quot;</span>;</span><br><span class=\"line\">mycars[<span class=\"number\">1</span>]=<span class=\"string\">&quot;Volvo&quot;</span>;</span><br><span class=\"line\">mycars[<span class=\"number\">2</span>]=<span class=\"string\">&quot;BMW&quot;</span>;</span><br><span class=\"line\">alert(<span class=\"built_in\">JSON</span>.stringify(mycars));</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">&quot;Saab&quot;</span>,<span class=\"string\">&quot;Volvo&quot;</span>,<span class=\"string\">&quot;BMW&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-JSON-parse\"><a href=\"#3-2-JSON-parse\" class=\"headerlink\" title=\"3.2 JSON.parse\"></a>3.2 JSON.parse</h2><p>字符串转数组、对象。</p>\n<ul>\n<li>转对象：</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\\/\\/example.com\\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj= <span class=\"built_in\">JSON</span>.parse(str);</span><br><span class=\"line\">alert(obj);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[object <span class=\"built_in\">Object</span>]</span><br></pre></td></tr></table></figure>\n\n<p>以上说明输出的数据格式为对象。</p>\n<ul>\n<li>转数组：</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr= <span class=\"built_in\">JSON</span>.parse(str);</span><br><span class=\"line\">alert(arr);</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a,b,c</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-对象数组操作\"><a href=\"#3-3-对象数组操作\" class=\"headerlink\" title=\"3.3 对象数组操作\"></a>3.3 对象数组操作</h2><h3 id=\"3-3-1-对象操作\"><a href=\"#3-3-1-对象操作\" class=\"headerlink\" title=\"3.3.1 对象操作\"></a>3.3.1 对象操作</h3><p>创建对象：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;&#125;;   <span class=\"comment\">//等同于var Person =new Object();</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Person=&#123;</span><br><span class=\"line\">name:<span class=\"string\">&quot;Jason&quot;</span>,</span><br><span class=\"line\">age:<span class=\"number\">21</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>获取name对应的键值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = Person.name;</span><br><span class=\"line\">alert(name);</span><br></pre></td></tr></table></figure>\n\n<p>或者：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = Person[<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">alert(name);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3-2-数组操作\"><a href=\"#3-3-2-数组操作\" class=\"headerlink\" title=\"3.3.2 数组操作\"></a>3.3.2 数组操作</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">&#x27;a&#x27;</span>,<span class=\"string\">&#x27;b&#x27;</span>,<span class=\"string\">&#x27;c&#x27;</span>];</span><br><span class=\"line\">alert(arr[<span class=\"number\">0</span>]);</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Fri Jul 17 2020 07:58:01 GMT+0200 (GMT+02:00)","title":"php和js中的JSON操作","path":"2020/07/17/php和js中的JSON操作/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-07-17T09:45:51.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-17T09:45:51.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["JSON"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"使用JsDelivr给静态资源加速","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-07-11T20:37:07.000Z","password":null,"summary":"利用JsDelivr使github上托管的静态资源获得CDN加速。","_content":"\n\n\ngithub仓库里的js、css静态资源是无法被直接放在网页的静态资源url里的，因此，需要借助第三方工具来引用。\n\n这里使用JsDelivr。\n\n### 说明\n\n打开[jsDeliver官网](https://www.jsdelivr.com/)，可以看到使用方式：\n\n```\n// load any GitHub release or commit\n\n// note: we recommend using npm for projects that support it\n\nhttps://cdn.jsdelivr.net/gh/user/repo@version/file\n```\n\n> user：github用户名\n>\n> repo：仓库名\n>\n> version：(Tag)版本名\n>\n> file：文件路径\n\n### 步骤\n\n第一步：将静态资源push到仓库\n\n第二步：release一个版本\n\n第三步：根据上面的cdn方式，获取静态资源cdn资源。\n\n### 参考资料\n\n《[使用Github托管js和css文件](https://sparkydogx.github.io/2018/10/12/use-github-js-css/)》","source":"_posts/使用JsDelivr给静态资源加速.md","raw":"---\ntitle: 使用JsDelivr给静态资源加速\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-07-11 22:37:07\npassword:\nsummary: 利用JsDelivr使github上托管的静态资源获得CDN加速。\ntags: JsDelivr\ncategories: 网站编程\n---\n\n\n\ngithub仓库里的js、css静态资源是无法被直接放在网页的静态资源url里的，因此，需要借助第三方工具来引用。\n\n这里使用JsDelivr。\n\n### 说明\n\n打开[jsDeliver官网](https://www.jsdelivr.com/)，可以看到使用方式：\n\n```\n// load any GitHub release or commit\n\n// note: we recommend using npm for projects that support it\n\nhttps://cdn.jsdelivr.net/gh/user/repo@version/file\n```\n\n> user：github用户名\n>\n> repo：仓库名\n>\n> version：(Tag)版本名\n>\n> file：文件路径\n\n### 步骤\n\n第一步：将静态资源push到仓库\n\n第二步：release一个版本\n\n第三步：根据上面的cdn方式，获取静态资源cdn资源。\n\n### 参考资料\n\n《[使用Github托管js和css文件](https://sparkydogx.github.io/2018/10/12/use-github-js-css/)》","slug":"使用JsDelivr给静态资源加速","published":1,"updated":"2020-07-17T06:03:20.717Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaby0023p0vzh3pd3fxu","content":"<p>github仓库里的js、css静态资源是无法被直接放在网页的静态资源url里的，因此，需要借助第三方工具来引用。</p>\n<p>这里使用JsDelivr。</p>\n<h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h3><p>打开<a href=\"https://www.jsdelivr.com/\">jsDeliver官网</a>，可以看到使用方式：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; load any GitHub release or commit</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; note: we recommend using npm for projects that support it</span><br><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;user&#x2F;repo@version&#x2F;file</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>user：github用户名</p>\n<p>repo：仓库名</p>\n<p>version：(Tag)版本名</p>\n<p>file：文件路径</p>\n</blockquote>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>第一步：将静态资源push到仓库</p>\n<p>第二步：release一个版本</p>\n<p>第三步：根据上面的cdn方式，获取静态资源cdn资源。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p>《<a href=\"https://sparkydogx.github.io/2018/10/12/use-github-js-css/\">使用Github托管js和css文件</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>github仓库里的js、css静态资源是无法被直接放在网页的静态资源url里的，因此，需要借助第三方工具来引用。</p>\n<p>这里使用JsDelivr。</p>\n<h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h3><p>打开<a href=\"https://www.jsdelivr.com/\">jsDeliver官网</a>，可以看到使用方式：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; load any GitHub release or commit</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; note: we recommend using npm for projects that support it</span><br><span class=\"line\"></span><br><span class=\"line\">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;user&#x2F;repo@version&#x2F;file</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>user：github用户名</p>\n<p>repo：仓库名</p>\n<p>version：(Tag)版本名</p>\n<p>file：文件路径</p>\n</blockquote>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>第一步：将静态资源push到仓库</p>\n<p>第二步：release一个版本</p>\n<p>第三步：根据上面的cdn方式，获取静态资源cdn资源。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p>《<a href=\"https://sparkydogx.github.io/2018/10/12/use-github-js-css/\">使用Github托管js和css文件</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Fri Jul 17 2020 08:03:20 GMT+0200 (GMT+02:00)","title":"使用JsDelivr给静态资源加速","path":"2020/07/11/使用JsDelivr给静态资源加速/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-07-11T20:37:07.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-11T20:37:07.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["JsDelivr"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"使用Magento创建电商网站记录","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-01-24T22:00:48.000Z","password":null,"summary":"Magento是一个开源的购物商城，由于它高度的可重写性，受到了众多商城构建者的青睐。然而由于它庞大的体积，对服务器的要求非常高。本文介绍了，我从magento安装到放弃的全过程。","_content":"\n# 0：绪论\n\n安装教程使用magento中国官网的提示，教程原地址为https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html\n\n我是用composer安装magento，composer在宝塔面板安装php时已默认安装了，所以能直接用。若未使用宝塔面板需优先安装composer。使用以下命令下载运行composer。若已有则跳过。\n\n`curl -sS https://getcomposer.org/installer | php`\n\n使用以下命令将composer添加至全局，以便在任意目录下使用composer指令\n\n`mv composer.phar /usr/local/bin/composer`\n\n# 1：php环境配置\n\n一下内容的操作，在宝塔控制面板，软件商店，运行环境，php设置里能找到\n\n**Magento安装时PHP环境需要检查以下扩展：**\n\n- PHP Extension curl.\n- PHP Extension iconv.\n- PHP Extension mbstring.\n- PHP Extension dom.\n- PHP Extension hash.\n- PHP Extension openssl.\n- PHP Extension xmlwriter.\n- PHP Extension pcre.\n- PHP Extension gd.\n- PHP Extension bcmath.\n- PHP Extension simplexml.\n- PHP Extension spl.\n- PHP Extension xsl.\n- PHP Extension intl.\n- PHP Extension ctype.\n- PHP Extension pdo_mysql.\n- PHP Extension soap.\n- PHP Extension zip.\n- PHP Extension phar.\n- PHP Extension libxml.\n\n **取消函数禁用**\n\n- openlog、syslog、symlink、exec等\n- 还有些函数需要取消禁用，可根据安装时的错误提示操作\n\n \n\n# 2：开始安装\n\n打开xshell或其他ssh面板，在使用cd指令，进入网站根目录，例如/var/www，输入指令\n\n`composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition  magento2`\n\n其中magento2指，网站将被放在/var/www/magento2目录下，删除此字段，magento会放在/var/www目录下。\n\n提示输入username和password。\n\n1. 首先您先登录[Magento的官方商店](https://marketplace.magento.com/)。\n2. 点击“Sign In”登录到您的账号，如果还没有账号,需要先注册。\n3. 当登录之后，点击\"My Access Keys\".如果找不到，可以使用CTRL+F键进行搜索.\n4. 点击“Create a New Access Key”后，找到“Generate New”,为自己的Magento2生成一个Key.\n5. 记录下生成的Public key及Private key\n\n其中public key是用户名，private key是密码。\n\n完成安装后在网站目录下就没能看到magento2目录了，由于magento需要文件写权限。使用composer安装时，magetno文件的所有者是运行指令时的用户，也就是说通常是root。那么假定网站用户是www，则在运行安装程序时，www将无法对文件进行写操作，因此，需要更改文件权限，或者所有者。。不建议将文件权限修改，我们只需要修改文件所有者即可。。\n\n使用宝塔面板可直接在文件里修改所有者。xshell使用chmod指令，详细方法请自行查阅。**请注意：文件所有者不更改，打开http://域名/magento2，无法进入安装界面**\n\n修改完毕后就可以直接输入http://域名/magento2/setup进行安装了。如果你遇到这个问题\n\n**长时间安装不上，服务器cpu过载问题**\n\n请尝试使用指令安装\n\n首先将magento添加到环境变量,请自行修改自己的magento2文件夹位置。\n\n`export PATH=$PATH:/var/www/html/magento2/bin`\n\n然后cd到magento2安装目录下\n\n```\nphp setup/index.php\n--db_host=localhost \\\n--db_name=magento2 \\\n--db_user=root \\\n--db_pass=canbempty \\\n--backend_frontname=admin \\\n--admin_username=username \\\n--admin_password=password \\\n--admin_email=admin@email.local \\\n--admin_firstname=First \\\n--admin_lastname=Last \\\n--base_url=http://magento2.local/ \\\n--base_url_secure=http://magento2.local/ \\\n--language=en_US \\\n--currency=USD \\\n--use_rewrites=true \\\n--use_secure=false \\\n--use_secure_admin=false \\\n--cleanup_database\n```\n\n上面的参数请根据自己的需要进行修改,比如base_url就是您的网址,admin_*将是您后台管理员用户名或密码.\n\n等待安装如果遇到提示\n\n```\nERROR 1419 (HY000): You do not have the SUPER privilege and\nbinary logging is enabled (you *might* want to use the less safe\nlog_bin_trust_routine_creators variable)\n```\n\n请在你的系统中查找my.cnf文件，通常在/etc/my.cnf下，文件中 **[mysqld]** 标记后加一行内容为**log-bin-trust-function-creators=1**\n\n然后运行\n\n`service mysql restart`\n\n重启mysql。然后重新**php setup/index.php**以及其后指令。完成安装。\n\n```\n[SUCCESS]: Magento installation complete.\n[SUCCESS]: Magento Admin URI: /admin_xgswzt\nNothing to import.\n```\n\n出现此提示，则完成安装。\n\n然后修改网站伪静态规则，Nginx：\n\n```\nlocation / {\n        index index.html index.php; ## Allow a static html file to be shown first\n        try_files $uri $uri/ @handler; \n        expires 30d;\n    }\n\nlocation /var/export/ { ## Allow admins only to view export folder\n    auth_basic           \"Restricted\"; ## Message shown in login window\n    auth_basic_user_file htpasswd; ## See /etc/nginx/htpassword\n    autoindex            on;\n}\n  location  /. { ## Disable .htaccess and other hidden files\n    return 404;\n}\n\nlocation @handler { ## Magento uses a common front handler\n    rewrite / /index.php;\n}\n\nlocation ~ .php/ { ## Forward paths like /js/index.php/x.js to relevant handler\n    rewrite ^(.*.php)/ $1 last;\n}\n```\n\n# 3： 宝塔面板安装失败\n\n建议不要采用宝塔面板安装，在使用宝塔面板进行安装后，网站无法运行，查看错误日志，提示**http://域名/magento2/magento2文件不存在**\n\n修改网站根目录还是无法进入，提示\n\n`An error has happened during application run. See exception log for details.`\n\n","source":"_posts/使用Magento创建电商网站记录.md","raw":"---\ntitle: 使用Magento创建电商网站记录\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-01-24 23:00:48\npassword:\nsummary: Magento是一个开源的购物商城，由于它高度的可重写性，受到了众多商城构建者的青睐。然而由于它庞大的体积，对服务器的要求非常高。本文介绍了，我从magento安装到放弃的全过程。\ntags: Magento\ncategories: 网站编程\n---\n\n# 0：绪论\n\n安装教程使用magento中国官网的提示，教程原地址为https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html\n\n我是用composer安装magento，composer在宝塔面板安装php时已默认安装了，所以能直接用。若未使用宝塔面板需优先安装composer。使用以下命令下载运行composer。若已有则跳过。\n\n`curl -sS https://getcomposer.org/installer | php`\n\n使用以下命令将composer添加至全局，以便在任意目录下使用composer指令\n\n`mv composer.phar /usr/local/bin/composer`\n\n# 1：php环境配置\n\n一下内容的操作，在宝塔控制面板，软件商店，运行环境，php设置里能找到\n\n**Magento安装时PHP环境需要检查以下扩展：**\n\n- PHP Extension curl.\n- PHP Extension iconv.\n- PHP Extension mbstring.\n- PHP Extension dom.\n- PHP Extension hash.\n- PHP Extension openssl.\n- PHP Extension xmlwriter.\n- PHP Extension pcre.\n- PHP Extension gd.\n- PHP Extension bcmath.\n- PHP Extension simplexml.\n- PHP Extension spl.\n- PHP Extension xsl.\n- PHP Extension intl.\n- PHP Extension ctype.\n- PHP Extension pdo_mysql.\n- PHP Extension soap.\n- PHP Extension zip.\n- PHP Extension phar.\n- PHP Extension libxml.\n\n **取消函数禁用**\n\n- openlog、syslog、symlink、exec等\n- 还有些函数需要取消禁用，可根据安装时的错误提示操作\n\n \n\n# 2：开始安装\n\n打开xshell或其他ssh面板，在使用cd指令，进入网站根目录，例如/var/www，输入指令\n\n`composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition  magento2`\n\n其中magento2指，网站将被放在/var/www/magento2目录下，删除此字段，magento会放在/var/www目录下。\n\n提示输入username和password。\n\n1. 首先您先登录[Magento的官方商店](https://marketplace.magento.com/)。\n2. 点击“Sign In”登录到您的账号，如果还没有账号,需要先注册。\n3. 当登录之后，点击\"My Access Keys\".如果找不到，可以使用CTRL+F键进行搜索.\n4. 点击“Create a New Access Key”后，找到“Generate New”,为自己的Magento2生成一个Key.\n5. 记录下生成的Public key及Private key\n\n其中public key是用户名，private key是密码。\n\n完成安装后在网站目录下就没能看到magento2目录了，由于magento需要文件写权限。使用composer安装时，magetno文件的所有者是运行指令时的用户，也就是说通常是root。那么假定网站用户是www，则在运行安装程序时，www将无法对文件进行写操作，因此，需要更改文件权限，或者所有者。。不建议将文件权限修改，我们只需要修改文件所有者即可。。\n\n使用宝塔面板可直接在文件里修改所有者。xshell使用chmod指令，详细方法请自行查阅。**请注意：文件所有者不更改，打开http://域名/magento2，无法进入安装界面**\n\n修改完毕后就可以直接输入http://域名/magento2/setup进行安装了。如果你遇到这个问题\n\n**长时间安装不上，服务器cpu过载问题**\n\n请尝试使用指令安装\n\n首先将magento添加到环境变量,请自行修改自己的magento2文件夹位置。\n\n`export PATH=$PATH:/var/www/html/magento2/bin`\n\n然后cd到magento2安装目录下\n\n```\nphp setup/index.php\n--db_host=localhost \\\n--db_name=magento2 \\\n--db_user=root \\\n--db_pass=canbempty \\\n--backend_frontname=admin \\\n--admin_username=username \\\n--admin_password=password \\\n--admin_email=admin@email.local \\\n--admin_firstname=First \\\n--admin_lastname=Last \\\n--base_url=http://magento2.local/ \\\n--base_url_secure=http://magento2.local/ \\\n--language=en_US \\\n--currency=USD \\\n--use_rewrites=true \\\n--use_secure=false \\\n--use_secure_admin=false \\\n--cleanup_database\n```\n\n上面的参数请根据自己的需要进行修改,比如base_url就是您的网址,admin_*将是您后台管理员用户名或密码.\n\n等待安装如果遇到提示\n\n```\nERROR 1419 (HY000): You do not have the SUPER privilege and\nbinary logging is enabled (you *might* want to use the less safe\nlog_bin_trust_routine_creators variable)\n```\n\n请在你的系统中查找my.cnf文件，通常在/etc/my.cnf下，文件中 **[mysqld]** 标记后加一行内容为**log-bin-trust-function-creators=1**\n\n然后运行\n\n`service mysql restart`\n\n重启mysql。然后重新**php setup/index.php**以及其后指令。完成安装。\n\n```\n[SUCCESS]: Magento installation complete.\n[SUCCESS]: Magento Admin URI: /admin_xgswzt\nNothing to import.\n```\n\n出现此提示，则完成安装。\n\n然后修改网站伪静态规则，Nginx：\n\n```\nlocation / {\n        index index.html index.php; ## Allow a static html file to be shown first\n        try_files $uri $uri/ @handler; \n        expires 30d;\n    }\n\nlocation /var/export/ { ## Allow admins only to view export folder\n    auth_basic           \"Restricted\"; ## Message shown in login window\n    auth_basic_user_file htpasswd; ## See /etc/nginx/htpassword\n    autoindex            on;\n}\n  location  /. { ## Disable .htaccess and other hidden files\n    return 404;\n}\n\nlocation @handler { ## Magento uses a common front handler\n    rewrite / /index.php;\n}\n\nlocation ~ .php/ { ## Forward paths like /js/index.php/x.js to relevant handler\n    rewrite ^(.*.php)/ $1 last;\n}\n```\n\n# 3： 宝塔面板安装失败\n\n建议不要采用宝塔面板安装，在使用宝塔面板进行安装后，网站无法运行，查看错误日志，提示**http://域名/magento2/magento2文件不存在**\n\n修改网站根目录还是无法进入，提示\n\n`An error has happened during application run. See exception log for details.`\n\n","slug":"使用Magento创建电商网站记录","published":1,"updated":"2020-06-18T07:22:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsac20026p0vz3fwwgec9","content":"<h1 id=\"0：绪论\"><a href=\"#0：绪论\" class=\"headerlink\" title=\"0：绪论\"></a>0：绪论</h1><p>安装教程使用magento中国官网的提示，教程原地址为<a href=\"https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html\">https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html</a></p>\n<p>我是用composer安装magento，composer在宝塔面板安装php时已默认安装了，所以能直接用。若未使用宝塔面板需优先安装composer。使用以下命令下载运行composer。若已有则跳过。</p>\n<p><code>curl -sS https://getcomposer.org/installer | php</code></p>\n<p>使用以下命令将composer添加至全局，以便在任意目录下使用composer指令</p>\n<p><code>mv composer.phar /usr/local/bin/composer</code></p>\n<h1 id=\"1：php环境配置\"><a href=\"#1：php环境配置\" class=\"headerlink\" title=\"1：php环境配置\"></a>1：php环境配置</h1><p>一下内容的操作，在宝塔控制面板，软件商店，运行环境，php设置里能找到</p>\n<p><strong>Magento安装时PHP环境需要检查以下扩展：</strong></p>\n<ul>\n<li><p>PHP Extension curl.</p>\n</li>\n<li><p>PHP Extension iconv.</p>\n</li>\n<li><p>PHP Extension mbstring.</p>\n</li>\n<li><p>PHP Extension dom.</p>\n</li>\n<li><p>PHP Extension hash.</p>\n</li>\n<li><p>PHP Extension openssl.</p>\n</li>\n<li><p>PHP Extension xmlwriter.</p>\n</li>\n<li><p>PHP Extension pcre.</p>\n</li>\n<li><p>PHP Extension gd.</p>\n</li>\n<li><p>PHP Extension bcmath.</p>\n</li>\n<li><p>PHP Extension simplexml.</p>\n</li>\n<li><p>PHP Extension spl.</p>\n</li>\n<li><p>PHP Extension xsl.</p>\n</li>\n<li><p>PHP Extension intl.</p>\n</li>\n<li><p>PHP Extension ctype.</p>\n</li>\n<li><p>PHP Extension pdo_mysql.</p>\n</li>\n<li><p>PHP Extension soap.</p>\n</li>\n<li><p>PHP Extension zip.</p>\n</li>\n<li><p>PHP Extension phar.</p>\n</li>\n<li><p>PHP Extension libxml.</p>\n<p><strong>取消函数禁用</strong></p>\n</li>\n<li><p>openlog、syslog、symlink、exec等</p>\n</li>\n<li><p>还有些函数需要取消禁用，可根据安装时的错误提示操作</p>\n</li>\n</ul>\n<h1 id=\"2：开始安装\"><a href=\"#2：开始安装\" class=\"headerlink\" title=\"2：开始安装\"></a>2：开始安装</h1><p>打开xshell或其他ssh面板，在使用cd指令，进入网站根目录，例如/var/www，输入指令</p>\n<p><code>composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition  magento2</code></p>\n<p>其中magento2指，网站将被放在/var/www/magento2目录下，删除此字段，magento会放在/var/www目录下。</p>\n<p>提示输入username和password。</p>\n<ol>\n<li>首先您先登录<a href=\"https://marketplace.magento.com/\">Magento的官方商店</a>。</li>\n<li>点击“Sign In”登录到您的账号，如果还没有账号,需要先注册。</li>\n<li>当登录之后，点击”My Access Keys”.如果找不到，可以使用CTRL+F键进行搜索.</li>\n<li>点击“Create a New Access Key”后，找到“Generate New”,为自己的Magento2生成一个Key.</li>\n<li>记录下生成的Public key及Private key</li>\n</ol>\n<p>其中public key是用户名，private key是密码。</p>\n<p>完成安装后在网站目录下就没能看到magento2目录了，由于magento需要文件写权限。使用composer安装时，magetno文件的所有者是运行指令时的用户，也就是说通常是root。那么假定网站用户是www，则在运行安装程序时，www将无法对文件进行写操作，因此，需要更改文件权限，或者所有者。。不建议将文件权限修改，我们只需要修改文件所有者即可。。</p>\n<p>使用宝塔面板可直接在文件里修改所有者。xshell使用chmod指令，详细方法请自行查阅。<strong>请注意：文件所有者不更改，打开http://域名/magento2，无法进入安装界面</strong></p>\n<p>修改完毕后就可以直接输入http://域名/magento2/setup进行安装了。如果你遇到这个问题</p>\n<p><strong>长时间安装不上，服务器cpu过载问题</strong></p>\n<p>请尝试使用指令安装</p>\n<p>首先将magento添加到环境变量,请自行修改自己的magento2文件夹位置。</p>\n<p><code>export PATH=$PATH:/var/www/html/magento2/bin</code></p>\n<p>然后cd到magento2安装目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php setup&#x2F;index.php</span><br><span class=\"line\">--db_host&#x3D;localhost \\</span><br><span class=\"line\">--db_name&#x3D;magento2 \\</span><br><span class=\"line\">--db_user&#x3D;root \\</span><br><span class=\"line\">--db_pass&#x3D;canbempty \\</span><br><span class=\"line\">--backend_frontname&#x3D;admin \\</span><br><span class=\"line\">--admin_username&#x3D;username \\</span><br><span class=\"line\">--admin_password&#x3D;password \\</span><br><span class=\"line\">--admin_email&#x3D;admin@email.local \\</span><br><span class=\"line\">--admin_firstname&#x3D;First \\</span><br><span class=\"line\">--admin_lastname&#x3D;Last \\</span><br><span class=\"line\">--base_url&#x3D;http:&#x2F;&#x2F;magento2.local&#x2F; \\</span><br><span class=\"line\">--base_url_secure&#x3D;http:&#x2F;&#x2F;magento2.local&#x2F; \\</span><br><span class=\"line\">--language&#x3D;en_US \\</span><br><span class=\"line\">--currency&#x3D;USD \\</span><br><span class=\"line\">--use_rewrites&#x3D;true \\</span><br><span class=\"line\">--use_secure&#x3D;false \\</span><br><span class=\"line\">--use_secure_admin&#x3D;false \\</span><br><span class=\"line\">--cleanup_database</span><br></pre></td></tr></table></figure>\n\n<p>上面的参数请根据自己的需要进行修改,比如base_url就是您的网址,admin_*将是您后台管理员用户名或密码.</p>\n<p>等待安装如果遇到提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR 1419 (HY000): You do not have the SUPER privilege and</span><br><span class=\"line\">binary logging is enabled (you *might* want to use the less safe</span><br><span class=\"line\">log_bin_trust_routine_creators variable)</span><br></pre></td></tr></table></figure>\n\n<p>请在你的系统中查找my.cnf文件，通常在/etc/my.cnf下，文件中 <strong>[mysqld]</strong> 标记后加一行内容为<strong>log-bin-trust-function-creators=1</strong></p>\n<p>然后运行</p>\n<p><code>service mysql restart</code></p>\n<p>重启mysql。然后重新<strong>php setup/index.php</strong>以及其后指令。完成安装。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[SUCCESS]: Magento installation complete.</span><br><span class=\"line\">[SUCCESS]: Magento Admin URI: &#x2F;admin_xgswzt</span><br><span class=\"line\">Nothing to import.</span><br></pre></td></tr></table></figure>\n\n<p>出现此提示，则完成安装。</p>\n<p>然后修改网站伪静态规则，Nginx：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location &#x2F; &#123;</span><br><span class=\"line\">        index index.html index.php; ## Allow a static html file to be shown first</span><br><span class=\"line\">        try_files $uri $uri&#x2F; @handler; </span><br><span class=\"line\">        expires 30d;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">location &#x2F;var&#x2F;export&#x2F; &#123; ## Allow admins only to view export folder</span><br><span class=\"line\">    auth_basic           &quot;Restricted&quot;; ## Message shown in login window</span><br><span class=\"line\">    auth_basic_user_file htpasswd; ## See &#x2F;etc&#x2F;nginx&#x2F;htpassword</span><br><span class=\"line\">    autoindex            on;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  location  &#x2F;. &#123; ## Disable .htaccess and other hidden files</span><br><span class=\"line\">    return 404;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">location @handler &#123; ## Magento uses a common front handler</span><br><span class=\"line\">    rewrite &#x2F; &#x2F;index.php;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">location ~ .php&#x2F; &#123; ## Forward paths like &#x2F;js&#x2F;index.php&#x2F;x.js to relevant handler</span><br><span class=\"line\">    rewrite ^(.*.php)&#x2F; $1 last;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：-宝塔面板安装失败\"><a href=\"#3：-宝塔面板安装失败\" class=\"headerlink\" title=\"3： 宝塔面板安装失败\"></a>3： 宝塔面板安装失败</h1><p>建议不要采用宝塔面板安装，在使用宝塔面板进行安装后，网站无法运行，查看错误日志，提示<strong>http://域名/magento2/magento2文件不存在</strong></p>\n<p>修改网站根目录还是无法进入，提示</p>\n<p><code>An error has happened during application run. See exception log for details.</code></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：绪论\"><a href=\"#0：绪论\" class=\"headerlink\" title=\"0：绪论\"></a>0：绪论</h1><p>安装教程使用magento中国官网的提示，教程原地址为<a href=\"https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html\">https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html</a></p>\n<p>我是用composer安装magento，composer在宝塔面板安装php时已默认安装了，所以能直接用。若未使用宝塔面板需优先安装composer。使用以下命令下载运行composer。若已有则跳过。</p>\n<p><code>curl -sS https://getcomposer.org/installer | php</code></p>\n<p>使用以下命令将composer添加至全局，以便在任意目录下使用composer指令</p>\n<p><code>mv composer.phar /usr/local/bin/composer</code></p>\n<h1 id=\"1：php环境配置\"><a href=\"#1：php环境配置\" class=\"headerlink\" title=\"1：php环境配置\"></a>1：php环境配置</h1><p>一下内容的操作，在宝塔控制面板，软件商店，运行环境，php设置里能找到</p>\n<p><strong>Magento安装时PHP环境需要检查以下扩展：</strong></p>\n<ul>\n<li><p>PHP Extension curl.</p>\n</li>\n<li><p>PHP Extension iconv.</p>\n</li>\n<li><p>PHP Extension mbstring.</p>\n</li>\n<li><p>PHP Extension dom.</p>\n</li>\n<li><p>PHP Extension hash.</p>\n</li>\n<li><p>PHP Extension openssl.</p>\n</li>\n<li><p>PHP Extension xmlwriter.</p>\n</li>\n<li><p>PHP Extension pcre.</p>\n</li>\n<li><p>PHP Extension gd.</p>\n</li>\n<li><p>PHP Extension bcmath.</p>\n</li>\n<li><p>PHP Extension simplexml.</p>\n</li>\n<li><p>PHP Extension spl.</p>\n</li>\n<li><p>PHP Extension xsl.</p>\n</li>\n<li><p>PHP Extension intl.</p>\n</li>\n<li><p>PHP Extension ctype.</p>\n</li>\n<li><p>PHP Extension pdo_mysql.</p>\n</li>\n<li><p>PHP Extension soap.</p>\n</li>\n<li><p>PHP Extension zip.</p>\n</li>\n<li><p>PHP Extension phar.</p>\n</li>\n<li><p>PHP Extension libxml.</p>\n<p><strong>取消函数禁用</strong></p>\n</li>\n<li><p>openlog、syslog、symlink、exec等</p>\n</li>\n<li><p>还有些函数需要取消禁用，可根据安装时的错误提示操作</p>\n</li>\n</ul>\n<h1 id=\"2：开始安装\"><a href=\"#2：开始安装\" class=\"headerlink\" title=\"2：开始安装\"></a>2：开始安装</h1><p>打开xshell或其他ssh面板，在使用cd指令，进入网站根目录，例如/var/www，输入指令</p>\n<p><code>composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition  magento2</code></p>\n<p>其中magento2指，网站将被放在/var/www/magento2目录下，删除此字段，magento会放在/var/www目录下。</p>\n<p>提示输入username和password。</p>\n<ol>\n<li>首先您先登录<a href=\"https://marketplace.magento.com/\">Magento的官方商店</a>。</li>\n<li>点击“Sign In”登录到您的账号，如果还没有账号,需要先注册。</li>\n<li>当登录之后，点击”My Access Keys”.如果找不到，可以使用CTRL+F键进行搜索.</li>\n<li>点击“Create a New Access Key”后，找到“Generate New”,为自己的Magento2生成一个Key.</li>\n<li>记录下生成的Public key及Private key</li>\n</ol>\n<p>其中public key是用户名，private key是密码。</p>\n<p>完成安装后在网站目录下就没能看到magento2目录了，由于magento需要文件写权限。使用composer安装时，magetno文件的所有者是运行指令时的用户，也就是说通常是root。那么假定网站用户是www，则在运行安装程序时，www将无法对文件进行写操作，因此，需要更改文件权限，或者所有者。。不建议将文件权限修改，我们只需要修改文件所有者即可。。</p>\n<p>使用宝塔面板可直接在文件里修改所有者。xshell使用chmod指令，详细方法请自行查阅。<strong>请注意：文件所有者不更改，打开http://域名/magento2，无法进入安装界面</strong></p>\n<p>修改完毕后就可以直接输入http://域名/magento2/setup进行安装了。如果你遇到这个问题</p>\n<p><strong>长时间安装不上，服务器cpu过载问题</strong></p>\n<p>请尝试使用指令安装</p>\n<p>首先将magento添加到环境变量,请自行修改自己的magento2文件夹位置。</p>\n<p><code>export PATH=$PATH:/var/www/html/magento2/bin</code></p>\n<p>然后cd到magento2安装目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php setup&#x2F;index.php</span><br><span class=\"line\">--db_host&#x3D;localhost \\</span><br><span class=\"line\">--db_name&#x3D;magento2 \\</span><br><span class=\"line\">--db_user&#x3D;root \\</span><br><span class=\"line\">--db_pass&#x3D;canbempty \\</span><br><span class=\"line\">--backend_frontname&#x3D;admin \\</span><br><span class=\"line\">--admin_username&#x3D;username \\</span><br><span class=\"line\">--admin_password&#x3D;password \\</span><br><span class=\"line\">--admin_email&#x3D;admin@email.local \\</span><br><span class=\"line\">--admin_firstname&#x3D;First \\</span><br><span class=\"line\">--admin_lastname&#x3D;Last \\</span><br><span class=\"line\">--base_url&#x3D;http:&#x2F;&#x2F;magento2.local&#x2F; \\</span><br><span class=\"line\">--base_url_secure&#x3D;http:&#x2F;&#x2F;magento2.local&#x2F; \\</span><br><span class=\"line\">--language&#x3D;en_US \\</span><br><span class=\"line\">--currency&#x3D;USD \\</span><br><span class=\"line\">--use_rewrites&#x3D;true \\</span><br><span class=\"line\">--use_secure&#x3D;false \\</span><br><span class=\"line\">--use_secure_admin&#x3D;false \\</span><br><span class=\"line\">--cleanup_database</span><br></pre></td></tr></table></figure>\n\n<p>上面的参数请根据自己的需要进行修改,比如base_url就是您的网址,admin_*将是您后台管理员用户名或密码.</p>\n<p>等待安装如果遇到提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR 1419 (HY000): You do not have the SUPER privilege and</span><br><span class=\"line\">binary logging is enabled (you *might* want to use the less safe</span><br><span class=\"line\">log_bin_trust_routine_creators variable)</span><br></pre></td></tr></table></figure>\n\n<p>请在你的系统中查找my.cnf文件，通常在/etc/my.cnf下，文件中 <strong>[mysqld]</strong> 标记后加一行内容为<strong>log-bin-trust-function-creators=1</strong></p>\n<p>然后运行</p>\n<p><code>service mysql restart</code></p>\n<p>重启mysql。然后重新<strong>php setup/index.php</strong>以及其后指令。完成安装。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[SUCCESS]: Magento installation complete.</span><br><span class=\"line\">[SUCCESS]: Magento Admin URI: &#x2F;admin_xgswzt</span><br><span class=\"line\">Nothing to import.</span><br></pre></td></tr></table></figure>\n\n<p>出现此提示，则完成安装。</p>\n<p>然后修改网站伪静态规则，Nginx：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location &#x2F; &#123;</span><br><span class=\"line\">        index index.html index.php; ## Allow a static html file to be shown first</span><br><span class=\"line\">        try_files $uri $uri&#x2F; @handler; </span><br><span class=\"line\">        expires 30d;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">location &#x2F;var&#x2F;export&#x2F; &#123; ## Allow admins only to view export folder</span><br><span class=\"line\">    auth_basic           &quot;Restricted&quot;; ## Message shown in login window</span><br><span class=\"line\">    auth_basic_user_file htpasswd; ## See &#x2F;etc&#x2F;nginx&#x2F;htpassword</span><br><span class=\"line\">    autoindex            on;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  location  &#x2F;. &#123; ## Disable .htaccess and other hidden files</span><br><span class=\"line\">    return 404;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">location @handler &#123; ## Magento uses a common front handler</span><br><span class=\"line\">    rewrite &#x2F; &#x2F;index.php;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">location ~ .php&#x2F; &#123; ## Forward paths like &#x2F;js&#x2F;index.php&#x2F;x.js to relevant handler</span><br><span class=\"line\">    rewrite ^(.*.php)&#x2F; $1 last;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：-宝塔面板安装失败\"><a href=\"#3：-宝塔面板安装失败\" class=\"headerlink\" title=\"3： 宝塔面板安装失败\"></a>3： 宝塔面板安装失败</h1><p>建议不要采用宝塔面板安装，在使用宝塔面板进行安装后，网站无法运行，查看错误日志，提示<strong>http://域名/magento2/magento2文件不存在</strong></p>\n<p>修改网站根目录还是无法进入，提示</p>\n<p><code>An error has happened during application run. See exception log for details.</code></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Thu Jun 18 2020 09:22:12 GMT+0200 (GMT+02:00)","title":"使用Magento创建电商网站记录","path":"2020/01/24/使用Magento创建电商网站记录/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-01-24T22:00:48.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-01-24T22:00:48.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["Magento"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"利用树莓派定时抢图书馆座位","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-27T16:49:13.000Z","password":null,"summary":null,"_content":"\n# 1：需求分析\n\n由于新冠疫情的影响，学校图书馆和自习室必须在监管之下运行，每日提供的坐席和开放时间受限。大部分自习室被关闭，导致坐席需求很大，而供应很少。新规要求，图书馆和自习室的坐席必须在学校官网上预定，而且预定时间是周日到周四早上八点，仅能预定后一天的位置。\n\n在考试周，座位非常难抢到，因此萌发了通过程序抢座的念头。\n\n目前需求是，程序在周天到周日的早上八点启动，并打开抢座页面，抢座后关闭程序。抢座成功后，学校会自动发送抢座成功的邮件。\n\n# 2：软硬件应用\n\n服务器：树莓派4B+、Linux系统\n\n语言：Python\n\n依赖库：Selenium，date\n\nLinux工具：crontab\n\n# 3：抢座程序\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.action_chains import ActionChains\nfrom selenium.webdriver.support.ui import Select\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver.support import expected_conditions as EC\nfrom selenium.webdriver.common.by import By\nfrom time import sleep\nimport datetime\n\n#点击buchen按钮\ndef clickbucheng(driver):\n    inputs = driver.find_elements_by_tag_name('input')\n    for input in inputs:\n        if input.get_attribute('value') == 'buchen':\n            ActionChains(driver).click(input).perform()\n            # writetohtml(driver,r\"C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\1.html\")\n            window = driver.window_handles[1]\n            driver.switch_to.window(window)\n            driver.find_elements_by_css_selector('#bs_form_main > div > div.bs_etvg > div > label > div.bs_form_uni.bs_right.padding0 > input')[0].click()\n            print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": start buchen\")\n            return 1\n    return 0\n\n#发送表格信息\ndef sendform(driver):\n    # writetohtml(driver,r'C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\2.html')\n    #sex:M/W\n    urinfo = {\"sex\":\"M\",\"vorname\":\"***\",\"name\":\"***\",\"strasse\":\"Hai***1\",\"ort\":\"***\",\"status\":\"S-RWTH\",\"matnr\":\"***93\",\"email\":\"im@xieqifei.com\",\"telefon\":\"0049***4845\"}\n    radios = driver.find_elements_by_name('sex')\n    vorname = driver.find_element_by_name('vorname')\n    name = driver.find_element_by_name('name')\n    strasse = driver.find_element_by_name('strasse')\n    ort = driver.find_element_by_name('ort')\n    status = Select(driver.find_element_by_name('statusorig'))\n    matnr = driver.find_element_by_name('matnr')\n    email = driver.find_element_by_name('email')\n    telefon = driver.find_element_by_name('telefon')\n    tnbed = driver.find_element_by_name('tnbed')\n    submit = driver.find_element_by_css_selector('#bs_foot > div.bs_form_row > div.bs_right > input')\n    for radio in radios:\n        if radio.get_attribute(\"value\") == urinfo['sex']:\n            radio.click()\n            break\n    vorname.send_keys(urinfo['vorname'])\n    name.send_keys(urinfo['name'])\n    strasse.send_keys(urinfo['strasse'])\n    ort.send_keys(urinfo['ort'])\n    status.select_by_value(urinfo['status'])\n    matnr.send_keys(urinfo['matnr'])\n    email.send_keys(urinfo['email'])\n    telefon.send_keys(urinfo['telefon'])\n    tnbed.click()\n    telefon.click()\n    sleep(4)\n    # WebDriverWait(driver, 10).until(EC.element_to_be_clickable(By.XPATH,'//*[@id=\"bs_foot\"]/div[3]/div[2]/input'))\n    submit.click()\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": send MsgForm\")\n    return 1\n\n#确认预定\ndef confirm(driver):\n    confirm = driver.find_element_by_css_selector('#bs_foot > div.bs_form_row > div.bs_right > input')\n    confirm.click()\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": confirm,buchen success!\")\n\n#可发送用户名密码抢座\ndef sendpw(driver):\n    logininfo = {\"pw_email\":\"im@xieqifei.com\",\"password\":\"***\"}\n    pw_email = driver.find_element_by_name('pw_email')\n    pw = driver.find_element_by_css_selector('#bs_pw_anm > div:nth-child(3) > div.bs_form_sp2 > input')\n    submit2 = driver.find_element_by_css_selector('#bs_pw_anm > div.bs_form_foot > div.bs_form_row > div.bs_right > input')\n    pw_email.send_keys(logininfo['pw_email'])\n    pw.send_keys(logininfo['password'])\n    # sleep(3)\n    submit2.submit()\n    \n\"\"\"\ndef writetohtml(driver,path):\n    f = open(path,'wb')\n    f.write(driver.page_source.encode(\"utf-8\", \"ignore\"))\n    f.close()   \n\"\"\"    \n\nif __name__ == \"__main__\":\n    #path = \"/home/pi/Programms/getPlatzinBibliothek/chromedriver\"\n    option = webdriver.ChromeOptions()\n    option.add_argument('--headless')\n    driver = webdriver.Chrome(options=option)\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": chrome start up\")\n    # driver.get('file:///C:/Users/97532/Desktop/Anmeldung.html')\n    driver.get('https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html')\n    ok = clickbucheng(driver)\n    count = 0\n    while ok != 1 and count < 10:\n        sleep(1)\n        driver.refresh()\n        ok = clickbucheng(driver)\n        count = count + 1\n    else:\n        if ok == 1:\n            sendform(driver)\n            confirm(driver)\n    #driver.get_screenshot_as_file(r\"/home/pi/Programms/tushuguan.jpg\")\n    sleep(1)\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": chrome shutdown\")\n    driver.quit()\n```\n\n使用Selenium驱动chrome浏览器，实行web自动化，完成抢座功能。\n\n# 4：定时任务\n\n在树莓派上，利用Linux定时工具crontab，指定程序在每周天到周四上午八点运行。\n\n创建shell脚本，bibplatz.sh\n\n```shell\n#!/bin/bash\ncd /home/pi/Programms/getPlatzinBibliothek\npython3 -u getplatz.py > result.log 2>&1\n```\n\n添加任务\n\n```shell\ncrontab -e\n```\n\n在vim编辑器中添加任务\n\n```shell\n0 8 * * 0-4 /home/pi/bibplatz.sh &\n```\n\ncrontab的格式为：* * * * * command\n\n五个*分别代表，分钟，小时，天，月，周\n\n查看任务\n\n```shell\ncrontab -l\n```\n\n# 5：参考资料\n\n《[Linux定时任务Crontab命令详解](https://www.cnblogs.com/intval/p/5763929.html)》\n\n《[Linux后台运行Python程序的几种方法讲解](https://www.jb51.net/article/156969.htm)》\n\n《[linux下后台运行python程序并输出到日志文件中](https://blog.csdn.net/wangshu_liang/article/details/84027148)》","source":"_posts/利用树莓派定时抢图书馆座位.md","raw":"---\ntitle: 利用树莓派定时抢图书馆座位\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-27 18:49:13\npassword:\nsummary:\ntags: \n- Linux\n- 树莓派\ncategories: Linux\n---\n\n# 1：需求分析\n\n由于新冠疫情的影响，学校图书馆和自习室必须在监管之下运行，每日提供的坐席和开放时间受限。大部分自习室被关闭，导致坐席需求很大，而供应很少。新规要求，图书馆和自习室的坐席必须在学校官网上预定，而且预定时间是周日到周四早上八点，仅能预定后一天的位置。\n\n在考试周，座位非常难抢到，因此萌发了通过程序抢座的念头。\n\n目前需求是，程序在周天到周日的早上八点启动，并打开抢座页面，抢座后关闭程序。抢座成功后，学校会自动发送抢座成功的邮件。\n\n# 2：软硬件应用\n\n服务器：树莓派4B+、Linux系统\n\n语言：Python\n\n依赖库：Selenium，date\n\nLinux工具：crontab\n\n# 3：抢座程序\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.action_chains import ActionChains\nfrom selenium.webdriver.support.ui import Select\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver.support import expected_conditions as EC\nfrom selenium.webdriver.common.by import By\nfrom time import sleep\nimport datetime\n\n#点击buchen按钮\ndef clickbucheng(driver):\n    inputs = driver.find_elements_by_tag_name('input')\n    for input in inputs:\n        if input.get_attribute('value') == 'buchen':\n            ActionChains(driver).click(input).perform()\n            # writetohtml(driver,r\"C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\1.html\")\n            window = driver.window_handles[1]\n            driver.switch_to.window(window)\n            driver.find_elements_by_css_selector('#bs_form_main > div > div.bs_etvg > div > label > div.bs_form_uni.bs_right.padding0 > input')[0].click()\n            print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": start buchen\")\n            return 1\n    return 0\n\n#发送表格信息\ndef sendform(driver):\n    # writetohtml(driver,r'C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\2.html')\n    #sex:M/W\n    urinfo = {\"sex\":\"M\",\"vorname\":\"***\",\"name\":\"***\",\"strasse\":\"Hai***1\",\"ort\":\"***\",\"status\":\"S-RWTH\",\"matnr\":\"***93\",\"email\":\"im@xieqifei.com\",\"telefon\":\"0049***4845\"}\n    radios = driver.find_elements_by_name('sex')\n    vorname = driver.find_element_by_name('vorname')\n    name = driver.find_element_by_name('name')\n    strasse = driver.find_element_by_name('strasse')\n    ort = driver.find_element_by_name('ort')\n    status = Select(driver.find_element_by_name('statusorig'))\n    matnr = driver.find_element_by_name('matnr')\n    email = driver.find_element_by_name('email')\n    telefon = driver.find_element_by_name('telefon')\n    tnbed = driver.find_element_by_name('tnbed')\n    submit = driver.find_element_by_css_selector('#bs_foot > div.bs_form_row > div.bs_right > input')\n    for radio in radios:\n        if radio.get_attribute(\"value\") == urinfo['sex']:\n            radio.click()\n            break\n    vorname.send_keys(urinfo['vorname'])\n    name.send_keys(urinfo['name'])\n    strasse.send_keys(urinfo['strasse'])\n    ort.send_keys(urinfo['ort'])\n    status.select_by_value(urinfo['status'])\n    matnr.send_keys(urinfo['matnr'])\n    email.send_keys(urinfo['email'])\n    telefon.send_keys(urinfo['telefon'])\n    tnbed.click()\n    telefon.click()\n    sleep(4)\n    # WebDriverWait(driver, 10).until(EC.element_to_be_clickable(By.XPATH,'//*[@id=\"bs_foot\"]/div[3]/div[2]/input'))\n    submit.click()\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": send MsgForm\")\n    return 1\n\n#确认预定\ndef confirm(driver):\n    confirm = driver.find_element_by_css_selector('#bs_foot > div.bs_form_row > div.bs_right > input')\n    confirm.click()\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": confirm,buchen success!\")\n\n#可发送用户名密码抢座\ndef sendpw(driver):\n    logininfo = {\"pw_email\":\"im@xieqifei.com\",\"password\":\"***\"}\n    pw_email = driver.find_element_by_name('pw_email')\n    pw = driver.find_element_by_css_selector('#bs_pw_anm > div:nth-child(3) > div.bs_form_sp2 > input')\n    submit2 = driver.find_element_by_css_selector('#bs_pw_anm > div.bs_form_foot > div.bs_form_row > div.bs_right > input')\n    pw_email.send_keys(logininfo['pw_email'])\n    pw.send_keys(logininfo['password'])\n    # sleep(3)\n    submit2.submit()\n    \n\"\"\"\ndef writetohtml(driver,path):\n    f = open(path,'wb')\n    f.write(driver.page_source.encode(\"utf-8\", \"ignore\"))\n    f.close()   \n\"\"\"    \n\nif __name__ == \"__main__\":\n    #path = \"/home/pi/Programms/getPlatzinBibliothek/chromedriver\"\n    option = webdriver.ChromeOptions()\n    option.add_argument('--headless')\n    driver = webdriver.Chrome(options=option)\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": chrome start up\")\n    # driver.get('file:///C:/Users/97532/Desktop/Anmeldung.html')\n    driver.get('https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html')\n    ok = clickbucheng(driver)\n    count = 0\n    while ok != 1 and count < 10:\n        sleep(1)\n        driver.refresh()\n        ok = clickbucheng(driver)\n        count = count + 1\n    else:\n        if ok == 1:\n            sendform(driver)\n            confirm(driver)\n    #driver.get_screenshot_as_file(r\"/home/pi/Programms/tushuguan.jpg\")\n    sleep(1)\n    print(datetime.datetime.now().strftime('%Y.%m.%d-%H:%M:%S'),\": chrome shutdown\")\n    driver.quit()\n```\n\n使用Selenium驱动chrome浏览器，实行web自动化，完成抢座功能。\n\n# 4：定时任务\n\n在树莓派上，利用Linux定时工具crontab，指定程序在每周天到周四上午八点运行。\n\n创建shell脚本，bibplatz.sh\n\n```shell\n#!/bin/bash\ncd /home/pi/Programms/getPlatzinBibliothek\npython3 -u getplatz.py > result.log 2>&1\n```\n\n添加任务\n\n```shell\ncrontab -e\n```\n\n在vim编辑器中添加任务\n\n```shell\n0 8 * * 0-4 /home/pi/bibplatz.sh &\n```\n\ncrontab的格式为：* * * * * command\n\n五个*分别代表，分钟，小时，天，月，周\n\n查看任务\n\n```shell\ncrontab -l\n```\n\n# 5：参考资料\n\n《[Linux定时任务Crontab命令详解](https://www.cnblogs.com/intval/p/5763929.html)》\n\n《[Linux后台运行Python程序的几种方法讲解](https://www.jb51.net/article/156969.htm)》\n\n《[linux下后台运行python程序并输出到日志文件中](https://blog.csdn.net/wangshu_liang/article/details/84027148)》","slug":"利用树莓派定时抢图书馆座位","published":1,"updated":"2020-09-28T06:55:34.473Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsac30029p0vzf9dj4g4h","content":"<h1 id=\"1：需求分析\"><a href=\"#1：需求分析\" class=\"headerlink\" title=\"1：需求分析\"></a>1：需求分析</h1><p>由于新冠疫情的影响，学校图书馆和自习室必须在监管之下运行，每日提供的坐席和开放时间受限。大部分自习室被关闭，导致坐席需求很大，而供应很少。新规要求，图书馆和自习室的坐席必须在学校官网上预定，而且预定时间是周日到周四早上八点，仅能预定后一天的位置。</p>\n<p>在考试周，座位非常难抢到，因此萌发了通过程序抢座的念头。</p>\n<p>目前需求是，程序在周天到周日的早上八点启动，并打开抢座页面，抢座后关闭程序。抢座成功后，学校会自动发送抢座成功的邮件。</p>\n<h1 id=\"2：软硬件应用\"><a href=\"#2：软硬件应用\" class=\"headerlink\" title=\"2：软硬件应用\"></a>2：软硬件应用</h1><p>服务器：树莓派4B+、Linux系统</p>\n<p>语言：Python</p>\n<p>依赖库：Selenium，date</p>\n<p>Linux工具：crontab</p>\n<h1 id=\"3：抢座程序\"><a href=\"#3：抢座程序\" class=\"headerlink\" title=\"3：抢座程序\"></a>3：抢座程序</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.action_chains <span class=\"keyword\">import</span> ActionChains</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> Select</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.keys <span class=\"keyword\">import</span> Keys</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> WebDriverWait</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support <span class=\"keyword\">import</span> expected_conditions <span class=\"keyword\">as</span> EC</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> time <span class=\"keyword\">import</span> sleep</span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#点击buchen按钮</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">clickbucheng</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    inputs = driver.find_elements_by_tag_name(<span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> input <span class=\"keyword\">in</span> inputs:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> input.get_attribute(<span class=\"string\">&#x27;value&#x27;</span>) == <span class=\"string\">&#x27;buchen&#x27;</span>:</span><br><span class=\"line\">            ActionChains(driver).click(input).perform()</span><br><span class=\"line\">            <span class=\"comment\"># writetohtml(driver,r&quot;C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\1.html&quot;)</span></span><br><span class=\"line\">            window = driver.window_handles[<span class=\"number\">1</span>]</span><br><span class=\"line\">            driver.switch_to.window(window)</span><br><span class=\"line\">            driver.find_elements_by_css_selector(<span class=\"string\">&#x27;#bs_form_main &gt; div &gt; div.bs_etvg &gt; div &gt; label &gt; div.bs_form_uni.bs_right.padding0 &gt; input&#x27;</span>)[<span class=\"number\">0</span>].click()</span><br><span class=\"line\">            print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: start buchen&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#发送表格信息</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sendform</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># writetohtml(driver,r&#x27;C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\2.html&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\">#sex:M/W</span></span><br><span class=\"line\">    urinfo = &#123;<span class=\"string\">&quot;sex&quot;</span>:<span class=\"string\">&quot;M&quot;</span>,<span class=\"string\">&quot;vorname&quot;</span>:<span class=\"string\">&quot;***&quot;</span>,<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;***&quot;</span>,<span class=\"string\">&quot;strasse&quot;</span>:<span class=\"string\">&quot;Hai***1&quot;</span>,<span class=\"string\">&quot;ort&quot;</span>:<span class=\"string\">&quot;***&quot;</span>,<span class=\"string\">&quot;status&quot;</span>:<span class=\"string\">&quot;S-RWTH&quot;</span>,<span class=\"string\">&quot;matnr&quot;</span>:<span class=\"string\">&quot;***93&quot;</span>,<span class=\"string\">&quot;email&quot;</span>:<span class=\"string\">&quot;im@xieqifei.com&quot;</span>,<span class=\"string\">&quot;telefon&quot;</span>:<span class=\"string\">&quot;0049***4845&quot;</span>&#125;</span><br><span class=\"line\">    radios = driver.find_elements_by_name(<span class=\"string\">&#x27;sex&#x27;</span>)</span><br><span class=\"line\">    vorname = driver.find_element_by_name(<span class=\"string\">&#x27;vorname&#x27;</span>)</span><br><span class=\"line\">    name = driver.find_element_by_name(<span class=\"string\">&#x27;name&#x27;</span>)</span><br><span class=\"line\">    strasse = driver.find_element_by_name(<span class=\"string\">&#x27;strasse&#x27;</span>)</span><br><span class=\"line\">    ort = driver.find_element_by_name(<span class=\"string\">&#x27;ort&#x27;</span>)</span><br><span class=\"line\">    status = Select(driver.find_element_by_name(<span class=\"string\">&#x27;statusorig&#x27;</span>))</span><br><span class=\"line\">    matnr = driver.find_element_by_name(<span class=\"string\">&#x27;matnr&#x27;</span>)</span><br><span class=\"line\">    email = driver.find_element_by_name(<span class=\"string\">&#x27;email&#x27;</span>)</span><br><span class=\"line\">    telefon = driver.find_element_by_name(<span class=\"string\">&#x27;telefon&#x27;</span>)</span><br><span class=\"line\">    tnbed = driver.find_element_by_name(<span class=\"string\">&#x27;tnbed&#x27;</span>)</span><br><span class=\"line\">    submit = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> radio <span class=\"keyword\">in</span> radios:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> radio.get_attribute(<span class=\"string\">&quot;value&quot;</span>) == urinfo[<span class=\"string\">&#x27;sex&#x27;</span>]:</span><br><span class=\"line\">            radio.click()</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    vorname.send_keys(urinfo[<span class=\"string\">&#x27;vorname&#x27;</span>])</span><br><span class=\"line\">    name.send_keys(urinfo[<span class=\"string\">&#x27;name&#x27;</span>])</span><br><span class=\"line\">    strasse.send_keys(urinfo[<span class=\"string\">&#x27;strasse&#x27;</span>])</span><br><span class=\"line\">    ort.send_keys(urinfo[<span class=\"string\">&#x27;ort&#x27;</span>])</span><br><span class=\"line\">    status.select_by_value(urinfo[<span class=\"string\">&#x27;status&#x27;</span>])</span><br><span class=\"line\">    matnr.send_keys(urinfo[<span class=\"string\">&#x27;matnr&#x27;</span>])</span><br><span class=\"line\">    email.send_keys(urinfo[<span class=\"string\">&#x27;email&#x27;</span>])</span><br><span class=\"line\">    telefon.send_keys(urinfo[<span class=\"string\">&#x27;telefon&#x27;</span>])</span><br><span class=\"line\">    tnbed.click()</span><br><span class=\"line\">    telefon.click()</span><br><span class=\"line\">    sleep(<span class=\"number\">4</span>)</span><br><span class=\"line\">    <span class=\"comment\"># WebDriverWait(driver, 10).until(EC.element_to_be_clickable(By.XPATH,&#x27;//*[@id=&quot;bs_foot&quot;]/div[3]/div[2]/input&#x27;))</span></span><br><span class=\"line\">    submit.click()</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: send MsgForm&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#确认预定</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">confirm</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    confirm = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class=\"line\">    confirm.click()</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: confirm,buchen success!&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#可发送用户名密码抢座</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sendpw</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    logininfo = &#123;<span class=\"string\">&quot;pw_email&quot;</span>:<span class=\"string\">&quot;im@xieqifei.com&quot;</span>,<span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;***&quot;</span>&#125;</span><br><span class=\"line\">    pw_email = driver.find_element_by_name(<span class=\"string\">&#x27;pw_email&#x27;</span>)</span><br><span class=\"line\">    pw = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_pw_anm &gt; div:nth-child(3) &gt; div.bs_form_sp2 &gt; input&#x27;</span>)</span><br><span class=\"line\">    submit2 = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_pw_anm &gt; div.bs_form_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class=\"line\">    pw_email.send_keys(logininfo[<span class=\"string\">&#x27;pw_email&#x27;</span>])</span><br><span class=\"line\">    pw.send_keys(logininfo[<span class=\"string\">&#x27;password&#x27;</span>])</span><br><span class=\"line\">    <span class=\"comment\"># sleep(3)</span></span><br><span class=\"line\">    submit2.submit()</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">def writetohtml(driver,path):</span></span><br><span class=\"line\"><span class=\"string\">    f = open(path,&#x27;wb&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">    f.write(driver.page_source.encode(&quot;utf-8&quot;, &quot;ignore&quot;))</span></span><br><span class=\"line\"><span class=\"string\">    f.close()   </span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span>    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"comment\">#path = &quot;/home/pi/Programms/getPlatzinBibliothek/chromedriver&quot;</span></span><br><span class=\"line\">    option = webdriver.ChromeOptions()</span><br><span class=\"line\">    option.add_argument(<span class=\"string\">&#x27;--headless&#x27;</span>)</span><br><span class=\"line\">    driver = webdriver.Chrome(options=option)</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: chrome start up&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># driver.get(&#x27;file:///C:/Users/97532/Desktop/Anmeldung.html&#x27;)</span></span><br><span class=\"line\">    driver.get(<span class=\"string\">&#x27;https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html&#x27;</span>)</span><br><span class=\"line\">    ok = clickbucheng(driver)</span><br><span class=\"line\">    count = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ok != <span class=\"number\">1</span> <span class=\"keyword\">and</span> count &lt; <span class=\"number\">10</span>:</span><br><span class=\"line\">        sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">        driver.refresh()</span><br><span class=\"line\">        ok = clickbucheng(driver)</span><br><span class=\"line\">        count = count + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ok == <span class=\"number\">1</span>:</span><br><span class=\"line\">            sendform(driver)</span><br><span class=\"line\">            confirm(driver)</span><br><span class=\"line\">    <span class=\"comment\">#driver.get_screenshot_as_file(r&quot;/home/pi/Programms/tushuguan.jpg&quot;)</span></span><br><span class=\"line\">    sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: chrome shutdown&quot;</span>)</span><br><span class=\"line\">    driver.quit()</span><br></pre></td></tr></table></figure>\n\n<p>使用Selenium驱动chrome浏览器，实行web自动化，完成抢座功能。</p>\n<h1 id=\"4：定时任务\"><a href=\"#4：定时任务\" class=\"headerlink\" title=\"4：定时任务\"></a>4：定时任务</h1><p>在树莓派上，利用Linux定时工具crontab，指定程序在每周天到周四上午八点运行。</p>\n<p>创建shell脚本，bibplatz.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">cd /home/pi/Programms/getPlatzinBibliothek</span><br><span class=\"line\">python3 -u getplatz.py &gt; result.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<p>添加任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br></pre></td></tr></table></figure>\n\n<p>在vim编辑器中添加任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 8 * * 0-4 /home/pi/bibplatz.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>crontab的格式为：* * * * * command</p>\n<p>五个*分别代表，分钟，小时，天，月，周</p>\n<p>查看任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -l</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://www.cnblogs.com/intval/p/5763929.html\">Linux定时任务Crontab命令详解</a>》</p>\n<p>《<a href=\"https://www.jb51.net/article/156969.htm\">Linux后台运行Python程序的几种方法讲解</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/wangshu_liang/article/details/84027148\">linux下后台运行python程序并输出到日志文件中</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：需求分析\"><a href=\"#1：需求分析\" class=\"headerlink\" title=\"1：需求分析\"></a>1：需求分析</h1><p>由于新冠疫情的影响，学校图书馆和自习室必须在监管之下运行，每日提供的坐席和开放时间受限。大部分自习室被关闭，导致坐席需求很大，而供应很少。新规要求，图书馆和自习室的坐席必须在学校官网上预定，而且预定时间是周日到周四早上八点，仅能预定后一天的位置。</p>\n<p>在考试周，座位非常难抢到，因此萌发了通过程序抢座的念头。</p>\n<p>目前需求是，程序在周天到周日的早上八点启动，并打开抢座页面，抢座后关闭程序。抢座成功后，学校会自动发送抢座成功的邮件。</p>\n<h1 id=\"2：软硬件应用\"><a href=\"#2：软硬件应用\" class=\"headerlink\" title=\"2：软硬件应用\"></a>2：软硬件应用</h1><p>服务器：树莓派4B+、Linux系统</p>\n<p>语言：Python</p>\n<p>依赖库：Selenium，date</p>\n<p>Linux工具：crontab</p>\n<h1 id=\"3：抢座程序\"><a href=\"#3：抢座程序\" class=\"headerlink\" title=\"3：抢座程序\"></a>3：抢座程序</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.action_chains <span class=\"keyword\">import</span> ActionChains</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> Select</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.keys <span class=\"keyword\">import</span> Keys</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> WebDriverWait</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support <span class=\"keyword\">import</span> expected_conditions <span class=\"keyword\">as</span> EC</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> time <span class=\"keyword\">import</span> sleep</span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#点击buchen按钮</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">clickbucheng</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    inputs = driver.find_elements_by_tag_name(<span class=\"string\">&#x27;input&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> input <span class=\"keyword\">in</span> inputs:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> input.get_attribute(<span class=\"string\">&#x27;value&#x27;</span>) == <span class=\"string\">&#x27;buchen&#x27;</span>:</span><br><span class=\"line\">            ActionChains(driver).click(input).perform()</span><br><span class=\"line\">            <span class=\"comment\"># writetohtml(driver,r&quot;C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\1.html&quot;)</span></span><br><span class=\"line\">            window = driver.window_handles[<span class=\"number\">1</span>]</span><br><span class=\"line\">            driver.switch_to.window(window)</span><br><span class=\"line\">            driver.find_elements_by_css_selector(<span class=\"string\">&#x27;#bs_form_main &gt; div &gt; div.bs_etvg &gt; div &gt; label &gt; div.bs_form_uni.bs_right.padding0 &gt; input&#x27;</span>)[<span class=\"number\">0</span>].click()</span><br><span class=\"line\">            print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: start buchen&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#发送表格信息</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sendform</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    <span class=\"comment\"># writetohtml(driver,r&#x27;C:\\Users\\97532\\OneDrive\\程序仓库\\getPlatzinBibliothek\\2.html&#x27;)</span></span><br><span class=\"line\">    <span class=\"comment\">#sex:M/W</span></span><br><span class=\"line\">    urinfo = &#123;<span class=\"string\">&quot;sex&quot;</span>:<span class=\"string\">&quot;M&quot;</span>,<span class=\"string\">&quot;vorname&quot;</span>:<span class=\"string\">&quot;***&quot;</span>,<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;***&quot;</span>,<span class=\"string\">&quot;strasse&quot;</span>:<span class=\"string\">&quot;Hai***1&quot;</span>,<span class=\"string\">&quot;ort&quot;</span>:<span class=\"string\">&quot;***&quot;</span>,<span class=\"string\">&quot;status&quot;</span>:<span class=\"string\">&quot;S-RWTH&quot;</span>,<span class=\"string\">&quot;matnr&quot;</span>:<span class=\"string\">&quot;***93&quot;</span>,<span class=\"string\">&quot;email&quot;</span>:<span class=\"string\">&quot;im@xieqifei.com&quot;</span>,<span class=\"string\">&quot;telefon&quot;</span>:<span class=\"string\">&quot;0049***4845&quot;</span>&#125;</span><br><span class=\"line\">    radios = driver.find_elements_by_name(<span class=\"string\">&#x27;sex&#x27;</span>)</span><br><span class=\"line\">    vorname = driver.find_element_by_name(<span class=\"string\">&#x27;vorname&#x27;</span>)</span><br><span class=\"line\">    name = driver.find_element_by_name(<span class=\"string\">&#x27;name&#x27;</span>)</span><br><span class=\"line\">    strasse = driver.find_element_by_name(<span class=\"string\">&#x27;strasse&#x27;</span>)</span><br><span class=\"line\">    ort = driver.find_element_by_name(<span class=\"string\">&#x27;ort&#x27;</span>)</span><br><span class=\"line\">    status = Select(driver.find_element_by_name(<span class=\"string\">&#x27;statusorig&#x27;</span>))</span><br><span class=\"line\">    matnr = driver.find_element_by_name(<span class=\"string\">&#x27;matnr&#x27;</span>)</span><br><span class=\"line\">    email = driver.find_element_by_name(<span class=\"string\">&#x27;email&#x27;</span>)</span><br><span class=\"line\">    telefon = driver.find_element_by_name(<span class=\"string\">&#x27;telefon&#x27;</span>)</span><br><span class=\"line\">    tnbed = driver.find_element_by_name(<span class=\"string\">&#x27;tnbed&#x27;</span>)</span><br><span class=\"line\">    submit = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> radio <span class=\"keyword\">in</span> radios:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> radio.get_attribute(<span class=\"string\">&quot;value&quot;</span>) == urinfo[<span class=\"string\">&#x27;sex&#x27;</span>]:</span><br><span class=\"line\">            radio.click()</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    vorname.send_keys(urinfo[<span class=\"string\">&#x27;vorname&#x27;</span>])</span><br><span class=\"line\">    name.send_keys(urinfo[<span class=\"string\">&#x27;name&#x27;</span>])</span><br><span class=\"line\">    strasse.send_keys(urinfo[<span class=\"string\">&#x27;strasse&#x27;</span>])</span><br><span class=\"line\">    ort.send_keys(urinfo[<span class=\"string\">&#x27;ort&#x27;</span>])</span><br><span class=\"line\">    status.select_by_value(urinfo[<span class=\"string\">&#x27;status&#x27;</span>])</span><br><span class=\"line\">    matnr.send_keys(urinfo[<span class=\"string\">&#x27;matnr&#x27;</span>])</span><br><span class=\"line\">    email.send_keys(urinfo[<span class=\"string\">&#x27;email&#x27;</span>])</span><br><span class=\"line\">    telefon.send_keys(urinfo[<span class=\"string\">&#x27;telefon&#x27;</span>])</span><br><span class=\"line\">    tnbed.click()</span><br><span class=\"line\">    telefon.click()</span><br><span class=\"line\">    sleep(<span class=\"number\">4</span>)</span><br><span class=\"line\">    <span class=\"comment\"># WebDriverWait(driver, 10).until(EC.element_to_be_clickable(By.XPATH,&#x27;//*[@id=&quot;bs_foot&quot;]/div[3]/div[2]/input&#x27;))</span></span><br><span class=\"line\">    submit.click()</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: send MsgForm&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#确认预定</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">confirm</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    confirm = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class=\"line\">    confirm.click()</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: confirm,buchen success!&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#可发送用户名密码抢座</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sendpw</span>(<span class=\"params\">driver</span>):</span></span><br><span class=\"line\">    logininfo = &#123;<span class=\"string\">&quot;pw_email&quot;</span>:<span class=\"string\">&quot;im@xieqifei.com&quot;</span>,<span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;***&quot;</span>&#125;</span><br><span class=\"line\">    pw_email = driver.find_element_by_name(<span class=\"string\">&#x27;pw_email&#x27;</span>)</span><br><span class=\"line\">    pw = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_pw_anm &gt; div:nth-child(3) &gt; div.bs_form_sp2 &gt; input&#x27;</span>)</span><br><span class=\"line\">    submit2 = driver.find_element_by_css_selector(<span class=\"string\">&#x27;#bs_pw_anm &gt; div.bs_form_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class=\"line\">    pw_email.send_keys(logininfo[<span class=\"string\">&#x27;pw_email&#x27;</span>])</span><br><span class=\"line\">    pw.send_keys(logininfo[<span class=\"string\">&#x27;password&#x27;</span>])</span><br><span class=\"line\">    <span class=\"comment\"># sleep(3)</span></span><br><span class=\"line\">    submit2.submit()</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">def writetohtml(driver,path):</span></span><br><span class=\"line\"><span class=\"string\">    f = open(path,&#x27;wb&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">    f.write(driver.page_source.encode(&quot;utf-8&quot;, &quot;ignore&quot;))</span></span><br><span class=\"line\"><span class=\"string\">    f.close()   </span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span>    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"comment\">#path = &quot;/home/pi/Programms/getPlatzinBibliothek/chromedriver&quot;</span></span><br><span class=\"line\">    option = webdriver.ChromeOptions()</span><br><span class=\"line\">    option.add_argument(<span class=\"string\">&#x27;--headless&#x27;</span>)</span><br><span class=\"line\">    driver = webdriver.Chrome(options=option)</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: chrome start up&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># driver.get(&#x27;file:///C:/Users/97532/Desktop/Anmeldung.html&#x27;)</span></span><br><span class=\"line\">    driver.get(<span class=\"string\">&#x27;https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html&#x27;</span>)</span><br><span class=\"line\">    ok = clickbucheng(driver)</span><br><span class=\"line\">    count = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ok != <span class=\"number\">1</span> <span class=\"keyword\">and</span> count &lt; <span class=\"number\">10</span>:</span><br><span class=\"line\">        sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">        driver.refresh()</span><br><span class=\"line\">        ok = clickbucheng(driver)</span><br><span class=\"line\">        count = count + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ok == <span class=\"number\">1</span>:</span><br><span class=\"line\">            sendform(driver)</span><br><span class=\"line\">            confirm(driver)</span><br><span class=\"line\">    <span class=\"comment\">#driver.get_screenshot_as_file(r&quot;/home/pi/Programms/tushuguan.jpg&quot;)</span></span><br><span class=\"line\">    sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    print(datetime.datetime.now().strftime(<span class=\"string\">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class=\"string\">&quot;: chrome shutdown&quot;</span>)</span><br><span class=\"line\">    driver.quit()</span><br></pre></td></tr></table></figure>\n\n<p>使用Selenium驱动chrome浏览器，实行web自动化，完成抢座功能。</p>\n<h1 id=\"4：定时任务\"><a href=\"#4：定时任务\" class=\"headerlink\" title=\"4：定时任务\"></a>4：定时任务</h1><p>在树莓派上，利用Linux定时工具crontab，指定程序在每周天到周四上午八点运行。</p>\n<p>创建shell脚本，bibplatz.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">cd /home/pi/Programms/getPlatzinBibliothek</span><br><span class=\"line\">python3 -u getplatz.py &gt; result.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<p>添加任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e</span><br></pre></td></tr></table></figure>\n\n<p>在vim编辑器中添加任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 8 * * 0-4 /home/pi/bibplatz.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>crontab的格式为：* * * * * command</p>\n<p>五个*分别代表，分钟，小时，天，月，周</p>\n<p>查看任务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -l</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://www.cnblogs.com/intval/p/5763929.html\">Linux定时任务Crontab命令详解</a>》</p>\n<p>《<a href=\"https://www.jb51.net/article/156969.htm\">Linux后台运行Python程序的几种方法讲解</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/wangshu_liang/article/details/84027148\">linux下后台运行python程序并输出到日志文件中</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Mon Sep 28 2020 08:55:34 GMT+0200 (GMT+02:00)","title":"利用树莓派定时抢图书馆座位","path":"2020/09/27/利用树莓派定时抢图书馆座位/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-27T16:49:13.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-27T16:49:13.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Linux","tags":["Linux","树莓派"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"创建一个简单的API项目","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-01-26T21:01:17.000Z","password":null,"summary":"API（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。API项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。","_content":"\n# 0：简介\n\nAPI（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。\n\nAPI项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。\n\n# 1：域名和LAMP\n\n专用于api的域名建议采用类似于api.example.com这样的三级域名，LAMP这四个网站服务器是必须的。\n\n# 2：laravel安装\n\n使用宝塔面板安装好的php，已经自带composer，若没有composer需要先安装。\n\n没有数据库需要先创建数据库。\n\n然后在网站目录下例如/var/www，运行指令\n\n`composer create-project laravel/laravel MyProject  \"5.1.*\"` \n\n安装laravel。根据提示连接数据库。\n\n# 3：新建laravel控制器\n\n控制器就是当我们访问url时，服务器将运行控制器内的程序，然后返回给浏览器一个内容，这个内容可以是html代码，当然也可以时xml或者json。\n\n在laravel安装目录运行`php artisan make:controller Api/LinkController`\n\n新建一个名叫LinkController控制器，此时在将在`app/Http/Controllers/Api`目录下生成一个LinkController.php`文件。打开文件编辑我们想要的程序。\n\n```php\n<?php]()\n\nnamespace App\\Http\\Controllers\\Api;\n\nuse Illuminate\\Http\\Request;\nuse App\\Http\\Controllers\\Controller;\nuse DB;\n\nclass LinkController extends Controller\n{\n    //方法一，从数据库获取某一数据\n    //url中有参数情况，例如https://api.example.com/linkcontroller/searchlinks?type=电影&kw=中国机长\n    public function searchlinks(Request $request){\n    \t$type=$request->input('type');//使用request获取url中参数\n    \t$kw=$request->input('kw');\n\t\t$linksresult = DB::table('my_zhlinks')->where('type', $type)->get();//从已连接的数据库，找到表单“my_zhlinks”，获取type和带入参数type相同的项。将这些数据保存到linkresult变量中。\n        //数据库表单my_zhlinks是我自己创建的。\n    \treturn json_encode($linksresult);//返回一个json数组，不是json对象。\n    }\n    \n\t//方法二，url中不带参数\n    public function alltype(){\n    \t$alltypes=DB::table('my_zhpreg')->select('type')->get();\n    \treturn json_encode($alltypes);\n    \t\n    }\n}\n```\n\n# 4：修改路由\n\n在上面注释中我们看到，要通过searchlinks方法返回一个json数组，url为`https://api.example.com/linkcontroller/searchlinks?type=电影&kw=中国机长`非常的长，而且不利于我们后期管理api版本。\n\n在`routes`目录下的`api.php`是专门用来写Api接口的路由，打开它\n\n```php\n<?php]()\n\nuse Illuminate\\Http\\Request;\n\n/*\n|--------------------------------------------------------------------------\n| API Routes\n|--------------------------------------------------------------------------\n|\n| Here is where you can register API routes for your application. These\n| routes are loaded by the RouteServiceProvider within a group which\n| is assigned the \"api\" middleware group. Enjoy building your API!\n|\n*/\nRoute::namespace('Api')->prefix('v1')->group(function(){\n\tRoute::get('search','LinkController@searchlinks')->name('search.links');\n\tRoute::get('type','LinkController@alltype')->name('type.all');\n});\n```\n\n`namespace('Api')`指定了命名空间，控制器命名空间只要不是在`App\\Http\\Controllers`下，都需要进一步指明其命名空间，比如LinkController命名空间为`App\\Http\\Controllers\\Api`。prefix为前缀，我们用来控制版本，group表示，后面的地址拥有相同的命名空间和前缀。\n修改后的带参数url变为`https://api.example.com/api/v1/search?type=电影&kw=中国机长`\n\n不带参数的url变为`https://api.example.com/api/v1/type`\n\n# 5：总结\n\n修改路由后，通过访问链接`https://api.example.com/api/v1/search?type=电影&kw=中国机长`就可以获得从数据库获取的值了。\n\n下篇讲解使用okhttp和gson获取并解析api里的json数组。","source":"_posts/创建一个简单的API项目.md","raw":"---\ntitle: 创建一个简单的API项目\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-01-26 22:01:17\npassword:\nsummary: API（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。API项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。\ntags: API\ncategories: 网站编程\n---\n\n# 0：简介\n\nAPI（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。\n\nAPI项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。\n\n# 1：域名和LAMP\n\n专用于api的域名建议采用类似于api.example.com这样的三级域名，LAMP这四个网站服务器是必须的。\n\n# 2：laravel安装\n\n使用宝塔面板安装好的php，已经自带composer，若没有composer需要先安装。\n\n没有数据库需要先创建数据库。\n\n然后在网站目录下例如/var/www，运行指令\n\n`composer create-project laravel/laravel MyProject  \"5.1.*\"` \n\n安装laravel。根据提示连接数据库。\n\n# 3：新建laravel控制器\n\n控制器就是当我们访问url时，服务器将运行控制器内的程序，然后返回给浏览器一个内容，这个内容可以是html代码，当然也可以时xml或者json。\n\n在laravel安装目录运行`php artisan make:controller Api/LinkController`\n\n新建一个名叫LinkController控制器，此时在将在`app/Http/Controllers/Api`目录下生成一个LinkController.php`文件。打开文件编辑我们想要的程序。\n\n```php\n<?php]()\n\nnamespace App\\Http\\Controllers\\Api;\n\nuse Illuminate\\Http\\Request;\nuse App\\Http\\Controllers\\Controller;\nuse DB;\n\nclass LinkController extends Controller\n{\n    //方法一，从数据库获取某一数据\n    //url中有参数情况，例如https://api.example.com/linkcontroller/searchlinks?type=电影&kw=中国机长\n    public function searchlinks(Request $request){\n    \t$type=$request->input('type');//使用request获取url中参数\n    \t$kw=$request->input('kw');\n\t\t$linksresult = DB::table('my_zhlinks')->where('type', $type)->get();//从已连接的数据库，找到表单“my_zhlinks”，获取type和带入参数type相同的项。将这些数据保存到linkresult变量中。\n        //数据库表单my_zhlinks是我自己创建的。\n    \treturn json_encode($linksresult);//返回一个json数组，不是json对象。\n    }\n    \n\t//方法二，url中不带参数\n    public function alltype(){\n    \t$alltypes=DB::table('my_zhpreg')->select('type')->get();\n    \treturn json_encode($alltypes);\n    \t\n    }\n}\n```\n\n# 4：修改路由\n\n在上面注释中我们看到，要通过searchlinks方法返回一个json数组，url为`https://api.example.com/linkcontroller/searchlinks?type=电影&kw=中国机长`非常的长，而且不利于我们后期管理api版本。\n\n在`routes`目录下的`api.php`是专门用来写Api接口的路由，打开它\n\n```php\n<?php]()\n\nuse Illuminate\\Http\\Request;\n\n/*\n|--------------------------------------------------------------------------\n| API Routes\n|--------------------------------------------------------------------------\n|\n| Here is where you can register API routes for your application. These\n| routes are loaded by the RouteServiceProvider within a group which\n| is assigned the \"api\" middleware group. Enjoy building your API!\n|\n*/\nRoute::namespace('Api')->prefix('v1')->group(function(){\n\tRoute::get('search','LinkController@searchlinks')->name('search.links');\n\tRoute::get('type','LinkController@alltype')->name('type.all');\n});\n```\n\n`namespace('Api')`指定了命名空间，控制器命名空间只要不是在`App\\Http\\Controllers`下，都需要进一步指明其命名空间，比如LinkController命名空间为`App\\Http\\Controllers\\Api`。prefix为前缀，我们用来控制版本，group表示，后面的地址拥有相同的命名空间和前缀。\n修改后的带参数url变为`https://api.example.com/api/v1/search?type=电影&kw=中国机长`\n\n不带参数的url变为`https://api.example.com/api/v1/type`\n\n# 5：总结\n\n修改路由后，通过访问链接`https://api.example.com/api/v1/search?type=电影&kw=中国机长`就可以获得从数据库获取的值了。\n\n下篇讲解使用okhttp和gson获取并解析api里的json数组。","slug":"创建一个简单的API项目","published":1,"updated":"2020-06-20T06:46:07.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsac5002cp0vz0uv7ewe0","content":"<h1 id=\"0：简介\"><a href=\"#0：简介\" class=\"headerlink\" title=\"0：简介\"></a>0：简介</h1><p>API（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。</p>\n<p>API项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。</p>\n<h1 id=\"1：域名和LAMP\"><a href=\"#1：域名和LAMP\" class=\"headerlink\" title=\"1：域名和LAMP\"></a>1：域名和LAMP</h1><p>专用于api的域名建议采用类似于api.example.com这样的三级域名，LAMP这四个网站服务器是必须的。</p>\n<h1 id=\"2：laravel安装\"><a href=\"#2：laravel安装\" class=\"headerlink\" title=\"2：laravel安装\"></a>2：laravel安装</h1><p>使用宝塔面板安装好的php，已经自带composer，若没有composer需要先安装。</p>\n<p>没有数据库需要先创建数据库。</p>\n<p>然后在网站目录下例如/var/www，运行指令</p>\n<p><code>composer create-project laravel/laravel MyProject  &quot;5.1.*&quot;</code> </p>\n<p>安装laravel。根据提示连接数据库。</p>\n<h1 id=\"3：新建laravel控制器\"><a href=\"#3：新建laravel控制器\" class=\"headerlink\" title=\"3：新建laravel控制器\"></a>3：新建laravel控制器</h1><p>控制器就是当我们访问url时，服务器将运行控制器内的程序，然后返回给浏览器一个内容，这个内容可以是html代码，当然也可以时xml或者json。</p>\n<p>在laravel安装目录运行<code>php artisan make:controller Api/LinkController</code></p>\n<p>新建一个名叫LinkController控制器，此时在将在<code>app/Http/Controllers/Api</code>目录下生成一个LinkController.php`文件。打开文件编辑我们想要的程序。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>]()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">App</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Controllers</span>\\<span class=\"title\">Api</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Illuminate</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Request</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">App</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Controllers</span>\\<span class=\"title\">Controller</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">DB</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkController</span> <span class=\"keyword\">extends</span> <span class=\"title\">Controller</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//方法一，从数据库获取某一数据</span></span><br><span class=\"line\">    <span class=\"comment\">//url中有参数情况，例如https://api.example.com/linkcontroller/searchlinks?type=电影&amp;kw=中国机长</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">searchlinks</span>(<span class=\"params\">Request $request</span>)</span>&#123;</span><br><span class=\"line\">    \t$type=$request-&gt;input(<span class=\"string\">&#x27;type&#x27;</span>);<span class=\"comment\">//使用request获取url中参数</span></span><br><span class=\"line\">    \t$kw=$request-&gt;input(<span class=\"string\">&#x27;kw&#x27;</span>);</span><br><span class=\"line\">\t\t$linksresult = DB::table(<span class=\"string\">&#x27;my_zhlinks&#x27;</span>)-&gt;where(<span class=\"string\">&#x27;type&#x27;</span>, $type)-&gt;get();<span class=\"comment\">//从已连接的数据库，找到表单“my_zhlinks”，获取type和带入参数type相同的项。将这些数据保存到linkresult变量中。</span></span><br><span class=\"line\">        <span class=\"comment\">//数据库表单my_zhlinks是我自己创建的。</span></span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> json_encode($linksresult);<span class=\"comment\">//返回一个json数组，不是json对象。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"comment\">//方法二，url中不带参数</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">alltype</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    \t$alltypes=DB::table(<span class=\"string\">&#x27;my_zhpreg&#x27;</span>)-&gt;select(<span class=\"string\">&#x27;type&#x27;</span>)-&gt;get();</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> json_encode($alltypes);</span><br><span class=\"line\">    \t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：修改路由\"><a href=\"#4：修改路由\" class=\"headerlink\" title=\"4：修改路由\"></a>4：修改路由</h1><p>在上面注释中我们看到，要通过searchlinks方法返回一个json数组，url为<code>https://api.example.com/linkcontroller/searchlinks?type=电影&amp;kw=中国机长</code>非常的长，而且不利于我们后期管理api版本。</p>\n<p>在<code>routes</code>目录下的<code>api.php</code>是专门用来写Api接口的路由，打开它</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>]()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Illuminate</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Request</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">|--------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">| API Routes</span></span><br><span class=\"line\"><span class=\"comment\">|--------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">|</span></span><br><span class=\"line\"><span class=\"comment\">| Here is where you can register API routes for your application. These</span></span><br><span class=\"line\"><span class=\"comment\">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class=\"line\"><span class=\"comment\">| is assigned the &quot;api&quot; middleware group. Enjoy building your API!</span></span><br><span class=\"line\"><span class=\"comment\">|</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">Route::namespace(<span class=\"string\">&#x27;Api&#x27;</span>)-&gt;prefix(<span class=\"string\">&#x27;v1&#x27;</span>)-&gt;group(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\tRoute::get(<span class=\"string\">&#x27;search&#x27;</span>,<span class=\"string\">&#x27;LinkController@searchlinks&#x27;</span>)-&gt;name(<span class=\"string\">&#x27;search.links&#x27;</span>);</span><br><span class=\"line\">\tRoute::get(<span class=\"string\">&#x27;type&#x27;</span>,<span class=\"string\">&#x27;LinkController@alltype&#x27;</span>)-&gt;name(<span class=\"string\">&#x27;type.all&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><code>namespace(&#39;Api&#39;)</code>指定了命名空间，控制器命名空间只要不是在<code>App\\Http\\Controllers</code>下，都需要进一步指明其命名空间，比如LinkController命名空间为<code>App\\Http\\Controllers\\Api</code>。prefix为前缀，我们用来控制版本，group表示，后面的地址拥有相同的命名空间和前缀。<br>修改后的带参数url变为<code>https://api.example.com/api/v1/search?type=电影&amp;kw=中国机长</code></p>\n<p>不带参数的url变为<code>https://api.example.com/api/v1/type</code></p>\n<h1 id=\"5：总结\"><a href=\"#5：总结\" class=\"headerlink\" title=\"5：总结\"></a>5：总结</h1><p>修改路由后，通过访问链接<code>https://api.example.com/api/v1/search?type=电影&amp;kw=中国机长</code>就可以获得从数据库获取的值了。</p>\n<p>下篇讲解使用okhttp和gson获取并解析api里的json数组。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：简介\"><a href=\"#0：简介\" class=\"headerlink\" title=\"0：简介\"></a>0：简介</h1><p>API（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。</p>\n<p>API项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。</p>\n<h1 id=\"1：域名和LAMP\"><a href=\"#1：域名和LAMP\" class=\"headerlink\" title=\"1：域名和LAMP\"></a>1：域名和LAMP</h1><p>专用于api的域名建议采用类似于api.example.com这样的三级域名，LAMP这四个网站服务器是必须的。</p>\n<h1 id=\"2：laravel安装\"><a href=\"#2：laravel安装\" class=\"headerlink\" title=\"2：laravel安装\"></a>2：laravel安装</h1><p>使用宝塔面板安装好的php，已经自带composer，若没有composer需要先安装。</p>\n<p>没有数据库需要先创建数据库。</p>\n<p>然后在网站目录下例如/var/www，运行指令</p>\n<p><code>composer create-project laravel/laravel MyProject  &quot;5.1.*&quot;</code> </p>\n<p>安装laravel。根据提示连接数据库。</p>\n<h1 id=\"3：新建laravel控制器\"><a href=\"#3：新建laravel控制器\" class=\"headerlink\" title=\"3：新建laravel控制器\"></a>3：新建laravel控制器</h1><p>控制器就是当我们访问url时，服务器将运行控制器内的程序，然后返回给浏览器一个内容，这个内容可以是html代码，当然也可以时xml或者json。</p>\n<p>在laravel安装目录运行<code>php artisan make:controller Api/LinkController</code></p>\n<p>新建一个名叫LinkController控制器，此时在将在<code>app/Http/Controllers/Api</code>目录下生成一个LinkController.php`文件。打开文件编辑我们想要的程序。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>]()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">App</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Controllers</span>\\<span class=\"title\">Api</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Illuminate</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Request</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">App</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Controllers</span>\\<span class=\"title\">Controller</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">DB</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkController</span> <span class=\"keyword\">extends</span> <span class=\"title\">Controller</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//方法一，从数据库获取某一数据</span></span><br><span class=\"line\">    <span class=\"comment\">//url中有参数情况，例如https://api.example.com/linkcontroller/searchlinks?type=电影&amp;kw=中国机长</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">searchlinks</span>(<span class=\"params\">Request $request</span>)</span>&#123;</span><br><span class=\"line\">    \t$type=$request-&gt;input(<span class=\"string\">&#x27;type&#x27;</span>);<span class=\"comment\">//使用request获取url中参数</span></span><br><span class=\"line\">    \t$kw=$request-&gt;input(<span class=\"string\">&#x27;kw&#x27;</span>);</span><br><span class=\"line\">\t\t$linksresult = DB::table(<span class=\"string\">&#x27;my_zhlinks&#x27;</span>)-&gt;where(<span class=\"string\">&#x27;type&#x27;</span>, $type)-&gt;get();<span class=\"comment\">//从已连接的数据库，找到表单“my_zhlinks”，获取type和带入参数type相同的项。将这些数据保存到linkresult变量中。</span></span><br><span class=\"line\">        <span class=\"comment\">//数据库表单my_zhlinks是我自己创建的。</span></span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> json_encode($linksresult);<span class=\"comment\">//返回一个json数组，不是json对象。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"comment\">//方法二，url中不带参数</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">alltype</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    \t$alltypes=DB::table(<span class=\"string\">&#x27;my_zhpreg&#x27;</span>)-&gt;select(<span class=\"string\">&#x27;type&#x27;</span>)-&gt;get();</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> json_encode($alltypes);</span><br><span class=\"line\">    \t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：修改路由\"><a href=\"#4：修改路由\" class=\"headerlink\" title=\"4：修改路由\"></a>4：修改路由</h1><p>在上面注释中我们看到，要通过searchlinks方法返回一个json数组，url为<code>https://api.example.com/linkcontroller/searchlinks?type=电影&amp;kw=中国机长</code>非常的长，而且不利于我们后期管理api版本。</p>\n<p>在<code>routes</code>目录下的<code>api.php</code>是专门用来写Api接口的路由，打开它</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>]()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Illuminate</span>\\<span class=\"title\">Http</span>\\<span class=\"title\">Request</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">|--------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">| API Routes</span></span><br><span class=\"line\"><span class=\"comment\">|--------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">|</span></span><br><span class=\"line\"><span class=\"comment\">| Here is where you can register API routes for your application. These</span></span><br><span class=\"line\"><span class=\"comment\">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class=\"line\"><span class=\"comment\">| is assigned the &quot;api&quot; middleware group. Enjoy building your API!</span></span><br><span class=\"line\"><span class=\"comment\">|</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">Route::namespace(<span class=\"string\">&#x27;Api&#x27;</span>)-&gt;prefix(<span class=\"string\">&#x27;v1&#x27;</span>)-&gt;group(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\tRoute::get(<span class=\"string\">&#x27;search&#x27;</span>,<span class=\"string\">&#x27;LinkController@searchlinks&#x27;</span>)-&gt;name(<span class=\"string\">&#x27;search.links&#x27;</span>);</span><br><span class=\"line\">\tRoute::get(<span class=\"string\">&#x27;type&#x27;</span>,<span class=\"string\">&#x27;LinkController@alltype&#x27;</span>)-&gt;name(<span class=\"string\">&#x27;type.all&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><code>namespace(&#39;Api&#39;)</code>指定了命名空间，控制器命名空间只要不是在<code>App\\Http\\Controllers</code>下，都需要进一步指明其命名空间，比如LinkController命名空间为<code>App\\Http\\Controllers\\Api</code>。prefix为前缀，我们用来控制版本，group表示，后面的地址拥有相同的命名空间和前缀。<br>修改后的带参数url变为<code>https://api.example.com/api/v1/search?type=电影&amp;kw=中国机长</code></p>\n<p>不带参数的url变为<code>https://api.example.com/api/v1/type</code></p>\n<h1 id=\"5：总结\"><a href=\"#5：总结\" class=\"headerlink\" title=\"5：总结\"></a>5：总结</h1><p>修改路由后，通过访问链接<code>https://api.example.com/api/v1/search?type=电影&amp;kw=中国机长</code>就可以获得从数据库获取的值了。</p>\n<p>下篇讲解使用okhttp和gson获取并解析api里的json数组。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:46:07 GMT+0200 (GMT+02:00)","title":"创建一个简单的API项目","path":"2020/01/26/创建一个简单的API项目/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-01-26T21:01:17.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-01-26T21:01:17.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["API"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"利用树莓派+内网穿透搭建网站服务器","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-10T20:08:39.000Z","password":null,"summary":null,"_content":"\n# 1：前言\n\n在购买了树莓派之后，我一直在找寻它的用处，最近想学基于Python的网站后端框架Django，而树莓派以linux为操作系统，有天生作为网站服务器的优点。以下列举部分。\n\n1. 相比于直接购买高配置VPS，使用树莓派+廉价低配VPS做内网穿透，更加划算。\n2. 相比于使用windows作为网站服务器联系，树莓派可以保持24*7不宕机，避免每次开启电脑都要重新运行服务器程序的麻烦。\n\n开始之前，需要说明的一些软硬件配置。\n\n1. 4B+树莓派，4g内存+32g内存卡\n2. 一台低配置带ipv4地址的VPS。本人使用Ubuntu系统\n3. 一个域名，需要将A记录解析到VPS的ipv4地址上。非必须，可直接用vps的ip地址访问也是可以的。\n\n# 2：树莓派上搭建Django服务器\n\n安装Django教程：《[Django安装](https://www.runoob.com/django/django-install.html)》\n\n在树莓派上安装Django。\n\n并[创建第一个Django项目](https://www.runoob.com/django/django-first-app.html)。\n\n在使用`python3 manage.py runserver 0.0.0.0:8000`打开服务后，\n\n在shell终端上使用\n\n```shell\ncurl 127.0.0.1:8000\n```\n\n是可以访问新建的网站的。\n\n但是，使用树莓派内网ip:8000在相同局域网下的笔记本，无法访问网站，必须修改项目配置文件。后期可修改回来，因为我们需要在树莓派上也安装nginx以作为生产环境，现在只是测试。修改项目下的setting.py文件\n\n```shell\nDEBUG = False\nALLOWED_HOSTS = [\"*\"]\n```\n\n此时，在笔记本上访问树莓派上面的网站，应该已经能够访问了。\n\n# 3：内网穿透\n\n为了让外网的人，能够使用ip地址或者域名，访问到树莓派上的网站，需要做内网穿透，首先，需要让VPS能够访问到树莓派。\n\n使用花生壳之类的软件也能实现内网穿透，且不用VPS，但是这类软件收费比较高，所以我们可以用VPS自己搞一个内网穿透。\n\n使用p2p组网的内网穿透软件，比如n2n、zerotier、frp。在github上都能搜得到。frp是一个端口转发的软件，不需要借助别人提供的服务器来做导航，如果只是做网站是非常推荐的，因为这不设及后面讲的nginx做反向代理的步骤，个人是很推荐的。但，如果你有多个VPS或者多个电脑，想组成局域网，建议使用zerotier。我这里使用的是zerotier，因为它配置比较简单。并在此基础上做了网站的反向代理，以实现外网访问内网，和frp直接做端口转发的原理是不同的。\n\n我们需要分别在树莓派和vps上安装zerotier。\n\n```shell\ncurl -s https://install.zerotier.com | sudo bash\n```\n\n然后在[zerotier官网](https://www.zerotier.com/)创建一个账号，并创建一个网络。可参考教程：\n\n[内网穿透工具——ZeroTier One的使用](https://www.jianshu.com/p/eefddb256ad7)\n\n建好网络后，获得十六位网络码\n\n然后，在树莓派和vps输入命令\n\n```shell\nzerotier-cli join 网络码\n```\n\n即可加入此网络\n\n然后回到zerotier官网，管理这两个网络，让他们之间能够互相ping通。此间步骤比较多，需要耐心自学。\n\n内网穿透实现后，在vps上不仅应该能够ping通树莓派虚拟局域网分配的ip，而且使用虚拟局域网ip:端口，应该能够访问到树莓派上的网站。\n\n在vps使用\n\n```shell\ncurl http://ip:port\n```\n\n访问。获取html代码，则内网穿透可以访问网站了。\n\n# 4：Nginx反向代理\n\n为了让所有外部的人，都能够通过域名或者vps公网ip访问到树莓派的网站，需要在vps上安装nginx，作反向代理。\n\n原理大概是，外部用户，访问vps的ip，浏览器默认不输入端口则访问80端口，http对应80，https对应443。比如用户输入`http://x.x.x.x`或者`http://example.com`则默认访问vps的80端口。\n\n我们需要为vps开放80端口，并将80端口的访问请求转到树莓派的网站端口。\n\n安装nginx\n\n```shell\napt-get install nginx\n```\n\n配置nginx，新建配置文件，并配置nginx\n\n```shell\ntouch /etc/nginx/conf.d/respberry.conf\t#新建配置文件\nvim /etc/nginx/conf.d/respberry.conf\t#编辑配置文件\n```\n\n在文件中输入配置\n\n```shell\nserver{\n\tlisten 80\n\tserver_name example.com\t#你的域名，或者vps的公网ip\n\tlocation / {\n\t\tproxy_pass http://树莓派虚拟局域网ip:网站端口\n\t}\n}\n```\n\n保存退出。\n\n```shell\nservice nginx restart\t#重启nginx\n```\n\n这样通过域名访问vps就能将请求转给树莓派了。外网就能够访问到树莓派了。\n\n# 5：参考资料\n\n《[内网穿透工具——ZeroTier One的使用](https://www.jianshu.com/p/eefddb256ad7)》\n\n《[Nginx配置文件nginx.conf中文详解](https://www.jianshu.com/p/3e2b9964c279)》","source":"_posts/利用树莓派-内网穿透搭建网站服务器.md","raw":"---\ntitle: 利用树莓派+内网穿透搭建网站服务器\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-10 22:08:39\npassword:\nsummary:\ntags: \n- Linux\n- 树莓派\n- Python\ncategories: 网站编程\n---\n\n# 1：前言\n\n在购买了树莓派之后，我一直在找寻它的用处，最近想学基于Python的网站后端框架Django，而树莓派以linux为操作系统，有天生作为网站服务器的优点。以下列举部分。\n\n1. 相比于直接购买高配置VPS，使用树莓派+廉价低配VPS做内网穿透，更加划算。\n2. 相比于使用windows作为网站服务器联系，树莓派可以保持24*7不宕机，避免每次开启电脑都要重新运行服务器程序的麻烦。\n\n开始之前，需要说明的一些软硬件配置。\n\n1. 4B+树莓派，4g内存+32g内存卡\n2. 一台低配置带ipv4地址的VPS。本人使用Ubuntu系统\n3. 一个域名，需要将A记录解析到VPS的ipv4地址上。非必须，可直接用vps的ip地址访问也是可以的。\n\n# 2：树莓派上搭建Django服务器\n\n安装Django教程：《[Django安装](https://www.runoob.com/django/django-install.html)》\n\n在树莓派上安装Django。\n\n并[创建第一个Django项目](https://www.runoob.com/django/django-first-app.html)。\n\n在使用`python3 manage.py runserver 0.0.0.0:8000`打开服务后，\n\n在shell终端上使用\n\n```shell\ncurl 127.0.0.1:8000\n```\n\n是可以访问新建的网站的。\n\n但是，使用树莓派内网ip:8000在相同局域网下的笔记本，无法访问网站，必须修改项目配置文件。后期可修改回来，因为我们需要在树莓派上也安装nginx以作为生产环境，现在只是测试。修改项目下的setting.py文件\n\n```shell\nDEBUG = False\nALLOWED_HOSTS = [\"*\"]\n```\n\n此时，在笔记本上访问树莓派上面的网站，应该已经能够访问了。\n\n# 3：内网穿透\n\n为了让外网的人，能够使用ip地址或者域名，访问到树莓派上的网站，需要做内网穿透，首先，需要让VPS能够访问到树莓派。\n\n使用花生壳之类的软件也能实现内网穿透，且不用VPS，但是这类软件收费比较高，所以我们可以用VPS自己搞一个内网穿透。\n\n使用p2p组网的内网穿透软件，比如n2n、zerotier、frp。在github上都能搜得到。frp是一个端口转发的软件，不需要借助别人提供的服务器来做导航，如果只是做网站是非常推荐的，因为这不设及后面讲的nginx做反向代理的步骤，个人是很推荐的。但，如果你有多个VPS或者多个电脑，想组成局域网，建议使用zerotier。我这里使用的是zerotier，因为它配置比较简单。并在此基础上做了网站的反向代理，以实现外网访问内网，和frp直接做端口转发的原理是不同的。\n\n我们需要分别在树莓派和vps上安装zerotier。\n\n```shell\ncurl -s https://install.zerotier.com | sudo bash\n```\n\n然后在[zerotier官网](https://www.zerotier.com/)创建一个账号，并创建一个网络。可参考教程：\n\n[内网穿透工具——ZeroTier One的使用](https://www.jianshu.com/p/eefddb256ad7)\n\n建好网络后，获得十六位网络码\n\n然后，在树莓派和vps输入命令\n\n```shell\nzerotier-cli join 网络码\n```\n\n即可加入此网络\n\n然后回到zerotier官网，管理这两个网络，让他们之间能够互相ping通。此间步骤比较多，需要耐心自学。\n\n内网穿透实现后，在vps上不仅应该能够ping通树莓派虚拟局域网分配的ip，而且使用虚拟局域网ip:端口，应该能够访问到树莓派上的网站。\n\n在vps使用\n\n```shell\ncurl http://ip:port\n```\n\n访问。获取html代码，则内网穿透可以访问网站了。\n\n# 4：Nginx反向代理\n\n为了让所有外部的人，都能够通过域名或者vps公网ip访问到树莓派的网站，需要在vps上安装nginx，作反向代理。\n\n原理大概是，外部用户，访问vps的ip，浏览器默认不输入端口则访问80端口，http对应80，https对应443。比如用户输入`http://x.x.x.x`或者`http://example.com`则默认访问vps的80端口。\n\n我们需要为vps开放80端口，并将80端口的访问请求转到树莓派的网站端口。\n\n安装nginx\n\n```shell\napt-get install nginx\n```\n\n配置nginx，新建配置文件，并配置nginx\n\n```shell\ntouch /etc/nginx/conf.d/respberry.conf\t#新建配置文件\nvim /etc/nginx/conf.d/respberry.conf\t#编辑配置文件\n```\n\n在文件中输入配置\n\n```shell\nserver{\n\tlisten 80\n\tserver_name example.com\t#你的域名，或者vps的公网ip\n\tlocation / {\n\t\tproxy_pass http://树莓派虚拟局域网ip:网站端口\n\t}\n}\n```\n\n保存退出。\n\n```shell\nservice nginx restart\t#重启nginx\n```\n\n这样通过域名访问vps就能将请求转给树莓派了。外网就能够访问到树莓派了。\n\n# 5：参考资料\n\n《[内网穿透工具——ZeroTier One的使用](https://www.jianshu.com/p/eefddb256ad7)》\n\n《[Nginx配置文件nginx.conf中文详解](https://www.jianshu.com/p/3e2b9964c279)》","slug":"利用树莓派-内网穿透搭建网站服务器","published":1,"updated":"2020-09-10T23:31:14.611Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsac7002fp0vzc40x3v7d","content":"<h1 id=\"1：前言\"><a href=\"#1：前言\" class=\"headerlink\" title=\"1：前言\"></a>1：前言</h1><p>在购买了树莓派之后，我一直在找寻它的用处，最近想学基于Python的网站后端框架Django，而树莓派以linux为操作系统，有天生作为网站服务器的优点。以下列举部分。</p>\n<ol>\n<li>相比于直接购买高配置VPS，使用树莓派+廉价低配VPS做内网穿透，更加划算。</li>\n<li>相比于使用windows作为网站服务器联系，树莓派可以保持24*7不宕机，避免每次开启电脑都要重新运行服务器程序的麻烦。</li>\n</ol>\n<p>开始之前，需要说明的一些软硬件配置。</p>\n<ol>\n<li>4B+树莓派，4g内存+32g内存卡</li>\n<li>一台低配置带ipv4地址的VPS。本人使用Ubuntu系统</li>\n<li>一个域名，需要将A记录解析到VPS的ipv4地址上。非必须，可直接用vps的ip地址访问也是可以的。</li>\n</ol>\n<h1 id=\"2：树莓派上搭建Django服务器\"><a href=\"#2：树莓派上搭建Django服务器\" class=\"headerlink\" title=\"2：树莓派上搭建Django服务器\"></a>2：树莓派上搭建Django服务器</h1><p>安装Django教程：《<a href=\"https://www.runoob.com/django/django-install.html\">Django安装</a>》</p>\n<p>在树莓派上安装Django。</p>\n<p>并<a href=\"https://www.runoob.com/django/django-first-app.html\">创建第一个Django项目</a>。</p>\n<p>在使用<code>python3 manage.py runserver 0.0.0.0:8000</code>打开服务后，</p>\n<p>在shell终端上使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl 127.0.0.1:8000</span><br></pre></td></tr></table></figure>\n\n<p>是可以访问新建的网站的。</p>\n<p>但是，使用树莓派内网ip:8000在相同局域网下的笔记本，无法访问网站，必须修改项目配置文件。后期可修改回来，因为我们需要在树莓派上也安装nginx以作为生产环境，现在只是测试。修改项目下的setting.py文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEBUG = False</span><br><span class=\"line\">ALLOWED_HOSTS = [&quot;*&quot;]</span><br></pre></td></tr></table></figure>\n\n<p>此时，在笔记本上访问树莓派上面的网站，应该已经能够访问了。</p>\n<h1 id=\"3：内网穿透\"><a href=\"#3：内网穿透\" class=\"headerlink\" title=\"3：内网穿透\"></a>3：内网穿透</h1><p>为了让外网的人，能够使用ip地址或者域名，访问到树莓派上的网站，需要做内网穿透，首先，需要让VPS能够访问到树莓派。</p>\n<p>使用花生壳之类的软件也能实现内网穿透，且不用VPS，但是这类软件收费比较高，所以我们可以用VPS自己搞一个内网穿透。</p>\n<p>使用p2p组网的内网穿透软件，比如n2n、zerotier、frp。在github上都能搜得到。frp是一个端口转发的软件，不需要借助别人提供的服务器来做导航，如果只是做网站是非常推荐的，因为这不设及后面讲的nginx做反向代理的步骤，个人是很推荐的。但，如果你有多个VPS或者多个电脑，想组成局域网，建议使用zerotier。我这里使用的是zerotier，因为它配置比较简单。并在此基础上做了网站的反向代理，以实现外网访问内网，和frp直接做端口转发的原理是不同的。</p>\n<p>我们需要分别在树莓派和vps上安装zerotier。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s https://install.zerotier.com | sudo bash</span><br></pre></td></tr></table></figure>\n\n<p>然后在<a href=\"https://www.zerotier.com/\">zerotier官网</a>创建一个账号，并创建一个网络。可参考教程：</p>\n<p><a href=\"https://www.jianshu.com/p/eefddb256ad7\">内网穿透工具——ZeroTier One的使用</a></p>\n<p>建好网络后，获得十六位网络码</p>\n<p>然后，在树莓派和vps输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zerotier-cli join 网络码</span><br></pre></td></tr></table></figure>\n\n<p>即可加入此网络</p>\n<p>然后回到zerotier官网，管理这两个网络，让他们之间能够互相ping通。此间步骤比较多，需要耐心自学。</p>\n<p>内网穿透实现后，在vps上不仅应该能够ping通树莓派虚拟局域网分配的ip，而且使用虚拟局域网ip:端口，应该能够访问到树莓派上的网站。</p>\n<p>在vps使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://ip:port</span><br></pre></td></tr></table></figure>\n\n<p>访问。获取html代码，则内网穿透可以访问网站了。</p>\n<h1 id=\"4：Nginx反向代理\"><a href=\"#4：Nginx反向代理\" class=\"headerlink\" title=\"4：Nginx反向代理\"></a>4：Nginx反向代理</h1><p>为了让所有外部的人，都能够通过域名或者vps公网ip访问到树莓派的网站，需要在vps上安装nginx，作反向代理。</p>\n<p>原理大概是，外部用户，访问vps的ip，浏览器默认不输入端口则访问80端口，http对应80，https对应443。比如用户输入<code>http://x.x.x.x</code>或者<code>http://example.com</code>则默认访问vps的80端口。</p>\n<p>我们需要为vps开放80端口，并将80端口的访问请求转到树莓派的网站端口。</p>\n<p>安装nginx</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install nginx</span><br></pre></td></tr></table></figure>\n\n<p>配置nginx，新建配置文件，并配置nginx</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch /etc/nginx/conf.d/respberry.conf\t#新建配置文件</span><br><span class=\"line\">vim /etc/nginx/conf.d/respberry.conf\t#编辑配置文件</span><br></pre></td></tr></table></figure>\n\n<p>在文件中输入配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">\tlisten 80</span><br><span class=\"line\">\tserver_name example.com\t#你的域名，或者vps的公网ip</span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\tproxy_pass http://树莓派虚拟局域网ip:网站端口</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>保存退出。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service nginx restart\t#重启nginx</span><br></pre></td></tr></table></figure>\n\n<p>这样通过域名访问vps就能将请求转给树莓派了。外网就能够访问到树莓派了。</p>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://www.jianshu.com/p/eefddb256ad7\">内网穿透工具——ZeroTier One的使用</a>》</p>\n<p>《<a href=\"https://www.jianshu.com/p/3e2b9964c279\">Nginx配置文件nginx.conf中文详解</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：前言\"><a href=\"#1：前言\" class=\"headerlink\" title=\"1：前言\"></a>1：前言</h1><p>在购买了树莓派之后，我一直在找寻它的用处，最近想学基于Python的网站后端框架Django，而树莓派以linux为操作系统，有天生作为网站服务器的优点。以下列举部分。</p>\n<ol>\n<li>相比于直接购买高配置VPS，使用树莓派+廉价低配VPS做内网穿透，更加划算。</li>\n<li>相比于使用windows作为网站服务器联系，树莓派可以保持24*7不宕机，避免每次开启电脑都要重新运行服务器程序的麻烦。</li>\n</ol>\n<p>开始之前，需要说明的一些软硬件配置。</p>\n<ol>\n<li>4B+树莓派，4g内存+32g内存卡</li>\n<li>一台低配置带ipv4地址的VPS。本人使用Ubuntu系统</li>\n<li>一个域名，需要将A记录解析到VPS的ipv4地址上。非必须，可直接用vps的ip地址访问也是可以的。</li>\n</ol>\n<h1 id=\"2：树莓派上搭建Django服务器\"><a href=\"#2：树莓派上搭建Django服务器\" class=\"headerlink\" title=\"2：树莓派上搭建Django服务器\"></a>2：树莓派上搭建Django服务器</h1><p>安装Django教程：《<a href=\"https://www.runoob.com/django/django-install.html\">Django安装</a>》</p>\n<p>在树莓派上安装Django。</p>\n<p>并<a href=\"https://www.runoob.com/django/django-first-app.html\">创建第一个Django项目</a>。</p>\n<p>在使用<code>python3 manage.py runserver 0.0.0.0:8000</code>打开服务后，</p>\n<p>在shell终端上使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl 127.0.0.1:8000</span><br></pre></td></tr></table></figure>\n\n<p>是可以访问新建的网站的。</p>\n<p>但是，使用树莓派内网ip:8000在相同局域网下的笔记本，无法访问网站，必须修改项目配置文件。后期可修改回来，因为我们需要在树莓派上也安装nginx以作为生产环境，现在只是测试。修改项目下的setting.py文件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEBUG = False</span><br><span class=\"line\">ALLOWED_HOSTS = [&quot;*&quot;]</span><br></pre></td></tr></table></figure>\n\n<p>此时，在笔记本上访问树莓派上面的网站，应该已经能够访问了。</p>\n<h1 id=\"3：内网穿透\"><a href=\"#3：内网穿透\" class=\"headerlink\" title=\"3：内网穿透\"></a>3：内网穿透</h1><p>为了让外网的人，能够使用ip地址或者域名，访问到树莓派上的网站，需要做内网穿透，首先，需要让VPS能够访问到树莓派。</p>\n<p>使用花生壳之类的软件也能实现内网穿透，且不用VPS，但是这类软件收费比较高，所以我们可以用VPS自己搞一个内网穿透。</p>\n<p>使用p2p组网的内网穿透软件，比如n2n、zerotier、frp。在github上都能搜得到。frp是一个端口转发的软件，不需要借助别人提供的服务器来做导航，如果只是做网站是非常推荐的，因为这不设及后面讲的nginx做反向代理的步骤，个人是很推荐的。但，如果你有多个VPS或者多个电脑，想组成局域网，建议使用zerotier。我这里使用的是zerotier，因为它配置比较简单。并在此基础上做了网站的反向代理，以实现外网访问内网，和frp直接做端口转发的原理是不同的。</p>\n<p>我们需要分别在树莓派和vps上安装zerotier。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s https://install.zerotier.com | sudo bash</span><br></pre></td></tr></table></figure>\n\n<p>然后在<a href=\"https://www.zerotier.com/\">zerotier官网</a>创建一个账号，并创建一个网络。可参考教程：</p>\n<p><a href=\"https://www.jianshu.com/p/eefddb256ad7\">内网穿透工具——ZeroTier One的使用</a></p>\n<p>建好网络后，获得十六位网络码</p>\n<p>然后，在树莓派和vps输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zerotier-cli join 网络码</span><br></pre></td></tr></table></figure>\n\n<p>即可加入此网络</p>\n<p>然后回到zerotier官网，管理这两个网络，让他们之间能够互相ping通。此间步骤比较多，需要耐心自学。</p>\n<p>内网穿透实现后，在vps上不仅应该能够ping通树莓派虚拟局域网分配的ip，而且使用虚拟局域网ip:端口，应该能够访问到树莓派上的网站。</p>\n<p>在vps使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://ip:port</span><br></pre></td></tr></table></figure>\n\n<p>访问。获取html代码，则内网穿透可以访问网站了。</p>\n<h1 id=\"4：Nginx反向代理\"><a href=\"#4：Nginx反向代理\" class=\"headerlink\" title=\"4：Nginx反向代理\"></a>4：Nginx反向代理</h1><p>为了让所有外部的人，都能够通过域名或者vps公网ip访问到树莓派的网站，需要在vps上安装nginx，作反向代理。</p>\n<p>原理大概是，外部用户，访问vps的ip，浏览器默认不输入端口则访问80端口，http对应80，https对应443。比如用户输入<code>http://x.x.x.x</code>或者<code>http://example.com</code>则默认访问vps的80端口。</p>\n<p>我们需要为vps开放80端口，并将80端口的访问请求转到树莓派的网站端口。</p>\n<p>安装nginx</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install nginx</span><br></pre></td></tr></table></figure>\n\n<p>配置nginx，新建配置文件，并配置nginx</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch /etc/nginx/conf.d/respberry.conf\t#新建配置文件</span><br><span class=\"line\">vim /etc/nginx/conf.d/respberry.conf\t#编辑配置文件</span><br></pre></td></tr></table></figure>\n\n<p>在文件中输入配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">\tlisten 80</span><br><span class=\"line\">\tserver_name example.com\t#你的域名，或者vps的公网ip</span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\tproxy_pass http://树莓派虚拟局域网ip:网站端口</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>保存退出。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service nginx restart\t#重启nginx</span><br></pre></td></tr></table></figure>\n\n<p>这样通过域名访问vps就能将请求转给树莓派了。外网就能够访问到树莓派了。</p>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://www.jianshu.com/p/eefddb256ad7\">内网穿透工具——ZeroTier One的使用</a>》</p>\n<p>《<a href=\"https://www.jianshu.com/p/3e2b9964c279\">Nginx配置文件nginx.conf中文详解</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Fri Sep 11 2020 01:31:14 GMT+0200 (GMT+02:00)","title":"利用树莓派+内网穿透搭建网站服务器","path":"2020/09/10/利用树莓派-内网穿透搭建网站服务器/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-10T20:08:39.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-10T20:08:39.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["Linux","Python","树莓派"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"利用海贝音乐做一个自用音乐播放器","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-06T16:45:48.000Z","password":null,"summary":"一个免费的个人音乐收藏和播放项目","_content":"\n# 1：项目简介\n\n对于我这个经常听歌的人来说，免费的听歌软件总是很有用的。我在网上找到了一款叫做海贝音乐的播放器，这个播放器不提供音乐资源，仅仅是一个播放器，可以播放本地音乐、Onedrive云音乐，以及DLNA局域网里的音乐。对于很多人来说，将好听喜欢的音乐下载下来保存到手机，总归是个麻烦的操作，如果想在线听歌，又需要购买音乐软件的VIP。那么有没有一个方法，可以免费而又在不下载音乐在线听歌呢？\n\n我将利用Onedrive作为音乐储存云盘，并在海贝音乐播放器上，实现在线听歌。将喜欢的音乐下载到Onedrive是个非常麻烦的步骤，为此我将在之后编写一个项目，来实现自动下载热榜音乐至云盘指定目录，并编写一个客户端，用作搜索指定音乐，并保存到云盘的接口。此项目，我将使用python进行编写，并在linux系统上运行。\n\n# 2：实现原理\n\n## 2.1 音乐来源\n\n免费音乐接口总是很难获取，甚至很不稳定，为此我们需要合法的获取音乐资源。为此，我考虑从YouTube上获取音乐资源，因为音乐MV和MP3格式的隶属不同版权，而MV往往是不收费的，所以直接从youtube上下载mv的mp4格式文件，这里利用基于python编写的you-get程序即可，然后，利用ffmpeg软件将mp4格式文件转为mp3格式。\n\n## 2.2 音乐获取\n\n获取音乐当然不能一个一个的获取，我们可以在网上找到网易或者qq音乐的榜单api，获取榜单列表，根据列表内容使用程序来检索音乐。\n\n另外在单独做一个web端，用于搜索音乐。后台根据搜索指令下载音乐。\n\n歌词可以通过歌词迷接口https://hacpai.com/article/1364440883834 获取。\n\n## 2.3 音乐保存\n\n后台转换后的音乐，可以利用onedrive提供的上传接口，把音乐上传到onedrive目录，比如榜单目录和自行搜索的like目录。\n\n定期使用onedrive接口清除过时的音乐也很重要。\n\n## 2.4 音乐收听\n\n海贝音乐app提供了从onedrive源收听音乐的功能，因此，直接在海贝音乐上授权onedrive就能够在线收听了，而一个onedrive目录就是一个播放列表。","source":"_posts/利用海贝音乐做一个自用音乐播放器.md","raw":"---\ntitle: 利用海贝音乐做一个自用音乐播放器\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-06 18:45:48\npassword:\nsummary: 一个免费的个人音乐收藏和播放项目\ntags: 音乐播放器\ncategories: Python\n---\n\n# 1：项目简介\n\n对于我这个经常听歌的人来说，免费的听歌软件总是很有用的。我在网上找到了一款叫做海贝音乐的播放器，这个播放器不提供音乐资源，仅仅是一个播放器，可以播放本地音乐、Onedrive云音乐，以及DLNA局域网里的音乐。对于很多人来说，将好听喜欢的音乐下载下来保存到手机，总归是个麻烦的操作，如果想在线听歌，又需要购买音乐软件的VIP。那么有没有一个方法，可以免费而又在不下载音乐在线听歌呢？\n\n我将利用Onedrive作为音乐储存云盘，并在海贝音乐播放器上，实现在线听歌。将喜欢的音乐下载到Onedrive是个非常麻烦的步骤，为此我将在之后编写一个项目，来实现自动下载热榜音乐至云盘指定目录，并编写一个客户端，用作搜索指定音乐，并保存到云盘的接口。此项目，我将使用python进行编写，并在linux系统上运行。\n\n# 2：实现原理\n\n## 2.1 音乐来源\n\n免费音乐接口总是很难获取，甚至很不稳定，为此我们需要合法的获取音乐资源。为此，我考虑从YouTube上获取音乐资源，因为音乐MV和MP3格式的隶属不同版权，而MV往往是不收费的，所以直接从youtube上下载mv的mp4格式文件，这里利用基于python编写的you-get程序即可，然后，利用ffmpeg软件将mp4格式文件转为mp3格式。\n\n## 2.2 音乐获取\n\n获取音乐当然不能一个一个的获取，我们可以在网上找到网易或者qq音乐的榜单api，获取榜单列表，根据列表内容使用程序来检索音乐。\n\n另外在单独做一个web端，用于搜索音乐。后台根据搜索指令下载音乐。\n\n歌词可以通过歌词迷接口https://hacpai.com/article/1364440883834 获取。\n\n## 2.3 音乐保存\n\n后台转换后的音乐，可以利用onedrive提供的上传接口，把音乐上传到onedrive目录，比如榜单目录和自行搜索的like目录。\n\n定期使用onedrive接口清除过时的音乐也很重要。\n\n## 2.4 音乐收听\n\n海贝音乐app提供了从onedrive源收听音乐的功能，因此，直接在海贝音乐上授权onedrive就能够在线收听了，而一个onedrive目录就是一个播放列表。","slug":"利用海贝音乐做一个自用音乐播放器","published":1,"updated":"2020-09-30T20:32:57.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsac8002jp0vz457y1fsv","content":"<h1 id=\"1：项目简介\"><a href=\"#1：项目简介\" class=\"headerlink\" title=\"1：项目简介\"></a>1：项目简介</h1><p>对于我这个经常听歌的人来说，免费的听歌软件总是很有用的。我在网上找到了一款叫做海贝音乐的播放器，这个播放器不提供音乐资源，仅仅是一个播放器，可以播放本地音乐、Onedrive云音乐，以及DLNA局域网里的音乐。对于很多人来说，将好听喜欢的音乐下载下来保存到手机，总归是个麻烦的操作，如果想在线听歌，又需要购买音乐软件的VIP。那么有没有一个方法，可以免费而又在不下载音乐在线听歌呢？</p>\n<p>我将利用Onedrive作为音乐储存云盘，并在海贝音乐播放器上，实现在线听歌。将喜欢的音乐下载到Onedrive是个非常麻烦的步骤，为此我将在之后编写一个项目，来实现自动下载热榜音乐至云盘指定目录，并编写一个客户端，用作搜索指定音乐，并保存到云盘的接口。此项目，我将使用python进行编写，并在linux系统上运行。</p>\n<h1 id=\"2：实现原理\"><a href=\"#2：实现原理\" class=\"headerlink\" title=\"2：实现原理\"></a>2：实现原理</h1><h2 id=\"2-1-音乐来源\"><a href=\"#2-1-音乐来源\" class=\"headerlink\" title=\"2.1 音乐来源\"></a>2.1 音乐来源</h2><p>免费音乐接口总是很难获取，甚至很不稳定，为此我们需要合法的获取音乐资源。为此，我考虑从YouTube上获取音乐资源，因为音乐MV和MP3格式的隶属不同版权，而MV往往是不收费的，所以直接从youtube上下载mv的mp4格式文件，这里利用基于python编写的you-get程序即可，然后，利用ffmpeg软件将mp4格式文件转为mp3格式。</p>\n<h2 id=\"2-2-音乐获取\"><a href=\"#2-2-音乐获取\" class=\"headerlink\" title=\"2.2 音乐获取\"></a>2.2 音乐获取</h2><p>获取音乐当然不能一个一个的获取，我们可以在网上找到网易或者qq音乐的榜单api，获取榜单列表，根据列表内容使用程序来检索音乐。</p>\n<p>另外在单独做一个web端，用于搜索音乐。后台根据搜索指令下载音乐。</p>\n<p>歌词可以通过歌词迷接口<a href=\"https://hacpai.com/article/1364440883834\">https://hacpai.com/article/1364440883834</a> 获取。</p>\n<h2 id=\"2-3-音乐保存\"><a href=\"#2-3-音乐保存\" class=\"headerlink\" title=\"2.3 音乐保存\"></a>2.3 音乐保存</h2><p>后台转换后的音乐，可以利用onedrive提供的上传接口，把音乐上传到onedrive目录，比如榜单目录和自行搜索的like目录。</p>\n<p>定期使用onedrive接口清除过时的音乐也很重要。</p>\n<h2 id=\"2-4-音乐收听\"><a href=\"#2-4-音乐收听\" class=\"headerlink\" title=\"2.4 音乐收听\"></a>2.4 音乐收听</h2><p>海贝音乐app提供了从onedrive源收听音乐的功能，因此，直接在海贝音乐上授权onedrive就能够在线收听了，而一个onedrive目录就是一个播放列表。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：项目简介\"><a href=\"#1：项目简介\" class=\"headerlink\" title=\"1：项目简介\"></a>1：项目简介</h1><p>对于我这个经常听歌的人来说，免费的听歌软件总是很有用的。我在网上找到了一款叫做海贝音乐的播放器，这个播放器不提供音乐资源，仅仅是一个播放器，可以播放本地音乐、Onedrive云音乐，以及DLNA局域网里的音乐。对于很多人来说，将好听喜欢的音乐下载下来保存到手机，总归是个麻烦的操作，如果想在线听歌，又需要购买音乐软件的VIP。那么有没有一个方法，可以免费而又在不下载音乐在线听歌呢？</p>\n<p>我将利用Onedrive作为音乐储存云盘，并在海贝音乐播放器上，实现在线听歌。将喜欢的音乐下载到Onedrive是个非常麻烦的步骤，为此我将在之后编写一个项目，来实现自动下载热榜音乐至云盘指定目录，并编写一个客户端，用作搜索指定音乐，并保存到云盘的接口。此项目，我将使用python进行编写，并在linux系统上运行。</p>\n<h1 id=\"2：实现原理\"><a href=\"#2：实现原理\" class=\"headerlink\" title=\"2：实现原理\"></a>2：实现原理</h1><h2 id=\"2-1-音乐来源\"><a href=\"#2-1-音乐来源\" class=\"headerlink\" title=\"2.1 音乐来源\"></a>2.1 音乐来源</h2><p>免费音乐接口总是很难获取，甚至很不稳定，为此我们需要合法的获取音乐资源。为此，我考虑从YouTube上获取音乐资源，因为音乐MV和MP3格式的隶属不同版权，而MV往往是不收费的，所以直接从youtube上下载mv的mp4格式文件，这里利用基于python编写的you-get程序即可，然后，利用ffmpeg软件将mp4格式文件转为mp3格式。</p>\n<h2 id=\"2-2-音乐获取\"><a href=\"#2-2-音乐获取\" class=\"headerlink\" title=\"2.2 音乐获取\"></a>2.2 音乐获取</h2><p>获取音乐当然不能一个一个的获取，我们可以在网上找到网易或者qq音乐的榜单api，获取榜单列表，根据列表内容使用程序来检索音乐。</p>\n<p>另外在单独做一个web端，用于搜索音乐。后台根据搜索指令下载音乐。</p>\n<p>歌词可以通过歌词迷接口<a href=\"https://hacpai.com/article/1364440883834\">https://hacpai.com/article/1364440883834</a> 获取。</p>\n<h2 id=\"2-3-音乐保存\"><a href=\"#2-3-音乐保存\" class=\"headerlink\" title=\"2.3 音乐保存\"></a>2.3 音乐保存</h2><p>后台转换后的音乐，可以利用onedrive提供的上传接口，把音乐上传到onedrive目录，比如榜单目录和自行搜索的like目录。</p>\n<p>定期使用onedrive接口清除过时的音乐也很重要。</p>\n<h2 id=\"2-4-音乐收听\"><a href=\"#2-4-音乐收听\" class=\"headerlink\" title=\"2.4 音乐收听\"></a>2.4 音乐收听</h2><p>海贝音乐app提供了从onedrive源收听音乐的功能，因此，直接在海贝音乐上授权onedrive就能够在线收听了，而一个onedrive目录就是一个播放列表。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Wed Sep 30 2020 22:32:57 GMT+0200 (GMT+02:00)","title":"利用海贝音乐做一个自用音乐播放器","path":"2020/09/06/利用海贝音乐做一个自用音乐播放器/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-06T16:45:48.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-06T16:45:48.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Python","tags":["音乐播放器"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"在订单中打印收货地址二维码","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-08-28T15:14:28.000Z","password":null,"summary":null,"_content":"\n# 一：简介\n\n七夕节在配送过程中，发现配送员由于文化有限，在使用导航软件上有极大的障碍。这不仅拖慢了整个配送过程，也不利于业务的增长。于是我想到了，在订单上打印一个二维码，扫描二维码，则就可以导航到收货地点。\n\n在一段时间的尝试后，我敲定了此方案的可行性。\n\n由于美图和饿了么订单打印，已在飞鹅打印机上固定了模板，我无法修改他们的打印模板。所以，只能为小程序的订单，打印地址二维码。\n\n# 二：方案\n\n由于各个地图公司都没有提供直接的接口，让地图转为二维码，所以退而求其次，需要先将地址转为url，进入这个url可以进入地图界面，然后将url转为二维码。\n\n## 2.1 地图转url\n\n1. **百度地图方案**\n\n在查看了几个地图技术文档后，我找到了百度地图的接口。\n\n地址：http://lbsyun.baidu.com/index.php?title=uri/api/web\n\n此接口提供了免费的调起地图的url方案。由于我们只能拿到收货地址，所以可以使用下面的接口\n\n服务地址\n\n```\nhttp://api.map.baidu.com/geocoder   //PC&Webapp服务地址\n```\n\n示例\n\n```\nhttp://api.map.baidu.com/geocoder?address=北京市海淀区上地信息路9号奎科科技大厦&output=html&src=webapp.baidu.openAPIdemo\n```\n\n打开后的页面\n\n![](https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png)2\n\n2. **高德地图方案**\n\n高德地图提供Web调起地图的接口格式如下：\n\n```\nhttps://uri.amap.com/marker?position=116.473195,39.993253\n```\n\nurl参数：\n\n| 参数名称   | 值(点击可编辑)       | 参数说明                                                     | 是否必选 | 备注                            |\n| :--------- | :------------------- | :----------------------------------------------------------- | :------- | :------------------------------ |\n| position   | 116.473195,39.993253 | 位置点经纬度坐标，格式为: position=lon,lat                   | 是       | lon表示经度，lat表示纬度        |\n| name       | 首开广场             | 用户自定义显示名称                                           | 否       |                                 |\n| src        | mypage               | 使用方来源信息                                               | 否       | 为保证服务质量建议填写          |\n| coordinate | gaode                | 坐标系参数coordinate=gaode,表示高德坐标（gcj02坐标），coordinate=wgs84,表示wgs84坐标（GPS原始坐标） | 否       | 默认为高德坐标系（gcj02坐标系） |\n| callnative | 0                    | 是否尝试调起高德地图APP并在APP中查看，0表示不调起，1表示调起, 默认值为0 | 否       | 该参数仅在移动端有效            |\n\n和百度地图不同的是，这个接口不提供类似搜索功能的接口方式，其中经纬度为必填项，因此，我们必须将订单地址，先调用高德的地理名称转经纬度api，在调用此接口。\n\n详细的地理编码api参见：https://lbs.amap.com/api/webservice/guide/api/georegeo/\n\n通过上述两个api获取，地址的链接，详细php函数如下：\n\n```php\n/**\n\t\t   * [getAddressUrl 生成地址url]\n\t\t   * @param  [string] $taddress [订单地址]\n\t\t   * @return [string]       [返回地址url]\n\t\t   */\npublic function getAddressUrl($address){\n\t\t    $api = \"https://restapi.amap.com/v3/geocode/geo\";\n\t\t    $key = \"你申请的高德地图key\";\n\t\t    $request_url = $api.\"?address=\".$address.\"&output=JSON&key=\".$key;\n\t\t    $response = file_get_contents($request_url);\n\t\t    $obj = json_decode($response);\n\t\t    if(strcmp($obj->status,\"1\")==0){\n\t\t    \t$location_code = $obj->geocodes[\"0\"]->location;\n\t\t    \t$address_url = \"https://uri.amap.com/marker?position=\".$location_code.\"&name=\".$address;\n\t\t    }else{\n\t\t    \treturn 0;\n\t\t    }\n\t\t    return $address_url;\n\t\t  }\n```\n\n对比高德地图和百度地图。百度地图在编程方面更加方便，但是对于扫描二维码体验而言，百度地图必须使用浏览器扫描，或者微信扫描后根据提示打开浏览器，然后由浏览器调起百度地图进入导航。直接使用百度地图扫描二维码是无法调出导航的，而且百度地图扫描功能隐藏在搜索框之中，使用非常不方便。相对而言，用户使用高德地图api生成的二维码使用高德地图首页的扫一扫功能，可以直接进入导航界面。\n\n## 2.2 url转二维码\n\n在网上能找到许多提供url转二维码的api接口。\n\n在简书https://www.jianshu.com/p/064ab5c811cf 里，提供了许多接口。\n\n由于飞鹅打印机的技术文档中说明了，只需要在打印时在\\<QR\\>标签中输入url即可自动转换，所以，不在需要使用额外的接口。\n\n> ⭐但是需要注意的是，通过get来获取url二维码，必须先使用url_encode将url编码，否则二维码中将丢失url的参数信息。\n\n","source":"_posts/在订单中打印收货地址二维码.md","raw":"---\ntitle: 在订单中打印收货地址二维码\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-08-28 17:14:28\npassword:\nsummary:\ntags: 电商\ncategories: 网站编程\n---\n\n# 一：简介\n\n七夕节在配送过程中，发现配送员由于文化有限，在使用导航软件上有极大的障碍。这不仅拖慢了整个配送过程，也不利于业务的增长。于是我想到了，在订单上打印一个二维码，扫描二维码，则就可以导航到收货地点。\n\n在一段时间的尝试后，我敲定了此方案的可行性。\n\n由于美图和饿了么订单打印，已在飞鹅打印机上固定了模板，我无法修改他们的打印模板。所以，只能为小程序的订单，打印地址二维码。\n\n# 二：方案\n\n由于各个地图公司都没有提供直接的接口，让地图转为二维码，所以退而求其次，需要先将地址转为url，进入这个url可以进入地图界面，然后将url转为二维码。\n\n## 2.1 地图转url\n\n1. **百度地图方案**\n\n在查看了几个地图技术文档后，我找到了百度地图的接口。\n\n地址：http://lbsyun.baidu.com/index.php?title=uri/api/web\n\n此接口提供了免费的调起地图的url方案。由于我们只能拿到收货地址，所以可以使用下面的接口\n\n服务地址\n\n```\nhttp://api.map.baidu.com/geocoder   //PC&Webapp服务地址\n```\n\n示例\n\n```\nhttp://api.map.baidu.com/geocoder?address=北京市海淀区上地信息路9号奎科科技大厦&output=html&src=webapp.baidu.openAPIdemo\n```\n\n打开后的页面\n\n![](https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png)2\n\n2. **高德地图方案**\n\n高德地图提供Web调起地图的接口格式如下：\n\n```\nhttps://uri.amap.com/marker?position=116.473195,39.993253\n```\n\nurl参数：\n\n| 参数名称   | 值(点击可编辑)       | 参数说明                                                     | 是否必选 | 备注                            |\n| :--------- | :------------------- | :----------------------------------------------------------- | :------- | :------------------------------ |\n| position   | 116.473195,39.993253 | 位置点经纬度坐标，格式为: position=lon,lat                   | 是       | lon表示经度，lat表示纬度        |\n| name       | 首开广场             | 用户自定义显示名称                                           | 否       |                                 |\n| src        | mypage               | 使用方来源信息                                               | 否       | 为保证服务质量建议填写          |\n| coordinate | gaode                | 坐标系参数coordinate=gaode,表示高德坐标（gcj02坐标），coordinate=wgs84,表示wgs84坐标（GPS原始坐标） | 否       | 默认为高德坐标系（gcj02坐标系） |\n| callnative | 0                    | 是否尝试调起高德地图APP并在APP中查看，0表示不调起，1表示调起, 默认值为0 | 否       | 该参数仅在移动端有效            |\n\n和百度地图不同的是，这个接口不提供类似搜索功能的接口方式，其中经纬度为必填项，因此，我们必须将订单地址，先调用高德的地理名称转经纬度api，在调用此接口。\n\n详细的地理编码api参见：https://lbs.amap.com/api/webservice/guide/api/georegeo/\n\n通过上述两个api获取，地址的链接，详细php函数如下：\n\n```php\n/**\n\t\t   * [getAddressUrl 生成地址url]\n\t\t   * @param  [string] $taddress [订单地址]\n\t\t   * @return [string]       [返回地址url]\n\t\t   */\npublic function getAddressUrl($address){\n\t\t    $api = \"https://restapi.amap.com/v3/geocode/geo\";\n\t\t    $key = \"你申请的高德地图key\";\n\t\t    $request_url = $api.\"?address=\".$address.\"&output=JSON&key=\".$key;\n\t\t    $response = file_get_contents($request_url);\n\t\t    $obj = json_decode($response);\n\t\t    if(strcmp($obj->status,\"1\")==0){\n\t\t    \t$location_code = $obj->geocodes[\"0\"]->location;\n\t\t    \t$address_url = \"https://uri.amap.com/marker?position=\".$location_code.\"&name=\".$address;\n\t\t    }else{\n\t\t    \treturn 0;\n\t\t    }\n\t\t    return $address_url;\n\t\t  }\n```\n\n对比高德地图和百度地图。百度地图在编程方面更加方便，但是对于扫描二维码体验而言，百度地图必须使用浏览器扫描，或者微信扫描后根据提示打开浏览器，然后由浏览器调起百度地图进入导航。直接使用百度地图扫描二维码是无法调出导航的，而且百度地图扫描功能隐藏在搜索框之中，使用非常不方便。相对而言，用户使用高德地图api生成的二维码使用高德地图首页的扫一扫功能，可以直接进入导航界面。\n\n## 2.2 url转二维码\n\n在网上能找到许多提供url转二维码的api接口。\n\n在简书https://www.jianshu.com/p/064ab5c811cf 里，提供了许多接口。\n\n由于飞鹅打印机的技术文档中说明了，只需要在打印时在\\<QR\\>标签中输入url即可自动转换，所以，不在需要使用额外的接口。\n\n> ⭐但是需要注意的是，通过get来获取url二维码，必须先使用url_encode将url编码，否则二维码中将丢失url的参数信息。\n\n","slug":"在订单中打印收货地址二维码","published":1,"updated":"2020-08-29T16:05:27.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaca002np0vzgjz92uvl","content":"<h1 id=\"一：简介\"><a href=\"#一：简介\" class=\"headerlink\" title=\"一：简介\"></a>一：简介</h1><p>七夕节在配送过程中，发现配送员由于文化有限，在使用导航软件上有极大的障碍。这不仅拖慢了整个配送过程，也不利于业务的增长。于是我想到了，在订单上打印一个二维码，扫描二维码，则就可以导航到收货地点。</p>\n<p>在一段时间的尝试后，我敲定了此方案的可行性。</p>\n<p>由于美图和饿了么订单打印，已在飞鹅打印机上固定了模板，我无法修改他们的打印模板。所以，只能为小程序的订单，打印地址二维码。</p>\n<h1 id=\"二：方案\"><a href=\"#二：方案\" class=\"headerlink\" title=\"二：方案\"></a>二：方案</h1><p>由于各个地图公司都没有提供直接的接口，让地图转为二维码，所以退而求其次，需要先将地址转为url，进入这个url可以进入地图界面，然后将url转为二维码。</p>\n<h2 id=\"2-1-地图转url\"><a href=\"#2-1-地图转url\" class=\"headerlink\" title=\"2.1 地图转url\"></a>2.1 地图转url</h2><ol>\n<li><strong>百度地图方案</strong></li>\n</ol>\n<p>在查看了几个地图技术文档后，我找到了百度地图的接口。</p>\n<p>地址：<a href=\"http://lbsyun.baidu.com/index.php?title=uri/api/web\">http://lbsyun.baidu.com/index.php?title=uri/api/web</a></p>\n<p>此接口提供了免费的调起地图的url方案。由于我们只能拿到收货地址，所以可以使用下面的接口</p>\n<p>服务地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;api.map.baidu.com&#x2F;geocoder   &#x2F;&#x2F;PC&amp;Webapp服务地址</span><br></pre></td></tr></table></figure>\n\n<p>示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;api.map.baidu.com&#x2F;geocoder?address&#x3D;北京市海淀区上地信息路9号奎科科技大厦&amp;output&#x3D;html&amp;src&#x3D;webapp.baidu.openAPIdemo</span><br></pre></td></tr></table></figure>\n\n<p>打开后的页面</p>\n<p><img src=\"https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\">2</p>\n<ol start=\"2\">\n<li><strong>高德地图方案</strong></li>\n</ol>\n<p>高德地图提供Web调起地图的接口格式如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;uri.amap.com&#x2F;marker?position&#x3D;116.473195,39.993253</span><br></pre></td></tr></table></figure>\n\n<p>url参数：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数名称</th>\n<th align=\"left\">值(点击可编辑)</th>\n<th align=\"left\">参数说明</th>\n<th align=\"left\">是否必选</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">position</td>\n<td align=\"left\">116.473195,39.993253</td>\n<td align=\"left\">位置点经纬度坐标，格式为: position=lon,lat</td>\n<td align=\"left\">是</td>\n<td align=\"left\">lon表示经度，lat表示纬度</td>\n</tr>\n<tr>\n<td align=\"left\">name</td>\n<td align=\"left\">首开广场</td>\n<td align=\"left\">用户自定义显示名称</td>\n<td align=\"left\">否</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">src</td>\n<td align=\"left\">mypage</td>\n<td align=\"left\">使用方来源信息</td>\n<td align=\"left\">否</td>\n<td align=\"left\">为保证服务质量建议填写</td>\n</tr>\n<tr>\n<td align=\"left\">coordinate</td>\n<td align=\"left\">gaode</td>\n<td align=\"left\">坐标系参数coordinate=gaode,表示高德坐标（gcj02坐标），coordinate=wgs84,表示wgs84坐标（GPS原始坐标）</td>\n<td align=\"left\">否</td>\n<td align=\"left\">默认为高德坐标系（gcj02坐标系）</td>\n</tr>\n<tr>\n<td align=\"left\">callnative</td>\n<td align=\"left\">0</td>\n<td align=\"left\">是否尝试调起高德地图APP并在APP中查看，0表示不调起，1表示调起, 默认值为0</td>\n<td align=\"left\">否</td>\n<td align=\"left\">该参数仅在移动端有效</td>\n</tr>\n</tbody></table>\n<p>和百度地图不同的是，这个接口不提供类似搜索功能的接口方式，其中经纬度为必填项，因此，我们必须将订单地址，先调用高德的地理名称转经纬度api，在调用此接口。</p>\n<p>详细的地理编码api参见：<a href=\"https://lbs.amap.com/api/webservice/guide/api/georegeo/\">https://lbs.amap.com/api/webservice/guide/api/georegeo/</a></p>\n<p>通过上述两个api获取，地址的链接，详细php函数如下：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   * [getAddressUrl 生成地址url]</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   * <span class=\"doctag\">@param</span>  [string] $taddress [订单地址]</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   * <span class=\"doctag\">@return</span> [string]       [返回地址url]</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getAddressUrl</span>(<span class=\"params\">$address</span>)</span>&#123;</span><br><span class=\"line\">\t\t    $api = <span class=\"string\">&quot;https://restapi.amap.com/v3/geocode/geo&quot;</span>;</span><br><span class=\"line\">\t\t    $key = <span class=\"string\">&quot;你申请的高德地图key&quot;</span>;</span><br><span class=\"line\">\t\t    $request_url = $api.<span class=\"string\">&quot;?address=&quot;</span>.$address.<span class=\"string\">&quot;&amp;output=JSON&amp;key=&quot;</span>.$key;</span><br><span class=\"line\">\t\t    $response = file_get_contents($request_url);</span><br><span class=\"line\">\t\t    $obj = json_decode($response);</span><br><span class=\"line\">\t\t    <span class=\"keyword\">if</span>(strcmp($obj-&gt;status,<span class=\"string\">&quot;1&quot;</span>)==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t    \t$location_code = $obj-&gt;geocodes[<span class=\"string\">&quot;0&quot;</span>]-&gt;location;</span><br><span class=\"line\">\t\t    \t$address_url = <span class=\"string\">&quot;https://uri.amap.com/marker?position=&quot;</span>.$location_code.<span class=\"string\">&quot;&amp;name=&quot;</span>.$address;</span><br><span class=\"line\">\t\t    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t    \t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t    &#125;</span><br><span class=\"line\">\t\t    <span class=\"keyword\">return</span> $address_url;</span><br><span class=\"line\">\t\t  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>对比高德地图和百度地图。百度地图在编程方面更加方便，但是对于扫描二维码体验而言，百度地图必须使用浏览器扫描，或者微信扫描后根据提示打开浏览器，然后由浏览器调起百度地图进入导航。直接使用百度地图扫描二维码是无法调出导航的，而且百度地图扫描功能隐藏在搜索框之中，使用非常不方便。相对而言，用户使用高德地图api生成的二维码使用高德地图首页的扫一扫功能，可以直接进入导航界面。</p>\n<h2 id=\"2-2-url转二维码\"><a href=\"#2-2-url转二维码\" class=\"headerlink\" title=\"2.2 url转二维码\"></a>2.2 url转二维码</h2><p>在网上能找到许多提供url转二维码的api接口。</p>\n<p>在简书<a href=\"https://www.jianshu.com/p/064ab5c811cf\">https://www.jianshu.com/p/064ab5c811cf</a> 里，提供了许多接口。</p>\n<p>由于飞鹅打印机的技术文档中说明了，只需要在打印时在&lt;QR&gt;标签中输入url即可自动转换，所以，不在需要使用额外的接口。</p>\n<blockquote>\n<p>⭐但是需要注意的是，通过get来获取url二维码，必须先使用url_encode将url编码，否则二维码中将丢失url的参数信息。</p>\n</blockquote>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"一：简介\"><a href=\"#一：简介\" class=\"headerlink\" title=\"一：简介\"></a>一：简介</h1><p>七夕节在配送过程中，发现配送员由于文化有限，在使用导航软件上有极大的障碍。这不仅拖慢了整个配送过程，也不利于业务的增长。于是我想到了，在订单上打印一个二维码，扫描二维码，则就可以导航到收货地点。</p>\n<p>在一段时间的尝试后，我敲定了此方案的可行性。</p>\n<p>由于美图和饿了么订单打印，已在飞鹅打印机上固定了模板，我无法修改他们的打印模板。所以，只能为小程序的订单，打印地址二维码。</p>\n<h1 id=\"二：方案\"><a href=\"#二：方案\" class=\"headerlink\" title=\"二：方案\"></a>二：方案</h1><p>由于各个地图公司都没有提供直接的接口，让地图转为二维码，所以退而求其次，需要先将地址转为url，进入这个url可以进入地图界面，然后将url转为二维码。</p>\n<h2 id=\"2-1-地图转url\"><a href=\"#2-1-地图转url\" class=\"headerlink\" title=\"2.1 地图转url\"></a>2.1 地图转url</h2><ol>\n<li><strong>百度地图方案</strong></li>\n</ol>\n<p>在查看了几个地图技术文档后，我找到了百度地图的接口。</p>\n<p>地址：<a href=\"http://lbsyun.baidu.com/index.php?title=uri/api/web\">http://lbsyun.baidu.com/index.php?title=uri/api/web</a></p>\n<p>此接口提供了免费的调起地图的url方案。由于我们只能拿到收货地址，所以可以使用下面的接口</p>\n<p>服务地址</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;api.map.baidu.com&#x2F;geocoder   &#x2F;&#x2F;PC&amp;Webapp服务地址</span><br></pre></td></tr></table></figure>\n\n<p>示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;api.map.baidu.com&#x2F;geocoder?address&#x3D;北京市海淀区上地信息路9号奎科科技大厦&amp;output&#x3D;html&amp;src&#x3D;webapp.baidu.openAPIdemo</span><br></pre></td></tr></table></figure>\n\n<p>打开后的页面</p>\n<p><img src=\"https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png\">2</p>\n<ol start=\"2\">\n<li><strong>高德地图方案</strong></li>\n</ol>\n<p>高德地图提供Web调起地图的接口格式如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;uri.amap.com&#x2F;marker?position&#x3D;116.473195,39.993253</span><br></pre></td></tr></table></figure>\n\n<p>url参数：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数名称</th>\n<th align=\"left\">值(点击可编辑)</th>\n<th align=\"left\">参数说明</th>\n<th align=\"left\">是否必选</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">position</td>\n<td align=\"left\">116.473195,39.993253</td>\n<td align=\"left\">位置点经纬度坐标，格式为: position=lon,lat</td>\n<td align=\"left\">是</td>\n<td align=\"left\">lon表示经度，lat表示纬度</td>\n</tr>\n<tr>\n<td align=\"left\">name</td>\n<td align=\"left\">首开广场</td>\n<td align=\"left\">用户自定义显示名称</td>\n<td align=\"left\">否</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">src</td>\n<td align=\"left\">mypage</td>\n<td align=\"left\">使用方来源信息</td>\n<td align=\"left\">否</td>\n<td align=\"left\">为保证服务质量建议填写</td>\n</tr>\n<tr>\n<td align=\"left\">coordinate</td>\n<td align=\"left\">gaode</td>\n<td align=\"left\">坐标系参数coordinate=gaode,表示高德坐标（gcj02坐标），coordinate=wgs84,表示wgs84坐标（GPS原始坐标）</td>\n<td align=\"left\">否</td>\n<td align=\"left\">默认为高德坐标系（gcj02坐标系）</td>\n</tr>\n<tr>\n<td align=\"left\">callnative</td>\n<td align=\"left\">0</td>\n<td align=\"left\">是否尝试调起高德地图APP并在APP中查看，0表示不调起，1表示调起, 默认值为0</td>\n<td align=\"left\">否</td>\n<td align=\"left\">该参数仅在移动端有效</td>\n</tr>\n</tbody></table>\n<p>和百度地图不同的是，这个接口不提供类似搜索功能的接口方式，其中经纬度为必填项，因此，我们必须将订单地址，先调用高德的地理名称转经纬度api，在调用此接口。</p>\n<p>详细的地理编码api参见：<a href=\"https://lbs.amap.com/api/webservice/guide/api/georegeo/\">https://lbs.amap.com/api/webservice/guide/api/georegeo/</a></p>\n<p>通过上述两个api获取，地址的链接，详细php函数如下：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   * [getAddressUrl 生成地址url]</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   * <span class=\"doctag\">@param</span>  [string] $taddress [订单地址]</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   * <span class=\"doctag\">@return</span> [string]       [返回地址url]</span></span><br><span class=\"line\"><span class=\"comment\">\t\t   */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getAddressUrl</span>(<span class=\"params\">$address</span>)</span>&#123;</span><br><span class=\"line\">\t\t    $api = <span class=\"string\">&quot;https://restapi.amap.com/v3/geocode/geo&quot;</span>;</span><br><span class=\"line\">\t\t    $key = <span class=\"string\">&quot;你申请的高德地图key&quot;</span>;</span><br><span class=\"line\">\t\t    $request_url = $api.<span class=\"string\">&quot;?address=&quot;</span>.$address.<span class=\"string\">&quot;&amp;output=JSON&amp;key=&quot;</span>.$key;</span><br><span class=\"line\">\t\t    $response = file_get_contents($request_url);</span><br><span class=\"line\">\t\t    $obj = json_decode($response);</span><br><span class=\"line\">\t\t    <span class=\"keyword\">if</span>(strcmp($obj-&gt;status,<span class=\"string\">&quot;1&quot;</span>)==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t    \t$location_code = $obj-&gt;geocodes[<span class=\"string\">&quot;0&quot;</span>]-&gt;location;</span><br><span class=\"line\">\t\t    \t$address_url = <span class=\"string\">&quot;https://uri.amap.com/marker?position=&quot;</span>.$location_code.<span class=\"string\">&quot;&amp;name=&quot;</span>.$address;</span><br><span class=\"line\">\t\t    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t    \t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t    &#125;</span><br><span class=\"line\">\t\t    <span class=\"keyword\">return</span> $address_url;</span><br><span class=\"line\">\t\t  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>对比高德地图和百度地图。百度地图在编程方面更加方便，但是对于扫描二维码体验而言，百度地图必须使用浏览器扫描，或者微信扫描后根据提示打开浏览器，然后由浏览器调起百度地图进入导航。直接使用百度地图扫描二维码是无法调出导航的，而且百度地图扫描功能隐藏在搜索框之中，使用非常不方便。相对而言，用户使用高德地图api生成的二维码使用高德地图首页的扫一扫功能，可以直接进入导航界面。</p>\n<h2 id=\"2-2-url转二维码\"><a href=\"#2-2-url转二维码\" class=\"headerlink\" title=\"2.2 url转二维码\"></a>2.2 url转二维码</h2><p>在网上能找到许多提供url转二维码的api接口。</p>\n<p>在简书<a href=\"https://www.jianshu.com/p/064ab5c811cf\">https://www.jianshu.com/p/064ab5c811cf</a> 里，提供了许多接口。</p>\n<p>由于飞鹅打印机的技术文档中说明了，只需要在打印时在&lt;QR&gt;标签中输入url即可自动转换，所以，不在需要使用额外的接口。</p>\n<blockquote>\n<p>⭐但是需要注意的是，通过get来获取url二维码，必须先使用url_encode将url编码，否则二维码中将丢失url的参数信息。</p>\n</blockquote>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png","popularPost_tmp_gaData":{"updated":"Sat Aug 29 2020 18:05:27 GMT+0200 (GMT+02:00)","title":"在订单中打印收货地址二维码","path":"2020/08/28/在订单中打印收货地址二维码/","eyeCatchImage":"https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-08-28T15:14:28.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-08-28T15:14:28.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["电商"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"如何自己开发一个VPN App","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2019-12-12T20:34:16.000Z","password":null,"summary":"基于github上的一个开源vpn安卓客户端，修改其样式代码，来个性化自己的VPN。这个VPN基于openvpn库。","_content":"\n# 第一章 简介\n\n## 1.1 学习条件和要求\n\n学习条件：\n\n- 你不用一定学习过JAVA或其他编程语言。\n- 你不用一定了解或精通安卓编程。\n- 你不用一定懂得Linux编程。\n- 你需要自费支付服务器费用，国外服务器大概一个月30元，也可能有便宜的或更贵但性能更好的，你可自行选择，当然如果愿意用国内服务器练手，腾讯阿里的学生服务器一年只要120，当然这个服务器做出的VPN无法翻墙。\n- 你需要消耗一定的时间和耐心。\n\n如果你已经满足以上条件了，那么我希望你在浏览以下文章时，同意我的以下要求：\n\n- 你保证不使用本教程制作的VPN进行牟利。\n- 你保证不在中国大陆地区散播和分享制作的VPN。\n- 你保证不使用此VPN进行其他违法犯罪活动或在外网发表对国家不利的言论。\n\n> 若你已同意以上要求，请继续向下浏览，若你无法做到上述要求，请停止继续浏览。\n\n## 1.2 功能介绍\n\n软件的实现原理，我不做介绍，有兴趣的同学可自行学习。\n\n这里只教大家如何在我的软件基础上通过简单修改，制作一个自用VPN客户端。当然你也可以使用SS、SSR或V2ray等现成软件，并配置服务器后翻墙。\n\nVPN功能：\n\n- 可配置多条线路，以适用不同的服务器，或同一服务器上的不同用户。\n- 客户端主动更改主题颜色。\n- 推送更新通知，和推送广告。可在服务端更改是否推送广告。\n\n本软件没有账户登陆等限定条件。只要安装软件，即可翻墙，当然前提条件是，你配置好了服务器。\n\n下面展示我已经制作好的VPN程序截图，测试已能翻墙。\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn2.jpg\" style=\"zoom: 25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn3.jpg\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn4.jpg\" style=\"zoom:25%;\" />\n\n如此，我们便开始制作自己的VPN吧。\n\n# 第二章 服务端配置\n\n## 2.1 VPS服务器购买\n\n这里我推荐给大家的是[vultr.com](https://www.vultr.com/?ref=8345070)。为什么这家服务器呢？这家服务器可以按小时收费，如果你不嫌麻烦，可以在需要的使用VPN的时候，再开启一台VPS。不需要的时候关闭，当然重新开启需要重新配置服务器等操作。只是我觉得性价比挺高。最重要的是支持支付宝微信付款！\n\n下面教大家购买VPS服务器。主要是没看到中文翻译，所以决定一步步教大家，毕竟有的人可能并不会。\n\n1. 点击链接打开vultr网站，[www.vultr.com](https://www.vultr.com/?ref=8345070)额外说明一句，通过我的链接打开注册，我和你都可以获得10美元的奖励费用，当然这笔钱，需要你购买服务器之后才会发放。只是给大家说明这点，当然如果大家有其他选择也是可以的。\n\n2. 创建账户。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step1.jpg)\n\n   填写邮箱，按要求设置密码，密码要求至少一个大写字母，一个小写字母，一个数字，和至少十个字符。点击“create acounnt”即可。\n\n3. Vultr充值。\n\n   注册登录后会进入个人面板，左边栏选择 **“Billing”** ，选择支付方式和金额，付款即可。\n\n   Vultr 支持支付宝付款，很方便。但是个人更推荐有 Paypal 的使用 Paypal。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step2.jpg)\n\n4. 创建VPS\n\n   选择 **“Servers”** ，点击右边蓝色的 “**+**” 添加 VPS。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step3.jpg)\n\n   **a.选择节点**\n\n   日本距离最近，延迟最低，但太热门了，白天还好，晚上有时很慢；洛杉矶比日本稳些。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step4.jpg)\n\n   **b.选择系统**\n\n   选择系统。支持 Windows 和自己上传 ISO 系统镜像。这里请大家选择**CentOS系统7x64**\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step5.png)\n\n   **c.选择套餐**\n\n   价格从 $2.5/mo 到 $640/mo，各种配置都有，最低 $2.5/mo 的套餐现在基本买不到了。要求必须**有IPv4地址**。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step6.jpg)\n\n   **d.其他选项**\n\n   有 IPv6，私密，主机名、标签等，**无特殊需要全部默认即可。**\n\n   选好后点击右下角的 **“Deploy Now”** ，开始安装 VPS。\n\n   **e.查看VPS**\n\n   已购买的 VPS 都会显示在 “Servers” 面板中，当显示 “Running” 时即表示安装完成。点击 **“Manage”** 进入 VPS 管理面板。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step7.jpg)\n\n   VPS 管理面板，这里需要记录下 IP 地址（IP Address）、用户名（Username）、密码（Password）供稍后连接 VPS 时使用。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step8.jpg)\n\n5. 连接VPS\n\n   使用 ssh 工具连接我们的 VPS，Windows 推荐 xshell，Mac 可使用自带的终端。\n\n   Xshell 网盘链接：[https://pan.baidu.com/s/1pMbKLMb](https://link.zhihu.com/?target=https%3A//pan.baidu.com/s/1pMbKLMb) 密码：lwir\n\n   **Windows**\n\n   安装 xshell，打开软件。\n\n   点击 “文件” —> “新建” —> “连接”，输入 “名称” 和 “主机” （即VPS ip）。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step1.jpg)\n\n   点击 “用户身份验证”，输入用户名（默认root）和密码。确认。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step2.jpg)\n\n   连接 VPS，接受并保存密匙。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step3.jpg)\n\n   ![](http://qn.xieqifei.com/static/images/vps-step4.jpg)\n\n   出现 `root@vultr:~#` 即连接成功，可以输入代码了进行操作了。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step5.jpg)\n\n   > 很重要的一点，因为不是所有的VPS在国内都能ping通，有的IP地址已经被国内网络屏蔽了，所以如果VPS连接不上，请你到 [ping.chinaz.com]输入你的IP地址测试，若国内连接均提示超时且为红色，请你在vultr中删除vps并重新创建一个可用的ip地址。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step7.jpg)\n\n   **Mac**\n\n   打开终端，输入以下代码登录 VPS，其中 root 即用户名，将 ip 更改为 VPS 的 IP 地址，回车。\n\n   ```java\n   ssh root@ip\n   ```\n\n   输入 `yes` 确认，粘贴密码，回车。需要提醒的是，密码输入时并不会显示出来，直接复制粘贴，回车即可。出现 `root@vultr:~#` 即连接成功。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step6.jpg)\n\n   \n\n   **最近很忙，没时间更新了**\n\n项目地址：https://github.com/xieqifei/openvpn。然后有英语版本的readme。","source":"_posts/如何自己开发一个VPN程序.md","raw":"---\ntitle: 如何自己开发一个VPN App\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2019-12-12 21:34:16\npassword:\nsummary: 基于github上的一个开源vpn安卓客户端，修改其样式代码，来个性化自己的VPN。这个VPN基于openvpn库。\ntags: VPN\ncategories: 安卓编程\n---\n\n# 第一章 简介\n\n## 1.1 学习条件和要求\n\n学习条件：\n\n- 你不用一定学习过JAVA或其他编程语言。\n- 你不用一定了解或精通安卓编程。\n- 你不用一定懂得Linux编程。\n- 你需要自费支付服务器费用，国外服务器大概一个月30元，也可能有便宜的或更贵但性能更好的，你可自行选择，当然如果愿意用国内服务器练手，腾讯阿里的学生服务器一年只要120，当然这个服务器做出的VPN无法翻墙。\n- 你需要消耗一定的时间和耐心。\n\n如果你已经满足以上条件了，那么我希望你在浏览以下文章时，同意我的以下要求：\n\n- 你保证不使用本教程制作的VPN进行牟利。\n- 你保证不在中国大陆地区散播和分享制作的VPN。\n- 你保证不使用此VPN进行其他违法犯罪活动或在外网发表对国家不利的言论。\n\n> 若你已同意以上要求，请继续向下浏览，若你无法做到上述要求，请停止继续浏览。\n\n## 1.2 功能介绍\n\n软件的实现原理，我不做介绍，有兴趣的同学可自行学习。\n\n这里只教大家如何在我的软件基础上通过简单修改，制作一个自用VPN客户端。当然你也可以使用SS、SSR或V2ray等现成软件，并配置服务器后翻墙。\n\nVPN功能：\n\n- 可配置多条线路，以适用不同的服务器，或同一服务器上的不同用户。\n- 客户端主动更改主题颜色。\n- 推送更新通知，和推送广告。可在服务端更改是否推送广告。\n\n本软件没有账户登陆等限定条件。只要安装软件，即可翻墙，当然前提条件是，你配置好了服务器。\n\n下面展示我已经制作好的VPN程序截图，测试已能翻墙。\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn2.jpg\" style=\"zoom: 25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn3.jpg\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn4.jpg\" style=\"zoom:25%;\" />\n\n如此，我们便开始制作自己的VPN吧。\n\n# 第二章 服务端配置\n\n## 2.1 VPS服务器购买\n\n这里我推荐给大家的是[vultr.com](https://www.vultr.com/?ref=8345070)。为什么这家服务器呢？这家服务器可以按小时收费，如果你不嫌麻烦，可以在需要的使用VPN的时候，再开启一台VPS。不需要的时候关闭，当然重新开启需要重新配置服务器等操作。只是我觉得性价比挺高。最重要的是支持支付宝微信付款！\n\n下面教大家购买VPS服务器。主要是没看到中文翻译，所以决定一步步教大家，毕竟有的人可能并不会。\n\n1. 点击链接打开vultr网站，[www.vultr.com](https://www.vultr.com/?ref=8345070)额外说明一句，通过我的链接打开注册，我和你都可以获得10美元的奖励费用，当然这笔钱，需要你购买服务器之后才会发放。只是给大家说明这点，当然如果大家有其他选择也是可以的。\n\n2. 创建账户。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step1.jpg)\n\n   填写邮箱，按要求设置密码，密码要求至少一个大写字母，一个小写字母，一个数字，和至少十个字符。点击“create acounnt”即可。\n\n3. Vultr充值。\n\n   注册登录后会进入个人面板，左边栏选择 **“Billing”** ，选择支付方式和金额，付款即可。\n\n   Vultr 支持支付宝付款，很方便。但是个人更推荐有 Paypal 的使用 Paypal。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step2.jpg)\n\n4. 创建VPS\n\n   选择 **“Servers”** ，点击右边蓝色的 “**+**” 添加 VPS。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step3.jpg)\n\n   **a.选择节点**\n\n   日本距离最近，延迟最低，但太热门了，白天还好，晚上有时很慢；洛杉矶比日本稳些。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step4.jpg)\n\n   **b.选择系统**\n\n   选择系统。支持 Windows 和自己上传 ISO 系统镜像。这里请大家选择**CentOS系统7x64**\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step5.png)\n\n   **c.选择套餐**\n\n   价格从 $2.5/mo 到 $640/mo，各种配置都有，最低 $2.5/mo 的套餐现在基本买不到了。要求必须**有IPv4地址**。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step6.jpg)\n\n   **d.其他选项**\n\n   有 IPv6，私密，主机名、标签等，**无特殊需要全部默认即可。**\n\n   选好后点击右下角的 **“Deploy Now”** ，开始安装 VPS。\n\n   **e.查看VPS**\n\n   已购买的 VPS 都会显示在 “Servers” 面板中，当显示 “Running” 时即表示安装完成。点击 **“Manage”** 进入 VPS 管理面板。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step7.jpg)\n\n   VPS 管理面板，这里需要记录下 IP 地址（IP Address）、用户名（Username）、密码（Password）供稍后连接 VPS 时使用。\n\n   ![](http://qn.xieqifei.com/static/images/vultr-step8.jpg)\n\n5. 连接VPS\n\n   使用 ssh 工具连接我们的 VPS，Windows 推荐 xshell，Mac 可使用自带的终端。\n\n   Xshell 网盘链接：[https://pan.baidu.com/s/1pMbKLMb](https://link.zhihu.com/?target=https%3A//pan.baidu.com/s/1pMbKLMb) 密码：lwir\n\n   **Windows**\n\n   安装 xshell，打开软件。\n\n   点击 “文件” —> “新建” —> “连接”，输入 “名称” 和 “主机” （即VPS ip）。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step1.jpg)\n\n   点击 “用户身份验证”，输入用户名（默认root）和密码。确认。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step2.jpg)\n\n   连接 VPS，接受并保存密匙。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step3.jpg)\n\n   ![](http://qn.xieqifei.com/static/images/vps-step4.jpg)\n\n   出现 `root@vultr:~#` 即连接成功，可以输入代码了进行操作了。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step5.jpg)\n\n   > 很重要的一点，因为不是所有的VPS在国内都能ping通，有的IP地址已经被国内网络屏蔽了，所以如果VPS连接不上，请你到 [ping.chinaz.com]输入你的IP地址测试，若国内连接均提示超时且为红色，请你在vultr中删除vps并重新创建一个可用的ip地址。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step7.jpg)\n\n   **Mac**\n\n   打开终端，输入以下代码登录 VPS，其中 root 即用户名，将 ip 更改为 VPS 的 IP 地址，回车。\n\n   ```java\n   ssh root@ip\n   ```\n\n   输入 `yes` 确认，粘贴密码，回车。需要提醒的是，密码输入时并不会显示出来，直接复制粘贴，回车即可。出现 `root@vultr:~#` 即连接成功。\n\n   ![](http://qn.xieqifei.com/static/images/vps-step6.jpg)\n\n   \n\n   **最近很忙，没时间更新了**\n\n项目地址：https://github.com/xieqifei/openvpn。然后有英语版本的readme。","slug":"如何自己开发一个VPN程序","published":1,"updated":"2020-06-18T07:52:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacc002qp0vz8jyrcspx","content":"<h1 id=\"第一章-简介\"><a href=\"#第一章-简介\" class=\"headerlink\" title=\"第一章 简介\"></a>第一章 简介</h1><h2 id=\"1-1-学习条件和要求\"><a href=\"#1-1-学习条件和要求\" class=\"headerlink\" title=\"1.1 学习条件和要求\"></a>1.1 学习条件和要求</h2><p>学习条件：</p>\n<ul>\n<li>你不用一定学习过JAVA或其他编程语言。</li>\n<li>你不用一定了解或精通安卓编程。</li>\n<li>你不用一定懂得Linux编程。</li>\n<li>你需要自费支付服务器费用，国外服务器大概一个月30元，也可能有便宜的或更贵但性能更好的，你可自行选择，当然如果愿意用国内服务器练手，腾讯阿里的学生服务器一年只要120，当然这个服务器做出的VPN无法翻墙。</li>\n<li>你需要消耗一定的时间和耐心。</li>\n</ul>\n<p>如果你已经满足以上条件了，那么我希望你在浏览以下文章时，同意我的以下要求：</p>\n<ul>\n<li>你保证不使用本教程制作的VPN进行牟利。</li>\n<li>你保证不在中国大陆地区散播和分享制作的VPN。</li>\n<li>你保证不使用此VPN进行其他违法犯罪活动或在外网发表对国家不利的言论。</li>\n</ul>\n<blockquote>\n<p>若你已同意以上要求，请继续向下浏览，若你无法做到上述要求，请停止继续浏览。</p>\n</blockquote>\n<h2 id=\"1-2-功能介绍\"><a href=\"#1-2-功能介绍\" class=\"headerlink\" title=\"1.2 功能介绍\"></a>1.2 功能介绍</h2><p>软件的实现原理，我不做介绍，有兴趣的同学可自行学习。</p>\n<p>这里只教大家如何在我的软件基础上通过简单修改，制作一个自用VPN客户端。当然你也可以使用SS、SSR或V2ray等现成软件，并配置服务器后翻墙。</p>\n<p>VPN功能：</p>\n<ul>\n<li>可配置多条线路，以适用不同的服务器，或同一服务器上的不同用户。</li>\n<li>客户端主动更改主题颜色。</li>\n<li>推送更新通知，和推送广告。可在服务端更改是否推送广告。</li>\n</ul>\n<p>本软件没有账户登陆等限定条件。只要安装软件，即可翻墙，当然前提条件是，你配置好了服务器。</p>\n<p>下面展示我已经制作好的VPN程序截图，测试已能翻墙。</p>\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn2.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/ecaoovpn2.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" style=\"zoom: 25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn3.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/ecaoovpn3.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn4.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/ecaoovpn4.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" style=\"zoom:25%;\" />\n\n<p>如此，我们便开始制作自己的VPN吧。</p>\n<h1 id=\"第二章-服务端配置\"><a href=\"#第二章-服务端配置\" class=\"headerlink\" title=\"第二章 服务端配置\"></a>第二章 服务端配置</h1><h2 id=\"2-1-VPS服务器购买\"><a href=\"#2-1-VPS服务器购买\" class=\"headerlink\" title=\"2.1 VPS服务器购买\"></a>2.1 VPS服务器购买</h2><p>这里我推荐给大家的是<a href=\"https://www.vultr.com/?ref=8345070\">vultr.com</a>。为什么这家服务器呢？这家服务器可以按小时收费，如果你不嫌麻烦，可以在需要的使用VPN的时候，再开启一台VPS。不需要的时候关闭，当然重新开启需要重新配置服务器等操作。只是我觉得性价比挺高。最重要的是支持支付宝微信付款！</p>\n<p>下面教大家购买VPS服务器。主要是没看到中文翻译，所以决定一步步教大家，毕竟有的人可能并不会。</p>\n<ol>\n<li><p>点击链接打开vultr网站，<a href=\"https://www.vultr.com/?ref=8345070\">www.vultr.com</a>额外说明一句，通过我的链接打开注册，我和你都可以获得10美元的奖励费用，当然这笔钱，需要你购买服务器之后才会发放。只是给大家说明这点，当然如果大家有其他选择也是可以的。</p>\n</li>\n<li><p>创建账户。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step1.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step1.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>填写邮箱，按要求设置密码，密码要求至少一个大写字母，一个小写字母，一个数字，和至少十个字符。点击“create acounnt”即可。</p>\n</li>\n<li><p>Vultr充值。</p>\n<p>注册登录后会进入个人面板，左边栏选择 <strong>“Billing”</strong> ，选择支付方式和金额，付款即可。</p>\n<p>Vultr 支持支付宝付款，很方便。但是个人更推荐有 Paypal 的使用 Paypal。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step2.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step2.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n</li>\n<li><p>创建VPS</p>\n<p>选择 <strong>“Servers”</strong> ，点击右边蓝色的 “**+**” 添加 VPS。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step3.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step3.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>a.选择节点</strong></p>\n<p>日本距离最近，延迟最低，但太热门了，白天还好，晚上有时很慢；洛杉矶比日本稳些。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step4.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step4.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>b.选择系统</strong></p>\n<p>选择系统。支持 Windows 和自己上传 ISO 系统镜像。这里请大家选择<strong>CentOS系统7x64</strong></p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step5.png\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>c.选择套餐</strong></p>\n<p>价格从 $2.5/mo 到 $640/mo，各种配置都有，最低 $2.5/mo 的套餐现在基本买不到了。要求必须<strong>有IPv4地址</strong>。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step6.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step6.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>d.其他选项</strong></p>\n<p>有 IPv6，私密，主机名、标签等，<strong>无特殊需要全部默认即可。</strong></p>\n<p>选好后点击右下角的 <strong>“Deploy Now”</strong> ，开始安装 VPS。</p>\n<p><strong>e.查看VPS</strong></p>\n<p>已购买的 VPS 都会显示在 “Servers” 面板中，当显示 “Running” 时即表示安装完成。点击 <strong>“Manage”</strong> 进入 VPS 管理面板。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step7.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step7.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>VPS 管理面板，这里需要记录下 IP 地址（IP Address）、用户名（Username）、密码（Password）供稍后连接 VPS 时使用。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step8.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vultr-step8.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n</li>\n<li><p>连接VPS</p>\n<p>使用 ssh 工具连接我们的 VPS，Windows 推荐 xshell，Mac 可使用自带的终端。</p>\n<p>Xshell 网盘链接：<a href=\"https://link.zhihu.com/?target=https://pan.baidu.com/s/1pMbKLMb\">https://pan.baidu.com/s/1pMbKLMb</a> 密码：lwir</p>\n<p><strong>Windows</strong></p>\n<p>安装 xshell，打开软件。</p>\n<p>点击 “文件” —&gt; “新建” —&gt; “连接”，输入 “名称” 和 “主机” （即VPS ip）。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step1.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step1.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>点击 “用户身份验证”，输入用户名（默认root）和密码。确认。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step2.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step2.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>连接 VPS，接受并保存密匙。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step3.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step3.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step4.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step4.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>出现 <code>root@vultr:~#</code> 即连接成功，可以输入代码了进行操作了。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step5.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step5.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<blockquote>\n<p>很重要的一点，因为不是所有的VPS在国内都能ping通，有的IP地址已经被国内网络屏蔽了，所以如果VPS连接不上，请你到 [ping.chinaz.com]输入你的IP地址测试，若国内连接均提示超时且为红色，请你在vultr中删除vps并重新创建一个可用的ip地址。</p>\n</blockquote>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step7.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step7.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><strong>Mac</strong></p>\n<p>打开终端，输入以下代码登录 VPS，其中 root 即用户名，将 ip 更改为 VPS 的 IP 地址，回车。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh root<span class=\"meta\">@ip</span></span><br></pre></td></tr></table></figure>\n\n<p>输入 <code>yes</code> 确认，粘贴密码，回车。需要提醒的是，密码输入时并不会显示出来，直接复制粘贴，回车即可。出现 <code>root@vultr:~#</code> 即连接成功。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step6.jpg\" class=\"lazyload\" data-srcset=\"http://qn.xieqifei.com/static/images/vps-step6.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n</li>\n</ol>\n<p>   <strong>最近很忙，没时间更新了</strong></p>\n<p>项目地址：<a href=\"https://github.com/xieqifei/openvpn%E3%80%82%E7%84%B6%E5%90%8E%E6%9C%89%E8%8B%B1%E8%AF%AD%E7%89%88%E6%9C%AC%E7%9A%84readme%E3%80%82\">https://github.com/xieqifei/openvpn。然后有英语版本的readme。</a></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"第一章-简介\"><a href=\"#第一章-简介\" class=\"headerlink\" title=\"第一章 简介\"></a>第一章 简介</h1><h2 id=\"1-1-学习条件和要求\"><a href=\"#1-1-学习条件和要求\" class=\"headerlink\" title=\"1.1 学习条件和要求\"></a>1.1 学习条件和要求</h2><p>学习条件：</p>\n<ul>\n<li>你不用一定学习过JAVA或其他编程语言。</li>\n<li>你不用一定了解或精通安卓编程。</li>\n<li>你不用一定懂得Linux编程。</li>\n<li>你需要自费支付服务器费用，国外服务器大概一个月30元，也可能有便宜的或更贵但性能更好的，你可自行选择，当然如果愿意用国内服务器练手，腾讯阿里的学生服务器一年只要120，当然这个服务器做出的VPN无法翻墙。</li>\n<li>你需要消耗一定的时间和耐心。</li>\n</ul>\n<p>如果你已经满足以上条件了，那么我希望你在浏览以下文章时，同意我的以下要求：</p>\n<ul>\n<li>你保证不使用本教程制作的VPN进行牟利。</li>\n<li>你保证不在中国大陆地区散播和分享制作的VPN。</li>\n<li>你保证不使用此VPN进行其他违法犯罪活动或在外网发表对国家不利的言论。</li>\n</ul>\n<blockquote>\n<p>若你已同意以上要求，请继续向下浏览，若你无法做到上述要求，请停止继续浏览。</p>\n</blockquote>\n<h2 id=\"1-2-功能介绍\"><a href=\"#1-2-功能介绍\" class=\"headerlink\" title=\"1.2 功能介绍\"></a>1.2 功能介绍</h2><p>软件的实现原理，我不做介绍，有兴趣的同学可自行学习。</p>\n<p>这里只教大家如何在我的软件基础上通过简单修改，制作一个自用VPN客户端。当然你也可以使用SS、SSR或V2ray等现成软件，并配置服务器后翻墙。</p>\n<p>VPN功能：</p>\n<ul>\n<li>可配置多条线路，以适用不同的服务器，或同一服务器上的不同用户。</li>\n<li>客户端主动更改主题颜色。</li>\n<li>推送更新通知，和推送广告。可在服务端更改是否推送广告。</li>\n</ul>\n<p>本软件没有账户登陆等限定条件。只要安装软件，即可翻墙，当然前提条件是，你配置好了服务器。</p>\n<p>下面展示我已经制作好的VPN程序截图，测试已能翻墙。</p>\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn2.jpg\" style=\"zoom: 25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn3.jpg\" style=\"zoom:25%;\" />\n\n<img src=\"http://qn.xieqifei.com/static/images/ecaoovpn4.jpg\" style=\"zoom:25%;\" />\n\n<p>如此，我们便开始制作自己的VPN吧。</p>\n<h1 id=\"第二章-服务端配置\"><a href=\"#第二章-服务端配置\" class=\"headerlink\" title=\"第二章 服务端配置\"></a>第二章 服务端配置</h1><h2 id=\"2-1-VPS服务器购买\"><a href=\"#2-1-VPS服务器购买\" class=\"headerlink\" title=\"2.1 VPS服务器购买\"></a>2.1 VPS服务器购买</h2><p>这里我推荐给大家的是<a href=\"https://www.vultr.com/?ref=8345070\">vultr.com</a>。为什么这家服务器呢？这家服务器可以按小时收费，如果你不嫌麻烦，可以在需要的使用VPN的时候，再开启一台VPS。不需要的时候关闭，当然重新开启需要重新配置服务器等操作。只是我觉得性价比挺高。最重要的是支持支付宝微信付款！</p>\n<p>下面教大家购买VPS服务器。主要是没看到中文翻译，所以决定一步步教大家，毕竟有的人可能并不会。</p>\n<ol>\n<li><p>点击链接打开vultr网站，<a href=\"https://www.vultr.com/?ref=8345070\">www.vultr.com</a>额外说明一句，通过我的链接打开注册，我和你都可以获得10美元的奖励费用，当然这笔钱，需要你购买服务器之后才会发放。只是给大家说明这点，当然如果大家有其他选择也是可以的。</p>\n</li>\n<li><p>创建账户。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step1.jpg\"></p>\n<p>填写邮箱，按要求设置密码，密码要求至少一个大写字母，一个小写字母，一个数字，和至少十个字符。点击“create acounnt”即可。</p>\n</li>\n<li><p>Vultr充值。</p>\n<p>注册登录后会进入个人面板，左边栏选择 <strong>“Billing”</strong> ，选择支付方式和金额，付款即可。</p>\n<p>Vultr 支持支付宝付款，很方便。但是个人更推荐有 Paypal 的使用 Paypal。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step2.jpg\"></p>\n</li>\n<li><p>创建VPS</p>\n<p>选择 <strong>“Servers”</strong> ，点击右边蓝色的 “**+**” 添加 VPS。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step3.jpg\"></p>\n<p><strong>a.选择节点</strong></p>\n<p>日本距离最近，延迟最低，但太热门了，白天还好，晚上有时很慢；洛杉矶比日本稳些。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step4.jpg\"></p>\n<p><strong>b.选择系统</strong></p>\n<p>选择系统。支持 Windows 和自己上传 ISO 系统镜像。这里请大家选择<strong>CentOS系统7x64</strong></p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step5.png\"></p>\n<p><strong>c.选择套餐</strong></p>\n<p>价格从 $2.5/mo 到 $640/mo，各种配置都有，最低 $2.5/mo 的套餐现在基本买不到了。要求必须<strong>有IPv4地址</strong>。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step6.jpg\"></p>\n<p><strong>d.其他选项</strong></p>\n<p>有 IPv6，私密，主机名、标签等，<strong>无特殊需要全部默认即可。</strong></p>\n<p>选好后点击右下角的 <strong>“Deploy Now”</strong> ，开始安装 VPS。</p>\n<p><strong>e.查看VPS</strong></p>\n<p>已购买的 VPS 都会显示在 “Servers” 面板中，当显示 “Running” 时即表示安装完成。点击 <strong>“Manage”</strong> 进入 VPS 管理面板。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step7.jpg\"></p>\n<p>VPS 管理面板，这里需要记录下 IP 地址（IP Address）、用户名（Username）、密码（Password）供稍后连接 VPS 时使用。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vultr-step8.jpg\"></p>\n</li>\n<li><p>连接VPS</p>\n<p>使用 ssh 工具连接我们的 VPS，Windows 推荐 xshell，Mac 可使用自带的终端。</p>\n<p>Xshell 网盘链接：<a href=\"https://link.zhihu.com/?target=https://pan.baidu.com/s/1pMbKLMb\">https://pan.baidu.com/s/1pMbKLMb</a> 密码：lwir</p>\n<p><strong>Windows</strong></p>\n<p>安装 xshell，打开软件。</p>\n<p>点击 “文件” —&gt; “新建” —&gt; “连接”，输入 “名称” 和 “主机” （即VPS ip）。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step1.jpg\"></p>\n<p>点击 “用户身份验证”，输入用户名（默认root）和密码。确认。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step2.jpg\"></p>\n<p>连接 VPS，接受并保存密匙。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step3.jpg\"></p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step4.jpg\"></p>\n<p>出现 <code>root@vultr:~#</code> 即连接成功，可以输入代码了进行操作了。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step5.jpg\"></p>\n<blockquote>\n<p>很重要的一点，因为不是所有的VPS在国内都能ping通，有的IP地址已经被国内网络屏蔽了，所以如果VPS连接不上，请你到 [ping.chinaz.com]输入你的IP地址测试，若国内连接均提示超时且为红色，请你在vultr中删除vps并重新创建一个可用的ip地址。</p>\n</blockquote>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step7.jpg\"></p>\n<p><strong>Mac</strong></p>\n<p>打开终端，输入以下代码登录 VPS，其中 root 即用户名，将 ip 更改为 VPS 的 IP 地址，回车。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh root<span class=\"meta\">@ip</span></span><br></pre></td></tr></table></figure>\n\n<p>输入 <code>yes</code> 确认，粘贴密码，回车。需要提醒的是，密码输入时并不会显示出来，直接复制粘贴，回车即可。出现 <code>root@vultr:~#</code> 即连接成功。</p>\n<p><img src=\"http://qn.xieqifei.com/static/images/vps-step6.jpg\"></p>\n</li>\n</ol>\n<p>   <strong>最近很忙，没时间更新了</strong></p>\n<p>项目地址：<a href=\"https://github.com/xieqifei/openvpn%E3%80%82%E7%84%B6%E5%90%8E%E6%9C%89%E8%8B%B1%E8%AF%AD%E7%89%88%E6%9C%AC%E7%9A%84readme%E3%80%82\">https://github.com/xieqifei/openvpn。然后有英语版本的readme。</a></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg","popularPost_tmp_gaData":{"updated":"Thu Jun 18 2020 09:52:55 GMT+0200 (GMT+02:00)","title":"如何自己开发一个VPN App","path":"2019/12/12/如何自己开发一个VPN程序/","eyeCatchImage":"http://qn.xieqifei.com/static/images/ecaoovpn1.jpg","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2019-12-12T20:34:16.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2019-12-12T20:34:16.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"安卓编程","tags":["VPN"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"微信公众号开发","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-04-01T19:01:15.000Z","password":null,"summary":null,"_content":"\n# 1：微信公众号简介\n\n给个人、企业和组织提供服务和用户管理的全新服务平台。","source":"_posts/微信公众号开发.md","raw":"---\ntitle: 微信公众号开发\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-04-01 21:01:15\npassword:\nsummary:\ntags: 微信公众号\ncategories: 学习笔记\n---\n\n# 1：微信公众号简介\n\n给个人、企业和组织提供服务和用户管理的全新服务平台。","slug":"微信公众号开发","published":1,"updated":"2020-04-01T15:41:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsace002tp0vzhn7sad3w","content":"<h1 id=\"1：微信公众号简介\"><a href=\"#1：微信公众号简介\" class=\"headerlink\" title=\"1：微信公众号简介\"></a>1：微信公众号简介</h1><p>给个人、企业和组织提供服务和用户管理的全新服务平台。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：微信公众号简介\"><a href=\"#1：微信公众号简介\" class=\"headerlink\" title=\"1：微信公众号简介\"></a>1：微信公众号简介</h1><p>给个人、企业和组织提供服务和用户管理的全新服务平台。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Wed Apr 01 2020 17:41:53 GMT+0200 (GMT+02:00)","title":"微信公众号开发","path":"2020/04/01/微信公众号开发/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-04-01T19:01:15.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-01T19:01:15.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["微信公众号"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"微信小程序学习笔记","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-04-07T19:48:51.000Z","password":null,"summary":"微信小程序，就是html+css+js的集合，js方面，它借鉴了vuejs的许多特性。所以这里并没有对小程序做过多的学习。而是简单了解了它和html等的不同。","_content":"\n# 1：简介\n\n1. 用户扫一扫或搜索一下即可打开应用。\n2. 微信有海量用户，粘性高\n3. 开发适配成本低\n\n\n\n# 2：目录结构\n\n小程序**结构目录**\n\n- pages\n  - index\n  - logs\n\n- utils\n- app.js\n- app.json\n- project.config.json\n- sitemap.json  //某些页面是否能被微信检索\n\n开发者文档：https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html\n\n- 全局配置app.json\n\n```json\n{\n  \"pages\": [\n    \"pages/index/index\",//第一个页面\n    \"pages/logs/logs\"\n  ],\n  \"window\": {\n    \"backgroundTextStyle\": \"light\",//下拉刷新文字，需开通下拉刷新\n    \"navigationBarBackgroundColor\": \"#fff\",\n    \"navigationBarTitleText\": \"WeChat\",\n    \"navigationBarTextStyle\": \"black\"\n  },\n  \"tabBar\": {  //页面下面的菜单\n    \"list\": [{ //list至少需要两项\n      \"pagePath\": \"pagePath\",\n      \"text\": \"text\",\n      \"iconPath\": \"iconPath\",\n      \"selectedIconPath\": \"selectedIconPath\"\n    }]\n  },\n  \"style\": \"v2\",\n  \"sitemapLocation\": \"sitemap.json\"\n}\n```\n\n# 3:数据绑定\n\n```html\n<view> {{msg}}</view>\n```\n\n```javascript\nPage({\n    data:{\n        msg:\"hello world\"\n    }\n})\n```\n\n4：数组和对象循环\n\n```js\nPage({\n    data:{\n        list:{\n            id:0,\n            name:\"猪八戒\"\n        }\n    }\n})\n```\n\n```html\n<view>\n\t<view wx:for=\"{{list}}\" wx:for-item=\"item\" wx:for-index=\"index\" wx:key=\"id\">\n    索引：{{index}}--{{item.name}}\n    </view>\n</view>\n```\n\nwx:key可以提高循环检索效率。\n\n1. key必须是唯一的值\n2. wx:key =\"*this\" 表示数组是一个普通数组\n\n`wx:for-item=\"item\" wx:for-index=\"index\"`可以省略\n\n**对象循环**`wx:for=\"{{对象}}\" wx:for-item=\"对象的值（键值）\" wx:for-index=\"对象的属性（键名）\"`\n\n```js\nPerson{\n    name:\"起飞\",\n    age:22,\n    height:174\n}\n```\n\n5：block标签\n\n占位符的标签\n\n写代码的时候可以看到这个存在\n\n渲染时会移除掉\n\n将view换成block，可将标签去掉，最终**循环变量可在一行展示**\n\n6：条件渲染\n\n`wx:if=\"{{ture/false}}\"`\n\n`hidden`\n\n应用场景：\n\n- 当标签不是频繁切换显示，优先使用wx:if\n\n  直接把标签从页面结构中删除\n\n- 频繁切换用hidden\n\n  使用display:none属性。\n\n```html\n<view>\n\t<view>条件</view>\n    <view wx:if=\"{{true}}\">display</view>\n    \n    <view wx:if=\"{{true}}\">if</view>\n    <view wx:elis=\"{{false}}\">elif</view>\n    <view wx:else>else</view>\n    \n    <view hidden>hidden</view>\n    <view hidden=\"\"{{true}}\"\"></view>\n</view>\n```\n\n7：事件绑定\n\n```html\n<input type=\"text\" bindinput=\"handelInput\"/>\n<button bindtap=\"handletap\" data-opt=\"{{1}}\">\n    +\n</button>\n<button bindtap=\"handletap\" data-opt=\"{{-1}}\">\n    -\n</button>\n<view>{{num}}</view>\n```\n\n```js\nPages({\n    data:{\n        num:0;\n    },\n    handelInput(e){\n        this.setDate({num:e.detail.value})\n    },\n\thandletap(e){\n        e.currentTaget.opt\n    }\n})\n```\n\n8：样式\n\n在750x屏幕中\n\n750px=750rpx\n\n把屏幕改为375\n\n375px=750rpx\n\n1rpx=0.5px.\n\n- 样式导入\n\nutils下新建文件夹`styles`，文件夹里新建common.wxss\n\n引用：`@import \"../../styles/common.wxss\"`\n\n- 选择器\n\n小程序不支持通配符\n\n9：常见组件\n\n- view\n- text\n  - 文本标签\n  - 只有此标签可长按复制\n  - 解码decode\n\n```html\n<text selectable>长按复制 &nbsp(这是空格)</text>\n```\n\n- 图片\n  - 本地图片不能超过2M，所以都使用外链图片\n  - src：来源\n  - mode：图片裁剪缩放格式//scaleToFill\n  - lazy-load：懒加载，当图片在上下三屏范围类，图片会预加载\n\n- swiper\n  - 轮播图\n  - autoplay:自动播放\n  - circular：轮播\n  - interva：间隔时间。单位ms\n  - indicator-dots：显示分页指示器\n\n```html\n<swiper autoplay>\n\t<swiper-item><image src=\"\"></image></swiper-item>\n    <swiper-item><image src=\"\"></image></swiper-item>\n    <swiper-item><image src=\"\"></image></swiper-item>\n</swiper>\n```\n\n- navigator\n  - 导航栏\n  - 块级元素\n  - url：跳转某个页面\n  - target：跳转到其他小程序\n  - open-type：navigate，保留当前页面，不能跳转tabbar里的页面，默认值；redirect，不保留当前页面；switchTab：跳转tabbar，关闭其他页面；reLauch：关闭所有页面，打开应用某个页面\n\n```html\n<navigator url=\"\"></navigator>\n```\n\n- rich-text\n  - 富文本标签\n\n```html\n<rich-text nodes=\"{{html}}\"></rich-text>\n```\n\n```js\nPage({\n    data:{\n        html:[\n            name:\"div\",\n            attr:{\n            class:\"my_div\",\n            style:\"color:red\"\n            },\n    children:[{\n        name:\"p\",\n        attr:{},\n        children:[{\n            type:\"text\",\n            text:\"hellp\"\n        }]\n    }]\n        ]\n    }\n})\n```\n\n- button\n  - 按钮\n  - open-type:contact：打开客服，在小程序官网，功能-客服。添加；share：分享小程序，不能分享朋友圈；getPhonNumber：获取用户手机号码，需要结合事件使用，只有企业小程序有权限使用，绑定事件bindgetphonenumber，获取回调函数；getUserInof：获取用户信息，需绑定事件，处理函数；openSetting：用户查看更改小程序能获得的权限\n\n- icon\n  - 图标\n  - type：图标类型，sucess、warning等参数\n  - size：大小\n  - color：颜色\n\n- radio\n  - 单选框\n  - 必须和父元素radio-group一起使用\n  - value选中的单选框值\n\n```html\n<radio-group bindchange=\"handelchange\">\n\t<radio value=\"male\">男</radio>\n    <radio value=\"female\">女</radio>\n</radio-group>\n<view>你选中的值是：{{gender}}</view>\n```\n\n```html\nPage({\n\tdata:{\n\t\tgender:\"\"\n\t},\n\thandleChange(e){\n\t\tlet gender=e.detail.value;\n\t\tthis.setData({gender})\n\t}\n\t\n})\n```\n\n- checkbox\n  - 复选框\n  - 需和checkbox-group一起使用\n\n10：自定义组件\n\nslot标签，占位标签，内容传递过来时，替代\n\n自定义组件中：\n\n```html\n<tabs>\n\t<slot>\n    \n    </slot>\n</tabs>\n```\n\n父组件中：\n\n```html\n<tabs>\n  你好啊\n</tabs>\n```\n\n","source":"_posts/微信小程序学习笔记.md","raw":"---\ntitle: 微信小程序学习笔记\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-04-07 21:48:51\npassword: \nsummary: 微信小程序，就是html+css+js的集合，js方面，它借鉴了vuejs的许多特性。所以这里并没有对小程序做过多的学习。而是简单了解了它和html等的不同。\ntags: 微信小程序\ncategories: 学习笔记\n---\n\n# 1：简介\n\n1. 用户扫一扫或搜索一下即可打开应用。\n2. 微信有海量用户，粘性高\n3. 开发适配成本低\n\n\n\n# 2：目录结构\n\n小程序**结构目录**\n\n- pages\n  - index\n  - logs\n\n- utils\n- app.js\n- app.json\n- project.config.json\n- sitemap.json  //某些页面是否能被微信检索\n\n开发者文档：https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html\n\n- 全局配置app.json\n\n```json\n{\n  \"pages\": [\n    \"pages/index/index\",//第一个页面\n    \"pages/logs/logs\"\n  ],\n  \"window\": {\n    \"backgroundTextStyle\": \"light\",//下拉刷新文字，需开通下拉刷新\n    \"navigationBarBackgroundColor\": \"#fff\",\n    \"navigationBarTitleText\": \"WeChat\",\n    \"navigationBarTextStyle\": \"black\"\n  },\n  \"tabBar\": {  //页面下面的菜单\n    \"list\": [{ //list至少需要两项\n      \"pagePath\": \"pagePath\",\n      \"text\": \"text\",\n      \"iconPath\": \"iconPath\",\n      \"selectedIconPath\": \"selectedIconPath\"\n    }]\n  },\n  \"style\": \"v2\",\n  \"sitemapLocation\": \"sitemap.json\"\n}\n```\n\n# 3:数据绑定\n\n```html\n<view> {{msg}}</view>\n```\n\n```javascript\nPage({\n    data:{\n        msg:\"hello world\"\n    }\n})\n```\n\n4：数组和对象循环\n\n```js\nPage({\n    data:{\n        list:{\n            id:0,\n            name:\"猪八戒\"\n        }\n    }\n})\n```\n\n```html\n<view>\n\t<view wx:for=\"{{list}}\" wx:for-item=\"item\" wx:for-index=\"index\" wx:key=\"id\">\n    索引：{{index}}--{{item.name}}\n    </view>\n</view>\n```\n\nwx:key可以提高循环检索效率。\n\n1. key必须是唯一的值\n2. wx:key =\"*this\" 表示数组是一个普通数组\n\n`wx:for-item=\"item\" wx:for-index=\"index\"`可以省略\n\n**对象循环**`wx:for=\"{{对象}}\" wx:for-item=\"对象的值（键值）\" wx:for-index=\"对象的属性（键名）\"`\n\n```js\nPerson{\n    name:\"起飞\",\n    age:22,\n    height:174\n}\n```\n\n5：block标签\n\n占位符的标签\n\n写代码的时候可以看到这个存在\n\n渲染时会移除掉\n\n将view换成block，可将标签去掉，最终**循环变量可在一行展示**\n\n6：条件渲染\n\n`wx:if=\"{{ture/false}}\"`\n\n`hidden`\n\n应用场景：\n\n- 当标签不是频繁切换显示，优先使用wx:if\n\n  直接把标签从页面结构中删除\n\n- 频繁切换用hidden\n\n  使用display:none属性。\n\n```html\n<view>\n\t<view>条件</view>\n    <view wx:if=\"{{true}}\">display</view>\n    \n    <view wx:if=\"{{true}}\">if</view>\n    <view wx:elis=\"{{false}}\">elif</view>\n    <view wx:else>else</view>\n    \n    <view hidden>hidden</view>\n    <view hidden=\"\"{{true}}\"\"></view>\n</view>\n```\n\n7：事件绑定\n\n```html\n<input type=\"text\" bindinput=\"handelInput\"/>\n<button bindtap=\"handletap\" data-opt=\"{{1}}\">\n    +\n</button>\n<button bindtap=\"handletap\" data-opt=\"{{-1}}\">\n    -\n</button>\n<view>{{num}}</view>\n```\n\n```js\nPages({\n    data:{\n        num:0;\n    },\n    handelInput(e){\n        this.setDate({num:e.detail.value})\n    },\n\thandletap(e){\n        e.currentTaget.opt\n    }\n})\n```\n\n8：样式\n\n在750x屏幕中\n\n750px=750rpx\n\n把屏幕改为375\n\n375px=750rpx\n\n1rpx=0.5px.\n\n- 样式导入\n\nutils下新建文件夹`styles`，文件夹里新建common.wxss\n\n引用：`@import \"../../styles/common.wxss\"`\n\n- 选择器\n\n小程序不支持通配符\n\n9：常见组件\n\n- view\n- text\n  - 文本标签\n  - 只有此标签可长按复制\n  - 解码decode\n\n```html\n<text selectable>长按复制 &nbsp(这是空格)</text>\n```\n\n- 图片\n  - 本地图片不能超过2M，所以都使用外链图片\n  - src：来源\n  - mode：图片裁剪缩放格式//scaleToFill\n  - lazy-load：懒加载，当图片在上下三屏范围类，图片会预加载\n\n- swiper\n  - 轮播图\n  - autoplay:自动播放\n  - circular：轮播\n  - interva：间隔时间。单位ms\n  - indicator-dots：显示分页指示器\n\n```html\n<swiper autoplay>\n\t<swiper-item><image src=\"\"></image></swiper-item>\n    <swiper-item><image src=\"\"></image></swiper-item>\n    <swiper-item><image src=\"\"></image></swiper-item>\n</swiper>\n```\n\n- navigator\n  - 导航栏\n  - 块级元素\n  - url：跳转某个页面\n  - target：跳转到其他小程序\n  - open-type：navigate，保留当前页面，不能跳转tabbar里的页面，默认值；redirect，不保留当前页面；switchTab：跳转tabbar，关闭其他页面；reLauch：关闭所有页面，打开应用某个页面\n\n```html\n<navigator url=\"\"></navigator>\n```\n\n- rich-text\n  - 富文本标签\n\n```html\n<rich-text nodes=\"{{html}}\"></rich-text>\n```\n\n```js\nPage({\n    data:{\n        html:[\n            name:\"div\",\n            attr:{\n            class:\"my_div\",\n            style:\"color:red\"\n            },\n    children:[{\n        name:\"p\",\n        attr:{},\n        children:[{\n            type:\"text\",\n            text:\"hellp\"\n        }]\n    }]\n        ]\n    }\n})\n```\n\n- button\n  - 按钮\n  - open-type:contact：打开客服，在小程序官网，功能-客服。添加；share：分享小程序，不能分享朋友圈；getPhonNumber：获取用户手机号码，需要结合事件使用，只有企业小程序有权限使用，绑定事件bindgetphonenumber，获取回调函数；getUserInof：获取用户信息，需绑定事件，处理函数；openSetting：用户查看更改小程序能获得的权限\n\n- icon\n  - 图标\n  - type：图标类型，sucess、warning等参数\n  - size：大小\n  - color：颜色\n\n- radio\n  - 单选框\n  - 必须和父元素radio-group一起使用\n  - value选中的单选框值\n\n```html\n<radio-group bindchange=\"handelchange\">\n\t<radio value=\"male\">男</radio>\n    <radio value=\"female\">女</radio>\n</radio-group>\n<view>你选中的值是：{{gender}}</view>\n```\n\n```html\nPage({\n\tdata:{\n\t\tgender:\"\"\n\t},\n\thandleChange(e){\n\t\tlet gender=e.detail.value;\n\t\tthis.setData({gender})\n\t}\n\t\n})\n```\n\n- checkbox\n  - 复选框\n  - 需和checkbox-group一起使用\n\n10：自定义组件\n\nslot标签，占位标签，内容传递过来时，替代\n\n自定义组件中：\n\n```html\n<tabs>\n\t<slot>\n    \n    </slot>\n</tabs>\n```\n\n父组件中：\n\n```html\n<tabs>\n  你好啊\n</tabs>\n```\n\n","slug":"微信小程序学习笔记","published":1,"updated":"2020-06-20T06:47:48.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacg002wp0vz05gx1piy","content":"<h1 id=\"1：简介\"><a href=\"#1：简介\" class=\"headerlink\" title=\"1：简介\"></a>1：简介</h1><ol>\n<li>用户扫一扫或搜索一下即可打开应用。</li>\n<li>微信有海量用户，粘性高</li>\n<li>开发适配成本低</li>\n</ol>\n<h1 id=\"2：目录结构\"><a href=\"#2：目录结构\" class=\"headerlink\" title=\"2：目录结构\"></a>2：目录结构</h1><p>小程序<strong>结构目录</strong></p>\n<ul>\n<li><p>pages</p>\n<ul>\n<li>index</li>\n<li>logs</li>\n</ul>\n</li>\n<li><p>utils</p>\n</li>\n<li><p>app.js</p>\n</li>\n<li><p>app.json</p>\n</li>\n<li><p>project.config.json</p>\n</li>\n<li><p>sitemap.json  //某些页面是否能被微信检索</p>\n</li>\n</ul>\n<p>开发者文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html\">https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html</a></p>\n<ul>\n<li>全局配置app.json</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;pages&quot;</span>: [</span><br><span class=\"line\">    <span class=\"string\">&quot;pages/index/index&quot;</span>,<span class=\"comment\">//第一个页面</span></span><br><span class=\"line\">    <span class=\"string\">&quot;pages/logs/logs&quot;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">&quot;window&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;backgroundTextStyle&quot;</span>: <span class=\"string\">&quot;light&quot;</span>,<span class=\"comment\">//下拉刷新文字，需开通下拉刷新</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;navigationBarBackgroundColor&quot;</span>: <span class=\"string\">&quot;#fff&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;navigationBarTitleText&quot;</span>: <span class=\"string\">&quot;WeChat&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;navigationBarTextStyle&quot;</span>: <span class=\"string\">&quot;black&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">&quot;tabBar&quot;</span>: &#123;  <span class=\"comment\">//页面下面的菜单</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;list&quot;</span>: [&#123; <span class=\"comment\">//list至少需要两项</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;pagePath&quot;</span>: <span class=\"string\">&quot;pagePath&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">&quot;text&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">&quot;iconPath&quot;</span>: <span class=\"string\">&quot;iconPath&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">&quot;selectedIconPath&quot;</span>: <span class=\"string\">&quot;selectedIconPath&quot;</span></span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">&quot;style&quot;</span>: <span class=\"string\">&quot;v2&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;sitemapLocation&quot;</span>: <span class=\"string\">&quot;sitemap.json&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3-数据绑定\"><a href=\"#3-数据绑定\" class=\"headerlink\" title=\"3:数据绑定\"></a>3:数据绑定</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span> &#123;&#123;msg&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        msg:<span class=\"string\">&quot;hello world&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>4：数组和对象循环</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        list:&#123;</span><br><span class=\"line\">            id:<span class=\"number\">0</span>,</span><br><span class=\"line\">            name:<span class=\"string\">&quot;猪八戒&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">&quot;&#123;&#123;list&#125;&#125;&quot;</span> <span class=\"attr\">wx:for-item</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">wx:for-index</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">&quot;id&quot;</span>&gt;</span></span><br><span class=\"line\">    索引：&#123;&#123;index&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>wx:key可以提高循环检索效率。</p>\n<ol>\n<li>key必须是唯一的值</li>\n<li>wx:key =”*this” 表示数组是一个普通数组</li>\n</ol>\n<p><code>wx:for-item=&quot;item&quot; wx:for-index=&quot;index&quot;</code>可以省略</p>\n<p><strong>对象循环</strong><code>wx:for=&quot;&#123;&#123;对象&#125;&#125;&quot; wx:for-item=&quot;对象的值（键值）&quot; wx:for-index=&quot;对象的属性（键名）&quot;</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Person&#123;</span><br><span class=\"line\">    name:<span class=\"string\">&quot;起飞&quot;</span>,</span><br><span class=\"line\">    age:<span class=\"number\">22</span>,</span><br><span class=\"line\">    height:<span class=\"number\">174</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>5：block标签</p>\n<p>占位符的标签</p>\n<p>写代码的时候可以看到这个存在</p>\n<p>渲染时会移除掉</p>\n<p>将view换成block，可将标签去掉，最终<strong>循环变量可在一行展示</strong></p>\n<p>6：条件渲染</p>\n<p><code>wx:if=&quot;&#123;&#123;ture/false&#125;&#125;&quot;</code></p>\n<p><code>hidden</code></p>\n<p>应用场景：</p>\n<ul>\n<li><p>当标签不是频繁切换显示，优先使用wx:if</p>\n<p>直接把标签从页面结构中删除</p>\n</li>\n<li><p>频繁切换用hidden</p>\n<p>使用display:none属性。</p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span>条件<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>display<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>if<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:elis</span>=<span class=\"string\">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span>elif<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:else</span>&gt;</span>else<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">hidden</span>&gt;</span>hidden<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">hidden</span>=<span class=\"string\">&quot;&quot;</span>&#123;&#123;<span class=\"attr\">true</span>&#125;&#125;&quot;&quot;&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>7：事件绑定</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">bindinput</span>=<span class=\"string\">&quot;handelInput&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;handletap&quot;</span> <span class=\"attr\">data-opt</span>=<span class=\"string\">&quot;&#123;&#123;1&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    +</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;handletap&quot;</span> <span class=\"attr\">data-opt</span>=<span class=\"string\">&quot;&#123;&#123;-1&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    -</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span>&#123;&#123;num&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pages(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        num:<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    handelInput(e)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setDate(&#123;<span class=\"attr\">num</span>:e.detail.value&#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">\thandletap(e)&#123;</span><br><span class=\"line\">        e.currentTaget.opt</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>8：样式</p>\n<p>在750x屏幕中</p>\n<p>750px=750rpx</p>\n<p>把屏幕改为375</p>\n<p>375px=750rpx</p>\n<p>1rpx=0.5px.</p>\n<ul>\n<li>样式导入</li>\n</ul>\n<p>utils下新建文件夹<code>styles</code>，文件夹里新建common.wxss</p>\n<p>引用：<code>@import &quot;../../styles/common.wxss&quot;</code></p>\n<ul>\n<li>选择器</li>\n</ul>\n<p>小程序不支持通配符</p>\n<p>9：常见组件</p>\n<ul>\n<li>view</li>\n<li>text<ul>\n<li>文本标签</li>\n<li>只有此标签可长按复制</li>\n<li>解码decode</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">selectable</span>&gt;</span>长按复制 &amp;nbsp(这是空格)<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>图片</p>\n<ul>\n<li>本地图片不能超过2M，所以都使用外链图片</li>\n<li>src：来源</li>\n<li>mode：图片裁剪缩放格式//scaleToFill</li>\n<li>lazy-load：懒加载，当图片在上下三屏范围类，图片会预加载</li>\n</ul>\n</li>\n<li><p>swiper</p>\n<ul>\n<li>轮播图</li>\n<li>autoplay:自动播放</li>\n<li>circular：轮播</li>\n<li>interva：间隔时间。单位ms</li>\n<li>indicator-dots：显示分页指示器</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">swiper</span> <span class=\"attr\">autoplay</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">swiper-item</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">swiper-item</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">swiper-item</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">swiper-item</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">swiper-item</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">swiper-item</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">swiper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>navigator<ul>\n<li>导航栏</li>\n<li>块级元素</li>\n<li>url：跳转某个页面</li>\n<li>target：跳转到其他小程序</li>\n<li>open-type：navigate，保留当前页面，不能跳转tabbar里的页面，默认值；redirect，不保留当前页面；switchTab：跳转tabbar，关闭其他页面；reLauch：关闭所有页面，打开应用某个页面</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">navigator</span> <span class=\"attr\">url</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>rich-text<ul>\n<li>富文本标签</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">rich-text</span> <span class=\"attr\">nodes</span>=<span class=\"string\">&quot;&#123;&#123;html&#125;&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rich-text</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        html:[</span><br><span class=\"line\">            name:<span class=\"string\">&quot;div&quot;</span>,</span><br><span class=\"line\">            attr:&#123;</span><br><span class=\"line\">            class:&quot;my_div&quot;,</span><br><span class=\"line\">            style:<span class=\"string\">&quot;color:red&quot;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">    children:[&#123;</span><br><span class=\"line\">        name:<span class=\"string\">&quot;p&quot;</span>,</span><br><span class=\"line\">        attr:&#123;&#125;,</span><br><span class=\"line\">        children:[&#123;</span><br><span class=\"line\">            type:<span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">            text:<span class=\"string\">&quot;hellp&quot;</span></span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>button</p>\n<ul>\n<li>按钮</li>\n<li>open-type:contact：打开客服，在小程序官网，功能-客服。添加；share：分享小程序，不能分享朋友圈；getPhonNumber：获取用户手机号码，需要结合事件使用，只有企业小程序有权限使用，绑定事件bindgetphonenumber，获取回调函数；getUserInof：获取用户信息，需绑定事件，处理函数；openSetting：用户查看更改小程序能获得的权限</li>\n</ul>\n</li>\n<li><p>icon</p>\n<ul>\n<li>图标</li>\n<li>type：图标类型，sucess、warning等参数</li>\n<li>size：大小</li>\n<li>color：颜色</li>\n</ul>\n</li>\n<li><p>radio</p>\n<ul>\n<li>单选框</li>\n<li>必须和父元素radio-group一起使用</li>\n<li>value选中的单选框值</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">radio-group</span> <span class=\"attr\">bindchange</span>=<span class=\"string\">&quot;handelchange&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">radio</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;male&quot;</span>&gt;</span>男<span class=\"tag\">&lt;/<span class=\"name\">radio</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">radio</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;female&quot;</span>&gt;</span>女<span class=\"tag\">&lt;/<span class=\"name\">radio</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">radio-group</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span>你选中的值是：&#123;&#123;gender&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">\tdata:&#123;</span><br><span class=\"line\">\t\tgender:&quot;&quot;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\thandleChange(e)&#123;</span><br><span class=\"line\">\t\tlet gender=e.detail.value;</span><br><span class=\"line\">\t\tthis.setData(&#123;gender&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>checkbox<ul>\n<li>复选框</li>\n<li>需和checkbox-group一起使用</li>\n</ul>\n</li>\n</ul>\n<p>10：自定义组件</p>\n<p>slot标签，占位标签，内容传递过来时，替代</p>\n<p>自定义组件中：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tabs</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tabs</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>父组件中：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tabs</span>&gt;</span></span><br><span class=\"line\">  你好啊</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tabs</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：简介\"><a href=\"#1：简介\" class=\"headerlink\" title=\"1：简介\"></a>1：简介</h1><ol>\n<li>用户扫一扫或搜索一下即可打开应用。</li>\n<li>微信有海量用户，粘性高</li>\n<li>开发适配成本低</li>\n</ol>\n<h1 id=\"2：目录结构\"><a href=\"#2：目录结构\" class=\"headerlink\" title=\"2：目录结构\"></a>2：目录结构</h1><p>小程序<strong>结构目录</strong></p>\n<ul>\n<li><p>pages</p>\n<ul>\n<li>index</li>\n<li>logs</li>\n</ul>\n</li>\n<li><p>utils</p>\n</li>\n<li><p>app.js</p>\n</li>\n<li><p>app.json</p>\n</li>\n<li><p>project.config.json</p>\n</li>\n<li><p>sitemap.json  //某些页面是否能被微信检索</p>\n</li>\n</ul>\n<p>开发者文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html\">https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html</a></p>\n<ul>\n<li>全局配置app.json</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;pages&quot;</span>: [</span><br><span class=\"line\">    <span class=\"string\">&quot;pages/index/index&quot;</span>,<span class=\"comment\">//第一个页面</span></span><br><span class=\"line\">    <span class=\"string\">&quot;pages/logs/logs&quot;</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">&quot;window&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;backgroundTextStyle&quot;</span>: <span class=\"string\">&quot;light&quot;</span>,<span class=\"comment\">//下拉刷新文字，需开通下拉刷新</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;navigationBarBackgroundColor&quot;</span>: <span class=\"string\">&quot;#fff&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;navigationBarTitleText&quot;</span>: <span class=\"string\">&quot;WeChat&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;navigationBarTextStyle&quot;</span>: <span class=\"string\">&quot;black&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">&quot;tabBar&quot;</span>: &#123;  <span class=\"comment\">//页面下面的菜单</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;list&quot;</span>: [&#123; <span class=\"comment\">//list至少需要两项</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;pagePath&quot;</span>: <span class=\"string\">&quot;pagePath&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">&quot;text&quot;</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">&quot;iconPath&quot;</span>: <span class=\"string\">&quot;iconPath&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">&quot;selectedIconPath&quot;</span>: <span class=\"string\">&quot;selectedIconPath&quot;</span></span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">&quot;style&quot;</span>: <span class=\"string\">&quot;v2&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;sitemapLocation&quot;</span>: <span class=\"string\">&quot;sitemap.json&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3-数据绑定\"><a href=\"#3-数据绑定\" class=\"headerlink\" title=\"3:数据绑定\"></a>3:数据绑定</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span> &#123;&#123;msg&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        msg:<span class=\"string\">&quot;hello world&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>4：数组和对象循环</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        list:&#123;</span><br><span class=\"line\">            id:<span class=\"number\">0</span>,</span><br><span class=\"line\">            name:<span class=\"string\">&quot;猪八戒&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:for</span>=<span class=\"string\">&quot;&#123;&#123;list&#125;&#125;&quot;</span> <span class=\"attr\">wx:for-item</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">wx:for-index</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">wx:key</span>=<span class=\"string\">&quot;id&quot;</span>&gt;</span></span><br><span class=\"line\">    索引：&#123;&#123;index&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>wx:key可以提高循环检索效率。</p>\n<ol>\n<li>key必须是唯一的值</li>\n<li>wx:key =”*this” 表示数组是一个普通数组</li>\n</ol>\n<p><code>wx:for-item=&quot;item&quot; wx:for-index=&quot;index&quot;</code>可以省略</p>\n<p><strong>对象循环</strong><code>wx:for=&quot;&#123;&#123;对象&#125;&#125;&quot; wx:for-item=&quot;对象的值（键值）&quot; wx:for-index=&quot;对象的属性（键名）&quot;</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Person&#123;</span><br><span class=\"line\">    name:<span class=\"string\">&quot;起飞&quot;</span>,</span><br><span class=\"line\">    age:<span class=\"number\">22</span>,</span><br><span class=\"line\">    height:<span class=\"number\">174</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>5：block标签</p>\n<p>占位符的标签</p>\n<p>写代码的时候可以看到这个存在</p>\n<p>渲染时会移除掉</p>\n<p>将view换成block，可将标签去掉，最终<strong>循环变量可在一行展示</strong></p>\n<p>6：条件渲染</p>\n<p><code>wx:if=&quot;&#123;&#123;ture/false&#125;&#125;&quot;</code></p>\n<p><code>hidden</code></p>\n<p>应用场景：</p>\n<ul>\n<li><p>当标签不是频繁切换显示，优先使用wx:if</p>\n<p>直接把标签从页面结构中删除</p>\n</li>\n<li><p>频繁切换用hidden</p>\n<p>使用display:none属性。</p>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span>条件<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>display<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>if<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:elis</span>=<span class=\"string\">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span>elif<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:else</span>&gt;</span>else<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">hidden</span>&gt;</span>hidden<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">hidden</span>=<span class=\"string\">&quot;&quot;</span>&#123;&#123;<span class=\"attr\">true</span>&#125;&#125;&quot;&quot;&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>7：事件绑定</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">bindinput</span>=<span class=\"string\">&quot;handelInput&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;handletap&quot;</span> <span class=\"attr\">data-opt</span>=<span class=\"string\">&quot;&#123;&#123;1&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    +</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;handletap&quot;</span> <span class=\"attr\">data-opt</span>=<span class=\"string\">&quot;&#123;&#123;-1&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">    -</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span>&#123;&#123;num&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Pages(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        num:<span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    handelInput(e)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.setDate(&#123;<span class=\"attr\">num</span>:e.detail.value&#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">\thandletap(e)&#123;</span><br><span class=\"line\">        e.currentTaget.opt</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>8：样式</p>\n<p>在750x屏幕中</p>\n<p>750px=750rpx</p>\n<p>把屏幕改为375</p>\n<p>375px=750rpx</p>\n<p>1rpx=0.5px.</p>\n<ul>\n<li>样式导入</li>\n</ul>\n<p>utils下新建文件夹<code>styles</code>，文件夹里新建common.wxss</p>\n<p>引用：<code>@import &quot;../../styles/common.wxss&quot;</code></p>\n<ul>\n<li>选择器</li>\n</ul>\n<p>小程序不支持通配符</p>\n<p>9：常见组件</p>\n<ul>\n<li>view</li>\n<li>text<ul>\n<li>文本标签</li>\n<li>只有此标签可长按复制</li>\n<li>解码decode</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">selectable</span>&gt;</span>长按复制 &amp;nbsp(这是空格)<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>图片</p>\n<ul>\n<li>本地图片不能超过2M，所以都使用外链图片</li>\n<li>src：来源</li>\n<li>mode：图片裁剪缩放格式//scaleToFill</li>\n<li>lazy-load：懒加载，当图片在上下三屏范围类，图片会预加载</li>\n</ul>\n</li>\n<li><p>swiper</p>\n<ul>\n<li>轮播图</li>\n<li>autoplay:自动播放</li>\n<li>circular：轮播</li>\n<li>interva：间隔时间。单位ms</li>\n<li>indicator-dots：显示分页指示器</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">swiper</span> <span class=\"attr\">autoplay</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">swiper-item</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">swiper-item</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">swiper-item</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">swiper-item</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">swiper-item</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">swiper-item</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">swiper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>navigator<ul>\n<li>导航栏</li>\n<li>块级元素</li>\n<li>url：跳转某个页面</li>\n<li>target：跳转到其他小程序</li>\n<li>open-type：navigate，保留当前页面，不能跳转tabbar里的页面，默认值；redirect，不保留当前页面；switchTab：跳转tabbar，关闭其他页面；reLauch：关闭所有页面，打开应用某个页面</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">navigator</span> <span class=\"attr\">url</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>rich-text<ul>\n<li>富文本标签</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">rich-text</span> <span class=\"attr\">nodes</span>=<span class=\"string\">&quot;&#123;&#123;html&#125;&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">rich-text</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">    data:&#123;</span><br><span class=\"line\">        html:[</span><br><span class=\"line\">            name:<span class=\"string\">&quot;div&quot;</span>,</span><br><span class=\"line\">            attr:&#123;</span><br><span class=\"line\">            class:&quot;my_div&quot;,</span><br><span class=\"line\">            style:<span class=\"string\">&quot;color:red&quot;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">    children:[&#123;</span><br><span class=\"line\">        name:<span class=\"string\">&quot;p&quot;</span>,</span><br><span class=\"line\">        attr:&#123;&#125;,</span><br><span class=\"line\">        children:[&#123;</span><br><span class=\"line\">            type:<span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">            text:<span class=\"string\">&quot;hellp&quot;</span></span><br><span class=\"line\">        &#125;]</span><br><span class=\"line\">    &#125;]</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>button</p>\n<ul>\n<li>按钮</li>\n<li>open-type:contact：打开客服，在小程序官网，功能-客服。添加；share：分享小程序，不能分享朋友圈；getPhonNumber：获取用户手机号码，需要结合事件使用，只有企业小程序有权限使用，绑定事件bindgetphonenumber，获取回调函数；getUserInof：获取用户信息，需绑定事件，处理函数；openSetting：用户查看更改小程序能获得的权限</li>\n</ul>\n</li>\n<li><p>icon</p>\n<ul>\n<li>图标</li>\n<li>type：图标类型，sucess、warning等参数</li>\n<li>size：大小</li>\n<li>color：颜色</li>\n</ul>\n</li>\n<li><p>radio</p>\n<ul>\n<li>单选框</li>\n<li>必须和父元素radio-group一起使用</li>\n<li>value选中的单选框值</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">radio-group</span> <span class=\"attr\">bindchange</span>=<span class=\"string\">&quot;handelchange&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">radio</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;male&quot;</span>&gt;</span>男<span class=\"tag\">&lt;/<span class=\"name\">radio</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">radio</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;female&quot;</span>&gt;</span>女<span class=\"tag\">&lt;/<span class=\"name\">radio</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">radio-group</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span>你选中的值是：&#123;&#123;gender&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page(&#123;</span><br><span class=\"line\">\tdata:&#123;</span><br><span class=\"line\">\t\tgender:&quot;&quot;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\thandleChange(e)&#123;</span><br><span class=\"line\">\t\tlet gender=e.detail.value;</span><br><span class=\"line\">\t\tthis.setData(&#123;gender&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>checkbox<ul>\n<li>复选框</li>\n<li>需和checkbox-group一起使用</li>\n</ul>\n</li>\n</ul>\n<p>10：自定义组件</p>\n<p>slot标签，占位标签，内容传递过来时，替代</p>\n<p>自定义组件中：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tabs</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tabs</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>父组件中：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tabs</span>&gt;</span></span><br><span class=\"line\">  你好啊</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tabs</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:47:48 GMT+0200 (GMT+02:00)","title":"微信小程序学习笔记","path":"2020/04/07/微信小程序学习笔记/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-04-07T19:48:51.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-07T19:48:51.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["微信小程序"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"个人推荐的一些优秀的安卓开源库","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-02-01T21:54:53.000Z","password":null,"summary":"最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。","_content":"\n# 0：引言\n\n最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。\n\n# 1：Kongzue Dialog V3\n\n**自定义Toast对话框，仿IOS设计**\n\n项目地址：[https://github.com/kongzue/DialogV3](https://github.com/kongzue/DialogV3)\n\n## 1.1 引入\n\n### 1.1.1Support 版本\n\nMaven仓库：\n\n```\n<dependency>\n  <groupId>com.kongzue.dialog_v3</groupId>\n  <artifactId>dialog</artifactId>\n  <version>3.1.8</version>\n  <type>pom</type>\n</dependency>\n```\n\nGradle： 在dependencies{}中添加引用：\n\n```\nimplementation 'com.kongzue.dialog_v3:dialog:3.1.8'\n```\n\n## 1.2 功能\n\n### 1.2.1 基本对话框\n\n![](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png)\n\n### 1.2.2 输入对话框\n\n![输入对话框](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png)\n\n### 1.2.3等待提示对话框\n\n![等待提示框](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png)\n\n### 1.2.4底部菜单\n\n![底部菜单\t](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png)\n\n### 1.2.5通知\n\n![通知](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png)\n\n### 1.2.6分享对话框\n\n![分享](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png)\n\n### 1.2.7全屏\n\n![全屏](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png)\n\n\n\n# 2：YCVideoPlayer\n\n**视频播放器封装库，仿爱奇艺、优酷。**\n\n项目地址：https://github.com/yangchong211/YCVideoPlayer\n\n## 2.1 引用\n\n应用build.gradle中引入\n\n```\ncompile 'cn.yc:YCVideoPlayerLib:2.4.9' \n```\n\n## 2.2 功能\n\n##### A基础功能\n\n- A.1.1 能够自定义视频加载loading类型，设置视频标题，设置视频底部图片，设置播放时长等基础功能\n- A.1.2 可以切换播放器的视频播放状态，播放错误，播放未开始，播放开始，播放准备中，正在播放，暂停播放，正在缓冲等等状态\n- A.1.3 可以自由设置播放器的播放模式，比如，正常播放，全屏播放，和小屏幕播放。其中全屏播放支持旋转屏幕。\n- A.1.4 可以支持多种视频播放类型，比如，原生封装视频播放器，还有基于ijkPlayer封装的播放器。\n- A.1.5 可以设置是否隐藏播放音量，播放进度，播放亮度等，可以通过拖动seekBar改变视频进度。还支持设置n秒后不操作则隐藏头部和顶部布局功能\n- A.1.6 可以设置竖屏模式下全屏模式和横屏模式下的全屏模式，方便多种使用场景\n- A.1.7 top和bottom面版消失和显示：点击视频画面会显示、隐藏操作面板；显示后不操作会5秒后自动消失【也可以设置】\n\n##### B高级功能\n\n- B.1.1 支持一遍播放一遍缓冲的功能，其中缓冲包括两部分，第一种是播放过程中缓冲，第二种是暂停过程中缓冲\n- B.1.2 基于ijkPlayer的封装播放器，支持多种格式视频播放\n- B.1.3 可以设置是否记录播放位置，设置播放速度，设置屏幕比例\n- B.1.4 支持滑动改变音量【屏幕右边】，改变屏幕亮度【屏幕左边】，屏幕底测左右滑动调节进度\n- B.1.5 支持list页面中视频播放，滚动后暂停播放，播放可以自由设置是否记录状态。并且还支持删除视频播放位置状态。\n- B.1.6 切换横竖屏：切换全屏时，隐藏状态栏，显示自定义top(显示电量)；竖屏时恢复原有状态\n- B.1.7 支持切换视频清晰度模式\n- B.1.8 添加锁屏功能，竖屏不提供锁屏按钮，横屏全屏时显示，并且锁屏时，屏蔽手势处理\n\n##### C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\n\n- **C1产品需求：类似优酷，爱奇艺视频播放器部分逻辑。比如如果用户没有登录也没有看视频权限，则提示试看视频[自定义布局]；如果用户没有登录但是有看视频权限，则正常观看；如果用户登录，但是没有充值会员，部分需要权限视频则进入试看模式，试看结束后弹出充值会员界面；如果用户余额不足，比如余额只有99元，但是视频观看要199元，则又有其他提示。**\n- C2自身需求：比如封装好了视频播放库，那么点击视频上登录按钮则跳到登录页面；点击充值会员页面也跳到充值页面。这个通过定义接口，可以让使用者通过方法调用，灵活处理点击事件。\n- C.1.1 可以设置试看模式，设置试看时长。试看结束后就提示登录或者充值……\n- C.1.2 对于设置视频的宽高，建议设置成4：3或者16：9或者常用比例，如果不是常用比例，则可能会有黑边。其中黑边的背景可以设置\n- C.1.3 可以设置播放有权限的视频时的各种文字描述，而没有把它写在封装库中，使用者自己设定\n- C.1.4 锁定屏幕功能\n\n##### D待添加功能\n\n- D.1.1 可以支持屏幕截图功能，视频添加水印效果\n\n- D.1.2 支持弹幕功能\n\n- D.1.3 后期待定，视频拖拽\n\n  \n\n# 3：Android-SpinKit\n\n**加载中样式。**\n\n项目地址：https://ybq.github.io/Android-SpinKit\n\n如果第一章的kongzue等待对话框还不足以满足个性化需求，那这个加载库应该足够了。\n\n## 3.1 引用\n\n```\ndependencies {\n   implementation 'com.github.ybq:Android-SpinKit:1.4.0'\n}\n```\n\n## 3.2 样式\n\n![样式](https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif)\n\n![样式2](https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif)\n\n# 4：AgentWeb\n\n**基于安卓原生Webview的浏览器，自动实现视频全屏播放，加入了网页加载进度条**\n\n项目地址：[https://github.com/Justson/AgentWeb](https://github.com/Justson/AgentWeb)\n\n## 引入\n\nGradle\n\n```\n api 'com.just.agentweb:agentweb:4.1.2' // (必选)\n api 'com.just.agentweb:filechooser:4.1.2'// (可选)\n api 'com.download.library:Downloader:4.1.2'// (可选)\n```\n\n## 效果图\n\n![](https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png)\n\n![](https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png)\n\n![](https://github.com/Justson/AgentWeb/raw/master/img/alipay.png)","source":"_posts/收集一些优秀的安卓开源库.md","raw":"---\ntitle: 个人推荐的一些优秀的安卓开源库\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-02-01 22:54:53\npassword:\nsummary: 最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。\ntags: 安卓开源库\ncategories: 安卓编程\n---\n\n# 0：引言\n\n最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。\n\n# 1：Kongzue Dialog V3\n\n**自定义Toast对话框，仿IOS设计**\n\n项目地址：[https://github.com/kongzue/DialogV3](https://github.com/kongzue/DialogV3)\n\n## 1.1 引入\n\n### 1.1.1Support 版本\n\nMaven仓库：\n\n```\n<dependency>\n  <groupId>com.kongzue.dialog_v3</groupId>\n  <artifactId>dialog</artifactId>\n  <version>3.1.8</version>\n  <type>pom</type>\n</dependency>\n```\n\nGradle： 在dependencies{}中添加引用：\n\n```\nimplementation 'com.kongzue.dialog_v3:dialog:3.1.8'\n```\n\n## 1.2 功能\n\n### 1.2.1 基本对话框\n\n![](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png)\n\n### 1.2.2 输入对话框\n\n![输入对话框](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png)\n\n### 1.2.3等待提示对话框\n\n![等待提示框](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png)\n\n### 1.2.4底部菜单\n\n![底部菜单\t](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png)\n\n### 1.2.5通知\n\n![通知](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png)\n\n### 1.2.6分享对话框\n\n![分享](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png)\n\n### 1.2.7全屏\n\n![全屏](https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png)\n\n\n\n# 2：YCVideoPlayer\n\n**视频播放器封装库，仿爱奇艺、优酷。**\n\n项目地址：https://github.com/yangchong211/YCVideoPlayer\n\n## 2.1 引用\n\n应用build.gradle中引入\n\n```\ncompile 'cn.yc:YCVideoPlayerLib:2.4.9' \n```\n\n## 2.2 功能\n\n##### A基础功能\n\n- A.1.1 能够自定义视频加载loading类型，设置视频标题，设置视频底部图片，设置播放时长等基础功能\n- A.1.2 可以切换播放器的视频播放状态，播放错误，播放未开始，播放开始，播放准备中，正在播放，暂停播放，正在缓冲等等状态\n- A.1.3 可以自由设置播放器的播放模式，比如，正常播放，全屏播放，和小屏幕播放。其中全屏播放支持旋转屏幕。\n- A.1.4 可以支持多种视频播放类型，比如，原生封装视频播放器，还有基于ijkPlayer封装的播放器。\n- A.1.5 可以设置是否隐藏播放音量，播放进度，播放亮度等，可以通过拖动seekBar改变视频进度。还支持设置n秒后不操作则隐藏头部和顶部布局功能\n- A.1.6 可以设置竖屏模式下全屏模式和横屏模式下的全屏模式，方便多种使用场景\n- A.1.7 top和bottom面版消失和显示：点击视频画面会显示、隐藏操作面板；显示后不操作会5秒后自动消失【也可以设置】\n\n##### B高级功能\n\n- B.1.1 支持一遍播放一遍缓冲的功能，其中缓冲包括两部分，第一种是播放过程中缓冲，第二种是暂停过程中缓冲\n- B.1.2 基于ijkPlayer的封装播放器，支持多种格式视频播放\n- B.1.3 可以设置是否记录播放位置，设置播放速度，设置屏幕比例\n- B.1.4 支持滑动改变音量【屏幕右边】，改变屏幕亮度【屏幕左边】，屏幕底测左右滑动调节进度\n- B.1.5 支持list页面中视频播放，滚动后暂停播放，播放可以自由设置是否记录状态。并且还支持删除视频播放位置状态。\n- B.1.6 切换横竖屏：切换全屏时，隐藏状态栏，显示自定义top(显示电量)；竖屏时恢复原有状态\n- B.1.7 支持切换视频清晰度模式\n- B.1.8 添加锁屏功能，竖屏不提供锁屏按钮，横屏全屏时显示，并且锁屏时，屏蔽手势处理\n\n##### C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\n\n- **C1产品需求：类似优酷，爱奇艺视频播放器部分逻辑。比如如果用户没有登录也没有看视频权限，则提示试看视频[自定义布局]；如果用户没有登录但是有看视频权限，则正常观看；如果用户登录，但是没有充值会员，部分需要权限视频则进入试看模式，试看结束后弹出充值会员界面；如果用户余额不足，比如余额只有99元，但是视频观看要199元，则又有其他提示。**\n- C2自身需求：比如封装好了视频播放库，那么点击视频上登录按钮则跳到登录页面；点击充值会员页面也跳到充值页面。这个通过定义接口，可以让使用者通过方法调用，灵活处理点击事件。\n- C.1.1 可以设置试看模式，设置试看时长。试看结束后就提示登录或者充值……\n- C.1.2 对于设置视频的宽高，建议设置成4：3或者16：9或者常用比例，如果不是常用比例，则可能会有黑边。其中黑边的背景可以设置\n- C.1.3 可以设置播放有权限的视频时的各种文字描述，而没有把它写在封装库中，使用者自己设定\n- C.1.4 锁定屏幕功能\n\n##### D待添加功能\n\n- D.1.1 可以支持屏幕截图功能，视频添加水印效果\n\n- D.1.2 支持弹幕功能\n\n- D.1.3 后期待定，视频拖拽\n\n  \n\n# 3：Android-SpinKit\n\n**加载中样式。**\n\n项目地址：https://ybq.github.io/Android-SpinKit\n\n如果第一章的kongzue等待对话框还不足以满足个性化需求，那这个加载库应该足够了。\n\n## 3.1 引用\n\n```\ndependencies {\n   implementation 'com.github.ybq:Android-SpinKit:1.4.0'\n}\n```\n\n## 3.2 样式\n\n![样式](https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif)\n\n![样式2](https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif)\n\n# 4：AgentWeb\n\n**基于安卓原生Webview的浏览器，自动实现视频全屏播放，加入了网页加载进度条**\n\n项目地址：[https://github.com/Justson/AgentWeb](https://github.com/Justson/AgentWeb)\n\n## 引入\n\nGradle\n\n```\n api 'com.just.agentweb:agentweb:4.1.2' // (必选)\n api 'com.just.agentweb:filechooser:4.1.2'// (可选)\n api 'com.download.library:Downloader:4.1.2'// (可选)\n```\n\n## 效果图\n\n![](https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png)\n\n![](https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png)\n\n![](https://github.com/Justson/AgentWeb/raw/master/img/alipay.png)","slug":"收集一些优秀的安卓开源库","published":1,"updated":"2020-06-20T06:47:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaci002zp0vzcx0324fc","content":"<h1 id=\"0：引言\"><a href=\"#0：引言\" class=\"headerlink\" title=\"0：引言\"></a>0：引言</h1><p>最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。</p>\n<h1 id=\"1：Kongzue-Dialog-V3\"><a href=\"#1：Kongzue-Dialog-V3\" class=\"headerlink\" title=\"1：Kongzue Dialog V3\"></a>1：Kongzue Dialog V3</h1><p><strong>自定义Toast对话框，仿IOS设计</strong></p>\n<p>项目地址：<a href=\"https://github.com/kongzue/DialogV3\">https://github.com/kongzue/DialogV3</a></p>\n<h2 id=\"1-1-引入\"><a href=\"#1-1-引入\" class=\"headerlink\" title=\"1.1 引入\"></a>1.1 引入</h2><h3 id=\"1-1-1Support-版本\"><a href=\"#1-1-1Support-版本\" class=\"headerlink\" title=\"1.1.1Support 版本\"></a>1.1.1Support 版本</h3><p>Maven仓库：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">  &lt;groupId&gt;com.kongzue.dialog_v3&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;dialog&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">  &lt;version&gt;3.1.8&lt;&#x2F;version&gt;</span><br><span class=\"line\">  &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>\n\n<p>Gradle： 在dependencies{}中添加引用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation &#39;com.kongzue.dialog_v3:dialog:3.1.8&#39;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-2-功能\"><a href=\"#1-2-功能\" class=\"headerlink\" title=\"1.2 功能\"></a>1.2 功能</h2><h3 id=\"1-2-1-基本对话框\"><a href=\"#1-2-1-基本对话框\" class=\"headerlink\" title=\"1.2.1 基本对话框\"></a>1.2.1 基本对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h3 id=\"1-2-2-输入对话框\"><a href=\"#1-2-2-输入对话框\" class=\"headerlink\" title=\"1.2.2 输入对话框\"></a>1.2.2 输入对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"输入对话框\"></p>\n<h3 id=\"1-2-3等待提示对话框\"><a href=\"#1-2-3等待提示对话框\" class=\"headerlink\" title=\"1.2.3等待提示对话框\"></a>1.2.3等待提示对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"等待提示框\"></p>\n<h3 id=\"1-2-4底部菜单\"><a href=\"#1-2-4底部菜单\" class=\"headerlink\" title=\"1.2.4底部菜单\"></a>1.2.4底部菜单</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"底部菜单    \"></p>\n<h3 id=\"1-2-5通知\"><a href=\"#1-2-5通知\" class=\"headerlink\" title=\"1.2.5通知\"></a>1.2.5通知</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"通知\"></p>\n<h3 id=\"1-2-6分享对话框\"><a href=\"#1-2-6分享对话框\" class=\"headerlink\" title=\"1.2.6分享对话框\"></a>1.2.6分享对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"分享\"></p>\n<h3 id=\"1-2-7全屏\"><a href=\"#1-2-7全屏\" class=\"headerlink\" title=\"1.2.7全屏\"></a>1.2.7全屏</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png\" class=\"lazyload\" data-srcset=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"全屏\"></p>\n<h1 id=\"2：YCVideoPlayer\"><a href=\"#2：YCVideoPlayer\" class=\"headerlink\" title=\"2：YCVideoPlayer\"></a>2：YCVideoPlayer</h1><p><strong>视频播放器封装库，仿爱奇艺、优酷。</strong></p>\n<p>项目地址：<a href=\"https://github.com/yangchong211/YCVideoPlayer\">https://github.com/yangchong211/YCVideoPlayer</a></p>\n<h2 id=\"2-1-引用\"><a href=\"#2-1-引用\" class=\"headerlink\" title=\"2.1 引用\"></a>2.1 引用</h2><p>应用build.gradle中引入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &#39;cn.yc:YCVideoPlayerLib:2.4.9&#39; </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-功能\"><a href=\"#2-2-功能\" class=\"headerlink\" title=\"2.2 功能\"></a>2.2 功能</h2><h5 id=\"A基础功能\"><a href=\"#A基础功能\" class=\"headerlink\" title=\"A基础功能\"></a>A基础功能</h5><ul>\n<li>A.1.1 能够自定义视频加载loading类型，设置视频标题，设置视频底部图片，设置播放时长等基础功能</li>\n<li>A.1.2 可以切换播放器的视频播放状态，播放错误，播放未开始，播放开始，播放准备中，正在播放，暂停播放，正在缓冲等等状态</li>\n<li>A.1.3 可以自由设置播放器的播放模式，比如，正常播放，全屏播放，和小屏幕播放。其中全屏播放支持旋转屏幕。</li>\n<li>A.1.4 可以支持多种视频播放类型，比如，原生封装视频播放器，还有基于ijkPlayer封装的播放器。</li>\n<li>A.1.5 可以设置是否隐藏播放音量，播放进度，播放亮度等，可以通过拖动seekBar改变视频进度。还支持设置n秒后不操作则隐藏头部和顶部布局功能</li>\n<li>A.1.6 可以设置竖屏模式下全屏模式和横屏模式下的全屏模式，方便多种使用场景</li>\n<li>A.1.7 top和bottom面版消失和显示：点击视频画面会显示、隐藏操作面板；显示后不操作会5秒后自动消失【也可以设置】</li>\n</ul>\n<h5 id=\"B高级功能\"><a href=\"#B高级功能\" class=\"headerlink\" title=\"B高级功能\"></a>B高级功能</h5><ul>\n<li>B.1.1 支持一遍播放一遍缓冲的功能，其中缓冲包括两部分，第一种是播放过程中缓冲，第二种是暂停过程中缓冲</li>\n<li>B.1.2 基于ijkPlayer的封装播放器，支持多种格式视频播放</li>\n<li>B.1.3 可以设置是否记录播放位置，设置播放速度，设置屏幕比例</li>\n<li>B.1.4 支持滑动改变音量【屏幕右边】，改变屏幕亮度【屏幕左边】，屏幕底测左右滑动调节进度</li>\n<li>B.1.5 支持list页面中视频播放，滚动后暂停播放，播放可以自由设置是否记录状态。并且还支持删除视频播放位置状态。</li>\n<li>B.1.6 切换横竖屏：切换全屏时，隐藏状态栏，显示自定义top(显示电量)；竖屏时恢复原有状态</li>\n<li>B.1.7 支持切换视频清晰度模式</li>\n<li>B.1.8 添加锁屏功能，竖屏不提供锁屏按钮，横屏全屏时显示，并且锁屏时，屏蔽手势处理</li>\n</ul>\n<h5 id=\"C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\"><a href=\"#C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\" class=\"headerlink\" title=\"C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\"></a>C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】</h5><ul>\n<li><strong>C1产品需求：类似优酷，爱奇艺视频播放器部分逻辑。比如如果用户没有登录也没有看视频权限，则提示试看视频[自定义布局]；如果用户没有登录但是有看视频权限，则正常观看；如果用户登录，但是没有充值会员，部分需要权限视频则进入试看模式，试看结束后弹出充值会员界面；如果用户余额不足，比如余额只有99元，但是视频观看要199元，则又有其他提示。</strong></li>\n<li>C2自身需求：比如封装好了视频播放库，那么点击视频上登录按钮则跳到登录页面；点击充值会员页面也跳到充值页面。这个通过定义接口，可以让使用者通过方法调用，灵活处理点击事件。</li>\n<li>C.1.1 可以设置试看模式，设置试看时长。试看结束后就提示登录或者充值……</li>\n<li>C.1.2 对于设置视频的宽高，建议设置成4：3或者16：9或者常用比例，如果不是常用比例，则可能会有黑边。其中黑边的背景可以设置</li>\n<li>C.1.3 可以设置播放有权限的视频时的各种文字描述，而没有把它写在封装库中，使用者自己设定</li>\n<li>C.1.4 锁定屏幕功能</li>\n</ul>\n<h5 id=\"D待添加功能\"><a href=\"#D待添加功能\" class=\"headerlink\" title=\"D待添加功能\"></a>D待添加功能</h5><ul>\n<li><p>D.1.1 可以支持屏幕截图功能，视频添加水印效果</p>\n</li>\n<li><p>D.1.2 支持弹幕功能</p>\n</li>\n<li><p>D.1.3 后期待定，视频拖拽</p>\n</li>\n</ul>\n<h1 id=\"3：Android-SpinKit\"><a href=\"#3：Android-SpinKit\" class=\"headerlink\" title=\"3：Android-SpinKit\"></a>3：Android-SpinKit</h1><p><strong>加载中样式。</strong></p>\n<p>项目地址：<a href=\"https://ybq.github.io/Android-SpinKit\">https://ybq.github.io/Android-SpinKit</a></p>\n<p>如果第一章的kongzue等待对话框还不足以满足个性化需求，那这个加载库应该足够了。</p>\n<h2 id=\"3-1-引用\"><a href=\"#3-1-引用\" class=\"headerlink\" title=\"3.1 引用\"></a>3.1 引用</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">   implementation &#39;com.github.ybq:Android-SpinKit:1.4.0&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-样式\"><a href=\"#3-2-样式\" class=\"headerlink\" title=\"3.2 样式\"></a>3.2 样式</h2><p><img src=\"https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif\" class=\"lazyload\" data-srcset=\"https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"样式\"></p>\n<p><img src=\"https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif\" class=\"lazyload\" data-srcset=\"https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"样式2\"></p>\n<h1 id=\"4：AgentWeb\"><a href=\"#4：AgentWeb\" class=\"headerlink\" title=\"4：AgentWeb\"></a>4：AgentWeb</h1><p><strong>基于安卓原生Webview的浏览器，自动实现视频全屏播放，加入了网页加载进度条</strong></p>\n<p>项目地址：<a href=\"https://github.com/Justson/AgentWeb\">https://github.com/Justson/AgentWeb</a></p>\n<h2 id=\"引入\"><a href=\"#引入\" class=\"headerlink\" title=\"引入\"></a>引入</h2><p>Gradle</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">api &#39;com.just.agentweb:agentweb:4.1.2&#39; &#x2F;&#x2F; (必选)</span><br><span class=\"line\">api &#39;com.just.agentweb:filechooser:4.1.2&#39;&#x2F;&#x2F; (可选)</span><br><span class=\"line\">api &#39;com.download.library:Downloader:4.1.2&#39;&#x2F;&#x2F; (可选)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><img src=\"https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png\" class=\"lazyload\" data-srcset=\"https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png\" class=\"lazyload\" data-srcset=\"https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"https://github.com/Justson/AgentWeb/raw/master/img/alipay.png\" class=\"lazyload\" data-srcset=\"https://github.com/Justson/AgentWeb/raw/master/img/alipay.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：引言\"><a href=\"#0：引言\" class=\"headerlink\" title=\"0：引言\"></a>0：引言</h1><p>最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。</p>\n<h1 id=\"1：Kongzue-Dialog-V3\"><a href=\"#1：Kongzue-Dialog-V3\" class=\"headerlink\" title=\"1：Kongzue Dialog V3\"></a>1：Kongzue Dialog V3</h1><p><strong>自定义Toast对话框，仿IOS设计</strong></p>\n<p>项目地址：<a href=\"https://github.com/kongzue/DialogV3\">https://github.com/kongzue/DialogV3</a></p>\n<h2 id=\"1-1-引入\"><a href=\"#1-1-引入\" class=\"headerlink\" title=\"1.1 引入\"></a>1.1 引入</h2><h3 id=\"1-1-1Support-版本\"><a href=\"#1-1-1Support-版本\" class=\"headerlink\" title=\"1.1.1Support 版本\"></a>1.1.1Support 版本</h3><p>Maven仓库：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">  &lt;groupId&gt;com.kongzue.dialog_v3&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;dialog&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">  &lt;version&gt;3.1.8&lt;&#x2F;version&gt;</span><br><span class=\"line\">  &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class=\"line\">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>\n\n<p>Gradle： 在dependencies{}中添加引用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation &#39;com.kongzue.dialog_v3:dialog:3.1.8&#39;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-2-功能\"><a href=\"#1-2-功能\" class=\"headerlink\" title=\"1.2 功能\"></a>1.2 功能</h2><h3 id=\"1-2-1-基本对话框\"><a href=\"#1-2-1-基本对话框\" class=\"headerlink\" title=\"1.2.1 基本对话框\"></a>1.2.1 基本对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png\"></p>\n<h3 id=\"1-2-2-输入对话框\"><a href=\"#1-2-2-输入对话框\" class=\"headerlink\" title=\"1.2.2 输入对话框\"></a>1.2.2 输入对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png\" alt=\"输入对话框\"></p>\n<h3 id=\"1-2-3等待提示对话框\"><a href=\"#1-2-3等待提示对话框\" class=\"headerlink\" title=\"1.2.3等待提示对话框\"></a>1.2.3等待提示对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png\" alt=\"等待提示框\"></p>\n<h3 id=\"1-2-4底部菜单\"><a href=\"#1-2-4底部菜单\" class=\"headerlink\" title=\"1.2.4底部菜单\"></a>1.2.4底部菜单</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png\" alt=\"底部菜单    \"></p>\n<h3 id=\"1-2-5通知\"><a href=\"#1-2-5通知\" class=\"headerlink\" title=\"1.2.5通知\"></a>1.2.5通知</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png\" alt=\"通知\"></p>\n<h3 id=\"1-2-6分享对话框\"><a href=\"#1-2-6分享对话框\" class=\"headerlink\" title=\"1.2.6分享对话框\"></a>1.2.6分享对话框</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png\" alt=\"分享\"></p>\n<h3 id=\"1-2-7全屏\"><a href=\"#1-2-7全屏\" class=\"headerlink\" title=\"1.2.7全屏\"></a>1.2.7全屏</h3><p><img src=\"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png\" alt=\"全屏\"></p>\n<h1 id=\"2：YCVideoPlayer\"><a href=\"#2：YCVideoPlayer\" class=\"headerlink\" title=\"2：YCVideoPlayer\"></a>2：YCVideoPlayer</h1><p><strong>视频播放器封装库，仿爱奇艺、优酷。</strong></p>\n<p>项目地址：<a href=\"https://github.com/yangchong211/YCVideoPlayer\">https://github.com/yangchong211/YCVideoPlayer</a></p>\n<h2 id=\"2-1-引用\"><a href=\"#2-1-引用\" class=\"headerlink\" title=\"2.1 引用\"></a>2.1 引用</h2><p>应用build.gradle中引入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &#39;cn.yc:YCVideoPlayerLib:2.4.9&#39; </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-功能\"><a href=\"#2-2-功能\" class=\"headerlink\" title=\"2.2 功能\"></a>2.2 功能</h2><h5 id=\"A基础功能\"><a href=\"#A基础功能\" class=\"headerlink\" title=\"A基础功能\"></a>A基础功能</h5><ul>\n<li>A.1.1 能够自定义视频加载loading类型，设置视频标题，设置视频底部图片，设置播放时长等基础功能</li>\n<li>A.1.2 可以切换播放器的视频播放状态，播放错误，播放未开始，播放开始，播放准备中，正在播放，暂停播放，正在缓冲等等状态</li>\n<li>A.1.3 可以自由设置播放器的播放模式，比如，正常播放，全屏播放，和小屏幕播放。其中全屏播放支持旋转屏幕。</li>\n<li>A.1.4 可以支持多种视频播放类型，比如，原生封装视频播放器，还有基于ijkPlayer封装的播放器。</li>\n<li>A.1.5 可以设置是否隐藏播放音量，播放进度，播放亮度等，可以通过拖动seekBar改变视频进度。还支持设置n秒后不操作则隐藏头部和顶部布局功能</li>\n<li>A.1.6 可以设置竖屏模式下全屏模式和横屏模式下的全屏模式，方便多种使用场景</li>\n<li>A.1.7 top和bottom面版消失和显示：点击视频画面会显示、隐藏操作面板；显示后不操作会5秒后自动消失【也可以设置】</li>\n</ul>\n<h5 id=\"B高级功能\"><a href=\"#B高级功能\" class=\"headerlink\" title=\"B高级功能\"></a>B高级功能</h5><ul>\n<li>B.1.1 支持一遍播放一遍缓冲的功能，其中缓冲包括两部分，第一种是播放过程中缓冲，第二种是暂停过程中缓冲</li>\n<li>B.1.2 基于ijkPlayer的封装播放器，支持多种格式视频播放</li>\n<li>B.1.3 可以设置是否记录播放位置，设置播放速度，设置屏幕比例</li>\n<li>B.1.4 支持滑动改变音量【屏幕右边】，改变屏幕亮度【屏幕左边】，屏幕底测左右滑动调节进度</li>\n<li>B.1.5 支持list页面中视频播放，滚动后暂停播放，播放可以自由设置是否记录状态。并且还支持删除视频播放位置状态。</li>\n<li>B.1.6 切换横竖屏：切换全屏时，隐藏状态栏，显示自定义top(显示电量)；竖屏时恢复原有状态</li>\n<li>B.1.7 支持切换视频清晰度模式</li>\n<li>B.1.8 添加锁屏功能，竖屏不提供锁屏按钮，横屏全屏时显示，并且锁屏时，屏蔽手势处理</li>\n</ul>\n<h5 id=\"C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\"><a href=\"#C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\" class=\"headerlink\" title=\"C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】\"></a>C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】</h5><ul>\n<li><strong>C1产品需求：类似优酷，爱奇艺视频播放器部分逻辑。比如如果用户没有登录也没有看视频权限，则提示试看视频[自定义布局]；如果用户没有登录但是有看视频权限，则正常观看；如果用户登录，但是没有充值会员，部分需要权限视频则进入试看模式，试看结束后弹出充值会员界面；如果用户余额不足，比如余额只有99元，但是视频观看要199元，则又有其他提示。</strong></li>\n<li>C2自身需求：比如封装好了视频播放库，那么点击视频上登录按钮则跳到登录页面；点击充值会员页面也跳到充值页面。这个通过定义接口，可以让使用者通过方法调用，灵活处理点击事件。</li>\n<li>C.1.1 可以设置试看模式，设置试看时长。试看结束后就提示登录或者充值……</li>\n<li>C.1.2 对于设置视频的宽高，建议设置成4：3或者16：9或者常用比例，如果不是常用比例，则可能会有黑边。其中黑边的背景可以设置</li>\n<li>C.1.3 可以设置播放有权限的视频时的各种文字描述，而没有把它写在封装库中，使用者自己设定</li>\n<li>C.1.4 锁定屏幕功能</li>\n</ul>\n<h5 id=\"D待添加功能\"><a href=\"#D待添加功能\" class=\"headerlink\" title=\"D待添加功能\"></a>D待添加功能</h5><ul>\n<li><p>D.1.1 可以支持屏幕截图功能，视频添加水印效果</p>\n</li>\n<li><p>D.1.2 支持弹幕功能</p>\n</li>\n<li><p>D.1.3 后期待定，视频拖拽</p>\n</li>\n</ul>\n<h1 id=\"3：Android-SpinKit\"><a href=\"#3：Android-SpinKit\" class=\"headerlink\" title=\"3：Android-SpinKit\"></a>3：Android-SpinKit</h1><p><strong>加载中样式。</strong></p>\n<p>项目地址：<a href=\"https://ybq.github.io/Android-SpinKit\">https://ybq.github.io/Android-SpinKit</a></p>\n<p>如果第一章的kongzue等待对话框还不足以满足个性化需求，那这个加载库应该足够了。</p>\n<h2 id=\"3-1-引用\"><a href=\"#3-1-引用\" class=\"headerlink\" title=\"3.1 引用\"></a>3.1 引用</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">   implementation &#39;com.github.ybq:Android-SpinKit:1.4.0&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-样式\"><a href=\"#3-2-样式\" class=\"headerlink\" title=\"3.2 样式\"></a>3.2 样式</h2><p><img src=\"https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif\" alt=\"样式\"></p>\n<p><img src=\"https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif\" alt=\"样式2\"></p>\n<h1 id=\"4：AgentWeb\"><a href=\"#4：AgentWeb\" class=\"headerlink\" title=\"4：AgentWeb\"></a>4：AgentWeb</h1><p><strong>基于安卓原生Webview的浏览器，自动实现视频全屏播放，加入了网页加载进度条</strong></p>\n<p>项目地址：<a href=\"https://github.com/Justson/AgentWeb\">https://github.com/Justson/AgentWeb</a></p>\n<h2 id=\"引入\"><a href=\"#引入\" class=\"headerlink\" title=\"引入\"></a>引入</h2><p>Gradle</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">api &#39;com.just.agentweb:agentweb:4.1.2&#39; &#x2F;&#x2F; (必选)</span><br><span class=\"line\">api &#39;com.just.agentweb:filechooser:4.1.2&#39;&#x2F;&#x2F; (可选)</span><br><span class=\"line\">api &#39;com.download.library:Downloader:4.1.2&#39;&#x2F;&#x2F; (可选)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"效果图\"><a href=\"#效果图\" class=\"headerlink\" title=\"效果图\"></a>效果图</h2><p><img src=\"https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png\"></p>\n<p><img src=\"https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png\"></p>\n<p><img src=\"https://github.com/Justson/AgentWeb/raw/master/img/alipay.png\"></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png","popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:47:58 GMT+0200 (GMT+02:00)","title":"个人推荐的一些优秀的安卓开源库","path":"2020/02/01/收集一些优秀的安卓开源库/","eyeCatchImage":"https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-02-01T21:54:53.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-01T21:54:53.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"安卓编程","tags":["安卓开源库"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"机器学习深度学习李宏毅版-学习笔记","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-05-21T15:02:29.000Z","password":null,"summary":"人工智能是当前科技最前沿，最流行的技术，学习人工智能，就应当了解机器学习算法，这里有对线性回归、梯度下降、逻辑回归、深度学习和神经网络算法的总结归纳。","_content":"\n# 第一章 Regression 回归\n\n$$\nf(input)=output\n$$\n\n输入一个对象后，有指定的输出结果。\n\n**示例应用：**数码宝贝原始cp值，求进化一次后的cp值\n\nStep 1: Model\n\n定义一个函数：确定输入原始cp值和输出进化后的cp值。\n$$\ny=b+w*x_{cp}\n$$\n\n> w and b are parameters\n\nStep 2: Goodness of Function方程好坏\n\n对象1：function input: cp612->x1      function output:cp979->y1\n$$\n(x^1,y^1)\n$$\n\n$$\n(x^2,y^2)\n$$\n\n$$\n……\n$$\n\n$$\n(x^{10},y^{10})\n$$\n\n定义另一个函数：确定第一个函数效果如何。输入一个函数，输出函数好坏程度。\n\nLoss Function\n$$\n\\begin{split}\nL(f) &= L(w,b)\n\\\\ &=\\sum_{n=1}^{10}\\left(y^n-\\left(b+w*x^n_{cp}\\right)\\right)^2\n\\end{split}\n$$\nStep 3: Best Function最好的函数\n\nGradient Descent\n$$\nw^*=arg\\ min\\ L(w)\n$$\n枚举w值，找到Loss Function最小的w值。\n\n- 随机选择一个初始w0,\n\n- \n  $$\n  \\frac{dL}{dw}|w=w^0\n  $$\n  \n\n在w0位置，如果斜率为正，则w向小的位置移动，反之向w增大的位置移动，目的是找到L(w)更小的位置。下一个位置w1。\n$$\nw^1=w^0-\\eta\\frac{\\partial L}{\\partial w}|w=w^0,b=b^0\n\\\\b^1=b^0-\\eta\\frac{\\partial L}{\\partial b}|w=w^0,b=b^0\n\\\\\\eta表示学习率。\n$$\n最终找到一个最佳的w和b，确定一个L(f)最小。\n\n然而，由于数码宝贝的物种不同，b和w的取值将不同。\n\n**修改模型**\n\nStep 1:选择模型\n$$\ny=b_1*\\delta(x^s=宝贝1)+w_1*\\delta(x_s=宝贝1)*x_{cp}+b_2*\\delta(x^s=宝贝2)+w_2*\\delta(x_s=宝贝2)*x_{cp}+……\n$$\n\n$$\n\\delta(x_s=宝贝1)\\begin{cases}\n=1\\ if\\,x_s=宝贝1 \\\\\\\\\n=0\\ else\\end{cases}\n$$\n\n此时已经很精准了，但是可能还存在其他除了种类以外的影响因素，比如身高，体重，hp。\n\n回到Step 2:Regularization\n$$\ny=b+\\sum w_ix_i\n\\\\L=\\sum_n(y^n-(b+\\sum w_ix_i))^2+\\lambda\\sum (w_i)^2\n$$\n为了获取一个更光滑的曲线，来减少噪音对输出结果的影响。\n\n> **采用较小的拟合次数简单的model，通常具有更小的方差，但偏差更大，即结果集中但集中位置偏离真实值；较大的拟合次数复杂的model，方差比较大，但偏差更小。**\n\n偏差大：\n\n1. 更多训练数据\n2. 更复杂的模型\n\n方差大：\n\n1. 更多训练数据\n\n获取模型：Validation\n\n训练数据->分三份，两份获取模型，一份验证模型。\n\n# 第二章 Gradient Descent梯度下降法\n\n在第一章Step 3中，我们要找到一个最低的loss function\n$$\n\\theta^*=arg\\ max\\ L(\\theta) \\ \\ \\ \\ L:loss\\ function\\ \\ \\theta:parameters\n$$\n假设$\\theta$有两个参数$\\{\\theta_1,\\theta_2\\}$\n\n随机设置一个$\\theta^0=\\begin{bmatrix}\\theta_1^0\\\\\\theta_2^0\\end{bmatrix}$\n$$\n\\begin{bmatrix}\\theta_1^1\\\\\\theta_2^1\\end{bmatrix}=\\begin{bmatrix}\\theta_1^0\\\\\\theta^0_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^0)}{\\partial\\theta_1}\\\\\\frac{\\partial(\\theta_2^0)}{\\partial\\theta_2}\\end{bmatrix}\n$$\n\n$$\n\\begin{bmatrix}\\theta_1^2\\\\\\theta_2^2\\end{bmatrix}=\\begin{bmatrix}\\theta_1^1\\\\\\theta^1_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^1)}{\\partial\\theta_1}\\\\\\frac{\\partial(\\theta_2^1)}{\\partial\\theta_2}\\end{bmatrix}\n$$\n\n简化公式：\n$$\n\\bigtriangledown L(\\theta)=\\begin{bmatrix}\\frac{\\partial L(\\theta_1)}{\\partial\\theta_1}\\\\\\frac{\\partial L(\\theta_2)}{\\partial\\theta_2}\\end{bmatrix}\n\\\\\\theta^1=\\theta^0-\\eta\\bigtriangledown L(\\theta^0)\n$$\n需要调节学习率（步长）$\\eta$到合适的值。\n\n> 不同的$\\theta$给不同的$\\eta$。\n\nAdagrad:随着参数增加，步长逐渐减小。\n$$\nw^1\\gets w^1-\\frac{\\eta^0}{\\sigma^0}g^0 \\ \\ \\ \\sigma^0=\\sqrt{(g^0)^2}\n\\\\\\vdots\n\\\\\\vdots\n\\\\w^{t+1}\\gets w^t-\\frac{\\eta^t}{\\sigma^t}g^t\\ \\ \\ \\sigma^t=\\sqrt{\\frac{1}{t+1}\\sum^t_{i=0}(g^i)^2}\n$$\n\n$$\n\\eta^t=\\frac{\\eta}{\\sqrt{t+1}}\n$$\n\nFeature Scaling:\n\n将多个x输入的范围统一到一个范围，以保证在计算L(f)时，每个w对L(f)的影响相同。\n\n> Gradient Descent会卡在局部最小值的位置\n\n# 第三章 New Optimizers for Deep Learning 优化\n\n一些记号：\n\n$\\theta_t$:模型参数\n\n$m_{t+1}$:从step 0到step t 的动量。\n\n**SGD：**\n\nSGDM、Learning rate scheduling、NAG\n\n走到最低点时，还不会停下来，由于之前的动量影响，存在一个类似的惯性作用，会继续向上爬坡。\n\n**Adam：**\n\nAdagrad、RMSProp、AMSGrad、AdaBound、RAdam、Nadam、AdamW\n\nSGD+Adam->SWATS\n\n**Lookahead**\n\n# 第四章 Classification 分类\n\n例：投简历\n\n- 输入：收入、存款、专业、年纪\n- 输出：录取或拒绝\n\n模型：\n$$\nx\\rightarrow f(x)\\begin{cases}g(x)>0\\ &Output=class1\\\\else \\ \\ &Output=class2\\end{cases}\n$$\nLoss function：\n$$\nL(f)=\\sum_n\\delta(f(x^n)\\ne y^n)\n$$\n79个水系（C1）宝可梦，61只普通系（C2）的宝可梦\n\n$P(x|C_1)$的可能性。\n\n$P(x|C_1)$满足高斯分布（正态分布），找到最合适的高速分布系数$\\mu$和$E$\n\n使用贝叶斯公式，求测试数据$P(C_1|x)$的概率。\n\n所以：\n\n模型\n$$\nx\\rightarrow P(C_1|x)=\\frac{P(x|C_1)P(C_1)}{P(x|C_1)P(C_1)+P(x|C_2)P(C_2)}\n$$\n函数的好坏：\n\n平均值$\\mu$和$E$。\n\n一堆数学运算……\n\n模型：\n$$\nP_{w,b}(C_2|x)=\\sigma(z)\n\\\\\n\\sigma(z)=\\frac{1}{1+exp(-z)}\n\\\\\nz=w*x+b\n$$\n# 第五章 Logistic Regression\n\n$$\nf_{w,b}(x)=\\sigma(\\sum w_ix+b)\n$$\n$x_1$属于$C_1$,$x_2$属于$C_1$,$x_3$属于$C_2$……\n$$\nL(w,b)=f_{w,b}(x^1)f_{w,b}(x^2)(1-f_{w,b}(x^3))…\n$$\n找到一个$w^*,b^*$满足$arg\\ max\\,L(w,b)$最大。\n\n# 第六章 Deep learning\n\n历史：\n\n1958: Perceptron(linear model)\n\n1980: Multi-layer perceptron\n\n1986: Backpropagation\n\n1989: 1 hidden layer is \"good enough\"\n\n2006: RBM initialization\n\n2009: GPU\n\n2011: Speech recognizition\n\n步骤：\n\n1. 找到一个函数->Neural Network\n\n![](https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg)\n\nDeep = Many hidden layers\n\n# 第七章 Backpropagation 反向传播\n\n让计算梯度下降法的参数更有效。\n\nChain Rule 链式法则：\n\nCase1：\n$$\ny=g(x) \\ \\ \\ \\ z=h(y)\n\\\\\\triangle x \\rightarrow \\triangle y\\rightarrow \\triangle z\n\\\\ \\frac{dz}{dx}=\\frac{dz}{dy}\\frac{dy}{dx}\n$$\nCase2:\n$$\nx=g(s) \\ \\ y=h(s) \\ \\ z=k(x,y)\n\\\\ \\frac{dz}{ds}=\\frac{\\partial z}{\\partial x}\\frac{dx}{ds}+\\frac{\\partial z}{\\partial y}\\frac{dy}{ds}\n$$\n\nLoss function是所有输入经神经网络处理后的输出，与理想输出误差之和。\n$$\nL(\\theta)=\\sum_nC(\\theta)\n$$\n对Loss function求导：\n$$\n\\frac{\\partial L}{\\partial w}=\\sum_n\\frac{\\partial C}{\\partial w}\n$$\n只讨论神经网络的一个节点。\n\n![](https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png)\n\n\n$$\n\\frac{\\partial C}{\\partial w}=\\frac{\\part C}{\\part z}\\frac{\\part z}{\\part w}\n$$\n求z对w求导，很简单，对w1求导是x1，对w2求导是x2。\n\n![](https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png)\n\n假设第二层神经节点的输入a，是将z通过一个信号函数(signal) $\\sigma(z)$得到的现在求$\\frac{\\part C}{\\part z}$\n$$\n\\frac{\\part C}{\\part z}=\\frac{\\part a}{\\part z}\\frac{\\part C}{\\part a}\n$$\n利用链式法则，求$\\frac{\\part C}{\\part a}$\n\n公式见上图。此时，通过反向传递法则。假设红色的信号节点就是神经网络的最后一个节点，对应输出就是神经网络输出。那么可以倒推回去。$\\frac{\\part C}{\\part z^,}$就等于最后的sign函数导数。因此能求得$\\frac{\\part C}{\\part a}$，这样依次反推回去。最终求得每个节点的$\\frac{\\part C}{\\part z}$。从而求得Loss function的导数。\n\n# 第八章 Tips for Deep Learning\n\n1. 定义一个方程\n2. 方程好坏\n3. 选择最好的方程\n\n4. 获得一个Neural Network\n5. 是否获得一个好的结果在Training Data，如果不好重新选择最好的方程\n6. 在Testing Data获得不好的结果，overfitting，则重新定义一个方程。\n\n**ReLU**\n\nRectified Linear Unit.矫正线性单元\n\n![](https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png)\n\n如果某个节点，输出是零，那么他对最后的结果没有任何影响。所以，输出为零关联的之后节点都可以被拿掉。\n\n**ReLU -variant**\n\n当z小于0时，a=mz。\n\nLeaky ReLU ：m=0.01\n\nParametric: m可变\n\n**Maxout**\n\n最大输出，将不同输入的输出z分组，组内选出最大的值，作为下一个节点输入。\n\n\n\n**RMSProp**\n$$\nw^1 \\leftarrow w^0-\\frac{\\eta}{\\sigma^0}g^0 \\ \\ \\ \\ \\ \\sigma^0=g^0\n\\\\\nw^2 \\leftarrow w^1-\\frac{\\eta}{\\sigma^1}g^1 \\ \\ \\ \\ \\ \\sigma^1=\\sqrt{\\alpha (\\sigma^0)^2+(1-\\alpha)(g^1)^2}\n\\\\……\n$$\n$\\alpha$可以设置。\n\n**Momentum**\n\n在初始点$\\theta^0$处，加速度方向为gradient方向。\n\n初始移动距离:$v_0=0$\n\n加速度(第一点处的gradient):$\\triangledown L(\\theta^0)$\n\n移动距离:$v^1=\\lambda v^0-\\eta \\triangledown L(\\theta^0)$\n\n移到第二点:$\\theta^1=\\theta^0+v^1$\n\n计算第二点的加速度:$\\triangledown L(\\theta^1)$\n\n下一次移动距离:$v^2=\\lambda v^1-\\eta \\triangledown L(\\theta^1)$\n\n移动到第三点:$\\theta^2=\\theta^1+v^2$\n\n**Adam**:RMSProp+Momentum\n\n**过拟合问题**\n\n1. early stop\n\n通过情况可能出席，当训练集增加时，测试集的正确率反而下降，因此通过减少训练集的数据来达到防止过拟合。\n\n2. Regularization\n\n$$\nL^,(\\theta)=L(\\theta)+\\lambda \\frac{1}{2}||\\theta||_2\n$$\n\n$$\n||\\theta||_2=(w_1)^2+(w_2)^2+……\n$$\n\n$||\\theta||_2$不考虑biases，因为正则化是为了让loss function更加平滑，biases并不会起到作用。\n\nLoss function求导:\n$$\n\\frac{\\partial L^,}{\\partial w}=\\frac{\\partial L}{\\part w}+\\lambda w\n$$\n在找下一个\n$$\nw^{t+1}\\rightarrow w^t-\\eta\\frac{\\part L^,}{\\part w} =w^t-\\eta(\\frac{\\part L}{\\part w}+\\lambda w^t)=(1-\\eta\\lambda)w^t-\\eta\\frac{\\part L}{\\part w}\n$$\n\n3. Dropout\n\n在更新参数之前：\n\n- 每个节点有p%几率被丢掉\n- 使用新的网络去训练\n\n测试时：\n\n没有丢弃节点\n\n- 如果丢弃率为p%，所有的weights times(1-p)%\n\n可以理解为，在训练时，腿上绑重物，测试时把重物拿掉。\n\n为什么要乘(1-p)%\n\n![](https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png)\n\n假设丢弃率为50%,在训练时一半节点被拿掉，而测试时使用了所有节点，导致节点z相差两倍，在测试时将所有weight乘50%，保证测试时的$z'\\approx z$\n\n# 第八章 Why deep\n\n矮胖？高瘦？\n\n实验数据表明，相同参数情况下，deep的错误率更小。\n\n**Modularization**\n\n- Deep->Modularization\n\n比如辨别男生长发、男生短发、女生长发、女生长发。\n\n男生长发的训练集是很少的。\n\n使用模组化，可以先辨别性别，在辨别头发长短。这样性别和长短发的训练集都是差不多的。这样男生长发也有好的正确率。\n\n- Deep->Modularization->Less training data\n\n**Modularization-Speech**\n\n人类语言的架构\n\nPhoneme:人类发音的音节，\n\nTri-phone:不同的组合\n\nState: 不同的节\n\n- 语音识别：\n\n分类：input->acoustic feature,output->state\n\n> deep的好处是，可以把复杂的问题，使用很多个简单的function连接在一起。\n\n# 第九章 Pytorch\n\n指定设备，迁移到某个设备\n\n```python\ncpu = torch.device(\"cpu\")\ngpu=torch.device(\"gpu\")\nx= torch.rand(10)\nprint(x)\nx=x.to(gpu)\n```\n\n","source":"_posts/机器学习深度学习-学习笔记.md","raw":"---\ntitle: 机器学习深度学习李宏毅版-学习笔记\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-05-21 17:02:29\npassword:\nsummary: 人工智能是当前科技最前沿，最流行的技术，学习人工智能，就应当了解机器学习算法，这里有对线性回归、梯度下降、逻辑回归、深度学习和神经网络算法的总结归纳。\ntags: 机器学习\ncategories: 学习笔记\n---\n\n# 第一章 Regression 回归\n\n$$\nf(input)=output\n$$\n\n输入一个对象后，有指定的输出结果。\n\n**示例应用：**数码宝贝原始cp值，求进化一次后的cp值\n\nStep 1: Model\n\n定义一个函数：确定输入原始cp值和输出进化后的cp值。\n$$\ny=b+w*x_{cp}\n$$\n\n> w and b are parameters\n\nStep 2: Goodness of Function方程好坏\n\n对象1：function input: cp612->x1      function output:cp979->y1\n$$\n(x^1,y^1)\n$$\n\n$$\n(x^2,y^2)\n$$\n\n$$\n……\n$$\n\n$$\n(x^{10},y^{10})\n$$\n\n定义另一个函数：确定第一个函数效果如何。输入一个函数，输出函数好坏程度。\n\nLoss Function\n$$\n\\begin{split}\nL(f) &= L(w,b)\n\\\\ &=\\sum_{n=1}^{10}\\left(y^n-\\left(b+w*x^n_{cp}\\right)\\right)^2\n\\end{split}\n$$\nStep 3: Best Function最好的函数\n\nGradient Descent\n$$\nw^*=arg\\ min\\ L(w)\n$$\n枚举w值，找到Loss Function最小的w值。\n\n- 随机选择一个初始w0,\n\n- \n  $$\n  \\frac{dL}{dw}|w=w^0\n  $$\n  \n\n在w0位置，如果斜率为正，则w向小的位置移动，反之向w增大的位置移动，目的是找到L(w)更小的位置。下一个位置w1。\n$$\nw^1=w^0-\\eta\\frac{\\partial L}{\\partial w}|w=w^0,b=b^0\n\\\\b^1=b^0-\\eta\\frac{\\partial L}{\\partial b}|w=w^0,b=b^0\n\\\\\\eta表示学习率。\n$$\n最终找到一个最佳的w和b，确定一个L(f)最小。\n\n然而，由于数码宝贝的物种不同，b和w的取值将不同。\n\n**修改模型**\n\nStep 1:选择模型\n$$\ny=b_1*\\delta(x^s=宝贝1)+w_1*\\delta(x_s=宝贝1)*x_{cp}+b_2*\\delta(x^s=宝贝2)+w_2*\\delta(x_s=宝贝2)*x_{cp}+……\n$$\n\n$$\n\\delta(x_s=宝贝1)\\begin{cases}\n=1\\ if\\,x_s=宝贝1 \\\\\\\\\n=0\\ else\\end{cases}\n$$\n\n此时已经很精准了，但是可能还存在其他除了种类以外的影响因素，比如身高，体重，hp。\n\n回到Step 2:Regularization\n$$\ny=b+\\sum w_ix_i\n\\\\L=\\sum_n(y^n-(b+\\sum w_ix_i))^2+\\lambda\\sum (w_i)^2\n$$\n为了获取一个更光滑的曲线，来减少噪音对输出结果的影响。\n\n> **采用较小的拟合次数简单的model，通常具有更小的方差，但偏差更大，即结果集中但集中位置偏离真实值；较大的拟合次数复杂的model，方差比较大，但偏差更小。**\n\n偏差大：\n\n1. 更多训练数据\n2. 更复杂的模型\n\n方差大：\n\n1. 更多训练数据\n\n获取模型：Validation\n\n训练数据->分三份，两份获取模型，一份验证模型。\n\n# 第二章 Gradient Descent梯度下降法\n\n在第一章Step 3中，我们要找到一个最低的loss function\n$$\n\\theta^*=arg\\ max\\ L(\\theta) \\ \\ \\ \\ L:loss\\ function\\ \\ \\theta:parameters\n$$\n假设$\\theta$有两个参数$\\{\\theta_1,\\theta_2\\}$\n\n随机设置一个$\\theta^0=\\begin{bmatrix}\\theta_1^0\\\\\\theta_2^0\\end{bmatrix}$\n$$\n\\begin{bmatrix}\\theta_1^1\\\\\\theta_2^1\\end{bmatrix}=\\begin{bmatrix}\\theta_1^0\\\\\\theta^0_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^0)}{\\partial\\theta_1}\\\\\\frac{\\partial(\\theta_2^0)}{\\partial\\theta_2}\\end{bmatrix}\n$$\n\n$$\n\\begin{bmatrix}\\theta_1^2\\\\\\theta_2^2\\end{bmatrix}=\\begin{bmatrix}\\theta_1^1\\\\\\theta^1_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^1)}{\\partial\\theta_1}\\\\\\frac{\\partial(\\theta_2^1)}{\\partial\\theta_2}\\end{bmatrix}\n$$\n\n简化公式：\n$$\n\\bigtriangledown L(\\theta)=\\begin{bmatrix}\\frac{\\partial L(\\theta_1)}{\\partial\\theta_1}\\\\\\frac{\\partial L(\\theta_2)}{\\partial\\theta_2}\\end{bmatrix}\n\\\\\\theta^1=\\theta^0-\\eta\\bigtriangledown L(\\theta^0)\n$$\n需要调节学习率（步长）$\\eta$到合适的值。\n\n> 不同的$\\theta$给不同的$\\eta$。\n\nAdagrad:随着参数增加，步长逐渐减小。\n$$\nw^1\\gets w^1-\\frac{\\eta^0}{\\sigma^0}g^0 \\ \\ \\ \\sigma^0=\\sqrt{(g^0)^2}\n\\\\\\vdots\n\\\\\\vdots\n\\\\w^{t+1}\\gets w^t-\\frac{\\eta^t}{\\sigma^t}g^t\\ \\ \\ \\sigma^t=\\sqrt{\\frac{1}{t+1}\\sum^t_{i=0}(g^i)^2}\n$$\n\n$$\n\\eta^t=\\frac{\\eta}{\\sqrt{t+1}}\n$$\n\nFeature Scaling:\n\n将多个x输入的范围统一到一个范围，以保证在计算L(f)时，每个w对L(f)的影响相同。\n\n> Gradient Descent会卡在局部最小值的位置\n\n# 第三章 New Optimizers for Deep Learning 优化\n\n一些记号：\n\n$\\theta_t$:模型参数\n\n$m_{t+1}$:从step 0到step t 的动量。\n\n**SGD：**\n\nSGDM、Learning rate scheduling、NAG\n\n走到最低点时，还不会停下来，由于之前的动量影响，存在一个类似的惯性作用，会继续向上爬坡。\n\n**Adam：**\n\nAdagrad、RMSProp、AMSGrad、AdaBound、RAdam、Nadam、AdamW\n\nSGD+Adam->SWATS\n\n**Lookahead**\n\n# 第四章 Classification 分类\n\n例：投简历\n\n- 输入：收入、存款、专业、年纪\n- 输出：录取或拒绝\n\n模型：\n$$\nx\\rightarrow f(x)\\begin{cases}g(x)>0\\ &Output=class1\\\\else \\ \\ &Output=class2\\end{cases}\n$$\nLoss function：\n$$\nL(f)=\\sum_n\\delta(f(x^n)\\ne y^n)\n$$\n79个水系（C1）宝可梦，61只普通系（C2）的宝可梦\n\n$P(x|C_1)$的可能性。\n\n$P(x|C_1)$满足高斯分布（正态分布），找到最合适的高速分布系数$\\mu$和$E$\n\n使用贝叶斯公式，求测试数据$P(C_1|x)$的概率。\n\n所以：\n\n模型\n$$\nx\\rightarrow P(C_1|x)=\\frac{P(x|C_1)P(C_1)}{P(x|C_1)P(C_1)+P(x|C_2)P(C_2)}\n$$\n函数的好坏：\n\n平均值$\\mu$和$E$。\n\n一堆数学运算……\n\n模型：\n$$\nP_{w,b}(C_2|x)=\\sigma(z)\n\\\\\n\\sigma(z)=\\frac{1}{1+exp(-z)}\n\\\\\nz=w*x+b\n$$\n# 第五章 Logistic Regression\n\n$$\nf_{w,b}(x)=\\sigma(\\sum w_ix+b)\n$$\n$x_1$属于$C_1$,$x_2$属于$C_1$,$x_3$属于$C_2$……\n$$\nL(w,b)=f_{w,b}(x^1)f_{w,b}(x^2)(1-f_{w,b}(x^3))…\n$$\n找到一个$w^*,b^*$满足$arg\\ max\\,L(w,b)$最大。\n\n# 第六章 Deep learning\n\n历史：\n\n1958: Perceptron(linear model)\n\n1980: Multi-layer perceptron\n\n1986: Backpropagation\n\n1989: 1 hidden layer is \"good enough\"\n\n2006: RBM initialization\n\n2009: GPU\n\n2011: Speech recognizition\n\n步骤：\n\n1. 找到一个函数->Neural Network\n\n![](https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg)\n\nDeep = Many hidden layers\n\n# 第七章 Backpropagation 反向传播\n\n让计算梯度下降法的参数更有效。\n\nChain Rule 链式法则：\n\nCase1：\n$$\ny=g(x) \\ \\ \\ \\ z=h(y)\n\\\\\\triangle x \\rightarrow \\triangle y\\rightarrow \\triangle z\n\\\\ \\frac{dz}{dx}=\\frac{dz}{dy}\\frac{dy}{dx}\n$$\nCase2:\n$$\nx=g(s) \\ \\ y=h(s) \\ \\ z=k(x,y)\n\\\\ \\frac{dz}{ds}=\\frac{\\partial z}{\\partial x}\\frac{dx}{ds}+\\frac{\\partial z}{\\partial y}\\frac{dy}{ds}\n$$\n\nLoss function是所有输入经神经网络处理后的输出，与理想输出误差之和。\n$$\nL(\\theta)=\\sum_nC(\\theta)\n$$\n对Loss function求导：\n$$\n\\frac{\\partial L}{\\partial w}=\\sum_n\\frac{\\partial C}{\\partial w}\n$$\n只讨论神经网络的一个节点。\n\n![](https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png)\n\n\n$$\n\\frac{\\partial C}{\\partial w}=\\frac{\\part C}{\\part z}\\frac{\\part z}{\\part w}\n$$\n求z对w求导，很简单，对w1求导是x1，对w2求导是x2。\n\n![](https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png)\n\n假设第二层神经节点的输入a，是将z通过一个信号函数(signal) $\\sigma(z)$得到的现在求$\\frac{\\part C}{\\part z}$\n$$\n\\frac{\\part C}{\\part z}=\\frac{\\part a}{\\part z}\\frac{\\part C}{\\part a}\n$$\n利用链式法则，求$\\frac{\\part C}{\\part a}$\n\n公式见上图。此时，通过反向传递法则。假设红色的信号节点就是神经网络的最后一个节点，对应输出就是神经网络输出。那么可以倒推回去。$\\frac{\\part C}{\\part z^,}$就等于最后的sign函数导数。因此能求得$\\frac{\\part C}{\\part a}$，这样依次反推回去。最终求得每个节点的$\\frac{\\part C}{\\part z}$。从而求得Loss function的导数。\n\n# 第八章 Tips for Deep Learning\n\n1. 定义一个方程\n2. 方程好坏\n3. 选择最好的方程\n\n4. 获得一个Neural Network\n5. 是否获得一个好的结果在Training Data，如果不好重新选择最好的方程\n6. 在Testing Data获得不好的结果，overfitting，则重新定义一个方程。\n\n**ReLU**\n\nRectified Linear Unit.矫正线性单元\n\n![](https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png)\n\n如果某个节点，输出是零，那么他对最后的结果没有任何影响。所以，输出为零关联的之后节点都可以被拿掉。\n\n**ReLU -variant**\n\n当z小于0时，a=mz。\n\nLeaky ReLU ：m=0.01\n\nParametric: m可变\n\n**Maxout**\n\n最大输出，将不同输入的输出z分组，组内选出最大的值，作为下一个节点输入。\n\n\n\n**RMSProp**\n$$\nw^1 \\leftarrow w^0-\\frac{\\eta}{\\sigma^0}g^0 \\ \\ \\ \\ \\ \\sigma^0=g^0\n\\\\\nw^2 \\leftarrow w^1-\\frac{\\eta}{\\sigma^1}g^1 \\ \\ \\ \\ \\ \\sigma^1=\\sqrt{\\alpha (\\sigma^0)^2+(1-\\alpha)(g^1)^2}\n\\\\……\n$$\n$\\alpha$可以设置。\n\n**Momentum**\n\n在初始点$\\theta^0$处，加速度方向为gradient方向。\n\n初始移动距离:$v_0=0$\n\n加速度(第一点处的gradient):$\\triangledown L(\\theta^0)$\n\n移动距离:$v^1=\\lambda v^0-\\eta \\triangledown L(\\theta^0)$\n\n移到第二点:$\\theta^1=\\theta^0+v^1$\n\n计算第二点的加速度:$\\triangledown L(\\theta^1)$\n\n下一次移动距离:$v^2=\\lambda v^1-\\eta \\triangledown L(\\theta^1)$\n\n移动到第三点:$\\theta^2=\\theta^1+v^2$\n\n**Adam**:RMSProp+Momentum\n\n**过拟合问题**\n\n1. early stop\n\n通过情况可能出席，当训练集增加时，测试集的正确率反而下降，因此通过减少训练集的数据来达到防止过拟合。\n\n2. Regularization\n\n$$\nL^,(\\theta)=L(\\theta)+\\lambda \\frac{1}{2}||\\theta||_2\n$$\n\n$$\n||\\theta||_2=(w_1)^2+(w_2)^2+……\n$$\n\n$||\\theta||_2$不考虑biases，因为正则化是为了让loss function更加平滑，biases并不会起到作用。\n\nLoss function求导:\n$$\n\\frac{\\partial L^,}{\\partial w}=\\frac{\\partial L}{\\part w}+\\lambda w\n$$\n在找下一个\n$$\nw^{t+1}\\rightarrow w^t-\\eta\\frac{\\part L^,}{\\part w} =w^t-\\eta(\\frac{\\part L}{\\part w}+\\lambda w^t)=(1-\\eta\\lambda)w^t-\\eta\\frac{\\part L}{\\part w}\n$$\n\n3. Dropout\n\n在更新参数之前：\n\n- 每个节点有p%几率被丢掉\n- 使用新的网络去训练\n\n测试时：\n\n没有丢弃节点\n\n- 如果丢弃率为p%，所有的weights times(1-p)%\n\n可以理解为，在训练时，腿上绑重物，测试时把重物拿掉。\n\n为什么要乘(1-p)%\n\n![](https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png)\n\n假设丢弃率为50%,在训练时一半节点被拿掉，而测试时使用了所有节点，导致节点z相差两倍，在测试时将所有weight乘50%，保证测试时的$z'\\approx z$\n\n# 第八章 Why deep\n\n矮胖？高瘦？\n\n实验数据表明，相同参数情况下，deep的错误率更小。\n\n**Modularization**\n\n- Deep->Modularization\n\n比如辨别男生长发、男生短发、女生长发、女生长发。\n\n男生长发的训练集是很少的。\n\n使用模组化，可以先辨别性别，在辨别头发长短。这样性别和长短发的训练集都是差不多的。这样男生长发也有好的正确率。\n\n- Deep->Modularization->Less training data\n\n**Modularization-Speech**\n\n人类语言的架构\n\nPhoneme:人类发音的音节，\n\nTri-phone:不同的组合\n\nState: 不同的节\n\n- 语音识别：\n\n分类：input->acoustic feature,output->state\n\n> deep的好处是，可以把复杂的问题，使用很多个简单的function连接在一起。\n\n# 第九章 Pytorch\n\n指定设备，迁移到某个设备\n\n```python\ncpu = torch.device(\"cpu\")\ngpu=torch.device(\"gpu\")\nx= torch.rand(10)\nprint(x)\nx=x.to(gpu)\n```\n\n","slug":"机器学习深度学习-学习笔记","published":1,"updated":"2020-06-21T08:39:24.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsack0033p0vz94aygvs3","content":"<h1 id=\"第一章-Regression-回归\"><a href=\"#第一章-Regression-回归\" class=\"headerlink\" title=\"第一章 Regression 回归\"></a>第一章 Regression 回归</h1><p>$$<br>f(input)=output<br>$$</p>\n<p>输入一个对象后，有指定的输出结果。</p>\n<p><strong>示例应用：</strong>数码宝贝原始cp值，求进化一次后的cp值</p>\n<p>Step 1: Model</p>\n<p>定义一个函数：确定输入原始cp值和输出进化后的cp值。<br>$$<br>y=b+w*x_{cp}<br>$$</p>\n<blockquote>\n<p>w and b are parameters</p>\n</blockquote>\n<p>Step 2: Goodness of Function方程好坏</p>\n<p>对象1：function input: cp612-&gt;x1      function output:cp979-&gt;y1<br>$$<br>(x^1,y^1)<br>$$</p>\n<p>$$<br>(x^2,y^2)<br>$$</p>\n<p>$$<br>……<br>$$</p>\n<p>$$<br>(x^{10},y^{10})<br>$$</p>\n<p>定义另一个函数：确定第一个函数效果如何。输入一个函数，输出函数好坏程度。</p>\n<p>Loss Function<br>$$<br>\\begin{split}<br>L(f) &amp;= L(w,b)<br>\\ &amp;=\\sum_{n=1}^{10}\\left(y^n-\\left(b+w*x^n_{cp}\\right)\\right)^2<br>\\end{split}<br>$$<br>Step 3: Best Function最好的函数</p>\n<p>Gradient Descent<br>$$<br>w^*=arg\\ min\\ L(w)<br>$$<br>枚举w值，找到Loss Function最小的w值。</p>\n<ul>\n<li><p>随机选择一个初始w0,</p>\n</li>\n<li><p>$$<br>\\frac{dL}{dw}|w=w^0<br>$$</p>\n</li>\n</ul>\n<p>在w0位置，如果斜率为正，则w向小的位置移动，反之向w增大的位置移动，目的是找到L(w)更小的位置。下一个位置w1。<br>$$<br>w^1=w^0-\\eta\\frac{\\partial L}{\\partial w}|w=w^0,b=b^0<br>\\b^1=b^0-\\eta\\frac{\\partial L}{\\partial b}|w=w^0,b=b^0<br>\\\\eta表示学习率。<br>$$<br>最终找到一个最佳的w和b，确定一个L(f)最小。</p>\n<p>然而，由于数码宝贝的物种不同，b和w的取值将不同。</p>\n<p><strong>修改模型</strong></p>\n<p>Step 1:选择模型<br>$$<br>y=b_1<em>\\delta(x^s=宝贝1)+w_1</em>\\delta(x_s=宝贝1)<em>x_{cp}+b_2</em>\\delta(x^s=宝贝2)+w_2*\\delta(x_s=宝贝2)*x_{cp}+……<br>$$</p>\n<p>$$<br>\\delta(x_s=宝贝1)\\begin{cases}<br>=1\\ if,x_s=宝贝1 \\\\<br>=0\\ else\\end{cases}<br>$$</p>\n<p>此时已经很精准了，但是可能还存在其他除了种类以外的影响因素，比如身高，体重，hp。</p>\n<p>回到Step 2:Regularization<br>$$<br>y=b+\\sum w_ix_i<br>\\L=\\sum_n(y^n-(b+\\sum w_ix_i))^2+\\lambda\\sum (w_i)^2<br>$$<br>为了获取一个更光滑的曲线，来减少噪音对输出结果的影响。</p>\n<blockquote>\n<p><strong>采用较小的拟合次数简单的model，通常具有更小的方差，但偏差更大，即结果集中但集中位置偏离真实值；较大的拟合次数复杂的model，方差比较大，但偏差更小。</strong></p>\n</blockquote>\n<p>偏差大：</p>\n<ol>\n<li>更多训练数据</li>\n<li>更复杂的模型</li>\n</ol>\n<p>方差大：</p>\n<ol>\n<li>更多训练数据</li>\n</ol>\n<p>获取模型：Validation</p>\n<p>训练数据-&gt;分三份，两份获取模型，一份验证模型。</p>\n<h1 id=\"第二章-Gradient-Descent梯度下降法\"><a href=\"#第二章-Gradient-Descent梯度下降法\" class=\"headerlink\" title=\"第二章 Gradient Descent梯度下降法\"></a>第二章 Gradient Descent梯度下降法</h1><p>在第一章Step 3中，我们要找到一个最低的loss function<br>$$<br>\\theta^*=arg\\ max\\ L(\\theta) \\ \\ \\ \\ L:loss\\ function\\ \\ \\theta:parameters<br>$$<br>假设$\\theta$有两个参数${\\theta_1,\\theta_2}$</p>\n<p>随机设置一个$\\theta^0=\\begin{bmatrix}\\theta_1^0\\\\theta_2^0\\end{bmatrix}$<br>$$<br>\\begin{bmatrix}\\theta_1^1\\\\theta_2^1\\end{bmatrix}=\\begin{bmatrix}\\theta_1^0\\\\theta^0_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^0)}{\\partial\\theta_1}\\\\frac{\\partial(\\theta_2^0)}{\\partial\\theta_2}\\end{bmatrix}<br>$$</p>\n<p>$$<br>\\begin{bmatrix}\\theta_1^2\\\\theta_2^2\\end{bmatrix}=\\begin{bmatrix}\\theta_1^1\\\\theta^1_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^1)}{\\partial\\theta_1}\\\\frac{\\partial(\\theta_2^1)}{\\partial\\theta_2}\\end{bmatrix}<br>$$</p>\n<p>简化公式：<br>$$<br>\\bigtriangledown L(\\theta)=\\begin{bmatrix}\\frac{\\partial L(\\theta_1)}{\\partial\\theta_1}\\\\frac{\\partial L(\\theta_2)}{\\partial\\theta_2}\\end{bmatrix}<br>\\\\theta^1=\\theta^0-\\eta\\bigtriangledown L(\\theta^0)<br>$$<br>需要调节学习率（步长）$\\eta$到合适的值。</p>\n<blockquote>\n<p>不同的$\\theta$给不同的$\\eta$。</p>\n</blockquote>\n<p>Adagrad:随着参数增加，步长逐渐减小。<br>$$<br>w^1\\gets w^1-\\frac{\\eta^0}{\\sigma^0}g^0 \\ \\ \\ \\sigma^0=\\sqrt{(g^0)^2}<br>\\\\vdots<br>\\\\vdots<br>\\w^{t+1}\\gets w^t-\\frac{\\eta^t}{\\sigma^t}g^t\\ \\ \\ \\sigma^t=\\sqrt{\\frac{1}{t+1}\\sum^t_{i=0}(g^i)^2}<br>$$</p>\n<p>$$<br>\\eta^t=\\frac{\\eta}{\\sqrt{t+1}}<br>$$</p>\n<p>Feature Scaling:</p>\n<p>将多个x输入的范围统一到一个范围，以保证在计算L(f)时，每个w对L(f)的影响相同。</p>\n<blockquote>\n<p>Gradient Descent会卡在局部最小值的位置</p>\n</blockquote>\n<h1 id=\"第三章-New-Optimizers-for-Deep-Learning-优化\"><a href=\"#第三章-New-Optimizers-for-Deep-Learning-优化\" class=\"headerlink\" title=\"第三章 New Optimizers for Deep Learning 优化\"></a>第三章 New Optimizers for Deep Learning 优化</h1><p>一些记号：</p>\n<p>$\\theta_t$:模型参数</p>\n<p>$m_{t+1}$:从step 0到step t 的动量。</p>\n<p><strong>SGD：</strong></p>\n<p>SGDM、Learning rate scheduling、NAG</p>\n<p>走到最低点时，还不会停下来，由于之前的动量影响，存在一个类似的惯性作用，会继续向上爬坡。</p>\n<p><strong>Adam：</strong></p>\n<p>Adagrad、RMSProp、AMSGrad、AdaBound、RAdam、Nadam、AdamW</p>\n<p>SGD+Adam-&gt;SWATS</p>\n<p><strong>Lookahead</strong></p>\n<h1 id=\"第四章-Classification-分类\"><a href=\"#第四章-Classification-分类\" class=\"headerlink\" title=\"第四章 Classification 分类\"></a>第四章 Classification 分类</h1><p>例：投简历</p>\n<ul>\n<li>输入：收入、存款、专业、年纪</li>\n<li>输出：录取或拒绝</li>\n</ul>\n<p>模型：<br>$$<br>x\\rightarrow f(x)\\begin{cases}g(x)&gt;0\\ &amp;Output=class1\\else \\ \\ &amp;Output=class2\\end{cases}<br>$$<br>Loss function：<br>$$<br>L(f)=\\sum_n\\delta(f(x^n)\\ne y^n)<br>$$<br>79个水系（C1）宝可梦，61只普通系（C2）的宝可梦</p>\n<p>$P(x|C_1)$的可能性。</p>\n<p>$P(x|C_1)$满足高斯分布（正态分布），找到最合适的高速分布系数$\\mu$和$E$</p>\n<p>使用贝叶斯公式，求测试数据$P(C_1|x)$的概率。</p>\n<p>所以：</p>\n<p>模型<br>$$<br>x\\rightarrow P(C_1|x)=\\frac{P(x|C_1)P(C_1)}{P(x|C_1)P(C_1)+P(x|C_2)P(C_2)}<br>$$<br>函数的好坏：</p>\n<p>平均值$\\mu$和$E$。</p>\n<p>一堆数学运算……</p>\n<p>模型：<br>$$<br>P_{w,b}(C_2|x)=\\sigma(z)<br>\\<br>\\sigma(z)=\\frac{1}{1+exp(-z)}<br>\\<br>z=w*x+b<br>$$</p>\n<h1 id=\"第五章-Logistic-Regression\"><a href=\"#第五章-Logistic-Regression\" class=\"headerlink\" title=\"第五章 Logistic Regression\"></a>第五章 Logistic Regression</h1><p>$$<br>f_{w,b}(x)=\\sigma(\\sum w_ix+b)<br>$$<br>$x_1$属于$C_1$,$x_2$属于$C_1$,$x_3$属于$C_2$……<br>$$<br>L(w,b)=f_{w,b}(x^1)f_{w,b}(x^2)(1-f_{w,b}(x^3))…<br>$$<br>找到一个$w^*,b^*$满足$arg\\ max,L(w,b)$最大。</p>\n<h1 id=\"第六章-Deep-learning\"><a href=\"#第六章-Deep-learning\" class=\"headerlink\" title=\"第六章 Deep learning\"></a>第六章 Deep learning</h1><p>历史：</p>\n<p>1958: Perceptron(linear model)</p>\n<p>1980: Multi-layer perceptron</p>\n<p>1986: Backpropagation</p>\n<p>1989: 1 hidden layer is “good enough”</p>\n<p>2006: RBM initialization</p>\n<p>2009: GPU</p>\n<p>2011: Speech recognizition</p>\n<p>步骤：</p>\n<ol>\n<li>找到一个函数-&gt;Neural Network</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>Deep = Many hidden layers</p>\n<h1 id=\"第七章-Backpropagation-反向传播\"><a href=\"#第七章-Backpropagation-反向传播\" class=\"headerlink\" title=\"第七章 Backpropagation 反向传播\"></a>第七章 Backpropagation 反向传播</h1><p>让计算梯度下降法的参数更有效。</p>\n<p>Chain Rule 链式法则：</p>\n<p>Case1：<br>$$<br>y=g(x) \\ \\ \\ \\ z=h(y)<br>\\\\triangle x \\rightarrow \\triangle y\\rightarrow \\triangle z<br>\\ \\frac{dz}{dx}=\\frac{dz}{dy}\\frac{dy}{dx}<br>$$<br>Case2:<br>$$<br>x=g(s) \\ \\ y=h(s) \\ \\ z=k(x,y)<br>\\ \\frac{dz}{ds}=\\frac{\\partial z}{\\partial x}\\frac{dx}{ds}+\\frac{\\partial z}{\\partial y}\\frac{dy}{ds}<br>$$</p>\n<p>Loss function是所有输入经神经网络处理后的输出，与理想输出误差之和。<br>$$<br>L(\\theta)=\\sum_nC(\\theta)<br>$$<br>对Loss function求导：<br>$$<br>\\frac{\\partial L}{\\partial w}=\\sum_n\\frac{\\partial C}{\\partial w}<br>$$<br>只讨论神经网络的一个节点。</p>\n<p><img src=\"https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>$$<br>\\frac{\\partial C}{\\partial w}=\\frac{\\part C}{\\part z}\\frac{\\part z}{\\part w}<br>$$<br>求z对w求导，很简单，对w1求导是x1，对w2求导是x2。</p>\n<p><img src=\"https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>假设第二层神经节点的输入a，是将z通过一个信号函数(signal) $\\sigma(z)$得到的现在求$\\frac{\\part C}{\\part z}$<br>$$<br>\\frac{\\part C}{\\part z}=\\frac{\\part a}{\\part z}\\frac{\\part C}{\\part a}<br>$$<br>利用链式法则，求$\\frac{\\part C}{\\part a}$</p>\n<p>公式见上图。此时，通过反向传递法则。假设红色的信号节点就是神经网络的最后一个节点，对应输出就是神经网络输出。那么可以倒推回去。$\\frac{\\part C}{\\part z^,}$就等于最后的sign函数导数。因此能求得$\\frac{\\part C}{\\part a}$，这样依次反推回去。最终求得每个节点的$\\frac{\\part C}{\\part z}$。从而求得Loss function的导数。</p>\n<h1 id=\"第八章-Tips-for-Deep-Learning\"><a href=\"#第八章-Tips-for-Deep-Learning\" class=\"headerlink\" title=\"第八章 Tips for Deep Learning\"></a>第八章 Tips for Deep Learning</h1><ol>\n<li><p>定义一个方程</p>\n</li>\n<li><p>方程好坏</p>\n</li>\n<li><p>选择最好的方程</p>\n</li>\n<li><p>获得一个Neural Network</p>\n</li>\n<li><p>是否获得一个好的结果在Training Data，如果不好重新选择最好的方程</p>\n</li>\n<li><p>在Testing Data获得不好的结果，overfitting，则重新定义一个方程。</p>\n</li>\n</ol>\n<p><strong>ReLU</strong></p>\n<p>Rectified Linear Unit.矫正线性单元</p>\n<p><img src=\"https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>如果某个节点，输出是零，那么他对最后的结果没有任何影响。所以，输出为零关联的之后节点都可以被拿掉。</p>\n<p><strong>ReLU -variant</strong></p>\n<p>当z小于0时，a=mz。</p>\n<p>Leaky ReLU ：m=0.01</p>\n<p>Parametric: m可变</p>\n<p><strong>Maxout</strong></p>\n<p>最大输出，将不同输入的输出z分组，组内选出最大的值，作为下一个节点输入。</p>\n<p><strong>RMSProp</strong><br>$$<br>w^1 \\leftarrow w^0-\\frac{\\eta}{\\sigma^0}g^0 \\ \\ \\ \\ \\ \\sigma^0=g^0<br>\\<br>w^2 \\leftarrow w^1-\\frac{\\eta}{\\sigma^1}g^1 \\ \\ \\ \\ \\ \\sigma^1=\\sqrt{\\alpha (\\sigma^0)^2+(1-\\alpha)(g^1)^2}<br>\\……<br>$$<br>$\\alpha$可以设置。</p>\n<p><strong>Momentum</strong></p>\n<p>在初始点$\\theta^0$处，加速度方向为gradient方向。</p>\n<p>初始移动距离:$v_0=0$</p>\n<p>加速度(第一点处的gradient):$\\triangledown L(\\theta^0)$</p>\n<p>移动距离:$v^1=\\lambda v^0-\\eta \\triangledown L(\\theta^0)$</p>\n<p>移到第二点:$\\theta^1=\\theta^0+v^1$</p>\n<p>计算第二点的加速度:$\\triangledown L(\\theta^1)$</p>\n<p>下一次移动距离:$v^2=\\lambda v^1-\\eta \\triangledown L(\\theta^1)$</p>\n<p>移动到第三点:$\\theta^2=\\theta^1+v^2$</p>\n<p><strong>Adam</strong>:RMSProp+Momentum</p>\n<p><strong>过拟合问题</strong></p>\n<ol>\n<li>early stop</li>\n</ol>\n<p>通过情况可能出席，当训练集增加时，测试集的正确率反而下降，因此通过减少训练集的数据来达到防止过拟合。</p>\n<ol start=\"2\">\n<li>Regularization</li>\n</ol>\n<p>$$<br>L^,(\\theta)=L(\\theta)+\\lambda \\frac{1}{2}||\\theta||_2<br>$$</p>\n<p>$$<br>||\\theta||_2=(w_1)^2+(w_2)^2+……<br>$$</p>\n<p>$||\\theta||_2$不考虑biases，因为正则化是为了让loss function更加平滑，biases并不会起到作用。</p>\n<p>Loss function求导:<br>$$<br>\\frac{\\partial L^,}{\\partial w}=\\frac{\\partial L}{\\part w}+\\lambda w<br>$$<br>在找下一个<br>$$<br>w^{t+1}\\rightarrow w^t-\\eta\\frac{\\part L^,}{\\part w} =w^t-\\eta(\\frac{\\part L}{\\part w}+\\lambda w^t)=(1-\\eta\\lambda)w^t-\\eta\\frac{\\part L}{\\part w}<br>$$</p>\n<ol start=\"3\">\n<li>Dropout</li>\n</ol>\n<p>在更新参数之前：</p>\n<ul>\n<li>每个节点有p%几率被丢掉</li>\n<li>使用新的网络去训练</li>\n</ul>\n<p>测试时：</p>\n<p>没有丢弃节点</p>\n<ul>\n<li>如果丢弃率为p%，所有的weights times(1-p)%</li>\n</ul>\n<p>可以理解为，在训练时，腿上绑重物，测试时把重物拿掉。</p>\n<p>为什么要乘(1-p)%</p>\n<p><img src=\"https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>假设丢弃率为50%,在训练时一半节点被拿掉，而测试时使用了所有节点，导致节点z相差两倍，在测试时将所有weight乘50%，保证测试时的$z’\\approx z$</p>\n<h1 id=\"第八章-Why-deep\"><a href=\"#第八章-Why-deep\" class=\"headerlink\" title=\"第八章 Why deep\"></a>第八章 Why deep</h1><p>矮胖？高瘦？</p>\n<p>实验数据表明，相同参数情况下，deep的错误率更小。</p>\n<p><strong>Modularization</strong></p>\n<ul>\n<li>Deep-&gt;Modularization</li>\n</ul>\n<p>比如辨别男生长发、男生短发、女生长发、女生长发。</p>\n<p>男生长发的训练集是很少的。</p>\n<p>使用模组化，可以先辨别性别，在辨别头发长短。这样性别和长短发的训练集都是差不多的。这样男生长发也有好的正确率。</p>\n<ul>\n<li>Deep-&gt;Modularization-&gt;Less training data</li>\n</ul>\n<p><strong>Modularization-Speech</strong></p>\n<p>人类语言的架构</p>\n<p>Phoneme:人类发音的音节，</p>\n<p>Tri-phone:不同的组合</p>\n<p>State: 不同的节</p>\n<ul>\n<li>语音识别：</li>\n</ul>\n<p>分类：input-&gt;acoustic feature,output-&gt;state</p>\n<blockquote>\n<p>deep的好处是，可以把复杂的问题，使用很多个简单的function连接在一起。</p>\n</blockquote>\n<h1 id=\"第九章-Pytorch\"><a href=\"#第九章-Pytorch\" class=\"headerlink\" title=\"第九章 Pytorch\"></a>第九章 Pytorch</h1><p>指定设备，迁移到某个设备</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpu = torch.device(<span class=\"string\">&quot;cpu&quot;</span>)</span><br><span class=\"line\">gpu=torch.device(<span class=\"string\">&quot;gpu&quot;</span>)</span><br><span class=\"line\">x= torch.rand(<span class=\"number\">10</span>)</span><br><span class=\"line\">print(x)</span><br><span class=\"line\">x=x.to(gpu)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"第一章-Regression-回归\"><a href=\"#第一章-Regression-回归\" class=\"headerlink\" title=\"第一章 Regression 回归\"></a>第一章 Regression 回归</h1><p>$$<br>f(input)=output<br>$$</p>\n<p>输入一个对象后，有指定的输出结果。</p>\n<p><strong>示例应用：</strong>数码宝贝原始cp值，求进化一次后的cp值</p>\n<p>Step 1: Model</p>\n<p>定义一个函数：确定输入原始cp值和输出进化后的cp值。<br>$$<br>y=b+w*x_{cp}<br>$$</p>\n<blockquote>\n<p>w and b are parameters</p>\n</blockquote>\n<p>Step 2: Goodness of Function方程好坏</p>\n<p>对象1：function input: cp612-&gt;x1      function output:cp979-&gt;y1<br>$$<br>(x^1,y^1)<br>$$</p>\n<p>$$<br>(x^2,y^2)<br>$$</p>\n<p>$$<br>……<br>$$</p>\n<p>$$<br>(x^{10},y^{10})<br>$$</p>\n<p>定义另一个函数：确定第一个函数效果如何。输入一个函数，输出函数好坏程度。</p>\n<p>Loss Function<br>$$<br>\\begin{split}<br>L(f) &amp;= L(w,b)<br>\\ &amp;=\\sum_{n=1}^{10}\\left(y^n-\\left(b+w*x^n_{cp}\\right)\\right)^2<br>\\end{split}<br>$$<br>Step 3: Best Function最好的函数</p>\n<p>Gradient Descent<br>$$<br>w^*=arg\\ min\\ L(w)<br>$$<br>枚举w值，找到Loss Function最小的w值。</p>\n<ul>\n<li><p>随机选择一个初始w0,</p>\n</li>\n<li><p>$$<br>\\frac{dL}{dw}|w=w^0<br>$$</p>\n</li>\n</ul>\n<p>在w0位置，如果斜率为正，则w向小的位置移动，反之向w增大的位置移动，目的是找到L(w)更小的位置。下一个位置w1。<br>$$<br>w^1=w^0-\\eta\\frac{\\partial L}{\\partial w}|w=w^0,b=b^0<br>\\b^1=b^0-\\eta\\frac{\\partial L}{\\partial b}|w=w^0,b=b^0<br>\\\\eta表示学习率。<br>$$<br>最终找到一个最佳的w和b，确定一个L(f)最小。</p>\n<p>然而，由于数码宝贝的物种不同，b和w的取值将不同。</p>\n<p><strong>修改模型</strong></p>\n<p>Step 1:选择模型<br>$$<br>y=b_1<em>\\delta(x^s=宝贝1)+w_1</em>\\delta(x_s=宝贝1)<em>x_{cp}+b_2</em>\\delta(x^s=宝贝2)+w_2*\\delta(x_s=宝贝2)*x_{cp}+……<br>$$</p>\n<p>$$<br>\\delta(x_s=宝贝1)\\begin{cases}<br>=1\\ if,x_s=宝贝1 \\\\<br>=0\\ else\\end{cases}<br>$$</p>\n<p>此时已经很精准了，但是可能还存在其他除了种类以外的影响因素，比如身高，体重，hp。</p>\n<p>回到Step 2:Regularization<br>$$<br>y=b+\\sum w_ix_i<br>\\L=\\sum_n(y^n-(b+\\sum w_ix_i))^2+\\lambda\\sum (w_i)^2<br>$$<br>为了获取一个更光滑的曲线，来减少噪音对输出结果的影响。</p>\n<blockquote>\n<p><strong>采用较小的拟合次数简单的model，通常具有更小的方差，但偏差更大，即结果集中但集中位置偏离真实值；较大的拟合次数复杂的model，方差比较大，但偏差更小。</strong></p>\n</blockquote>\n<p>偏差大：</p>\n<ol>\n<li>更多训练数据</li>\n<li>更复杂的模型</li>\n</ol>\n<p>方差大：</p>\n<ol>\n<li>更多训练数据</li>\n</ol>\n<p>获取模型：Validation</p>\n<p>训练数据-&gt;分三份，两份获取模型，一份验证模型。</p>\n<h1 id=\"第二章-Gradient-Descent梯度下降法\"><a href=\"#第二章-Gradient-Descent梯度下降法\" class=\"headerlink\" title=\"第二章 Gradient Descent梯度下降法\"></a>第二章 Gradient Descent梯度下降法</h1><p>在第一章Step 3中，我们要找到一个最低的loss function<br>$$<br>\\theta^*=arg\\ max\\ L(\\theta) \\ \\ \\ \\ L:loss\\ function\\ \\ \\theta:parameters<br>$$<br>假设$\\theta$有两个参数${\\theta_1,\\theta_2}$</p>\n<p>随机设置一个$\\theta^0=\\begin{bmatrix}\\theta_1^0\\\\theta_2^0\\end{bmatrix}$<br>$$<br>\\begin{bmatrix}\\theta_1^1\\\\theta_2^1\\end{bmatrix}=\\begin{bmatrix}\\theta_1^0\\\\theta^0_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^0)}{\\partial\\theta_1}\\\\frac{\\partial(\\theta_2^0)}{\\partial\\theta_2}\\end{bmatrix}<br>$$</p>\n<p>$$<br>\\begin{bmatrix}\\theta_1^2\\\\theta_2^2\\end{bmatrix}=\\begin{bmatrix}\\theta_1^1\\\\theta^1_2\\end{bmatrix}-\\eta\\begin{bmatrix}\\frac{\\partial(\\theta_1^1)}{\\partial\\theta_1}\\\\frac{\\partial(\\theta_2^1)}{\\partial\\theta_2}\\end{bmatrix}<br>$$</p>\n<p>简化公式：<br>$$<br>\\bigtriangledown L(\\theta)=\\begin{bmatrix}\\frac{\\partial L(\\theta_1)}{\\partial\\theta_1}\\\\frac{\\partial L(\\theta_2)}{\\partial\\theta_2}\\end{bmatrix}<br>\\\\theta^1=\\theta^0-\\eta\\bigtriangledown L(\\theta^0)<br>$$<br>需要调节学习率（步长）$\\eta$到合适的值。</p>\n<blockquote>\n<p>不同的$\\theta$给不同的$\\eta$。</p>\n</blockquote>\n<p>Adagrad:随着参数增加，步长逐渐减小。<br>$$<br>w^1\\gets w^1-\\frac{\\eta^0}{\\sigma^0}g^0 \\ \\ \\ \\sigma^0=\\sqrt{(g^0)^2}<br>\\\\vdots<br>\\\\vdots<br>\\w^{t+1}\\gets w^t-\\frac{\\eta^t}{\\sigma^t}g^t\\ \\ \\ \\sigma^t=\\sqrt{\\frac{1}{t+1}\\sum^t_{i=0}(g^i)^2}<br>$$</p>\n<p>$$<br>\\eta^t=\\frac{\\eta}{\\sqrt{t+1}}<br>$$</p>\n<p>Feature Scaling:</p>\n<p>将多个x输入的范围统一到一个范围，以保证在计算L(f)时，每个w对L(f)的影响相同。</p>\n<blockquote>\n<p>Gradient Descent会卡在局部最小值的位置</p>\n</blockquote>\n<h1 id=\"第三章-New-Optimizers-for-Deep-Learning-优化\"><a href=\"#第三章-New-Optimizers-for-Deep-Learning-优化\" class=\"headerlink\" title=\"第三章 New Optimizers for Deep Learning 优化\"></a>第三章 New Optimizers for Deep Learning 优化</h1><p>一些记号：</p>\n<p>$\\theta_t$:模型参数</p>\n<p>$m_{t+1}$:从step 0到step t 的动量。</p>\n<p><strong>SGD：</strong></p>\n<p>SGDM、Learning rate scheduling、NAG</p>\n<p>走到最低点时，还不会停下来，由于之前的动量影响，存在一个类似的惯性作用，会继续向上爬坡。</p>\n<p><strong>Adam：</strong></p>\n<p>Adagrad、RMSProp、AMSGrad、AdaBound、RAdam、Nadam、AdamW</p>\n<p>SGD+Adam-&gt;SWATS</p>\n<p><strong>Lookahead</strong></p>\n<h1 id=\"第四章-Classification-分类\"><a href=\"#第四章-Classification-分类\" class=\"headerlink\" title=\"第四章 Classification 分类\"></a>第四章 Classification 分类</h1><p>例：投简历</p>\n<ul>\n<li>输入：收入、存款、专业、年纪</li>\n<li>输出：录取或拒绝</li>\n</ul>\n<p>模型：<br>$$<br>x\\rightarrow f(x)\\begin{cases}g(x)&gt;0\\ &amp;Output=class1\\else \\ \\ &amp;Output=class2\\end{cases}<br>$$<br>Loss function：<br>$$<br>L(f)=\\sum_n\\delta(f(x^n)\\ne y^n)<br>$$<br>79个水系（C1）宝可梦，61只普通系（C2）的宝可梦</p>\n<p>$P(x|C_1)$的可能性。</p>\n<p>$P(x|C_1)$满足高斯分布（正态分布），找到最合适的高速分布系数$\\mu$和$E$</p>\n<p>使用贝叶斯公式，求测试数据$P(C_1|x)$的概率。</p>\n<p>所以：</p>\n<p>模型<br>$$<br>x\\rightarrow P(C_1|x)=\\frac{P(x|C_1)P(C_1)}{P(x|C_1)P(C_1)+P(x|C_2)P(C_2)}<br>$$<br>函数的好坏：</p>\n<p>平均值$\\mu$和$E$。</p>\n<p>一堆数学运算……</p>\n<p>模型：<br>$$<br>P_{w,b}(C_2|x)=\\sigma(z)<br>\\<br>\\sigma(z)=\\frac{1}{1+exp(-z)}<br>\\<br>z=w*x+b<br>$$</p>\n<h1 id=\"第五章-Logistic-Regression\"><a href=\"#第五章-Logistic-Regression\" class=\"headerlink\" title=\"第五章 Logistic Regression\"></a>第五章 Logistic Regression</h1><p>$$<br>f_{w,b}(x)=\\sigma(\\sum w_ix+b)<br>$$<br>$x_1$属于$C_1$,$x_2$属于$C_1$,$x_3$属于$C_2$……<br>$$<br>L(w,b)=f_{w,b}(x^1)f_{w,b}(x^2)(1-f_{w,b}(x^3))…<br>$$<br>找到一个$w^*,b^*$满足$arg\\ max,L(w,b)$最大。</p>\n<h1 id=\"第六章-Deep-learning\"><a href=\"#第六章-Deep-learning\" class=\"headerlink\" title=\"第六章 Deep learning\"></a>第六章 Deep learning</h1><p>历史：</p>\n<p>1958: Perceptron(linear model)</p>\n<p>1980: Multi-layer perceptron</p>\n<p>1986: Backpropagation</p>\n<p>1989: 1 hidden layer is “good enough”</p>\n<p>2006: RBM initialization</p>\n<p>2009: GPU</p>\n<p>2011: Speech recognizition</p>\n<p>步骤：</p>\n<ol>\n<li>找到一个函数-&gt;Neural Network</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg\"></p>\n<p>Deep = Many hidden layers</p>\n<h1 id=\"第七章-Backpropagation-反向传播\"><a href=\"#第七章-Backpropagation-反向传播\" class=\"headerlink\" title=\"第七章 Backpropagation 反向传播\"></a>第七章 Backpropagation 反向传播</h1><p>让计算梯度下降法的参数更有效。</p>\n<p>Chain Rule 链式法则：</p>\n<p>Case1：<br>$$<br>y=g(x) \\ \\ \\ \\ z=h(y)<br>\\\\triangle x \\rightarrow \\triangle y\\rightarrow \\triangle z<br>\\ \\frac{dz}{dx}=\\frac{dz}{dy}\\frac{dy}{dx}<br>$$<br>Case2:<br>$$<br>x=g(s) \\ \\ y=h(s) \\ \\ z=k(x,y)<br>\\ \\frac{dz}{ds}=\\frac{\\partial z}{\\partial x}\\frac{dx}{ds}+\\frac{\\partial z}{\\partial y}\\frac{dy}{ds}<br>$$</p>\n<p>Loss function是所有输入经神经网络处理后的输出，与理想输出误差之和。<br>$$<br>L(\\theta)=\\sum_nC(\\theta)<br>$$<br>对Loss function求导：<br>$$<br>\\frac{\\partial L}{\\partial w}=\\sum_n\\frac{\\partial C}{\\partial w}<br>$$<br>只讨论神经网络的一个节点。</p>\n<p><img src=\"https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png\"></p>\n<p>$$<br>\\frac{\\partial C}{\\partial w}=\\frac{\\part C}{\\part z}\\frac{\\part z}{\\part w}<br>$$<br>求z对w求导，很简单，对w1求导是x1，对w2求导是x2。</p>\n<p><img src=\"https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png\"></p>\n<p>假设第二层神经节点的输入a，是将z通过一个信号函数(signal) $\\sigma(z)$得到的现在求$\\frac{\\part C}{\\part z}$<br>$$<br>\\frac{\\part C}{\\part z}=\\frac{\\part a}{\\part z}\\frac{\\part C}{\\part a}<br>$$<br>利用链式法则，求$\\frac{\\part C}{\\part a}$</p>\n<p>公式见上图。此时，通过反向传递法则。假设红色的信号节点就是神经网络的最后一个节点，对应输出就是神经网络输出。那么可以倒推回去。$\\frac{\\part C}{\\part z^,}$就等于最后的sign函数导数。因此能求得$\\frac{\\part C}{\\part a}$，这样依次反推回去。最终求得每个节点的$\\frac{\\part C}{\\part z}$。从而求得Loss function的导数。</p>\n<h1 id=\"第八章-Tips-for-Deep-Learning\"><a href=\"#第八章-Tips-for-Deep-Learning\" class=\"headerlink\" title=\"第八章 Tips for Deep Learning\"></a>第八章 Tips for Deep Learning</h1><ol>\n<li><p>定义一个方程</p>\n</li>\n<li><p>方程好坏</p>\n</li>\n<li><p>选择最好的方程</p>\n</li>\n<li><p>获得一个Neural Network</p>\n</li>\n<li><p>是否获得一个好的结果在Training Data，如果不好重新选择最好的方程</p>\n</li>\n<li><p>在Testing Data获得不好的结果，overfitting，则重新定义一个方程。</p>\n</li>\n</ol>\n<p><strong>ReLU</strong></p>\n<p>Rectified Linear Unit.矫正线性单元</p>\n<p><img src=\"https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png\"></p>\n<p>如果某个节点，输出是零，那么他对最后的结果没有任何影响。所以，输出为零关联的之后节点都可以被拿掉。</p>\n<p><strong>ReLU -variant</strong></p>\n<p>当z小于0时，a=mz。</p>\n<p>Leaky ReLU ：m=0.01</p>\n<p>Parametric: m可变</p>\n<p><strong>Maxout</strong></p>\n<p>最大输出，将不同输入的输出z分组，组内选出最大的值，作为下一个节点输入。</p>\n<p><strong>RMSProp</strong><br>$$<br>w^1 \\leftarrow w^0-\\frac{\\eta}{\\sigma^0}g^0 \\ \\ \\ \\ \\ \\sigma^0=g^0<br>\\<br>w^2 \\leftarrow w^1-\\frac{\\eta}{\\sigma^1}g^1 \\ \\ \\ \\ \\ \\sigma^1=\\sqrt{\\alpha (\\sigma^0)^2+(1-\\alpha)(g^1)^2}<br>\\……<br>$$<br>$\\alpha$可以设置。</p>\n<p><strong>Momentum</strong></p>\n<p>在初始点$\\theta^0$处，加速度方向为gradient方向。</p>\n<p>初始移动距离:$v_0=0$</p>\n<p>加速度(第一点处的gradient):$\\triangledown L(\\theta^0)$</p>\n<p>移动距离:$v^1=\\lambda v^0-\\eta \\triangledown L(\\theta^0)$</p>\n<p>移到第二点:$\\theta^1=\\theta^0+v^1$</p>\n<p>计算第二点的加速度:$\\triangledown L(\\theta^1)$</p>\n<p>下一次移动距离:$v^2=\\lambda v^1-\\eta \\triangledown L(\\theta^1)$</p>\n<p>移动到第三点:$\\theta^2=\\theta^1+v^2$</p>\n<p><strong>Adam</strong>:RMSProp+Momentum</p>\n<p><strong>过拟合问题</strong></p>\n<ol>\n<li>early stop</li>\n</ol>\n<p>通过情况可能出席，当训练集增加时，测试集的正确率反而下降，因此通过减少训练集的数据来达到防止过拟合。</p>\n<ol start=\"2\">\n<li>Regularization</li>\n</ol>\n<p>$$<br>L^,(\\theta)=L(\\theta)+\\lambda \\frac{1}{2}||\\theta||_2<br>$$</p>\n<p>$$<br>||\\theta||_2=(w_1)^2+(w_2)^2+……<br>$$</p>\n<p>$||\\theta||_2$不考虑biases，因为正则化是为了让loss function更加平滑，biases并不会起到作用。</p>\n<p>Loss function求导:<br>$$<br>\\frac{\\partial L^,}{\\partial w}=\\frac{\\partial L}{\\part w}+\\lambda w<br>$$<br>在找下一个<br>$$<br>w^{t+1}\\rightarrow w^t-\\eta\\frac{\\part L^,}{\\part w} =w^t-\\eta(\\frac{\\part L}{\\part w}+\\lambda w^t)=(1-\\eta\\lambda)w^t-\\eta\\frac{\\part L}{\\part w}<br>$$</p>\n<ol start=\"3\">\n<li>Dropout</li>\n</ol>\n<p>在更新参数之前：</p>\n<ul>\n<li>每个节点有p%几率被丢掉</li>\n<li>使用新的网络去训练</li>\n</ul>\n<p>测试时：</p>\n<p>没有丢弃节点</p>\n<ul>\n<li>如果丢弃率为p%，所有的weights times(1-p)%</li>\n</ul>\n<p>可以理解为，在训练时，腿上绑重物，测试时把重物拿掉。</p>\n<p>为什么要乘(1-p)%</p>\n<p><img src=\"https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png\"></p>\n<p>假设丢弃率为50%,在训练时一半节点被拿掉，而测试时使用了所有节点，导致节点z相差两倍，在测试时将所有weight乘50%，保证测试时的$z’\\approx z$</p>\n<h1 id=\"第八章-Why-deep\"><a href=\"#第八章-Why-deep\" class=\"headerlink\" title=\"第八章 Why deep\"></a>第八章 Why deep</h1><p>矮胖？高瘦？</p>\n<p>实验数据表明，相同参数情况下，deep的错误率更小。</p>\n<p><strong>Modularization</strong></p>\n<ul>\n<li>Deep-&gt;Modularization</li>\n</ul>\n<p>比如辨别男生长发、男生短发、女生长发、女生长发。</p>\n<p>男生长发的训练集是很少的。</p>\n<p>使用模组化，可以先辨别性别，在辨别头发长短。这样性别和长短发的训练集都是差不多的。这样男生长发也有好的正确率。</p>\n<ul>\n<li>Deep-&gt;Modularization-&gt;Less training data</li>\n</ul>\n<p><strong>Modularization-Speech</strong></p>\n<p>人类语言的架构</p>\n<p>Phoneme:人类发音的音节，</p>\n<p>Tri-phone:不同的组合</p>\n<p>State: 不同的节</p>\n<ul>\n<li>语音识别：</li>\n</ul>\n<p>分类：input-&gt;acoustic feature,output-&gt;state</p>\n<blockquote>\n<p>deep的好处是，可以把复杂的问题，使用很多个简单的function连接在一起。</p>\n</blockquote>\n<h1 id=\"第九章-Pytorch\"><a href=\"#第九章-Pytorch\" class=\"headerlink\" title=\"第九章 Pytorch\"></a>第九章 Pytorch</h1><p>指定设备，迁移到某个设备</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpu = torch.device(<span class=\"string\">&quot;cpu&quot;</span>)</span><br><span class=\"line\">gpu=torch.device(<span class=\"string\">&quot;gpu&quot;</span>)</span><br><span class=\"line\">x= torch.rand(<span class=\"number\">10</span>)</span><br><span class=\"line\">print(x)</span><br><span class=\"line\">x=x.to(gpu)</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg","popularPost_tmp_gaData":{"updated":"Sun Jun 21 2020 10:39:24 GMT+0200 (GMT+02:00)","title":"机器学习深度学习李宏毅版-学习笔记","path":"2020/05/21/机器学习深度学习-学习笔记/","eyeCatchImage":"https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-05-21T15:02:29.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-05-21T15:02:29.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["机器学习"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"树莓派4B无网线无显示器出发","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-08-28T20:22:40.000Z","password":null,"summary":null,"_content":"\n从亚马逊新入手了最新款树莓派4B以及相关配件，花了一共109欧。这是第一次把玩树莓派。因为长期浸淫于Linux系统，而受制于surface的小容量硬盘，实在不忍心在电脑上安装一个虚拟机了。之前把玩Linux也是购买的云服务器，但是云服务器是个消耗品啊，而且毕竟是外网，要操做内网设备，比如打印机，就得内网穿透，还是得依赖一个在内网能够长期在线得设备，那么树莓派的作用就不言而喻了。\n\n树莓派自带GPIO这一点，可玩性也非常高。现在开始安装树莓派系统。\n\n# 一：准备工作\n\n## 1.1 硬件准备\n\n- 树莓派4B及其电源设备\n- 8G及以上内存卡\n- 笔记本电脑一台\n- WIFI网络，使用手机热点或者WIFI\n\n## 1.2 软件准备\n\n- SSH连接工具，比如Xshell、Putty。Putty下载，[点击下载](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)\n- Windows 下安装镜像的工具 win32diskimager，[本地下载](http://file.ncnynl.com/rpi/Win32DiskImager-0.9.5-install.exe) [官网下载](https://sourceforge.net/projects/win32diskimager/)\n- 树莓派系统镜像文件，下载地址：https://shumeipai.nxez.com/download \n\n- 如果需要图形桌面，就下载VNC Viewer，[点击下载](https://www.realvnc.com/en/connect/download/viewer/)\n\n# 二：安装系统\n\n下载树莓派镜像后，解压为.ios后缀的文件。然后利用win32diskimager烧录到SD卡中。[点击查看详细教程](https://www.ncnynl.com/archives/201606/201.html)\n\n打开SD卡，在根目录下新建文件名为`ssh`无后缀名空文件。\n\n在根目录下新建文件名为`wpa_supplicant.conf`的文件，文件内容为\n\n```shell\ncountry=GB\nctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\nupdate_config=1\nnetwork={\n    ssid=\"spzmi8\"\n    psk=\"yatoummd233\"\n}\n\n```\n\n> ssid：wifi名称\n>\n> psk：wifi密码\n\n将SD卡插入树莓派。\n\n# 三：登陆树莓派\n\n将树莓派接通电源，打开ssh软件入putty或者xshell。之后即可登陆树莓派。\n\n使用以下信息登陆树莓派\n\n| 主机名            | 用户名 | 密码      | 端口 |\n| ----------------- | ------ | --------- | ---- |\n| raspberrypi.local | pi     | raspberry | 22   |\n\n至此树莓派已连接成功。\n\n# 四：参考资料\n\n《[无显示器、路由器、网线安装树莓派系统](https://www.jianshu.com/p/f2710991057e)》\n\n《[树莓派3B+无显示器配置详细教程](https://blog.csdn.net/Jack_Lue/article/details/82912327)》\n\n《[树莓派3-系统安装-Windows下利用Win32DiskImager进行系统安装](https://www.ncnynl.com/archives/201606/201.html)》","source":"_posts/树莓派4B无网线无显示器出发.md","raw":"---\ntitle: 树莓派4B无网线无显示器出发\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-08-28 22:22:40\npassword:\nsummary:\ntags: \n- 树莓派\n- Linux\ncategories: 树莓派\n---\n\n从亚马逊新入手了最新款树莓派4B以及相关配件，花了一共109欧。这是第一次把玩树莓派。因为长期浸淫于Linux系统，而受制于surface的小容量硬盘，实在不忍心在电脑上安装一个虚拟机了。之前把玩Linux也是购买的云服务器，但是云服务器是个消耗品啊，而且毕竟是外网，要操做内网设备，比如打印机，就得内网穿透，还是得依赖一个在内网能够长期在线得设备，那么树莓派的作用就不言而喻了。\n\n树莓派自带GPIO这一点，可玩性也非常高。现在开始安装树莓派系统。\n\n# 一：准备工作\n\n## 1.1 硬件准备\n\n- 树莓派4B及其电源设备\n- 8G及以上内存卡\n- 笔记本电脑一台\n- WIFI网络，使用手机热点或者WIFI\n\n## 1.2 软件准备\n\n- SSH连接工具，比如Xshell、Putty。Putty下载，[点击下载](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)\n- Windows 下安装镜像的工具 win32diskimager，[本地下载](http://file.ncnynl.com/rpi/Win32DiskImager-0.9.5-install.exe) [官网下载](https://sourceforge.net/projects/win32diskimager/)\n- 树莓派系统镜像文件，下载地址：https://shumeipai.nxez.com/download \n\n- 如果需要图形桌面，就下载VNC Viewer，[点击下载](https://www.realvnc.com/en/connect/download/viewer/)\n\n# 二：安装系统\n\n下载树莓派镜像后，解压为.ios后缀的文件。然后利用win32diskimager烧录到SD卡中。[点击查看详细教程](https://www.ncnynl.com/archives/201606/201.html)\n\n打开SD卡，在根目录下新建文件名为`ssh`无后缀名空文件。\n\n在根目录下新建文件名为`wpa_supplicant.conf`的文件，文件内容为\n\n```shell\ncountry=GB\nctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\nupdate_config=1\nnetwork={\n    ssid=\"spzmi8\"\n    psk=\"yatoummd233\"\n}\n\n```\n\n> ssid：wifi名称\n>\n> psk：wifi密码\n\n将SD卡插入树莓派。\n\n# 三：登陆树莓派\n\n将树莓派接通电源，打开ssh软件入putty或者xshell。之后即可登陆树莓派。\n\n使用以下信息登陆树莓派\n\n| 主机名            | 用户名 | 密码      | 端口 |\n| ----------------- | ------ | --------- | ---- |\n| raspberrypi.local | pi     | raspberry | 22   |\n\n至此树莓派已连接成功。\n\n# 四：参考资料\n\n《[无显示器、路由器、网线安装树莓派系统](https://www.jianshu.com/p/f2710991057e)》\n\n《[树莓派3B+无显示器配置详细教程](https://blog.csdn.net/Jack_Lue/article/details/82912327)》\n\n《[树莓派3-系统安装-Windows下利用Win32DiskImager进行系统安装](https://www.ncnynl.com/archives/201606/201.html)》","slug":"树莓派4B无网线无显示器出发","published":1,"updated":"2020-08-28T20:54:19.259Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacl0035p0vz08vng2dk","content":"<p>从亚马逊新入手了最新款树莓派4B以及相关配件，花了一共109欧。这是第一次把玩树莓派。因为长期浸淫于Linux系统，而受制于surface的小容量硬盘，实在不忍心在电脑上安装一个虚拟机了。之前把玩Linux也是购买的云服务器，但是云服务器是个消耗品啊，而且毕竟是外网，要操做内网设备，比如打印机，就得内网穿透，还是得依赖一个在内网能够长期在线得设备，那么树莓派的作用就不言而喻了。</p>\n<p>树莓派自带GPIO这一点，可玩性也非常高。现在开始安装树莓派系统。</p>\n<h1 id=\"一：准备工作\"><a href=\"#一：准备工作\" class=\"headerlink\" title=\"一：准备工作\"></a>一：准备工作</h1><h2 id=\"1-1-硬件准备\"><a href=\"#1-1-硬件准备\" class=\"headerlink\" title=\"1.1 硬件准备\"></a>1.1 硬件准备</h2><ul>\n<li>树莓派4B及其电源设备</li>\n<li>8G及以上内存卡</li>\n<li>笔记本电脑一台</li>\n<li>WIFI网络，使用手机热点或者WIFI</li>\n</ul>\n<h2 id=\"1-2-软件准备\"><a href=\"#1-2-软件准备\" class=\"headerlink\" title=\"1.2 软件准备\"></a>1.2 软件准备</h2><ul>\n<li><p>SSH连接工具，比如Xshell、Putty。Putty下载，<a href=\"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html\">点击下载</a></p>\n</li>\n<li><p>Windows 下安装镜像的工具 win32diskimager，<a href=\"http://file.ncnynl.com/rpi/Win32DiskImager-0.9.5-install.exe\">本地下载</a> <a href=\"https://sourceforge.net/projects/win32diskimager/\">官网下载</a></p>\n</li>\n<li><p>树莓派系统镜像文件，下载地址：<a href=\"https://shumeipai.nxez.com/download\">https://shumeipai.nxez.com/download</a> </p>\n</li>\n<li><p>如果需要图形桌面，就下载VNC Viewer，<a href=\"https://www.realvnc.com/en/connect/download/viewer/\">点击下载</a></p>\n</li>\n</ul>\n<h1 id=\"二：安装系统\"><a href=\"#二：安装系统\" class=\"headerlink\" title=\"二：安装系统\"></a>二：安装系统</h1><p>下载树莓派镜像后，解压为.ios后缀的文件。然后利用win32diskimager烧录到SD卡中。<a href=\"https://www.ncnynl.com/archives/201606/201.html\">点击查看详细教程</a></p>\n<p>打开SD卡，在根目录下新建文件名为<code>ssh</code>无后缀名空文件。</p>\n<p>在根目录下新建文件名为<code>wpa_supplicant.conf</code>的文件，文件内容为</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">country=GB</span><br><span class=\"line\">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class=\"line\">update_config=1</span><br><span class=\"line\">network=&#123;</span><br><span class=\"line\">    ssid=&quot;spzmi8&quot;</span><br><span class=\"line\">    psk=&quot;yatoummd233&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ssid：wifi名称</p>\n<p>psk：wifi密码</p>\n</blockquote>\n<p>将SD卡插入树莓派。</p>\n<h1 id=\"三：登陆树莓派\"><a href=\"#三：登陆树莓派\" class=\"headerlink\" title=\"三：登陆树莓派\"></a>三：登陆树莓派</h1><p>将树莓派接通电源，打开ssh软件入putty或者xshell。之后即可登陆树莓派。</p>\n<p>使用以下信息登陆树莓派</p>\n<table>\n<thead>\n<tr>\n<th>主机名</th>\n<th>用户名</th>\n<th>密码</th>\n<th>端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>raspberrypi.local</td>\n<td>pi</td>\n<td>raspberry</td>\n<td>22</td>\n</tr>\n</tbody></table>\n<p>至此树莓派已连接成功。</p>\n<h1 id=\"四：参考资料\"><a href=\"#四：参考资料\" class=\"headerlink\" title=\"四：参考资料\"></a>四：参考资料</h1><p>《<a href=\"https://www.jianshu.com/p/f2710991057e\">无显示器、路由器、网线安装树莓派系统</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/Jack_Lue/article/details/82912327\">树莓派3B+无显示器配置详细教程</a>》</p>\n<p>《<a href=\"https://www.ncnynl.com/archives/201606/201.html\">树莓派3-系统安装-Windows下利用Win32DiskImager进行系统安装</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>从亚马逊新入手了最新款树莓派4B以及相关配件，花了一共109欧。这是第一次把玩树莓派。因为长期浸淫于Linux系统，而受制于surface的小容量硬盘，实在不忍心在电脑上安装一个虚拟机了。之前把玩Linux也是购买的云服务器，但是云服务器是个消耗品啊，而且毕竟是外网，要操做内网设备，比如打印机，就得内网穿透，还是得依赖一个在内网能够长期在线得设备，那么树莓派的作用就不言而喻了。</p>\n<p>树莓派自带GPIO这一点，可玩性也非常高。现在开始安装树莓派系统。</p>\n<h1 id=\"一：准备工作\"><a href=\"#一：准备工作\" class=\"headerlink\" title=\"一：准备工作\"></a>一：准备工作</h1><h2 id=\"1-1-硬件准备\"><a href=\"#1-1-硬件准备\" class=\"headerlink\" title=\"1.1 硬件准备\"></a>1.1 硬件准备</h2><ul>\n<li>树莓派4B及其电源设备</li>\n<li>8G及以上内存卡</li>\n<li>笔记本电脑一台</li>\n<li>WIFI网络，使用手机热点或者WIFI</li>\n</ul>\n<h2 id=\"1-2-软件准备\"><a href=\"#1-2-软件准备\" class=\"headerlink\" title=\"1.2 软件准备\"></a>1.2 软件准备</h2><ul>\n<li><p>SSH连接工具，比如Xshell、Putty。Putty下载，<a href=\"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html\">点击下载</a></p>\n</li>\n<li><p>Windows 下安装镜像的工具 win32diskimager，<a href=\"http://file.ncnynl.com/rpi/Win32DiskImager-0.9.5-install.exe\">本地下载</a> <a href=\"https://sourceforge.net/projects/win32diskimager/\">官网下载</a></p>\n</li>\n<li><p>树莓派系统镜像文件，下载地址：<a href=\"https://shumeipai.nxez.com/download\">https://shumeipai.nxez.com/download</a> </p>\n</li>\n<li><p>如果需要图形桌面，就下载VNC Viewer，<a href=\"https://www.realvnc.com/en/connect/download/viewer/\">点击下载</a></p>\n</li>\n</ul>\n<h1 id=\"二：安装系统\"><a href=\"#二：安装系统\" class=\"headerlink\" title=\"二：安装系统\"></a>二：安装系统</h1><p>下载树莓派镜像后，解压为.ios后缀的文件。然后利用win32diskimager烧录到SD卡中。<a href=\"https://www.ncnynl.com/archives/201606/201.html\">点击查看详细教程</a></p>\n<p>打开SD卡，在根目录下新建文件名为<code>ssh</code>无后缀名空文件。</p>\n<p>在根目录下新建文件名为<code>wpa_supplicant.conf</code>的文件，文件内容为</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">country=GB</span><br><span class=\"line\">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class=\"line\">update_config=1</span><br><span class=\"line\">network=&#123;</span><br><span class=\"line\">    ssid=&quot;spzmi8&quot;</span><br><span class=\"line\">    psk=&quot;yatoummd233&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ssid：wifi名称</p>\n<p>psk：wifi密码</p>\n</blockquote>\n<p>将SD卡插入树莓派。</p>\n<h1 id=\"三：登陆树莓派\"><a href=\"#三：登陆树莓派\" class=\"headerlink\" title=\"三：登陆树莓派\"></a>三：登陆树莓派</h1><p>将树莓派接通电源，打开ssh软件入putty或者xshell。之后即可登陆树莓派。</p>\n<p>使用以下信息登陆树莓派</p>\n<table>\n<thead>\n<tr>\n<th>主机名</th>\n<th>用户名</th>\n<th>密码</th>\n<th>端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>raspberrypi.local</td>\n<td>pi</td>\n<td>raspberry</td>\n<td>22</td>\n</tr>\n</tbody></table>\n<p>至此树莓派已连接成功。</p>\n<h1 id=\"四：参考资料\"><a href=\"#四：参考资料\" class=\"headerlink\" title=\"四：参考资料\"></a>四：参考资料</h1><p>《<a href=\"https://www.jianshu.com/p/f2710991057e\">无显示器、路由器、网线安装树莓派系统</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/Jack_Lue/article/details/82912327\">树莓派3B+无显示器配置详细教程</a>》</p>\n<p>《<a href=\"https://www.ncnynl.com/archives/201606/201.html\">树莓派3-系统安装-Windows下利用Win32DiskImager进行系统安装</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Fri Aug 28 2020 22:54:19 GMT+0200 (GMT+02:00)","title":"树莓派4B无网线无显示器出发","path":"2020/08/28/树莓派4B无网线无显示器出发/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-08-28T20:22:40.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-08-28T20:22:40.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"树莓派","tags":["Linux","树莓派"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"正则表达式","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-30T06:16:08.000Z","password":null,"summary":null,"_content":"\n# 1：简介\n\n正则表达式，常用于匹配包含一定规律的字符串，可以从字符串中提取符合规律的字符串段，或者返回是否符合要求。也可用于替换字符串。\n\n比如，我们设置密码时，网站通常要求，密码为字母+数字+下划线组合，并且具有一定长度如3到15位，那么它的正则表达式可以是，`^[a-z0-9_-]{3-15}$`\n\n其中`^`表示从开头开始匹配，`[a-z0-9_-]`表示匹配字母，数字，下划线和连接符，`$`表示匹配结束。`{3-15}`表示匹配3到15个字符。完整意义：从开头开始匹配，匹配包括字母数字下划线和连接符，总共15个字符。\n\n# 2：语法\n\n`*`表示匹配0个或多个字符。**qife*i**可以匹配：qifei, qifi,qifeeeei\n\n`?`表示匹配0个或1个字符。qife?i可以匹配：qifi, qifei\n\n`+ `匹配一个或者多个字符。qife+i可以匹配：qifei,qifeeeei\n\n`[]`单字符满足[]中的要求，则匹配。`[aui]*`表示字符串中aui都会被匹配出来\n\n| 字符   | 描述                                                         |\n| :----- | :----------------------------------------------------------- |\n| [ABC]  | 匹配 **[...]** 中的所有字符，例如 **[aeiou]** 匹配字符串 \"google runoob taobao\" 中所有的 e o u a 字母。 |\n| [^ABC] | 匹配除了 **[...]** 中字符的所有字符，例如 **[^aeiou]** 匹配字符串 \"google runoob taobao\" 中除了 e o u a 字母的所有字母。 |\n| [A-Z]  | [A-Z] 表示一个区间，匹配所有大写字母，[a-z] 表示所有小写字母。 |\n| .      | 匹配除换行符（\\n、\\r）之外的任何单个字符，相等于 [^\\n\\r]     |\n| [\\s\\S] | 匹配所有。\\s 是匹配所有空白符，包括换行，\\S 非空白符，包括换行。 |\n| \\w     | 匹配字母、数字、下划线。等价于 [A-Za-z0-9_]                  |\n\n| 特别字符 | 描述                                                         |\n| :------- | :----------------------------------------------------------- |\n| $        | 匹配输入字符串的结尾位置。如果设置了 RegExp 对象的 Multiline 属性，则 $ 也匹配 '\\n' 或 '\\r'。要匹配 $ 字符本身，请使用 \\$。 |\n| ( )      | 标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 \\( 和 \\)。 |\n| *        | 匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 \\*。     |\n| +        | 匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 \\+。     |\n| .        | 匹配除换行符 \\n 之外的任何单字符。要匹配 . ，请使用 \\. 。    |\n| [        | 标记一个中括号表达式的开始。要匹配 [，请使用 \\[。            |\n| ?        | 匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 \\?。 |\n| \\        | 将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， 'n' 匹配字符 'n'。'\\n' 匹配换行符。序列 '\\\\' 匹配 \"\\\"，而 '\\(' 则匹配 \"(\"。 |\n| ^        | 匹配输入字符串的开始位置，除非在方括号表达式中使用，当该符号在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合。要匹配 ^ 字符本身，请使用 \\^。 |\n| {        | 标记限定符表达式的开始。要匹配 {，请使用 \\{。                |\n| \\|       | 指明两项之间的一个选择。要匹配 \\|，请使用 \\|。               |\n\n`()`选择：使用`()`给需要选择到的匹配项分组，选择项，可使用列表索引获取每个选择项，匹配的值。\n\n# 3：元字符\n\n| 字符         | 描述                                                         |\n| :----------- | :----------------------------------------------------------- |\n| \\            | 将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，'n' 匹配字符 \"n\"。'\\n' 匹配一个换行符。序列 '\\\\' 匹配 \"\\\" 而 \"\\(\" 则匹配 \"(\"。 |\n| ^            | 匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 '\\n' 或 '\\r' 之后的位置。 |\n| $            | 匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 '\\n' 或 '\\r' 之前的位置。 |\n| *            | 匹配前面的子表达式零次或多次。例如，zo* 能匹配 \"z\" 以及 \"zoo\"。* 等价于{0,}。 |\n| +            | 匹配前面的子表达式一次或多次。例如，'zo+' 能匹配 \"zo\" 以及 \"zoo\"，但不能匹配 \"z\"。+ 等价于 {1,}。 |\n| ?            | 匹配前面的子表达式零次或一次。例如，\"do(es)?\" 可以匹配 \"do\" 或 \"does\" 。? 等价于 {0,1}。 |\n| {n}          | n 是一个非负整数。匹配确定的 n 次。例如，'o{2}' 不能匹配 \"Bob\" 中的 'o'，但是能匹配 \"food\" 中的两个 o。 |\n| {n,}         | n 是一个非负整数。至少匹配n 次。例如，'o{2,}' 不能匹配 \"Bob\" 中的 'o'，但能匹配 \"foooood\" 中的所有 o。'o{1,}' 等价于 'o+'。'o{0,}' 则等价于 'o*'。 |\n| {n,m}        | m 和 n 均为非负整数，其中n <= m。最少匹配 n 次且最多匹配 m 次。例如，\"o{1,3}\" 将匹配 \"fooooood\" 中的前三个 o。'o{0,1}' 等价于 'o?'。请注意在逗号和两个数之间不能有空格。 |\n| ?            | 当该字符紧跟在任何一个其他限制符 (*, +, ?, {n}, {n,}, {n,m}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 \"oooo\"，'o+?' 将匹配单个 \"o\"，而 'o+' 将匹配所有 'o'。 |\n| .            | 匹配除换行符（\\n、\\r）之外的任何单个字符。要匹配包括 '\\n' 在内的任何字符，请使用像\"**(.\\|\\n)**\"的模式。 |\n| (pattern)    | 匹配 pattern 并获取这一匹配。所获取的匹配可以从产生的 Matches 集合得到，在VBScript 中使用 SubMatches 集合，在JScript 中则使用 $0…$9 属性。要匹配圆括号字符，请使用 '\\(' 或 '\\)'。 |\n| (?:pattern)  | 匹配 pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 \"或\" 字符 (\\|) 来组合一个模式的各个部分是很有用。例如， 'industr(?:y\\|ies) 就是一个比 'industry\\|industries' 更简略的表达式。 |\n| (?=pattern)  | 正向肯定预查（look ahead positive assert），在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，\"Windows(?=95\\|98\\|NT\\|2000)\"能匹配\"Windows2000\"中的\"Windows\"，但不能匹配\"Windows3.1\"中的\"Windows\"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。 |\n| (?!pattern)  | 正向否定预查(negative assert)，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如\"Windows(?!95\\|98\\|NT\\|2000)\"能匹配\"Windows3.1\"中的\"Windows\"，但不能匹配\"Windows2000\"中的\"Windows\"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。 |\n| (?<=pattern) | 反向(look behind)肯定预查，与正向肯定预查类似，只是方向相反。例如，\"`(?<=95|98|NT|2000)Windows`\"能匹配\"`2000Windows`\"中的\"`Windows`\"，但不能匹配\"`3.1Windows`\"中的\"`Windows`\"。 |\n| (?<!pattern) | 反向否定预查，与正向否定预查类似，只是方向相反。例如\"`(?<!95|98|NT|2000)Windows`\"能匹配\"`3.1Windows`\"中的\"`Windows`\"，但不能匹配\"`2000Windows`\"中的\"`Windows`\"。 |\n| x\\|y         | 匹配 x 或 y。例如，'z\\|food' 能匹配 \"z\" 或 \"food\"。'(z\\|f)ood' 则匹配 \"zood\" 或 \"food\"。 |\n| [xyz]        | 字符集合。匹配所包含的任意一个字符。例如， '[abc]' 可以匹配 \"plain\" 中的 'a'。 |\n| [^xyz]       | 负值字符集合。匹配未包含的任意字符。例如， '[^abc]' 可以匹配 \"plain\" 中的'p'、'l'、'i'、'n'。 |\n| [a-z]        | 字符范围。匹配指定范围内的任意字符。例如，'[a-z]' 可以匹配 'a' 到 'z' 范围内的任意小写字母字符。 |\n| [^a-z]       | 负值字符范围。匹配任何不在指定范围内的任意字符。例如，'[^a-z]' 可以匹配任何不在 'a' 到 'z' 范围内的任意字符。 |\n| \\b           | 匹配一个单词边界，也就是指单词和空格间的位置。例如， 'er\\b' 可以匹配\"never\" 中的 'er'，但不能匹配 \"verb\" 中的 'er'。 |\n| \\B           | 匹配非单词边界。'er\\B' 能匹配 \"verb\" 中的 'er'，但不能匹配 \"never\" 中的 'er'。 |\n| \\cx          | 匹配由 x 指明的控制字符。例如， \\cM 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 'c' 字符。 |\n| \\d           | 匹配一个数字字符。等价于 [0-9]。                             |\n| \\D           | 匹配一个非数字字符。等价于 [^0-9]。                          |\n| \\f           | 匹配一个换页符。等价于 \\x0c 和 \\cL。                         |\n| \\n           | 匹配一个换行符。等价于 \\x0a 和 \\cJ。                         |\n| \\r           | 匹配一个回车符。等价于 \\x0d 和 \\cM。                         |\n| \\s           | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \\f\\n\\r\\t\\v]。 |\n| \\S           | 匹配任何非空白字符。等价于 [^ \\f\\n\\r\\t\\v]。                  |\n| \\t           | 匹配一个制表符。等价于 \\x09 和 \\cI。                         |\n| \\v           | 匹配一个垂直制表符。等价于 \\x0b 和 \\cK。                     |\n| \\w           | 匹配字母、数字、下划线。等价于'[A-Za-z0-9_]'。               |\n| \\W           | 匹配非字母、数字、下划线。等价于 '[^A-Za-z0-9_]'。           |\n| \\xn          | 匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，'\\x41' 匹配 \"A\"。'\\x041' 则等价于 '\\x04' & \"1\"。正则表达式中可以使用 ASCII 编码。 |\n| \\num         | 匹配 num，其中 num 是一个正整数。对所获取的匹配的引用。例如，'(.)\\1' 匹配两个连续的相同字符。 |\n| \\n           | 标识一个八进制转义值或一个向后引用。如果 \\n 之前至少 n 个获取的子表达式，则 n 为向后引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。 |\n| \\nm          | 标识一个八进制转义值或一个向后引用。如果 \\nm 之前至少有 nm 个获得子表达式，则 nm 为向后引用。如果 \\nm 之前至少有 n 个获取，则 n 为一个后跟文字 m 的向后引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 \\nm 将匹配八进制转义值 nm。 |\n| \\nml         | 如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。 |\n| \\un          | 匹配 n，其中 n 是一个用四个十六进制数字表示的 Unicode 字符。例如， \\u00A9 匹配版权符号 (?)。 |\n\n# 4：在线测试\n\nhttp://c.runoob.com/front-end/854","source":"_posts/正则表达式.md","raw":"---\ntitle: 正则表达式\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-30 08:16:08\npassword:\nsummary:\ntags: 正则表达式\ncategories: 学习笔记\n---\n\n# 1：简介\n\n正则表达式，常用于匹配包含一定规律的字符串，可以从字符串中提取符合规律的字符串段，或者返回是否符合要求。也可用于替换字符串。\n\n比如，我们设置密码时，网站通常要求，密码为字母+数字+下划线组合，并且具有一定长度如3到15位，那么它的正则表达式可以是，`^[a-z0-9_-]{3-15}$`\n\n其中`^`表示从开头开始匹配，`[a-z0-9_-]`表示匹配字母，数字，下划线和连接符，`$`表示匹配结束。`{3-15}`表示匹配3到15个字符。完整意义：从开头开始匹配，匹配包括字母数字下划线和连接符，总共15个字符。\n\n# 2：语法\n\n`*`表示匹配0个或多个字符。**qife*i**可以匹配：qifei, qifi,qifeeeei\n\n`?`表示匹配0个或1个字符。qife?i可以匹配：qifi, qifei\n\n`+ `匹配一个或者多个字符。qife+i可以匹配：qifei,qifeeeei\n\n`[]`单字符满足[]中的要求，则匹配。`[aui]*`表示字符串中aui都会被匹配出来\n\n| 字符   | 描述                                                         |\n| :----- | :----------------------------------------------------------- |\n| [ABC]  | 匹配 **[...]** 中的所有字符，例如 **[aeiou]** 匹配字符串 \"google runoob taobao\" 中所有的 e o u a 字母。 |\n| [^ABC] | 匹配除了 **[...]** 中字符的所有字符，例如 **[^aeiou]** 匹配字符串 \"google runoob taobao\" 中除了 e o u a 字母的所有字母。 |\n| [A-Z]  | [A-Z] 表示一个区间，匹配所有大写字母，[a-z] 表示所有小写字母。 |\n| .      | 匹配除换行符（\\n、\\r）之外的任何单个字符，相等于 [^\\n\\r]     |\n| [\\s\\S] | 匹配所有。\\s 是匹配所有空白符，包括换行，\\S 非空白符，包括换行。 |\n| \\w     | 匹配字母、数字、下划线。等价于 [A-Za-z0-9_]                  |\n\n| 特别字符 | 描述                                                         |\n| :------- | :----------------------------------------------------------- |\n| $        | 匹配输入字符串的结尾位置。如果设置了 RegExp 对象的 Multiline 属性，则 $ 也匹配 '\\n' 或 '\\r'。要匹配 $ 字符本身，请使用 \\$。 |\n| ( )      | 标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 \\( 和 \\)。 |\n| *        | 匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 \\*。     |\n| +        | 匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 \\+。     |\n| .        | 匹配除换行符 \\n 之外的任何单字符。要匹配 . ，请使用 \\. 。    |\n| [        | 标记一个中括号表达式的开始。要匹配 [，请使用 \\[。            |\n| ?        | 匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 \\?。 |\n| \\        | 将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， 'n' 匹配字符 'n'。'\\n' 匹配换行符。序列 '\\\\' 匹配 \"\\\"，而 '\\(' 则匹配 \"(\"。 |\n| ^        | 匹配输入字符串的开始位置，除非在方括号表达式中使用，当该符号在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合。要匹配 ^ 字符本身，请使用 \\^。 |\n| {        | 标记限定符表达式的开始。要匹配 {，请使用 \\{。                |\n| \\|       | 指明两项之间的一个选择。要匹配 \\|，请使用 \\|。               |\n\n`()`选择：使用`()`给需要选择到的匹配项分组，选择项，可使用列表索引获取每个选择项，匹配的值。\n\n# 3：元字符\n\n| 字符         | 描述                                                         |\n| :----------- | :----------------------------------------------------------- |\n| \\            | 将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，'n' 匹配字符 \"n\"。'\\n' 匹配一个换行符。序列 '\\\\' 匹配 \"\\\" 而 \"\\(\" 则匹配 \"(\"。 |\n| ^            | 匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 '\\n' 或 '\\r' 之后的位置。 |\n| $            | 匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 '\\n' 或 '\\r' 之前的位置。 |\n| *            | 匹配前面的子表达式零次或多次。例如，zo* 能匹配 \"z\" 以及 \"zoo\"。* 等价于{0,}。 |\n| +            | 匹配前面的子表达式一次或多次。例如，'zo+' 能匹配 \"zo\" 以及 \"zoo\"，但不能匹配 \"z\"。+ 等价于 {1,}。 |\n| ?            | 匹配前面的子表达式零次或一次。例如，\"do(es)?\" 可以匹配 \"do\" 或 \"does\" 。? 等价于 {0,1}。 |\n| {n}          | n 是一个非负整数。匹配确定的 n 次。例如，'o{2}' 不能匹配 \"Bob\" 中的 'o'，但是能匹配 \"food\" 中的两个 o。 |\n| {n,}         | n 是一个非负整数。至少匹配n 次。例如，'o{2,}' 不能匹配 \"Bob\" 中的 'o'，但能匹配 \"foooood\" 中的所有 o。'o{1,}' 等价于 'o+'。'o{0,}' 则等价于 'o*'。 |\n| {n,m}        | m 和 n 均为非负整数，其中n <= m。最少匹配 n 次且最多匹配 m 次。例如，\"o{1,3}\" 将匹配 \"fooooood\" 中的前三个 o。'o{0,1}' 等价于 'o?'。请注意在逗号和两个数之间不能有空格。 |\n| ?            | 当该字符紧跟在任何一个其他限制符 (*, +, ?, {n}, {n,}, {n,m}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 \"oooo\"，'o+?' 将匹配单个 \"o\"，而 'o+' 将匹配所有 'o'。 |\n| .            | 匹配除换行符（\\n、\\r）之外的任何单个字符。要匹配包括 '\\n' 在内的任何字符，请使用像\"**(.\\|\\n)**\"的模式。 |\n| (pattern)    | 匹配 pattern 并获取这一匹配。所获取的匹配可以从产生的 Matches 集合得到，在VBScript 中使用 SubMatches 集合，在JScript 中则使用 $0…$9 属性。要匹配圆括号字符，请使用 '\\(' 或 '\\)'。 |\n| (?:pattern)  | 匹配 pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 \"或\" 字符 (\\|) 来组合一个模式的各个部分是很有用。例如， 'industr(?:y\\|ies) 就是一个比 'industry\\|industries' 更简略的表达式。 |\n| (?=pattern)  | 正向肯定预查（look ahead positive assert），在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，\"Windows(?=95\\|98\\|NT\\|2000)\"能匹配\"Windows2000\"中的\"Windows\"，但不能匹配\"Windows3.1\"中的\"Windows\"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。 |\n| (?!pattern)  | 正向否定预查(negative assert)，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如\"Windows(?!95\\|98\\|NT\\|2000)\"能匹配\"Windows3.1\"中的\"Windows\"，但不能匹配\"Windows2000\"中的\"Windows\"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。 |\n| (?<=pattern) | 反向(look behind)肯定预查，与正向肯定预查类似，只是方向相反。例如，\"`(?<=95|98|NT|2000)Windows`\"能匹配\"`2000Windows`\"中的\"`Windows`\"，但不能匹配\"`3.1Windows`\"中的\"`Windows`\"。 |\n| (?<!pattern) | 反向否定预查，与正向否定预查类似，只是方向相反。例如\"`(?<!95|98|NT|2000)Windows`\"能匹配\"`3.1Windows`\"中的\"`Windows`\"，但不能匹配\"`2000Windows`\"中的\"`Windows`\"。 |\n| x\\|y         | 匹配 x 或 y。例如，'z\\|food' 能匹配 \"z\" 或 \"food\"。'(z\\|f)ood' 则匹配 \"zood\" 或 \"food\"。 |\n| [xyz]        | 字符集合。匹配所包含的任意一个字符。例如， '[abc]' 可以匹配 \"plain\" 中的 'a'。 |\n| [^xyz]       | 负值字符集合。匹配未包含的任意字符。例如， '[^abc]' 可以匹配 \"plain\" 中的'p'、'l'、'i'、'n'。 |\n| [a-z]        | 字符范围。匹配指定范围内的任意字符。例如，'[a-z]' 可以匹配 'a' 到 'z' 范围内的任意小写字母字符。 |\n| [^a-z]       | 负值字符范围。匹配任何不在指定范围内的任意字符。例如，'[^a-z]' 可以匹配任何不在 'a' 到 'z' 范围内的任意字符。 |\n| \\b           | 匹配一个单词边界，也就是指单词和空格间的位置。例如， 'er\\b' 可以匹配\"never\" 中的 'er'，但不能匹配 \"verb\" 中的 'er'。 |\n| \\B           | 匹配非单词边界。'er\\B' 能匹配 \"verb\" 中的 'er'，但不能匹配 \"never\" 中的 'er'。 |\n| \\cx          | 匹配由 x 指明的控制字符。例如， \\cM 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 'c' 字符。 |\n| \\d           | 匹配一个数字字符。等价于 [0-9]。                             |\n| \\D           | 匹配一个非数字字符。等价于 [^0-9]。                          |\n| \\f           | 匹配一个换页符。等价于 \\x0c 和 \\cL。                         |\n| \\n           | 匹配一个换行符。等价于 \\x0a 和 \\cJ。                         |\n| \\r           | 匹配一个回车符。等价于 \\x0d 和 \\cM。                         |\n| \\s           | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \\f\\n\\r\\t\\v]。 |\n| \\S           | 匹配任何非空白字符。等价于 [^ \\f\\n\\r\\t\\v]。                  |\n| \\t           | 匹配一个制表符。等价于 \\x09 和 \\cI。                         |\n| \\v           | 匹配一个垂直制表符。等价于 \\x0b 和 \\cK。                     |\n| \\w           | 匹配字母、数字、下划线。等价于'[A-Za-z0-9_]'。               |\n| \\W           | 匹配非字母、数字、下划线。等价于 '[^A-Za-z0-9_]'。           |\n| \\xn          | 匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，'\\x41' 匹配 \"A\"。'\\x041' 则等价于 '\\x04' & \"1\"。正则表达式中可以使用 ASCII 编码。 |\n| \\num         | 匹配 num，其中 num 是一个正整数。对所获取的匹配的引用。例如，'(.)\\1' 匹配两个连续的相同字符。 |\n| \\n           | 标识一个八进制转义值或一个向后引用。如果 \\n 之前至少 n 个获取的子表达式，则 n 为向后引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。 |\n| \\nm          | 标识一个八进制转义值或一个向后引用。如果 \\nm 之前至少有 nm 个获得子表达式，则 nm 为向后引用。如果 \\nm 之前至少有 n 个获取，则 n 为一个后跟文字 m 的向后引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 \\nm 将匹配八进制转义值 nm。 |\n| \\nml         | 如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。 |\n| \\un          | 匹配 n，其中 n 是一个用四个十六进制数字表示的 Unicode 字符。例如， \\u00A9 匹配版权符号 (?)。 |\n\n# 4：在线测试\n\nhttp://c.runoob.com/front-end/854","slug":"正则表达式","published":1,"updated":"2020-09-30T08:46:09.590Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaco0038p0vz56ih9qga","content":"<h1 id=\"1：简介\"><a href=\"#1：简介\" class=\"headerlink\" title=\"1：简介\"></a>1：简介</h1><p>正则表达式，常用于匹配包含一定规律的字符串，可以从字符串中提取符合规律的字符串段，或者返回是否符合要求。也可用于替换字符串。</p>\n<p>比如，我们设置密码时，网站通常要求，密码为字母+数字+下划线组合，并且具有一定长度如3到15位，那么它的正则表达式可以是，<code>^[a-z0-9_-]&#123;3-15&#125;$</code></p>\n<p>其中<code>^</code>表示从开头开始匹配，<code>[a-z0-9_-]</code>表示匹配字母，数字，下划线和连接符，<code>$</code>表示匹配结束。<code>&#123;3-15&#125;</code>表示匹配3到15个字符。完整意义：从开头开始匹配，匹配包括字母数字下划线和连接符，总共15个字符。</p>\n<h1 id=\"2：语法\"><a href=\"#2：语法\" class=\"headerlink\" title=\"2：语法\"></a>2：语法</h1><p><code>*</code>表示匹配0个或多个字符。*<em>qife</em>i**可以匹配：qifei, qifi,qifeeeei</p>\n<p><code>?</code>表示匹配0个或1个字符。qife?i可以匹配：qifi, qifei</p>\n<p><code>+ </code>匹配一个或者多个字符。qife+i可以匹配：qifei,qifeeeei</p>\n<p><code>[]</code>单字符满足[]中的要求，则匹配。<code>[aui]*</code>表示字符串中aui都会被匹配出来</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">字符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">[ABC]</td>\n<td align=\"left\">匹配 <strong>[…]</strong> 中的所有字符，例如 <strong>[aeiou]</strong> 匹配字符串 “google runoob taobao” 中所有的 e o u a 字母。</td>\n</tr>\n<tr>\n<td align=\"left\">[^ABC]</td>\n<td align=\"left\">匹配除了 <strong>[…]</strong> 中字符的所有字符，例如 <strong>[^aeiou]</strong> 匹配字符串 “google runoob taobao” 中除了 e o u a 字母的所有字母。</td>\n</tr>\n<tr>\n<td align=\"left\">[A-Z]</td>\n<td align=\"left\">[A-Z] 表示一个区间，匹配所有大写字母，[a-z] 表示所有小写字母。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">匹配除换行符（\\n、\\r）之外的任何单个字符，相等于 [^\\n\\r]</td>\n</tr>\n<tr>\n<td align=\"left\">[\\s\\S]</td>\n<td align=\"left\">匹配所有。\\s 是匹配所有空白符，包括换行，\\S 非空白符，包括换行。</td>\n</tr>\n<tr>\n<td align=\"left\">\\w</td>\n<td align=\"left\">匹配字母、数字、下划线。等价于 [A-Za-z0-9_]</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th align=\"left\">特别字符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">$</td>\n<td align=\"left\">匹配输入字符串的结尾位置。如果设置了 RegExp 对象的 Multiline 属性，则 $ 也匹配 ‘\\n’ 或 ‘\\r’。要匹配 $ 字符本身，请使用 $。</td>\n</tr>\n<tr>\n<td align=\"left\">( )</td>\n<td align=\"left\">标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 ( 和 )。</td>\n</tr>\n<tr>\n<td align=\"left\">*</td>\n<td align=\"left\">匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 *。</td>\n</tr>\n<tr>\n<td align=\"left\">+</td>\n<td align=\"left\">匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 +。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">匹配除换行符 \\n 之外的任何单字符。要匹配 . ，请使用 . 。</td>\n</tr>\n<tr>\n<td align=\"left\">[</td>\n<td align=\"left\">标记一个中括号表达式的开始。要匹配 [，请使用 [。</td>\n</tr>\n<tr>\n<td align=\"left\">?</td>\n<td align=\"left\">匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 ?。</td>\n</tr>\n<tr>\n<td align=\"left\">\\</td>\n<td align=\"left\">将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， ‘n’ 匹配字符 ‘n’。’\\n’ 匹配换行符。序列 ‘\\‘ 匹配 “&quot;，而 ‘(‘ 则匹配 “(“。</td>\n</tr>\n<tr>\n<td align=\"left\">^</td>\n<td align=\"left\">匹配输入字符串的开始位置，除非在方括号表达式中使用，当该符号在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合。要匹配 ^ 字符本身，请使用 ^。</td>\n</tr>\n<tr>\n<td align=\"left\">{</td>\n<td align=\"left\">标记限定符表达式的开始。要匹配 {，请使用 {。</td>\n</tr>\n<tr>\n<td align=\"left\">|</td>\n<td align=\"left\">指明两项之间的一个选择。要匹配 |，请使用 |。</td>\n</tr>\n</tbody></table>\n<p><code>()</code>选择：使用<code>()</code>给需要选择到的匹配项分组，选择项，可使用列表索引获取每个选择项，匹配的值。</p>\n<h1 id=\"3：元字符\"><a href=\"#3：元字符\" class=\"headerlink\" title=\"3：元字符\"></a>3：元字符</h1><table>\n<thead>\n<tr>\n<th align=\"left\">字符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">\\</td>\n<td align=\"left\">将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，’n’ 匹配字符 “n”。’\\n’ 匹配一个换行符。序列 ‘\\‘ 匹配 “&quot; 而 “(“ 则匹配 “(“。</td>\n</tr>\n<tr>\n<td align=\"left\">^</td>\n<td align=\"left\">匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 ‘\\n’ 或 ‘\\r’ 之后的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">$</td>\n<td align=\"left\">匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 ‘\\n’ 或 ‘\\r’ 之前的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">*</td>\n<td align=\"left\">匹配前面的子表达式零次或多次。例如，zo* 能匹配 “z” 以及 “zoo”。* 等价于{0,}。</td>\n</tr>\n<tr>\n<td align=\"left\">+</td>\n<td align=\"left\">匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</td>\n</tr>\n<tr>\n<td align=\"left\">?</td>\n<td align=\"left\">匹配前面的子表达式零次或一次。例如，”do(es)?” 可以匹配 “do” 或 “does” 。? 等价于 {0,1}。</td>\n</tr>\n<tr>\n<td align=\"left\">{n}</td>\n<td align=\"left\">n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</td>\n</tr>\n<tr>\n<td align=\"left\">{n,}</td>\n<td align=\"left\">n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</td>\n</tr>\n<tr>\n<td align=\"left\">{n,m}</td>\n<td align=\"left\">m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</td>\n</tr>\n<tr>\n<td align=\"left\">?</td>\n<td align=\"left\">当该字符紧跟在任何一个其他限制符 (*, +, ?, {n}, {n,}, {n,m}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 “oooo”，’o+?’ 将匹配单个 “o”，而 ‘o+’ 将匹配所有 ‘o’。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">匹配除换行符（\\n、\\r）之外的任何单个字符。要匹配包括 ‘\\n’ 在内的任何字符，请使用像”<strong>(.|\\n)</strong>“的模式。</td>\n</tr>\n<tr>\n<td align=\"left\">(pattern)</td>\n<td align=\"left\">匹配 pattern 并获取这一匹配。所获取的匹配可以从产生的 Matches 集合得到，在VBScript 中使用 SubMatches 集合，在JScript 中则使用 $0…$9 属性。要匹配圆括号字符，请使用 ‘(‘ 或 ‘)‘。</td>\n</tr>\n<tr>\n<td align=\"left\">(?:pattern)</td>\n<td align=\"left\">匹配 pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 “或” 字符 (|) 来组合一个模式的各个部分是很有用。例如， ‘industr(?:y|ies) 就是一个比 ‘industry|industries’ 更简略的表达式。</td>\n</tr>\n<tr>\n<td align=\"left\">(?=pattern)</td>\n<td align=\"left\">正向肯定预查（look ahead positive assert），在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，”Windows(?=95|98|NT|2000)”能匹配”Windows2000”中的”Windows”，但不能匹配”Windows3.1”中的”Windows”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td>\n</tr>\n<tr>\n<td align=\"left\">(?!pattern)</td>\n<td align=\"left\">正向否定预查(negative assert)，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如”Windows(?!95|98|NT|2000)”能匹配”Windows3.1”中的”Windows”，但不能匹配”Windows2000”中的”Windows”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td>\n</tr>\n<tr>\n<td align=\"left\">(?&lt;=pattern)</td>\n<td align=\"left\">反向(look behind)肯定预查，与正向肯定预查类似，只是方向相反。例如，”`(?&lt;=95</td>\n</tr>\n<tr>\n<td align=\"left\">(?&lt;!pattern)</td>\n<td align=\"left\">反向否定预查，与正向否定预查类似，只是方向相反。例如”`(?&lt;!95</td>\n</tr>\n<tr>\n<td align=\"left\">x|y</td>\n<td align=\"left\">匹配 x 或 y。例如，’z|food’ 能匹配 “z” 或 “food”。’(z|f)ood’ 则匹配 “zood” 或 “food”。</td>\n</tr>\n<tr>\n<td align=\"left\">[xyz]</td>\n<td align=\"left\">字符集合。匹配所包含的任意一个字符。例如， ‘[abc]’ 可以匹配 “plain” 中的 ‘a’。</td>\n</tr>\n<tr>\n<td align=\"left\">[^xyz]</td>\n<td align=\"left\">负值字符集合。匹配未包含的任意字符。例如， ‘[^abc]’ 可以匹配 “plain” 中的’p’、’l’、’i’、’n’。</td>\n</tr>\n<tr>\n<td align=\"left\">[a-z]</td>\n<td align=\"left\">字符范围。匹配指定范围内的任意字符。例如，’[a-z]’ 可以匹配 ‘a’ 到 ‘z’ 范围内的任意小写字母字符。</td>\n</tr>\n<tr>\n<td align=\"left\">[^a-z]</td>\n<td align=\"left\">负值字符范围。匹配任何不在指定范围内的任意字符。例如，’[^a-z]’ 可以匹配任何不在 ‘a’ 到 ‘z’ 范围内的任意字符。</td>\n</tr>\n<tr>\n<td align=\"left\">\\b</td>\n<td align=\"left\">匹配一个单词边界，也就是指单词和空格间的位置。例如， ‘er\\b’ 可以匹配”never” 中的 ‘er’，但不能匹配 “verb” 中的 ‘er’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\B</td>\n<td align=\"left\">匹配非单词边界。’er\\B’ 能匹配 “verb” 中的 ‘er’，但不能匹配 “never” 中的 ‘er’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\cx</td>\n<td align=\"left\">匹配由 x 指明的控制字符。例如， \\cM 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 ‘c’ 字符。</td>\n</tr>\n<tr>\n<td align=\"left\">\\d</td>\n<td align=\"left\">匹配一个数字字符。等价于 [0-9]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\D</td>\n<td align=\"left\">匹配一个非数字字符。等价于 [^0-9]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\f</td>\n<td align=\"left\">匹配一个换页符。等价于 \\x0c 和 \\cL。</td>\n</tr>\n<tr>\n<td align=\"left\">\\n</td>\n<td align=\"left\">匹配一个换行符。等价于 \\x0a 和 \\cJ。</td>\n</tr>\n<tr>\n<td align=\"left\">\\r</td>\n<td align=\"left\">匹配一个回车符。等价于 \\x0d 和 \\cM。</td>\n</tr>\n<tr>\n<td align=\"left\">\\s</td>\n<td align=\"left\">匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \\f\\n\\r\\t\\v]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\S</td>\n<td align=\"left\">匹配任何非空白字符。等价于 [^ \\f\\n\\r\\t\\v]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\t</td>\n<td align=\"left\">匹配一个制表符。等价于 \\x09 和 \\cI。</td>\n</tr>\n<tr>\n<td align=\"left\">\\v</td>\n<td align=\"left\">匹配一个垂直制表符。等价于 \\x0b 和 \\cK。</td>\n</tr>\n<tr>\n<td align=\"left\">\\w</td>\n<td align=\"left\">匹配字母、数字、下划线。等价于’[A-Za-z0-9_]’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\W</td>\n<td align=\"left\">匹配非字母、数字、下划线。等价于 ‘[^A-Za-z0-9_]’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\xn</td>\n<td align=\"left\">匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，’\\x41’ 匹配 “A”。’\\x041’ 则等价于 ‘\\x04’ &amp; “1”。正则表达式中可以使用 ASCII 编码。</td>\n</tr>\n<tr>\n<td align=\"left\">\\num</td>\n<td align=\"left\">匹配 num，其中 num 是一个正整数。对所获取的匹配的引用。例如，’(.)\\1’ 匹配两个连续的相同字符。</td>\n</tr>\n<tr>\n<td align=\"left\">\\n</td>\n<td align=\"left\">标识一个八进制转义值或一个向后引用。如果 \\n 之前至少 n 个获取的子表达式，则 n 为向后引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。</td>\n</tr>\n<tr>\n<td align=\"left\">\\nm</td>\n<td align=\"left\">标识一个八进制转义值或一个向后引用。如果 \\nm 之前至少有 nm 个获得子表达式，则 nm 为向后引用。如果 \\nm 之前至少有 n 个获取，则 n 为一个后跟文字 m 的向后引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 \\nm 将匹配八进制转义值 nm。</td>\n</tr>\n<tr>\n<td align=\"left\">\\nml</td>\n<td align=\"left\">如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。</td>\n</tr>\n<tr>\n<td align=\"left\">\\un</td>\n<td align=\"left\">匹配 n，其中 n 是一个用四个十六进制数字表示的 Unicode 字符。例如， \\u00A9 匹配版权符号 (?)。</td>\n</tr>\n</tbody></table>\n<h1 id=\"4：在线测试\"><a href=\"#4：在线测试\" class=\"headerlink\" title=\"4：在线测试\"></a>4：在线测试</h1><p><a href=\"http://c.runoob.com/front-end/854\">http://c.runoob.com/front-end/854</a></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：简介\"><a href=\"#1：简介\" class=\"headerlink\" title=\"1：简介\"></a>1：简介</h1><p>正则表达式，常用于匹配包含一定规律的字符串，可以从字符串中提取符合规律的字符串段，或者返回是否符合要求。也可用于替换字符串。</p>\n<p>比如，我们设置密码时，网站通常要求，密码为字母+数字+下划线组合，并且具有一定长度如3到15位，那么它的正则表达式可以是，<code>^[a-z0-9_-]&#123;3-15&#125;$</code></p>\n<p>其中<code>^</code>表示从开头开始匹配，<code>[a-z0-9_-]</code>表示匹配字母，数字，下划线和连接符，<code>$</code>表示匹配结束。<code>&#123;3-15&#125;</code>表示匹配3到15个字符。完整意义：从开头开始匹配，匹配包括字母数字下划线和连接符，总共15个字符。</p>\n<h1 id=\"2：语法\"><a href=\"#2：语法\" class=\"headerlink\" title=\"2：语法\"></a>2：语法</h1><p><code>*</code>表示匹配0个或多个字符。*<em>qife</em>i**可以匹配：qifei, qifi,qifeeeei</p>\n<p><code>?</code>表示匹配0个或1个字符。qife?i可以匹配：qifi, qifei</p>\n<p><code>+ </code>匹配一个或者多个字符。qife+i可以匹配：qifei,qifeeeei</p>\n<p><code>[]</code>单字符满足[]中的要求，则匹配。<code>[aui]*</code>表示字符串中aui都会被匹配出来</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">字符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">[ABC]</td>\n<td align=\"left\">匹配 <strong>[…]</strong> 中的所有字符，例如 <strong>[aeiou]</strong> 匹配字符串 “google runoob taobao” 中所有的 e o u a 字母。</td>\n</tr>\n<tr>\n<td align=\"left\">[^ABC]</td>\n<td align=\"left\">匹配除了 <strong>[…]</strong> 中字符的所有字符，例如 <strong>[^aeiou]</strong> 匹配字符串 “google runoob taobao” 中除了 e o u a 字母的所有字母。</td>\n</tr>\n<tr>\n<td align=\"left\">[A-Z]</td>\n<td align=\"left\">[A-Z] 表示一个区间，匹配所有大写字母，[a-z] 表示所有小写字母。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">匹配除换行符（\\n、\\r）之外的任何单个字符，相等于 [^\\n\\r]</td>\n</tr>\n<tr>\n<td align=\"left\">[\\s\\S]</td>\n<td align=\"left\">匹配所有。\\s 是匹配所有空白符，包括换行，\\S 非空白符，包括换行。</td>\n</tr>\n<tr>\n<td align=\"left\">\\w</td>\n<td align=\"left\">匹配字母、数字、下划线。等价于 [A-Za-z0-9_]</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th align=\"left\">特别字符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">$</td>\n<td align=\"left\">匹配输入字符串的结尾位置。如果设置了 RegExp 对象的 Multiline 属性，则 $ 也匹配 ‘\\n’ 或 ‘\\r’。要匹配 $ 字符本身，请使用 $。</td>\n</tr>\n<tr>\n<td align=\"left\">( )</td>\n<td align=\"left\">标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 ( 和 )。</td>\n</tr>\n<tr>\n<td align=\"left\">*</td>\n<td align=\"left\">匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 *。</td>\n</tr>\n<tr>\n<td align=\"left\">+</td>\n<td align=\"left\">匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 +。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">匹配除换行符 \\n 之外的任何单字符。要匹配 . ，请使用 . 。</td>\n</tr>\n<tr>\n<td align=\"left\">[</td>\n<td align=\"left\">标记一个中括号表达式的开始。要匹配 [，请使用 [。</td>\n</tr>\n<tr>\n<td align=\"left\">?</td>\n<td align=\"left\">匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 ?。</td>\n</tr>\n<tr>\n<td align=\"left\">\\</td>\n<td align=\"left\">将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， ‘n’ 匹配字符 ‘n’。’\\n’ 匹配换行符。序列 ‘\\‘ 匹配 “&quot;，而 ‘(‘ 则匹配 “(“。</td>\n</tr>\n<tr>\n<td align=\"left\">^</td>\n<td align=\"left\">匹配输入字符串的开始位置，除非在方括号表达式中使用，当该符号在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合。要匹配 ^ 字符本身，请使用 ^。</td>\n</tr>\n<tr>\n<td align=\"left\">{</td>\n<td align=\"left\">标记限定符表达式的开始。要匹配 {，请使用 {。</td>\n</tr>\n<tr>\n<td align=\"left\">|</td>\n<td align=\"left\">指明两项之间的一个选择。要匹配 |，请使用 |。</td>\n</tr>\n</tbody></table>\n<p><code>()</code>选择：使用<code>()</code>给需要选择到的匹配项分组，选择项，可使用列表索引获取每个选择项，匹配的值。</p>\n<h1 id=\"3：元字符\"><a href=\"#3：元字符\" class=\"headerlink\" title=\"3：元字符\"></a>3：元字符</h1><table>\n<thead>\n<tr>\n<th align=\"left\">字符</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">\\</td>\n<td align=\"left\">将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，’n’ 匹配字符 “n”。’\\n’ 匹配一个换行符。序列 ‘\\‘ 匹配 “&quot; 而 “(“ 则匹配 “(“。</td>\n</tr>\n<tr>\n<td align=\"left\">^</td>\n<td align=\"left\">匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 ‘\\n’ 或 ‘\\r’ 之后的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">$</td>\n<td align=\"left\">匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 ‘\\n’ 或 ‘\\r’ 之前的位置。</td>\n</tr>\n<tr>\n<td align=\"left\">*</td>\n<td align=\"left\">匹配前面的子表达式零次或多次。例如，zo* 能匹配 “z” 以及 “zoo”。* 等价于{0,}。</td>\n</tr>\n<tr>\n<td align=\"left\">+</td>\n<td align=\"left\">匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</td>\n</tr>\n<tr>\n<td align=\"left\">?</td>\n<td align=\"left\">匹配前面的子表达式零次或一次。例如，”do(es)?” 可以匹配 “do” 或 “does” 。? 等价于 {0,1}。</td>\n</tr>\n<tr>\n<td align=\"left\">{n}</td>\n<td align=\"left\">n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</td>\n</tr>\n<tr>\n<td align=\"left\">{n,}</td>\n<td align=\"left\">n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</td>\n</tr>\n<tr>\n<td align=\"left\">{n,m}</td>\n<td align=\"left\">m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</td>\n</tr>\n<tr>\n<td align=\"left\">?</td>\n<td align=\"left\">当该字符紧跟在任何一个其他限制符 (*, +, ?, {n}, {n,}, {n,m}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 “oooo”，’o+?’ 将匹配单个 “o”，而 ‘o+’ 将匹配所有 ‘o’。</td>\n</tr>\n<tr>\n<td align=\"left\">.</td>\n<td align=\"left\">匹配除换行符（\\n、\\r）之外的任何单个字符。要匹配包括 ‘\\n’ 在内的任何字符，请使用像”<strong>(.|\\n)</strong>“的模式。</td>\n</tr>\n<tr>\n<td align=\"left\">(pattern)</td>\n<td align=\"left\">匹配 pattern 并获取这一匹配。所获取的匹配可以从产生的 Matches 集合得到，在VBScript 中使用 SubMatches 集合，在JScript 中则使用 $0…$9 属性。要匹配圆括号字符，请使用 ‘(‘ 或 ‘)‘。</td>\n</tr>\n<tr>\n<td align=\"left\">(?:pattern)</td>\n<td align=\"left\">匹配 pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 “或” 字符 (|) 来组合一个模式的各个部分是很有用。例如， ‘industr(?:y|ies) 就是一个比 ‘industry|industries’ 更简略的表达式。</td>\n</tr>\n<tr>\n<td align=\"left\">(?=pattern)</td>\n<td align=\"left\">正向肯定预查（look ahead positive assert），在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，”Windows(?=95|98|NT|2000)”能匹配”Windows2000”中的”Windows”，但不能匹配”Windows3.1”中的”Windows”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td>\n</tr>\n<tr>\n<td align=\"left\">(?!pattern)</td>\n<td align=\"left\">正向否定预查(negative assert)，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如”Windows(?!95|98|NT|2000)”能匹配”Windows3.1”中的”Windows”，但不能匹配”Windows2000”中的”Windows”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td>\n</tr>\n<tr>\n<td align=\"left\">(?&lt;=pattern)</td>\n<td align=\"left\">反向(look behind)肯定预查，与正向肯定预查类似，只是方向相反。例如，”`(?&lt;=95</td>\n</tr>\n<tr>\n<td align=\"left\">(?&lt;!pattern)</td>\n<td align=\"left\">反向否定预查，与正向否定预查类似，只是方向相反。例如”`(?&lt;!95</td>\n</tr>\n<tr>\n<td align=\"left\">x|y</td>\n<td align=\"left\">匹配 x 或 y。例如，’z|food’ 能匹配 “z” 或 “food”。’(z|f)ood’ 则匹配 “zood” 或 “food”。</td>\n</tr>\n<tr>\n<td align=\"left\">[xyz]</td>\n<td align=\"left\">字符集合。匹配所包含的任意一个字符。例如， ‘[abc]’ 可以匹配 “plain” 中的 ‘a’。</td>\n</tr>\n<tr>\n<td align=\"left\">[^xyz]</td>\n<td align=\"left\">负值字符集合。匹配未包含的任意字符。例如， ‘[^abc]’ 可以匹配 “plain” 中的’p’、’l’、’i’、’n’。</td>\n</tr>\n<tr>\n<td align=\"left\">[a-z]</td>\n<td align=\"left\">字符范围。匹配指定范围内的任意字符。例如，’[a-z]’ 可以匹配 ‘a’ 到 ‘z’ 范围内的任意小写字母字符。</td>\n</tr>\n<tr>\n<td align=\"left\">[^a-z]</td>\n<td align=\"left\">负值字符范围。匹配任何不在指定范围内的任意字符。例如，’[^a-z]’ 可以匹配任何不在 ‘a’ 到 ‘z’ 范围内的任意字符。</td>\n</tr>\n<tr>\n<td align=\"left\">\\b</td>\n<td align=\"left\">匹配一个单词边界，也就是指单词和空格间的位置。例如， ‘er\\b’ 可以匹配”never” 中的 ‘er’，但不能匹配 “verb” 中的 ‘er’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\B</td>\n<td align=\"left\">匹配非单词边界。’er\\B’ 能匹配 “verb” 中的 ‘er’，但不能匹配 “never” 中的 ‘er’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\cx</td>\n<td align=\"left\">匹配由 x 指明的控制字符。例如， \\cM 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 ‘c’ 字符。</td>\n</tr>\n<tr>\n<td align=\"left\">\\d</td>\n<td align=\"left\">匹配一个数字字符。等价于 [0-9]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\D</td>\n<td align=\"left\">匹配一个非数字字符。等价于 [^0-9]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\f</td>\n<td align=\"left\">匹配一个换页符。等价于 \\x0c 和 \\cL。</td>\n</tr>\n<tr>\n<td align=\"left\">\\n</td>\n<td align=\"left\">匹配一个换行符。等价于 \\x0a 和 \\cJ。</td>\n</tr>\n<tr>\n<td align=\"left\">\\r</td>\n<td align=\"left\">匹配一个回车符。等价于 \\x0d 和 \\cM。</td>\n</tr>\n<tr>\n<td align=\"left\">\\s</td>\n<td align=\"left\">匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \\f\\n\\r\\t\\v]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\S</td>\n<td align=\"left\">匹配任何非空白字符。等价于 [^ \\f\\n\\r\\t\\v]。</td>\n</tr>\n<tr>\n<td align=\"left\">\\t</td>\n<td align=\"left\">匹配一个制表符。等价于 \\x09 和 \\cI。</td>\n</tr>\n<tr>\n<td align=\"left\">\\v</td>\n<td align=\"left\">匹配一个垂直制表符。等价于 \\x0b 和 \\cK。</td>\n</tr>\n<tr>\n<td align=\"left\">\\w</td>\n<td align=\"left\">匹配字母、数字、下划线。等价于’[A-Za-z0-9_]’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\W</td>\n<td align=\"left\">匹配非字母、数字、下划线。等价于 ‘[^A-Za-z0-9_]’。</td>\n</tr>\n<tr>\n<td align=\"left\">\\xn</td>\n<td align=\"left\">匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，’\\x41’ 匹配 “A”。’\\x041’ 则等价于 ‘\\x04’ &amp; “1”。正则表达式中可以使用 ASCII 编码。</td>\n</tr>\n<tr>\n<td align=\"left\">\\num</td>\n<td align=\"left\">匹配 num，其中 num 是一个正整数。对所获取的匹配的引用。例如，’(.)\\1’ 匹配两个连续的相同字符。</td>\n</tr>\n<tr>\n<td align=\"left\">\\n</td>\n<td align=\"left\">标识一个八进制转义值或一个向后引用。如果 \\n 之前至少 n 个获取的子表达式，则 n 为向后引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。</td>\n</tr>\n<tr>\n<td align=\"left\">\\nm</td>\n<td align=\"left\">标识一个八进制转义值或一个向后引用。如果 \\nm 之前至少有 nm 个获得子表达式，则 nm 为向后引用。如果 \\nm 之前至少有 n 个获取，则 n 为一个后跟文字 m 的向后引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 \\nm 将匹配八进制转义值 nm。</td>\n</tr>\n<tr>\n<td align=\"left\">\\nml</td>\n<td align=\"left\">如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。</td>\n</tr>\n<tr>\n<td align=\"left\">\\un</td>\n<td align=\"left\">匹配 n，其中 n 是一个用四个十六进制数字表示的 Unicode 字符。例如， \\u00A9 匹配版权符号 (?)。</td>\n</tr>\n</tbody></table>\n<h1 id=\"4：在线测试\"><a href=\"#4：在线测试\" class=\"headerlink\" title=\"4：在线测试\"></a>4：在线测试</h1><p><a href=\"http://c.runoob.com/front-end/854\">http://c.runoob.com/front-end/854</a></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Wed Sep 30 2020 10:46:09 GMT+0200 (GMT+02:00)","title":"正则表达式","path":"2020/09/30/正则表达式/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-30T06:16:08.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-30T06:16:08.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["正则表达式"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"树莓派Chrome浏览器驱动webdriver","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-21T20:01:57.000Z","password":null,"summary":null,"_content":"\n树莓派上的系统是基于Arm内核的Linux，且是32位系统，在Google上面下载的chromedriver在selenium运行时，会报错，可以直接使用apt-get安装chromedriver。\n\n安装命令：\n\n```shell\nsudo apt-get install chromium-chromedriver\n```\n\n会自动识别树莓派上原有的chrome浏览器版本。\n\n在python程序中，可直接使用`webdriver.Chrome()`而无需再指定驱动路径。","source":"_posts/树莓派Chrome浏览器驱动webdriver.md","raw":"---\ntitle: 树莓派Chrome浏览器驱动webdriver\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-21 22:01:57\npassword:\nsummary:\ntags: Selenium\ncategories: 树莓派\n---\n\n树莓派上的系统是基于Arm内核的Linux，且是32位系统，在Google上面下载的chromedriver在selenium运行时，会报错，可以直接使用apt-get安装chromedriver。\n\n安装命令：\n\n```shell\nsudo apt-get install chromium-chromedriver\n```\n\n会自动识别树莓派上原有的chrome浏览器版本。\n\n在python程序中，可直接使用`webdriver.Chrome()`而无需再指定驱动路径。","slug":"树莓派Chrome浏览器驱动webdriver","published":1,"updated":"2020-09-21T20:06:22.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacp003bp0vz167wczno","content":"<p>树莓派上的系统是基于Arm内核的Linux，且是32位系统，在Google上面下载的chromedriver在selenium运行时，会报错，可以直接使用apt-get安装chromedriver。</p>\n<p>安装命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install chromium-chromedriver</span><br></pre></td></tr></table></figure>\n\n<p>会自动识别树莓派上原有的chrome浏览器版本。</p>\n<p>在python程序中，可直接使用<code>webdriver.Chrome()</code>而无需再指定驱动路径。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>树莓派上的系统是基于Arm内核的Linux，且是32位系统，在Google上面下载的chromedriver在selenium运行时，会报错，可以直接使用apt-get安装chromedriver。</p>\n<p>安装命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install chromium-chromedriver</span><br></pre></td></tr></table></figure>\n\n<p>会自动识别树莓派上原有的chrome浏览器版本。</p>\n<p>在python程序中，可直接使用<code>webdriver.Chrome()</code>而无需再指定驱动路径。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Mon Sep 21 2020 22:06:22 GMT+0200 (GMT+02:00)","title":"树莓派Chrome浏览器驱动webdriver","path":"2020/09/21/树莓派Chrome浏览器驱动webdriver/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-21T20:01:57.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-21T20:01:57.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"树莓派","tags":["Selenium"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"爬虫基础","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-07-26T08:55:04.000Z","password":null,"summary":"爬虫，自动抓取互联网上的信息。使用python编写。","_content":"\n\n\n# 1: 任务介绍和准备工作\n\n爬取豆瓣电影Top250的基本信息。\n\nhttps://movie.douban.com/top250\n\n**编码规范：**\n\n![image-20200730095154658](https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png)\n\n```python\n#coding=utf-8\n\ndef hello():\n\tprint(\"hello\")\n\t\nif __name__ = \"__main__\":\t#入口函数，控制函数的执行顺序\n\thello()\n```\n\n**引入模块：**\n\n目录结构：\n\n\\- test1\n\n​\t\\- t1.py\n\n\\- test2\n\n​\t\\- t2.py\n\nt1.py\n\n```python\ndef add(a,b):\n\treturn a+b\nprint(add(a,b))\n```\n\n在t2.py中引入，t1.py\n\n```python\nfrom test1 import t1\nprint(t1.add(3,5))\n```\n\n引入第三方模块\n\n```python\nfrom bs4 import BeautifulSoup\t#网页解析\nimport re\t#正则表达式\nimport urllib.request,urllib.error\t#指定url，获取网页数据\nimport xlwt\t#进行excel操作\nimport sqlite3\t#进行SQLite数据库操作\n```\n\n# 2：构建流程\n\n## 2.1 基本框架\n\n```python\ndef main():\n    baseurl = \"https://movie.douban.com/top250?start=\"\n    #1.爬取网页\n    datalist = getData(baseurl)\n    savepath = \".\\\\豆瓣电影Top250\"\n    #3.保存数据\n\tsaveData(savepath)\n    \n#爬取网页\ndef getData(baseurl):\n    datalist = []\n    #2.逐一解析数据\n    return datalist\n\n#保存数据\ndef saveData(savepath):\n    #保存\n```\n\n## 2.2 获取数据\n\n```python\ndef askURL(url):\n    #用户代理，告诉豆瓣，浏览器类型\n\thead = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36\"}\n    req = urllib.request.Request(url,headers=head)\n    html = \"\"\n    try:\n        response = urllib.request.urlospen(req)\n        html = response.read().decode(\"utf-8\")\n        print(html)\n    except urllib.error.URLError as e:\n        if hasattr(e,\"code\"):s\n            print(e.code)\n        if hasattr(e,\"reason\"):\n            print(e.reason)\n\ndef getData(baseurl):\n    datalist = []\n    for i in range(0,10):\n        url = baseurl + str(i*25)\n        html = askURL(url)\n        #逐一解析网页\n    return datalist\n```\n\n\n\n# 3：补充Urllib库\n\nget请求\n\n```python\nimport urllib.request\n\nresponse = urllib.request.urlopen(\"https://www.baidu.com\")\nprint(response.read().decode('utf-8'))\t#对获取到的源码进行解码\n```\n\nPost请求\n\n```python\nimport urllib.request\nimport urllib,parse\n\ndata = bytes(urllib.parse.urlencode({\"hello\":\"world\"}),encoding=\"utf-8\")\nresponse = urlib.request.urlopen(\"http://httpbin.org/post\",data = data)\nprint(response.read().decode(\"utf-8\"))\n```\n\n超时处理：0.01秒内无反应\n\n```python\ntry:\n\tresponse = urlib.request.urlopen(\"http://httpbin.org/get\",timeout = 0.01)\n    print(response.read().decode(\"utf-8\"))\nexcept urllib.error.URLError as e:\n    print(\"time out\")\n```\n\n响应内容：\n\n```python\nresponse.status\nresponse.getheader()\nresponse.getheader(\"Server\")\n```\n\n伪装：headers内容可以在访问网站时查看，request header\n\n```python\nurl = \"https://www.douban.com\"\nheaders = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36\"}\ndata = bytes(urllib.parse.urlencode({\"name\":\"eric\"}),encoding=\"utf-8\")\n#封装请求\nreq = urllib.request.Request(url=url,data=data,headers=headers,method=method)\nresponse = urllib.request.urlopen(req)\n```\n\n# 4：补充BeautifSoup库\n\n将复杂的html文档转化为树形文档\n\n```python\nfrom bs4 import BeautifulSoup\nfile = open(\"./baidu.html\",\"rb\")\nhtml = file.read()\nbs = BeautifulSoup(html,\"html.parser\")\nprint(bs.title)\n# <title>The Dormouse's story</title>\nprint(bs.title.string)\n#The Dormouse's story\nprint(bs.a.attrs)\n#获取所有属性\n#find_all()查找所有的a标签\nt_lists = bs.find_all(\"a\")\nt_lists = bs.find_all(re.compile(\"a\"))\n\nt_lists = bs.find_all(class=\"head\")\nt_lists = bs.find_all(class_=True)\nt_lists = bs.find_all(text = re.compile(\"\\d\"))\t#查找带数字的文字\nt_lists = bs.find_all(\"a\",limit=3)\t#限定三个元素\n\n#Css选择器\nbs.select('title')\n#<title>sbianm<title>\nbs.select(\".mnav\")\n#按类名查找\nbs.select(\"#u1\")\n#按id查找\nbs.select(\"a[class='bri']\")\n#按照属性查找\nbs.select(\"head>title\")\n#通过子标签来查找\nbs.select(\".mnv ~ .bri\")\n#查找.mnv类的兄弟标签，且类名为bri\n```\n\n更多内容：https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/\n\n# 5：补充正则表达式","source":"_posts/爬虫基础.md","raw":"---\ntitle: 爬虫基础\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-07-26 10:55:04\npassword:\nsummary: 爬虫，自动抓取互联网上的信息。使用python编写。\ntags:\n - 爬虫\ncategories: 学习笔记\n---\n\n\n\n# 1: 任务介绍和准备工作\n\n爬取豆瓣电影Top250的基本信息。\n\nhttps://movie.douban.com/top250\n\n**编码规范：**\n\n![image-20200730095154658](https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png)\n\n```python\n#coding=utf-8\n\ndef hello():\n\tprint(\"hello\")\n\t\nif __name__ = \"__main__\":\t#入口函数，控制函数的执行顺序\n\thello()\n```\n\n**引入模块：**\n\n目录结构：\n\n\\- test1\n\n​\t\\- t1.py\n\n\\- test2\n\n​\t\\- t2.py\n\nt1.py\n\n```python\ndef add(a,b):\n\treturn a+b\nprint(add(a,b))\n```\n\n在t2.py中引入，t1.py\n\n```python\nfrom test1 import t1\nprint(t1.add(3,5))\n```\n\n引入第三方模块\n\n```python\nfrom bs4 import BeautifulSoup\t#网页解析\nimport re\t#正则表达式\nimport urllib.request,urllib.error\t#指定url，获取网页数据\nimport xlwt\t#进行excel操作\nimport sqlite3\t#进行SQLite数据库操作\n```\n\n# 2：构建流程\n\n## 2.1 基本框架\n\n```python\ndef main():\n    baseurl = \"https://movie.douban.com/top250?start=\"\n    #1.爬取网页\n    datalist = getData(baseurl)\n    savepath = \".\\\\豆瓣电影Top250\"\n    #3.保存数据\n\tsaveData(savepath)\n    \n#爬取网页\ndef getData(baseurl):\n    datalist = []\n    #2.逐一解析数据\n    return datalist\n\n#保存数据\ndef saveData(savepath):\n    #保存\n```\n\n## 2.2 获取数据\n\n```python\ndef askURL(url):\n    #用户代理，告诉豆瓣，浏览器类型\n\thead = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36\"}\n    req = urllib.request.Request(url,headers=head)\n    html = \"\"\n    try:\n        response = urllib.request.urlospen(req)\n        html = response.read().decode(\"utf-8\")\n        print(html)\n    except urllib.error.URLError as e:\n        if hasattr(e,\"code\"):s\n            print(e.code)\n        if hasattr(e,\"reason\"):\n            print(e.reason)\n\ndef getData(baseurl):\n    datalist = []\n    for i in range(0,10):\n        url = baseurl + str(i*25)\n        html = askURL(url)\n        #逐一解析网页\n    return datalist\n```\n\n\n\n# 3：补充Urllib库\n\nget请求\n\n```python\nimport urllib.request\n\nresponse = urllib.request.urlopen(\"https://www.baidu.com\")\nprint(response.read().decode('utf-8'))\t#对获取到的源码进行解码\n```\n\nPost请求\n\n```python\nimport urllib.request\nimport urllib,parse\n\ndata = bytes(urllib.parse.urlencode({\"hello\":\"world\"}),encoding=\"utf-8\")\nresponse = urlib.request.urlopen(\"http://httpbin.org/post\",data = data)\nprint(response.read().decode(\"utf-8\"))\n```\n\n超时处理：0.01秒内无反应\n\n```python\ntry:\n\tresponse = urlib.request.urlopen(\"http://httpbin.org/get\",timeout = 0.01)\n    print(response.read().decode(\"utf-8\"))\nexcept urllib.error.URLError as e:\n    print(\"time out\")\n```\n\n响应内容：\n\n```python\nresponse.status\nresponse.getheader()\nresponse.getheader(\"Server\")\n```\n\n伪装：headers内容可以在访问网站时查看，request header\n\n```python\nurl = \"https://www.douban.com\"\nheaders = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36\"}\ndata = bytes(urllib.parse.urlencode({\"name\":\"eric\"}),encoding=\"utf-8\")\n#封装请求\nreq = urllib.request.Request(url=url,data=data,headers=headers,method=method)\nresponse = urllib.request.urlopen(req)\n```\n\n# 4：补充BeautifSoup库\n\n将复杂的html文档转化为树形文档\n\n```python\nfrom bs4 import BeautifulSoup\nfile = open(\"./baidu.html\",\"rb\")\nhtml = file.read()\nbs = BeautifulSoup(html,\"html.parser\")\nprint(bs.title)\n# <title>The Dormouse's story</title>\nprint(bs.title.string)\n#The Dormouse's story\nprint(bs.a.attrs)\n#获取所有属性\n#find_all()查找所有的a标签\nt_lists = bs.find_all(\"a\")\nt_lists = bs.find_all(re.compile(\"a\"))\n\nt_lists = bs.find_all(class=\"head\")\nt_lists = bs.find_all(class_=True)\nt_lists = bs.find_all(text = re.compile(\"\\d\"))\t#查找带数字的文字\nt_lists = bs.find_all(\"a\",limit=3)\t#限定三个元素\n\n#Css选择器\nbs.select('title')\n#<title>sbianm<title>\nbs.select(\".mnav\")\n#按类名查找\nbs.select(\"#u1\")\n#按id查找\nbs.select(\"a[class='bri']\")\n#按照属性查找\nbs.select(\"head>title\")\n#通过子标签来查找\nbs.select(\".mnv ~ .bri\")\n#查找.mnv类的兄弟标签，且类名为bri\n```\n\n更多内容：https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/\n\n# 5：补充正则表达式","slug":"爬虫基础","published":1,"updated":"2020-09-08T13:06:09.418Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacr003ep0vzgpe18oy0","content":"<h1 id=\"1-任务介绍和准备工作\"><a href=\"#1-任务介绍和准备工作\" class=\"headerlink\" title=\"1: 任务介绍和准备工作\"></a>1: 任务介绍和准备工作</h1><p>爬取豆瓣电影Top250的基本信息。</p>\n<p><a href=\"https://movie.douban.com/top250\">https://movie.douban.com/top250</a></p>\n<p><strong>编码规范：</strong></p>\n<p><img src=\"https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20200730095154658\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding=utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>():</span></span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ = <span class=\"string\">&quot;__main__&quot;</span>:\t<span class=\"comment\">#入口函数，控制函数的执行顺序</span></span><br><span class=\"line\">\thello()</span><br></pre></td></tr></table></figure>\n\n<p><strong>引入模块：</strong></p>\n<p>目录结构：</p>\n<p>- test1</p>\n<p>​    - t1.py</p>\n<p>- test2</p>\n<p>​    - t2.py</p>\n<p>t1.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">print(add(a,b))</span><br></pre></td></tr></table></figure>\n\n<p>在t2.py中引入，t1.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> test1 <span class=\"keyword\">import</span> t1</span><br><span class=\"line\">print(t1.add(<span class=\"number\">3</span>,<span class=\"number\">5</span>))</span><br></pre></td></tr></table></figure>\n\n<p>引入第三方模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup\t<span class=\"comment\">#网页解析</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re\t<span class=\"comment\">#正则表达式</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request,urllib.error\t<span class=\"comment\">#指定url，获取网页数据</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> xlwt\t<span class=\"comment\">#进行excel操作</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sqlite3\t<span class=\"comment\">#进行SQLite数据库操作</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2：构建流程\"><a href=\"#2：构建流程\" class=\"headerlink\" title=\"2：构建流程\"></a>2：构建流程</h1><h2 id=\"2-1-基本框架\"><a href=\"#2-1-基本框架\" class=\"headerlink\" title=\"2.1 基本框架\"></a>2.1 基本框架</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    baseurl = <span class=\"string\">&quot;https://movie.douban.com/top250?start=&quot;</span></span><br><span class=\"line\">    <span class=\"comment\">#1.爬取网页</span></span><br><span class=\"line\">    datalist = getData(baseurl)</span><br><span class=\"line\">    savepath = <span class=\"string\">&quot;.\\\\豆瓣电影Top250&quot;</span></span><br><span class=\"line\">    <span class=\"comment\">#3.保存数据</span></span><br><span class=\"line\">\tsaveData(savepath)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">#爬取网页</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getData</span>(<span class=\"params\">baseurl</span>):</span></span><br><span class=\"line\">    datalist = []</span><br><span class=\"line\">    <span class=\"comment\">#2.逐一解析数据</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> datalist</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保存数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">saveData</span>(<span class=\"params\">savepath</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#保存</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-获取数据\"><a href=\"#2-2-获取数据\" class=\"headerlink\" title=\"2.2 获取数据\"></a>2.2 获取数据</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">askURL</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#用户代理，告诉豆瓣，浏览器类型</span></span><br><span class=\"line\">\thead = &#123;<span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>&#125;</span><br><span class=\"line\">    req = urllib.request.Request(url,headers=head)</span><br><span class=\"line\">    html = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = urllib.request.urlospen(req)</span><br><span class=\"line\">        html = response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">        print(html)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> urllib.error.URLError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hasattr(e,<span class=\"string\">&quot;code&quot;</span>):s</span><br><span class=\"line\">            print(e.code)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hasattr(e,<span class=\"string\">&quot;reason&quot;</span>):</span><br><span class=\"line\">            print(e.reason)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getData</span>(<span class=\"params\">baseurl</span>):</span></span><br><span class=\"line\">    datalist = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,<span class=\"number\">10</span>):</span><br><span class=\"line\">        url = baseurl + str(i*<span class=\"number\">25</span>)</span><br><span class=\"line\">        html = askURL(url)</span><br><span class=\"line\">        <span class=\"comment\">#逐一解析网页</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> datalist</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3：补充Urllib库\"><a href=\"#3：补充Urllib库\" class=\"headerlink\" title=\"3：补充Urllib库\"></a>3：补充Urllib库</h1><p>get请求</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"></span><br><span class=\"line\">response = urllib.request.urlopen(<span class=\"string\">&quot;https://www.baidu.com&quot;</span>)</span><br><span class=\"line\">print(response.read().decode(<span class=\"string\">&#x27;utf-8&#x27;</span>))\t<span class=\"comment\">#对获取到的源码进行解码</span></span><br></pre></td></tr></table></figure>\n\n<p>Post请求</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib,parse</span><br><span class=\"line\"></span><br><span class=\"line\">data = bytes(urllib.parse.urlencode(&#123;<span class=\"string\">&quot;hello&quot;</span>:<span class=\"string\">&quot;world&quot;</span>&#125;),encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">response = urlib.request.urlopen(<span class=\"string\">&quot;http://httpbin.org/post&quot;</span>,data = data)</span><br><span class=\"line\">print(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>超时处理：0.01秒内无反应</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tresponse = urlib.request.urlopen(<span class=\"string\">&quot;http://httpbin.org/get&quot;</span>,timeout = <span class=\"number\">0.01</span>)</span><br><span class=\"line\">    print(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br><span class=\"line\"><span class=\"keyword\">except</span> urllib.error.URLError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    print(<span class=\"string\">&quot;time out&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>响应内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response.status</span><br><span class=\"line\">response.getheader()</span><br><span class=\"line\">response.getheader(<span class=\"string\">&quot;Server&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>伪装：headers内容可以在访问网站时查看，request header</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url = <span class=\"string\">&quot;https://www.douban.com&quot;</span></span><br><span class=\"line\">headers = &#123;<span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>&#125;</span><br><span class=\"line\">data = bytes(urllib.parse.urlencode(&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;eric&quot;</span>&#125;),encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#封装请求</span></span><br><span class=\"line\">req = urllib.request.Request(url=url,data=data,headers=headers,method=method)</span><br><span class=\"line\">response = urllib.request.urlopen(req)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：补充BeautifSoup库\"><a href=\"#4：补充BeautifSoup库\" class=\"headerlink\" title=\"4：补充BeautifSoup库\"></a>4：补充BeautifSoup库</h1><p>将复杂的html文档转化为树形文档</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\">file = open(<span class=\"string\">&quot;./baidu.html&quot;</span>,<span class=\"string\">&quot;rb&quot;</span>)</span><br><span class=\"line\">html = file.read()</span><br><span class=\"line\">bs = BeautifulSoup(html,<span class=\"string\">&quot;html.parser&quot;</span>)</span><br><span class=\"line\">print(bs.title)</span><br><span class=\"line\"><span class=\"comment\"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span></span><br><span class=\"line\">print(bs.title.string)</span><br><span class=\"line\"><span class=\"comment\">#The Dormouse&#x27;s story</span></span><br><span class=\"line\">print(bs.a.attrs)</span><br><span class=\"line\"><span class=\"comment\">#获取所有属性</span></span><br><span class=\"line\"><span class=\"comment\">#find_all()查找所有的a标签</span></span><br><span class=\"line\">t_lists = bs.find_all(<span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\">t_lists = bs.find_all(re.compile(<span class=\"string\">&quot;a&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">t_lists = bs.find_all(class=&quot;head&quot;)</span><br><span class=\"line\">t_lists = bs.find_all(class_=<span class=\"literal\">True</span>)</span><br><span class=\"line\">t_lists = bs.find_all(text = re.compile(<span class=\"string\">&quot;\\d&quot;</span>))\t<span class=\"comment\">#查找带数字的文字</span></span><br><span class=\"line\">t_lists = bs.find_all(<span class=\"string\">&quot;a&quot;</span>,limit=<span class=\"number\">3</span>)\t<span class=\"comment\">#限定三个元素</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Css选择器</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&#x27;title&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#&lt;title&gt;sbianm&lt;title&gt;</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;.mnav&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#按类名查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;#u1&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#按id查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;a[class=&#x27;bri&#x27;]&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#按照属性查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;head&gt;title&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#通过子标签来查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;.mnv ~ .bri&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#查找.mnv类的兄弟标签，且类名为bri</span></span><br></pre></td></tr></table></figure>\n\n<p>更多内容：<a href=\"https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/\">https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/</a></p>\n<h1 id=\"5：补充正则表达式\"><a href=\"#5：补充正则表达式\" class=\"headerlink\" title=\"5：补充正则表达式\"></a>5：补充正则表达式</h1>","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1-任务介绍和准备工作\"><a href=\"#1-任务介绍和准备工作\" class=\"headerlink\" title=\"1: 任务介绍和准备工作\"></a>1: 任务介绍和准备工作</h1><p>爬取豆瓣电影Top250的基本信息。</p>\n<p><a href=\"https://movie.douban.com/top250\">https://movie.douban.com/top250</a></p>\n<p><strong>编码规范：</strong></p>\n<p><img src=\"https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png\" alt=\"image-20200730095154658\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#coding=utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span>():</span></span><br><span class=\"line\">\tprint(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ = <span class=\"string\">&quot;__main__&quot;</span>:\t<span class=\"comment\">#入口函数，控制函数的执行顺序</span></span><br><span class=\"line\">\thello()</span><br></pre></td></tr></table></figure>\n\n<p><strong>引入模块：</strong></p>\n<p>目录结构：</p>\n<p>- test1</p>\n<p>​    - t1.py</p>\n<p>- test2</p>\n<p>​    - t2.py</p>\n<p>t1.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">print(add(a,b))</span><br></pre></td></tr></table></figure>\n\n<p>在t2.py中引入，t1.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> test1 <span class=\"keyword\">import</span> t1</span><br><span class=\"line\">print(t1.add(<span class=\"number\">3</span>,<span class=\"number\">5</span>))</span><br></pre></td></tr></table></figure>\n\n<p>引入第三方模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup\t<span class=\"comment\">#网页解析</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re\t<span class=\"comment\">#正则表达式</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request,urllib.error\t<span class=\"comment\">#指定url，获取网页数据</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> xlwt\t<span class=\"comment\">#进行excel操作</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sqlite3\t<span class=\"comment\">#进行SQLite数据库操作</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2：构建流程\"><a href=\"#2：构建流程\" class=\"headerlink\" title=\"2：构建流程\"></a>2：构建流程</h1><h2 id=\"2-1-基本框架\"><a href=\"#2-1-基本框架\" class=\"headerlink\" title=\"2.1 基本框架\"></a>2.1 基本框架</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    baseurl = <span class=\"string\">&quot;https://movie.douban.com/top250?start=&quot;</span></span><br><span class=\"line\">    <span class=\"comment\">#1.爬取网页</span></span><br><span class=\"line\">    datalist = getData(baseurl)</span><br><span class=\"line\">    savepath = <span class=\"string\">&quot;.\\\\豆瓣电影Top250&quot;</span></span><br><span class=\"line\">    <span class=\"comment\">#3.保存数据</span></span><br><span class=\"line\">\tsaveData(savepath)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">#爬取网页</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getData</span>(<span class=\"params\">baseurl</span>):</span></span><br><span class=\"line\">    datalist = []</span><br><span class=\"line\">    <span class=\"comment\">#2.逐一解析数据</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> datalist</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#保存数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">saveData</span>(<span class=\"params\">savepath</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#保存</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-获取数据\"><a href=\"#2-2-获取数据\" class=\"headerlink\" title=\"2.2 获取数据\"></a>2.2 获取数据</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">askURL</span>(<span class=\"params\">url</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#用户代理，告诉豆瓣，浏览器类型</span></span><br><span class=\"line\">\thead = &#123;<span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>&#125;</span><br><span class=\"line\">    req = urllib.request.Request(url,headers=head)</span><br><span class=\"line\">    html = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = urllib.request.urlospen(req)</span><br><span class=\"line\">        html = response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">        print(html)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> urllib.error.URLError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hasattr(e,<span class=\"string\">&quot;code&quot;</span>):s</span><br><span class=\"line\">            print(e.code)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> hasattr(e,<span class=\"string\">&quot;reason&quot;</span>):</span><br><span class=\"line\">            print(e.reason)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getData</span>(<span class=\"params\">baseurl</span>):</span></span><br><span class=\"line\">    datalist = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>,<span class=\"number\">10</span>):</span><br><span class=\"line\">        url = baseurl + str(i*<span class=\"number\">25</span>)</span><br><span class=\"line\">        html = askURL(url)</span><br><span class=\"line\">        <span class=\"comment\">#逐一解析网页</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> datalist</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3：补充Urllib库\"><a href=\"#3：补充Urllib库\" class=\"headerlink\" title=\"3：补充Urllib库\"></a>3：补充Urllib库</h1><p>get请求</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"></span><br><span class=\"line\">response = urllib.request.urlopen(<span class=\"string\">&quot;https://www.baidu.com&quot;</span>)</span><br><span class=\"line\">print(response.read().decode(<span class=\"string\">&#x27;utf-8&#x27;</span>))\t<span class=\"comment\">#对获取到的源码进行解码</span></span><br></pre></td></tr></table></figure>\n\n<p>Post请求</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib,parse</span><br><span class=\"line\"></span><br><span class=\"line\">data = bytes(urllib.parse.urlencode(&#123;<span class=\"string\">&quot;hello&quot;</span>:<span class=\"string\">&quot;world&quot;</span>&#125;),encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">response = urlib.request.urlopen(<span class=\"string\">&quot;http://httpbin.org/post&quot;</span>,data = data)</span><br><span class=\"line\">print(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>超时处理：0.01秒内无反应</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">\tresponse = urlib.request.urlopen(<span class=\"string\">&quot;http://httpbin.org/get&quot;</span>,timeout = <span class=\"number\">0.01</span>)</span><br><span class=\"line\">    print(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br><span class=\"line\"><span class=\"keyword\">except</span> urllib.error.URLError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    print(<span class=\"string\">&quot;time out&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>响应内容：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response.status</span><br><span class=\"line\">response.getheader()</span><br><span class=\"line\">response.getheader(<span class=\"string\">&quot;Server&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>伪装：headers内容可以在访问网站时查看，request header</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url = <span class=\"string\">&quot;https://www.douban.com&quot;</span></span><br><span class=\"line\">headers = &#123;<span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>&#125;</span><br><span class=\"line\">data = bytes(urllib.parse.urlencode(&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;eric&quot;</span>&#125;),encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#封装请求</span></span><br><span class=\"line\">req = urllib.request.Request(url=url,data=data,headers=headers,method=method)</span><br><span class=\"line\">response = urllib.request.urlopen(req)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：补充BeautifSoup库\"><a href=\"#4：补充BeautifSoup库\" class=\"headerlink\" title=\"4：补充BeautifSoup库\"></a>4：补充BeautifSoup库</h1><p>将复杂的html文档转化为树形文档</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\">file = open(<span class=\"string\">&quot;./baidu.html&quot;</span>,<span class=\"string\">&quot;rb&quot;</span>)</span><br><span class=\"line\">html = file.read()</span><br><span class=\"line\">bs = BeautifulSoup(html,<span class=\"string\">&quot;html.parser&quot;</span>)</span><br><span class=\"line\">print(bs.title)</span><br><span class=\"line\"><span class=\"comment\"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span></span><br><span class=\"line\">print(bs.title.string)</span><br><span class=\"line\"><span class=\"comment\">#The Dormouse&#x27;s story</span></span><br><span class=\"line\">print(bs.a.attrs)</span><br><span class=\"line\"><span class=\"comment\">#获取所有属性</span></span><br><span class=\"line\"><span class=\"comment\">#find_all()查找所有的a标签</span></span><br><span class=\"line\">t_lists = bs.find_all(<span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\">t_lists = bs.find_all(re.compile(<span class=\"string\">&quot;a&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">t_lists = bs.find_all(class=&quot;head&quot;)</span><br><span class=\"line\">t_lists = bs.find_all(class_=<span class=\"literal\">True</span>)</span><br><span class=\"line\">t_lists = bs.find_all(text = re.compile(<span class=\"string\">&quot;\\d&quot;</span>))\t<span class=\"comment\">#查找带数字的文字</span></span><br><span class=\"line\">t_lists = bs.find_all(<span class=\"string\">&quot;a&quot;</span>,limit=<span class=\"number\">3</span>)\t<span class=\"comment\">#限定三个元素</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Css选择器</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&#x27;title&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#&lt;title&gt;sbianm&lt;title&gt;</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;.mnav&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#按类名查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;#u1&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#按id查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;a[class=&#x27;bri&#x27;]&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#按照属性查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;head&gt;title&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#通过子标签来查找</span></span><br><span class=\"line\">bs.select(<span class=\"string\">&quot;.mnv ~ .bri&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#查找.mnv类的兄弟标签，且类名为bri</span></span><br></pre></td></tr></table></figure>\n\n<p>更多内容：<a href=\"https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/\">https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/</a></p>\n<h1 id=\"5：补充正则表达式\"><a href=\"#5：补充正则表达式\" class=\"headerlink\" title=\"5：补充正则表达式\"></a>5：补充正则表达式</h1>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png","popularPost_tmp_gaData":{"updated":"Tue Sep 08 2020 15:06:09 GMT+0200 (GMT+02:00)","title":"爬虫基础","path":"2020/07/26/爬虫基础/","eyeCatchImage":"https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-07-26T08:55:04.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-26T08:55:04.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["爬虫"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"移动运营商过滤外网流量和解决办法","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-14T12:22:09.000Z","password":null,"summary":"使用ssr、v2ray等代理软件，进行外网访问时，能看到，移动网络在访问过程中，表现非常差。。本文对移动网络的系列问题展开讨论，并提出一些建议。","_content":"\n**移动在哪些方面对用户访问外网进行了限制**？\n\n- 国内过滤掉海外站点的http请求。\n\n我们最常使用的https协议是由http和tls协议构成。通常访问一个https网站，第一步是，向目标网站比如youtube.com发起一个http明文请求，要求建立连接，之后传递数据才由tls协议进行加密。。如果只是单纯的使用浏览器代理，发送到youtube的http请求将被移动网络过滤掉，从而无法建立连接。\n\n不过，ssr、v2ray在使用时，已经将http请求进行了加密转发到ssr、v2ray服务端。因此http请求是由ssr服务端在外网发起的，不用担心移动过滤http请求。\n\n- 国内外网络边界上对无特征的tcp流量限流降速\n\nssr和v2ray使用了加密和混淆协议，这些协议保证了它们服务端和客户端之间传递的数据无法被解密。移动在这方面，直接对这类没有特征的tcp流量进行丢包，也就导致了，移动用户访问外网速度极慢。\n\n- 国内外网络边界上对tls协议的tcp流量按优先级放行\n\ntls协议流量在出国流量中是海量的，我们访问普通海外网站的时，也包含了大量的tls流量。因此，移动不能对这类流量进行限流降速，而是对那些优先级比较低的用户访问外网进行限制，在高峰时段，可能访问外网速度奇慢。这个问题可以直接花钱解决。\n\n**如何解决移动网络访问外网限制？**\n\n- 更换电信或联通网络。\n\n> 广电也很坑，跟移动差不多\n\n- 使用v2ray+ws+tls方案，即将翻墙流量伪装为普通的https流量。如果你的移动网络出国优先级比较低，高峰时段也会很拥挤。这时候，就取决于你的外网服务器了。外网服务器使用cn2gia自然就不会拥挤了。\n- 如果你买不起一个cn2gia线路，试试在国内部署一个中转服务器，阿里云头年90块（学生价也有优惠）。在这个路由器上部署一个stunnel，把ssr、v2ray的代理请求转发到国内服务器，然后国内服务器发送至国外服务器。\n\n这个方案，可以解决ssr不带tls协议的缺点，同时，即便外网服务器不是cn2gia，你用的也不是电信联通，都没关系。阿里云服务器出国会走电信，而且优先级高，所以即便是高峰时期，网速也不会有影响。\n\n然而，受到国内带宽价格影响。阿里云90一年的服务器，带宽仅为5Mpbs，所以下载速度也就在900kB/s左右。不过看1080P的youtube没有问题。","source":"_posts/移动运营商过滤外网流量问题.md","raw":"---\ntitle: 移动运营商过滤外网流量和解决办法\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-14 14:22:09\npassword:\nsummary: 使用ssr、v2ray等代理软件，进行外网访问时，能看到，移动网络在访问过程中，表现非常差。。本文对移动网络的系列问题展开讨论，并提出一些建议。\ntags: 移动网络\ncategories: 其他\n---\n\n**移动在哪些方面对用户访问外网进行了限制**？\n\n- 国内过滤掉海外站点的http请求。\n\n我们最常使用的https协议是由http和tls协议构成。通常访问一个https网站，第一步是，向目标网站比如youtube.com发起一个http明文请求，要求建立连接，之后传递数据才由tls协议进行加密。。如果只是单纯的使用浏览器代理，发送到youtube的http请求将被移动网络过滤掉，从而无法建立连接。\n\n不过，ssr、v2ray在使用时，已经将http请求进行了加密转发到ssr、v2ray服务端。因此http请求是由ssr服务端在外网发起的，不用担心移动过滤http请求。\n\n- 国内外网络边界上对无特征的tcp流量限流降速\n\nssr和v2ray使用了加密和混淆协议，这些协议保证了它们服务端和客户端之间传递的数据无法被解密。移动在这方面，直接对这类没有特征的tcp流量进行丢包，也就导致了，移动用户访问外网速度极慢。\n\n- 国内外网络边界上对tls协议的tcp流量按优先级放行\n\ntls协议流量在出国流量中是海量的，我们访问普通海外网站的时，也包含了大量的tls流量。因此，移动不能对这类流量进行限流降速，而是对那些优先级比较低的用户访问外网进行限制，在高峰时段，可能访问外网速度奇慢。这个问题可以直接花钱解决。\n\n**如何解决移动网络访问外网限制？**\n\n- 更换电信或联通网络。\n\n> 广电也很坑，跟移动差不多\n\n- 使用v2ray+ws+tls方案，即将翻墙流量伪装为普通的https流量。如果你的移动网络出国优先级比较低，高峰时段也会很拥挤。这时候，就取决于你的外网服务器了。外网服务器使用cn2gia自然就不会拥挤了。\n- 如果你买不起一个cn2gia线路，试试在国内部署一个中转服务器，阿里云头年90块（学生价也有优惠）。在这个路由器上部署一个stunnel，把ssr、v2ray的代理请求转发到国内服务器，然后国内服务器发送至国外服务器。\n\n这个方案，可以解决ssr不带tls协议的缺点，同时，即便外网服务器不是cn2gia，你用的也不是电信联通，都没关系。阿里云服务器出国会走电信，而且优先级高，所以即便是高峰时期，网速也不会有影响。\n\n然而，受到国内带宽价格影响。阿里云90一年的服务器，带宽仅为5Mpbs，所以下载速度也就在900kB/s左右。不过看1080P的youtube没有问题。","slug":"移动运营商过滤外网流量问题","published":1,"updated":"2020-06-20T06:47:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacs003gp0vz4822f2a9","content":"<p><strong>移动在哪些方面对用户访问外网进行了限制</strong>？</p>\n<ul>\n<li>国内过滤掉海外站点的http请求。</li>\n</ul>\n<p>我们最常使用的https协议是由http和tls协议构成。通常访问一个https网站，第一步是，向目标网站比如youtube.com发起一个http明文请求，要求建立连接，之后传递数据才由tls协议进行加密。。如果只是单纯的使用浏览器代理，发送到youtube的http请求将被移动网络过滤掉，从而无法建立连接。</p>\n<p>不过，ssr、v2ray在使用时，已经将http请求进行了加密转发到ssr、v2ray服务端。因此http请求是由ssr服务端在外网发起的，不用担心移动过滤http请求。</p>\n<ul>\n<li>国内外网络边界上对无特征的tcp流量限流降速</li>\n</ul>\n<p>ssr和v2ray使用了加密和混淆协议，这些协议保证了它们服务端和客户端之间传递的数据无法被解密。移动在这方面，直接对这类没有特征的tcp流量进行丢包，也就导致了，移动用户访问外网速度极慢。</p>\n<ul>\n<li>国内外网络边界上对tls协议的tcp流量按优先级放行</li>\n</ul>\n<p>tls协议流量在出国流量中是海量的，我们访问普通海外网站的时，也包含了大量的tls流量。因此，移动不能对这类流量进行限流降速，而是对那些优先级比较低的用户访问外网进行限制，在高峰时段，可能访问外网速度奇慢。这个问题可以直接花钱解决。</p>\n<p><strong>如何解决移动网络访问外网限制？</strong></p>\n<ul>\n<li>更换电信或联通网络。</li>\n</ul>\n<blockquote>\n<p>广电也很坑，跟移动差不多</p>\n</blockquote>\n<ul>\n<li>使用v2ray+ws+tls方案，即将翻墙流量伪装为普通的https流量。如果你的移动网络出国优先级比较低，高峰时段也会很拥挤。这时候，就取决于你的外网服务器了。外网服务器使用cn2gia自然就不会拥挤了。</li>\n<li>如果你买不起一个cn2gia线路，试试在国内部署一个中转服务器，阿里云头年90块（学生价也有优惠）。在这个路由器上部署一个stunnel，把ssr、v2ray的代理请求转发到国内服务器，然后国内服务器发送至国外服务器。</li>\n</ul>\n<p>这个方案，可以解决ssr不带tls协议的缺点，同时，即便外网服务器不是cn2gia，你用的也不是电信联通，都没关系。阿里云服务器出国会走电信，而且优先级高，所以即便是高峰时期，网速也不会有影响。</p>\n<p>然而，受到国内带宽价格影响。阿里云90一年的服务器，带宽仅为5Mpbs，所以下载速度也就在900kB/s左右。不过看1080P的youtube没有问题。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p><strong>移动在哪些方面对用户访问外网进行了限制</strong>？</p>\n<ul>\n<li>国内过滤掉海外站点的http请求。</li>\n</ul>\n<p>我们最常使用的https协议是由http和tls协议构成。通常访问一个https网站，第一步是，向目标网站比如youtube.com发起一个http明文请求，要求建立连接，之后传递数据才由tls协议进行加密。。如果只是单纯的使用浏览器代理，发送到youtube的http请求将被移动网络过滤掉，从而无法建立连接。</p>\n<p>不过，ssr、v2ray在使用时，已经将http请求进行了加密转发到ssr、v2ray服务端。因此http请求是由ssr服务端在外网发起的，不用担心移动过滤http请求。</p>\n<ul>\n<li>国内外网络边界上对无特征的tcp流量限流降速</li>\n</ul>\n<p>ssr和v2ray使用了加密和混淆协议，这些协议保证了它们服务端和客户端之间传递的数据无法被解密。移动在这方面，直接对这类没有特征的tcp流量进行丢包，也就导致了，移动用户访问外网速度极慢。</p>\n<ul>\n<li>国内外网络边界上对tls协议的tcp流量按优先级放行</li>\n</ul>\n<p>tls协议流量在出国流量中是海量的，我们访问普通海外网站的时，也包含了大量的tls流量。因此，移动不能对这类流量进行限流降速，而是对那些优先级比较低的用户访问外网进行限制，在高峰时段，可能访问外网速度奇慢。这个问题可以直接花钱解决。</p>\n<p><strong>如何解决移动网络访问外网限制？</strong></p>\n<ul>\n<li>更换电信或联通网络。</li>\n</ul>\n<blockquote>\n<p>广电也很坑，跟移动差不多</p>\n</blockquote>\n<ul>\n<li>使用v2ray+ws+tls方案，即将翻墙流量伪装为普通的https流量。如果你的移动网络出国优先级比较低，高峰时段也会很拥挤。这时候，就取决于你的外网服务器了。外网服务器使用cn2gia自然就不会拥挤了。</li>\n<li>如果你买不起一个cn2gia线路，试试在国内部署一个中转服务器，阿里云头年90块（学生价也有优惠）。在这个路由器上部署一个stunnel，把ssr、v2ray的代理请求转发到国内服务器，然后国内服务器发送至国外服务器。</li>\n</ul>\n<p>这个方案，可以解决ssr不带tls协议的缺点，同时，即便外网服务器不是cn2gia，你用的也不是电信联通，都没关系。阿里云服务器出国会走电信，而且优先级高，所以即便是高峰时期，网速也不会有影响。</p>\n<p>然而，受到国内带宽价格影响。阿里云90一年的服务器，带宽仅为5Mpbs，所以下载速度也就在900kB/s左右。不过看1080P的youtube没有问题。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:47:29 GMT+0200 (GMT+02:00)","title":"移动运营商过滤外网流量和解决办法","path":"2020/06/14/移动运营商过滤外网流量问题/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-14T12:22:09.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-14T12:22:09.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"其他","tags":["移动网络"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"计划为Hexo博客添加相册和Vlog页面","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-08T13:07:33.000Z","password":null,"summary":null,"_content":"\n计划内容：\n\n- 新建相册页面，下属图片和vlog分支\n- 以Onedrive作为储存库，储存相册及视频\n- 页面自动获取相册和视频，并展示\n- 首页标题改为计时项目\n\n项目js源码：https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/","source":"_posts/计划为Hexo博客添加相册和Vlog页面.md","raw":"---\ntitle: 计划为Hexo博客添加相册和Vlog页面\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-08 15:07:33\npassword:\nsummary:\ntags: \n- 博客\n- Hexo\n- Vlantis\ncategories: 网站编程\n---\n\n计划内容：\n\n- 新建相册页面，下属图片和vlog分支\n- 以Onedrive作为储存库，储存相册及视频\n- 页面自动获取相册和视频，并展示\n- 首页标题改为计时项目\n\n项目js源码：https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/","slug":"计划为Hexo博客添加相册和Vlog页面","published":1,"updated":"2020-09-08T13:11:30.619Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacw003kp0vz1a0j8e54","content":"<p>计划内容：</p>\n<ul>\n<li>新建相册页面，下属图片和vlog分支</li>\n<li>以Onedrive作为储存库，储存相册及视频</li>\n<li>页面自动获取相册和视频，并展示</li>\n<li>首页标题改为计时项目</li>\n</ul>\n<p>项目js源码：<a href=\"https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/\">https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/</a></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>计划内容：</p>\n<ul>\n<li>新建相册页面，下属图片和vlog分支</li>\n<li>以Onedrive作为储存库，储存相册及视频</li>\n<li>页面自动获取相册和视频，并展示</li>\n<li>首页标题改为计时项目</li>\n</ul>\n<p>项目js源码：<a href=\"https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/\">https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/</a></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Tue Sep 08 2020 15:11:30 GMT+0200 (GMT+02:00)","title":"计划为Hexo博客添加相册和Vlog页面","path":"2020/09/08/计划为Hexo博客添加相册和Vlog页面/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-08T13:07:33.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-08T13:07:33.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["博客","Hexo","Vlantis"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"自定义Volantis主题页脚","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-10-10T18:04:58.000Z","password":null,"summary":null,"_content":"\n\n\n修改主题文件下的`_config.yml`\n\n找到页脚部分：\n\n```yaml\n############################### Site Footer ############################### > start\nsite_footer:\n  # layout of footer: [aplayer, social, license, info, copyright,analytics]\n  layout: [custom]\n  #custom\n  custom: '<a style=\"padding-right: 1%;\" href=\"https://hexo.io/\"><img src=\"https://img.shields.io/badge/Powered-Hexo-red\"></a><a style=\"padding-right: 1%;\" href=\"https://volantis.js.org/\"><img src=\"https://img.shields.io/badge/Theme-Volantis-blue\"></a><a style=\"padding-right: 1%;\" href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\"><img src=\"https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-success\"></a><a style=\"padding-right: 1%;\" href=\"https://sci.ci\"><img src=\"https://img.shields.io/badge/Copyright-2019--2020%20QF-orange\"></a>'\n  br: '<br>'\n############################### Site Footer ############################### > end\n```\n\n修改后效果：\n\n![](https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png)","source":"_posts/自定义Volantis主题页脚.md","raw":"---\ntitle: 自定义Volantis主题页脚\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-10-10 20:04:58\npassword:\nsummary:\ntags: Volantis\ncategories: 网站编程\n---\n\n\n\n修改主题文件下的`_config.yml`\n\n找到页脚部分：\n\n```yaml\n############################### Site Footer ############################### > start\nsite_footer:\n  # layout of footer: [aplayer, social, license, info, copyright,analytics]\n  layout: [custom]\n  #custom\n  custom: '<a style=\"padding-right: 1%;\" href=\"https://hexo.io/\"><img src=\"https://img.shields.io/badge/Powered-Hexo-red\"></a><a style=\"padding-right: 1%;\" href=\"https://volantis.js.org/\"><img src=\"https://img.shields.io/badge/Theme-Volantis-blue\"></a><a style=\"padding-right: 1%;\" href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\"><img src=\"https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-success\"></a><a style=\"padding-right: 1%;\" href=\"https://sci.ci\"><img src=\"https://img.shields.io/badge/Copyright-2019--2020%20QF-orange\"></a>'\n  br: '<br>'\n############################### Site Footer ############################### > end\n```\n\n修改后效果：\n\n![](https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png)","slug":"自定义Volantis主题页脚","published":1,"updated":"2020-10-10T18:08:34.628Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacx003np0vzbo0wa35c","content":"<p>修改主题文件下的<code>_config.yml</code></p>\n<p>找到页脚部分：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">############################### Site Footer ############################### &gt; start</span></span><br><span class=\"line\"><span class=\"attr\">site_footer:</span></span><br><span class=\"line\">  <span class=\"comment\"># layout of footer: [aplayer, social, license, info, copyright,analytics]</span></span><br><span class=\"line\">  <span class=\"attr\">layout:</span> [<span class=\"string\">custom</span>]</span><br><span class=\"line\">  <span class=\"comment\">#custom</span></span><br><span class=\"line\">  <span class=\"attr\">custom:</span> <span class=\"string\">&#x27;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://hexo.io/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Powered-Hexo-red&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://volantis.js.org/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Theme-Volantis-blue&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-success&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://sci.ci&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Copyright-2019--2020%20QF-orange&quot;&gt;&lt;/a&gt;&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">br:</span> <span class=\"string\">&#x27;&lt;br&gt;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">############################### Site Footer ############################### &gt; end</span></span><br></pre></td></tr></table></figure>\n\n<p>修改后效果：</p>\n<p><img src=\"https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>修改主题文件下的<code>_config.yml</code></p>\n<p>找到页脚部分：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">############################### Site Footer ############################### &gt; start</span></span><br><span class=\"line\"><span class=\"attr\">site_footer:</span></span><br><span class=\"line\">  <span class=\"comment\"># layout of footer: [aplayer, social, license, info, copyright,analytics]</span></span><br><span class=\"line\">  <span class=\"attr\">layout:</span> [<span class=\"string\">custom</span>]</span><br><span class=\"line\">  <span class=\"comment\">#custom</span></span><br><span class=\"line\">  <span class=\"attr\">custom:</span> <span class=\"string\">&#x27;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://hexo.io/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Powered-Hexo-red&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://volantis.js.org/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Theme-Volantis-blue&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-success&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://sci.ci&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Copyright-2019--2020%20QF-orange&quot;&gt;&lt;/a&gt;&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">br:</span> <span class=\"string\">&#x27;&lt;br&gt;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">############################### Site Footer ############################### &gt; end</span></span><br></pre></td></tr></table></figure>\n\n<p>修改后效果：</p>\n<p><img src=\"https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png\"></p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png","popularPost_tmp_gaData":{"updated":"Sat Oct 10 2020 20:08:34 GMT+0200 (GMT+02:00)","title":"自定义Volantis主题页脚","path":"2020/10/10/自定义Volantis主题页脚/","eyeCatchImage":"https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-10-10T18:04:58.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-10-10T18:04:58.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["Volantis"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"订单卡片备注自动打印系统","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-08-26T13:51:39.000Z","password":null,"summary":"在小程序、美团等设备接单后，顾客都会要求附送代写贺卡，这项工作所耗时间并不长，但当节假日来临，大量订单堆积，手写贺卡明显太耗时间。为了避免贺卡时间的消耗，我决定开发一套自动打印贺卡的系统。并在此记录完整的开发过程和思路。","_content":"\n# 一：系统设计\n\n系统思维导图：\n\n![](https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png)\n\n各个接单平台在收到订单后，将订单信息发送给公网服务器，公网服务器从订单信息中提取卡片内容，并将卡片内容发送给和打印机处在同一个局域网环境下的树莓派，树莓派发送打印请求。\n\n由于打印机的打印请求必须在局域网环境下发出，内网穿透就是必须的步骤，所以这里的树莓派和公网服务器缺一不可，如果有固定的公网ip，则可取消公网服务器步骤，如果打印机支持http发送api请求创建打印进程，则可取消树莓派的作用。\n\n\n\n# 二：准备工作\n\n1. 申请美团和饿了么API接口。\n2. 购买公网服务器，推荐阿里云和腾讯云，学生价购买轻量级应用服务器，一年100元左右。我由于已有小程序，因此和小程序公用了同一台服务器。小程序使用的是开源电商平台“ShopXO”。\n3. 树莓派4B和一台打印机。打印机可选普通的喷墨打印机或者标签打印机。喷墨打印机打印的时候需要间歇的将贺卡放入打印机，而标签机则可连续的打印标签，可将打印后的标签贴在贺卡上。各有优缺点，专门购买一个连续打印贺卡的机器通常比较贵。此系统预算在1k元人民币。其中公网服务器100元/年，树莓派可根据自身资金选择，建议在100\\~500，打印机在300\\~800。不同的打印机在树莓派编程时，涉及的指令集是不同的。细节可能在后面选好后，在修改这里的内容。","source":"_posts/订单卡片备注自动打印系统.md","raw":"---\ntitle: 订单卡片备注自动打印系统\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-08-26 15:51:39\npassword:\nsummary: 在小程序、美团等设备接单后，顾客都会要求附送代写贺卡，这项工作所耗时间并不长，但当节假日来临，大量订单堆积，手写贺卡明显太耗时间。为了避免贺卡时间的消耗，我决定开发一套自动打印贺卡的系统。并在此记录完整的开发过程和思路。\ntags: 电商系统\ncategories: 网站编程\n---\n\n# 一：系统设计\n\n系统思维导图：\n\n![](https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png)\n\n各个接单平台在收到订单后，将订单信息发送给公网服务器，公网服务器从订单信息中提取卡片内容，并将卡片内容发送给和打印机处在同一个局域网环境下的树莓派，树莓派发送打印请求。\n\n由于打印机的打印请求必须在局域网环境下发出，内网穿透就是必须的步骤，所以这里的树莓派和公网服务器缺一不可，如果有固定的公网ip，则可取消公网服务器步骤，如果打印机支持http发送api请求创建打印进程，则可取消树莓派的作用。\n\n\n\n# 二：准备工作\n\n1. 申请美团和饿了么API接口。\n2. 购买公网服务器，推荐阿里云和腾讯云，学生价购买轻量级应用服务器，一年100元左右。我由于已有小程序，因此和小程序公用了同一台服务器。小程序使用的是开源电商平台“ShopXO”。\n3. 树莓派4B和一台打印机。打印机可选普通的喷墨打印机或者标签打印机。喷墨打印机打印的时候需要间歇的将贺卡放入打印机，而标签机则可连续的打印标签，可将打印后的标签贴在贺卡上。各有优缺点，专门购买一个连续打印贺卡的机器通常比较贵。此系统预算在1k元人民币。其中公网服务器100元/年，树莓派可根据自身资金选择，建议在100\\~500，打印机在300\\~800。不同的打印机在树莓派编程时，涉及的指令集是不同的。细节可能在后面选好后，在修改这里的内容。","slug":"订单卡片备注自动打印系统","published":1,"updated":"2020-08-26T14:32:03.863Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsacz003rp0vzfbqeak3b","content":"<h1 id=\"一：系统设计\"><a href=\"#一：系统设计\" class=\"headerlink\" title=\"一：系统设计\"></a>一：系统设计</h1><p>系统思维导图：</p>\n<p><img src=\"https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>各个接单平台在收到订单后，将订单信息发送给公网服务器，公网服务器从订单信息中提取卡片内容，并将卡片内容发送给和打印机处在同一个局域网环境下的树莓派，树莓派发送打印请求。</p>\n<p>由于打印机的打印请求必须在局域网环境下发出，内网穿透就是必须的步骤，所以这里的树莓派和公网服务器缺一不可，如果有固定的公网ip，则可取消公网服务器步骤，如果打印机支持http发送api请求创建打印进程，则可取消树莓派的作用。</p>\n<h1 id=\"二：准备工作\"><a href=\"#二：准备工作\" class=\"headerlink\" title=\"二：准备工作\"></a>二：准备工作</h1><ol>\n<li>申请美团和饿了么API接口。</li>\n<li>购买公网服务器，推荐阿里云和腾讯云，学生价购买轻量级应用服务器，一年100元左右。我由于已有小程序，因此和小程序公用了同一台服务器。小程序使用的是开源电商平台“ShopXO”。</li>\n<li>树莓派4B和一台打印机。打印机可选普通的喷墨打印机或者标签打印机。喷墨打印机打印的时候需要间歇的将贺卡放入打印机，而标签机则可连续的打印标签，可将打印后的标签贴在贺卡上。各有优缺点，专门购买一个连续打印贺卡的机器通常比较贵。此系统预算在1k元人民币。其中公网服务器100元/年，树莓派可根据自身资金选择，建议在100~500，打印机在300~800。不同的打印机在树莓派编程时，涉及的指令集是不同的。细节可能在后面选好后，在修改这里的内容。</li>\n</ol>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"一：系统设计\"><a href=\"#一：系统设计\" class=\"headerlink\" title=\"一：系统设计\"></a>一：系统设计</h1><p>系统思维导图：</p>\n<p><img src=\"https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png\"></p>\n<p>各个接单平台在收到订单后，将订单信息发送给公网服务器，公网服务器从订单信息中提取卡片内容，并将卡片内容发送给和打印机处在同一个局域网环境下的树莓派，树莓派发送打印请求。</p>\n<p>由于打印机的打印请求必须在局域网环境下发出，内网穿透就是必须的步骤，所以这里的树莓派和公网服务器缺一不可，如果有固定的公网ip，则可取消公网服务器步骤，如果打印机支持http发送api请求创建打印进程，则可取消树莓派的作用。</p>\n<h1 id=\"二：准备工作\"><a href=\"#二：准备工作\" class=\"headerlink\" title=\"二：准备工作\"></a>二：准备工作</h1><ol>\n<li>申请美团和饿了么API接口。</li>\n<li>购买公网服务器，推荐阿里云和腾讯云，学生价购买轻量级应用服务器，一年100元左右。我由于已有小程序，因此和小程序公用了同一台服务器。小程序使用的是开源电商平台“ShopXO”。</li>\n<li>树莓派4B和一台打印机。打印机可选普通的喷墨打印机或者标签打印机。喷墨打印机打印的时候需要间歇的将贺卡放入打印机，而标签机则可连续的打印标签，可将打印后的标签贴在贺卡上。各有优缺点，专门购买一个连续打印贺卡的机器通常比较贵。此系统预算在1k元人民币。其中公网服务器100元/年，树莓派可根据自身资金选择，建议在100~500，打印机在300~800。不同的打印机在树莓派编程时，涉及的指令集是不同的。细节可能在后面选好后，在修改这里的内容。</li>\n</ol>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png","popularPost_tmp_gaData":{"updated":"Wed Aug 26 2020 16:32:03 GMT+0200 (GMT+02:00)","title":"订单卡片备注自动打印系统","path":"2020/08/26/订单卡片备注自动打印系统/","eyeCatchImage":"https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-08-26T13:51:39.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-08-26T13:51:39.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"网站编程","tags":["电商系统"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"记录一次在Linux上彻底卸载nginx","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-10T19:34:01.000Z","password":null,"summary":null,"_content":"\n刚想通过nginx做反向代理，以实现内网穿透，但是80端口始终无法ping通，查看linux端口是开着的。思想简单的我，尝试重新安装nginx，然而无论如何都无法卸载干净。首先，nginx可能不是通过apt-get安装的，使用`apt remove`指令没有卸载掉，于是尝试`find / -name nginx -exec rm -rf {} \\;`来删除所有以nginx命名的目录，然而`apt-get install nginx`安装后，任然没有把删除的目录重新安装。\n\n查阅资料后，重新进行了删除和安装\n\n**dpkg指令**\n\n```shell\ndpkg -l\t#查看安装的软件包\n```\n\n尽管已经通过删除目录移除了nginx，在软件包列表里仍然存在三个包含nginx的软件，`nginx`、`nginx-core`、`nginx-common`\n\n使用指令\n\n```shell\nsudo dpkg -r 软件名\t#分别删除三个软件\n```\n\n其中`nginx-common`无法使用上述命令删除，\n\n```shell\nsudo apt-get --purge remove nginx-common\n```\n\n至此nginx以彻底移除。\n\n使用\n\n```shell\napt-get install nginx\n```\n\n重新安装nginx。\n\n安装结束，访问ip可出现welcome to nginx网页。\n\n如果没有出现，\n\n```shell\ncurl http://ip\n```\n\n如果主机上出现html文本，而浏览器外部无法访问，则是防火墙问题。\n\n我在ubuntu上安装了firewall软件，因此导致外部无法访问80端口，使用指令\n\n```shell\nsystemctl stop firewall.service\n```\n\n关闭firewall。也可能是iptables开启了，相同的办法可以关闭iptables防火墙。\n\n\n\n**参考文献：**\n\n《[Linux之Ubuntu下如何查看已安装的软件/库文件](https://www.shuzhiduo.com/A/kvJ3Grm7Jg/)》","source":"_posts/记录一次在Linux上彻底卸载nginx.md","raw":"---\ntitle: 记录一次在Linux上彻底卸载nginx\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-10 21:34:01\npassword:\nsummary:\ntags: Nginx\ncategories: Linux\n---\n\n刚想通过nginx做反向代理，以实现内网穿透，但是80端口始终无法ping通，查看linux端口是开着的。思想简单的我，尝试重新安装nginx，然而无论如何都无法卸载干净。首先，nginx可能不是通过apt-get安装的，使用`apt remove`指令没有卸载掉，于是尝试`find / -name nginx -exec rm -rf {} \\;`来删除所有以nginx命名的目录，然而`apt-get install nginx`安装后，任然没有把删除的目录重新安装。\n\n查阅资料后，重新进行了删除和安装\n\n**dpkg指令**\n\n```shell\ndpkg -l\t#查看安装的软件包\n```\n\n尽管已经通过删除目录移除了nginx，在软件包列表里仍然存在三个包含nginx的软件，`nginx`、`nginx-core`、`nginx-common`\n\n使用指令\n\n```shell\nsudo dpkg -r 软件名\t#分别删除三个软件\n```\n\n其中`nginx-common`无法使用上述命令删除，\n\n```shell\nsudo apt-get --purge remove nginx-common\n```\n\n至此nginx以彻底移除。\n\n使用\n\n```shell\napt-get install nginx\n```\n\n重新安装nginx。\n\n安装结束，访问ip可出现welcome to nginx网页。\n\n如果没有出现，\n\n```shell\ncurl http://ip\n```\n\n如果主机上出现html文本，而浏览器外部无法访问，则是防火墙问题。\n\n我在ubuntu上安装了firewall软件，因此导致外部无法访问80端口，使用指令\n\n```shell\nsystemctl stop firewall.service\n```\n\n关闭firewall。也可能是iptables开启了，相同的办法可以关闭iptables防火墙。\n\n\n\n**参考文献：**\n\n《[Linux之Ubuntu下如何查看已安装的软件/库文件](https://www.shuzhiduo.com/A/kvJ3Grm7Jg/)》","slug":"记录一次在Linux上彻底卸载nginx","published":1,"updated":"2020-09-10T20:02:23.439Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsad0003up0vz7nmyczxi","content":"<p>刚想通过nginx做反向代理，以实现内网穿透，但是80端口始终无法ping通，查看linux端口是开着的。思想简单的我，尝试重新安装nginx，然而无论如何都无法卸载干净。首先，nginx可能不是通过apt-get安装的，使用<code>apt remove</code>指令没有卸载掉，于是尝试<code>find / -name nginx -exec rm -rf &#123;&#125; \\;</code>来删除所有以nginx命名的目录，然而<code>apt-get install nginx</code>安装后，任然没有把删除的目录重新安装。</p>\n<p>查阅资料后，重新进行了删除和安装</p>\n<p><strong>dpkg指令</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg -l\t#查看安装的软件包</span><br></pre></td></tr></table></figure>\n\n<p>尽管已经通过删除目录移除了nginx，在软件包列表里仍然存在三个包含nginx的软件，<code>nginx</code>、<code>nginx-core</code>、<code>nginx-common</code></p>\n<p>使用指令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -r 软件名\t#分别删除三个软件</span><br></pre></td></tr></table></figure>\n\n<p>其中<code>nginx-common</code>无法使用上述命令删除，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get --purge remove nginx-common</span><br></pre></td></tr></table></figure>\n\n<p>至此nginx以彻底移除。</p>\n<p>使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install nginx</span><br></pre></td></tr></table></figure>\n\n<p>重新安装nginx。</p>\n<p>安装结束，访问ip可出现welcome to nginx网页。</p>\n<p>如果没有出现，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://ip</span><br></pre></td></tr></table></figure>\n\n<p>如果主机上出现html文本，而浏览器外部无法访问，则是防火墙问题。</p>\n<p>我在ubuntu上安装了firewall软件，因此导致外部无法访问80端口，使用指令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewall.service</span><br></pre></td></tr></table></figure>\n\n<p>关闭firewall。也可能是iptables开启了，相同的办法可以关闭iptables防火墙。</p>\n<p><strong>参考文献：</strong></p>\n<p>《<a href=\"https://www.shuzhiduo.com/A/kvJ3Grm7Jg/\">Linux之Ubuntu下如何查看已安装的软件/库文件</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<p>刚想通过nginx做反向代理，以实现内网穿透，但是80端口始终无法ping通，查看linux端口是开着的。思想简单的我，尝试重新安装nginx，然而无论如何都无法卸载干净。首先，nginx可能不是通过apt-get安装的，使用<code>apt remove</code>指令没有卸载掉，于是尝试<code>find / -name nginx -exec rm -rf &#123;&#125; \\;</code>来删除所有以nginx命名的目录，然而<code>apt-get install nginx</code>安装后，任然没有把删除的目录重新安装。</p>\n<p>查阅资料后，重新进行了删除和安装</p>\n<p><strong>dpkg指令</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg -l\t#查看安装的软件包</span><br></pre></td></tr></table></figure>\n\n<p>尽管已经通过删除目录移除了nginx，在软件包列表里仍然存在三个包含nginx的软件，<code>nginx</code>、<code>nginx-core</code>、<code>nginx-common</code></p>\n<p>使用指令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -r 软件名\t#分别删除三个软件</span><br></pre></td></tr></table></figure>\n\n<p>其中<code>nginx-common</code>无法使用上述命令删除，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get --purge remove nginx-common</span><br></pre></td></tr></table></figure>\n\n<p>至此nginx以彻底移除。</p>\n<p>使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install nginx</span><br></pre></td></tr></table></figure>\n\n<p>重新安装nginx。</p>\n<p>安装结束，访问ip可出现welcome to nginx网页。</p>\n<p>如果没有出现，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://ip</span><br></pre></td></tr></table></figure>\n\n<p>如果主机上出现html文本，而浏览器外部无法访问，则是防火墙问题。</p>\n<p>我在ubuntu上安装了firewall软件，因此导致外部无法访问80端口，使用指令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewall.service</span><br></pre></td></tr></table></figure>\n\n<p>关闭firewall。也可能是iptables开启了，相同的办法可以关闭iptables防火墙。</p>\n<p><strong>参考文献：</strong></p>\n<p>《<a href=\"https://www.shuzhiduo.com/A/kvJ3Grm7Jg/\">Linux之Ubuntu下如何查看已安装的软件/库文件</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Thu Sep 10 2020 22:02:23 GMT+0200 (GMT+02:00)","title":"记录一次在Linux上彻底卸载nginx","path":"2020/09/10/记录一次在Linux上彻底卸载nginx/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-10T19:34:01.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-10T19:34:01.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Linux","tags":["Nginx"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"部署Aria2+Rclone实现离线下载文件到Onedrive","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-06-25T07:55:43.000Z","password":null,"summary":"在服务器上安装Aria2和Rclone，实现一条指令将远程文件上床到Onedrive。需要配合Ui界面使用。","_content":"\n\n\n# 一：前言\n\nAria2是一款多线程下载的应用，可以充分利用网络带宽，实现满速下载。Rclone是个网盘管理工具，可以绑定Onedrive实现将网盘挂载到本地。利用aria2和Rclone，可以在服务器上通过指令，直接将远程文件下载到本地，并自动保存到Onedrive。\n\n# 二：安装Aria2\n\n推荐使用一键脚本：\n\n```powershell\nwget -N git.io/aria2.sh && chmod +x aria2.sh && ./aria2.sh\n```\n\n此脚本会自动下载关联Rclone的脚本，即aria2文件下载结束自动文件上传到Onedrive。\n\n# 三：安装rclone\n\n```shell\ncurl https://rclone.org/install.sh | sudo bash\n```\n\n安装完毕，配置rclone\n\n```shell\nrclone config\n```\n\n配置方式参考《[Rclone在win上挂在Onedrive](https://sci.ci/2020/06/22/rclone-zai-win-shang-gua-zai-onedrive/)》，但是不完全相同。\n\n如果你的系统有UI，那么可以和在win上一样配置rclone。如果是纯指令界面，则按下面操作配置。\n\n你需要现在windows上部署rclone，以获取onedrive授权的token。token在`C:\\Users\\你的用户名\\.config\\rclone`中\n\n打开`rclone.conf`将token从`{\"access_token\":`开始到`}`结束的内容复制下来。\n\n在`rclone config`出现\n\n```shell\nRemote config                                                \nUse auto config? \n * Say Y if not sure \n * Say N if you are working on a remote or headless machine\ny) Yes (default) \nn) No                                                        \ny/n>\n```\n\n时输入 `n`，不自动配置。\n\n在接下来出现的\n\n```\nresult>\n```\n\n中，输入你拷贝的token。\n\n剩下的和windows配置相同。\n\n然后修改aria2配置，以配置将下载文件自动上传到onedrive\n\n# 四：配置自动上传脚本\n\n[Aria2 一键安装管理脚本 增强版](https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==) 整合了 [Aria2 完美配置](https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMl9wZXJmZWN0X2NvbmZpZw==) ，安装后会附带一些列增强功能脚本，Rclone 自动上传脚本就是其中之一。由于默认不启用，所以需要手动启用。\n\n- 输入`vim /root/.aria2c/autoupload.sh`打开自动上传脚本进行编辑，脚本中有中文注释，按照自己的实际情况进行修改，一般只需要修改下面2个部分。\n\n```none\n# Rclone 配置时填写的网盘名(name)\nDRIVE_NAME='Onedrive'\n# 网盘目录。即上传目标路径，留空为网盘根目录，末尾不要有斜杠。\nDRIVE_PATH='/DRIVEX/Download'\n```\n\n- 输入`vim /root/.aria2c/aria2.conf`打开 Aria2 配置文件进行修改。或使用[Aria2 一键安装管理脚本 增强版](https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==)中的手动修改选项打开配置文件进行修改。找到“下载完成后执行的命令”，把`delete.aria2.sh`替换为`autoupload.sh`。\n\n```none\n# 下载完成后执行的命令\non-download-complete=/root/.aria2c/autoupload.sh\n```\n\n- 重启 Aria2\n\n```none\nservice aria2 restart\n```\n\n# 五：参考资料\n\n《[Aria2 + Rclone 实现 OneDrive、Google Drive 等网盘离线下载](https://p3terx.com/archives/offline-download-of-onedrive-gdrive.html)》","source":"_posts/部署Aria2-Rclone实现离线下载文件到Onedrive.md","raw":"---\ntitle: 部署Aria2+Rclone实现离线下载文件到Onedrive\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-06-25 09:55:43\npassword:\nsummary: 在服务器上安装Aria2和Rclone，实现一条指令将远程文件上床到Onedrive。需要配合Ui界面使用。\ntags:\n - Aria2\n - Rclone\ncategories: Linux\n---\n\n\n\n# 一：前言\n\nAria2是一款多线程下载的应用，可以充分利用网络带宽，实现满速下载。Rclone是个网盘管理工具，可以绑定Onedrive实现将网盘挂载到本地。利用aria2和Rclone，可以在服务器上通过指令，直接将远程文件下载到本地，并自动保存到Onedrive。\n\n# 二：安装Aria2\n\n推荐使用一键脚本：\n\n```powershell\nwget -N git.io/aria2.sh && chmod +x aria2.sh && ./aria2.sh\n```\n\n此脚本会自动下载关联Rclone的脚本，即aria2文件下载结束自动文件上传到Onedrive。\n\n# 三：安装rclone\n\n```shell\ncurl https://rclone.org/install.sh | sudo bash\n```\n\n安装完毕，配置rclone\n\n```shell\nrclone config\n```\n\n配置方式参考《[Rclone在win上挂在Onedrive](https://sci.ci/2020/06/22/rclone-zai-win-shang-gua-zai-onedrive/)》，但是不完全相同。\n\n如果你的系统有UI，那么可以和在win上一样配置rclone。如果是纯指令界面，则按下面操作配置。\n\n你需要现在windows上部署rclone，以获取onedrive授权的token。token在`C:\\Users\\你的用户名\\.config\\rclone`中\n\n打开`rclone.conf`将token从`{\"access_token\":`开始到`}`结束的内容复制下来。\n\n在`rclone config`出现\n\n```shell\nRemote config                                                \nUse auto config? \n * Say Y if not sure \n * Say N if you are working on a remote or headless machine\ny) Yes (default) \nn) No                                                        \ny/n>\n```\n\n时输入 `n`，不自动配置。\n\n在接下来出现的\n\n```\nresult>\n```\n\n中，输入你拷贝的token。\n\n剩下的和windows配置相同。\n\n然后修改aria2配置，以配置将下载文件自动上传到onedrive\n\n# 四：配置自动上传脚本\n\n[Aria2 一键安装管理脚本 增强版](https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==) 整合了 [Aria2 完美配置](https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMl9wZXJmZWN0X2NvbmZpZw==) ，安装后会附带一些列增强功能脚本，Rclone 自动上传脚本就是其中之一。由于默认不启用，所以需要手动启用。\n\n- 输入`vim /root/.aria2c/autoupload.sh`打开自动上传脚本进行编辑，脚本中有中文注释，按照自己的实际情况进行修改，一般只需要修改下面2个部分。\n\n```none\n# Rclone 配置时填写的网盘名(name)\nDRIVE_NAME='Onedrive'\n# 网盘目录。即上传目标路径，留空为网盘根目录，末尾不要有斜杠。\nDRIVE_PATH='/DRIVEX/Download'\n```\n\n- 输入`vim /root/.aria2c/aria2.conf`打开 Aria2 配置文件进行修改。或使用[Aria2 一键安装管理脚本 增强版](https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==)中的手动修改选项打开配置文件进行修改。找到“下载完成后执行的命令”，把`delete.aria2.sh`替换为`autoupload.sh`。\n\n```none\n# 下载完成后执行的命令\non-download-complete=/root/.aria2c/autoupload.sh\n```\n\n- 重启 Aria2\n\n```none\nservice aria2 restart\n```\n\n# 五：参考资料\n\n《[Aria2 + Rclone 实现 OneDrive、Google Drive 等网盘离线下载](https://p3terx.com/archives/offline-download-of-onedrive-gdrive.html)》","slug":"部署Aria2-Rclone实现离线下载文件到Onedrive","published":1,"updated":"2020-06-25T03:57:26.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsad2003xp0vz67epbfod","content":"<h1 id=\"一：前言\"><a href=\"#一：前言\" class=\"headerlink\" title=\"一：前言\"></a>一：前言</h1><p>Aria2是一款多线程下载的应用，可以充分利用网络带宽，实现满速下载。Rclone是个网盘管理工具，可以绑定Onedrive实现将网盘挂载到本地。利用aria2和Rclone，可以在服务器上通过指令，直接将远程文件下载到本地，并自动保存到Onedrive。</p>\n<h1 id=\"二：安装Aria2\"><a href=\"#二：安装Aria2\" class=\"headerlink\" title=\"二：安装Aria2\"></a>二：安装Aria2</h1><p>推荐使用一键脚本：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">wget</span> <span class=\"literal\">-N</span> git.io/aria2.sh &amp;&amp; chmod +x aria2.sh &amp;&amp; ./aria2.sh</span><br></pre></td></tr></table></figure>\n\n<p>此脚本会自动下载关联Rclone的脚本，即aria2文件下载结束自动文件上传到Onedrive。</p>\n<h1 id=\"三：安装rclone\"><a href=\"#三：安装rclone\" class=\"headerlink\" title=\"三：安装rclone\"></a>三：安装rclone</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure>\n\n<p>安装完毕，配置rclone</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone config</span><br></pre></td></tr></table></figure>\n\n<p>配置方式参考《<a href=\"https://sci.ci/2020/06/22/rclone-zai-win-shang-gua-zai-onedrive/\">Rclone在win上挂在Onedrive</a>》，但是不完全相同。</p>\n<p>如果你的系统有UI，那么可以和在win上一样配置rclone。如果是纯指令界面，则按下面操作配置。</p>\n<p>你需要现在windows上部署rclone，以获取onedrive授权的token。token在<code>C:\\Users\\你的用户名\\.config\\rclone</code>中</p>\n<p>打开<code>rclone.conf</code>将token从<code>&#123;&quot;access_token&quot;:</code>开始到<code>&#125;</code>结束的内容复制下来。</p>\n<p>在<code>rclone config</code>出现</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Remote config                                                </span><br><span class=\"line\">Use auto config? </span><br><span class=\"line\"> * Say Y if not sure </span><br><span class=\"line\"> * Say N if you are working on a remote or headless machine</span><br><span class=\"line\">y) Yes (default) </span><br><span class=\"line\">n) No                                                        </span><br><span class=\"line\"><span class=\"meta\">y/n&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>时输入 <code>n</code>，不自动配置。</p>\n<p>在接下来出现的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result&gt;</span><br></pre></td></tr></table></figure>\n\n<p>中，输入你拷贝的token。</p>\n<p>剩下的和windows配置相同。</p>\n<p>然后修改aria2配置，以配置将下载文件自动上传到onedrive</p>\n<h1 id=\"四：配置自动上传脚本\"><a href=\"#四：配置自动上传脚本\" class=\"headerlink\" title=\"四：配置自动上传脚本\"></a>四：配置自动上传脚本</h1><p><a href=\"https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==\">Aria2 一键安装管理脚本 增强版</a> 整合了 <a href=\"https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMl9wZXJmZWN0X2NvbmZpZw==\">Aria2 完美配置</a> ，安装后会附带一些列增强功能脚本，Rclone 自动上传脚本就是其中之一。由于默认不启用，所以需要手动启用。</p>\n<ul>\n<li>输入<code>vim /root/.aria2c/autoupload.sh</code>打开自动上传脚本进行编辑，脚本中有中文注释，按照自己的实际情况进行修改，一般只需要修改下面2个部分。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Rclone 配置时填写的网盘名(name)</span><br><span class=\"line\">DRIVE_NAME&#x3D;&#39;Onedrive&#39;</span><br><span class=\"line\"># 网盘目录。即上传目标路径，留空为网盘根目录，末尾不要有斜杠。</span><br><span class=\"line\">DRIVE_PATH&#x3D;&#39;&#x2F;DRIVEX&#x2F;Download&#39;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>输入<code>vim /root/.aria2c/aria2.conf</code>打开 Aria2 配置文件进行修改。或使用<a href=\"https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==\">Aria2 一键安装管理脚本 增强版</a>中的手动修改选项打开配置文件进行修改。找到“下载完成后执行的命令”，把<code>delete.aria2.sh</code>替换为<code>autoupload.sh</code>。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 下载完成后执行的命令</span><br><span class=\"line\">on-download-complete&#x3D;&#x2F;root&#x2F;.aria2c&#x2F;autoupload.sh</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重启 Aria2</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service aria2 restart</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"五：参考资料\"><a href=\"#五：参考资料\" class=\"headerlink\" title=\"五：参考资料\"></a>五：参考资料</h1><p>《<a href=\"https://p3terx.com/archives/offline-download-of-onedrive-gdrive.html\">Aria2 + Rclone 实现 OneDrive、Google Drive 等网盘离线下载</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"一：前言\"><a href=\"#一：前言\" class=\"headerlink\" title=\"一：前言\"></a>一：前言</h1><p>Aria2是一款多线程下载的应用，可以充分利用网络带宽，实现满速下载。Rclone是个网盘管理工具，可以绑定Onedrive实现将网盘挂载到本地。利用aria2和Rclone，可以在服务器上通过指令，直接将远程文件下载到本地，并自动保存到Onedrive。</p>\n<h1 id=\"二：安装Aria2\"><a href=\"#二：安装Aria2\" class=\"headerlink\" title=\"二：安装Aria2\"></a>二：安装Aria2</h1><p>推荐使用一键脚本：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">wget</span> <span class=\"literal\">-N</span> git.io/aria2.sh &amp;&amp; chmod +x aria2.sh &amp;&amp; ./aria2.sh</span><br></pre></td></tr></table></figure>\n\n<p>此脚本会自动下载关联Rclone的脚本，即aria2文件下载结束自动文件上传到Onedrive。</p>\n<h1 id=\"三：安装rclone\"><a href=\"#三：安装rclone\" class=\"headerlink\" title=\"三：安装rclone\"></a>三：安装rclone</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure>\n\n<p>安装完毕，配置rclone</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone config</span><br></pre></td></tr></table></figure>\n\n<p>配置方式参考《<a href=\"https://sci.ci/2020/06/22/rclone-zai-win-shang-gua-zai-onedrive/\">Rclone在win上挂在Onedrive</a>》，但是不完全相同。</p>\n<p>如果你的系统有UI，那么可以和在win上一样配置rclone。如果是纯指令界面，则按下面操作配置。</p>\n<p>你需要现在windows上部署rclone，以获取onedrive授权的token。token在<code>C:\\Users\\你的用户名\\.config\\rclone</code>中</p>\n<p>打开<code>rclone.conf</code>将token从<code>&#123;&quot;access_token&quot;:</code>开始到<code>&#125;</code>结束的内容复制下来。</p>\n<p>在<code>rclone config</code>出现</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Remote config                                                </span><br><span class=\"line\">Use auto config? </span><br><span class=\"line\"> * Say Y if not sure </span><br><span class=\"line\"> * Say N if you are working on a remote or headless machine</span><br><span class=\"line\">y) Yes (default) </span><br><span class=\"line\">n) No                                                        </span><br><span class=\"line\"><span class=\"meta\">y/n&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>时输入 <code>n</code>，不自动配置。</p>\n<p>在接下来出现的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result&gt;</span><br></pre></td></tr></table></figure>\n\n<p>中，输入你拷贝的token。</p>\n<p>剩下的和windows配置相同。</p>\n<p>然后修改aria2配置，以配置将下载文件自动上传到onedrive</p>\n<h1 id=\"四：配置自动上传脚本\"><a href=\"#四：配置自动上传脚本\" class=\"headerlink\" title=\"四：配置自动上传脚本\"></a>四：配置自动上传脚本</h1><p><a href=\"https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==\">Aria2 一键安装管理脚本 增强版</a> 整合了 <a href=\"https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMl9wZXJmZWN0X2NvbmZpZw==\">Aria2 完美配置</a> ，安装后会附带一些列增强功能脚本，Rclone 自动上传脚本就是其中之一。由于默认不启用，所以需要手动启用。</p>\n<ul>\n<li>输入<code>vim /root/.aria2c/autoupload.sh</code>打开自动上传脚本进行编辑，脚本中有中文注释，按照自己的实际情况进行修改，一般只需要修改下面2个部分。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Rclone 配置时填写的网盘名(name)</span><br><span class=\"line\">DRIVE_NAME&#x3D;&#39;Onedrive&#39;</span><br><span class=\"line\"># 网盘目录。即上传目标路径，留空为网盘根目录，末尾不要有斜杠。</span><br><span class=\"line\">DRIVE_PATH&#x3D;&#39;&#x2F;DRIVEX&#x2F;Download&#39;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>输入<code>vim /root/.aria2c/aria2.conf</code>打开 Aria2 配置文件进行修改。或使用<a href=\"https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==\">Aria2 一键安装管理脚本 增强版</a>中的手动修改选项打开配置文件进行修改。找到“下载完成后执行的命令”，把<code>delete.aria2.sh</code>替换为<code>autoupload.sh</code>。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 下载完成后执行的命令</span><br><span class=\"line\">on-download-complete&#x3D;&#x2F;root&#x2F;.aria2c&#x2F;autoupload.sh</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重启 Aria2</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service aria2 restart</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"五：参考资料\"><a href=\"#五：参考资料\" class=\"headerlink\" title=\"五：参考资料\"></a>五：参考资料</h1><p>《<a href=\"https://p3terx.com/archives/offline-download-of-onedrive-gdrive.html\">Aria2 + Rclone 实现 OneDrive、Google Drive 等网盘离线下载</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Thu Jun 25 2020 05:57:26 GMT+0200 (GMT+02:00)","title":"部署Aria2+Rclone实现离线下载文件到Onedrive","path":"2020/06/25/部署Aria2-Rclone实现离线下载文件到Onedrive/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-06-25T07:55:43.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-25T07:55:43.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Linux","tags":["Rclone","Aria2"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Selenium库常用操作记录","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-09-18T17:06:09.000Z","password":null,"summary":null,"_content":"\n# 1：Selenium简介\n\nSelenium库是一个用于浏览器自动化pyhon库。对提高爬虫容错率有很好的效果。它可用于驱动浏览器，来帮助我们实现获取网站js脚本执行后的网页。\n\n# 2：Selenium安装\n\n## 2.1 安装\n\n```shell\npip install selenium\n```\n\n## 2.2 浏览器驱动\n\n下载浏览器驱动：\n\nFirefox浏览器驱动：[geckodriver](https://link.zhihu.com/?target=https%3A//github.com/mozilla/geckodriver/releases)\n\nChrome浏览器驱动：[chromedriver](https://link.zhihu.com/?target=https%3A//sites.google.com/a/chromium.org/chromedriver/home) , [taobao备用地址](https://link.zhihu.com/?target=https%3A//npm.taobao.org/mirrors/chromedriver)\n\nIE浏览器驱动：[IEDriverServer](https://link.zhihu.com/?target=http%3A//selenium-release.storage.googleapis.com/index.html)\n\nEdge浏览器驱动：[MicrosoftWebDriver](https://link.zhihu.com/?target=https%3A//developer.microsoft.com/en-us/microsoft-edge/tools/webdriver)\n\nOpera浏览器驱动：[operadriver](https://link.zhihu.com/?target=https%3A//github.com/operasoftware/operachromiumdriver/releases)\n\nPhantomJS浏览器驱动：[phantomjs](https://link.zhihu.com/?target=http%3A//phantomjs.org/)\n\n将驱动放到某个路径下，并在环境变量中指明。例如：\n\n驱动放在目录：`C:/abc/webdriver.exe`\n\n则需要在用户或者系统环境变量中，给Path变量添加新变量：`C:/abc`\n\n或者**指定驱动路径**\n\n```python\nfrom selenium import webdriver\npath = \"/path/to/chromedriver\" #注意这个路径需要时可执行路径（chmod 777 dir or 755 dir）\ndriver = webdriver.Chrome(executable_path=path)\n```\n\n不同的浏览器启动方式：\n\n```python\nfrom selenium import webdriver\ndriver = webdriver.Firefox()   # Firefox浏览器\n\ndriver = webdriver.Chrome()    # Chrome浏览器\n\ndriver = webdriver.Ie()        # Internet Explorer浏览器\n\ndriver = webdriver.Edge()      # Edge浏览器\n\ndriver = webdriver.Opera()     # Opera浏览器\n\ndriver = webdriver.PhantomJS()   # PhantomJS\n```\n\n# 3：浏览器选项和操作\n\n## 3.1 浏览器选项\n\n每次当selenium启动chrome浏览器的时候，chrome浏览器很干净，没有插件、没有收藏、没有历史记录，这是因为selenium在启动chrome时为了保证最快的运行效率，启动了一个裸浏览器，这就是为什么需要配置参数的原因，但是有些时候我们需要的不仅是一个裸浏览器。\n\nselenium启动配置参数接收是ChromeOptions类，创建方式如下：\n\n```python\nfrom selenium import webdriver\noption = webdriver.ChromeOptions()\n# 添加启动参数\noption.add_argument()\n\n# 添加扩展应用 \noption.add_extension()\noption.add_encoded_extension()\n\n# 添加实验性质的设置参数 \noption.add_experimental_option()\n\n# 设置调试器地址\noption.debugger_address()\n\n# 添加UA\noptions.add_argument('user-agent=\"MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1\"')\n\n# 指定浏览器分辨率\noptions.add_argument('window-size=1920x3000') \n\n# 谷歌文档提到需要加上这个属性来规避bug\nchrome_options.add_argument('--disable-gpu') \n\n # 隐藏滚动条, 应对一些特殊页面\noptions.add_argument('--hide-scrollbars')\n\n# 不加载图片, 提升速度\noptions.add_argument('blink-settings=imagesEnabled=false') \n\n# 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败\noptions.add_argument('--headless') \n\n# 以最高权限运行\noptions.add_argument('--no-sandbox')\n\n# 手动指定使用的浏览器位置\noptions.binary_location = r\"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\" \n\n#添加crx插件\noption.add_extension('d:\\crx\\AdBlock_v2.17.crx') \n\n# 禁用JavaScript\noption.add_argument(\"--disable-javascript\") \n\n# 设置开发者模式启动，该模式下webdriver属性为正常值\noptions.add_experimental_option('excludeSwitches', ['enable-automation']) \n\n# 禁用浏览器弹窗\nprefs = {  \n    'profile.default_content_setting_values' :  {  \n        'notifications' : 2  \n     }  \n}  \noptions.add_experimental_option('prefs',prefs)\n\ndriver=webdriver.Chrome(chrome_options=chrome_options)\n```\n\n其他配置参数\n\n```python\n–user-data-dir=”[PATH]” \n# 指定用户文件夹User Data路径，可以把书签这样的用户数据保存在系统分区以外的分区\n\n　　–disk-cache-dir=”[PATH]“ \n# 指定缓存Cache路径\n\n　　–disk-cache-size= \n# 指定Cache大小，单位Byte\n\n　　–first run \n# 重置到初始状态，第一次运行\n\n　　–incognito \n# 隐身模式启动\n\n　　–disable-javascript \n# 禁用Javascript\n\n　　--omnibox-popup-count=\"num\" \n# 将地址栏弹出的提示菜单数量改为num个\n\n　　--user-agent=\"xxxxxxxx\" \n# 修改HTTP请求头部的Agent字符串，可以通过about:version页面查看修改效果\n\n　　--disable-plugins \n# 禁止加载所有插件，可以增加速度。可以通过about:plugins页面查看效果\n\n　　--disable-javascript \n# 禁用JavaScript，如果觉得速度慢在加上这个\n\n　　--disable-java \n# 禁用java\n\n　　--start-maximized \n# 启动就最大化\n\n　　--no-sandbox \n# 取消沙盒模式\n\n　　--single-process \n# 单进程运行\n\n　　--process-per-tab \n# 每个标签使用单独进程\n\n　　--process-per-site \n# 每个站点使用单独进程\n\n　　--in-process-plugins \n# 插件不启用单独进程\n\n　　--disable-popup-blocking \n# 禁用弹出拦截\n\n　　--disable-plugins \n# 禁用插件\n\n　　--disable-images \n# 禁用图像\n\n　　--incognito \n# 启动进入隐身模式\n\n　　--enable-udd-profiles \n# 启用账户切换菜单\n\n　　--proxy-pac-url \n# 使用pac代理 [via 1/2]\n\n　　--lang=zh-CN \n# 设置语言为简体中文\n\n　　--disk-cache-dir \n# 自定义缓存目录\n\n　　--disk-cache-size \n# 自定义缓存最大值（单位byte）\n\n　　--media-cache-size \n# 自定义多媒体缓存最大值（单位byte）\n\n　　--bookmark-menu \n# 在工具 栏增加一个书签按钮\n\n　　--enable-sync \n# 启用书签同步\n```\n\n## 3.2 浏览器操作\n\n- 控制浏览器窗口大小\n\n```python\ndriver.set_window_size(480, 800)\n```\n\n- 浏览器后退，前进\n\n```python\n# 后退 \ndriver.back() \n# 前进 \ndriver.forward()\n```\n\n- 刷新\n\n```python\ndriver.refresh() # 刷新\n```\n\n# 4：元素定位和操作\n\n## 4.1 元素定位\n\n获取首个匹配元素：\n\n```python\nfind_element_by_id()\nfind_element_by_name()\nfind_element_by_class_name()\nfind_element_by_tag_name()\nfind_element_by_link_text()\nfind_element_by_partial_link_text()\nfind_element_by_xpath()\nfind_element_by_css_selector()\n```\n\n如果具有多个匹配属性元素，可使用：\n\n```python\nfind_elements_by_class_name()\n```\n\n即在element后加s\n\n## 4.2 输入、提交\n\n- 点击和输入\n\n```python\ndriver.find_element_by_id(\"kw\").clear() # 清楚文本 driver.find_element_by_id(\"kw\").send_keys(\"selenium\") # 模拟按键输入 driver.find_element_by_id(\"su\").click() # 单机元素\n```\n\n- 提交\n\n可以在搜索框模拟回车操作\n\n```python\nsearch_text = driver.find_element_by_id('kw') search_text.send_keys('selenium') \nsearch_text.submit()\n```\n\n- 其他\n\nsize： 返回元素的尺寸。\n\ntext： 获取元素的文本。\n\nget_attribute(name)： 获得属性值。\n\nis_displayed()： 设置该元素是否用户可见。\n\n## 4.3 鼠标操作\n\n在 WebDriver 中， 将这些关于鼠标操作的方法封装在 ActionChains 类提供。\n\nActionChains 类提供了鼠标操作的常用方法：\n\n```\nclick（on_element = None）-鼠标左键\n\nclick_and_hold（on_element = None）-单击鼠标左键，不松开\n\ncontext_click（on_element = None）-点击鼠标右键\n\ndouble_click（on_element = None）-双击鼠标左键\n\ndrag_and_drop（源，目标）-拖拽到某个元素然后松开\n\ndrag_and_drop_by_offset（source，xoffset，yoffset）-拖拽到某个坐标然后松开\n\nkey_down（value，element = None）-点击某个键盘上的键\n\nkey_up（value，element = None）-松开某个键\n\nmove_by_offset（xoffset，yoffset）-鼠标从当前位置移动到某个坐标\n\nmove_to_element（to_element）-鼠标移动到某个元素\n\nmove_to_element_with_offset（to_element，xoffset，yoffset）-移动到距离某个元素（左上角坐标）多少距离的位置\n\nperform（）-执行链中的所有动作\n\n释放（on_element = None）-在某个元素位置松开鼠标左键\n\nsend_keys（* keys_to_send）-发送某个键到当前焦点的元素\n\nsend_keys_to_element（element，* keys_to_send）-发送某个键到指定元素\n```\n\n举个例子：\n\n```python\nfrom selenium import webdriver\n# 引入 ActionChains 类\nfrom selenium.webdriver.common.action_chains import ActionChains\n\ndriver = webdriver.Chrome()\ndriver.get(\"https://www.baidu.cn\")\n\n# 定位到要悬停的元素\nabove = driver.find_element_by_link_text(\"设置\")\n# 对定位到的元素执行鼠标悬停操作\nActionChains(driver).move_to_element(above).perform()\n```\n\n## 4.4 键盘事件\n\n以下为常用的键盘操作：\n\n- send_keys(Keys.BACK_SPACE) 删除键（BackSpace）\n- send_keys(Keys.SPACE) 空格键(Space)\n- send_keys(Keys.TAB) 制表键(Tab)\n- send_keys(Keys.ESCAPE) 回退键（Esc）\n- send_keys(Keys.ENTER) 回车键（Enter）\n- send_keys(Keys.CONTROL,'a') 全选（Ctrl+A）\n- send_keys(Keys.CONTROL,'c') 复制（Ctrl+C）\n- send_keys(Keys.CONTROL,'x') 剪切（Ctrl+X）\n- send_keys(Keys.CONTROL,'v') 粘贴（Ctrl+V）\n- send_keys(Keys.F1) 键盘 F1\n- ……\n- send_keys(Keys.F12) 键盘 F12\n\n```python\n# 输入框输入内容\ndriver.find_element_by_id(\"kw\").send_keys(\"seleniumm\")\n\n# 删除多输入的一个 m\ndriver.find_element_by_id(\"kw\").send_keys(Keys.BACK_SPACE)\n```\n\n## 4.5 获取断言信息\n\n```python\ntitle = driver.title # 打印当前页面title\nnow_url = driver.current_url # 打印当前页面URL\nuser = driver.find_element_by_class_name('nums').text # # 获取结果数目\n```\n\n## 4.6 等待页面加载完成\n\n- 显示等待\n\n显式等待使WebdDriver等待某个条件成立时继续执行，否则在达到最大时长时抛出超时异常（TimeoutException）。\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver.support import expected_conditions as EC\n\ndriver = webdriver.Firefox()\ndriver.get(\"http://www.baidu.com\")\n\nelement = WebDriverWait(driver, 5, 0.5).until(\n                      EC.presence_of_element_located((By.ID, \"kw\"))\n                      )\nelement.send_keys('selenium')\ndriver.quit()\n```\n\nWebDriverWait类是由WebDirver 提供的等待方法。在设置时间内，默认每隔一段时间检测一次当前页面元素是否存在，如果超过设置时间检测不到则抛出异常。具体格式如下：\n\n```python\nWebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)\n```\n\n- driver ：浏览器驱动。\n- timeout ：最长超时时间，默认以秒为单位。\n- poll_frequency ：检测的间隔（步长）时间，默认为0.5S。\n- ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。\n- WebDriverWait()一般由until()或until_not()方法配合使用，下面是until()和until_not()方法的说明。\n- until(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为True。\n- until_not(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为False。\n\n在本例中，通过as关键字将expected_conditions 重命名为EC，并调用presence_of_element_located()方法判断元素是否存在。\n\n- 隐式等待\n\n如果某些元素不是立即可用的，隐式等待是告诉WebDriver去等待一定的时间后去查找元素。 默认等待时间是0秒，一旦设置该值，隐式等待是设置该WebDriver的实例的生命周期。\n\n```python\nfrom selenium import webdriver\ndriver = webdriver.Firefox()    \ndriver.implicitly_wait(10) # seconds    \ndriver.get(\"http://somedomain/url_that_delays_loading\")    \nmyDynamicElement = driver.find_element_by_id(\"myDynamicElement\") \n```\n\n## 4.7 在不同的iframe之间移动\n\n```python\ndriver.switch_to_window(\"windowName\")\ndriver.switch_to_frame(\"frameName\")\n```\n\n以直接取表单的id 或name属性。如果iframe没有可用的id和name属性，则可以通过下面的方式进行定位。\n\n```python\n#先通过xpth定位到iframe\nxf = driver.find_element_by_xpath('//*[@id=\"x-URS-iframe\"]')\n\n#再将定位对象传给switch_to_frame()方法\ndriver.switch_to_frame(xf)\n```\n\n一旦我们完成了frame中的工作，我们可以这样返回父frame:\n\n```python\ndriver.switch_to_default_content()\n```\n\n## 4.8 警告框处理\n\n```python\nalert = driver.switch_to_alert()\n```\n\n- text：返回 alert/confirm/prompt 中的文字信息。\n- accept()：接受现有警告框。\n- dismiss()：解散现有警告框。\n- send_keys(keysToSend)：发送文本至警告框。keysToSend：将文本发送至警告框。\n\n## 4.9 下拉框选择\n\n```text\nfrom selenium import webdriver\nfrom selenium.webdriver.support.select import Select\nfrom time import sleep\n\ndriver = webdriver.Chrome()\ndriver.implicitly_wait(10)\ndriver.get('http://www.baidu.com')\nsel = driver.find_element_by_xpath(\"//select[@id='nr']\")\nSelect(sel).select_by_value('50')  # 显示50条\n```\n\n## 4.10 文件上传\n\n```text\ndriver.find_element_by_name(\"file\").send_keys('D:\\\\upload_file.txt')  # # 定位上传按钮，添加本地文件\n```\n\n## 4.11 cookie操作\n\nWebDriver操作cookie的方法：\n\n- get_cookies()： 获得所有cookie信息。\n- get_cookie(name)： 返回字典的key为“name”的cookie信息。\n- add_cookie(cookie_dict) ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。\n- delete_cookie(name,optionsString)：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。\n- delete_all_cookies()： 删除所有cookie信息\n\n## 4.12 调用JavaScript代码\n\n```python\njs=\"window.scrollTo(100,450);\"\ndriver.execute_script(js) # 通过javascript设置浏览器窗口的滚动条位置\n```\n\n通过execute_script()方法执行JavaScripts代码来移动滚动条的位置。\n\n## 4.13 窗口截图\n\n```python\ndriver.get_screenshot_as_file(\"D:\\\\baidu_img.jpg\") # 截取当前窗口，并指定截图图片的保存位置\n```\n\n## 4.14 关闭浏览器\n\n- close() 关闭单个窗口\n- quit() 关闭所有窗口\n\n## 4.15 直接用cookie登录方法\n\n链接：[https://www.jianshu.com/p/773c58406bdb](https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/773c58406bdb)\n\n1. 手动获取网页的cookie，将其序列化并存储在本地\n2. 写入代码\n\n```python\nfor item in cookies:\n    driver.add_cookie(item)\n```\n\n## 4.16 导出html到beautifulsoup或文件\n\n```python\nsoup = BeautifulSoup(driver.page_source,\"html.parser\")\n```\n\n```python\ndef writetohtml(driver,path):\n    f = open(path,'wb')\n    f.write(driver.page_source.encode(\"utf-8\", \"ignore\"))\n    f.close()   \n```\n\n# 5：控件操作\n\n## 5.1 Select\n\n`Select`类提供了三种选择某些选项的方法：\n\n```python\nselect_by_index(index)\nselect_by_value(value)\nselect_by_visible_text(text)\n```\n\n> index从0开始，第一个option为0\n>\n> value是标签的属性值\n>\n> visible_text是option标签中间的值，即下拉框可见值\n\n自然的，有选择必然有反选，即取消选择。`Select`提供了四个方法给我们取消原来的选择：\n\n```\ndeselect_by_index(index)\ndeselect_by_value(value)\ndeselect_by_visible_text(text)\ndeselect_all()\n```\n\n前一种分别于`select`相对应，第四种是全部取消选择，是的，你没看错，是全部取消。有一种特殊的选择标签，即设置了`multiple=\"multiple\"`属性的`select`，这种`select`框是可以多选的，你可以通过多次`select`，选择多个选项，而通过`deselect_all()`来将他们全部取消。\n\n当我们选择了选项之后，想要看看选择的是哪项，替代的是否是我想选的，怎么办？别担心，`Select`为你提供了相应的方法（或者应该说是属性了）：\n\n```\noptions\nall_selected_options\nfirst_selected_option\n```\n\n上面三个属性，分别返回这个`select`元素所有的`options`，所有被选中的`options`以及第一个被选中的`option`。\n\n## 5.2 Radio和Checkbox\n\n```html\n<html>\n<body>\nCheckbox:\n<input type=\"checkbox\" value=\"cv1\" name=\"c1\">\n<input type=\"checkbox\" value=\"cv2\">\n<input type=\"checkbox\" value=\"cv3\" name=\"c1\">\n<input type=\"checkbox\" value=\"cv4\">\n<p>\nRadio:\n<input type=\"radio\" value=\"rv1\" name=\"r1\">\n<input type=\"radio\" value=\"rv2\" name=\"r1\">\n</body>\n</html>\n```\n\n选择操作即点击事件，清除选择即键盘操作\n\n```python\n# checkbox\ndriver.find_element_by_xpath('//input[@value=\"cv1\"]').click()  # click\ndriver.find_element_by_xpath('//input[@value=\"cv2\"]').send_keys(Keys.SPACE)  # send space\n\n# radio\ndriver.find_element_by_xpath('//input[@value=\"rv1\"]').send_keys(Keys.SPACE)  # send space\nsleep(1)\ndriver.find_element_by_xpath('//input[@value=\"rv2\"]').click()  # click\n```\n\n# 6：参考资料\n\n《[Selenium Python 教程](https://zhuanlan.zhihu.com/p/111859925)》\n\n《[selenium启动Chrome配置参数问题](https://zhuanlan.zhihu.com/p/60852696)》\n\n《[Python硒-模拟鼠标键盘操作（ActionChains）](https://huilansame.github.io/huilansame.github.io/archivers/mouse-and-keyboard-actionchains)》\n\n《[Python硒-操作选择标签的下拉选择框](https://huilansame.github.io/huilansame.github.io/archivers/drop-down-select)》\n\n《[Python+selenium使用cookie登录淘宝](https://www.jianshu.com/p/773c58406bdb)》","source":"_posts/Selenium常用操作记录.md","raw":"---\ntitle: Selenium库常用操作记录\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-09-18 19:06:09\npassword:\nsummary:\ntags: Selenium\ncategories: Python\n---\n\n# 1：Selenium简介\n\nSelenium库是一个用于浏览器自动化pyhon库。对提高爬虫容错率有很好的效果。它可用于驱动浏览器，来帮助我们实现获取网站js脚本执行后的网页。\n\n# 2：Selenium安装\n\n## 2.1 安装\n\n```shell\npip install selenium\n```\n\n## 2.2 浏览器驱动\n\n下载浏览器驱动：\n\nFirefox浏览器驱动：[geckodriver](https://link.zhihu.com/?target=https%3A//github.com/mozilla/geckodriver/releases)\n\nChrome浏览器驱动：[chromedriver](https://link.zhihu.com/?target=https%3A//sites.google.com/a/chromium.org/chromedriver/home) , [taobao备用地址](https://link.zhihu.com/?target=https%3A//npm.taobao.org/mirrors/chromedriver)\n\nIE浏览器驱动：[IEDriverServer](https://link.zhihu.com/?target=http%3A//selenium-release.storage.googleapis.com/index.html)\n\nEdge浏览器驱动：[MicrosoftWebDriver](https://link.zhihu.com/?target=https%3A//developer.microsoft.com/en-us/microsoft-edge/tools/webdriver)\n\nOpera浏览器驱动：[operadriver](https://link.zhihu.com/?target=https%3A//github.com/operasoftware/operachromiumdriver/releases)\n\nPhantomJS浏览器驱动：[phantomjs](https://link.zhihu.com/?target=http%3A//phantomjs.org/)\n\n将驱动放到某个路径下，并在环境变量中指明。例如：\n\n驱动放在目录：`C:/abc/webdriver.exe`\n\n则需要在用户或者系统环境变量中，给Path变量添加新变量：`C:/abc`\n\n或者**指定驱动路径**\n\n```python\nfrom selenium import webdriver\npath = \"/path/to/chromedriver\" #注意这个路径需要时可执行路径（chmod 777 dir or 755 dir）\ndriver = webdriver.Chrome(executable_path=path)\n```\n\n不同的浏览器启动方式：\n\n```python\nfrom selenium import webdriver\ndriver = webdriver.Firefox()   # Firefox浏览器\n\ndriver = webdriver.Chrome()    # Chrome浏览器\n\ndriver = webdriver.Ie()        # Internet Explorer浏览器\n\ndriver = webdriver.Edge()      # Edge浏览器\n\ndriver = webdriver.Opera()     # Opera浏览器\n\ndriver = webdriver.PhantomJS()   # PhantomJS\n```\n\n# 3：浏览器选项和操作\n\n## 3.1 浏览器选项\n\n每次当selenium启动chrome浏览器的时候，chrome浏览器很干净，没有插件、没有收藏、没有历史记录，这是因为selenium在启动chrome时为了保证最快的运行效率，启动了一个裸浏览器，这就是为什么需要配置参数的原因，但是有些时候我们需要的不仅是一个裸浏览器。\n\nselenium启动配置参数接收是ChromeOptions类，创建方式如下：\n\n```python\nfrom selenium import webdriver\noption = webdriver.ChromeOptions()\n# 添加启动参数\noption.add_argument()\n\n# 添加扩展应用 \noption.add_extension()\noption.add_encoded_extension()\n\n# 添加实验性质的设置参数 \noption.add_experimental_option()\n\n# 设置调试器地址\noption.debugger_address()\n\n# 添加UA\noptions.add_argument('user-agent=\"MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1\"')\n\n# 指定浏览器分辨率\noptions.add_argument('window-size=1920x3000') \n\n# 谷歌文档提到需要加上这个属性来规避bug\nchrome_options.add_argument('--disable-gpu') \n\n # 隐藏滚动条, 应对一些特殊页面\noptions.add_argument('--hide-scrollbars')\n\n# 不加载图片, 提升速度\noptions.add_argument('blink-settings=imagesEnabled=false') \n\n# 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败\noptions.add_argument('--headless') \n\n# 以最高权限运行\noptions.add_argument('--no-sandbox')\n\n# 手动指定使用的浏览器位置\noptions.binary_location = r\"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\" \n\n#添加crx插件\noption.add_extension('d:\\crx\\AdBlock_v2.17.crx') \n\n# 禁用JavaScript\noption.add_argument(\"--disable-javascript\") \n\n# 设置开发者模式启动，该模式下webdriver属性为正常值\noptions.add_experimental_option('excludeSwitches', ['enable-automation']) \n\n# 禁用浏览器弹窗\nprefs = {  \n    'profile.default_content_setting_values' :  {  \n        'notifications' : 2  \n     }  \n}  \noptions.add_experimental_option('prefs',prefs)\n\ndriver=webdriver.Chrome(chrome_options=chrome_options)\n```\n\n其他配置参数\n\n```python\n–user-data-dir=”[PATH]” \n# 指定用户文件夹User Data路径，可以把书签这样的用户数据保存在系统分区以外的分区\n\n　　–disk-cache-dir=”[PATH]“ \n# 指定缓存Cache路径\n\n　　–disk-cache-size= \n# 指定Cache大小，单位Byte\n\n　　–first run \n# 重置到初始状态，第一次运行\n\n　　–incognito \n# 隐身模式启动\n\n　　–disable-javascript \n# 禁用Javascript\n\n　　--omnibox-popup-count=\"num\" \n# 将地址栏弹出的提示菜单数量改为num个\n\n　　--user-agent=\"xxxxxxxx\" \n# 修改HTTP请求头部的Agent字符串，可以通过about:version页面查看修改效果\n\n　　--disable-plugins \n# 禁止加载所有插件，可以增加速度。可以通过about:plugins页面查看效果\n\n　　--disable-javascript \n# 禁用JavaScript，如果觉得速度慢在加上这个\n\n　　--disable-java \n# 禁用java\n\n　　--start-maximized \n# 启动就最大化\n\n　　--no-sandbox \n# 取消沙盒模式\n\n　　--single-process \n# 单进程运行\n\n　　--process-per-tab \n# 每个标签使用单独进程\n\n　　--process-per-site \n# 每个站点使用单独进程\n\n　　--in-process-plugins \n# 插件不启用单独进程\n\n　　--disable-popup-blocking \n# 禁用弹出拦截\n\n　　--disable-plugins \n# 禁用插件\n\n　　--disable-images \n# 禁用图像\n\n　　--incognito \n# 启动进入隐身模式\n\n　　--enable-udd-profiles \n# 启用账户切换菜单\n\n　　--proxy-pac-url \n# 使用pac代理 [via 1/2]\n\n　　--lang=zh-CN \n# 设置语言为简体中文\n\n　　--disk-cache-dir \n# 自定义缓存目录\n\n　　--disk-cache-size \n# 自定义缓存最大值（单位byte）\n\n　　--media-cache-size \n# 自定义多媒体缓存最大值（单位byte）\n\n　　--bookmark-menu \n# 在工具 栏增加一个书签按钮\n\n　　--enable-sync \n# 启用书签同步\n```\n\n## 3.2 浏览器操作\n\n- 控制浏览器窗口大小\n\n```python\ndriver.set_window_size(480, 800)\n```\n\n- 浏览器后退，前进\n\n```python\n# 后退 \ndriver.back() \n# 前进 \ndriver.forward()\n```\n\n- 刷新\n\n```python\ndriver.refresh() # 刷新\n```\n\n# 4：元素定位和操作\n\n## 4.1 元素定位\n\n获取首个匹配元素：\n\n```python\nfind_element_by_id()\nfind_element_by_name()\nfind_element_by_class_name()\nfind_element_by_tag_name()\nfind_element_by_link_text()\nfind_element_by_partial_link_text()\nfind_element_by_xpath()\nfind_element_by_css_selector()\n```\n\n如果具有多个匹配属性元素，可使用：\n\n```python\nfind_elements_by_class_name()\n```\n\n即在element后加s\n\n## 4.2 输入、提交\n\n- 点击和输入\n\n```python\ndriver.find_element_by_id(\"kw\").clear() # 清楚文本 driver.find_element_by_id(\"kw\").send_keys(\"selenium\") # 模拟按键输入 driver.find_element_by_id(\"su\").click() # 单机元素\n```\n\n- 提交\n\n可以在搜索框模拟回车操作\n\n```python\nsearch_text = driver.find_element_by_id('kw') search_text.send_keys('selenium') \nsearch_text.submit()\n```\n\n- 其他\n\nsize： 返回元素的尺寸。\n\ntext： 获取元素的文本。\n\nget_attribute(name)： 获得属性值。\n\nis_displayed()： 设置该元素是否用户可见。\n\n## 4.3 鼠标操作\n\n在 WebDriver 中， 将这些关于鼠标操作的方法封装在 ActionChains 类提供。\n\nActionChains 类提供了鼠标操作的常用方法：\n\n```\nclick（on_element = None）-鼠标左键\n\nclick_and_hold（on_element = None）-单击鼠标左键，不松开\n\ncontext_click（on_element = None）-点击鼠标右键\n\ndouble_click（on_element = None）-双击鼠标左键\n\ndrag_and_drop（源，目标）-拖拽到某个元素然后松开\n\ndrag_and_drop_by_offset（source，xoffset，yoffset）-拖拽到某个坐标然后松开\n\nkey_down（value，element = None）-点击某个键盘上的键\n\nkey_up（value，element = None）-松开某个键\n\nmove_by_offset（xoffset，yoffset）-鼠标从当前位置移动到某个坐标\n\nmove_to_element（to_element）-鼠标移动到某个元素\n\nmove_to_element_with_offset（to_element，xoffset，yoffset）-移动到距离某个元素（左上角坐标）多少距离的位置\n\nperform（）-执行链中的所有动作\n\n释放（on_element = None）-在某个元素位置松开鼠标左键\n\nsend_keys（* keys_to_send）-发送某个键到当前焦点的元素\n\nsend_keys_to_element（element，* keys_to_send）-发送某个键到指定元素\n```\n\n举个例子：\n\n```python\nfrom selenium import webdriver\n# 引入 ActionChains 类\nfrom selenium.webdriver.common.action_chains import ActionChains\n\ndriver = webdriver.Chrome()\ndriver.get(\"https://www.baidu.cn\")\n\n# 定位到要悬停的元素\nabove = driver.find_element_by_link_text(\"设置\")\n# 对定位到的元素执行鼠标悬停操作\nActionChains(driver).move_to_element(above).perform()\n```\n\n## 4.4 键盘事件\n\n以下为常用的键盘操作：\n\n- send_keys(Keys.BACK_SPACE) 删除键（BackSpace）\n- send_keys(Keys.SPACE) 空格键(Space)\n- send_keys(Keys.TAB) 制表键(Tab)\n- send_keys(Keys.ESCAPE) 回退键（Esc）\n- send_keys(Keys.ENTER) 回车键（Enter）\n- send_keys(Keys.CONTROL,'a') 全选（Ctrl+A）\n- send_keys(Keys.CONTROL,'c') 复制（Ctrl+C）\n- send_keys(Keys.CONTROL,'x') 剪切（Ctrl+X）\n- send_keys(Keys.CONTROL,'v') 粘贴（Ctrl+V）\n- send_keys(Keys.F1) 键盘 F1\n- ……\n- send_keys(Keys.F12) 键盘 F12\n\n```python\n# 输入框输入内容\ndriver.find_element_by_id(\"kw\").send_keys(\"seleniumm\")\n\n# 删除多输入的一个 m\ndriver.find_element_by_id(\"kw\").send_keys(Keys.BACK_SPACE)\n```\n\n## 4.5 获取断言信息\n\n```python\ntitle = driver.title # 打印当前页面title\nnow_url = driver.current_url # 打印当前页面URL\nuser = driver.find_element_by_class_name('nums').text # # 获取结果数目\n```\n\n## 4.6 等待页面加载完成\n\n- 显示等待\n\n显式等待使WebdDriver等待某个条件成立时继续执行，否则在达到最大时长时抛出超时异常（TimeoutException）。\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver.support import expected_conditions as EC\n\ndriver = webdriver.Firefox()\ndriver.get(\"http://www.baidu.com\")\n\nelement = WebDriverWait(driver, 5, 0.5).until(\n                      EC.presence_of_element_located((By.ID, \"kw\"))\n                      )\nelement.send_keys('selenium')\ndriver.quit()\n```\n\nWebDriverWait类是由WebDirver 提供的等待方法。在设置时间内，默认每隔一段时间检测一次当前页面元素是否存在，如果超过设置时间检测不到则抛出异常。具体格式如下：\n\n```python\nWebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)\n```\n\n- driver ：浏览器驱动。\n- timeout ：最长超时时间，默认以秒为单位。\n- poll_frequency ：检测的间隔（步长）时间，默认为0.5S。\n- ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。\n- WebDriverWait()一般由until()或until_not()方法配合使用，下面是until()和until_not()方法的说明。\n- until(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为True。\n- until_not(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为False。\n\n在本例中，通过as关键字将expected_conditions 重命名为EC，并调用presence_of_element_located()方法判断元素是否存在。\n\n- 隐式等待\n\n如果某些元素不是立即可用的，隐式等待是告诉WebDriver去等待一定的时间后去查找元素。 默认等待时间是0秒，一旦设置该值，隐式等待是设置该WebDriver的实例的生命周期。\n\n```python\nfrom selenium import webdriver\ndriver = webdriver.Firefox()    \ndriver.implicitly_wait(10) # seconds    \ndriver.get(\"http://somedomain/url_that_delays_loading\")    \nmyDynamicElement = driver.find_element_by_id(\"myDynamicElement\") \n```\n\n## 4.7 在不同的iframe之间移动\n\n```python\ndriver.switch_to_window(\"windowName\")\ndriver.switch_to_frame(\"frameName\")\n```\n\n以直接取表单的id 或name属性。如果iframe没有可用的id和name属性，则可以通过下面的方式进行定位。\n\n```python\n#先通过xpth定位到iframe\nxf = driver.find_element_by_xpath('//*[@id=\"x-URS-iframe\"]')\n\n#再将定位对象传给switch_to_frame()方法\ndriver.switch_to_frame(xf)\n```\n\n一旦我们完成了frame中的工作，我们可以这样返回父frame:\n\n```python\ndriver.switch_to_default_content()\n```\n\n## 4.8 警告框处理\n\n```python\nalert = driver.switch_to_alert()\n```\n\n- text：返回 alert/confirm/prompt 中的文字信息。\n- accept()：接受现有警告框。\n- dismiss()：解散现有警告框。\n- send_keys(keysToSend)：发送文本至警告框。keysToSend：将文本发送至警告框。\n\n## 4.9 下拉框选择\n\n```text\nfrom selenium import webdriver\nfrom selenium.webdriver.support.select import Select\nfrom time import sleep\n\ndriver = webdriver.Chrome()\ndriver.implicitly_wait(10)\ndriver.get('http://www.baidu.com')\nsel = driver.find_element_by_xpath(\"//select[@id='nr']\")\nSelect(sel).select_by_value('50')  # 显示50条\n```\n\n## 4.10 文件上传\n\n```text\ndriver.find_element_by_name(\"file\").send_keys('D:\\\\upload_file.txt')  # # 定位上传按钮，添加本地文件\n```\n\n## 4.11 cookie操作\n\nWebDriver操作cookie的方法：\n\n- get_cookies()： 获得所有cookie信息。\n- get_cookie(name)： 返回字典的key为“name”的cookie信息。\n- add_cookie(cookie_dict) ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。\n- delete_cookie(name,optionsString)：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。\n- delete_all_cookies()： 删除所有cookie信息\n\n## 4.12 调用JavaScript代码\n\n```python\njs=\"window.scrollTo(100,450);\"\ndriver.execute_script(js) # 通过javascript设置浏览器窗口的滚动条位置\n```\n\n通过execute_script()方法执行JavaScripts代码来移动滚动条的位置。\n\n## 4.13 窗口截图\n\n```python\ndriver.get_screenshot_as_file(\"D:\\\\baidu_img.jpg\") # 截取当前窗口，并指定截图图片的保存位置\n```\n\n## 4.14 关闭浏览器\n\n- close() 关闭单个窗口\n- quit() 关闭所有窗口\n\n## 4.15 直接用cookie登录方法\n\n链接：[https://www.jianshu.com/p/773c58406bdb](https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/773c58406bdb)\n\n1. 手动获取网页的cookie，将其序列化并存储在本地\n2. 写入代码\n\n```python\nfor item in cookies:\n    driver.add_cookie(item)\n```\n\n## 4.16 导出html到beautifulsoup或文件\n\n```python\nsoup = BeautifulSoup(driver.page_source,\"html.parser\")\n```\n\n```python\ndef writetohtml(driver,path):\n    f = open(path,'wb')\n    f.write(driver.page_source.encode(\"utf-8\", \"ignore\"))\n    f.close()   \n```\n\n# 5：控件操作\n\n## 5.1 Select\n\n`Select`类提供了三种选择某些选项的方法：\n\n```python\nselect_by_index(index)\nselect_by_value(value)\nselect_by_visible_text(text)\n```\n\n> index从0开始，第一个option为0\n>\n> value是标签的属性值\n>\n> visible_text是option标签中间的值，即下拉框可见值\n\n自然的，有选择必然有反选，即取消选择。`Select`提供了四个方法给我们取消原来的选择：\n\n```\ndeselect_by_index(index)\ndeselect_by_value(value)\ndeselect_by_visible_text(text)\ndeselect_all()\n```\n\n前一种分别于`select`相对应，第四种是全部取消选择，是的，你没看错，是全部取消。有一种特殊的选择标签，即设置了`multiple=\"multiple\"`属性的`select`，这种`select`框是可以多选的，你可以通过多次`select`，选择多个选项，而通过`deselect_all()`来将他们全部取消。\n\n当我们选择了选项之后，想要看看选择的是哪项，替代的是否是我想选的，怎么办？别担心，`Select`为你提供了相应的方法（或者应该说是属性了）：\n\n```\noptions\nall_selected_options\nfirst_selected_option\n```\n\n上面三个属性，分别返回这个`select`元素所有的`options`，所有被选中的`options`以及第一个被选中的`option`。\n\n## 5.2 Radio和Checkbox\n\n```html\n<html>\n<body>\nCheckbox:\n<input type=\"checkbox\" value=\"cv1\" name=\"c1\">\n<input type=\"checkbox\" value=\"cv2\">\n<input type=\"checkbox\" value=\"cv3\" name=\"c1\">\n<input type=\"checkbox\" value=\"cv4\">\n<p>\nRadio:\n<input type=\"radio\" value=\"rv1\" name=\"r1\">\n<input type=\"radio\" value=\"rv2\" name=\"r1\">\n</body>\n</html>\n```\n\n选择操作即点击事件，清除选择即键盘操作\n\n```python\n# checkbox\ndriver.find_element_by_xpath('//input[@value=\"cv1\"]').click()  # click\ndriver.find_element_by_xpath('//input[@value=\"cv2\"]').send_keys(Keys.SPACE)  # send space\n\n# radio\ndriver.find_element_by_xpath('//input[@value=\"rv1\"]').send_keys(Keys.SPACE)  # send space\nsleep(1)\ndriver.find_element_by_xpath('//input[@value=\"rv2\"]').click()  # click\n```\n\n# 6：参考资料\n\n《[Selenium Python 教程](https://zhuanlan.zhihu.com/p/111859925)》\n\n《[selenium启动Chrome配置参数问题](https://zhuanlan.zhihu.com/p/60852696)》\n\n《[Python硒-模拟鼠标键盘操作（ActionChains）](https://huilansame.github.io/huilansame.github.io/archivers/mouse-and-keyboard-actionchains)》\n\n《[Python硒-操作选择标签的下拉选择框](https://huilansame.github.io/huilansame.github.io/archivers/drop-down-select)》\n\n《[Python+selenium使用cookie登录淘宝](https://www.jianshu.com/p/773c58406bdb)》","slug":"Selenium常用操作记录","published":1,"updated":"2020-09-18T19:30:23.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaes006fp0vz56q8g95k","content":"<h1 id=\"1：Selenium简介\"><a href=\"#1：Selenium简介\" class=\"headerlink\" title=\"1：Selenium简介\"></a>1：Selenium简介</h1><p>Selenium库是一个用于浏览器自动化pyhon库。对提高爬虫容错率有很好的效果。它可用于驱动浏览器，来帮助我们实现获取网站js脚本执行后的网页。</p>\n<h1 id=\"2：Selenium安装\"><a href=\"#2：Selenium安装\" class=\"headerlink\" title=\"2：Selenium安装\"></a>2：Selenium安装</h1><h2 id=\"2-1-安装\"><a href=\"#2-1-安装\" class=\"headerlink\" title=\"2.1 安装\"></a>2.1 安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install selenium</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-浏览器驱动\"><a href=\"#2-2-浏览器驱动\" class=\"headerlink\" title=\"2.2 浏览器驱动\"></a>2.2 浏览器驱动</h2><p>下载浏览器驱动：</p>\n<p>Firefox浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://github.com/mozilla/geckodriver/releases\">geckodriver</a></p>\n<p>Chrome浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://sites.google.com/a/chromium.org/chromedriver/home\">chromedriver</a> , <a href=\"https://link.zhihu.com/?target=https://npm.taobao.org/mirrors/chromedriver\">taobao备用地址</a></p>\n<p>IE浏览器驱动：<a href=\"https://link.zhihu.com/?target=http://selenium-release.storage.googleapis.com/index.html\">IEDriverServer</a></p>\n<p>Edge浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver\">MicrosoftWebDriver</a></p>\n<p>Opera浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://github.com/operasoftware/operachromiumdriver/releases\">operadriver</a></p>\n<p>PhantomJS浏览器驱动：<a href=\"https://link.zhihu.com/?target=http://phantomjs.org/\">phantomjs</a></p>\n<p>将驱动放到某个路径下，并在环境变量中指明。例如：</p>\n<p>驱动放在目录：<code>C:/abc/webdriver.exe</code></p>\n<p>则需要在用户或者系统环境变量中，给Path变量添加新变量：<code>C:/abc</code></p>\n<p>或者<strong>指定驱动路径</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">path = <span class=\"string\">&quot;/path/to/chromedriver&quot;</span> <span class=\"comment\">#注意这个路径需要时可执行路径（chmod 777 dir or 755 dir）</span></span><br><span class=\"line\">driver = webdriver.Chrome(executable_path=path)</span><br></pre></td></tr></table></figure>\n\n<p>不同的浏览器启动方式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">driver = webdriver.Firefox()   <span class=\"comment\"># Firefox浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Chrome()    <span class=\"comment\"># Chrome浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Ie()        <span class=\"comment\"># Internet Explorer浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Edge()      <span class=\"comment\"># Edge浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Opera()     <span class=\"comment\"># Opera浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.PhantomJS()   <span class=\"comment\"># PhantomJS</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：浏览器选项和操作\"><a href=\"#3：浏览器选项和操作\" class=\"headerlink\" title=\"3：浏览器选项和操作\"></a>3：浏览器选项和操作</h1><h2 id=\"3-1-浏览器选项\"><a href=\"#3-1-浏览器选项\" class=\"headerlink\" title=\"3.1 浏览器选项\"></a>3.1 浏览器选项</h2><p>每次当selenium启动chrome浏览器的时候，chrome浏览器很干净，没有插件、没有收藏、没有历史记录，这是因为selenium在启动chrome时为了保证最快的运行效率，启动了一个裸浏览器，这就是为什么需要配置参数的原因，但是有些时候我们需要的不仅是一个裸浏览器。</p>\n<p>selenium启动配置参数接收是ChromeOptions类，创建方式如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">option = webdriver.ChromeOptions()</span><br><span class=\"line\"><span class=\"comment\"># 添加启动参数</span></span><br><span class=\"line\">option.add_argument()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加扩展应用 </span></span><br><span class=\"line\">option.add_extension()</span><br><span class=\"line\">option.add_encoded_extension()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加实验性质的设置参数 </span></span><br><span class=\"line\">option.add_experimental_option()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置调试器地址</span></span><br><span class=\"line\">option.debugger_address()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加UA</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;user-agent=&quot;MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1&quot;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定浏览器分辨率</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;window-size=1920x3000&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 谷歌文档提到需要加上这个属性来规避bug</span></span><br><span class=\"line\">chrome_options.add_argument(<span class=\"string\">&#x27;--disable-gpu&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># 隐藏滚动条, 应对一些特殊页面</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;--hide-scrollbars&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 不加载图片, 提升速度</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;blink-settings=imagesEnabled=false&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;--headless&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以最高权限运行</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;--no-sandbox&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 手动指定使用的浏览器位置</span></span><br><span class=\"line\">options.binary_location = <span class=\"string\">r&quot;C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe&quot;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加crx插件</span></span><br><span class=\"line\">option.add_extension(<span class=\"string\">&#x27;d:\\crx\\AdBlock_v2.17.crx&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用JavaScript</span></span><br><span class=\"line\">option.add_argument(<span class=\"string\">&quot;--disable-javascript&quot;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置开发者模式启动，该模式下webdriver属性为正常值</span></span><br><span class=\"line\">options.add_experimental_option(<span class=\"string\">&#x27;excludeSwitches&#x27;</span>, [<span class=\"string\">&#x27;enable-automation&#x27;</span>]) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用浏览器弹窗</span></span><br><span class=\"line\">prefs = &#123;  </span><br><span class=\"line\">    <span class=\"string\">&#x27;profile.default_content_setting_values&#x27;</span> :  &#123;  </span><br><span class=\"line\">        <span class=\"string\">&#x27;notifications&#x27;</span> : <span class=\"number\">2</span>  </span><br><span class=\"line\">     &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">options.add_experimental_option(<span class=\"string\">&#x27;prefs&#x27;</span>,prefs)</span><br><span class=\"line\"></span><br><span class=\"line\">driver=webdriver.Chrome(chrome_options=chrome_options)</span><br></pre></td></tr></table></figure>\n\n<p>其他配置参数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">–user-data-dir=”[PATH]” </span><br><span class=\"line\"><span class=\"comment\"># 指定用户文件夹User Data路径，可以把书签这样的用户数据保存在系统分区以外的分区</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–disk-cache-dir=”[PATH]“ </span><br><span class=\"line\"><span class=\"comment\"># 指定缓存Cache路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–disk-cache-size= </span><br><span class=\"line\"><span class=\"comment\"># 指定Cache大小，单位Byte</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–first run </span><br><span class=\"line\"><span class=\"comment\"># 重置到初始状态，第一次运行</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–incognito </span><br><span class=\"line\"><span class=\"comment\"># 隐身模式启动</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–disable-javascript </span><br><span class=\"line\"><span class=\"comment\"># 禁用Javascript</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--omnibox-popup-count=<span class=\"string\">&quot;num&quot;</span> </span><br><span class=\"line\"><span class=\"comment\"># 将地址栏弹出的提示菜单数量改为num个</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--user-agent=<span class=\"string\">&quot;xxxxxxxx&quot;</span> </span><br><span class=\"line\"><span class=\"comment\"># 修改HTTP请求头部的Agent字符串，可以通过about:version页面查看修改效果</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-plugins </span><br><span class=\"line\"><span class=\"comment\"># 禁止加载所有插件，可以增加速度。可以通过about:plugins页面查看效果</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-javascript </span><br><span class=\"line\"><span class=\"comment\"># 禁用JavaScript，如果觉得速度慢在加上这个</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-java </span><br><span class=\"line\"><span class=\"comment\"># 禁用java</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--start-maximized </span><br><span class=\"line\"><span class=\"comment\"># 启动就最大化</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--no-sandbox </span><br><span class=\"line\"><span class=\"comment\"># 取消沙盒模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--single-process </span><br><span class=\"line\"><span class=\"comment\"># 单进程运行</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--process-per-tab </span><br><span class=\"line\"><span class=\"comment\"># 每个标签使用单独进程</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--process-per-site </span><br><span class=\"line\"><span class=\"comment\"># 每个站点使用单独进程</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--<span class=\"keyword\">in</span>-process-plugins </span><br><span class=\"line\"><span class=\"comment\"># 插件不启用单独进程</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-popup-blocking </span><br><span class=\"line\"><span class=\"comment\"># 禁用弹出拦截</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-plugins </span><br><span class=\"line\"><span class=\"comment\"># 禁用插件</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-images </span><br><span class=\"line\"><span class=\"comment\"># 禁用图像</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--incognito </span><br><span class=\"line\"><span class=\"comment\"># 启动进入隐身模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--enable-udd-profiles </span><br><span class=\"line\"><span class=\"comment\"># 启用账户切换菜单</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--proxy-pac-url </span><br><span class=\"line\"><span class=\"comment\"># 使用pac代理 [via 1/2]</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--lang=zh-CN </span><br><span class=\"line\"><span class=\"comment\"># 设置语言为简体中文</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disk-cache-dir </span><br><span class=\"line\"><span class=\"comment\"># 自定义缓存目录</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disk-cache-size </span><br><span class=\"line\"><span class=\"comment\"># 自定义缓存最大值（单位byte）</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--media-cache-size </span><br><span class=\"line\"><span class=\"comment\"># 自定义多媒体缓存最大值（单位byte）</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--bookmark-menu </span><br><span class=\"line\"><span class=\"comment\"># 在工具 栏增加一个书签按钮</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--enable-sync </span><br><span class=\"line\"><span class=\"comment\"># 启用书签同步</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-浏览器操作\"><a href=\"#3-2-浏览器操作\" class=\"headerlink\" title=\"3.2 浏览器操作\"></a>3.2 浏览器操作</h2><ul>\n<li>控制浏览器窗口大小</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.set_window_size(<span class=\"number\">480</span>, <span class=\"number\">800</span>)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>浏览器后退，前进</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 后退 </span></span><br><span class=\"line\">driver.back() </span><br><span class=\"line\"><span class=\"comment\"># 前进 </span></span><br><span class=\"line\">driver.forward()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刷新</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.refresh() <span class=\"comment\"># 刷新</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：元素定位和操作\"><a href=\"#4：元素定位和操作\" class=\"headerlink\" title=\"4：元素定位和操作\"></a>4：元素定位和操作</h1><h2 id=\"4-1-元素定位\"><a href=\"#4-1-元素定位\" class=\"headerlink\" title=\"4.1 元素定位\"></a>4.1 元素定位</h2><p>获取首个匹配元素：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_element_by_id()</span><br><span class=\"line\">find_element_by_name()</span><br><span class=\"line\">find_element_by_class_name()</span><br><span class=\"line\">find_element_by_tag_name()</span><br><span class=\"line\">find_element_by_link_text()</span><br><span class=\"line\">find_element_by_partial_link_text()</span><br><span class=\"line\">find_element_by_xpath()</span><br><span class=\"line\">find_element_by_css_selector()</span><br></pre></td></tr></table></figure>\n\n<p>如果具有多个匹配属性元素，可使用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_elements_by_class_name()</span><br></pre></td></tr></table></figure>\n\n<p>即在element后加s</p>\n<h2 id=\"4-2-输入、提交\"><a href=\"#4-2-输入、提交\" class=\"headerlink\" title=\"4.2 输入、提交\"></a>4.2 输入、提交</h2><ul>\n<li>点击和输入</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.find_element_by_id(<span class=\"string\">&quot;kw&quot;</span>).clear() <span class=\"comment\"># 清楚文本 driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;) # 模拟按键输入 driver.find_element_by_id(&quot;su&quot;).click() # 单机元素</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>提交</li>\n</ul>\n<p>可以在搜索框模拟回车操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search_text = driver.find_element_by_id(<span class=\"string\">&#x27;kw&#x27;</span>) search_text.send_keys(<span class=\"string\">&#x27;selenium&#x27;</span>) </span><br><span class=\"line\">search_text.submit()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>其他</li>\n</ul>\n<p>size： 返回元素的尺寸。</p>\n<p>text： 获取元素的文本。</p>\n<p>get_attribute(name)： 获得属性值。</p>\n<p>is_displayed()： 设置该元素是否用户可见。</p>\n<h2 id=\"4-3-鼠标操作\"><a href=\"#4-3-鼠标操作\" class=\"headerlink\" title=\"4.3 鼠标操作\"></a>4.3 鼠标操作</h2><p>在 WebDriver 中， 将这些关于鼠标操作的方法封装在 ActionChains 类提供。</p>\n<p>ActionChains 类提供了鼠标操作的常用方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">click（on_element &#x3D; None）-鼠标左键</span><br><span class=\"line\"></span><br><span class=\"line\">click_and_hold（on_element &#x3D; None）-单击鼠标左键，不松开</span><br><span class=\"line\"></span><br><span class=\"line\">context_click（on_element &#x3D; None）-点击鼠标右键</span><br><span class=\"line\"></span><br><span class=\"line\">double_click（on_element &#x3D; None）-双击鼠标左键</span><br><span class=\"line\"></span><br><span class=\"line\">drag_and_drop（源，目标）-拖拽到某个元素然后松开</span><br><span class=\"line\"></span><br><span class=\"line\">drag_and_drop_by_offset（source，xoffset，yoffset）-拖拽到某个坐标然后松开</span><br><span class=\"line\"></span><br><span class=\"line\">key_down（value，element &#x3D; None）-点击某个键盘上的键</span><br><span class=\"line\"></span><br><span class=\"line\">key_up（value，element &#x3D; None）-松开某个键</span><br><span class=\"line\"></span><br><span class=\"line\">move_by_offset（xoffset，yoffset）-鼠标从当前位置移动到某个坐标</span><br><span class=\"line\"></span><br><span class=\"line\">move_to_element（to_element）-鼠标移动到某个元素</span><br><span class=\"line\"></span><br><span class=\"line\">move_to_element_with_offset（to_element，xoffset，yoffset）-移动到距离某个元素（左上角坐标）多少距离的位置</span><br><span class=\"line\"></span><br><span class=\"line\">perform（）-执行链中的所有动作</span><br><span class=\"line\"></span><br><span class=\"line\">释放（on_element &#x3D; None）-在某个元素位置松开鼠标左键</span><br><span class=\"line\"></span><br><span class=\"line\">send_keys（* keys_to_send）-发送某个键到当前焦点的元素</span><br><span class=\"line\"></span><br><span class=\"line\">send_keys_to_element（element，* keys_to_send）-发送某个键到指定元素</span><br></pre></td></tr></table></figure>\n\n<p>举个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"comment\"># 引入 ActionChains 类</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.action_chains <span class=\"keyword\">import</span> ActionChains</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Chrome()</span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;https://www.baidu.cn&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 定位到要悬停的元素</span></span><br><span class=\"line\">above = driver.find_element_by_link_text(<span class=\"string\">&quot;设置&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 对定位到的元素执行鼠标悬停操作</span></span><br><span class=\"line\">ActionChains(driver).move_to_element(above).perform()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-键盘事件\"><a href=\"#4-4-键盘事件\" class=\"headerlink\" title=\"4.4 键盘事件\"></a>4.4 键盘事件</h2><p>以下为常用的键盘操作：</p>\n<ul>\n<li>send_keys(Keys.BACK_SPACE) 删除键（BackSpace）</li>\n<li>send_keys(Keys.SPACE) 空格键(Space)</li>\n<li>send_keys(Keys.TAB) 制表键(Tab)</li>\n<li>send_keys(Keys.ESCAPE) 回退键（Esc）</li>\n<li>send_keys(Keys.ENTER) 回车键（Enter）</li>\n<li>send_keys(Keys.CONTROL,’a’) 全选（Ctrl+A）</li>\n<li>send_keys(Keys.CONTROL,’c’) 复制（Ctrl+C）</li>\n<li>send_keys(Keys.CONTROL,’x’) 剪切（Ctrl+X）</li>\n<li>send_keys(Keys.CONTROL,’v’) 粘贴（Ctrl+V）</li>\n<li>send_keys(Keys.F1) 键盘 F1</li>\n<li>……</li>\n<li>send_keys(Keys.F12) 键盘 F12</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输入框输入内容</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">&quot;kw&quot;</span>).send_keys(<span class=\"string\">&quot;seleniumm&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除多输入的一个 m</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">&quot;kw&quot;</span>).send_keys(Keys.BACK_SPACE)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-5-获取断言信息\"><a href=\"#4-5-获取断言信息\" class=\"headerlink\" title=\"4.5 获取断言信息\"></a>4.5 获取断言信息</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title = driver.title <span class=\"comment\"># 打印当前页面title</span></span><br><span class=\"line\">now_url = driver.current_url <span class=\"comment\"># 打印当前页面URL</span></span><br><span class=\"line\">user = driver.find_element_by_class_name(<span class=\"string\">&#x27;nums&#x27;</span>).text <span class=\"comment\"># # 获取结果数目</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-6-等待页面加载完成\"><a href=\"#4-6-等待页面加载完成\" class=\"headerlink\" title=\"4.6 等待页面加载完成\"></a>4.6 等待页面加载完成</h2><ul>\n<li>显示等待</li>\n</ul>\n<p>显式等待使WebdDriver等待某个条件成立时继续执行，否则在达到最大时长时抛出超时异常（TimeoutException）。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> WebDriverWait</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support <span class=\"keyword\">import</span> expected_conditions <span class=\"keyword\">as</span> EC</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Firefox()</span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;http://www.baidu.com&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">element = WebDriverWait(driver, <span class=\"number\">5</span>, <span class=\"number\">0.5</span>).until(</span><br><span class=\"line\">                      EC.presence_of_element_located((By.ID, <span class=\"string\">&quot;kw&quot;</span>))</span><br><span class=\"line\">                      )</span><br><span class=\"line\">element.send_keys(<span class=\"string\">&#x27;selenium&#x27;</span>)</span><br><span class=\"line\">driver.quit()</span><br></pre></td></tr></table></figure>\n\n<p>WebDriverWait类是由WebDirver 提供的等待方法。在设置时间内，默认每隔一段时间检测一次当前页面元素是否存在，如果超过设置时间检测不到则抛出异常。具体格式如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WebDriverWait(driver, timeout, poll_frequency=<span class=\"number\">0.5</span>, ignored_exceptions=<span class=\"literal\">None</span>)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>driver ：浏览器驱动。</li>\n<li>timeout ：最长超时时间，默认以秒为单位。</li>\n<li>poll_frequency ：检测的间隔（步长）时间，默认为0.5S。</li>\n<li>ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。</li>\n<li>WebDriverWait()一般由until()或until_not()方法配合使用，下面是until()和until_not()方法的说明。</li>\n<li>until(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为True。</li>\n<li>until_not(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为False。</li>\n</ul>\n<p>在本例中，通过as关键字将expected_conditions 重命名为EC，并调用presence_of_element_located()方法判断元素是否存在。</p>\n<ul>\n<li>隐式等待</li>\n</ul>\n<p>如果某些元素不是立即可用的，隐式等待是告诉WebDriver去等待一定的时间后去查找元素。 默认等待时间是0秒，一旦设置该值，隐式等待是设置该WebDriver的实例的生命周期。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">driver = webdriver.Firefox()    </span><br><span class=\"line\">driver.implicitly_wait(<span class=\"number\">10</span>) <span class=\"comment\"># seconds    </span></span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;http://somedomain/url_that_delays_loading&quot;</span>)    </span><br><span class=\"line\">myDynamicElement = driver.find_element_by_id(<span class=\"string\">&quot;myDynamicElement&quot;</span>) </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-7-在不同的iframe之间移动\"><a href=\"#4-7-在不同的iframe之间移动\" class=\"headerlink\" title=\"4.7 在不同的iframe之间移动\"></a>4.7 在不同的iframe之间移动</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.switch_to_window(<span class=\"string\">&quot;windowName&quot;</span>)</span><br><span class=\"line\">driver.switch_to_frame(<span class=\"string\">&quot;frameName&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以直接取表单的id 或name属性。如果iframe没有可用的id和name属性，则可以通过下面的方式进行定位。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#先通过xpth定位到iframe</span></span><br><span class=\"line\">xf = driver.find_element_by_xpath(<span class=\"string\">&#x27;//*[@id=&quot;x-URS-iframe&quot;]&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#再将定位对象传给switch_to_frame()方法</span></span><br><span class=\"line\">driver.switch_to_frame(xf)</span><br></pre></td></tr></table></figure>\n\n<p>一旦我们完成了frame中的工作，我们可以这样返回父frame:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.switch_to_default_content()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-8-警告框处理\"><a href=\"#4-8-警告框处理\" class=\"headerlink\" title=\"4.8 警告框处理\"></a>4.8 警告框处理</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alert = driver.switch_to_alert()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>text：返回 alert/confirm/prompt 中的文字信息。</li>\n<li>accept()：接受现有警告框。</li>\n<li>dismiss()：解散现有警告框。</li>\n<li>send_keys(keysToSend)：发送文本至警告框。keysToSend：将文本发送至警告框。</li>\n</ul>\n<h2 id=\"4-9-下拉框选择\"><a href=\"#4-9-下拉框选择\" class=\"headerlink\" title=\"4.9 下拉框选择\"></a>4.9 下拉框选择</h2><figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from selenium import webdriver</span><br><span class=\"line\">from selenium.webdriver.support.select import Select</span><br><span class=\"line\">from time import sleep</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Chrome()</span><br><span class=\"line\">driver.implicitly_wait(10)</span><br><span class=\"line\">driver.get(&#x27;http://www.baidu.com&#x27;)</span><br><span class=\"line\">sel = driver.find_element_by_xpath(&quot;//select[@id=&#x27;nr&#x27;]&quot;)</span><br><span class=\"line\">Select(sel).select_by_value(&#x27;50&#x27;)  # 显示50条</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-10-文件上传\"><a href=\"#4-10-文件上传\" class=\"headerlink\" title=\"4.10 文件上传\"></a>4.10 文件上传</h2><figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.find_element_by_name(&quot;file&quot;).send_keys(&#x27;D:\\\\upload_file.txt&#x27;)  # # 定位上传按钮，添加本地文件</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-11-cookie操作\"><a href=\"#4-11-cookie操作\" class=\"headerlink\" title=\"4.11 cookie操作\"></a>4.11 cookie操作</h2><p>WebDriver操作cookie的方法：</p>\n<ul>\n<li>get_cookies()： 获得所有cookie信息。</li>\n<li>get_cookie(name)： 返回字典的key为“name”的cookie信息。</li>\n<li>add_cookie(cookie_dict) ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。</li>\n<li>delete_cookie(name,optionsString)：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。</li>\n<li>delete_all_cookies()： 删除所有cookie信息</li>\n</ul>\n<h2 id=\"4-12-调用JavaScript代码\"><a href=\"#4-12-调用JavaScript代码\" class=\"headerlink\" title=\"4.12 调用JavaScript代码\"></a>4.12 调用JavaScript代码</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">js=<span class=\"string\">&quot;window.scrollTo(100,450);&quot;</span></span><br><span class=\"line\">driver.execute_script(js) <span class=\"comment\"># 通过javascript设置浏览器窗口的滚动条位置</span></span><br></pre></td></tr></table></figure>\n\n<p>通过execute_script()方法执行JavaScripts代码来移动滚动条的位置。</p>\n<h2 id=\"4-13-窗口截图\"><a href=\"#4-13-窗口截图\" class=\"headerlink\" title=\"4.13 窗口截图\"></a>4.13 窗口截图</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.get_screenshot_as_file(<span class=\"string\">&quot;D:\\\\baidu_img.jpg&quot;</span>) <span class=\"comment\"># 截取当前窗口，并指定截图图片的保存位置</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-14-关闭浏览器\"><a href=\"#4-14-关闭浏览器\" class=\"headerlink\" title=\"4.14 关闭浏览器\"></a>4.14 关闭浏览器</h2><ul>\n<li>close() 关闭单个窗口</li>\n<li>quit() 关闭所有窗口</li>\n</ul>\n<h2 id=\"4-15-直接用cookie登录方法\"><a href=\"#4-15-直接用cookie登录方法\" class=\"headerlink\" title=\"4.15 直接用cookie登录方法\"></a>4.15 直接用cookie登录方法</h2><p>链接：<a href=\"https://link.zhihu.com/?target=https://www.jianshu.com/p/773c58406bdb\">https://www.jianshu.com/p/773c58406bdb</a></p>\n<ol>\n<li>手动获取网页的cookie，将其序列化并存储在本地</li>\n<li>写入代码</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> cookies:</span><br><span class=\"line\">    driver.add_cookie(item)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-16-导出html到beautifulsoup或文件\"><a href=\"#4-16-导出html到beautifulsoup或文件\" class=\"headerlink\" title=\"4.16 导出html到beautifulsoup或文件\"></a>4.16 导出html到beautifulsoup或文件</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">soup = BeautifulSoup(driver.page_source,<span class=\"string\">&quot;html.parser&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">writetohtml</span>(<span class=\"params\">driver,path</span>):</span></span><br><span class=\"line\">    f = open(path,<span class=\"string\">&#x27;wb&#x27;</span>)</span><br><span class=\"line\">    f.write(driver.page_source.encode(<span class=\"string\">&quot;utf-8&quot;</span>, <span class=\"string\">&quot;ignore&quot;</span>))</span><br><span class=\"line\">    f.close()   </span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：控件操作\"><a href=\"#5：控件操作\" class=\"headerlink\" title=\"5：控件操作\"></a>5：控件操作</h1><h2 id=\"5-1-Select\"><a href=\"#5-1-Select\" class=\"headerlink\" title=\"5.1 Select\"></a>5.1 Select</h2><p><code>Select</code>类提供了三种选择某些选项的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select_by_index(index)</span><br><span class=\"line\">select_by_value(value)</span><br><span class=\"line\">select_by_visible_text(text)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>index从0开始，第一个option为0</p>\n<p>value是标签的属性值</p>\n<p>visible_text是option标签中间的值，即下拉框可见值</p>\n</blockquote>\n<p>自然的，有选择必然有反选，即取消选择。<code>Select</code>提供了四个方法给我们取消原来的选择：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deselect_by_index(index)</span><br><span class=\"line\">deselect_by_value(value)</span><br><span class=\"line\">deselect_by_visible_text(text)</span><br><span class=\"line\">deselect_all()</span><br></pre></td></tr></table></figure>\n\n<p>前一种分别于<code>select</code>相对应，第四种是全部取消选择，是的，你没看错，是全部取消。有一种特殊的选择标签，即设置了<code>multiple=&quot;multiple&quot;</code>属性的<code>select</code>，这种<code>select</code>框是可以多选的，你可以通过多次<code>select</code>，选择多个选项，而通过<code>deselect_all()</code>来将他们全部取消。</p>\n<p>当我们选择了选项之后，想要看看选择的是哪项，替代的是否是我想选的，怎么办？别担心，<code>Select</code>为你提供了相应的方法（或者应该说是属性了）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options</span><br><span class=\"line\">all_selected_options</span><br><span class=\"line\">first_selected_option</span><br></pre></td></tr></table></figure>\n\n<p>上面三个属性，分别返回这个<code>select</code>元素所有的<code>options</code>，所有被选中的<code>options</code>以及第一个被选中的<code>option</code>。</p>\n<h2 id=\"5-2-Radio和Checkbox\"><a href=\"#5-2-Radio和Checkbox\" class=\"headerlink\" title=\"5.2 Radio和Checkbox\"></a>5.2 Radio和Checkbox</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">Checkbox:</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv1&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;c1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv2&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv3&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;c1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv4&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">Radio:</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;rv1&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;r1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;rv2&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;r1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>选择操作即点击事件，清除选择即键盘操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># checkbox</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;cv1&quot;]&#x27;</span>).click()  <span class=\"comment\"># click</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;cv2&quot;]&#x27;</span>).send_keys(Keys.SPACE)  <span class=\"comment\"># send space</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># radio</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;rv1&quot;]&#x27;</span>).send_keys(Keys.SPACE)  <span class=\"comment\"># send space</span></span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;rv2&quot;]&#x27;</span>).click()  <span class=\"comment\"># click</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6：参考资料\"><a href=\"#6：参考资料\" class=\"headerlink\" title=\"6：参考资料\"></a>6：参考资料</h1><p>《<a href=\"https://zhuanlan.zhihu.com/p/111859925\">Selenium Python 教程</a>》</p>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/60852696\">selenium启动Chrome配置参数问题</a>》</p>\n<p>《<a href=\"https://huilansame.github.io/huilansame.github.io/archivers/mouse-and-keyboard-actionchains\">Python硒-模拟鼠标键盘操作（ActionChains）</a>》</p>\n<p>《<a href=\"https://huilansame.github.io/huilansame.github.io/archivers/drop-down-select\">Python硒-操作选择标签的下拉选择框</a>》</p>\n<p>《<a href=\"https://www.jianshu.com/p/773c58406bdb\">Python+selenium使用cookie登录淘宝</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：Selenium简介\"><a href=\"#1：Selenium简介\" class=\"headerlink\" title=\"1：Selenium简介\"></a>1：Selenium简介</h1><p>Selenium库是一个用于浏览器自动化pyhon库。对提高爬虫容错率有很好的效果。它可用于驱动浏览器，来帮助我们实现获取网站js脚本执行后的网页。</p>\n<h1 id=\"2：Selenium安装\"><a href=\"#2：Selenium安装\" class=\"headerlink\" title=\"2：Selenium安装\"></a>2：Selenium安装</h1><h2 id=\"2-1-安装\"><a href=\"#2-1-安装\" class=\"headerlink\" title=\"2.1 安装\"></a>2.1 安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install selenium</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-浏览器驱动\"><a href=\"#2-2-浏览器驱动\" class=\"headerlink\" title=\"2.2 浏览器驱动\"></a>2.2 浏览器驱动</h2><p>下载浏览器驱动：</p>\n<p>Firefox浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://github.com/mozilla/geckodriver/releases\">geckodriver</a></p>\n<p>Chrome浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://sites.google.com/a/chromium.org/chromedriver/home\">chromedriver</a> , <a href=\"https://link.zhihu.com/?target=https://npm.taobao.org/mirrors/chromedriver\">taobao备用地址</a></p>\n<p>IE浏览器驱动：<a href=\"https://link.zhihu.com/?target=http://selenium-release.storage.googleapis.com/index.html\">IEDriverServer</a></p>\n<p>Edge浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver\">MicrosoftWebDriver</a></p>\n<p>Opera浏览器驱动：<a href=\"https://link.zhihu.com/?target=https://github.com/operasoftware/operachromiumdriver/releases\">operadriver</a></p>\n<p>PhantomJS浏览器驱动：<a href=\"https://link.zhihu.com/?target=http://phantomjs.org/\">phantomjs</a></p>\n<p>将驱动放到某个路径下，并在环境变量中指明。例如：</p>\n<p>驱动放在目录：<code>C:/abc/webdriver.exe</code></p>\n<p>则需要在用户或者系统环境变量中，给Path变量添加新变量：<code>C:/abc</code></p>\n<p>或者<strong>指定驱动路径</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">path = <span class=\"string\">&quot;/path/to/chromedriver&quot;</span> <span class=\"comment\">#注意这个路径需要时可执行路径（chmod 777 dir or 755 dir）</span></span><br><span class=\"line\">driver = webdriver.Chrome(executable_path=path)</span><br></pre></td></tr></table></figure>\n\n<p>不同的浏览器启动方式：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">driver = webdriver.Firefox()   <span class=\"comment\"># Firefox浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Chrome()    <span class=\"comment\"># Chrome浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Ie()        <span class=\"comment\"># Internet Explorer浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Edge()      <span class=\"comment\"># Edge浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Opera()     <span class=\"comment\"># Opera浏览器</span></span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.PhantomJS()   <span class=\"comment\"># PhantomJS</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：浏览器选项和操作\"><a href=\"#3：浏览器选项和操作\" class=\"headerlink\" title=\"3：浏览器选项和操作\"></a>3：浏览器选项和操作</h1><h2 id=\"3-1-浏览器选项\"><a href=\"#3-1-浏览器选项\" class=\"headerlink\" title=\"3.1 浏览器选项\"></a>3.1 浏览器选项</h2><p>每次当selenium启动chrome浏览器的时候，chrome浏览器很干净，没有插件、没有收藏、没有历史记录，这是因为selenium在启动chrome时为了保证最快的运行效率，启动了一个裸浏览器，这就是为什么需要配置参数的原因，但是有些时候我们需要的不仅是一个裸浏览器。</p>\n<p>selenium启动配置参数接收是ChromeOptions类，创建方式如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">option = webdriver.ChromeOptions()</span><br><span class=\"line\"><span class=\"comment\"># 添加启动参数</span></span><br><span class=\"line\">option.add_argument()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加扩展应用 </span></span><br><span class=\"line\">option.add_extension()</span><br><span class=\"line\">option.add_encoded_extension()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加实验性质的设置参数 </span></span><br><span class=\"line\">option.add_experimental_option()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置调试器地址</span></span><br><span class=\"line\">option.debugger_address()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加UA</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;user-agent=&quot;MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1&quot;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定浏览器分辨率</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;window-size=1920x3000&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 谷歌文档提到需要加上这个属性来规避bug</span></span><br><span class=\"line\">chrome_options.add_argument(<span class=\"string\">&#x27;--disable-gpu&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># 隐藏滚动条, 应对一些特殊页面</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;--hide-scrollbars&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 不加载图片, 提升速度</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;blink-settings=imagesEnabled=false&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;--headless&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以最高权限运行</span></span><br><span class=\"line\">options.add_argument(<span class=\"string\">&#x27;--no-sandbox&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 手动指定使用的浏览器位置</span></span><br><span class=\"line\">options.binary_location = <span class=\"string\">r&quot;C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe&quot;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加crx插件</span></span><br><span class=\"line\">option.add_extension(<span class=\"string\">&#x27;d:\\crx\\AdBlock_v2.17.crx&#x27;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用JavaScript</span></span><br><span class=\"line\">option.add_argument(<span class=\"string\">&quot;--disable-javascript&quot;</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置开发者模式启动，该模式下webdriver属性为正常值</span></span><br><span class=\"line\">options.add_experimental_option(<span class=\"string\">&#x27;excludeSwitches&#x27;</span>, [<span class=\"string\">&#x27;enable-automation&#x27;</span>]) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用浏览器弹窗</span></span><br><span class=\"line\">prefs = &#123;  </span><br><span class=\"line\">    <span class=\"string\">&#x27;profile.default_content_setting_values&#x27;</span> :  &#123;  </span><br><span class=\"line\">        <span class=\"string\">&#x27;notifications&#x27;</span> : <span class=\"number\">2</span>  </span><br><span class=\"line\">     &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">options.add_experimental_option(<span class=\"string\">&#x27;prefs&#x27;</span>,prefs)</span><br><span class=\"line\"></span><br><span class=\"line\">driver=webdriver.Chrome(chrome_options=chrome_options)</span><br></pre></td></tr></table></figure>\n\n<p>其他配置参数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">–user-data-dir=”[PATH]” </span><br><span class=\"line\"><span class=\"comment\"># 指定用户文件夹User Data路径，可以把书签这样的用户数据保存在系统分区以外的分区</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–disk-cache-dir=”[PATH]“ </span><br><span class=\"line\"><span class=\"comment\"># 指定缓存Cache路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–disk-cache-size= </span><br><span class=\"line\"><span class=\"comment\"># 指定Cache大小，单位Byte</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–first run </span><br><span class=\"line\"><span class=\"comment\"># 重置到初始状态，第一次运行</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–incognito </span><br><span class=\"line\"><span class=\"comment\"># 隐身模式启动</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　–disable-javascript </span><br><span class=\"line\"><span class=\"comment\"># 禁用Javascript</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--omnibox-popup-count=<span class=\"string\">&quot;num&quot;</span> </span><br><span class=\"line\"><span class=\"comment\"># 将地址栏弹出的提示菜单数量改为num个</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--user-agent=<span class=\"string\">&quot;xxxxxxxx&quot;</span> </span><br><span class=\"line\"><span class=\"comment\"># 修改HTTP请求头部的Agent字符串，可以通过about:version页面查看修改效果</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-plugins </span><br><span class=\"line\"><span class=\"comment\"># 禁止加载所有插件，可以增加速度。可以通过about:plugins页面查看效果</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-javascript </span><br><span class=\"line\"><span class=\"comment\"># 禁用JavaScript，如果觉得速度慢在加上这个</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-java </span><br><span class=\"line\"><span class=\"comment\"># 禁用java</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--start-maximized </span><br><span class=\"line\"><span class=\"comment\"># 启动就最大化</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--no-sandbox </span><br><span class=\"line\"><span class=\"comment\"># 取消沙盒模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--single-process </span><br><span class=\"line\"><span class=\"comment\"># 单进程运行</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--process-per-tab </span><br><span class=\"line\"><span class=\"comment\"># 每个标签使用单独进程</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--process-per-site </span><br><span class=\"line\"><span class=\"comment\"># 每个站点使用单独进程</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--<span class=\"keyword\">in</span>-process-plugins </span><br><span class=\"line\"><span class=\"comment\"># 插件不启用单独进程</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-popup-blocking </span><br><span class=\"line\"><span class=\"comment\"># 禁用弹出拦截</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-plugins </span><br><span class=\"line\"><span class=\"comment\"># 禁用插件</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disable-images </span><br><span class=\"line\"><span class=\"comment\"># 禁用图像</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--incognito </span><br><span class=\"line\"><span class=\"comment\"># 启动进入隐身模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--enable-udd-profiles </span><br><span class=\"line\"><span class=\"comment\"># 启用账户切换菜单</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--proxy-pac-url </span><br><span class=\"line\"><span class=\"comment\"># 使用pac代理 [via 1/2]</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--lang=zh-CN </span><br><span class=\"line\"><span class=\"comment\"># 设置语言为简体中文</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disk-cache-dir </span><br><span class=\"line\"><span class=\"comment\"># 自定义缓存目录</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--disk-cache-size </span><br><span class=\"line\"><span class=\"comment\"># 自定义缓存最大值（单位byte）</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--media-cache-size </span><br><span class=\"line\"><span class=\"comment\"># 自定义多媒体缓存最大值（单位byte）</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--bookmark-menu </span><br><span class=\"line\"><span class=\"comment\"># 在工具 栏增加一个书签按钮</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　--enable-sync </span><br><span class=\"line\"><span class=\"comment\"># 启用书签同步</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-浏览器操作\"><a href=\"#3-2-浏览器操作\" class=\"headerlink\" title=\"3.2 浏览器操作\"></a>3.2 浏览器操作</h2><ul>\n<li>控制浏览器窗口大小</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.set_window_size(<span class=\"number\">480</span>, <span class=\"number\">800</span>)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>浏览器后退，前进</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 后退 </span></span><br><span class=\"line\">driver.back() </span><br><span class=\"line\"><span class=\"comment\"># 前进 </span></span><br><span class=\"line\">driver.forward()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刷新</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.refresh() <span class=\"comment\"># 刷新</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：元素定位和操作\"><a href=\"#4：元素定位和操作\" class=\"headerlink\" title=\"4：元素定位和操作\"></a>4：元素定位和操作</h1><h2 id=\"4-1-元素定位\"><a href=\"#4-1-元素定位\" class=\"headerlink\" title=\"4.1 元素定位\"></a>4.1 元素定位</h2><p>获取首个匹配元素：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_element_by_id()</span><br><span class=\"line\">find_element_by_name()</span><br><span class=\"line\">find_element_by_class_name()</span><br><span class=\"line\">find_element_by_tag_name()</span><br><span class=\"line\">find_element_by_link_text()</span><br><span class=\"line\">find_element_by_partial_link_text()</span><br><span class=\"line\">find_element_by_xpath()</span><br><span class=\"line\">find_element_by_css_selector()</span><br></pre></td></tr></table></figure>\n\n<p>如果具有多个匹配属性元素，可使用：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find_elements_by_class_name()</span><br></pre></td></tr></table></figure>\n\n<p>即在element后加s</p>\n<h2 id=\"4-2-输入、提交\"><a href=\"#4-2-输入、提交\" class=\"headerlink\" title=\"4.2 输入、提交\"></a>4.2 输入、提交</h2><ul>\n<li>点击和输入</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.find_element_by_id(<span class=\"string\">&quot;kw&quot;</span>).clear() <span class=\"comment\"># 清楚文本 driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;) # 模拟按键输入 driver.find_element_by_id(&quot;su&quot;).click() # 单机元素</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>提交</li>\n</ul>\n<p>可以在搜索框模拟回车操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search_text = driver.find_element_by_id(<span class=\"string\">&#x27;kw&#x27;</span>) search_text.send_keys(<span class=\"string\">&#x27;selenium&#x27;</span>) </span><br><span class=\"line\">search_text.submit()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>其他</li>\n</ul>\n<p>size： 返回元素的尺寸。</p>\n<p>text： 获取元素的文本。</p>\n<p>get_attribute(name)： 获得属性值。</p>\n<p>is_displayed()： 设置该元素是否用户可见。</p>\n<h2 id=\"4-3-鼠标操作\"><a href=\"#4-3-鼠标操作\" class=\"headerlink\" title=\"4.3 鼠标操作\"></a>4.3 鼠标操作</h2><p>在 WebDriver 中， 将这些关于鼠标操作的方法封装在 ActionChains 类提供。</p>\n<p>ActionChains 类提供了鼠标操作的常用方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">click（on_element &#x3D; None）-鼠标左键</span><br><span class=\"line\"></span><br><span class=\"line\">click_and_hold（on_element &#x3D; None）-单击鼠标左键，不松开</span><br><span class=\"line\"></span><br><span class=\"line\">context_click（on_element &#x3D; None）-点击鼠标右键</span><br><span class=\"line\"></span><br><span class=\"line\">double_click（on_element &#x3D; None）-双击鼠标左键</span><br><span class=\"line\"></span><br><span class=\"line\">drag_and_drop（源，目标）-拖拽到某个元素然后松开</span><br><span class=\"line\"></span><br><span class=\"line\">drag_and_drop_by_offset（source，xoffset，yoffset）-拖拽到某个坐标然后松开</span><br><span class=\"line\"></span><br><span class=\"line\">key_down（value，element &#x3D; None）-点击某个键盘上的键</span><br><span class=\"line\"></span><br><span class=\"line\">key_up（value，element &#x3D; None）-松开某个键</span><br><span class=\"line\"></span><br><span class=\"line\">move_by_offset（xoffset，yoffset）-鼠标从当前位置移动到某个坐标</span><br><span class=\"line\"></span><br><span class=\"line\">move_to_element（to_element）-鼠标移动到某个元素</span><br><span class=\"line\"></span><br><span class=\"line\">move_to_element_with_offset（to_element，xoffset，yoffset）-移动到距离某个元素（左上角坐标）多少距离的位置</span><br><span class=\"line\"></span><br><span class=\"line\">perform（）-执行链中的所有动作</span><br><span class=\"line\"></span><br><span class=\"line\">释放（on_element &#x3D; None）-在某个元素位置松开鼠标左键</span><br><span class=\"line\"></span><br><span class=\"line\">send_keys（* keys_to_send）-发送某个键到当前焦点的元素</span><br><span class=\"line\"></span><br><span class=\"line\">send_keys_to_element（element，* keys_to_send）-发送某个键到指定元素</span><br></pre></td></tr></table></figure>\n\n<p>举个例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"comment\"># 引入 ActionChains 类</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.action_chains <span class=\"keyword\">import</span> ActionChains</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Chrome()</span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;https://www.baidu.cn&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 定位到要悬停的元素</span></span><br><span class=\"line\">above = driver.find_element_by_link_text(<span class=\"string\">&quot;设置&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 对定位到的元素执行鼠标悬停操作</span></span><br><span class=\"line\">ActionChains(driver).move_to_element(above).perform()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-键盘事件\"><a href=\"#4-4-键盘事件\" class=\"headerlink\" title=\"4.4 键盘事件\"></a>4.4 键盘事件</h2><p>以下为常用的键盘操作：</p>\n<ul>\n<li>send_keys(Keys.BACK_SPACE) 删除键（BackSpace）</li>\n<li>send_keys(Keys.SPACE) 空格键(Space)</li>\n<li>send_keys(Keys.TAB) 制表键(Tab)</li>\n<li>send_keys(Keys.ESCAPE) 回退键（Esc）</li>\n<li>send_keys(Keys.ENTER) 回车键（Enter）</li>\n<li>send_keys(Keys.CONTROL,’a’) 全选（Ctrl+A）</li>\n<li>send_keys(Keys.CONTROL,’c’) 复制（Ctrl+C）</li>\n<li>send_keys(Keys.CONTROL,’x’) 剪切（Ctrl+X）</li>\n<li>send_keys(Keys.CONTROL,’v’) 粘贴（Ctrl+V）</li>\n<li>send_keys(Keys.F1) 键盘 F1</li>\n<li>……</li>\n<li>send_keys(Keys.F12) 键盘 F12</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输入框输入内容</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">&quot;kw&quot;</span>).send_keys(<span class=\"string\">&quot;seleniumm&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除多输入的一个 m</span></span><br><span class=\"line\">driver.find_element_by_id(<span class=\"string\">&quot;kw&quot;</span>).send_keys(Keys.BACK_SPACE)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-5-获取断言信息\"><a href=\"#4-5-获取断言信息\" class=\"headerlink\" title=\"4.5 获取断言信息\"></a>4.5 获取断言信息</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title = driver.title <span class=\"comment\"># 打印当前页面title</span></span><br><span class=\"line\">now_url = driver.current_url <span class=\"comment\"># 打印当前页面URL</span></span><br><span class=\"line\">user = driver.find_element_by_class_name(<span class=\"string\">&#x27;nums&#x27;</span>).text <span class=\"comment\"># # 获取结果数目</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-6-等待页面加载完成\"><a href=\"#4-6-等待页面加载完成\" class=\"headerlink\" title=\"4.6 等待页面加载完成\"></a>4.6 等待页面加载完成</h2><ul>\n<li>显示等待</li>\n</ul>\n<p>显式等待使WebdDriver等待某个条件成立时继续执行，否则在达到最大时长时抛出超时异常（TimeoutException）。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support.ui <span class=\"keyword\">import</span> WebDriverWait</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.support <span class=\"keyword\">import</span> expected_conditions <span class=\"keyword\">as</span> EC</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Firefox()</span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;http://www.baidu.com&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">element = WebDriverWait(driver, <span class=\"number\">5</span>, <span class=\"number\">0.5</span>).until(</span><br><span class=\"line\">                      EC.presence_of_element_located((By.ID, <span class=\"string\">&quot;kw&quot;</span>))</span><br><span class=\"line\">                      )</span><br><span class=\"line\">element.send_keys(<span class=\"string\">&#x27;selenium&#x27;</span>)</span><br><span class=\"line\">driver.quit()</span><br></pre></td></tr></table></figure>\n\n<p>WebDriverWait类是由WebDirver 提供的等待方法。在设置时间内，默认每隔一段时间检测一次当前页面元素是否存在，如果超过设置时间检测不到则抛出异常。具体格式如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WebDriverWait(driver, timeout, poll_frequency=<span class=\"number\">0.5</span>, ignored_exceptions=<span class=\"literal\">None</span>)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>driver ：浏览器驱动。</li>\n<li>timeout ：最长超时时间，默认以秒为单位。</li>\n<li>poll_frequency ：检测的间隔（步长）时间，默认为0.5S。</li>\n<li>ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。</li>\n<li>WebDriverWait()一般由until()或until_not()方法配合使用，下面是until()和until_not()方法的说明。</li>\n<li>until(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为True。</li>\n<li>until_not(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为False。</li>\n</ul>\n<p>在本例中，通过as关键字将expected_conditions 重命名为EC，并调用presence_of_element_located()方法判断元素是否存在。</p>\n<ul>\n<li>隐式等待</li>\n</ul>\n<p>如果某些元素不是立即可用的，隐式等待是告诉WebDriver去等待一定的时间后去查找元素。 默认等待时间是0秒，一旦设置该值，隐式等待是设置该WebDriver的实例的生命周期。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">driver = webdriver.Firefox()    </span><br><span class=\"line\">driver.implicitly_wait(<span class=\"number\">10</span>) <span class=\"comment\"># seconds    </span></span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;http://somedomain/url_that_delays_loading&quot;</span>)    </span><br><span class=\"line\">myDynamicElement = driver.find_element_by_id(<span class=\"string\">&quot;myDynamicElement&quot;</span>) </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-7-在不同的iframe之间移动\"><a href=\"#4-7-在不同的iframe之间移动\" class=\"headerlink\" title=\"4.7 在不同的iframe之间移动\"></a>4.7 在不同的iframe之间移动</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.switch_to_window(<span class=\"string\">&quot;windowName&quot;</span>)</span><br><span class=\"line\">driver.switch_to_frame(<span class=\"string\">&quot;frameName&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以直接取表单的id 或name属性。如果iframe没有可用的id和name属性，则可以通过下面的方式进行定位。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#先通过xpth定位到iframe</span></span><br><span class=\"line\">xf = driver.find_element_by_xpath(<span class=\"string\">&#x27;//*[@id=&quot;x-URS-iframe&quot;]&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#再将定位对象传给switch_to_frame()方法</span></span><br><span class=\"line\">driver.switch_to_frame(xf)</span><br></pre></td></tr></table></figure>\n\n<p>一旦我们完成了frame中的工作，我们可以这样返回父frame:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.switch_to_default_content()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-8-警告框处理\"><a href=\"#4-8-警告框处理\" class=\"headerlink\" title=\"4.8 警告框处理\"></a>4.8 警告框处理</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alert = driver.switch_to_alert()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>text：返回 alert/confirm/prompt 中的文字信息。</li>\n<li>accept()：接受现有警告框。</li>\n<li>dismiss()：解散现有警告框。</li>\n<li>send_keys(keysToSend)：发送文本至警告框。keysToSend：将文本发送至警告框。</li>\n</ul>\n<h2 id=\"4-9-下拉框选择\"><a href=\"#4-9-下拉框选择\" class=\"headerlink\" title=\"4.9 下拉框选择\"></a>4.9 下拉框选择</h2><figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from selenium import webdriver</span><br><span class=\"line\">from selenium.webdriver.support.select import Select</span><br><span class=\"line\">from time import sleep</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Chrome()</span><br><span class=\"line\">driver.implicitly_wait(10)</span><br><span class=\"line\">driver.get(&#x27;http://www.baidu.com&#x27;)</span><br><span class=\"line\">sel = driver.find_element_by_xpath(&quot;//select[@id=&#x27;nr&#x27;]&quot;)</span><br><span class=\"line\">Select(sel).select_by_value(&#x27;50&#x27;)  # 显示50条</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-10-文件上传\"><a href=\"#4-10-文件上传\" class=\"headerlink\" title=\"4.10 文件上传\"></a>4.10 文件上传</h2><figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.find_element_by_name(&quot;file&quot;).send_keys(&#x27;D:\\\\upload_file.txt&#x27;)  # # 定位上传按钮，添加本地文件</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-11-cookie操作\"><a href=\"#4-11-cookie操作\" class=\"headerlink\" title=\"4.11 cookie操作\"></a>4.11 cookie操作</h2><p>WebDriver操作cookie的方法：</p>\n<ul>\n<li>get_cookies()： 获得所有cookie信息。</li>\n<li>get_cookie(name)： 返回字典的key为“name”的cookie信息。</li>\n<li>add_cookie(cookie_dict) ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。</li>\n<li>delete_cookie(name,optionsString)：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。</li>\n<li>delete_all_cookies()： 删除所有cookie信息</li>\n</ul>\n<h2 id=\"4-12-调用JavaScript代码\"><a href=\"#4-12-调用JavaScript代码\" class=\"headerlink\" title=\"4.12 调用JavaScript代码\"></a>4.12 调用JavaScript代码</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">js=<span class=\"string\">&quot;window.scrollTo(100,450);&quot;</span></span><br><span class=\"line\">driver.execute_script(js) <span class=\"comment\"># 通过javascript设置浏览器窗口的滚动条位置</span></span><br></pre></td></tr></table></figure>\n\n<p>通过execute_script()方法执行JavaScripts代码来移动滚动条的位置。</p>\n<h2 id=\"4-13-窗口截图\"><a href=\"#4-13-窗口截图\" class=\"headerlink\" title=\"4.13 窗口截图\"></a>4.13 窗口截图</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">driver.get_screenshot_as_file(<span class=\"string\">&quot;D:\\\\baidu_img.jpg&quot;</span>) <span class=\"comment\"># 截取当前窗口，并指定截图图片的保存位置</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-14-关闭浏览器\"><a href=\"#4-14-关闭浏览器\" class=\"headerlink\" title=\"4.14 关闭浏览器\"></a>4.14 关闭浏览器</h2><ul>\n<li>close() 关闭单个窗口</li>\n<li>quit() 关闭所有窗口</li>\n</ul>\n<h2 id=\"4-15-直接用cookie登录方法\"><a href=\"#4-15-直接用cookie登录方法\" class=\"headerlink\" title=\"4.15 直接用cookie登录方法\"></a>4.15 直接用cookie登录方法</h2><p>链接：<a href=\"https://link.zhihu.com/?target=https://www.jianshu.com/p/773c58406bdb\">https://www.jianshu.com/p/773c58406bdb</a></p>\n<ol>\n<li>手动获取网页的cookie，将其序列化并存储在本地</li>\n<li>写入代码</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> cookies:</span><br><span class=\"line\">    driver.add_cookie(item)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-16-导出html到beautifulsoup或文件\"><a href=\"#4-16-导出html到beautifulsoup或文件\" class=\"headerlink\" title=\"4.16 导出html到beautifulsoup或文件\"></a>4.16 导出html到beautifulsoup或文件</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">soup = BeautifulSoup(driver.page_source,<span class=\"string\">&quot;html.parser&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">writetohtml</span>(<span class=\"params\">driver,path</span>):</span></span><br><span class=\"line\">    f = open(path,<span class=\"string\">&#x27;wb&#x27;</span>)</span><br><span class=\"line\">    f.write(driver.page_source.encode(<span class=\"string\">&quot;utf-8&quot;</span>, <span class=\"string\">&quot;ignore&quot;</span>))</span><br><span class=\"line\">    f.close()   </span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：控件操作\"><a href=\"#5：控件操作\" class=\"headerlink\" title=\"5：控件操作\"></a>5：控件操作</h1><h2 id=\"5-1-Select\"><a href=\"#5-1-Select\" class=\"headerlink\" title=\"5.1 Select\"></a>5.1 Select</h2><p><code>Select</code>类提供了三种选择某些选项的方法：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select_by_index(index)</span><br><span class=\"line\">select_by_value(value)</span><br><span class=\"line\">select_by_visible_text(text)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>index从0开始，第一个option为0</p>\n<p>value是标签的属性值</p>\n<p>visible_text是option标签中间的值，即下拉框可见值</p>\n</blockquote>\n<p>自然的，有选择必然有反选，即取消选择。<code>Select</code>提供了四个方法给我们取消原来的选择：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deselect_by_index(index)</span><br><span class=\"line\">deselect_by_value(value)</span><br><span class=\"line\">deselect_by_visible_text(text)</span><br><span class=\"line\">deselect_all()</span><br></pre></td></tr></table></figure>\n\n<p>前一种分别于<code>select</code>相对应，第四种是全部取消选择，是的，你没看错，是全部取消。有一种特殊的选择标签，即设置了<code>multiple=&quot;multiple&quot;</code>属性的<code>select</code>，这种<code>select</code>框是可以多选的，你可以通过多次<code>select</code>，选择多个选项，而通过<code>deselect_all()</code>来将他们全部取消。</p>\n<p>当我们选择了选项之后，想要看看选择的是哪项，替代的是否是我想选的，怎么办？别担心，<code>Select</code>为你提供了相应的方法（或者应该说是属性了）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options</span><br><span class=\"line\">all_selected_options</span><br><span class=\"line\">first_selected_option</span><br></pre></td></tr></table></figure>\n\n<p>上面三个属性，分别返回这个<code>select</code>元素所有的<code>options</code>，所有被选中的<code>options</code>以及第一个被选中的<code>option</code>。</p>\n<h2 id=\"5-2-Radio和Checkbox\"><a href=\"#5-2-Radio和Checkbox\" class=\"headerlink\" title=\"5.2 Radio和Checkbox\"></a>5.2 Radio和Checkbox</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">Checkbox:</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv1&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;c1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv2&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv3&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;c1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;checkbox&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cv4&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">Radio:</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;rv1&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;r1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;radio&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;rv2&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;r1&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>选择操作即点击事件，清除选择即键盘操作</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># checkbox</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;cv1&quot;]&#x27;</span>).click()  <span class=\"comment\"># click</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;cv2&quot;]&#x27;</span>).send_keys(Keys.SPACE)  <span class=\"comment\"># send space</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># radio</span></span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;rv1&quot;]&#x27;</span>).send_keys(Keys.SPACE)  <span class=\"comment\"># send space</span></span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">driver.find_element_by_xpath(<span class=\"string\">&#x27;//input[@value=&quot;rv2&quot;]&#x27;</span>).click()  <span class=\"comment\"># click</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6：参考资料\"><a href=\"#6：参考资料\" class=\"headerlink\" title=\"6：参考资料\"></a>6：参考资料</h1><p>《<a href=\"https://zhuanlan.zhihu.com/p/111859925\">Selenium Python 教程</a>》</p>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/60852696\">selenium启动Chrome配置参数问题</a>》</p>\n<p>《<a href=\"https://huilansame.github.io/huilansame.github.io/archivers/mouse-and-keyboard-actionchains\">Python硒-模拟鼠标键盘操作（ActionChains）</a>》</p>\n<p>《<a href=\"https://huilansame.github.io/huilansame.github.io/archivers/drop-down-select\">Python硒-操作选择标签的下拉选择框</a>》</p>\n<p>《<a href=\"https://www.jianshu.com/p/773c58406bdb\">Python+selenium使用cookie登录淘宝</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Fri Sep 18 2020 21:30:23 GMT+0200 (GMT+02:00)","title":"Selenium库常用操作记录","path":"2020/09/18/Selenium常用操作记录/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-09-18T17:06:09.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-09-18T17:06:09.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Python","tags":["Selenium"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"利用Stunnel+squid代理实现国内无客户端访问外网","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-05-28T21:26:23.000Z","password":null,"summary":null,"_content":"\n# 1：加速原理\n\n## 1.1 squid介绍\n\nsquid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。\n\n按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。\n\n但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。\n\n## 1.2 Https介绍\n\n这篇文章详细介绍了加密的原理：https://blog.csdn.net/clh604/article/details/22179907\n\n![SSL](https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png)\n\n## 1.3 stunnel介绍\n\nstunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。\n\n为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。\n\n## 1.4 代理过程\n\n在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。\n\n通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图\n\n![](https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png)\n\n但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。\n\n相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。\n\n更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。\n\n\n\n# 2：主机设置代理访问\n\n为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。\n\n1. 打开`代理服务器色设置`\n\n![](https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg)\n\n2. 在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。\n\n![](https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg)\n\n3. 使用浏览器登陆google\n\n![](https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg)\n\n实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。\n\n# 3：国外服务器配置\n\n确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。\n\n## 3.1 安装配置Squid\n\n1. 安装squid\n\nubuntu使用：\n\n```shell\napt-get install squid\n```\n\ncentos使用：\n\n```\nyum install squid\n```\n\n使用`squid -v`检查squid是否安装好。\n\n2. 配置squid\n\n打开squid配置文件`/etc/squid/squid.conf`。没有就新建此文件\n\n将文件内容修改为：\n\n```shell\n# http_port 设置监听端口，默认为3128\nhttp_port 3128\n\n# access_log 设置access日志，daemon表示在后台将日志写入/var/log/squid/access.log文件, \n# combined是一个预定义的logformat，也可以使用自定义的logformat\naccess_log daemon:/var/log/squid/access.log combined\n\n# visible_hotname 设置代理服务器的主机名\n# 默认取本机的hostname\nvisible_hostname funway.aliyun.proxy\n\n# ACLs all, manager, localhost, and to_localhost are predefined.\nacl SSL_ports port 443\nacl Safe_ports port 80    # http\nacl Safe_ports port 21    # ftp\nacl Safe_ports port 443    # https\nacl Safe_ports port 70    # gopher\nacl Safe_ports port 210    # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280    # http-mgmt\nacl Safe_ports port 488    # gss-http\nacl Safe_ports port 591    # filemaker\nacl Safe_ports port 777    # multiling http\nacl CONNECT method CONNECT\n\n# 拒绝所有非Safe_ports的请求\nhttp_access deny !Safe_ports\n# 拒绝所有非SSL_prots的CONNECT请求\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n# 允许来自本地的请求\nhttp_access allow localhost\n\n# 拒绝所有请求，最后兜底的规则\nhttp_access deny all\n```\n\n更多详细的配置参数解释，请参考博文《[使用squid搭建代理服务器](https://www.hawu.me/operation/852)》\n\n配置squid只能本地地址访问。\n\n3. 运行squid\n\n```shell\nservice squid start //运行\nservice squid status //查看squid运行状态\n```\n\n## 3.2 安装配置stunnel服务端\n\n1. 生成自签名证书，如果没有openssl需要先安装。\n\n```shell\nopenssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem\n```\n\n将生成的证书，复制到/etc/stunnel文件夹下\n\n```shell\ncp stunnel.pem /etc/stunnel\n```\n\n这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。\n\n1. 下载安装stunnel\n\n```shell\napt-get install stunnel\n```\n\n2. 设置stunnel配置文件\n\n```shell\n; 设置工作目录，没有目录需要先创建\nchroot = /var/run/stunnel/\n; 设置stunnel的pid文件路径（在chroot下）\npid = /stunnel.pid\n; 设置stunnel工作的用户（组）\nsetuid = root\nsetgid = root\n\n; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)\n; 默认为5\ndebug = 7\n; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）\noutput = /stunnel.log\n\n; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）\ncert = /etc/stunnel/stunnel.pem\n; 私钥文件\nkey = /etc/stunnel/stunnel.pem\n\n; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。\n; 自定义服务名squid-proxy\n[squid-proxy]\n; 服务监听的端口，client要连接这个端口与server通信\naccept = 3129\n; 服务要连接的端口，连接到squid的3128端口，将数据发给squid\nconnect = localhost:3128\n\n; **************************************************************************\n; * 下面这些配置我都注释掉了，但也需要了解下 *\n; **************************************************************************\n\n; 设置是否对传输数据进行压缩，默认不开启。\n; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）\n;compression = zlib\n\n; 设置ssl版本,这个也是跟安装的openssl有关的\n;sslVersion = TLSv1\n\n; Authentication stuff needs to be configured to prevent MITM attacks\n; It is important to understand that this option was solely designed for access control and not for authorization\n; It is not enabled by default!\n; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，\n; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。\n; 这是有效防止中间人攻击的手段\n; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）\n; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）\n;verify = 2\n; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。\n;CAfile = /etc/stunnel/stunnel-client.pem\n```\n\n3. 启动停止stunnel\n\n```shell\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 4：国内服务器配置Stunnel客户端\n\n国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。\n\n1. 在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。\n\n本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组->防火墙->添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。\n\n2. 配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。\n\n查看开放端口，如果没有firewall，请先安装\n\n```shell\nfirewall-cmd --list-all\n```\n\n设置需要开放的端口\n\n```shell\nfirewall-cmd --zone=public --add-port=3128/tcp --permanent//设置\nfirewall-cmd --reload//生效\n```\n\n此时再查看开放的端口，就能看到3128端口已开放。\n\n3. 安装stunnel客户端。\n\nubuntu使用:\n\n```shell\napt-get install stunnel\n```\n\ncentos使用：\n\n```shell\nyum install stunnel\n```\n\n4. 设置stunnel客户端配置文件\n\n```shell\n; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建\nchroot = /var/run/stunnel/\n; stunnel工作的用户组\nsetuid = root\nsetgid = root\n; stunnel工作时候的pid\npid = /stunnel.pid\n; 日志等级\ndebug = 7\n; 日志文件\noutput = /var/log/stunnel/stunnel.log\n; 表示以client模式启动stunnel，默认client = no，即server模式\nclient = yes\n; 定义一个服务\n[squid-proxy]\n; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128\naccept = 3128\n; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器\nconnect = xx.xx.xx.xx:3129\n; 需要验证对方发过来的证书\nverify = 2\n; 用来进行证书验证的文件（里面有stunnel server的证书）\nCAfile = /etc/stunnel/stunnel-server.pem\n; 客户端不需要传递自己的证书，所以注释掉\n;cert = /etc/stunnel/stunnel.pem\n;key = /etc/stunnel/stunnel.key\n```\n\n5. 将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。\n\n配置文件里`CAfile = /etc/stunnel/stunnel-server.pem`写明了我们需要将公钥保存的位置和公钥的文件名。\n\n我们只需要将，3.2节生成的证书打开，复制已`BEGIN CERTIFICATION`开头到`END CERTIFICATION`结束的公钥。然后，新建`/etc/stunnel/stunnel-server.pem`文件，将公钥粘贴进去。\n\n这样stunnel客户端就能将数据加密后发送给stunnel服务器了。\n\n6. 启动和停止stunnel\n\n```\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 5：不足和优化\n\n## 5.1 代理方法的不足\n\n1. 由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。\n\n2. stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。\n\n## 5.2 优化\n\n1. 配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid\n\n- 修改配置文件`/etc/squid/squid.conf`，在`http_access deny all`之前追加以下内容，并注释掉`http_access allow localhost`\n\n```shell\n# auth_param 设置代理的认证方式\n# 用法：auth_param scheme parameter [setting]\n# scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制\n\n# program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。\nauth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd\n# children 设置后台启动几个认证程序进程\nauth_param basic children 3\n# credentialsttl 设置认证失效时间，过期后需重新认证\nauth_param basic credentialsttl 10 hours\n# realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”\nauth_param basic realm welecome to using my proxy\n\n\n# ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access\n\n# 添加名为AuthUsers访问列表，表示通过认证的用户\nacl AuthUsers proxy_auth REQUIRED\n# 允许AuthUsers的代理请求\nhttp_access allow AuthUsers\n```\n\n- 新建密码文件\n\n```shell\nhtpasswd -c /etc/squid/passwd qifei\n```\n\n如果没有htpasswd，则按提示安装。输入密码即可。\n\n- 重启squid\n\n```shell\nservice squid restart\n```\n\n2. 添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。\n\n# 6：补充\n\n## 6.1 只能访问谷歌而无法访问YouTube\n\n### 5.30日更新：\n\n在经过一段时间的使用后，上种方法存在一些弊端。\n\n在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。\n\n利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url`youtube.com`。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。\n\n而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。\n\n之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。\n\n查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。\n\n在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。\n\n因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。\n\n最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。\n\n这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。\n\n### 5.31日更新：\n\n我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。\n\n我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。\n\n我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。\n\n猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。\n\n**结论**，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。\n\n这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。\n\n通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。\n\n而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。\n\n总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。\n\n## 6.2 使用用户名和密码手机软件不能弹出登陆框\n\n在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。\n\n### 方法1：完全开放代理\n\n修改`squid.conf`关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。\n\n### 方法2：IP限制\n\n在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。\n\n完整拓扑结构：用户主机->squid（国内）->stunnel（国内）->stunnel（国外）->squid（国外）->网站服务器\n\n添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。\n\n### 方法3：网页验证加自定义ACL辅助器验证\n\n第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。\n\n**设计思路**\n\n1. 用户设置ip和端口，无密码连接代理服务器。\n2. 用户打开浏览器，访问任意网页\n3. 利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。\n4. 网页后台验证用户输入的用户名和密码。并保存用户ip。\n5. 编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。\n\n### 方法4：自定义验证器加ACL辅助器验证\n\n第一次登陆，弹出代理登陆框，通过后保存ip\n\n1. 用户设置ip和端口，连接代理服务器。\n2. 代理服务器通过ACL辅助器验证此IP是否在白名单中。\n3. 不在白名单则，进入自定义验证器，在，则通过代理。\n4. 进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。\n\n我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。","source":"_posts/Stunnel-squid代理加速亚琛教学视频加速.md","raw":"---\ntitle: 利用Stunnel+squid代理实现国内无客户端访问外网\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-05-28 23:26:23\npassword:\nsummary:\ntags: Stunnel代理\ncategories: 其他\n---\n\n# 1：加速原理\n\n## 1.1 squid介绍\n\nsquid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。\n\n按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。\n\n但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。\n\n## 1.2 Https介绍\n\n这篇文章详细介绍了加密的原理：https://blog.csdn.net/clh604/article/details/22179907\n\n![SSL](https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png)\n\n## 1.3 stunnel介绍\n\nstunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。\n\n为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。\n\n## 1.4 代理过程\n\n在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。\n\n通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图\n\n![](https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png)\n\n但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。\n\n相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。\n\n更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。\n\n\n\n# 2：主机设置代理访问\n\n为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。\n\n1. 打开`代理服务器色设置`\n\n![](https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg)\n\n2. 在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。\n\n![](https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg)\n\n3. 使用浏览器登陆google\n\n![](https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg)\n\n实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。\n\n# 3：国外服务器配置\n\n确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。\n\n## 3.1 安装配置Squid\n\n1. 安装squid\n\nubuntu使用：\n\n```shell\napt-get install squid\n```\n\ncentos使用：\n\n```\nyum install squid\n```\n\n使用`squid -v`检查squid是否安装好。\n\n2. 配置squid\n\n打开squid配置文件`/etc/squid/squid.conf`。没有就新建此文件\n\n将文件内容修改为：\n\n```shell\n# http_port 设置监听端口，默认为3128\nhttp_port 3128\n\n# access_log 设置access日志，daemon表示在后台将日志写入/var/log/squid/access.log文件, \n# combined是一个预定义的logformat，也可以使用自定义的logformat\naccess_log daemon:/var/log/squid/access.log combined\n\n# visible_hotname 设置代理服务器的主机名\n# 默认取本机的hostname\nvisible_hostname funway.aliyun.proxy\n\n# ACLs all, manager, localhost, and to_localhost are predefined.\nacl SSL_ports port 443\nacl Safe_ports port 80    # http\nacl Safe_ports port 21    # ftp\nacl Safe_ports port 443    # https\nacl Safe_ports port 70    # gopher\nacl Safe_ports port 210    # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280    # http-mgmt\nacl Safe_ports port 488    # gss-http\nacl Safe_ports port 591    # filemaker\nacl Safe_ports port 777    # multiling http\nacl CONNECT method CONNECT\n\n# 拒绝所有非Safe_ports的请求\nhttp_access deny !Safe_ports\n# 拒绝所有非SSL_prots的CONNECT请求\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n# 允许来自本地的请求\nhttp_access allow localhost\n\n# 拒绝所有请求，最后兜底的规则\nhttp_access deny all\n```\n\n更多详细的配置参数解释，请参考博文《[使用squid搭建代理服务器](https://www.hawu.me/operation/852)》\n\n配置squid只能本地地址访问。\n\n3. 运行squid\n\n```shell\nservice squid start //运行\nservice squid status //查看squid运行状态\n```\n\n## 3.2 安装配置stunnel服务端\n\n1. 生成自签名证书，如果没有openssl需要先安装。\n\n```shell\nopenssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem\n```\n\n将生成的证书，复制到/etc/stunnel文件夹下\n\n```shell\ncp stunnel.pem /etc/stunnel\n```\n\n这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。\n\n1. 下载安装stunnel\n\n```shell\napt-get install stunnel\n```\n\n2. 设置stunnel配置文件\n\n```shell\n; 设置工作目录，没有目录需要先创建\nchroot = /var/run/stunnel/\n; 设置stunnel的pid文件路径（在chroot下）\npid = /stunnel.pid\n; 设置stunnel工作的用户（组）\nsetuid = root\nsetgid = root\n\n; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)\n; 默认为5\ndebug = 7\n; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）\noutput = /stunnel.log\n\n; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）\ncert = /etc/stunnel/stunnel.pem\n; 私钥文件\nkey = /etc/stunnel/stunnel.pem\n\n; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。\n; 自定义服务名squid-proxy\n[squid-proxy]\n; 服务监听的端口，client要连接这个端口与server通信\naccept = 3129\n; 服务要连接的端口，连接到squid的3128端口，将数据发给squid\nconnect = localhost:3128\n\n; **************************************************************************\n; * 下面这些配置我都注释掉了，但也需要了解下 *\n; **************************************************************************\n\n; 设置是否对传输数据进行压缩，默认不开启。\n; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）\n;compression = zlib\n\n; 设置ssl版本,这个也是跟安装的openssl有关的\n;sslVersion = TLSv1\n\n; Authentication stuff needs to be configured to prevent MITM attacks\n; It is important to understand that this option was solely designed for access control and not for authorization\n; It is not enabled by default!\n; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，\n; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。\n; 这是有效防止中间人攻击的手段\n; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）\n; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）\n;verify = 2\n; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。\n;CAfile = /etc/stunnel/stunnel-client.pem\n```\n\n3. 启动停止stunnel\n\n```shell\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 4：国内服务器配置Stunnel客户端\n\n国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。\n\n1. 在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。\n\n本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组->防火墙->添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。\n\n2. 配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。\n\n查看开放端口，如果没有firewall，请先安装\n\n```shell\nfirewall-cmd --list-all\n```\n\n设置需要开放的端口\n\n```shell\nfirewall-cmd --zone=public --add-port=3128/tcp --permanent//设置\nfirewall-cmd --reload//生效\n```\n\n此时再查看开放的端口，就能看到3128端口已开放。\n\n3. 安装stunnel客户端。\n\nubuntu使用:\n\n```shell\napt-get install stunnel\n```\n\ncentos使用：\n\n```shell\nyum install stunnel\n```\n\n4. 设置stunnel客户端配置文件\n\n```shell\n; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建\nchroot = /var/run/stunnel/\n; stunnel工作的用户组\nsetuid = root\nsetgid = root\n; stunnel工作时候的pid\npid = /stunnel.pid\n; 日志等级\ndebug = 7\n; 日志文件\noutput = /var/log/stunnel/stunnel.log\n; 表示以client模式启动stunnel，默认client = no，即server模式\nclient = yes\n; 定义一个服务\n[squid-proxy]\n; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128\naccept = 3128\n; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器\nconnect = xx.xx.xx.xx:3129\n; 需要验证对方发过来的证书\nverify = 2\n; 用来进行证书验证的文件（里面有stunnel server的证书）\nCAfile = /etc/stunnel/stunnel-server.pem\n; 客户端不需要传递自己的证书，所以注释掉\n;cert = /etc/stunnel/stunnel.pem\n;key = /etc/stunnel/stunnel.key\n```\n\n5. 将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。\n\n配置文件里`CAfile = /etc/stunnel/stunnel-server.pem`写明了我们需要将公钥保存的位置和公钥的文件名。\n\n我们只需要将，3.2节生成的证书打开，复制已`BEGIN CERTIFICATION`开头到`END CERTIFICATION`结束的公钥。然后，新建`/etc/stunnel/stunnel-server.pem`文件，将公钥粘贴进去。\n\n这样stunnel客户端就能将数据加密后发送给stunnel服务器了。\n\n6. 启动和停止stunnel\n\n```\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 5：不足和优化\n\n## 5.1 代理方法的不足\n\n1. 由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。\n\n2. stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。\n\n## 5.2 优化\n\n1. 配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid\n\n- 修改配置文件`/etc/squid/squid.conf`，在`http_access deny all`之前追加以下内容，并注释掉`http_access allow localhost`\n\n```shell\n# auth_param 设置代理的认证方式\n# 用法：auth_param scheme parameter [setting]\n# scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制\n\n# program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。\nauth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd\n# children 设置后台启动几个认证程序进程\nauth_param basic children 3\n# credentialsttl 设置认证失效时间，过期后需重新认证\nauth_param basic credentialsttl 10 hours\n# realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”\nauth_param basic realm welecome to using my proxy\n\n\n# ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access\n\n# 添加名为AuthUsers访问列表，表示通过认证的用户\nacl AuthUsers proxy_auth REQUIRED\n# 允许AuthUsers的代理请求\nhttp_access allow AuthUsers\n```\n\n- 新建密码文件\n\n```shell\nhtpasswd -c /etc/squid/passwd qifei\n```\n\n如果没有htpasswd，则按提示安装。输入密码即可。\n\n- 重启squid\n\n```shell\nservice squid restart\n```\n\n2. 添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。\n\n# 6：补充\n\n## 6.1 只能访问谷歌而无法访问YouTube\n\n### 5.30日更新：\n\n在经过一段时间的使用后，上种方法存在一些弊端。\n\n在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。\n\n利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url`youtube.com`。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。\n\n而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。\n\n之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。\n\n查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。\n\n在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。\n\n因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。\n\n最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。\n\n这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。\n\n### 5.31日更新：\n\n我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。\n\n我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。\n\n我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。\n\n猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。\n\n**结论**，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。\n\n这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。\n\n通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。\n\n而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。\n\n总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。\n\n## 6.2 使用用户名和密码手机软件不能弹出登陆框\n\n在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。\n\n### 方法1：完全开放代理\n\n修改`squid.conf`关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。\n\n### 方法2：IP限制\n\n在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。\n\n完整拓扑结构：用户主机->squid（国内）->stunnel（国内）->stunnel（国外）->squid（国外）->网站服务器\n\n添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。\n\n### 方法3：网页验证加自定义ACL辅助器验证\n\n第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。\n\n**设计思路**\n\n1. 用户设置ip和端口，无密码连接代理服务器。\n2. 用户打开浏览器，访问任意网页\n3. 利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。\n4. 网页后台验证用户输入的用户名和密码。并保存用户ip。\n5. 编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。\n\n### 方法4：自定义验证器加ACL辅助器验证\n\n第一次登陆，弹出代理登陆框，通过后保存ip\n\n1. 用户设置ip和端口，连接代理服务器。\n2. 代理服务器通过ACL辅助器验证此IP是否在白名单中。\n3. 不在白名单则，进入自定义验证器，在，则通过代理。\n4. 进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。\n\n我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。","slug":"Stunnel-squid代理加速亚琛教学视频加速","published":1,"updated":"2020-06-02T04:47:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaet006gp0vzfnuudtj9","content":"<h1 id=\"1：加速原理\"><a href=\"#1：加速原理\" class=\"headerlink\" title=\"1：加速原理\"></a>1：加速原理</h1><h2 id=\"1-1-squid介绍\"><a href=\"#1-1-squid介绍\" class=\"headerlink\" title=\"1.1 squid介绍\"></a>1.1 squid介绍</h2><p>squid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。</p>\n<p>按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。</p>\n<p>但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。</p>\n<h2 id=\"1-2-Https介绍\"><a href=\"#1-2-Https介绍\" class=\"headerlink\" title=\"1.2 Https介绍\"></a>1.2 Https介绍</h2><p>这篇文章详细介绍了加密的原理：<a href=\"https://blog.csdn.net/clh604/article/details/22179907\">https://blog.csdn.net/clh604/article/details/22179907</a></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"SSL\"></p>\n<h2 id=\"1-3-stunnel介绍\"><a href=\"#1-3-stunnel介绍\" class=\"headerlink\" title=\"1.3 stunnel介绍\"></a>1.3 stunnel介绍</h2><p>stunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。</p>\n<p>为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。</p>\n<h2 id=\"1-4-代理过程\"><a href=\"#1-4-代理过程\" class=\"headerlink\" title=\"1.4 代理过程\"></a>1.4 代理过程</h2><p>在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。</p>\n<p>通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。</p>\n<p>相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。</p>\n<p>更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。</p>\n<h1 id=\"2：主机设置代理访问\"><a href=\"#2：主机设置代理访问\" class=\"headerlink\" title=\"2：主机设置代理访问\"></a>2：主机设置代理访问</h1><p>为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。</p>\n<ol>\n<li>打开<code>代理服务器色设置</code></li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"2\">\n<li>在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li>使用浏览器登陆google</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。</p>\n<h1 id=\"3：国外服务器配置\"><a href=\"#3：国外服务器配置\" class=\"headerlink\" title=\"3：国外服务器配置\"></a>3：国外服务器配置</h1><p>确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。</p>\n<h2 id=\"3-1-安装配置Squid\"><a href=\"#3-1-安装配置Squid\" class=\"headerlink\" title=\"3.1 安装配置Squid\"></a>3.1 安装配置Squid</h2><ol>\n<li>安装squid</li>\n</ol>\n<p>ubuntu使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install squid</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install squid</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>squid -v</code>检查squid是否安装好。</p>\n<ol start=\"2\">\n<li>配置squid</li>\n</ol>\n<p>打开squid配置文件<code>/etc/squid/squid.conf</code>。没有就新建此文件</p>\n<p>将文件内容修改为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> http_port 设置监听端口，默认为3128</span></span><br><span class=\"line\">http_port 3128</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class=\"built_in\">log</span>/squid/access.log文件, </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class=\"line\">access_log daemon:/var/log/squid/access.log combined</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> visible_hotname 设置代理服务器的主机名</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 默认取本机的hostname</span></span><br><span class=\"line\">visible_hostname funway.aliyun.proxy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80    # http</span><br><span class=\"line\">acl Safe_ports port 21    # ftp</span><br><span class=\"line\">acl Safe_ports port 443    # https</span><br><span class=\"line\">acl Safe_ports port 70    # gopher</span><br><span class=\"line\">acl Safe_ports port 210    # wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280    # http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488    # gss-http</span><br><span class=\"line\">acl Safe_ports port 591    # filemaker</span><br><span class=\"line\">acl Safe_ports port 777    # multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非Safe_ports的请求</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Only allow cachemgr access from localhost</span></span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\">http_access deny manager</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许来自本地的请求</span></span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有请求，最后兜底的规则</span></span><br><span class=\"line\">http_access deny all</span><br></pre></td></tr></table></figure>\n\n<p>更多详细的配置参数解释，请参考博文《<a href=\"https://www.hawu.me/operation/852\">使用squid搭建代理服务器</a>》</p>\n<p>配置squid只能本地地址访问。</p>\n<ol start=\"3\">\n<li>运行squid</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid start //运行</span><br><span class=\"line\">service squid status //查看squid运行状态</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-安装配置stunnel服务端\"><a href=\"#3-2-安装配置stunnel服务端\" class=\"headerlink\" title=\"3.2 安装配置stunnel服务端\"></a>3.2 安装配置stunnel服务端</h2><ol>\n<li>生成自签名证书，如果没有openssl需要先安装。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure>\n\n<p>将生成的证书，复制到/etc/stunnel文件夹下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp stunnel.pem /etc/stunnel</span><br></pre></td></tr></table></figure>\n\n<p>这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。</p>\n<ol>\n<li>下载安装stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>设置stunnel配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; 设置工作目录，没有目录需要先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; 设置stunnel的pid文件路径（在chroot下）</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 设置stunnel工作的用户（组）</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\"></span><br><span class=\"line\">; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)</span><br><span class=\"line\">; 默认为5</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）</span><br><span class=\"line\">output = /stunnel.log</span><br><span class=\"line\"></span><br><span class=\"line\">; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）</span><br><span class=\"line\">cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">; 私钥文件</span><br><span class=\"line\">key = /etc/stunnel/stunnel.pem</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。</span><br><span class=\"line\">; 自定义服务名squid-proxy</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class=\"line\">accept = 3129</span><br><span class=\"line\">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class=\"line\">connect = localhost:3128</span><br><span class=\"line\"></span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\">; * 下面这些配置我都注释掉了，但也需要了解下 *</span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置是否对传输数据进行压缩，默认不开启。</span><br><span class=\"line\">; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）</span><br><span class=\"line\">;compression = zlib</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置ssl版本,这个也是跟安装的openssl有关的</span><br><span class=\"line\">;sslVersion = TLSv1</span><br><span class=\"line\"></span><br><span class=\"line\">; Authentication stuff needs to be configured to prevent MITM attacks</span><br><span class=\"line\">; It is important to understand that this option was solely designed for access control and not for authorization</span><br><span class=\"line\">; It is not enabled by default!</span><br><span class=\"line\">; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，</span><br><span class=\"line\">; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。</span><br><span class=\"line\">; 这是有效防止中间人攻击的手段</span><br><span class=\"line\">; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）</span><br><span class=\"line\">; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）</span><br><span class=\"line\">;verify = 2</span><br><span class=\"line\">; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。</span><br><span class=\"line\">;CAfile = /etc/stunnel/stunnel-client.pem</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>启动停止stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start //开启stunnel</span><br><span class=\"line\">service stunnel restart //重启</span><br><span class=\"line\">service stunnel stop //停止</span><br><span class=\"line\">service stunnel status  //查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：国内服务器配置Stunnel客户端\"><a href=\"#4：国内服务器配置Stunnel客户端\" class=\"headerlink\" title=\"4：国内服务器配置Stunnel客户端\"></a>4：国内服务器配置Stunnel客户端</h1><p>国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。</p>\n<ol>\n<li>在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。</li>\n</ol>\n<p>本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组-&gt;防火墙-&gt;添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。</p>\n<ol start=\"2\">\n<li>配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。</li>\n</ol>\n<p>查看开放端口，如果没有firewall，请先安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n\n<p>设置需要开放的端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=3128/tcp --permanent//设置</span><br><span class=\"line\">firewall-cmd --reload//生效</span><br></pre></td></tr></table></figure>\n\n<p>此时再查看开放的端口，就能看到3128端口已开放。</p>\n<ol start=\"3\">\n<li>安装stunnel客户端。</li>\n</ol>\n<p>ubuntu使用:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>设置stunnel客户端配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; stunnel工作的用户组</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\">; stunnel工作时候的pid</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 日志等级</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件</span><br><span class=\"line\">output = /var/log/stunnel/stunnel.log</span><br><span class=\"line\">; 表示以client模式启动stunnel，默认client = no，即server模式</span><br><span class=\"line\">client = yes</span><br><span class=\"line\">; 定义一个服务</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class=\"line\">accept = 3128</span><br><span class=\"line\">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class=\"line\">connect = xx.xx.xx.xx:3129</span><br><span class=\"line\">; 需要验证对方发过来的证书</span><br><span class=\"line\">verify = 2</span><br><span class=\"line\">; 用来进行证书验证的文件（里面有stunnel server的证书）</span><br><span class=\"line\">CAfile = /etc/stunnel/stunnel-server.pem</span><br><span class=\"line\">; 客户端不需要传递自己的证书，所以注释掉</span><br><span class=\"line\">;cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">;key = /etc/stunnel/stunnel.key</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。</li>\n</ol>\n<p>配置文件里<code>CAfile = /etc/stunnel/stunnel-server.pem</code>写明了我们需要将公钥保存的位置和公钥的文件名。</p>\n<p>我们只需要将，3.2节生成的证书打开，复制已<code>BEGIN CERTIFICATION</code>开头到<code>END CERTIFICATION</code>结束的公钥。然后，新建<code>/etc/stunnel/stunnel-server.pem</code>文件，将公钥粘贴进去。</p>\n<p>这样stunnel客户端就能将数据加密后发送给stunnel服务器了。</p>\n<ol start=\"6\">\n<li>启动和停止stunnel</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start &#x2F;&#x2F;开启stunnel</span><br><span class=\"line\">service stunnel restart &#x2F;&#x2F;重启</span><br><span class=\"line\">service stunnel stop &#x2F;&#x2F;停止</span><br><span class=\"line\">service stunnel status  &#x2F;&#x2F;查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：不足和优化\"><a href=\"#5：不足和优化\" class=\"headerlink\" title=\"5：不足和优化\"></a>5：不足和优化</h1><h2 id=\"5-1-代理方法的不足\"><a href=\"#5-1-代理方法的不足\" class=\"headerlink\" title=\"5.1 代理方法的不足\"></a>5.1 代理方法的不足</h2><ol>\n<li><p>由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。</p>\n</li>\n<li><p>stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。</p>\n</li>\n</ol>\n<h2 id=\"5-2-优化\"><a href=\"#5-2-优化\" class=\"headerlink\" title=\"5.2 优化\"></a>5.2 优化</h2><ol>\n<li>配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid</li>\n</ol>\n<ul>\n<li>修改配置文件<code>/etc/squid/squid.conf</code>，在<code>http_access deny all</code>之前追加以下内容，并注释掉<code>http_access allow localhost</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> auth_param 设置代理的认证方式</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 用法：auth_param scheme parameter [setting]</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。</span></span><br><span class=\"line\">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> children 设置后台启动几个认证程序进程</span></span><br><span class=\"line\">auth_param basic children 3</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> credentialsttl 设置认证失效时间，过期后需重新认证</span></span><br><span class=\"line\">auth_param basic credentialsttl 10 hours</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”</span></span><br><span class=\"line\">auth_param basic realm welecome to using my proxy</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 添加名为AuthUsers访问列表，表示通过认证的用户</span></span><br><span class=\"line\">acl AuthUsers proxy_auth REQUIRED</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许AuthUsers的代理请求</span></span><br><span class=\"line\">http_access allow AuthUsers</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>新建密码文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">htpasswd -c /etc/squid/passwd qifei</span><br></pre></td></tr></table></figure>\n\n<p>如果没有htpasswd，则按提示安装。输入密码即可。</p>\n<ul>\n<li>重启squid</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid restart</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。</li>\n</ol>\n<h1 id=\"6：补充\"><a href=\"#6：补充\" class=\"headerlink\" title=\"6：补充\"></a>6：补充</h1><h2 id=\"6-1-只能访问谷歌而无法访问YouTube\"><a href=\"#6-1-只能访问谷歌而无法访问YouTube\" class=\"headerlink\" title=\"6.1 只能访问谷歌而无法访问YouTube\"></a>6.1 只能访问谷歌而无法访问YouTube</h2><h3 id=\"5-30日更新：\"><a href=\"#5-30日更新：\" class=\"headerlink\" title=\"5.30日更新：\"></a>5.30日更新：</h3><p>在经过一段时间的使用后，上种方法存在一些弊端。</p>\n<p>在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。</p>\n<p>利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url<code>youtube.com</code>。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。</p>\n<p>而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。</p>\n<p>之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。</p>\n<p>查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。</p>\n<p>在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。</p>\n<p>因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。</p>\n<p>最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。</p>\n<p>这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。</p>\n<h3 id=\"5-31日更新：\"><a href=\"#5-31日更新：\" class=\"headerlink\" title=\"5.31日更新：\"></a>5.31日更新：</h3><p>我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。</p>\n<p>我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。</p>\n<p>我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。</p>\n<p>猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。</p>\n<p><strong>结论</strong>，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。</p>\n<p>这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。</p>\n<p>通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。</p>\n<p>而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。</p>\n<p>总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。</p>\n<h2 id=\"6-2-使用用户名和密码手机软件不能弹出登陆框\"><a href=\"#6-2-使用用户名和密码手机软件不能弹出登陆框\" class=\"headerlink\" title=\"6.2 使用用户名和密码手机软件不能弹出登陆框\"></a>6.2 使用用户名和密码手机软件不能弹出登陆框</h2><p>在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。</p>\n<h3 id=\"方法1：完全开放代理\"><a href=\"#方法1：完全开放代理\" class=\"headerlink\" title=\"方法1：完全开放代理\"></a>方法1：完全开放代理</h3><p>修改<code>squid.conf</code>关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。</p>\n<h3 id=\"方法2：IP限制\"><a href=\"#方法2：IP限制\" class=\"headerlink\" title=\"方法2：IP限制\"></a>方法2：IP限制</h3><p>在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。</p>\n<p>完整拓扑结构：用户主机-&gt;squid（国内）-&gt;stunnel（国内）-&gt;stunnel（国外）-&gt;squid（国外）-&gt;网站服务器</p>\n<p>添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。</p>\n<h3 id=\"方法3：网页验证加自定义ACL辅助器验证\"><a href=\"#方法3：网页验证加自定义ACL辅助器验证\" class=\"headerlink\" title=\"方法3：网页验证加自定义ACL辅助器验证\"></a>方法3：网页验证加自定义ACL辅助器验证</h3><p>第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。</p>\n<p><strong>设计思路</strong></p>\n<ol>\n<li>用户设置ip和端口，无密码连接代理服务器。</li>\n<li>用户打开浏览器，访问任意网页</li>\n<li>利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。</li>\n<li>网页后台验证用户输入的用户名和密码。并保存用户ip。</li>\n<li>编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。</li>\n</ol>\n<h3 id=\"方法4：自定义验证器加ACL辅助器验证\"><a href=\"#方法4：自定义验证器加ACL辅助器验证\" class=\"headerlink\" title=\"方法4：自定义验证器加ACL辅助器验证\"></a>方法4：自定义验证器加ACL辅助器验证</h3><p>第一次登陆，弹出代理登陆框，通过后保存ip</p>\n<ol>\n<li>用户设置ip和端口，连接代理服务器。</li>\n<li>代理服务器通过ACL辅助器验证此IP是否在白名单中。</li>\n<li>不在白名单则，进入自定义验证器，在，则通过代理。</li>\n<li>进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。</li>\n</ol>\n<p>我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：加速原理\"><a href=\"#1：加速原理\" class=\"headerlink\" title=\"1：加速原理\"></a>1：加速原理</h1><h2 id=\"1-1-squid介绍\"><a href=\"#1-1-squid介绍\" class=\"headerlink\" title=\"1.1 squid介绍\"></a>1.1 squid介绍</h2><p>squid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。</p>\n<p>按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。</p>\n<p>但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。</p>\n<h2 id=\"1-2-Https介绍\"><a href=\"#1-2-Https介绍\" class=\"headerlink\" title=\"1.2 Https介绍\"></a>1.2 Https介绍</h2><p>这篇文章详细介绍了加密的原理：<a href=\"https://blog.csdn.net/clh604/article/details/22179907\">https://blog.csdn.net/clh604/article/details/22179907</a></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png\" alt=\"SSL\"></p>\n<h2 id=\"1-3-stunnel介绍\"><a href=\"#1-3-stunnel介绍\" class=\"headerlink\" title=\"1.3 stunnel介绍\"></a>1.3 stunnel介绍</h2><p>stunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。</p>\n<p>为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。</p>\n<h2 id=\"1-4-代理过程\"><a href=\"#1-4-代理过程\" class=\"headerlink\" title=\"1.4 代理过程\"></a>1.4 代理过程</h2><p>在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。</p>\n<p>通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png\"></p>\n<p>但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。</p>\n<p>相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。</p>\n<p>更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。</p>\n<h1 id=\"2：主机设置代理访问\"><a href=\"#2：主机设置代理访问\" class=\"headerlink\" title=\"2：主机设置代理访问\"></a>2：主机设置代理访问</h1><p>为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。</p>\n<ol>\n<li>打开<code>代理服务器色设置</code></li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg\"></p>\n<ol start=\"2\">\n<li>在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg\"></p>\n<ol start=\"3\">\n<li>使用浏览器登陆google</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg\"></p>\n<p>实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。</p>\n<h1 id=\"3：国外服务器配置\"><a href=\"#3：国外服务器配置\" class=\"headerlink\" title=\"3：国外服务器配置\"></a>3：国外服务器配置</h1><p>确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。</p>\n<h2 id=\"3-1-安装配置Squid\"><a href=\"#3-1-安装配置Squid\" class=\"headerlink\" title=\"3.1 安装配置Squid\"></a>3.1 安装配置Squid</h2><ol>\n<li>安装squid</li>\n</ol>\n<p>ubuntu使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install squid</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install squid</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>squid -v</code>检查squid是否安装好。</p>\n<ol start=\"2\">\n<li>配置squid</li>\n</ol>\n<p>打开squid配置文件<code>/etc/squid/squid.conf</code>。没有就新建此文件</p>\n<p>将文件内容修改为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> http_port 设置监听端口，默认为3128</span></span><br><span class=\"line\">http_port 3128</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class=\"built_in\">log</span>/squid/access.log文件, </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class=\"line\">access_log daemon:/var/log/squid/access.log combined</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> visible_hotname 设置代理服务器的主机名</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 默认取本机的hostname</span></span><br><span class=\"line\">visible_hostname funway.aliyun.proxy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80    # http</span><br><span class=\"line\">acl Safe_ports port 21    # ftp</span><br><span class=\"line\">acl Safe_ports port 443    # https</span><br><span class=\"line\">acl Safe_ports port 70    # gopher</span><br><span class=\"line\">acl Safe_ports port 210    # wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280    # http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488    # gss-http</span><br><span class=\"line\">acl Safe_ports port 591    # filemaker</span><br><span class=\"line\">acl Safe_ports port 777    # multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非Safe_ports的请求</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Only allow cachemgr access from localhost</span></span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\">http_access deny manager</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许来自本地的请求</span></span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有请求，最后兜底的规则</span></span><br><span class=\"line\">http_access deny all</span><br></pre></td></tr></table></figure>\n\n<p>更多详细的配置参数解释，请参考博文《<a href=\"https://www.hawu.me/operation/852\">使用squid搭建代理服务器</a>》</p>\n<p>配置squid只能本地地址访问。</p>\n<ol start=\"3\">\n<li>运行squid</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid start //运行</span><br><span class=\"line\">service squid status //查看squid运行状态</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-安装配置stunnel服务端\"><a href=\"#3-2-安装配置stunnel服务端\" class=\"headerlink\" title=\"3.2 安装配置stunnel服务端\"></a>3.2 安装配置stunnel服务端</h2><ol>\n<li>生成自签名证书，如果没有openssl需要先安装。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure>\n\n<p>将生成的证书，复制到/etc/stunnel文件夹下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp stunnel.pem /etc/stunnel</span><br></pre></td></tr></table></figure>\n\n<p>这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。</p>\n<ol>\n<li>下载安装stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>设置stunnel配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; 设置工作目录，没有目录需要先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; 设置stunnel的pid文件路径（在chroot下）</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 设置stunnel工作的用户（组）</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\"></span><br><span class=\"line\">; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)</span><br><span class=\"line\">; 默认为5</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）</span><br><span class=\"line\">output = /stunnel.log</span><br><span class=\"line\"></span><br><span class=\"line\">; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）</span><br><span class=\"line\">cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">; 私钥文件</span><br><span class=\"line\">key = /etc/stunnel/stunnel.pem</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。</span><br><span class=\"line\">; 自定义服务名squid-proxy</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class=\"line\">accept = 3129</span><br><span class=\"line\">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class=\"line\">connect = localhost:3128</span><br><span class=\"line\"></span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\">; * 下面这些配置我都注释掉了，但也需要了解下 *</span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置是否对传输数据进行压缩，默认不开启。</span><br><span class=\"line\">; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）</span><br><span class=\"line\">;compression = zlib</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置ssl版本,这个也是跟安装的openssl有关的</span><br><span class=\"line\">;sslVersion = TLSv1</span><br><span class=\"line\"></span><br><span class=\"line\">; Authentication stuff needs to be configured to prevent MITM attacks</span><br><span class=\"line\">; It is important to understand that this option was solely designed for access control and not for authorization</span><br><span class=\"line\">; It is not enabled by default!</span><br><span class=\"line\">; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，</span><br><span class=\"line\">; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。</span><br><span class=\"line\">; 这是有效防止中间人攻击的手段</span><br><span class=\"line\">; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）</span><br><span class=\"line\">; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）</span><br><span class=\"line\">;verify = 2</span><br><span class=\"line\">; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。</span><br><span class=\"line\">;CAfile = /etc/stunnel/stunnel-client.pem</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>启动停止stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start //开启stunnel</span><br><span class=\"line\">service stunnel restart //重启</span><br><span class=\"line\">service stunnel stop //停止</span><br><span class=\"line\">service stunnel status  //查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：国内服务器配置Stunnel客户端\"><a href=\"#4：国内服务器配置Stunnel客户端\" class=\"headerlink\" title=\"4：国内服务器配置Stunnel客户端\"></a>4：国内服务器配置Stunnel客户端</h1><p>国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。</p>\n<ol>\n<li>在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。</li>\n</ol>\n<p>本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组-&gt;防火墙-&gt;添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。</p>\n<ol start=\"2\">\n<li>配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。</li>\n</ol>\n<p>查看开放端口，如果没有firewall，请先安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n\n<p>设置需要开放的端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=3128/tcp --permanent//设置</span><br><span class=\"line\">firewall-cmd --reload//生效</span><br></pre></td></tr></table></figure>\n\n<p>此时再查看开放的端口，就能看到3128端口已开放。</p>\n<ol start=\"3\">\n<li>安装stunnel客户端。</li>\n</ol>\n<p>ubuntu使用:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>设置stunnel客户端配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; stunnel工作的用户组</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\">; stunnel工作时候的pid</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 日志等级</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件</span><br><span class=\"line\">output = /var/log/stunnel/stunnel.log</span><br><span class=\"line\">; 表示以client模式启动stunnel，默认client = no，即server模式</span><br><span class=\"line\">client = yes</span><br><span class=\"line\">; 定义一个服务</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class=\"line\">accept = 3128</span><br><span class=\"line\">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class=\"line\">connect = xx.xx.xx.xx:3129</span><br><span class=\"line\">; 需要验证对方发过来的证书</span><br><span class=\"line\">verify = 2</span><br><span class=\"line\">; 用来进行证书验证的文件（里面有stunnel server的证书）</span><br><span class=\"line\">CAfile = /etc/stunnel/stunnel-server.pem</span><br><span class=\"line\">; 客户端不需要传递自己的证书，所以注释掉</span><br><span class=\"line\">;cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">;key = /etc/stunnel/stunnel.key</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。</li>\n</ol>\n<p>配置文件里<code>CAfile = /etc/stunnel/stunnel-server.pem</code>写明了我们需要将公钥保存的位置和公钥的文件名。</p>\n<p>我们只需要将，3.2节生成的证书打开，复制已<code>BEGIN CERTIFICATION</code>开头到<code>END CERTIFICATION</code>结束的公钥。然后，新建<code>/etc/stunnel/stunnel-server.pem</code>文件，将公钥粘贴进去。</p>\n<p>这样stunnel客户端就能将数据加密后发送给stunnel服务器了。</p>\n<ol start=\"6\">\n<li>启动和停止stunnel</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start &#x2F;&#x2F;开启stunnel</span><br><span class=\"line\">service stunnel restart &#x2F;&#x2F;重启</span><br><span class=\"line\">service stunnel stop &#x2F;&#x2F;停止</span><br><span class=\"line\">service stunnel status  &#x2F;&#x2F;查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：不足和优化\"><a href=\"#5：不足和优化\" class=\"headerlink\" title=\"5：不足和优化\"></a>5：不足和优化</h1><h2 id=\"5-1-代理方法的不足\"><a href=\"#5-1-代理方法的不足\" class=\"headerlink\" title=\"5.1 代理方法的不足\"></a>5.1 代理方法的不足</h2><ol>\n<li><p>由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。</p>\n</li>\n<li><p>stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。</p>\n</li>\n</ol>\n<h2 id=\"5-2-优化\"><a href=\"#5-2-优化\" class=\"headerlink\" title=\"5.2 优化\"></a>5.2 优化</h2><ol>\n<li>配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid</li>\n</ol>\n<ul>\n<li>修改配置文件<code>/etc/squid/squid.conf</code>，在<code>http_access deny all</code>之前追加以下内容，并注释掉<code>http_access allow localhost</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> auth_param 设置代理的认证方式</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 用法：auth_param scheme parameter [setting]</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。</span></span><br><span class=\"line\">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> children 设置后台启动几个认证程序进程</span></span><br><span class=\"line\">auth_param basic children 3</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> credentialsttl 设置认证失效时间，过期后需重新认证</span></span><br><span class=\"line\">auth_param basic credentialsttl 10 hours</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”</span></span><br><span class=\"line\">auth_param basic realm welecome to using my proxy</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 添加名为AuthUsers访问列表，表示通过认证的用户</span></span><br><span class=\"line\">acl AuthUsers proxy_auth REQUIRED</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许AuthUsers的代理请求</span></span><br><span class=\"line\">http_access allow AuthUsers</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>新建密码文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">htpasswd -c /etc/squid/passwd qifei</span><br></pre></td></tr></table></figure>\n\n<p>如果没有htpasswd，则按提示安装。输入密码即可。</p>\n<ul>\n<li>重启squid</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid restart</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。</li>\n</ol>\n<h1 id=\"6：补充\"><a href=\"#6：补充\" class=\"headerlink\" title=\"6：补充\"></a>6：补充</h1><h2 id=\"6-1-只能访问谷歌而无法访问YouTube\"><a href=\"#6-1-只能访问谷歌而无法访问YouTube\" class=\"headerlink\" title=\"6.1 只能访问谷歌而无法访问YouTube\"></a>6.1 只能访问谷歌而无法访问YouTube</h2><h3 id=\"5-30日更新：\"><a href=\"#5-30日更新：\" class=\"headerlink\" title=\"5.30日更新：\"></a>5.30日更新：</h3><p>在经过一段时间的使用后，上种方法存在一些弊端。</p>\n<p>在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。</p>\n<p>利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url<code>youtube.com</code>。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。</p>\n<p>而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。</p>\n<p>之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。</p>\n<p>查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。</p>\n<p>在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。</p>\n<p>因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。</p>\n<p>最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。</p>\n<p>这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。</p>\n<h3 id=\"5-31日更新：\"><a href=\"#5-31日更新：\" class=\"headerlink\" title=\"5.31日更新：\"></a>5.31日更新：</h3><p>我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。</p>\n<p>我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。</p>\n<p>我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。</p>\n<p>猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。</p>\n<p><strong>结论</strong>，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。</p>\n<p>这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。</p>\n<p>通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。</p>\n<p>而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。</p>\n<p>总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。</p>\n<h2 id=\"6-2-使用用户名和密码手机软件不能弹出登陆框\"><a href=\"#6-2-使用用户名和密码手机软件不能弹出登陆框\" class=\"headerlink\" title=\"6.2 使用用户名和密码手机软件不能弹出登陆框\"></a>6.2 使用用户名和密码手机软件不能弹出登陆框</h2><p>在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。</p>\n<h3 id=\"方法1：完全开放代理\"><a href=\"#方法1：完全开放代理\" class=\"headerlink\" title=\"方法1：完全开放代理\"></a>方法1：完全开放代理</h3><p>修改<code>squid.conf</code>关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。</p>\n<h3 id=\"方法2：IP限制\"><a href=\"#方法2：IP限制\" class=\"headerlink\" title=\"方法2：IP限制\"></a>方法2：IP限制</h3><p>在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。</p>\n<p>完整拓扑结构：用户主机-&gt;squid（国内）-&gt;stunnel（国内）-&gt;stunnel（国外）-&gt;squid（国外）-&gt;网站服务器</p>\n<p>添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。</p>\n<h3 id=\"方法3：网页验证加自定义ACL辅助器验证\"><a href=\"#方法3：网页验证加自定义ACL辅助器验证\" class=\"headerlink\" title=\"方法3：网页验证加自定义ACL辅助器验证\"></a>方法3：网页验证加自定义ACL辅助器验证</h3><p>第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。</p>\n<p><strong>设计思路</strong></p>\n<ol>\n<li>用户设置ip和端口，无密码连接代理服务器。</li>\n<li>用户打开浏览器，访问任意网页</li>\n<li>利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。</li>\n<li>网页后台验证用户输入的用户名和密码。并保存用户ip。</li>\n<li>编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。</li>\n</ol>\n<h3 id=\"方法4：自定义验证器加ACL辅助器验证\"><a href=\"#方法4：自定义验证器加ACL辅助器验证\" class=\"headerlink\" title=\"方法4：自定义验证器加ACL辅助器验证\"></a>方法4：自定义验证器加ACL辅助器验证</h3><p>第一次登陆，弹出代理登陆框，通过后保存ip</p>\n<ol>\n<li>用户设置ip和端口，连接代理服务器。</li>\n<li>代理服务器通过ACL辅助器验证此IP是否在白名单中。</li>\n<li>不在白名单则，进入自定义验证器，在，则通过代理。</li>\n<li>进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。</li>\n</ol>\n<p>我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png","popularPost_tmp_gaData":{"updated":"Tue Jun 02 2020 06:47:16 GMT+0200 (GMT+02:00)","title":"利用Stunnel+squid代理实现国内无客户端访问外网","path":"2020/05/28/Stunnel-squid代理加速亚琛教学视频加速/","eyeCatchImage":"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-05-28T21:26:23.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-05-28T21:26:23.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"其他","tags":["Stunnel代理"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Vue、Vuejs学习记录","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-02-15T16:31:51.000Z","password":null,"summary":"Vue.js（/vjuː/，或简称为Vue）是一个用于创建用户界面的开源JavaScript框架，也是一个创建单页应用的Web应用框架。 2016年一项针对JavaScript的调查表明，Vue有着89%的开发者满意度。在GitHub上，该项目平均每天能收获95颗星，为Github有史以来星标数第3多的项目。","_content":"\n# 0：ES6补充\n\n## 0.1 块级作用域\n\n```html\n<script>\n\t//变量作用域：变量在什么范围内可用\n    {\n        var name = 'why';\n        console.log(name);\n    }\n    console.log(name);//在大括号外也能打开。\n    \n    //没有块级作用域会导致什么问题\n    var btns = document.getElementsByTagName('button');\n    for(var i = 0; i<btns.length;i++){\n        btns[i].addEventListener('click',function(){\n            console.log('第'+i+'个按钮被点击')\n        })\n    }\n    //显示的按钮被点击不准确。使用闭包解决此问题    \n    for(var i = 0; i<btns.length;i++){\n        (function(num){\n            btns[num].addEventListener('click',function(){\n            console.log('第'+num+'个按钮被点击')\n        \t})\n        })(i)\n        \n    }\n</script>\n```\n\n\n\n# 1：Vue初体验\n\n## 1.1 认识Vuejs\n\n作为时下流行的前端框架，Vuejs是很多中小型企业开发项目的首选框架。\n\n- Vue是一个渐进式的框架。\n  - 渐进式意味着可以将Vue作为应用的一部分嵌入进去，带来更丰富的交互体验。\n\n- Vue特点和Web开发中的高级功能\n  - 解耦视图和数据\n  - 可复用的组件\n  - 前端路由\n  - 状态管理\n  - 虚拟DOM\n\n- 学习前提\n  - 不需要Angular、React、jQuery\n  - 需要HTML、CSS、JavaScript基础\n\n## 1.2 Vue.js安装\n\n方式一：直接CDN引入\n\n方式二：下载和引入\n\n- 安装教程 https://cn.vuejs.org\n\n- 开发环境 https://vuejs.org/js/vue.js\n- 生产环境 https://vuejs.org/js/vue.min.js\n\n方式三：NPM安装\n\n- 通过webpack和CLI\n\n## 1.3 Hello Vuejs\n\nVue的响应式\n\n```html\n<body>\n\n    <div id=\"app\">\n        <h1>\n            {{name}}\n        </h1>\n        {{message}}\n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n    \t//let(变量)/const(常量)\n        //编程范式：声明式编程\n        const app = new Vue({\n            el:'#app',//用于挂在要管理的元素\n            data:{//定义数据\n                message:'你好啊！',//在div中显示message内容\n                name:'coderwhy'\n            }\n        })        \n\n        //原始js的做法（编程范式：命令式编程）\n        //1.创建div元素，设置id属性\n        //2.定义一个变量叫message\n        //3.将message变量放在div元素中显示\n        //4.修改messge的数据\n        //5.将修改后的数据替换到div元素\n    </script>   \n</body>\n```\n\n## 1.4 Vue列表显示\n\n```html\n<body>\n    <div id=\"app\">\n        <ul>\n            <li v-for=\"item in movies\">{{item}}</li>\n        </ul>\n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                message:'你好啊'，\n                movies:['海王','大话西游','星际穿越','少年派']\n            }\n        })\n    </script>\n</body>\n```\n\n`app.movies.push('盗梦空间')//添加数据`\n\n- 使用v-for指令遍历数组元素\n\n**案例展示：计数器**\n\n<script src=\"/js/vue.min.js\"></script>\n<div id=\"app\">\n    当前计数：0</br>\n        <button v-on:click=\"counter++\">+</button>\n        <button v-on:click=\"counter--\">-</button>\n</div>\n<script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            }\n        })\n</script>\n\n```html\n<body>\n    <script src=\"../js/vue.js\"></script>\n    <div id=\"app\">\n        <h2>\n            当前计数：{{counter}}\n        </h2>\n        <!--<button v-on:click=\"counter++\">+</button>-->\n        <!--<button v-on:click=\"counter--\">-</button>-->\n        <button v-on:click=\"add\">+</button>\n        <button @click=\"min\">-</button>\n    </div>\n    <script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            },\n            methods:{\n                add:function(){\n                    console.log('add被执行')；\n                    this.counter++;\n                },\n                min:function(){\n            \t\tconsole.log('min被执行')；\n\t\t\t\t\tthis.counter--;\n        \t\t}\n            }\n        })\n        \n        //原始js\n        //1.拿buttom元素\n        //2.添加监听时间\n    </script>\n</body>\n```\n\n- 新属性：methods，该属性用于Vue对象中定义方法。\n\n- 新指令：@click，该指令用于监听某个元素的点击事件。\n\n## 1.5 Vue中的MVVM\n\n什么是MVVM？\n\n- Model View ViewModel\n\n## 1.6 创建Vue实例传入的options\n\n目前掌握的选项\n\n- el：\n  - 字符型String|HTMLElement\n  - 决定Vue管理哪一个DOM\n\n- data：\n  - Object|Funtion()**（组件当中必须是一个函数）**\n  - Vue实例对应的数据对象。\n\n- methods：\n  - {[key:string] Function}\n  - 定义属于Vue的一些方法，可以在其他地方调用，也可以在指令中使用\n\n## 1.7 Vue的生命周期\n\n生命周期：事物从诞生到消亡的整个过程\n\n```html\n<script>\n\tnew Vue({\n        el:'#app',\n        data:obj,\n        methods:{},\n        created:function(){},\n        mounted:function(){}\n    })\n</script>\n```\n\n## 1.8 Vue的生命周期函数\n\n```html\n<script>\n\tnew Vue({\n        el:'#app',\n        data:obj,\n        methods:{},\n        beforeCreate:function(){},//Hook:钩子函数\n        created:function(){},\n        mounted:function(){}\n    })\n</script>\n```\n\n**生命周期函数：**`beforeCreate,create,beforeMounte,mounted,beforeUpdate,updated,beforDestroy,destroyed`\n\n# 2：插值的操作\n\n## 2.1 Mustache语法，插值的操作\n\nMustache语法：双大括号//mustache胡须\n\n```html\n<div>\n    <h2>\n        {{message}}\n    </h2>\n    <h2>\n        {{firstName+' '+lastName}}\n    </h2>\n     <h2>\n        {{firstName}} {{lastName}}\n    </h2>\n    <h2>{{counter*2}}</h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            message:'nihao',\n            firstName:'kobe',\n            lastName:'bryant',\n            counter:100\n        },\n        \n    })\n</script>\n```\n\nmustache语法不仅可以直接写变量，还可以写语法。\n\n## 2.2 插值操作--其他指令使用\n\n- **v-once**: 不想改变DOM值，使DOM变成非响应式。\n\n```html\n<h2 v-once>\n    {{message}}<!--message不会随数据更新而改变-->\n</h2>\n```\n\n- **v-html**:直接展示html代码，而不是展示其字符串\n\n```html\n<div>\n    <h2 v-html=\"url\"></h2>\n</div>\n<script>\n    new Vue({\n            el:'#app',\n            data:{\n                url='<a href=\"https://www.baidu.com\">百度一下</a>'\n            }\n        })\n</script>\n```\n\n输出结果：[百度一下](https://www.baidu.com)\n\n- **v-text**：和{{message}}作用相同，但会覆盖`<h2>`代码块中的字符会被覆盖掉，不灵活。\n\n```html\n<body>\n\n    <div id=\"app\">\n        <h2 v-text=\"message\"></h2>\n        <h2>{{message}}</h2>\n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n        const app = new Vue({\n            el:'#app',//用于挂在要管理的元素\n            data:{//定义数据\n                message:'你好啊！'\n            }\n        })        \n    </script>   \n</body>\n```\n\n- **v-pre**：将例如大括号显示出来，不渲染数据\n\n```html\n<h2 v-pre>\n    {{message}}\n</h2>\n```\n\n输出结果：{{message}}\n\n- **v-cloak**：当js延迟加载出来时，不显示dom渲染之前的值。{{message}}不会在渲染之前出现//cloak斗篷\n\n```html\n<!--<head>\n    <style>\n        [v-cloak]{\n            display:none;\n        }\n    </style>\n</head>-->\n<div id=\"app\" v-cloak>\n    {{message}}\n</div>\n<script>\n    ...\n</script>\n```\n\n# 3：动态绑定属性\n\n## 3.1 v-bind，动态绑定DOM属性\n\n- v-bind的基本使用\n\n```html\n<body>\n\n    <div id=\"app\">\n        <img v-bind:src=\"imgURL\" alt=\"\">\n        <a v-bind:href=\"aHref\"></a> \n        \n        <!--语法糖的写法-->\n        <img :src=\"imgURL\" alt=\"\">\n        <a :href=\"aHref\"></a> \n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n        const app = new Vue({\n            el:'#app',//用于挂在要管理的元素\n            data:{\n                aHref=\"https://www.baidu.com\",\n\t\t\t\timgURL:'https://i0.hdslb.com/bfs/sycp/creative_img/202002/1e9bfa663a93374c8e10c3933cfc78f8.jpg'\n            }\n        })        \n    </script>   \n</body>\n```\n\n- v-bind简写/语法糖：`:`\n- v-bind对象用法：\n\n```html\n<div>\n    <h2 class=\"title\" :class=\"{class1:isClass1,class2:isClass2}\">{{message}}</h2>\n</div>\n<script>\n    new Vue({\n        data:{\n            message:\"showClassExample\"\n            isClass1:true,\n            isClass2:false\n        }\n    })\n</script>\n```\n\n**//title类固定，动态更改class1和class2**\n\n`{类名:布尔值,类名：布尔值}`\n\n- v-bind数组语法\n\n```html\n<div>\n    <h2 class=\"title\" :class=\"getClasses()\">{{message}}</h2>\n</div>\n<script>\n    new Vue({\n        data:{\n            message:\"showClassExample\",\n            isClass1:true,\n            isClass2:false\n        }\n        methods:{\n        \tgetClasses:function(){\n        \t\treturn{class1:this.isClass1,class2:this.isClass2}\n    \t\t}\n    \t}\n    })\n</script>\n```\n\n**注意：v-on中函数省略了()，但v-bind需要添加()**\n\n```html\n<div>\n    <h2 class=\"title\" :class=\"[class1,class2]\">{{message}}</h2>\n</div>\n<script>\n    new Vue({\n        data:{\n            message:\"showClassExample\",\n            class1:'class1',\n            class2:'class2'\n        }\n    })\n</script>\n```\n\n## 3.2 作业，结合v-for和v-bind\n\n作业：使用v-for显示一个电影名称列表，设置监听点击事件，当某个电影被点击，改变此电影名称字体颜色为红色。\n\n答案：\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <style>\n        .red{color:red}\n    </style>\n</head>\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <ul>\n        <li v-for=\"(m, index) in movies\" @click=\"clickItem=index\" :class=\"{red:clickItem==index}\">{{m}}</li>\n    </ul>\n</div>\n<script>\n    \tconst app = new Vue({\n            el:'#app',\n            data: {\n                movies: ['复仇者联盟', '生化危机', '星际大战', '钢铁侠'],\n                clickItem:99,\n            }\n        })\n</script>\n</body>\n</html>\n\n```\n\n## 3.3 v-bind动态绑定样式\n\n- 样式的对象用法\n\n```html\n<div>\n    <h2 :style=\"{fontSize:'50px',color:finalColor}\">\n        {{message}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        data:{\n            message:'abc',\n        \tfinalColor:'red'\n        }\n    })\n</script>\n```\n\n> 注意：{fontSize:50px}为错误表达，50px会被解析为一个变量，50px必须加单引号\n\n- 样式的数组用法\n\n```html\n<div>\n    <h2 :style=\"[style1,style2]\">\n        {{message}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            message:'abc',\n        \tstyle1:{fontSize:'100px'},\n            style2:{color:'red'}\n        }\n    })\n</script>\n```\n\n# 4：计算属性\n\n## 4.1 计算属性的基本用法\n\n```html\n<div id=\"app\">\n    <h2>\n        {{firstName+\" \"+lastName}}\n    </h2>\n    <h2>\n        {{getFullName()}}\n    </h2>\n    <h2>\n        {{fullName}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n        \tfirstName:'Lebron',\n            lastName:'James'\n        },\n        computed:{\n            fullName:function(){\n                return this.fistName+' '+this.lastName;\n            }\n        },//计算属性\n        methods:{\n        \tgetFullName(){\n                return this.fistName+' '+this.lastName;\n            }\n    \t}\n    })\n</script>\n```\n\n**computed:计算属性的使用**\n\n## 4.2 计算属性的复杂使用\n\n```html\n<div id=\"app\">\n    <h2>\n        总价格：{{totalPrice}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            books:{\n                {id:110,name:'Unix编程',price:119},\n            \t{id:111,name:'代码大全',price:89},\n        \t\t{id:112,name:'现代操作系统',price:81}\n            }\n        },\n        computed:{\n            totalPrice:function(){\n                for(let i=0;i<this.books.length;i++){\n                    result += this.books[i].price;\n                }\n                /*\n                for(let i in this.books){\n                    result += this.books[i].price;\n                }\n                for(let book of this.books){\n                    result += book.price;\n                }\n                */\n                return result;\n                \n                \n            }\n        },//计算属性\n    })\n</script>\n```\n\n## 4.3 计算属性setter和getter\n\n```html\n<div id=\"app\">\n    <h2>\n        {{fullName}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            firstName:'Kobe',\n            lastName:'Bryant'\n        },\n        computed:{\n            /*\n            fullName:{//fullName为一个对象\n                //一般属性没有set方法，为只读属性\n                set:function(){},//通过控制板，app.fullName='ABC'会调用此方法\n                get:function(){\n                    return this.firstName+' '+this.lastName;\n                }\n            }\n            */\n            //上述方法简写为\n            fullName:function(){\n        \t\treturn this.firstName+' '+this.lastName; \n    \t\t}\n        },//计算属性\n    })\n</script>\n```\n\n## 4.4 计算属性和methods对比\n\n方法每次调用，程序都会重复执行；计算属性第一次计算出来，结果就保存在内存中。下次再调用，程序不会重复执行。\n\n> 需要多次调用的计算结果，采用计算属性性能会更低。\n\n## 4.5 跑马灯项目\n\n一句文字实现，点击按钮，文字滚动播放，再点击文字停止滚动。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n</head>\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <button @click=\"lang\">浪起来</button>\n    <button @click=\"di\">低调</button>\n    <h4>{{msg}}</h4>\n</div>\n<script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data: {\n                msg:'猥琐发育。别浪~~！',\n                intervalId:null\n            },\n            methods:{\n                lang(){\n                    //函数里的this.变量无法指向函数外部的变量\n                    /*\n                    setInterval(function(){\n                        let start = this.msg.substring(0,1);//获取第一个字符\n                        let end = this.msg.substring(1);//获取第一个字符后的所有字符\n                        this.msg=end+start;//将第一个字符放到最后，实现跑马灯效果\n                    },400)\n                     */\n                   //使用箭头函数解决函数内部this问题\n                    if(this.intervalId!=null) return;\n                    this.intervalId = setInterval(()=> {\n                        let start = this.msg.substring(0,1);//获取第一个字符\n                        let end = this.msg.substring(1);//获取第一个字符后的所有字符\n                        this.msg=end+start;//将第一个字符放到最后，实现跑马灯效果\n                    },400)\n\n                },\n                di(){\n                    clearInterval(this.intervalId);\n                    this.intervalId=null;//清楚定时器后需要重新把internalId设为null\n                }\n            }\n        })\n</script>\n</body>\n</html>\n\n```\n\n\n\n# 5: 常用指令\n\n## 5.1 v-for的四种使用方式\n\n- 循环数组\n\n```html\n<div id=\"app\">\n    <p v-for=\"item in list\">\n        {{item}}\n    </p>\n    <p v-for=\"(item,index) in list\">\n        {{item+\"-----\"+index}}\n    </p>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            list:[1,2,3,4,5]\n        },\n        \n    })\n</script>\n```\n\n- 循环对象数组\n\n```html\n<div id=\"app\">\n    <p v-for=\"item in list\">\n        {{item.id}}--{{item.name}}\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            list:[\n                {id: 1, name :'zs1'},\n                {id: 2, name :'zs2'},\n                {id: 3, name :'zs3'},\n                {id: 4, name :'zs4'},\n            ]\n        },\n        \n    })\n</script>\n```\n\n- 循环对象\n\n```html\n<div id=\"app\">\n    <p v-for=\"(val,key,index) in user\">\n        {{val}}--{{key}}--{{index}}\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            user:{\n                id:1,\n                name:'tuoni',\n                gender:'nan'\n            }\n        },\n        \n    })\n</script>\n```\n\n- 迭代数字\n\n```html\n<div id=\"app\">\n    <!--in后面可以使数组，对象数组，对象，还可以使数字。若为数字，count从1开始-->\n    <p v-for=\"count in 10\">\n        第{{count}}次循环\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{},   \n    })\n</script>\n```\n\n**注意：count从1开始计数**\n\n- v-for循环中key属性的使用\n\n```html\n<div id=\"app\">\n    <div>\n        <label>Id:\n        \t<input type=\"text\" v-model=\"id\">\n        </label>\n        <label>Name:\n        \t<input type=\"text\" v-model=\"name\">\n        </label>\n        <button @click=\"add\">添加</button>\n    </div>\n    <p v-for=\"item in list\" :key=\"item.id\">\n        <input type = \"checkbox\" >\n       {{item.id}}--{{item.name}}\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            id:'',\n            name:'',\n            list:[\n                {id:1,name:'lisi'},\n                {id:2,name:'yinzheng'},\n                {id:3,name:'zhaogao'},\n                {id:4,name:'hanfei'},\n                {id:5,name:'kongzi'},\n            ]\n        },\n        methods:{\n            add(){\n                this.list.push({id:this.id,name:this.name});\n                //this.list.unshift({id:this.id,name:this.name});\n            }\n        }\n    })\n</script>\n```\n\n## 5.2 v-on指令\n\n```html\n<body>\n    <script src=\"./js/vue.js\"></script>\n    <div id=\"app\">\n        <button v-on:click=\"show\">按钮</button>\n    </div>\n    <script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            },\n            methods:{\n                show(){\n                    alert('Hello');\n                }\n            }\n        })\n        \n        //原始js\n        //1.拿buttom元素\n        //2.添加监听时间\n    </script>\n</body>\n```\n\n- 事件修饰符\n  - .stop 阻止冒泡//@click.stop设置再内部DOM。不会触发@click.stop外部DOM的点击事件\n  - .prevent 阻止默认行为//@click.prevent。比如阻止a标签跳转到href地址\n  - .capture 添加事件倾听器实现捕获模式//给外层DOM 添加@click.capture，会先处理外部点击事件。\n  - .self 只当自身被点击才触发事件//给外部DOM添加@click.self，只有点击外部DOM时才能触发它。也可阻止冒泡\n  - .once 只触发一次事件处理函数。\n\n事件修饰符可以叠加使用 @click.prevent.once先后顺序无区别。\n\n## 5.3 v-model\n\n可以实现表单元素的model中的数据双向绑定。**v-model只能用在表单元素中**，input(redio, text, address, email...),select , checkbox, textarea\n\n```html\n<input type=\"text\" v-model=\"msg\">\n```\n\n- 简易计算器案例\n\n```html\n<div id=\"app\">\n    <input type=\"text\" v-model=\"n1\">\n    <select v-model=\"opt\">\n        <option value=\"+\">+</option>\n        <option value=\"-\">-</option>\n        <option value=\"*\">*</option>\n        <option value=\"/\">/</option>\n    </select>\n    <input type=\"text\" v-model=\"n2\">\n    <button @click=\"calculate\">=</button>\n    <input type=\"text\" v-model=\"result\">\n</div>\n<script>\n\tconst vm = new Vue({\n        el:'#app',\n        data:{\n            n1:0,\n            n2:0,\n            result:0,\n            opt:'+'\n        }\n        methods:{\n        calculate(){\n        switch(this.opt){\n            case '+':\n                this.result = parseInt(this.n1) + parseInt(this.n2);\n                break;\n            case '-':\n                this.result = parseInt(this.n1) - parseInt(this.n2);\n                break;\n        \tcase '*':\n                this.result = parseInt(this.n1) * parseInt(this.n2);\n                break;\n            case '/':\n                this.result = parseInt(this.n1) / parseInt(this.n2);\n                break;\n         //this.result = eval(this.n1+this.opt+this.n2)\n         //eval会解析字符串并执行\n        }\n    }\n    }\n    })\n</script>\n```\n\n## 5.4 v-if和v-show的使用\n\n```html\n<body>\n    <script src=\"./js/vue.js\"></script>\n    <div id=\"app\">\n        <button @click=\"flag=!flag\">\n            切换\n        </button>\n        <h3 v-if=\"flag\">\n            这是v-if控制的元素\n        </h3>\n        <h3 v-show=\"flag\">\n            这是v-show控制的元素\n        </h3>\n    </div>\n    <script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                flag:true\n            },\n            methods:{\n                \n            }\n        })\n        \n        //原始js\n        //1.拿buttom元素\n        //2.添加监听时间\n    </script>\n</body>\n```\n\n- v-if:会删除或创建元素  //v-if消耗切换性能，如果元素设计频繁的切换不要使用。\n\n- v-show：不会删除DOM，而是修改其可见属性dispaly:none //如果元素可能永远也不会显示出来，最好使用v-if\n\n# 6：过滤器\n\n**概念**：Vue.js中允许自定义过滤器，可以用作一些常见的文本格式化。过滤器可以用在两个地方：mustache插值和v-bind\n\n```html\n<!--过滤器调用格式     {{name | nameope}}-->\n<script>\n    //过滤器定义语法\n    //过滤器中的function，第一个参数，永远是过滤器管道符（|）前面传过来的参数\n\tVue.filter('过滤器名称',function(data){})\n</script>\n```\n\n**注意:当全局和私有过滤器，使用相同名称时，优先调用私有过滤器**\n\n## 6.1 定义全局过滤器\n\n全局过滤器，就是所有的vm实例都能用\n\n过滤器的**基本使用**\n\n```html\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <p>\n        {{ msg | msgFormat('牛逼') | test}}\n    </p>\n</div>\n<script>\n    //定义一个Vue全局过滤器\n    Vue.filter('msgFormat',function(msg, arg){//arg是msgFormat输入的参数。第一个为参数msg为默认的插值\n        return msg.replace(/傻子/g,arg)//正则替换，g表示全部替换\n    })\n    \n    //定义多个过滤器\n    Vue.filter('test',function(msg){\n        return msg+\"这是第二个过滤器\"\n    })\n    //语法糖：简写\n    const app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{\n\n        }\n    })\n\n</script>\n</body>\n```\n\n## 6.2 定义私有过滤器\n\n```html\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <p>\n        {{ msg | msgFormat('牛逼') | test}}\n    </p>\n</div>\n<script>\n    //语法糖：简写\n    const app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{},\n        filters:{\n            msgFormat:function(msg, arg){\n                return msg.replace(/傻子/g,arg)//正则替换，g表示全部替换\n            }\n        }\n    })\n\n</script>\n</body>\n```\n\n# 7：自定义\n\n## 7.1 自定义按键修饰符\n\n```html\n<label>Name：\n<input type=\"text\" v-model=\"name\" @keyup.enter=\"add\">\n</label>\n```\n\n**@keyup**:绑定键盘\n\n1. 内置修饰符.enter .tab .delete .esc .space .up .down .left .right\n\n2. 其他的键可使用js定义的键盘码。比如**@keyup.113**表示F12 。\n\n```html\n<label>Name：\n<input type=\"text\" v-model=\"name\" @keyup.f12=\"add\">\n</label>\n\n<script>\n\t//自定义全局按键修饰符\n    Vue.config.keyCode.f12 = 113\n</script>\n```\n\n## 7.2 自定义指令\n\n1. 定义全局指令\n\n比如自定一个指令v-focus\n\n```html\n<script>\n    //使用Vue.directive()定义全局的指令\n    //其中：参数1：指令的名称，定义的时候，不要加v-前缀。但在调用的时候必须在指令名称前加v-前缀\n    //参数2是一个对象，对象身上有一些指令相关的函数，这些函数可以在特定的阶段执行相关操作\n\tVue.directive('focus',{\n        bind:function(el){\n            //每当指令被绑定到元素上时，会执行这个函数。只执行一次\n            //第一个参数永远时el，表示被绑定了指令的那个元素，el是一个原生的JS对象。\n            //在元素刚绑定了指令的时候，还没有插入到DOM中去，这时调用focus方法没有作用。\n            //el.focus\n            \n        },\n        inserted:function(el){\n           //inserted表示元素插入到dom中时执行，只执行一次\n            el.focus\n        },\n        updated:function(){},//当vNode更新的时候，会执行。可能多次触发\n    })\n</script>\n```\n\n**.focus**：JS方法，可以将焦点集中到DOM对象上，类似于，鼠标单击一次输入框。\n\n使用钩子函数参数\n\n- el：指令绑定的元素，用来直接操作DOM\n- binding：一个对象，包含以下属性：\n  - name:指令名称——color\n  - value:指令的绑定值。会计算比如v-color=\"1+1\"，binding.value=2\n  - expression:指令绑定值，不会计算, binding.expression='1+1'\n\n```html\n<div v-color=\"'red'\">\n    \n</div>\n<script>\n\tVue.directive('color',{\n        bind:function(el,binding){\n            el.style.color = binding.value\n        }\n    })\n</script>\n```\n\n2. 定义私有指令\n\n```html\n<script>\n\t const app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{},\n        filters:{},\n        directives:{\n            'color':{\n                bind:function(el,binding){\n                     el.style.color = binding.value\n                }\n            }\n        }\n    })\n\n</script>\n```\n\n**简写：**\n\n大多数情况下，旨在`bind`和`update`钩子上做重复动作，可以简写\n\n```html\n<script>\n    directives:{\n                'color':function(el,binding){//等同于把方法同时写到bind和update中\n                         el.style.color = binding.value\n                    }\n            }\n</script>\n```\n\n# 8：vue-resource实现get，post，jsonp请求\n\nvue-resource依赖于vue，需要在vue.js后导入vue-resource.js包。\n\n```html\n<body>\n    <script src=\"./js/vue.js\"></script>\n    <script src=\"./js/vue-resource.js\"></script>\n    \n    <div>\n        <button @click=\"getInfo\">\n            getInfo\n        </button>\n        <button @click=\"postInfo\">\n            getInfo\n        </button>\n        <button @click=\"jsonpInfo\">\n            getInfo\n        </button>\n    </div>  \n    \n    <script>\n    \tconst app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{\n            getInfo(){      this.$http.get('http://vue.studyit.io/api/getlunbo').then(function(result){\n                    //result是返回的结果，包括头部、数据等\n                    console.log(result.body)\n                }),\n             postInfo(){\n                 //手动发起的post请求没有表单数据\n                 //通过post方法的第三个参数，设置提交内容类型为普通表单格式。\n                 this.$http.post('http://vue.studyit.io/api/post',{},{emulateJSON:true}).then(result=>{\n                     console.log(result.body)\n                 }),\n              jsonpInfo(){\n                     this.$http.jsonp('http://vue.studyit.io/api/jsonp').then(result=>{\n                         console.log(result.body)\n                     })\n                 }\n             }     \n            }\n        }\n        })\n    </script>\n</body>\n```\n\n","source":"_posts/Vue、Vuejs学习记录.md","raw":"---\ntitle: Vue、Vuejs学习记录\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-02-15 17:31:51\npassword:\nsummary: Vue.js（/vjuː/，或简称为Vue）是一个用于创建用户界面的开源JavaScript框架，也是一个创建单页应用的Web应用框架。 2016年一项针对JavaScript的调查表明，Vue有着89%的开发者满意度。在GitHub上，该项目平均每天能收获95颗星，为Github有史以来星标数第3多的项目。\ntags: Vuejs\ncategories: 学习笔记\n---\n\n# 0：ES6补充\n\n## 0.1 块级作用域\n\n```html\n<script>\n\t//变量作用域：变量在什么范围内可用\n    {\n        var name = 'why';\n        console.log(name);\n    }\n    console.log(name);//在大括号外也能打开。\n    \n    //没有块级作用域会导致什么问题\n    var btns = document.getElementsByTagName('button');\n    for(var i = 0; i<btns.length;i++){\n        btns[i].addEventListener('click',function(){\n            console.log('第'+i+'个按钮被点击')\n        })\n    }\n    //显示的按钮被点击不准确。使用闭包解决此问题    \n    for(var i = 0; i<btns.length;i++){\n        (function(num){\n            btns[num].addEventListener('click',function(){\n            console.log('第'+num+'个按钮被点击')\n        \t})\n        })(i)\n        \n    }\n</script>\n```\n\n\n\n# 1：Vue初体验\n\n## 1.1 认识Vuejs\n\n作为时下流行的前端框架，Vuejs是很多中小型企业开发项目的首选框架。\n\n- Vue是一个渐进式的框架。\n  - 渐进式意味着可以将Vue作为应用的一部分嵌入进去，带来更丰富的交互体验。\n\n- Vue特点和Web开发中的高级功能\n  - 解耦视图和数据\n  - 可复用的组件\n  - 前端路由\n  - 状态管理\n  - 虚拟DOM\n\n- 学习前提\n  - 不需要Angular、React、jQuery\n  - 需要HTML、CSS、JavaScript基础\n\n## 1.2 Vue.js安装\n\n方式一：直接CDN引入\n\n方式二：下载和引入\n\n- 安装教程 https://cn.vuejs.org\n\n- 开发环境 https://vuejs.org/js/vue.js\n- 生产环境 https://vuejs.org/js/vue.min.js\n\n方式三：NPM安装\n\n- 通过webpack和CLI\n\n## 1.3 Hello Vuejs\n\nVue的响应式\n\n```html\n<body>\n\n    <div id=\"app\">\n        <h1>\n            {{name}}\n        </h1>\n        {{message}}\n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n    \t//let(变量)/const(常量)\n        //编程范式：声明式编程\n        const app = new Vue({\n            el:'#app',//用于挂在要管理的元素\n            data:{//定义数据\n                message:'你好啊！',//在div中显示message内容\n                name:'coderwhy'\n            }\n        })        \n\n        //原始js的做法（编程范式：命令式编程）\n        //1.创建div元素，设置id属性\n        //2.定义一个变量叫message\n        //3.将message变量放在div元素中显示\n        //4.修改messge的数据\n        //5.将修改后的数据替换到div元素\n    </script>   \n</body>\n```\n\n## 1.4 Vue列表显示\n\n```html\n<body>\n    <div id=\"app\">\n        <ul>\n            <li v-for=\"item in movies\">{{item}}</li>\n        </ul>\n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                message:'你好啊'，\n                movies:['海王','大话西游','星际穿越','少年派']\n            }\n        })\n    </script>\n</body>\n```\n\n`app.movies.push('盗梦空间')//添加数据`\n\n- 使用v-for指令遍历数组元素\n\n**案例展示：计数器**\n\n<script src=\"/js/vue.min.js\"></script>\n<div id=\"app\">\n    当前计数：0</br>\n        <button v-on:click=\"counter++\">+</button>\n        <button v-on:click=\"counter--\">-</button>\n</div>\n<script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            }\n        })\n</script>\n\n```html\n<body>\n    <script src=\"../js/vue.js\"></script>\n    <div id=\"app\">\n        <h2>\n            当前计数：{{counter}}\n        </h2>\n        <!--<button v-on:click=\"counter++\">+</button>-->\n        <!--<button v-on:click=\"counter--\">-</button>-->\n        <button v-on:click=\"add\">+</button>\n        <button @click=\"min\">-</button>\n    </div>\n    <script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            },\n            methods:{\n                add:function(){\n                    console.log('add被执行')；\n                    this.counter++;\n                },\n                min:function(){\n            \t\tconsole.log('min被执行')；\n\t\t\t\t\tthis.counter--;\n        \t\t}\n            }\n        })\n        \n        //原始js\n        //1.拿buttom元素\n        //2.添加监听时间\n    </script>\n</body>\n```\n\n- 新属性：methods，该属性用于Vue对象中定义方法。\n\n- 新指令：@click，该指令用于监听某个元素的点击事件。\n\n## 1.5 Vue中的MVVM\n\n什么是MVVM？\n\n- Model View ViewModel\n\n## 1.6 创建Vue实例传入的options\n\n目前掌握的选项\n\n- el：\n  - 字符型String|HTMLElement\n  - 决定Vue管理哪一个DOM\n\n- data：\n  - Object|Funtion()**（组件当中必须是一个函数）**\n  - Vue实例对应的数据对象。\n\n- methods：\n  - {[key:string] Function}\n  - 定义属于Vue的一些方法，可以在其他地方调用，也可以在指令中使用\n\n## 1.7 Vue的生命周期\n\n生命周期：事物从诞生到消亡的整个过程\n\n```html\n<script>\n\tnew Vue({\n        el:'#app',\n        data:obj,\n        methods:{},\n        created:function(){},\n        mounted:function(){}\n    })\n</script>\n```\n\n## 1.8 Vue的生命周期函数\n\n```html\n<script>\n\tnew Vue({\n        el:'#app',\n        data:obj,\n        methods:{},\n        beforeCreate:function(){},//Hook:钩子函数\n        created:function(){},\n        mounted:function(){}\n    })\n</script>\n```\n\n**生命周期函数：**`beforeCreate,create,beforeMounte,mounted,beforeUpdate,updated,beforDestroy,destroyed`\n\n# 2：插值的操作\n\n## 2.1 Mustache语法，插值的操作\n\nMustache语法：双大括号//mustache胡须\n\n```html\n<div>\n    <h2>\n        {{message}}\n    </h2>\n    <h2>\n        {{firstName+' '+lastName}}\n    </h2>\n     <h2>\n        {{firstName}} {{lastName}}\n    </h2>\n    <h2>{{counter*2}}</h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            message:'nihao',\n            firstName:'kobe',\n            lastName:'bryant',\n            counter:100\n        },\n        \n    })\n</script>\n```\n\nmustache语法不仅可以直接写变量，还可以写语法。\n\n## 2.2 插值操作--其他指令使用\n\n- **v-once**: 不想改变DOM值，使DOM变成非响应式。\n\n```html\n<h2 v-once>\n    {{message}}<!--message不会随数据更新而改变-->\n</h2>\n```\n\n- **v-html**:直接展示html代码，而不是展示其字符串\n\n```html\n<div>\n    <h2 v-html=\"url\"></h2>\n</div>\n<script>\n    new Vue({\n            el:'#app',\n            data:{\n                url='<a href=\"https://www.baidu.com\">百度一下</a>'\n            }\n        })\n</script>\n```\n\n输出结果：[百度一下](https://www.baidu.com)\n\n- **v-text**：和{{message}}作用相同，但会覆盖`<h2>`代码块中的字符会被覆盖掉，不灵活。\n\n```html\n<body>\n\n    <div id=\"app\">\n        <h2 v-text=\"message\"></h2>\n        <h2>{{message}}</h2>\n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n        const app = new Vue({\n            el:'#app',//用于挂在要管理的元素\n            data:{//定义数据\n                message:'你好啊！'\n            }\n        })        \n    </script>   \n</body>\n```\n\n- **v-pre**：将例如大括号显示出来，不渲染数据\n\n```html\n<h2 v-pre>\n    {{message}}\n</h2>\n```\n\n输出结果：{{message}}\n\n- **v-cloak**：当js延迟加载出来时，不显示dom渲染之前的值。{{message}}不会在渲染之前出现//cloak斗篷\n\n```html\n<!--<head>\n    <style>\n        [v-cloak]{\n            display:none;\n        }\n    </style>\n</head>-->\n<div id=\"app\" v-cloak>\n    {{message}}\n</div>\n<script>\n    ...\n</script>\n```\n\n# 3：动态绑定属性\n\n## 3.1 v-bind，动态绑定DOM属性\n\n- v-bind的基本使用\n\n```html\n<body>\n\n    <div id=\"app\">\n        <img v-bind:src=\"imgURL\" alt=\"\">\n        <a v-bind:href=\"aHref\"></a> \n        \n        <!--语法糖的写法-->\n        <img :src=\"imgURL\" alt=\"\">\n        <a :href=\"aHref\"></a> \n    </div>\n    <script src=\"../js/vue.js\"></script>\n    <script>\n        const app = new Vue({\n            el:'#app',//用于挂在要管理的元素\n            data:{\n                aHref=\"https://www.baidu.com\",\n\t\t\t\timgURL:'https://i0.hdslb.com/bfs/sycp/creative_img/202002/1e9bfa663a93374c8e10c3933cfc78f8.jpg'\n            }\n        })        \n    </script>   \n</body>\n```\n\n- v-bind简写/语法糖：`:`\n- v-bind对象用法：\n\n```html\n<div>\n    <h2 class=\"title\" :class=\"{class1:isClass1,class2:isClass2}\">{{message}}</h2>\n</div>\n<script>\n    new Vue({\n        data:{\n            message:\"showClassExample\"\n            isClass1:true,\n            isClass2:false\n        }\n    })\n</script>\n```\n\n**//title类固定，动态更改class1和class2**\n\n`{类名:布尔值,类名：布尔值}`\n\n- v-bind数组语法\n\n```html\n<div>\n    <h2 class=\"title\" :class=\"getClasses()\">{{message}}</h2>\n</div>\n<script>\n    new Vue({\n        data:{\n            message:\"showClassExample\",\n            isClass1:true,\n            isClass2:false\n        }\n        methods:{\n        \tgetClasses:function(){\n        \t\treturn{class1:this.isClass1,class2:this.isClass2}\n    \t\t}\n    \t}\n    })\n</script>\n```\n\n**注意：v-on中函数省略了()，但v-bind需要添加()**\n\n```html\n<div>\n    <h2 class=\"title\" :class=\"[class1,class2]\">{{message}}</h2>\n</div>\n<script>\n    new Vue({\n        data:{\n            message:\"showClassExample\",\n            class1:'class1',\n            class2:'class2'\n        }\n    })\n</script>\n```\n\n## 3.2 作业，结合v-for和v-bind\n\n作业：使用v-for显示一个电影名称列表，设置监听点击事件，当某个电影被点击，改变此电影名称字体颜色为红色。\n\n答案：\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <style>\n        .red{color:red}\n    </style>\n</head>\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <ul>\n        <li v-for=\"(m, index) in movies\" @click=\"clickItem=index\" :class=\"{red:clickItem==index}\">{{m}}</li>\n    </ul>\n</div>\n<script>\n    \tconst app = new Vue({\n            el:'#app',\n            data: {\n                movies: ['复仇者联盟', '生化危机', '星际大战', '钢铁侠'],\n                clickItem:99,\n            }\n        })\n</script>\n</body>\n</html>\n\n```\n\n## 3.3 v-bind动态绑定样式\n\n- 样式的对象用法\n\n```html\n<div>\n    <h2 :style=\"{fontSize:'50px',color:finalColor}\">\n        {{message}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        data:{\n            message:'abc',\n        \tfinalColor:'red'\n        }\n    })\n</script>\n```\n\n> 注意：{fontSize:50px}为错误表达，50px会被解析为一个变量，50px必须加单引号\n\n- 样式的数组用法\n\n```html\n<div>\n    <h2 :style=\"[style1,style2]\">\n        {{message}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            message:'abc',\n        \tstyle1:{fontSize:'100px'},\n            style2:{color:'red'}\n        }\n    })\n</script>\n```\n\n# 4：计算属性\n\n## 4.1 计算属性的基本用法\n\n```html\n<div id=\"app\">\n    <h2>\n        {{firstName+\" \"+lastName}}\n    </h2>\n    <h2>\n        {{getFullName()}}\n    </h2>\n    <h2>\n        {{fullName}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n        \tfirstName:'Lebron',\n            lastName:'James'\n        },\n        computed:{\n            fullName:function(){\n                return this.fistName+' '+this.lastName;\n            }\n        },//计算属性\n        methods:{\n        \tgetFullName(){\n                return this.fistName+' '+this.lastName;\n            }\n    \t}\n    })\n</script>\n```\n\n**computed:计算属性的使用**\n\n## 4.2 计算属性的复杂使用\n\n```html\n<div id=\"app\">\n    <h2>\n        总价格：{{totalPrice}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            books:{\n                {id:110,name:'Unix编程',price:119},\n            \t{id:111,name:'代码大全',price:89},\n        \t\t{id:112,name:'现代操作系统',price:81}\n            }\n        },\n        computed:{\n            totalPrice:function(){\n                for(let i=0;i<this.books.length;i++){\n                    result += this.books[i].price;\n                }\n                /*\n                for(let i in this.books){\n                    result += this.books[i].price;\n                }\n                for(let book of this.books){\n                    result += book.price;\n                }\n                */\n                return result;\n                \n                \n            }\n        },//计算属性\n    })\n</script>\n```\n\n## 4.3 计算属性setter和getter\n\n```html\n<div id=\"app\">\n    <h2>\n        {{fullName}}\n    </h2>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            firstName:'Kobe',\n            lastName:'Bryant'\n        },\n        computed:{\n            /*\n            fullName:{//fullName为一个对象\n                //一般属性没有set方法，为只读属性\n                set:function(){},//通过控制板，app.fullName='ABC'会调用此方法\n                get:function(){\n                    return this.firstName+' '+this.lastName;\n                }\n            }\n            */\n            //上述方法简写为\n            fullName:function(){\n        \t\treturn this.firstName+' '+this.lastName; \n    \t\t}\n        },//计算属性\n    })\n</script>\n```\n\n## 4.4 计算属性和methods对比\n\n方法每次调用，程序都会重复执行；计算属性第一次计算出来，结果就保存在内存中。下次再调用，程序不会重复执行。\n\n> 需要多次调用的计算结果，采用计算属性性能会更低。\n\n## 4.5 跑马灯项目\n\n一句文字实现，点击按钮，文字滚动播放，再点击文字停止滚动。\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n</head>\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <button @click=\"lang\">浪起来</button>\n    <button @click=\"di\">低调</button>\n    <h4>{{msg}}</h4>\n</div>\n<script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data: {\n                msg:'猥琐发育。别浪~~！',\n                intervalId:null\n            },\n            methods:{\n                lang(){\n                    //函数里的this.变量无法指向函数外部的变量\n                    /*\n                    setInterval(function(){\n                        let start = this.msg.substring(0,1);//获取第一个字符\n                        let end = this.msg.substring(1);//获取第一个字符后的所有字符\n                        this.msg=end+start;//将第一个字符放到最后，实现跑马灯效果\n                    },400)\n                     */\n                   //使用箭头函数解决函数内部this问题\n                    if(this.intervalId!=null) return;\n                    this.intervalId = setInterval(()=> {\n                        let start = this.msg.substring(0,1);//获取第一个字符\n                        let end = this.msg.substring(1);//获取第一个字符后的所有字符\n                        this.msg=end+start;//将第一个字符放到最后，实现跑马灯效果\n                    },400)\n\n                },\n                di(){\n                    clearInterval(this.intervalId);\n                    this.intervalId=null;//清楚定时器后需要重新把internalId设为null\n                }\n            }\n        })\n</script>\n</body>\n</html>\n\n```\n\n\n\n# 5: 常用指令\n\n## 5.1 v-for的四种使用方式\n\n- 循环数组\n\n```html\n<div id=\"app\">\n    <p v-for=\"item in list\">\n        {{item}}\n    </p>\n    <p v-for=\"(item,index) in list\">\n        {{item+\"-----\"+index}}\n    </p>\n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            list:[1,2,3,4,5]\n        },\n        \n    })\n</script>\n```\n\n- 循环对象数组\n\n```html\n<div id=\"app\">\n    <p v-for=\"item in list\">\n        {{item.id}}--{{item.name}}\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            list:[\n                {id: 1, name :'zs1'},\n                {id: 2, name :'zs2'},\n                {id: 3, name :'zs3'},\n                {id: 4, name :'zs4'},\n            ]\n        },\n        \n    })\n</script>\n```\n\n- 循环对象\n\n```html\n<div id=\"app\">\n    <p v-for=\"(val,key,index) in user\">\n        {{val}}--{{key}}--{{index}}\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            user:{\n                id:1,\n                name:'tuoni',\n                gender:'nan'\n            }\n        },\n        \n    })\n</script>\n```\n\n- 迭代数字\n\n```html\n<div id=\"app\">\n    <!--in后面可以使数组，对象数组，对象，还可以使数字。若为数字，count从1开始-->\n    <p v-for=\"count in 10\">\n        第{{count}}次循环\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{},   \n    })\n</script>\n```\n\n**注意：count从1开始计数**\n\n- v-for循环中key属性的使用\n\n```html\n<div id=\"app\">\n    <div>\n        <label>Id:\n        \t<input type=\"text\" v-model=\"id\">\n        </label>\n        <label>Name:\n        \t<input type=\"text\" v-model=\"name\">\n        </label>\n        <button @click=\"add\">添加</button>\n    </div>\n    <p v-for=\"item in list\" :key=\"item.id\">\n        <input type = \"checkbox\" >\n       {{item.id}}--{{item.name}}\n    </p>\n   \n</div>\n<script>\n\tnew Vue({\n        el:'#app',\n        data:{\n            id:'',\n            name:'',\n            list:[\n                {id:1,name:'lisi'},\n                {id:2,name:'yinzheng'},\n                {id:3,name:'zhaogao'},\n                {id:4,name:'hanfei'},\n                {id:5,name:'kongzi'},\n            ]\n        },\n        methods:{\n            add(){\n                this.list.push({id:this.id,name:this.name});\n                //this.list.unshift({id:this.id,name:this.name});\n            }\n        }\n    })\n</script>\n```\n\n## 5.2 v-on指令\n\n```html\n<body>\n    <script src=\"./js/vue.js\"></script>\n    <div id=\"app\">\n        <button v-on:click=\"show\">按钮</button>\n    </div>\n    <script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            },\n            methods:{\n                show(){\n                    alert('Hello');\n                }\n            }\n        })\n        \n        //原始js\n        //1.拿buttom元素\n        //2.添加监听时间\n    </script>\n</body>\n```\n\n- 事件修饰符\n  - .stop 阻止冒泡//@click.stop设置再内部DOM。不会触发@click.stop外部DOM的点击事件\n  - .prevent 阻止默认行为//@click.prevent。比如阻止a标签跳转到href地址\n  - .capture 添加事件倾听器实现捕获模式//给外层DOM 添加@click.capture，会先处理外部点击事件。\n  - .self 只当自身被点击才触发事件//给外部DOM添加@click.self，只有点击外部DOM时才能触发它。也可阻止冒泡\n  - .once 只触发一次事件处理函数。\n\n事件修饰符可以叠加使用 @click.prevent.once先后顺序无区别。\n\n## 5.3 v-model\n\n可以实现表单元素的model中的数据双向绑定。**v-model只能用在表单元素中**，input(redio, text, address, email...),select , checkbox, textarea\n\n```html\n<input type=\"text\" v-model=\"msg\">\n```\n\n- 简易计算器案例\n\n```html\n<div id=\"app\">\n    <input type=\"text\" v-model=\"n1\">\n    <select v-model=\"opt\">\n        <option value=\"+\">+</option>\n        <option value=\"-\">-</option>\n        <option value=\"*\">*</option>\n        <option value=\"/\">/</option>\n    </select>\n    <input type=\"text\" v-model=\"n2\">\n    <button @click=\"calculate\">=</button>\n    <input type=\"text\" v-model=\"result\">\n</div>\n<script>\n\tconst vm = new Vue({\n        el:'#app',\n        data:{\n            n1:0,\n            n2:0,\n            result:0,\n            opt:'+'\n        }\n        methods:{\n        calculate(){\n        switch(this.opt){\n            case '+':\n                this.result = parseInt(this.n1) + parseInt(this.n2);\n                break;\n            case '-':\n                this.result = parseInt(this.n1) - parseInt(this.n2);\n                break;\n        \tcase '*':\n                this.result = parseInt(this.n1) * parseInt(this.n2);\n                break;\n            case '/':\n                this.result = parseInt(this.n1) / parseInt(this.n2);\n                break;\n         //this.result = eval(this.n1+this.opt+this.n2)\n         //eval会解析字符串并执行\n        }\n    }\n    }\n    })\n</script>\n```\n\n## 5.4 v-if和v-show的使用\n\n```html\n<body>\n    <script src=\"./js/vue.js\"></script>\n    <div id=\"app\">\n        <button @click=\"flag=!flag\">\n            切换\n        </button>\n        <h3 v-if=\"flag\">\n            这是v-if控制的元素\n        </h3>\n        <h3 v-show=\"flag\">\n            这是v-show控制的元素\n        </h3>\n    </div>\n    <script>\n        //语法糖：简写\n    \tconst app = new Vue({\n            el:'#app',\n            data:{\n                flag:true\n            },\n            methods:{\n                \n            }\n        })\n        \n        //原始js\n        //1.拿buttom元素\n        //2.添加监听时间\n    </script>\n</body>\n```\n\n- v-if:会删除或创建元素  //v-if消耗切换性能，如果元素设计频繁的切换不要使用。\n\n- v-show：不会删除DOM，而是修改其可见属性dispaly:none //如果元素可能永远也不会显示出来，最好使用v-if\n\n# 6：过滤器\n\n**概念**：Vue.js中允许自定义过滤器，可以用作一些常见的文本格式化。过滤器可以用在两个地方：mustache插值和v-bind\n\n```html\n<!--过滤器调用格式     {{name | nameope}}-->\n<script>\n    //过滤器定义语法\n    //过滤器中的function，第一个参数，永远是过滤器管道符（|）前面传过来的参数\n\tVue.filter('过滤器名称',function(data){})\n</script>\n```\n\n**注意:当全局和私有过滤器，使用相同名称时，优先调用私有过滤器**\n\n## 6.1 定义全局过滤器\n\n全局过滤器，就是所有的vm实例都能用\n\n过滤器的**基本使用**\n\n```html\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <p>\n        {{ msg | msgFormat('牛逼') | test}}\n    </p>\n</div>\n<script>\n    //定义一个Vue全局过滤器\n    Vue.filter('msgFormat',function(msg, arg){//arg是msgFormat输入的参数。第一个为参数msg为默认的插值\n        return msg.replace(/傻子/g,arg)//正则替换，g表示全部替换\n    })\n    \n    //定义多个过滤器\n    Vue.filter('test',function(msg){\n        return msg+\"这是第二个过滤器\"\n    })\n    //语法糖：简写\n    const app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{\n\n        }\n    })\n\n</script>\n</body>\n```\n\n## 6.2 定义私有过滤器\n\n```html\n<body>\n<script src=\"./js/vue.js\"></script>\n<div id=\"app\">\n    <p>\n        {{ msg | msgFormat('牛逼') | test}}\n    </p>\n</div>\n<script>\n    //语法糖：简写\n    const app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{},\n        filters:{\n            msgFormat:function(msg, arg){\n                return msg.replace(/傻子/g,arg)//正则替换，g表示全部替换\n            }\n        }\n    })\n\n</script>\n</body>\n```\n\n# 7：自定义\n\n## 7.1 自定义按键修饰符\n\n```html\n<label>Name：\n<input type=\"text\" v-model=\"name\" @keyup.enter=\"add\">\n</label>\n```\n\n**@keyup**:绑定键盘\n\n1. 内置修饰符.enter .tab .delete .esc .space .up .down .left .right\n\n2. 其他的键可使用js定义的键盘码。比如**@keyup.113**表示F12 。\n\n```html\n<label>Name：\n<input type=\"text\" v-model=\"name\" @keyup.f12=\"add\">\n</label>\n\n<script>\n\t//自定义全局按键修饰符\n    Vue.config.keyCode.f12 = 113\n</script>\n```\n\n## 7.2 自定义指令\n\n1. 定义全局指令\n\n比如自定一个指令v-focus\n\n```html\n<script>\n    //使用Vue.directive()定义全局的指令\n    //其中：参数1：指令的名称，定义的时候，不要加v-前缀。但在调用的时候必须在指令名称前加v-前缀\n    //参数2是一个对象，对象身上有一些指令相关的函数，这些函数可以在特定的阶段执行相关操作\n\tVue.directive('focus',{\n        bind:function(el){\n            //每当指令被绑定到元素上时，会执行这个函数。只执行一次\n            //第一个参数永远时el，表示被绑定了指令的那个元素，el是一个原生的JS对象。\n            //在元素刚绑定了指令的时候，还没有插入到DOM中去，这时调用focus方法没有作用。\n            //el.focus\n            \n        },\n        inserted:function(el){\n           //inserted表示元素插入到dom中时执行，只执行一次\n            el.focus\n        },\n        updated:function(){},//当vNode更新的时候，会执行。可能多次触发\n    })\n</script>\n```\n\n**.focus**：JS方法，可以将焦点集中到DOM对象上，类似于，鼠标单击一次输入框。\n\n使用钩子函数参数\n\n- el：指令绑定的元素，用来直接操作DOM\n- binding：一个对象，包含以下属性：\n  - name:指令名称——color\n  - value:指令的绑定值。会计算比如v-color=\"1+1\"，binding.value=2\n  - expression:指令绑定值，不会计算, binding.expression='1+1'\n\n```html\n<div v-color=\"'red'\">\n    \n</div>\n<script>\n\tVue.directive('color',{\n        bind:function(el,binding){\n            el.style.color = binding.value\n        }\n    })\n</script>\n```\n\n2. 定义私有指令\n\n```html\n<script>\n\t const app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{},\n        filters:{},\n        directives:{\n            'color':{\n                bind:function(el,binding){\n                     el.style.color = binding.value\n                }\n            }\n        }\n    })\n\n</script>\n```\n\n**简写：**\n\n大多数情况下，旨在`bind`和`update`钩子上做重复动作，可以简写\n\n```html\n<script>\n    directives:{\n                'color':function(el,binding){//等同于把方法同时写到bind和update中\n                         el.style.color = binding.value\n                    }\n            }\n</script>\n```\n\n# 8：vue-resource实现get，post，jsonp请求\n\nvue-resource依赖于vue，需要在vue.js后导入vue-resource.js包。\n\n```html\n<body>\n    <script src=\"./js/vue.js\"></script>\n    <script src=\"./js/vue-resource.js\"></script>\n    \n    <div>\n        <button @click=\"getInfo\">\n            getInfo\n        </button>\n        <button @click=\"postInfo\">\n            getInfo\n        </button>\n        <button @click=\"jsonpInfo\">\n            getInfo\n        </button>\n    </div>  \n    \n    <script>\n    \tconst app = new Vue({\n        el:'#app',\n        data:{\n            msg:'你是真的傻子哦,人是傻子，脑袋笨'\n        },\n        methods:{\n            getInfo(){      this.$http.get('http://vue.studyit.io/api/getlunbo').then(function(result){\n                    //result是返回的结果，包括头部、数据等\n                    console.log(result.body)\n                }),\n             postInfo(){\n                 //手动发起的post请求没有表单数据\n                 //通过post方法的第三个参数，设置提交内容类型为普通表单格式。\n                 this.$http.post('http://vue.studyit.io/api/post',{},{emulateJSON:true}).then(result=>{\n                     console.log(result.body)\n                 }),\n              jsonpInfo(){\n                     this.$http.jsonp('http://vue.studyit.io/api/jsonp').then(result=>{\n                         console.log(result.body)\n                     })\n                 }\n             }     \n            }\n        }\n        })\n    </script>\n</body>\n```\n\n","slug":"Vue、Vuejs学习记录","published":1,"updated":"2020-06-20T06:48:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaet006ip0vz7bxp5u1v","content":"<h1 id=\"0：ES6补充\"><a href=\"#0：ES6补充\" class=\"headerlink\" title=\"0：ES6补充\"></a>0：ES6补充</h1><h2 id=\"0-1-块级作用域\"><a href=\"#0-1-块级作用域\" class=\"headerlink\" title=\"0.1 块级作用域\"></a>0.1 块级作用域</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"comment\">//变量作用域：变量在什么范围内可用</span></span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;why&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(name);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">console</span>.log(name);<span class=\"comment\">//在大括号外也能打开。</span></span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//没有块级作用域会导致什么问题</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> btns = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">&#x27;button&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i&lt;btns.length;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        btns[i].addEventListener(<span class=\"string\">&#x27;click&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;第&#x27;</span>+i+<span class=\"string\">&#x27;个按钮被点击&#x27;</span>)</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//显示的按钮被点击不准确。使用闭包解决此问题    </span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i&lt;btns.length;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            btns[num].addEventListener(<span class=\"string\">&#x27;click&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;第&#x27;</span>+num+<span class=\"string\">&#x27;个按钮被点击&#x27;</span>)</span></span><br><span class=\"line\">        \t&#125;)</span><br><span class=\"line\">        &#125;)(i)</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"1：Vue初体验\"><a href=\"#1：Vue初体验\" class=\"headerlink\" title=\"1：Vue初体验\"></a>1：Vue初体验</h1><h2 id=\"1-1-认识Vuejs\"><a href=\"#1-1-认识Vuejs\" class=\"headerlink\" title=\"1.1 认识Vuejs\"></a>1.1 认识Vuejs</h2><p>作为时下流行的前端框架，Vuejs是很多中小型企业开发项目的首选框架。</p>\n<ul>\n<li><p>Vue是一个渐进式的框架。</p>\n<ul>\n<li>渐进式意味着可以将Vue作为应用的一部分嵌入进去，带来更丰富的交互体验。</li>\n</ul>\n</li>\n<li><p>Vue特点和Web开发中的高级功能</p>\n<ul>\n<li>解耦视图和数据</li>\n<li>可复用的组件</li>\n<li>前端路由</li>\n<li>状态管理</li>\n<li>虚拟DOM</li>\n</ul>\n</li>\n<li><p>学习前提</p>\n<ul>\n<li>不需要Angular、React、jQuery</li>\n<li>需要HTML、CSS、JavaScript基础</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-2-Vue-js安装\"><a href=\"#1-2-Vue-js安装\" class=\"headerlink\" title=\"1.2 Vue.js安装\"></a>1.2 Vue.js安装</h2><p>方式一：直接CDN引入</p>\n<p>方式二：下载和引入</p>\n<ul>\n<li><p>安装教程 <a href=\"https://cn.vuejs.org/\">https://cn.vuejs.org</a></p>\n</li>\n<li><p>开发环境 <a href=\"https://vuejs.org/js/vue.js\">https://vuejs.org/js/vue.js</a></p>\n</li>\n<li><p>生产环境 <a href=\"https://vuejs.org/js/vue.min.js\">https://vuejs.org/js/vue.min.js</a></p>\n</li>\n</ul>\n<p>方式三：NPM安装</p>\n<ul>\n<li>通过webpack和CLI</li>\n</ul>\n<h2 id=\"1-3-Hello-Vuejs\"><a href=\"#1-3-Hello-Vuejs\" class=\"headerlink\" title=\"1.3 Hello Vuejs\"></a>1.3 Hello Vuejs</h2><p>Vue的响应式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;name&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"comment\">//let(变量)/const(常量)</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//编程范式：声明式编程</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,<span class=\"comment\">//用于挂在要管理的元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">            data:&#123;<span class=\"comment\">//定义数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">                message:<span class=\"string\">&#x27;你好啊！&#x27;</span>,<span class=\"comment\">//在div中显示message内容</span></span></span><br><span class=\"line\"><span class=\"javascript\">                name:<span class=\"string\">&#x27;coderwhy&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)        </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js的做法（编程范式：命令式编程）</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.创建div元素，设置id属性</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.定义一个变量叫message</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//3.将message变量放在div元素中显示</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//4.修改messge的数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//5.将修改后的数据替换到div元素</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-4-Vue列表显示\"><a href=\"#1-4-Vue列表显示\" class=\"headerlink\" title=\"1.4 Vue列表显示\"></a>1.4 Vue列表显示</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in movies&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                message:<span class=\"string\">&#x27;你好啊&#x27;</span>，</span></span><br><span class=\"line\"><span class=\"javascript\">                movies:[<span class=\"string\">&#x27;海王&#x27;</span>,<span class=\"string\">&#x27;大话西游&#x27;</span>,<span class=\"string\">&#x27;星际穿越&#x27;</span>,<span class=\"string\">&#x27;少年派&#x27;</span>]</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>app.movies.push(&#39;盗梦空间&#39;)//添加数据</code></p>\n<ul>\n<li>使用v-for指令遍历数组元素</li>\n</ul>\n<p><strong>案例展示：计数器</strong></p>\n<script src=\"/js/vue.min.js\"></script>\n<div id=\"app\">\n    当前计数：0</br>\n        <button v-on:click=\"counter++\">+</button>\n        <button v-on:click=\"counter--\">-</button>\n</div>\n<script>\n        //语法糖：简写\n        const app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            }\n        })\n</script>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            当前计数：&#123;&#123;counter&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--&lt;button v-on:click=&quot;counter++&quot;&gt;+&lt;/button&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--&lt;button v-on:click=&quot;counter--&quot;&gt;-&lt;/button&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-on:click</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span>+<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;min&quot;</span>&gt;</span>-<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\">                counter:0</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                add:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;add被执行&#x27;</span>)；</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.counter++;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\"><span class=\"javascript\">                min:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            \t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;min被执行&#x27;</span>)；</span></span><br><span class=\"line\"><span class=\"javascript\">\t\t\t\t\t<span class=\"built_in\">this</span>.counter--;</span></span><br><span class=\"line\">        \t\t&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.拿buttom元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.添加监听时间</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>新属性：methods，该属性用于Vue对象中定义方法。</p>\n</li>\n<li><p>新指令：@click，该指令用于监听某个元素的点击事件。</p>\n</li>\n</ul>\n<h2 id=\"1-5-Vue中的MVVM\"><a href=\"#1-5-Vue中的MVVM\" class=\"headerlink\" title=\"1.5 Vue中的MVVM\"></a>1.5 Vue中的MVVM</h2><p>什么是MVVM？</p>\n<ul>\n<li>Model View ViewModel</li>\n</ul>\n<h2 id=\"1-6-创建Vue实例传入的options\"><a href=\"#1-6-创建Vue实例传入的options\" class=\"headerlink\" title=\"1.6 创建Vue实例传入的options\"></a>1.6 创建Vue实例传入的options</h2><p>目前掌握的选项</p>\n<ul>\n<li><p>el：</p>\n<ul>\n<li>字符型String|HTMLElement</li>\n<li>决定Vue管理哪一个DOM</li>\n</ul>\n</li>\n<li><p>data：</p>\n<ul>\n<li>Object|Funtion()<strong>（组件当中必须是一个函数）</strong></li>\n<li>Vue实例对应的数据对象。</li>\n</ul>\n</li>\n<li><p>methods：</p>\n<ul>\n<li>{[key:string] Function}</li>\n<li>定义属于Vue的一些方法，可以在其他地方调用，也可以在指令中使用</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-7-Vue的生命周期\"><a href=\"#1-7-Vue的生命周期\" class=\"headerlink\" title=\"1.7 Vue的生命周期\"></a>1.7 Vue的生命周期</h2><p>生命周期：事物从诞生到消亡的整个过程</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:obj,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\"><span class=\"javascript\">        created:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        mounted:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-8-Vue的生命周期函数\"><a href=\"#1-8-Vue的生命周期函数\" class=\"headerlink\" title=\"1.8 Vue的生命周期函数\"></a>1.8 Vue的生命周期函数</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:obj,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\"><span class=\"javascript\">        beforeCreate:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,<span class=\"comment\">//Hook:钩子函数</span></span></span><br><span class=\"line\"><span class=\"javascript\">        created:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        mounted:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>生命周期函数：</strong><code>beforeCreate,create,beforeMounte,mounted,beforeUpdate,updated,beforDestroy,destroyed</code></p>\n<h1 id=\"2：插值的操作\"><a href=\"#2：插值的操作\" class=\"headerlink\" title=\"2：插值的操作\"></a>2：插值的操作</h1><h2 id=\"2-1-Mustache语法，插值的操作\"><a href=\"#2-1-Mustache语法，插值的操作\" class=\"headerlink\" title=\"2.1 Mustache语法，插值的操作\"></a>2.1 Mustache语法，插值的操作</h2><p>Mustache语法：双大括号//mustache胡须</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;firstName+&#x27; &#x27;+lastName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>&#123;&#123;counter*2&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&#x27;nihao&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            firstName:<span class=\"string\">&#x27;kobe&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName:<span class=\"string\">&#x27;bryant&#x27;</span>,</span></span><br><span class=\"line\">            counter:100</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>mustache语法不仅可以直接写变量，还可以写语法。</p>\n<h2 id=\"2-2-插值操作–其他指令使用\"><a href=\"#2-2-插值操作–其他指令使用\" class=\"headerlink\" title=\"2.2 插值操作–其他指令使用\"></a>2.2 插值操作–其他指令使用</h2><ul>\n<li><strong>v-once</strong>: 不想改变DOM值，使DOM变成非响应式。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-once</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;<span class=\"comment\">&lt;!--message不会随数据更新而改变--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>v-html</strong>:直接展示html代码，而不是展示其字符串</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-html</span>=<span class=\"string\">&quot;url&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                url=&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://www.baidu.com&quot;</span>&gt;</span>百度一下<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果：<a href=\"https://www.baidu.com/\">百度一下</a></p>\n<ul>\n<li><strong>v-text</strong>：和作用相同，但会覆盖<code>&lt;h2&gt;</code>代码块中的字符会被覆盖掉，不灵活。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-text</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,<span class=\"comment\">//用于挂在要管理的元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">            data:&#123;<span class=\"comment\">//定义数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">                message:<span class=\"string\">&#x27;你好啊！&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)        </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>v-pre</strong>：将例如大括号显示出来，不渲染数据</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-pre</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<ul>\n<li><strong>v-cloak</strong>：当js延迟加载出来时，不显示dom渲染之前的值。不会在渲染之前出现//cloak斗篷</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--&lt;head&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;style&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        [v-cloak]&#123;</span></span><br><span class=\"line\"><span class=\"comment\">            display:none;</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/style&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;/head&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span> <span class=\"attr\">v-cloak</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：动态绑定属性\"><a href=\"#3：动态绑定属性\" class=\"headerlink\" title=\"3：动态绑定属性\"></a>3：动态绑定属性</h1><h2 id=\"3-1-v-bind，动态绑定DOM属性\"><a href=\"#3-1-v-bind，动态绑定DOM属性\" class=\"headerlink\" title=\"3.1 v-bind，动态绑定DOM属性\"></a>3.1 v-bind，动态绑定DOM属性</h2><ul>\n<li>v-bind的基本使用</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">v-bind:src</span>=<span class=\"string\">&quot;imgURL&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">v-bind:href</span>=<span class=\"string\">&quot;aHref&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> </span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">&lt;!--语法糖的写法--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;imgURL&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">&quot;aHref&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,<span class=\"comment\">//用于挂在要管理的元素</span></span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                aHref=<span class=\"string\">&quot;https://www.baidu.com&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">\t\t\t\timgURL:<span class=\"string\">&#x27;https://i0.hdslb.com/bfs/sycp/creative_img/202002/1e9bfa663a93374c8e10c3933cfc78f8.jpg&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)        </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>v-bind简写/语法糖：<code>:</code></li>\n<li>v-bind对象用法：</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;class1:isClass1,class2:isClass2&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&quot;showClassExample&quot;</span></span></span><br><span class=\"line\"><span class=\"javascript\">            isClass1:<span class=\"literal\">true</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isClass2:<span class=\"literal\">false</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>//title类固定，动态更改class1和class2</strong></p>\n<p><code>&#123;类名:布尔值,类名：布尔值&#125;</code></p>\n<ul>\n<li>v-bind数组语法</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;getClasses()&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&quot;showClassExample&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isClass1:<span class=\"literal\">true</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isClass2:<span class=\"literal\">false</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\"><span class=\"javascript\">        \tgetClasses:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        \t\t<span class=\"keyword\">return</span>&#123;<span class=\"attr\">class1</span>:<span class=\"built_in\">this</span>.isClass1,<span class=\"attr\">class2</span>:<span class=\"built_in\">this</span>.isClass2&#125;</span></span><br><span class=\"line\">    \t\t&#125;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：v-on中函数省略了()，但v-bind需要添加()</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;[class1,class2]&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&quot;showClassExample&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            class1:<span class=\"string\">&#x27;class1&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            class2:<span class=\"string\">&#x27;class2&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-作业，结合v-for和v-bind\"><a href=\"#3-2-作业，结合v-for和v-bind\" class=\"headerlink\" title=\"3.2 作业，结合v-for和v-bind\"></a>3.2 作业，结合v-for和v-bind</h2><p>作业：使用v-for显示一个电影名称列表，设置监听点击事件，当某个电影被点击，改变此电影名称字体颜色为红色。</p>\n<p>答案：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.red</span>&#123;<span class=\"attribute\">color</span>:red&#125;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(m, index) in movies&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;clickItem=index&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;red:clickItem==index&#125;&quot;</span>&gt;</span>&#123;&#123;m&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                movies: [<span class=\"string\">&#x27;复仇者联盟&#x27;</span>, <span class=\"string\">&#x27;生化危机&#x27;</span>, <span class=\"string\">&#x27;星际大战&#x27;</span>, <span class=\"string\">&#x27;钢铁侠&#x27;</span>],</span></span><br><span class=\"line\">                clickItem:99,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-v-bind动态绑定样式\"><a href=\"#3-3-v-bind动态绑定样式\" class=\"headerlink\" title=\"3.3 v-bind动态绑定样式\"></a>3.3 v-bind动态绑定样式</h2><ul>\n<li>样式的对象用法</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#123;fontSize:&#x27;50px&#x27;,color:finalColor&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&#x27;abc&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        \tfinalColor:<span class=\"string\">&#x27;red&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：{fontSize:50px}为错误表达，50px会被解析为一个变量，50px必须加单引号</p>\n</blockquote>\n<ul>\n<li>样式的数组用法</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;[style1,style2]&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&#x27;abc&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        \tstyle1:&#123;<span class=\"attr\">fontSize</span>:<span class=\"string\">&#x27;100px&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">            style2:&#123;<span class=\"attr\">color</span>:<span class=\"string\">&#x27;red&#x27;</span>&#125;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：计算属性\"><a href=\"#4：计算属性\" class=\"headerlink\" title=\"4：计算属性\"></a>4：计算属性</h1><h2 id=\"4-1-计算属性的基本用法\"><a href=\"#4-1-计算属性的基本用法\" class=\"headerlink\" title=\"4.1 计算属性的基本用法\"></a>4.1 计算属性的基本用法</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;firstName+&quot; &quot;+lastName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;getFullName()&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;fullName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">        \tfirstName:<span class=\"string\">&#x27;Lebron&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName:<span class=\"string\">&#x27;James&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            fullName:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.fistName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"><span class=\"javascript\">        &#125;,<span class=\"comment\">//计算属性</span></span></span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">        \tgetFullName()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.fistName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>computed:计算属性的使用</strong></p>\n<h2 id=\"4-2-计算属性的复杂使用\"><a href=\"#4-2-计算属性的复杂使用\" class=\"headerlink\" title=\"4.2 计算属性的复杂使用\"></a>4.2 计算属性的复杂使用</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        总价格：&#123;&#123;totalPrice&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            books:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">110</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;Unix编程&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"number\">119</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">            \t&#123;<span class=\"attr\">id</span>:<span class=\"number\">111</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;代码大全&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"number\">89</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        \t\t&#123;<span class=\"attr\">id</span>:<span class=\"number\">112</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;现代操作系统&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"number\">81</span>&#125;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            totalPrice:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"built_in\">this</span>.books.length;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    result += <span class=\"built_in\">this</span>.books[i].price;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                /*</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.books)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    result += <span class=\"built_in\">this</span>.books[i].price;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> book <span class=\"keyword\">of</span> <span class=\"built_in\">this</span>.books)&#123;</span></span><br><span class=\"line\">                    result += book.price;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                */</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> result;</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"><span class=\"javascript\">        &#125;,<span class=\"comment\">//计算属性</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-计算属性setter和getter\"><a href=\"#4-3-计算属性setter和getter\" class=\"headerlink\" title=\"4.3 计算属性setter和getter\"></a>4.3 计算属性setter和getter</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;fullName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            firstName:<span class=\"string\">&#x27;Kobe&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName:<span class=\"string\">&#x27;Bryant&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed:&#123;</span><br><span class=\"line\">            /*</span><br><span class=\"line\"><span class=\"javascript\">            fullName:&#123;<span class=\"comment\">//fullName为一个对象</span></span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"comment\">//一般属性没有set方法，为只读属性</span></span></span><br><span class=\"line\"><span class=\"javascript\">                set:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,<span class=\"comment\">//通过控制板，app.fullName=&#x27;ABC&#x27;会调用此方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.firstName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            */</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//上述方法简写为</span></span></span><br><span class=\"line\"><span class=\"javascript\">            fullName:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        \t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.firstName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName; </span></span><br><span class=\"line\">    \t\t&#125;</span><br><span class=\"line\"><span class=\"javascript\">        &#125;,<span class=\"comment\">//计算属性</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-计算属性和methods对比\"><a href=\"#4-4-计算属性和methods对比\" class=\"headerlink\" title=\"4.4 计算属性和methods对比\"></a>4.4 计算属性和methods对比</h2><p>方法每次调用，程序都会重复执行；计算属性第一次计算出来，结果就保存在内存中。下次再调用，程序不会重复执行。</p>\n<blockquote>\n<p>需要多次调用的计算结果，采用计算属性性能会更低。</p>\n</blockquote>\n<h2 id=\"4-5-跑马灯项目\"><a href=\"#4-5-跑马灯项目\" class=\"headerlink\" title=\"4.5 跑马灯项目\"></a>4.5 跑马灯项目</h2><p>一句文字实现，点击按钮，文字滚动播放，再点击文字停止滚动。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;lang&quot;</span>&gt;</span>浪起来<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;di&quot;</span>&gt;</span>低调<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                msg:<span class=\"string\">&#x27;猥琐发育。别浪~~！&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                intervalId:<span class=\"literal\">null</span></span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\">                lang()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"comment\">//函数里的this.变量无法指向函数外部的变量</span></span></span><br><span class=\"line\">                    /*</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> start = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">0</span>,<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> end = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符后的所有字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">this</span>.msg=end+start;<span class=\"comment\">//将第一个字符放到最后，实现跑马灯效果</span></span></span><br><span class=\"line\">                    &#125;,400)</span><br><span class=\"line\">                     */</span><br><span class=\"line\"><span class=\"javascript\">                   <span class=\"comment\">//使用箭头函数解决函数内部this问题</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.intervalId!=<span class=\"literal\">null</span>) <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.intervalId = <span class=\"built_in\">setInterval</span>(<span class=\"function\">()=&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> start = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">0</span>,<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> end = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符后的所有字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">this</span>.msg=end+start;<span class=\"comment\">//将第一个字符放到最后，实现跑马灯效果</span></span></span><br><span class=\"line\">                    &#125;,400)</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                di()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.intervalId);</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.intervalId=<span class=\"literal\">null</span>;<span class=\"comment\">//清楚定时器后需要重新把internalId设为null</span></span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"5-常用指令\"><a href=\"#5-常用指令\" class=\"headerlink\" title=\"5: 常用指令\"></a>5: 常用指令</h1><h2 id=\"5-1-v-for的四种使用方式\"><a href=\"#5-1-v-for的四种使用方式\" class=\"headerlink\" title=\"5.1 v-for的四种使用方式\"></a>5.1 v-for的四种使用方式</h2><ul>\n<li>循环数组</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;item&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in list&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;item+&quot;-----&quot;+index&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            list:[1,2,3,4,5]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>循环对象数组</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;item.id&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            list:[</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs1&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs2&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">3</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs3&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">4</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs4&#x27;</span>&#125;,</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>循环对象</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(val,key,index) in user&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;val&#125;&#125;--&#123;&#123;key&#125;&#125;--&#123;&#123;index&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            user:&#123;</span><br><span class=\"line\">                id:1,</span><br><span class=\"line\"><span class=\"javascript\">                name:<span class=\"string\">&#x27;tuoni&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                gender:<span class=\"string\">&#x27;nan&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>迭代数字</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--in后面可以使数组，对象数组，对象，还可以使数字。若为数字，count从1开始--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;count in 10&quot;</span>&gt;</span></span><br><span class=\"line\">        第&#123;&#123;count&#125;&#125;次循环</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;&#125;,   </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：count从1开始计数</strong></p>\n<ul>\n<li>v-for循环中key属性的使用</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Id:</span><br><span class=\"line\">        \t<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;id&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Name:</span><br><span class=\"line\">        \t<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;name&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span>添加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;item.id&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span> = <span class=\"string\">&quot;checkbox&quot;</span> &gt;</span></span><br><span class=\"line\">       &#123;&#123;item.id&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            id:<span class=\"string\">&#x27;&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            name:<span class=\"string\">&#x27;&#x27;</span>,</span></span><br><span class=\"line\">            list:[</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">1</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;lisi&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">2</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;yinzheng&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">3</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;zhaogao&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">4</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;hanfei&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">5</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;kongzi&#x27;</span>&#125;,</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">            add()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.list.push(&#123;<span class=\"attr\">id</span>:<span class=\"built_in\">this</span>.id,<span class=\"attr\">name</span>:<span class=\"built_in\">this</span>.name&#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"comment\">//this.list.unshift(&#123;id:this.id,name:this.name&#125;);</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-v-on指令\"><a href=\"#5-2-v-on指令\" class=\"headerlink\" title=\"5.2 v-on指令\"></a>5.2 v-on指令</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-on:click</span>=<span class=\"string\">&quot;show&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\">                counter:0</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\">                show()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                    alert(<span class=\"string\">&#x27;Hello&#x27;</span>);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.拿buttom元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.添加监听时间</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>事件修饰符<ul>\n<li>.stop 阻止冒泡//@click.stop设置再内部DOM。不会触发@click.stop外部DOM的点击事件</li>\n<li>.prevent 阻止默认行为//@click.prevent。比如阻止a标签跳转到href地址</li>\n<li>.capture 添加事件倾听器实现捕获模式//给外层DOM 添加@click.capture，会先处理外部点击事件。</li>\n<li>.self 只当自身被点击才触发事件//给外部DOM添加@click.self，只有点击外部DOM时才能触发它。也可阻止冒泡</li>\n<li>.once 只触发一次事件处理函数。</li>\n</ul>\n</li>\n</ul>\n<p>事件修饰符可以叠加使用 @click.prevent.once先后顺序无区别。</p>\n<h2 id=\"5-3-v-model\"><a href=\"#5-3-v-model\" class=\"headerlink\" title=\"5.3 v-model\"></a>5.3 v-model</h2><p>可以实现表单元素的model中的数据双向绑定。<strong>v-model只能用在表单元素中</strong>，input(redio, text, address, email…),select , checkbox, textarea</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;msg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>简易计算器案例</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;n1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;opt&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;+&quot;</span>&gt;</span>+<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;-&quot;</span>&gt;</span>-<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;*&quot;</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;/&quot;</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;n2&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;calculate&quot;</span>&gt;</span>=<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;result&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">const</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            n1:0,</span><br><span class=\"line\">            n2:0,</span><br><span class=\"line\">            result:0,</span><br><span class=\"line\"><span class=\"javascript\">            opt:<span class=\"string\">&#x27;+&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">        calculate()&#123;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">switch</span>(<span class=\"built_in\">this</span>.opt)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) + <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) - <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        \t<span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) * <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) / <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">         <span class=\"comment\">//this.result = eval(this.n1+this.opt+this.n2)</span></span></span><br><span class=\"line\"><span class=\"javascript\">         <span class=\"comment\">//eval会解析字符串并执行</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-4-v-if和v-show的使用\"><a href=\"#5-4-v-if和v-show的使用\" class=\"headerlink\" title=\"5.4 v-if和v-show的使用\"></a>5.4 v-if和v-show的使用</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;flag=!flag&quot;</span>&gt;</span></span><br><span class=\"line\">            切换</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h3</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;flag&quot;</span>&gt;</span></span><br><span class=\"line\">            这是v-if控制的元素</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h3</span> <span class=\"attr\">v-show</span>=<span class=\"string\">&quot;flag&quot;</span>&gt;</span></span><br><span class=\"line\">            这是v-show控制的元素</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                flag:<span class=\"literal\">true</span></span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.拿buttom元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.添加监听时间</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>v-if:会删除或创建元素  //v-if消耗切换性能，如果元素设计频繁的切换不要使用。</p>\n</li>\n<li><p>v-show：不会删除DOM，而是修改其可见属性dispaly:none //如果元素可能永远也不会显示出来，最好使用v-if</p>\n</li>\n</ul>\n<h1 id=\"6：过滤器\"><a href=\"#6：过滤器\" class=\"headerlink\" title=\"6：过滤器\"></a>6：过滤器</h1><p><strong>概念</strong>：Vue.js中允许自定义过滤器，可以用作一些常见的文本格式化。过滤器可以用在两个地方：mustache插值和v-bind</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--过滤器调用格式     &#123;&#123;name | nameope&#125;&#125;--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//过滤器定义语法</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//过滤器中的function，第一个参数，永远是过滤器管道符（|）前面传过来的参数</span></span></span><br><span class=\"line\"><span class=\"javascript\">\tVue.filter(<span class=\"string\">&#x27;过滤器名称&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;&#125;)</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意:当全局和私有过滤器，使用相同名称时，优先调用私有过滤器</strong></p>\n<h2 id=\"6-1-定义全局过滤器\"><a href=\"#6-1-定义全局过滤器\" class=\"headerlink\" title=\"6.1 定义全局过滤器\"></a>6.1 定义全局过滤器</h2><p>全局过滤器，就是所有的vm实例都能用</p>\n<p>过滤器的<strong>基本使用</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123; msg | msgFormat(&#x27;牛逼&#x27;) | test&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//定义一个Vue全局过滤器</span></span></span><br><span class=\"line\"><span class=\"javascript\">    Vue.filter(<span class=\"string\">&#x27;msgFormat&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg, arg</span>)</span>&#123;<span class=\"comment\">//arg是msgFormat输入的参数。第一个为参数msg为默认的插值</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> msg.replace(<span class=\"regexp\">/傻子/g</span>,arg)<span class=\"comment\">//正则替换，g表示全部替换</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//定义多个过滤器</span></span></span><br><span class=\"line\"><span class=\"javascript\">    Vue.filter(<span class=\"string\">&#x27;test&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> msg+<span class=\"string\">&quot;这是第二个过滤器&quot;</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-2-定义私有过滤器\"><a href=\"#6-2-定义私有过滤器\" class=\"headerlink\" title=\"6.2 定义私有过滤器\"></a>6.2 定义私有过滤器</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123; msg | msgFormat(&#x27;牛逼&#x27;) | test&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\">        filters:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msgFormat:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg, arg</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> msg.replace(<span class=\"regexp\">/傻子/g</span>,arg)<span class=\"comment\">//正则替换，g表示全部替换</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"7：自定义\"><a href=\"#7：自定义\" class=\"headerlink\" title=\"7：自定义\"></a>7：自定义</h1><h2 id=\"7-1-自定义按键修饰符\"><a href=\"#7-1-自定义按键修饰符\" class=\"headerlink\" title=\"7.1 自定义按键修饰符\"></a>7.1 自定义按键修饰符</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Name：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;name&quot;</span> @<span class=\"attr\">keyup.enter</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>@keyup</strong>:绑定键盘</p>\n<ol>\n<li><p>内置修饰符.enter .tab .delete .esc .space .up .down .left .right</p>\n</li>\n<li><p>其他的键可使用js定义的键盘码。比如**@keyup.113**表示F12 。</p>\n</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Name：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;name&quot;</span> @<span class=\"attr\">keyup.f12</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"comment\">//自定义全局按键修饰符</span></span></span><br><span class=\"line\">    Vue.config.keyCode.f12 = 113</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"7-2-自定义指令\"><a href=\"#7-2-自定义指令\" class=\"headerlink\" title=\"7.2 自定义指令\"></a>7.2 自定义指令</h2><ol>\n<li>定义全局指令</li>\n</ol>\n<p>比如自定一个指令v-focus</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//使用Vue.directive()定义全局的指令</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//其中：参数1：指令的名称，定义的时候，不要加v-前缀。但在调用的时候必须在指令名称前加v-前缀</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//参数2是一个对象，对象身上有一些指令相关的函数，这些函数可以在特定的阶段执行相关操作</span></span></span><br><span class=\"line\"><span class=\"javascript\">\tVue.directive(<span class=\"string\">&#x27;focus&#x27;</span>,&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        bind:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//每当指令被绑定到元素上时，会执行这个函数。只执行一次</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//第一个参数永远时el，表示被绑定了指令的那个元素，el是一个原生的JS对象。</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//在元素刚绑定了指令的时候，还没有插入到DOM中去，这时调用focus方法没有作用。</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//el.focus</span></span></span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        inserted:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"comment\">//inserted表示元素插入到dom中时执行，只执行一次</span></span></span><br><span class=\"line\">            el.focus</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        updated:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,<span class=\"comment\">//当vNode更新的时候，会执行。可能多次触发</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>.focus</strong>：JS方法，可以将焦点集中到DOM对象上，类似于，鼠标单击一次输入框。</p>\n<p>使用钩子函数参数</p>\n<ul>\n<li>el：指令绑定的元素，用来直接操作DOM</li>\n<li>binding：一个对象，包含以下属性：<ul>\n<li>name:指令名称——color</li>\n<li>value:指令的绑定值。会计算比如v-color=”1+1”，binding.value=2</li>\n<li>expression:指令绑定值，不会计算, binding.expression=’1+1’</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-color</span>=<span class=\"string\">&quot;&#x27;red&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\tVue.directive(<span class=\"string\">&#x27;color&#x27;</span>,&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        bind:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el,binding</span>)</span>&#123;</span></span><br><span class=\"line\">            el.style.color = binding.value</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>定义私有指令</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\">        filters:&#123;&#125;,</span><br><span class=\"line\">        directives:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">&#x27;color&#x27;</span>:&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                bind:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el,binding</span>)</span>&#123;</span></span><br><span class=\"line\">                     el.style.color = binding.value</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>简写：</strong></p>\n<p>大多数情况下，旨在<code>bind</code>和<code>update</code>钩子上做重复动作，可以简写</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    directives:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"string\">&#x27;color&#x27;</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el,binding</span>)</span>&#123;<span class=\"comment\">//等同于把方法同时写到bind和update中</span></span></span><br><span class=\"line\">                         el.style.color = binding.value</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"8：vue-resource实现get，post，jsonp请求\"><a href=\"#8：vue-resource实现get，post，jsonp请求\" class=\"headerlink\" title=\"8：vue-resource实现get，post，jsonp请求\"></a>8：vue-resource实现get，post，jsonp请求</h1><p>vue-resource依赖于vue，需要在vue.js后导入vue-resource.js包。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue-resource.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;getInfo&quot;</span>&gt;</span></span><br><span class=\"line\">            getInfo</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;postInfo&quot;</span>&gt;</span></span><br><span class=\"line\">            getInfo</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;jsonpInfo&quot;</span>&gt;</span></span><br><span class=\"line\">            getInfo</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>  </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            getInfo()&#123;      <span class=\"built_in\">this</span>.$http.get(<span class=\"string\">&#x27;http://vue.studyit.io/api/getlunbo&#x27;</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"comment\">//result是返回的结果，包括头部、数据等</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">console</span>.log(result.body)</span></span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">             postInfo()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                 <span class=\"comment\">//手动发起的post请求没有表单数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">                 <span class=\"comment\">//通过post方法的第三个参数，设置提交内容类型为普通表单格式。</span></span></span><br><span class=\"line\"><span class=\"javascript\">                 <span class=\"built_in\">this</span>.$http.post(<span class=\"string\">&#x27;http://vue.studyit.io/api/post&#x27;</span>,&#123;&#125;,&#123;<span class=\"attr\">emulateJSON</span>:<span class=\"literal\">true</span>&#125;).then(<span class=\"function\"><span class=\"params\">result</span>=&gt;</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                     <span class=\"built_in\">console</span>.log(result.body)</span></span><br><span class=\"line\">                 &#125;),</span><br><span class=\"line\">              jsonpInfo()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                     <span class=\"built_in\">this</span>.$http.jsonp(<span class=\"string\">&#x27;http://vue.studyit.io/api/jsonp&#x27;</span>).then(<span class=\"function\"><span class=\"params\">result</span>=&gt;</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                         <span class=\"built_in\">console</span>.log(result.body)</span></span><br><span class=\"line\">                     &#125;)</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">             &#125;     </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：ES6补充\"><a href=\"#0：ES6补充\" class=\"headerlink\" title=\"0：ES6补充\"></a>0：ES6补充</h1><h2 id=\"0-1-块级作用域\"><a href=\"#0-1-块级作用域\" class=\"headerlink\" title=\"0.1 块级作用域\"></a>0.1 块级作用域</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"comment\">//变量作用域：变量在什么范围内可用</span></span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;why&#x27;</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(name);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">console</span>.log(name);<span class=\"comment\">//在大括号外也能打开。</span></span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//没有块级作用域会导致什么问题</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> btns = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">&#x27;button&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i&lt;btns.length;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        btns[i].addEventListener(<span class=\"string\">&#x27;click&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;第&#x27;</span>+i+<span class=\"string\">&#x27;个按钮被点击&#x27;</span>)</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//显示的按钮被点击不准确。使用闭包解决此问题    </span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i&lt;btns.length;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            btns[num].addEventListener(<span class=\"string\">&#x27;click&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;第&#x27;</span>+num+<span class=\"string\">&#x27;个按钮被点击&#x27;</span>)</span></span><br><span class=\"line\">        \t&#125;)</span><br><span class=\"line\">        &#125;)(i)</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"1：Vue初体验\"><a href=\"#1：Vue初体验\" class=\"headerlink\" title=\"1：Vue初体验\"></a>1：Vue初体验</h1><h2 id=\"1-1-认识Vuejs\"><a href=\"#1-1-认识Vuejs\" class=\"headerlink\" title=\"1.1 认识Vuejs\"></a>1.1 认识Vuejs</h2><p>作为时下流行的前端框架，Vuejs是很多中小型企业开发项目的首选框架。</p>\n<ul>\n<li><p>Vue是一个渐进式的框架。</p>\n<ul>\n<li>渐进式意味着可以将Vue作为应用的一部分嵌入进去，带来更丰富的交互体验。</li>\n</ul>\n</li>\n<li><p>Vue特点和Web开发中的高级功能</p>\n<ul>\n<li>解耦视图和数据</li>\n<li>可复用的组件</li>\n<li>前端路由</li>\n<li>状态管理</li>\n<li>虚拟DOM</li>\n</ul>\n</li>\n<li><p>学习前提</p>\n<ul>\n<li>不需要Angular、React、jQuery</li>\n<li>需要HTML、CSS、JavaScript基础</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-2-Vue-js安装\"><a href=\"#1-2-Vue-js安装\" class=\"headerlink\" title=\"1.2 Vue.js安装\"></a>1.2 Vue.js安装</h2><p>方式一：直接CDN引入</p>\n<p>方式二：下载和引入</p>\n<ul>\n<li><p>安装教程 <a href=\"https://cn.vuejs.org/\">https://cn.vuejs.org</a></p>\n</li>\n<li><p>开发环境 <a href=\"https://vuejs.org/js/vue.js\">https://vuejs.org/js/vue.js</a></p>\n</li>\n<li><p>生产环境 <a href=\"https://vuejs.org/js/vue.min.js\">https://vuejs.org/js/vue.min.js</a></p>\n</li>\n</ul>\n<p>方式三：NPM安装</p>\n<ul>\n<li>通过webpack和CLI</li>\n</ul>\n<h2 id=\"1-3-Hello-Vuejs\"><a href=\"#1-3-Hello-Vuejs\" class=\"headerlink\" title=\"1.3 Hello Vuejs\"></a>1.3 Hello Vuejs</h2><p>Vue的响应式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">            &#123;&#123;name&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"comment\">//let(变量)/const(常量)</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//编程范式：声明式编程</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,<span class=\"comment\">//用于挂在要管理的元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">            data:&#123;<span class=\"comment\">//定义数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">                message:<span class=\"string\">&#x27;你好啊！&#x27;</span>,<span class=\"comment\">//在div中显示message内容</span></span></span><br><span class=\"line\"><span class=\"javascript\">                name:<span class=\"string\">&#x27;coderwhy&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)        </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js的做法（编程范式：命令式编程）</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.创建div元素，设置id属性</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.定义一个变量叫message</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//3.将message变量放在div元素中显示</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//4.修改messge的数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//5.将修改后的数据替换到div元素</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-4-Vue列表显示\"><a href=\"#1-4-Vue列表显示\" class=\"headerlink\" title=\"1.4 Vue列表显示\"></a>1.4 Vue列表显示</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in movies&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                message:<span class=\"string\">&#x27;你好啊&#x27;</span>，</span></span><br><span class=\"line\"><span class=\"javascript\">                movies:[<span class=\"string\">&#x27;海王&#x27;</span>,<span class=\"string\">&#x27;大话西游&#x27;</span>,<span class=\"string\">&#x27;星际穿越&#x27;</span>,<span class=\"string\">&#x27;少年派&#x27;</span>]</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>app.movies.push(&#39;盗梦空间&#39;)//添加数据</code></p>\n<ul>\n<li>使用v-for指令遍历数组元素</li>\n</ul>\n<p><strong>案例展示：计数器</strong></p>\n<script src=\"/js/vue.min.js\"></script>\n<div id=\"app\">\n    当前计数：0</br>\n        <button v-on:click=\"counter++\">+</button>\n        <button v-on:click=\"counter--\">-</button>\n</div>\n<script>\n        //语法糖：简写\n        const app = new Vue({\n            el:'#app',\n            data:{\n                counter:0\n            }\n        })\n</script>\n\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">            当前计数：&#123;&#123;counter&#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--&lt;button v-on:click=&quot;counter++&quot;&gt;+&lt;/button&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--&lt;button v-on:click=&quot;counter--&quot;&gt;-&lt;/button&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-on:click</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span>+<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;min&quot;</span>&gt;</span>-<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\">                counter:0</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                add:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;add被执行&#x27;</span>)；</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.counter++;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\"><span class=\"javascript\">                min:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            \t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;min被执行&#x27;</span>)；</span></span><br><span class=\"line\"><span class=\"javascript\">\t\t\t\t\t<span class=\"built_in\">this</span>.counter--;</span></span><br><span class=\"line\">        \t\t&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.拿buttom元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.添加监听时间</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>新属性：methods，该属性用于Vue对象中定义方法。</p>\n</li>\n<li><p>新指令：@click，该指令用于监听某个元素的点击事件。</p>\n</li>\n</ul>\n<h2 id=\"1-5-Vue中的MVVM\"><a href=\"#1-5-Vue中的MVVM\" class=\"headerlink\" title=\"1.5 Vue中的MVVM\"></a>1.5 Vue中的MVVM</h2><p>什么是MVVM？</p>\n<ul>\n<li>Model View ViewModel</li>\n</ul>\n<h2 id=\"1-6-创建Vue实例传入的options\"><a href=\"#1-6-创建Vue实例传入的options\" class=\"headerlink\" title=\"1.6 创建Vue实例传入的options\"></a>1.6 创建Vue实例传入的options</h2><p>目前掌握的选项</p>\n<ul>\n<li><p>el：</p>\n<ul>\n<li>字符型String|HTMLElement</li>\n<li>决定Vue管理哪一个DOM</li>\n</ul>\n</li>\n<li><p>data：</p>\n<ul>\n<li>Object|Funtion()<strong>（组件当中必须是一个函数）</strong></li>\n<li>Vue实例对应的数据对象。</li>\n</ul>\n</li>\n<li><p>methods：</p>\n<ul>\n<li>{[key:string] Function}</li>\n<li>定义属于Vue的一些方法，可以在其他地方调用，也可以在指令中使用</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"1-7-Vue的生命周期\"><a href=\"#1-7-Vue的生命周期\" class=\"headerlink\" title=\"1.7 Vue的生命周期\"></a>1.7 Vue的生命周期</h2><p>生命周期：事物从诞生到消亡的整个过程</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:obj,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\"><span class=\"javascript\">        created:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        mounted:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1-8-Vue的生命周期函数\"><a href=\"#1-8-Vue的生命周期函数\" class=\"headerlink\" title=\"1.8 Vue的生命周期函数\"></a>1.8 Vue的生命周期函数</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:obj,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\"><span class=\"javascript\">        beforeCreate:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,<span class=\"comment\">//Hook:钩子函数</span></span></span><br><span class=\"line\"><span class=\"javascript\">        created:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        mounted:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>生命周期函数：</strong><code>beforeCreate,create,beforeMounte,mounted,beforeUpdate,updated,beforDestroy,destroyed</code></p>\n<h1 id=\"2：插值的操作\"><a href=\"#2：插值的操作\" class=\"headerlink\" title=\"2：插值的操作\"></a>2：插值的操作</h1><h2 id=\"2-1-Mustache语法，插值的操作\"><a href=\"#2-1-Mustache语法，插值的操作\" class=\"headerlink\" title=\"2.1 Mustache语法，插值的操作\"></a>2.1 Mustache语法，插值的操作</h2><p>Mustache语法：双大括号//mustache胡须</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;firstName+&#x27; &#x27;+lastName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>&#123;&#123;counter*2&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&#x27;nihao&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            firstName:<span class=\"string\">&#x27;kobe&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName:<span class=\"string\">&#x27;bryant&#x27;</span>,</span></span><br><span class=\"line\">            counter:100</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>mustache语法不仅可以直接写变量，还可以写语法。</p>\n<h2 id=\"2-2-插值操作–其他指令使用\"><a href=\"#2-2-插值操作–其他指令使用\" class=\"headerlink\" title=\"2.2 插值操作–其他指令使用\"></a>2.2 插值操作–其他指令使用</h2><ul>\n<li><strong>v-once</strong>: 不想改变DOM值，使DOM变成非响应式。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-once</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;<span class=\"comment\">&lt;!--message不会随数据更新而改变--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>v-html</strong>:直接展示html代码，而不是展示其字符串</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-html</span>=<span class=\"string\">&quot;url&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"handlebars\"><span class=\"xml\">                url=&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://www.baidu.com&quot;</span>&gt;</span>百度一下<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果：<a href=\"https://www.baidu.com/\">百度一下</a></p>\n<ul>\n<li><strong>v-text</strong>：和作用相同，但会覆盖<code>&lt;h2&gt;</code>代码块中的字符会被覆盖掉，不灵活。</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-text</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,<span class=\"comment\">//用于挂在要管理的元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">            data:&#123;<span class=\"comment\">//定义数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">                message:<span class=\"string\">&#x27;你好啊！&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)        </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>v-pre</strong>：将例如大括号显示出来，不渲染数据</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">v-pre</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>输出结果：</p>\n<ul>\n<li><strong>v-cloak</strong>：当js延迟加载出来时，不显示dom渲染之前的值。不会在渲染之前出现//cloak斗篷</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--&lt;head&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;style&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        [v-cloak]&#123;</span></span><br><span class=\"line\"><span class=\"comment\">            display:none;</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/style&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;/head&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span> <span class=\"attr\">v-cloak</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;message&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：动态绑定属性\"><a href=\"#3：动态绑定属性\" class=\"headerlink\" title=\"3：动态绑定属性\"></a>3：动态绑定属性</h1><h2 id=\"3-1-v-bind，动态绑定DOM属性\"><a href=\"#3-1-v-bind，动态绑定DOM属性\" class=\"headerlink\" title=\"3.1 v-bind，动态绑定DOM属性\"></a>3.1 v-bind，动态绑定DOM属性</h2><ul>\n<li>v-bind的基本使用</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">v-bind:src</span>=<span class=\"string\">&quot;imgURL&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">v-bind:href</span>=<span class=\"string\">&quot;aHref&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> </span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">&lt;!--语法糖的写法--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;imgURL&quot;</span> <span class=\"attr\">alt</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">&quot;aHref&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;../js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,<span class=\"comment\">//用于挂在要管理的元素</span></span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                aHref=<span class=\"string\">&quot;https://www.baidu.com&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">\t\t\t\timgURL:<span class=\"string\">&#x27;https://i0.hdslb.com/bfs/sycp/creative_img/202002/1e9bfa663a93374c8e10c3933cfc78f8.jpg&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)        </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>v-bind简写/语法糖：<code>:</code></li>\n<li>v-bind对象用法：</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;class1:isClass1,class2:isClass2&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&quot;showClassExample&quot;</span></span></span><br><span class=\"line\"><span class=\"javascript\">            isClass1:<span class=\"literal\">true</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isClass2:<span class=\"literal\">false</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>//title类固定，动态更改class1和class2</strong></p>\n<p><code>&#123;类名:布尔值,类名：布尔值&#125;</code></p>\n<ul>\n<li>v-bind数组语法</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;getClasses()&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&quot;showClassExample&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isClass1:<span class=\"literal\">true</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            isClass2:<span class=\"literal\">false</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\"><span class=\"javascript\">        \tgetClasses:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        \t\t<span class=\"keyword\">return</span>&#123;<span class=\"attr\">class1</span>:<span class=\"built_in\">this</span>.isClass1,<span class=\"attr\">class2</span>:<span class=\"built_in\">this</span>.isClass2&#125;</span></span><br><span class=\"line\">    \t\t&#125;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：v-on中函数省略了()，但v-bind需要添加()</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;[class1,class2]&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&quot;showClassExample&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            class1:<span class=\"string\">&#x27;class1&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            class2:<span class=\"string\">&#x27;class2&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-作业，结合v-for和v-bind\"><a href=\"#3-2-作业，结合v-for和v-bind\" class=\"headerlink\" title=\"3.2 作业，结合v-for和v-bind\"></a>3.2 作业，结合v-for和v-bind</h2><p>作业：使用v-for显示一个电影名称列表，设置监听点击事件，当某个电影被点击，改变此电影名称字体颜色为红色。</p>\n<p>答案：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.red</span>&#123;<span class=\"attribute\">color</span>:red&#125;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(m, index) in movies&quot;</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;clickItem=index&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;red:clickItem==index&#125;&quot;</span>&gt;</span>&#123;&#123;m&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                movies: [<span class=\"string\">&#x27;复仇者联盟&#x27;</span>, <span class=\"string\">&#x27;生化危机&#x27;</span>, <span class=\"string\">&#x27;星际大战&#x27;</span>, <span class=\"string\">&#x27;钢铁侠&#x27;</span>],</span></span><br><span class=\"line\">                clickItem:99,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-3-v-bind动态绑定样式\"><a href=\"#3-3-v-bind动态绑定样式\" class=\"headerlink\" title=\"3.3 v-bind动态绑定样式\"></a>3.3 v-bind动态绑定样式</h2><ul>\n<li>样式的对象用法</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;&#123;fontSize:&#x27;50px&#x27;,color:finalColor&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&#x27;abc&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        \tfinalColor:<span class=\"string\">&#x27;red&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：{fontSize:50px}为错误表达，50px会被解析为一个变量，50px必须加单引号</p>\n</blockquote>\n<ul>\n<li>样式的数组用法</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;[style1,style2]&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;message&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            message:<span class=\"string\">&#x27;abc&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        \tstyle1:&#123;<span class=\"attr\">fontSize</span>:<span class=\"string\">&#x27;100px&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">            style2:&#123;<span class=\"attr\">color</span>:<span class=\"string\">&#x27;red&#x27;</span>&#125;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：计算属性\"><a href=\"#4：计算属性\" class=\"headerlink\" title=\"4：计算属性\"></a>4：计算属性</h1><h2 id=\"4-1-计算属性的基本用法\"><a href=\"#4-1-计算属性的基本用法\" class=\"headerlink\" title=\"4.1 计算属性的基本用法\"></a>4.1 计算属性的基本用法</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;firstName+&quot; &quot;+lastName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;getFullName()&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;fullName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">        \tfirstName:<span class=\"string\">&#x27;Lebron&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName:<span class=\"string\">&#x27;James&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            fullName:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.fistName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"><span class=\"javascript\">        &#125;,<span class=\"comment\">//计算属性</span></span></span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">        \tgetFullName()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.fistName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>computed:计算属性的使用</strong></p>\n<h2 id=\"4-2-计算属性的复杂使用\"><a href=\"#4-2-计算属性的复杂使用\" class=\"headerlink\" title=\"4.2 计算属性的复杂使用\"></a>4.2 计算属性的复杂使用</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        总价格：&#123;&#123;totalPrice&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            books:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">110</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;Unix编程&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"number\">119</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">            \t&#123;<span class=\"attr\">id</span>:<span class=\"number\">111</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;代码大全&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"number\">89</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">        \t\t&#123;<span class=\"attr\">id</span>:<span class=\"number\">112</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;现代操作系统&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"number\">81</span>&#125;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            totalPrice:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"built_in\">this</span>.books.length;i++)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    result += <span class=\"built_in\">this</span>.books[i].price;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                /*</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">this</span>.books)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    result += <span class=\"built_in\">this</span>.books[i].price;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> book <span class=\"keyword\">of</span> <span class=\"built_in\">this</span>.books)&#123;</span></span><br><span class=\"line\">                    result += book.price;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                */</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> result;</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"><span class=\"javascript\">        &#125;,<span class=\"comment\">//计算属性</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-计算属性setter和getter\"><a href=\"#4-3-计算属性setter和getter\" class=\"headerlink\" title=\"4.3 计算属性setter和getter\"></a>4.3 计算属性setter和getter</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;fullName&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            firstName:<span class=\"string\">&#x27;Kobe&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            lastName:<span class=\"string\">&#x27;Bryant&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        computed:&#123;</span><br><span class=\"line\">            /*</span><br><span class=\"line\"><span class=\"javascript\">            fullName:&#123;<span class=\"comment\">//fullName为一个对象</span></span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"comment\">//一般属性没有set方法，为只读属性</span></span></span><br><span class=\"line\"><span class=\"javascript\">                set:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,<span class=\"comment\">//通过控制板，app.fullName=&#x27;ABC&#x27;会调用此方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.firstName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            */</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//上述方法简写为</span></span></span><br><span class=\"line\"><span class=\"javascript\">            fullName:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        \t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.firstName+<span class=\"string\">&#x27; &#x27;</span>+<span class=\"built_in\">this</span>.lastName; </span></span><br><span class=\"line\">    \t\t&#125;</span><br><span class=\"line\"><span class=\"javascript\">        &#125;,<span class=\"comment\">//计算属性</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-计算属性和methods对比\"><a href=\"#4-4-计算属性和methods对比\" class=\"headerlink\" title=\"4.4 计算属性和methods对比\"></a>4.4 计算属性和methods对比</h2><p>方法每次调用，程序都会重复执行；计算属性第一次计算出来，结果就保存在内存中。下次再调用，程序不会重复执行。</p>\n<blockquote>\n<p>需要多次调用的计算结果，采用计算属性性能会更低。</p>\n</blockquote>\n<h2 id=\"4-5-跑马灯项目\"><a href=\"#4-5-跑马灯项目\" class=\"headerlink\" title=\"4.5 跑马灯项目\"></a>4.5 跑马灯项目</h2><p>一句文字实现，点击按钮，文字滚动播放，再点击文字停止滚动。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;lang&quot;</span>&gt;</span>浪起来<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;di&quot;</span>&gt;</span>低调<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h4</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data: &#123;</span><br><span class=\"line\"><span class=\"javascript\">                msg:<span class=\"string\">&#x27;猥琐发育。别浪~~！&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                intervalId:<span class=\"literal\">null</span></span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\">                lang()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"comment\">//函数里的this.变量无法指向函数外部的变量</span></span></span><br><span class=\"line\">                    /*</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> start = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">0</span>,<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> end = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符后的所有字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">this</span>.msg=end+start;<span class=\"comment\">//将第一个字符放到最后，实现跑马灯效果</span></span></span><br><span class=\"line\">                    &#125;,400)</span><br><span class=\"line\">                     */</span><br><span class=\"line\"><span class=\"javascript\">                   <span class=\"comment\">//使用箭头函数解决函数内部this问题</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.intervalId!=<span class=\"literal\">null</span>) <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.intervalId = <span class=\"built_in\">setInterval</span>(<span class=\"function\">()=&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> start = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">0</span>,<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">let</span> end = <span class=\"built_in\">this</span>.msg.substring(<span class=\"number\">1</span>);<span class=\"comment\">//获取第一个字符后的所有字符</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">this</span>.msg=end+start;<span class=\"comment\">//将第一个字符放到最后，实现跑马灯效果</span></span></span><br><span class=\"line\">                    &#125;,400)</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                di()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.intervalId);</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">this</span>.intervalId=<span class=\"literal\">null</span>;<span class=\"comment\">//清楚定时器后需要重新把internalId设为null</span></span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"5-常用指令\"><a href=\"#5-常用指令\" class=\"headerlink\" title=\"5: 常用指令\"></a>5: 常用指令</h1><h2 id=\"5-1-v-for的四种使用方式\"><a href=\"#5-1-v-for的四种使用方式\" class=\"headerlink\" title=\"5.1 v-for的四种使用方式\"></a>5.1 v-for的四种使用方式</h2><ul>\n<li>循环数组</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;item&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in list&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;item+&quot;-----&quot;+index&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            list:[1,2,3,4,5]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>循环对象数组</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;item.id&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            list:[</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs1&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs2&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">3</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs3&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>: <span class=\"number\">4</span>, <span class=\"attr\">name</span> :<span class=\"string\">&#x27;zs4&#x27;</span>&#125;,</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>循环对象</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(val,key,index) in user&quot;</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123;val&#125;&#125;--&#123;&#123;key&#125;&#125;--&#123;&#123;index&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            user:&#123;</span><br><span class=\"line\">                id:1,</span><br><span class=\"line\"><span class=\"javascript\">                name:<span class=\"string\">&#x27;tuoni&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                gender:<span class=\"string\">&#x27;nan&#x27;</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>迭代数字</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--in后面可以使数组，对象数组，对象，还可以使数字。若为数字，count从1开始--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;count in 10&quot;</span>&gt;</span></span><br><span class=\"line\">        第&#123;&#123;count&#125;&#125;次循环</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;&#125;,   </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：count从1开始计数</strong></p>\n<ul>\n<li>v-for循环中key属性的使用</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Id:</span><br><span class=\"line\">        \t<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;id&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Name:</span><br><span class=\"line\">        \t<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;name&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span>添加<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in list&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;item.id&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span> = <span class=\"string\">&quot;checkbox&quot;</span> &gt;</span></span><br><span class=\"line\">       &#123;&#123;item.id&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            id:<span class=\"string\">&#x27;&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">            name:<span class=\"string\">&#x27;&#x27;</span>,</span></span><br><span class=\"line\">            list:[</span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">1</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;lisi&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">2</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;yinzheng&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">3</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;zhaogao&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">4</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;hanfei&#x27;</span>&#125;,</span></span><br><span class=\"line\"><span class=\"javascript\">                &#123;<span class=\"attr\">id</span>:<span class=\"number\">5</span>,<span class=\"attr\">name</span>:<span class=\"string\">&#x27;kongzi&#x27;</span>&#125;,</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">            add()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.list.push(&#123;<span class=\"attr\">id</span>:<span class=\"built_in\">this</span>.id,<span class=\"attr\">name</span>:<span class=\"built_in\">this</span>.name&#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"comment\">//this.list.unshift(&#123;id:this.id,name:this.name&#125;);</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-v-on指令\"><a href=\"#5-2-v-on指令\" class=\"headerlink\" title=\"5.2 v-on指令\"></a>5.2 v-on指令</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-on:click</span>=<span class=\"string\">&quot;show&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\">                counter:0</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\">                show()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                    alert(<span class=\"string\">&#x27;Hello&#x27;</span>);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.拿buttom元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.添加监听时间</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>事件修饰符<ul>\n<li>.stop 阻止冒泡//@click.stop设置再内部DOM。不会触发@click.stop外部DOM的点击事件</li>\n<li>.prevent 阻止默认行为//@click.prevent。比如阻止a标签跳转到href地址</li>\n<li>.capture 添加事件倾听器实现捕获模式//给外层DOM 添加@click.capture，会先处理外部点击事件。</li>\n<li>.self 只当自身被点击才触发事件//给外部DOM添加@click.self，只有点击外部DOM时才能触发它。也可阻止冒泡</li>\n<li>.once 只触发一次事件处理函数。</li>\n</ul>\n</li>\n</ul>\n<p>事件修饰符可以叠加使用 @click.prevent.once先后顺序无区别。</p>\n<h2 id=\"5-3-v-model\"><a href=\"#5-3-v-model\" class=\"headerlink\" title=\"5.3 v-model\"></a>5.3 v-model</h2><p>可以实现表单元素的model中的数据双向绑定。<strong>v-model只能用在表单元素中</strong>，input(redio, text, address, email…),select , checkbox, textarea</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;msg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>简易计算器案例</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;n1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;opt&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;+&quot;</span>&gt;</span>+<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;-&quot;</span>&gt;</span>-<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;*&quot;</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;/&quot;</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;n2&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;calculate&quot;</span>&gt;</span>=<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;result&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"keyword\">const</span> vm = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\">            n1:0,</span><br><span class=\"line\">            n2:0,</span><br><span class=\"line\">            result:0,</span><br><span class=\"line\"><span class=\"javascript\">            opt:<span class=\"string\">&#x27;+&#x27;</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\">        calculate()&#123;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">switch</span>(<span class=\"built_in\">this</span>.opt)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) + <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) - <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">        \t<span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) * <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">this</span>.result = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n1) / <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">this</span>.n2);</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">break</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">         <span class=\"comment\">//this.result = eval(this.n1+this.opt+this.n2)</span></span></span><br><span class=\"line\"><span class=\"javascript\">         <span class=\"comment\">//eval会解析字符串并执行</span></span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-4-v-if和v-show的使用\"><a href=\"#5-4-v-if和v-show的使用\" class=\"headerlink\" title=\"5.4 v-if和v-show的使用\"></a>5.4 v-if和v-show的使用</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;flag=!flag&quot;</span>&gt;</span></span><br><span class=\"line\">            切换</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h3</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&quot;flag&quot;</span>&gt;</span></span><br><span class=\"line\">            这是v-if控制的元素</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h3</span> <span class=\"attr\">v-show</span>=<span class=\"string\">&quot;flag&quot;</span>&gt;</span></span><br><span class=\"line\">            这是v-show控制的元素</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">            data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                flag:<span class=\"literal\">true</span></span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            methods:&#123;</span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//原始js</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//1.拿buttom元素</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">//2.添加监听时间</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>v-if:会删除或创建元素  //v-if消耗切换性能，如果元素设计频繁的切换不要使用。</p>\n</li>\n<li><p>v-show：不会删除DOM，而是修改其可见属性dispaly:none //如果元素可能永远也不会显示出来，最好使用v-if</p>\n</li>\n</ul>\n<h1 id=\"6：过滤器\"><a href=\"#6：过滤器\" class=\"headerlink\" title=\"6：过滤器\"></a>6：过滤器</h1><p><strong>概念</strong>：Vue.js中允许自定义过滤器，可以用作一些常见的文本格式化。过滤器可以用在两个地方：mustache插值和v-bind</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--过滤器调用格式     &#123;&#123;name | nameope&#125;&#125;--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//过滤器定义语法</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//过滤器中的function，第一个参数，永远是过滤器管道符（|）前面传过来的参数</span></span></span><br><span class=\"line\"><span class=\"javascript\">\tVue.filter(<span class=\"string\">&#x27;过滤器名称&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;&#125;)</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意:当全局和私有过滤器，使用相同名称时，优先调用私有过滤器</strong></p>\n<h2 id=\"6-1-定义全局过滤器\"><a href=\"#6-1-定义全局过滤器\" class=\"headerlink\" title=\"6.1 定义全局过滤器\"></a>6.1 定义全局过滤器</h2><p>全局过滤器，就是所有的vm实例都能用</p>\n<p>过滤器的<strong>基本使用</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123; msg | msgFormat(&#x27;牛逼&#x27;) | test&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//定义一个Vue全局过滤器</span></span></span><br><span class=\"line\"><span class=\"javascript\">    Vue.filter(<span class=\"string\">&#x27;msgFormat&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg, arg</span>)</span>&#123;<span class=\"comment\">//arg是msgFormat输入的参数。第一个为参数msg为默认的插值</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> msg.replace(<span class=\"regexp\">/傻子/g</span>,arg)<span class=\"comment\">//正则替换，g表示全部替换</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//定义多个过滤器</span></span></span><br><span class=\"line\"><span class=\"javascript\">    Vue.filter(<span class=\"string\">&#x27;test&#x27;</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> msg+<span class=\"string\">&quot;这是第二个过滤器&quot;</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-2-定义私有过滤器\"><a href=\"#6-2-定义私有过滤器\" class=\"headerlink\" title=\"6.2 定义私有过滤器\"></a>6.2 定义私有过滤器</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        &#123;&#123; msg | msgFormat(&#x27;牛逼&#x27;) | test&#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//语法糖：简写</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\">        filters:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msgFormat:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg, arg</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">return</span> msg.replace(<span class=\"regexp\">/傻子/g</span>,arg)<span class=\"comment\">//正则替换，g表示全部替换</span></span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"7：自定义\"><a href=\"#7：自定义\" class=\"headerlink\" title=\"7：自定义\"></a>7：自定义</h1><h2 id=\"7-1-自定义按键修饰符\"><a href=\"#7-1-自定义按键修饰符\" class=\"headerlink\" title=\"7.1 自定义按键修饰符\"></a>7.1 自定义按键修饰符</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Name：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;name&quot;</span> @<span class=\"attr\">keyup.enter</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>@keyup</strong>:绑定键盘</p>\n<ol>\n<li><p>内置修饰符.enter .tab .delete .esc .space .up .down .left .right</p>\n</li>\n<li><p>其他的键可使用js定义的键盘码。比如**@keyup.113**表示F12 。</p>\n</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Name：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;name&quot;</span> @<span class=\"attr\">keyup.f12</span>=<span class=\"string\">&quot;add&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t<span class=\"comment\">//自定义全局按键修饰符</span></span></span><br><span class=\"line\">    Vue.config.keyCode.f12 = 113</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"7-2-自定义指令\"><a href=\"#7-2-自定义指令\" class=\"headerlink\" title=\"7.2 自定义指令\"></a>7.2 自定义指令</h2><ol>\n<li>定义全局指令</li>\n</ol>\n<p>比如自定一个指令v-focus</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//使用Vue.directive()定义全局的指令</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//其中：参数1：指令的名称，定义的时候，不要加v-前缀。但在调用的时候必须在指令名称前加v-前缀</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">//参数2是一个对象，对象身上有一些指令相关的函数，这些函数可以在特定的阶段执行相关操作</span></span></span><br><span class=\"line\"><span class=\"javascript\">\tVue.directive(<span class=\"string\">&#x27;focus&#x27;</span>,&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        bind:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//每当指令被绑定到元素上时，会执行这个函数。只执行一次</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//第一个参数永远时el，表示被绑定了指令的那个元素，el是一个原生的JS对象。</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//在元素刚绑定了指令的时候，还没有插入到DOM中去，这时调用focus方法没有作用。</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">//el.focus</span></span></span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        inserted:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">           <span class=\"comment\">//inserted表示元素插入到dom中时执行，只执行一次</span></span></span><br><span class=\"line\">            el.focus</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        updated:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;,<span class=\"comment\">//当vNode更新的时候，会执行。可能多次触发</span></span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>.focus</strong>：JS方法，可以将焦点集中到DOM对象上，类似于，鼠标单击一次输入框。</p>\n<p>使用钩子函数参数</p>\n<ul>\n<li>el：指令绑定的元素，用来直接操作DOM</li>\n<li>binding：一个对象，包含以下属性：<ul>\n<li>name:指令名称——color</li>\n<li>value:指令的绑定值。会计算比如v-color=”1+1”，binding.value=2</li>\n<li>expression:指令绑定值，不会计算, binding.expression=’1+1’</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-color</span>=<span class=\"string\">&quot;&#x27;red&#x27;&quot;</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\tVue.directive(<span class=\"string\">&#x27;color&#x27;</span>,&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        bind:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el,binding</span>)</span>&#123;</span></span><br><span class=\"line\">            el.style.color = binding.value</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>定义私有指令</li>\n</ol>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">\t <span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;&#125;,</span><br><span class=\"line\">        filters:&#123;&#125;,</span><br><span class=\"line\">        directives:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"string\">&#x27;color&#x27;</span>:&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                bind:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el,binding</span>)</span>&#123;</span></span><br><span class=\"line\">                     el.style.color = binding.value</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>简写：</strong></p>\n<p>大多数情况下，旨在<code>bind</code>和<code>update</code>钩子上做重复动作，可以简写</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    directives:&#123;</span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"string\">&#x27;color&#x27;</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">el,binding</span>)</span>&#123;<span class=\"comment\">//等同于把方法同时写到bind和update中</span></span></span><br><span class=\"line\">                         el.style.color = binding.value</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"8：vue-resource实现get，post，jsonp请求\"><a href=\"#8：vue-resource实现get，post，jsonp请求\" class=\"headerlink\" title=\"8：vue-resource实现get，post，jsonp请求\"></a>8：vue-resource实现get，post，jsonp请求</h1><p>vue-resource依赖于vue，需要在vue.js后导入vue-resource.js包。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./js/vue-resource.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;getInfo&quot;</span>&gt;</span></span><br><span class=\"line\">            getInfo</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;postInfo&quot;</span>&gt;</span></span><br><span class=\"line\">            getInfo</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;jsonpInfo&quot;</span>&gt;</span></span><br><span class=\"line\">            getInfo</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>  </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    \t<span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Vue(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        el:<span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\">        data:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            msg:<span class=\"string\">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        methods:&#123;</span><br><span class=\"line\"><span class=\"javascript\">            getInfo()&#123;      <span class=\"built_in\">this</span>.$http.get(<span class=\"string\">&#x27;http://vue.studyit.io/api/getlunbo&#x27;</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"comment\">//result是返回的结果，包括头部、数据等</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">console</span>.log(result.body)</span></span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">             postInfo()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                 <span class=\"comment\">//手动发起的post请求没有表单数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">                 <span class=\"comment\">//通过post方法的第三个参数，设置提交内容类型为普通表单格式。</span></span></span><br><span class=\"line\"><span class=\"javascript\">                 <span class=\"built_in\">this</span>.$http.post(<span class=\"string\">&#x27;http://vue.studyit.io/api/post&#x27;</span>,&#123;&#125;,&#123;<span class=\"attr\">emulateJSON</span>:<span class=\"literal\">true</span>&#125;).then(<span class=\"function\"><span class=\"params\">result</span>=&gt;</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                     <span class=\"built_in\">console</span>.log(result.body)</span></span><br><span class=\"line\">                 &#125;),</span><br><span class=\"line\">              jsonpInfo()&#123;</span><br><span class=\"line\"><span class=\"javascript\">                     <span class=\"built_in\">this</span>.$http.jsonp(<span class=\"string\">&#x27;http://vue.studyit.io/api/jsonp&#x27;</span>).then(<span class=\"function\"><span class=\"params\">result</span>=&gt;</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                         <span class=\"built_in\">console</span>.log(result.body)</span></span><br><span class=\"line\">                     &#125;)</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">             &#125;     </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:48:20 GMT+0200 (GMT+02:00)","title":"Vue、Vuejs学习记录","path":"2020/02/15/Vue、Vuejs学习记录/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-02-15T16:31:51.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-15T16:31:51.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["Vuejs"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"利用Stunnel+Squid代理实现国内无客户端访问外网","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-05-28T21:26:23.000Z","password":null,"summary":"国内服务器使用tls协议加密代理请求，免于被GFW过滤。国外服务器代理访问。访问结果最终返回给浏览器。此方法无法解决移动过滤http请求中对youtube、fb等的访问。也就是说，移动用户无法访问youtube、fb等。最好的办法还是v2ray+ws+tls或者ssr+tls，将http请求加密。","_content":"\n# 1：加速原理\n\n## 1.1 squid介绍\n\nsquid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。\n\n按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。\n\n但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。\n\n## 1.2 Https介绍\n\n这篇文章详细介绍了加密的原理：https://blog.csdn.net/clh604/article/details/22179907\n\n![SSL](https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png)\n\n## 1.3 stunnel介绍\n\nstunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。\n\n为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。\n\n## 1.4 代理过程\n\n在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。\n\n通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图\n\n![](https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png)\n\n但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。\n\n相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。\n\n更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。\n\n\n\n# 2：主机设置代理访问\n\n为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。\n\n1. 打开`代理服务器色设置`\n\n![](https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg)\n\n2. 在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。\n\n![](https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg)\n\n3. 使用浏览器登陆google\n\n![](https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg)\n\n实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。\n\n# 3：国外服务器配置\n\n确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。\n\n## 3.1 安装配置Squid\n\n1. 安装squid\n\nubuntu使用：\n\n```shell\napt-get install squid\n```\n\ncentos使用：\n\n```\nyum install squid\n```\n\n使用`squid -v`检查squid是否安装好。\n\n2. 配置squid\n\n打开squid配置文件`/etc/squid/squid.conf`。没有就新建此文件\n\n将文件内容修改为：\n\n```shell\n# http_port 设置监听端口，默认为3128\nhttp_port 3128\n\n# access_log 设置access日志，daemon表示在后台将日志写入/var/log/squid/access.log文件, \n# combined是一个预定义的logformat，也可以使用自定义的logformat\naccess_log daemon:/var/log/squid/access.log combined\n\n# visible_hotname 设置代理服务器的主机名\n# 默认取本机的hostname\nvisible_hostname funway.aliyun.proxy\n\n# ACLs all, manager, localhost, and to_localhost are predefined.\nacl SSL_ports port 443\nacl Safe_ports port 80    # http\nacl Safe_ports port 21    # ftp\nacl Safe_ports port 443    # https\nacl Safe_ports port 70    # gopher\nacl Safe_ports port 210    # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280    # http-mgmt\nacl Safe_ports port 488    # gss-http\nacl Safe_ports port 591    # filemaker\nacl Safe_ports port 777    # multiling http\nacl CONNECT method CONNECT\n\n# 拒绝所有非Safe_ports的请求\nhttp_access deny !Safe_ports\n# 拒绝所有非SSL_prots的CONNECT请求\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n# 允许来自本地的请求\nhttp_access allow localhost\n\n# 拒绝所有请求，最后兜底的规则\nhttp_access deny all\n```\n\n更多详细的配置参数解释，请参考博文《[使用squid搭建代理服务器](https://www.hawu.me/operation/852)》\n\n配置squid只能本地地址访问。\n\n3. 运行squid\n\n```shell\nservice squid start //运行\nservice squid status //查看squid运行状态\n```\n\n## 3.2 安装配置stunnel服务端\n\n1. 生成自签名证书，如果没有openssl需要先安装。\n\n```shell\nopenssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem\n```\n\n将生成的证书，复制到/etc/stunnel文件夹下\n\n```shell\ncp stunnel.pem /etc/stunnel\n```\n\n这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。\n\n1. 下载安装stunnel\n\n```shell\napt-get install stunnel\n```\n\n2. 设置stunnel配置文件\n\n```shell\n; 设置工作目录，没有目录需要先创建\nchroot = /var/run/stunnel/\n; 设置stunnel的pid文件路径（在chroot下）\npid = /stunnel.pid\n; 设置stunnel工作的用户（组）\nsetuid = root\nsetgid = root\n\n; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)\n; 默认为5\ndebug = 7\n; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）\noutput = /stunnel.log\n\n; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）\ncert = /etc/stunnel/stunnel.pem\n; 私钥文件\nkey = /etc/stunnel/stunnel.pem\n\n; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。\n; 自定义服务名squid-proxy\n[squid-proxy]\n; 服务监听的端口，client要连接这个端口与server通信\naccept = 3129\n; 服务要连接的端口，连接到squid的3128端口，将数据发给squid\nconnect = localhost:3128\n\n; **************************************************************************\n; * 下面这些配置我都注释掉了，但也需要了解下 *\n; **************************************************************************\n\n; 设置是否对传输数据进行压缩，默认不开启。\n; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）\n;compression = zlib\n\n; 设置ssl版本,这个也是跟安装的openssl有关的\n;sslVersion = TLSv1\n\n; Authentication stuff needs to be configured to prevent MITM attacks\n; It is important to understand that this option was solely designed for access control and not for authorization\n; It is not enabled by default!\n; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，\n; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。\n; 这是有效防止中间人攻击的手段\n; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）\n; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）\n;verify = 2\n; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。\n;CAfile = /etc/stunnel/stunnel-client.pem\n```\n\n3. 启动停止stunnel\n\n```shell\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 4：国内服务器配置Stunnel客户端\n\n国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。\n\n1. 在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。\n\n本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组->防火墙->添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。\n\n2. 配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。\n\n查看开放端口，如果没有firewall，请先安装\n\n```shell\nfirewall-cmd --list-all\n```\n\n设置需要开放的端口\n\n```shell\nfirewall-cmd --zone=public --add-port=3128/tcp --permanent//设置\nfirewall-cmd --reload//生效\n```\n\n此时再查看开放的端口，就能看到3128端口已开放。\n\n3. 安装stunnel客户端。\n\nubuntu使用:\n\n```shell\napt-get install stunnel\n```\n\ncentos使用：\n\n```shell\nyum install stunnel\n```\n\n4. 设置stunnel客户端配置文件\n\n```shell\n; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建\nchroot = /var/run/stunnel/\n; stunnel工作的用户组\nsetuid = root\nsetgid = root\n; stunnel工作时候的pid\npid = /stunnel.pid\n; 日志等级\ndebug = 7\n; 日志文件\noutput = /var/log/stunnel/stunnel.log\n; 表示以client模式启动stunnel，默认client = no，即server模式\nclient = yes\n; 定义一个服务\n[squid-proxy]\n; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128\naccept = 3128\n; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器\nconnect = xx.xx.xx.xx:3129\n; 需要验证对方发过来的证书\nverify = 2\n; 用来进行证书验证的文件（里面有stunnel server的证书）\nCAfile = /etc/stunnel/stunnel-server.pem\n; 客户端不需要传递自己的证书，所以注释掉\n;cert = /etc/stunnel/stunnel.pem\n;key = /etc/stunnel/stunnel.key\n```\n\n5. 将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。\n\n配置文件里`CAfile = /etc/stunnel/stunnel-server.pem`写明了我们需要将公钥保存的位置和公钥的文件名。\n\n我们只需要将，3.2节生成的证书打开，复制已`BEGIN CERTIFICATION`开头到`END CERTIFICATION`结束的公钥。然后，新建`/etc/stunnel/stunnel-server.pem`文件，将公钥粘贴进去。\n\n这样stunnel客户端就能将数据加密后发送给stunnel服务器了。\n\n6. 启动和停止stunnel\n\n```\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 5：不足和优化\n\n## 5.1 代理方法的不足\n\n1. 由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。\n\n2. stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。\n\n## 5.2 优化\n\n1. 配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid\n\n- 修改配置文件`/etc/squid/squid.conf`，在`http_access deny all`之前追加以下内容，并注释掉`http_access allow localhost`\n\n```shell\n# auth_param 设置代理的认证方式\n# 用法：auth_param scheme parameter [setting]\n# scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制\n\n# program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。\nauth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd\n# children 设置后台启动几个认证程序进程\nauth_param basic children 3\n# credentialsttl 设置认证失效时间，过期后需重新认证\nauth_param basic credentialsttl 10 hours\n# realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”\nauth_param basic realm welecome to using my proxy\n\n\n# ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access\n\n# 添加名为AuthUsers访问列表，表示通过认证的用户\nacl AuthUsers proxy_auth REQUIRED\n# 允许AuthUsers的代理请求\nhttp_access allow AuthUsers\n```\n\n- 新建密码文件\n\n```shell\nhtpasswd -c /etc/squid/passwd qifei\n```\n\n如果没有htpasswd，则按提示安装。输入密码即可。\n\n- 重启squid\n\n```shell\nservice squid restart\n```\n\n2. 添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。\n\n# 6：问题和调试\n\n## 6.1 国内squid能接通，但无法访问网络\n\n这可能是服务器端口没开\n\n```\nhttp://port.ping.pe/xx.xx.xx.xx:port\n```\n\n将上述网址，修改ip地址和端口后，通过浏览器打开，看看服务器端口是否能够接通，如果显示failed，那么参照第四章内容，安装firewald，并打开对应端口。\n\n## 6.2 中国移动只能访问谷歌而无法访问YouTube\n\n### 5.30日更新：\n\n在经过一段时间的使用后，上种方法存在一些弊端。\n\n在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。\n\n利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url`youtube.com`。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。\n\n而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。\n\n之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。\n\n查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。\n\n在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。\n\n因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。\n\n最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。\n\n这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。\n\n### 5.31日更新：\n\n我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。\n\n我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。\n\n我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。\n\n猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。\n\n**结论**，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。\n\n这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。\n\n通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。\n\n而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。\n\n总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。\n\n## 6.3 使用用户名和密码手机软件不能弹出登陆框\n\n在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。\n\n### 方法1：完全开放代理\n\n修改`squid.conf`关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。\n\n### 方法2：IP限制\n\n在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。\n\n完整拓扑结构：用户主机->squid（国内）->stunnel（国内）->stunnel（国外）->squid（国外）->网站服务器\n\n添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。\n\n### 方法3：网页验证加自定义ACL辅助器验证\n\n第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。\n\n**设计思路**\n\n1. 用户设置ip和端口，无密码连接代理服务器。\n2. 用户打开浏览器，访问任意网页\n3. 利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。\n4. 网页后台验证用户输入的用户名和密码。并保存用户ip。\n5. 编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。\n\n### 方法4：自定义验证器加ACL辅助器验证\n\n第一次登陆，弹出代理登陆框，通过后保存ip\n\n1. 用户设置ip和端口，连接代理服务器。\n2. 代理服务器通过ACL辅助器验证此IP是否在白名单中。\n3. 不在白名单则，进入自定义验证器，在，则通过代理。\n4. 进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。\n\n我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。","source":"_posts/利用Stunnel+squid代理实现国内无客户端访问外网.md","raw":"---\ntitle: 利用Stunnel+Squid代理实现国内无客户端访问外网\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-05-28 23:26:23\npassword:\nsummary: 国内服务器使用tls协议加密代理请求，免于被GFW过滤。国外服务器代理访问。访问结果最终返回给浏览器。此方法无法解决移动过滤http请求中对youtube、fb等的访问。也就是说，移动用户无法访问youtube、fb等。最好的办法还是v2ray+ws+tls或者ssr+tls，将http请求加密。\ntags: \n - Stunnel\n - Squid\ncategories: Linux\n---\n\n# 1：加速原理\n\n## 1.1 squid介绍\n\nsquid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。\n\n按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。\n\n但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。\n\n## 1.2 Https介绍\n\n这篇文章详细介绍了加密的原理：https://blog.csdn.net/clh604/article/details/22179907\n\n![SSL](https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png)\n\n## 1.3 stunnel介绍\n\nstunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。\n\n为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。\n\n## 1.4 代理过程\n\n在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。\n\n通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图\n\n![](https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png)\n\n但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。\n\n相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。\n\n更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。\n\n\n\n# 2：主机设置代理访问\n\n为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。\n\n1. 打开`代理服务器色设置`\n\n![](https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg)\n\n2. 在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。\n\n![](https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg)\n\n3. 使用浏览器登陆google\n\n![](https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg)\n\n实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。\n\n# 3：国外服务器配置\n\n确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。\n\n## 3.1 安装配置Squid\n\n1. 安装squid\n\nubuntu使用：\n\n```shell\napt-get install squid\n```\n\ncentos使用：\n\n```\nyum install squid\n```\n\n使用`squid -v`检查squid是否安装好。\n\n2. 配置squid\n\n打开squid配置文件`/etc/squid/squid.conf`。没有就新建此文件\n\n将文件内容修改为：\n\n```shell\n# http_port 设置监听端口，默认为3128\nhttp_port 3128\n\n# access_log 设置access日志，daemon表示在后台将日志写入/var/log/squid/access.log文件, \n# combined是一个预定义的logformat，也可以使用自定义的logformat\naccess_log daemon:/var/log/squid/access.log combined\n\n# visible_hotname 设置代理服务器的主机名\n# 默认取本机的hostname\nvisible_hostname funway.aliyun.proxy\n\n# ACLs all, manager, localhost, and to_localhost are predefined.\nacl SSL_ports port 443\nacl Safe_ports port 80    # http\nacl Safe_ports port 21    # ftp\nacl Safe_ports port 443    # https\nacl Safe_ports port 70    # gopher\nacl Safe_ports port 210    # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280    # http-mgmt\nacl Safe_ports port 488    # gss-http\nacl Safe_ports port 591    # filemaker\nacl Safe_ports port 777    # multiling http\nacl CONNECT method CONNECT\n\n# 拒绝所有非Safe_ports的请求\nhttp_access deny !Safe_ports\n# 拒绝所有非SSL_prots的CONNECT请求\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n# 允许来自本地的请求\nhttp_access allow localhost\n\n# 拒绝所有请求，最后兜底的规则\nhttp_access deny all\n```\n\n更多详细的配置参数解释，请参考博文《[使用squid搭建代理服务器](https://www.hawu.me/operation/852)》\n\n配置squid只能本地地址访问。\n\n3. 运行squid\n\n```shell\nservice squid start //运行\nservice squid status //查看squid运行状态\n```\n\n## 3.2 安装配置stunnel服务端\n\n1. 生成自签名证书，如果没有openssl需要先安装。\n\n```shell\nopenssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem\n```\n\n将生成的证书，复制到/etc/stunnel文件夹下\n\n```shell\ncp stunnel.pem /etc/stunnel\n```\n\n这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。\n\n1. 下载安装stunnel\n\n```shell\napt-get install stunnel\n```\n\n2. 设置stunnel配置文件\n\n```shell\n; 设置工作目录，没有目录需要先创建\nchroot = /var/run/stunnel/\n; 设置stunnel的pid文件路径（在chroot下）\npid = /stunnel.pid\n; 设置stunnel工作的用户（组）\nsetuid = root\nsetgid = root\n\n; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)\n; 默认为5\ndebug = 7\n; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）\noutput = /stunnel.log\n\n; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）\ncert = /etc/stunnel/stunnel.pem\n; 私钥文件\nkey = /etc/stunnel/stunnel.pem\n\n; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。\n; 自定义服务名squid-proxy\n[squid-proxy]\n; 服务监听的端口，client要连接这个端口与server通信\naccept = 3129\n; 服务要连接的端口，连接到squid的3128端口，将数据发给squid\nconnect = localhost:3128\n\n; **************************************************************************\n; * 下面这些配置我都注释掉了，但也需要了解下 *\n; **************************************************************************\n\n; 设置是否对传输数据进行压缩，默认不开启。\n; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）\n;compression = zlib\n\n; 设置ssl版本,这个也是跟安装的openssl有关的\n;sslVersion = TLSv1\n\n; Authentication stuff needs to be configured to prevent MITM attacks\n; It is important to understand that this option was solely designed for access control and not for authorization\n; It is not enabled by default!\n; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，\n; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。\n; 这是有效防止中间人攻击的手段\n; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）\n; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）\n;verify = 2\n; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。\n;CAfile = /etc/stunnel/stunnel-client.pem\n```\n\n3. 启动停止stunnel\n\n```shell\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 4：国内服务器配置Stunnel客户端\n\n国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。\n\n1. 在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。\n\n本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组->防火墙->添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。\n\n2. 配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。\n\n查看开放端口，如果没有firewall，请先安装\n\n```shell\nfirewall-cmd --list-all\n```\n\n设置需要开放的端口\n\n```shell\nfirewall-cmd --zone=public --add-port=3128/tcp --permanent//设置\nfirewall-cmd --reload//生效\n```\n\n此时再查看开放的端口，就能看到3128端口已开放。\n\n3. 安装stunnel客户端。\n\nubuntu使用:\n\n```shell\napt-get install stunnel\n```\n\ncentos使用：\n\n```shell\nyum install stunnel\n```\n\n4. 设置stunnel客户端配置文件\n\n```shell\n; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建\nchroot = /var/run/stunnel/\n; stunnel工作的用户组\nsetuid = root\nsetgid = root\n; stunnel工作时候的pid\npid = /stunnel.pid\n; 日志等级\ndebug = 7\n; 日志文件\noutput = /var/log/stunnel/stunnel.log\n; 表示以client模式启动stunnel，默认client = no，即server模式\nclient = yes\n; 定义一个服务\n[squid-proxy]\n; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128\naccept = 3128\n; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器\nconnect = xx.xx.xx.xx:3129\n; 需要验证对方发过来的证书\nverify = 2\n; 用来进行证书验证的文件（里面有stunnel server的证书）\nCAfile = /etc/stunnel/stunnel-server.pem\n; 客户端不需要传递自己的证书，所以注释掉\n;cert = /etc/stunnel/stunnel.pem\n;key = /etc/stunnel/stunnel.key\n```\n\n5. 将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。\n\n配置文件里`CAfile = /etc/stunnel/stunnel-server.pem`写明了我们需要将公钥保存的位置和公钥的文件名。\n\n我们只需要将，3.2节生成的证书打开，复制已`BEGIN CERTIFICATION`开头到`END CERTIFICATION`结束的公钥。然后，新建`/etc/stunnel/stunnel-server.pem`文件，将公钥粘贴进去。\n\n这样stunnel客户端就能将数据加密后发送给stunnel服务器了。\n\n6. 启动和停止stunnel\n\n```\nservice stunnel start //开启stunnel\nservice stunnel restart //重启\nservice stunnel stop //停止\nservice stunnel status  //查看状态\n```\n\n# 5：不足和优化\n\n## 5.1 代理方法的不足\n\n1. 由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。\n\n2. stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。\n\n## 5.2 优化\n\n1. 配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid\n\n- 修改配置文件`/etc/squid/squid.conf`，在`http_access deny all`之前追加以下内容，并注释掉`http_access allow localhost`\n\n```shell\n# auth_param 设置代理的认证方式\n# 用法：auth_param scheme parameter [setting]\n# scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制\n\n# program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。\nauth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd\n# children 设置后台启动几个认证程序进程\nauth_param basic children 3\n# credentialsttl 设置认证失效时间，过期后需重新认证\nauth_param basic credentialsttl 10 hours\n# realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”\nauth_param basic realm welecome to using my proxy\n\n\n# ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access\n\n# 添加名为AuthUsers访问列表，表示通过认证的用户\nacl AuthUsers proxy_auth REQUIRED\n# 允许AuthUsers的代理请求\nhttp_access allow AuthUsers\n```\n\n- 新建密码文件\n\n```shell\nhtpasswd -c /etc/squid/passwd qifei\n```\n\n如果没有htpasswd，则按提示安装。输入密码即可。\n\n- 重启squid\n\n```shell\nservice squid restart\n```\n\n2. 添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。\n\n# 6：问题和调试\n\n## 6.1 国内squid能接通，但无法访问网络\n\n这可能是服务器端口没开\n\n```\nhttp://port.ping.pe/xx.xx.xx.xx:port\n```\n\n将上述网址，修改ip地址和端口后，通过浏览器打开，看看服务器端口是否能够接通，如果显示failed，那么参照第四章内容，安装firewald，并打开对应端口。\n\n## 6.2 中国移动只能访问谷歌而无法访问YouTube\n\n### 5.30日更新：\n\n在经过一段时间的使用后，上种方法存在一些弊端。\n\n在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。\n\n利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url`youtube.com`。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。\n\n而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。\n\n之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。\n\n查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。\n\n在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。\n\n因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。\n\n最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。\n\n这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。\n\n### 5.31日更新：\n\n我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。\n\n我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。\n\n我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。\n\n猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。\n\n**结论**，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。\n\n这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。\n\n通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。\n\n而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。\n\n总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。\n\n## 6.3 使用用户名和密码手机软件不能弹出登陆框\n\n在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。\n\n### 方法1：完全开放代理\n\n修改`squid.conf`关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。\n\n### 方法2：IP限制\n\n在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。\n\n完整拓扑结构：用户主机->squid（国内）->stunnel（国内）->stunnel（国外）->squid（国外）->网站服务器\n\n添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。\n\n### 方法3：网页验证加自定义ACL辅助器验证\n\n第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。\n\n**设计思路**\n\n1. 用户设置ip和端口，无密码连接代理服务器。\n2. 用户打开浏览器，访问任意网页\n3. 利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。\n4. 网页后台验证用户输入的用户名和密码。并保存用户ip。\n5. 编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。\n\n### 方法4：自定义验证器加ACL辅助器验证\n\n第一次登陆，弹出代理登陆框，通过后保存ip\n\n1. 用户设置ip和端口，连接代理服务器。\n2. 代理服务器通过ACL辅助器验证此IP是否在白名单中。\n3. 不在白名单则，进入自定义验证器，在，则通过代理。\n4. 进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。\n\n我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。","slug":"利用Stunnel+squid代理实现国内无客户端访问外网","published":1,"updated":"2020-11-15T08:59:47.964Z","_id":"ckgaxsaeu006kp0vz89hg23gy","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1：加速原理\"><a href=\"#1：加速原理\" class=\"headerlink\" title=\"1：加速原理\"></a>1：加速原理</h1><h2 id=\"1-1-squid介绍\"><a href=\"#1-1-squid介绍\" class=\"headerlink\" title=\"1.1 squid介绍\"></a>1.1 squid介绍</h2><p>squid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。</p>\n<p>按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。</p>\n<p>但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。</p>\n<h2 id=\"1-2-Https介绍\"><a href=\"#1-2-Https介绍\" class=\"headerlink\" title=\"1.2 Https介绍\"></a>1.2 Https介绍</h2><p>这篇文章详细介绍了加密的原理：<a href=\"https://blog.csdn.net/clh604/article/details/22179907\">https://blog.csdn.net/clh604/article/details/22179907</a></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"SSL\"></p>\n<h2 id=\"1-3-stunnel介绍\"><a href=\"#1-3-stunnel介绍\" class=\"headerlink\" title=\"1.3 stunnel介绍\"></a>1.3 stunnel介绍</h2><p>stunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。</p>\n<p>为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。</p>\n<h2 id=\"1-4-代理过程\"><a href=\"#1-4-代理过程\" class=\"headerlink\" title=\"1.4 代理过程\"></a>1.4 代理过程</h2><p>在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。</p>\n<p>通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。</p>\n<p>相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。</p>\n<p>更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。</p>\n<h1 id=\"2：主机设置代理访问\"><a href=\"#2：主机设置代理访问\" class=\"headerlink\" title=\"2：主机设置代理访问\"></a>2：主机设置代理访问</h1><p>为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。</p>\n<ol>\n<li>打开<code>代理服务器色设置</code></li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"2\">\n<li>在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li>使用浏览器登陆google</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg\" class=\"lazyload\" data-srcset=\"https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。</p>\n<h1 id=\"3：国外服务器配置\"><a href=\"#3：国外服务器配置\" class=\"headerlink\" title=\"3：国外服务器配置\"></a>3：国外服务器配置</h1><p>确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。</p>\n<h2 id=\"3-1-安装配置Squid\"><a href=\"#3-1-安装配置Squid\" class=\"headerlink\" title=\"3.1 安装配置Squid\"></a>3.1 安装配置Squid</h2><ol>\n<li>安装squid</li>\n</ol>\n<p>ubuntu使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install squid</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install squid</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>squid -v</code>检查squid是否安装好。</p>\n<ol start=\"2\">\n<li>配置squid</li>\n</ol>\n<p>打开squid配置文件<code>/etc/squid/squid.conf</code>。没有就新建此文件</p>\n<p>将文件内容修改为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> http_port 设置监听端口，默认为3128</span></span><br><span class=\"line\">http_port 3128</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class=\"built_in\">log</span>/squid/access.log文件, </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class=\"line\">access_log daemon:/var/log/squid/access.log combined</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> visible_hotname 设置代理服务器的主机名</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 默认取本机的hostname</span></span><br><span class=\"line\">visible_hostname funway.aliyun.proxy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80    # http</span><br><span class=\"line\">acl Safe_ports port 21    # ftp</span><br><span class=\"line\">acl Safe_ports port 443    # https</span><br><span class=\"line\">acl Safe_ports port 70    # gopher</span><br><span class=\"line\">acl Safe_ports port 210    # wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280    # http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488    # gss-http</span><br><span class=\"line\">acl Safe_ports port 591    # filemaker</span><br><span class=\"line\">acl Safe_ports port 777    # multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非Safe_ports的请求</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Only allow cachemgr access from localhost</span></span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\">http_access deny manager</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许来自本地的请求</span></span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有请求，最后兜底的规则</span></span><br><span class=\"line\">http_access deny all</span><br></pre></td></tr></table></figure>\n\n<p>更多详细的配置参数解释，请参考博文《<a href=\"https://www.hawu.me/operation/852\">使用squid搭建代理服务器</a>》</p>\n<p>配置squid只能本地地址访问。</p>\n<ol start=\"3\">\n<li>运行squid</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid start //运行</span><br><span class=\"line\">service squid status //查看squid运行状态</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-安装配置stunnel服务端\"><a href=\"#3-2-安装配置stunnel服务端\" class=\"headerlink\" title=\"3.2 安装配置stunnel服务端\"></a>3.2 安装配置stunnel服务端</h2><ol>\n<li>生成自签名证书，如果没有openssl需要先安装。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure>\n\n<p>将生成的证书，复制到/etc/stunnel文件夹下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp stunnel.pem /etc/stunnel</span><br></pre></td></tr></table></figure>\n\n<p>这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。</p>\n<ol>\n<li>下载安装stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>设置stunnel配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; 设置工作目录，没有目录需要先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; 设置stunnel的pid文件路径（在chroot下）</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 设置stunnel工作的用户（组）</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\"></span><br><span class=\"line\">; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)</span><br><span class=\"line\">; 默认为5</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）</span><br><span class=\"line\">output = /stunnel.log</span><br><span class=\"line\"></span><br><span class=\"line\">; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）</span><br><span class=\"line\">cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">; 私钥文件</span><br><span class=\"line\">key = /etc/stunnel/stunnel.pem</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。</span><br><span class=\"line\">; 自定义服务名squid-proxy</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class=\"line\">accept = 3129</span><br><span class=\"line\">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class=\"line\">connect = localhost:3128</span><br><span class=\"line\"></span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\">; * 下面这些配置我都注释掉了，但也需要了解下 *</span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置是否对传输数据进行压缩，默认不开启。</span><br><span class=\"line\">; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）</span><br><span class=\"line\">;compression = zlib</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置ssl版本,这个也是跟安装的openssl有关的</span><br><span class=\"line\">;sslVersion = TLSv1</span><br><span class=\"line\"></span><br><span class=\"line\">; Authentication stuff needs to be configured to prevent MITM attacks</span><br><span class=\"line\">; It is important to understand that this option was solely designed for access control and not for authorization</span><br><span class=\"line\">; It is not enabled by default!</span><br><span class=\"line\">; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，</span><br><span class=\"line\">; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。</span><br><span class=\"line\">; 这是有效防止中间人攻击的手段</span><br><span class=\"line\">; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）</span><br><span class=\"line\">; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）</span><br><span class=\"line\">;verify = 2</span><br><span class=\"line\">; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。</span><br><span class=\"line\">;CAfile = /etc/stunnel/stunnel-client.pem</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>启动停止stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start //开启stunnel</span><br><span class=\"line\">service stunnel restart //重启</span><br><span class=\"line\">service stunnel stop //停止</span><br><span class=\"line\">service stunnel status  //查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：国内服务器配置Stunnel客户端\"><a href=\"#4：国内服务器配置Stunnel客户端\" class=\"headerlink\" title=\"4：国内服务器配置Stunnel客户端\"></a>4：国内服务器配置Stunnel客户端</h1><p>国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。</p>\n<ol>\n<li>在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。</li>\n</ol>\n<p>本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组-&gt;防火墙-&gt;添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。</p>\n<ol start=\"2\">\n<li>配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。</li>\n</ol>\n<p>查看开放端口，如果没有firewall，请先安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n\n<p>设置需要开放的端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=3128/tcp --permanent//设置</span><br><span class=\"line\">firewall-cmd --reload//生效</span><br></pre></td></tr></table></figure>\n\n<p>此时再查看开放的端口，就能看到3128端口已开放。</p>\n<ol start=\"3\">\n<li>安装stunnel客户端。</li>\n</ol>\n<p>ubuntu使用:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>设置stunnel客户端配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; stunnel工作的用户组</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\">; stunnel工作时候的pid</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 日志等级</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件</span><br><span class=\"line\">output = /var/log/stunnel/stunnel.log</span><br><span class=\"line\">; 表示以client模式启动stunnel，默认client = no，即server模式</span><br><span class=\"line\">client = yes</span><br><span class=\"line\">; 定义一个服务</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class=\"line\">accept = 3128</span><br><span class=\"line\">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class=\"line\">connect = xx.xx.xx.xx:3129</span><br><span class=\"line\">; 需要验证对方发过来的证书</span><br><span class=\"line\">verify = 2</span><br><span class=\"line\">; 用来进行证书验证的文件（里面有stunnel server的证书）</span><br><span class=\"line\">CAfile = /etc/stunnel/stunnel-server.pem</span><br><span class=\"line\">; 客户端不需要传递自己的证书，所以注释掉</span><br><span class=\"line\">;cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">;key = /etc/stunnel/stunnel.key</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。</li>\n</ol>\n<p>配置文件里<code>CAfile = /etc/stunnel/stunnel-server.pem</code>写明了我们需要将公钥保存的位置和公钥的文件名。</p>\n<p>我们只需要将，3.2节生成的证书打开，复制已<code>BEGIN CERTIFICATION</code>开头到<code>END CERTIFICATION</code>结束的公钥。然后，新建<code>/etc/stunnel/stunnel-server.pem</code>文件，将公钥粘贴进去。</p>\n<p>这样stunnel客户端就能将数据加密后发送给stunnel服务器了。</p>\n<ol start=\"6\">\n<li>启动和停止stunnel</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start &#x2F;&#x2F;开启stunnel</span><br><span class=\"line\">service stunnel restart &#x2F;&#x2F;重启</span><br><span class=\"line\">service stunnel stop &#x2F;&#x2F;停止</span><br><span class=\"line\">service stunnel status  &#x2F;&#x2F;查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：不足和优化\"><a href=\"#5：不足和优化\" class=\"headerlink\" title=\"5：不足和优化\"></a>5：不足和优化</h1><h2 id=\"5-1-代理方法的不足\"><a href=\"#5-1-代理方法的不足\" class=\"headerlink\" title=\"5.1 代理方法的不足\"></a>5.1 代理方法的不足</h2><ol>\n<li><p>由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。</p>\n</li>\n<li><p>stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。</p>\n</li>\n</ol>\n<h2 id=\"5-2-优化\"><a href=\"#5-2-优化\" class=\"headerlink\" title=\"5.2 优化\"></a>5.2 优化</h2><ol>\n<li>配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid</li>\n</ol>\n<ul>\n<li>修改配置文件<code>/etc/squid/squid.conf</code>，在<code>http_access deny all</code>之前追加以下内容，并注释掉<code>http_access allow localhost</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> auth_param 设置代理的认证方式</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 用法：auth_param scheme parameter [setting]</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。</span></span><br><span class=\"line\">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> children 设置后台启动几个认证程序进程</span></span><br><span class=\"line\">auth_param basic children 3</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> credentialsttl 设置认证失效时间，过期后需重新认证</span></span><br><span class=\"line\">auth_param basic credentialsttl 10 hours</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”</span></span><br><span class=\"line\">auth_param basic realm welecome to using my proxy</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 添加名为AuthUsers访问列表，表示通过认证的用户</span></span><br><span class=\"line\">acl AuthUsers proxy_auth REQUIRED</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许AuthUsers的代理请求</span></span><br><span class=\"line\">http_access allow AuthUsers</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>新建密码文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">htpasswd -c /etc/squid/passwd qifei</span><br></pre></td></tr></table></figure>\n\n<p>如果没有htpasswd，则按提示安装。输入密码即可。</p>\n<ul>\n<li>重启squid</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid restart</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。</li>\n</ol>\n<h1 id=\"6：问题和调试\"><a href=\"#6：问题和调试\" class=\"headerlink\" title=\"6：问题和调试\"></a>6：问题和调试</h1><h2 id=\"6-1-国内squid能接通，但无法访问网络\"><a href=\"#6-1-国内squid能接通，但无法访问网络\" class=\"headerlink\" title=\"6.1 国内squid能接通，但无法访问网络\"></a>6.1 国内squid能接通，但无法访问网络</h2><p>这可能是服务器端口没开</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;port.ping.pe&#x2F;xx.xx.xx.xx:port</span><br></pre></td></tr></table></figure>\n\n<p>将上述网址，修改ip地址和端口后，通过浏览器打开，看看服务器端口是否能够接通，如果显示failed，那么参照第四章内容，安装firewald，并打开对应端口。</p>\n<h2 id=\"6-2-中国移动只能访问谷歌而无法访问YouTube\"><a href=\"#6-2-中国移动只能访问谷歌而无法访问YouTube\" class=\"headerlink\" title=\"6.2 中国移动只能访问谷歌而无法访问YouTube\"></a>6.2 中国移动只能访问谷歌而无法访问YouTube</h2><h3 id=\"5-30日更新：\"><a href=\"#5-30日更新：\" class=\"headerlink\" title=\"5.30日更新：\"></a>5.30日更新：</h3><p>在经过一段时间的使用后，上种方法存在一些弊端。</p>\n<p>在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。</p>\n<p>利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url<code>youtube.com</code>。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。</p>\n<p>而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。</p>\n<p>之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。</p>\n<p>查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。</p>\n<p>在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。</p>\n<p>因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。</p>\n<p>最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。</p>\n<p>这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。</p>\n<h3 id=\"5-31日更新：\"><a href=\"#5-31日更新：\" class=\"headerlink\" title=\"5.31日更新：\"></a>5.31日更新：</h3><p>我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。</p>\n<p>我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。</p>\n<p>我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。</p>\n<p>猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。</p>\n<p><strong>结论</strong>，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。</p>\n<p>这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。</p>\n<p>通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。</p>\n<p>而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。</p>\n<p>总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。</p>\n<h2 id=\"6-3-使用用户名和密码手机软件不能弹出登陆框\"><a href=\"#6-3-使用用户名和密码手机软件不能弹出登陆框\" class=\"headerlink\" title=\"6.3 使用用户名和密码手机软件不能弹出登陆框\"></a>6.3 使用用户名和密码手机软件不能弹出登陆框</h2><p>在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。</p>\n<h3 id=\"方法1：完全开放代理\"><a href=\"#方法1：完全开放代理\" class=\"headerlink\" title=\"方法1：完全开放代理\"></a>方法1：完全开放代理</h3><p>修改<code>squid.conf</code>关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。</p>\n<h3 id=\"方法2：IP限制\"><a href=\"#方法2：IP限制\" class=\"headerlink\" title=\"方法2：IP限制\"></a>方法2：IP限制</h3><p>在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。</p>\n<p>完整拓扑结构：用户主机-&gt;squid（国内）-&gt;stunnel（国内）-&gt;stunnel（国外）-&gt;squid（国外）-&gt;网站服务器</p>\n<p>添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。</p>\n<h3 id=\"方法3：网页验证加自定义ACL辅助器验证\"><a href=\"#方法3：网页验证加自定义ACL辅助器验证\" class=\"headerlink\" title=\"方法3：网页验证加自定义ACL辅助器验证\"></a>方法3：网页验证加自定义ACL辅助器验证</h3><p>第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。</p>\n<p><strong>设计思路</strong></p>\n<ol>\n<li>用户设置ip和端口，无密码连接代理服务器。</li>\n<li>用户打开浏览器，访问任意网页</li>\n<li>利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。</li>\n<li>网页后台验证用户输入的用户名和密码。并保存用户ip。</li>\n<li>编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。</li>\n</ol>\n<h3 id=\"方法4：自定义验证器加ACL辅助器验证\"><a href=\"#方法4：自定义验证器加ACL辅助器验证\" class=\"headerlink\" title=\"方法4：自定义验证器加ACL辅助器验证\"></a>方法4：自定义验证器加ACL辅助器验证</h3><p>第一次登陆，弹出代理登陆框，通过后保存ip</p>\n<ol>\n<li>用户设置ip和端口，连接代理服务器。</li>\n<li>代理服务器通过ACL辅助器验证此IP是否在白名单中。</li>\n<li>不在白名单则，进入自定义验证器，在，则通过代理。</li>\n<li>进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。</li>\n</ol>\n<p>我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：加速原理\"><a href=\"#1：加速原理\" class=\"headerlink\" title=\"1：加速原理\"></a>1：加速原理</h1><h2 id=\"1-1-squid介绍\"><a href=\"#1-1-squid介绍\" class=\"headerlink\" title=\"1.1 squid介绍\"></a>1.1 squid介绍</h2><p>squid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。</p>\n<p>按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。</p>\n<p>但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。</p>\n<h2 id=\"1-2-Https介绍\"><a href=\"#1-2-Https介绍\" class=\"headerlink\" title=\"1.2 Https介绍\"></a>1.2 Https介绍</h2><p>这篇文章详细介绍了加密的原理：<a href=\"https://blog.csdn.net/clh604/article/details/22179907\">https://blog.csdn.net/clh604/article/details/22179907</a></p>\n<p><img src=\"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png\" alt=\"SSL\"></p>\n<h2 id=\"1-3-stunnel介绍\"><a href=\"#1-3-stunnel介绍\" class=\"headerlink\" title=\"1.3 stunnel介绍\"></a>1.3 stunnel介绍</h2><p>stunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。</p>\n<p>为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。</p>\n<h2 id=\"1-4-代理过程\"><a href=\"#1-4-代理过程\" class=\"headerlink\" title=\"1.4 代理过程\"></a>1.4 代理过程</h2><p>在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。</p>\n<p>通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图</p>\n<p><img src=\"https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png\"></p>\n<p>但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。</p>\n<p>相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。</p>\n<p>更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。</p>\n<h1 id=\"2：主机设置代理访问\"><a href=\"#2：主机设置代理访问\" class=\"headerlink\" title=\"2：主机设置代理访问\"></a>2：主机设置代理访问</h1><p>为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。</p>\n<ol>\n<li>打开<code>代理服务器色设置</code></li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg\"></p>\n<ol start=\"2\">\n<li>在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg\"></p>\n<ol start=\"3\">\n<li>使用浏览器登陆google</li>\n</ol>\n<p><img src=\"https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg\"></p>\n<p>实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。</p>\n<h1 id=\"3：国外服务器配置\"><a href=\"#3：国外服务器配置\" class=\"headerlink\" title=\"3：国外服务器配置\"></a>3：国外服务器配置</h1><p>确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。</p>\n<h2 id=\"3-1-安装配置Squid\"><a href=\"#3-1-安装配置Squid\" class=\"headerlink\" title=\"3.1 安装配置Squid\"></a>3.1 安装配置Squid</h2><ol>\n<li>安装squid</li>\n</ol>\n<p>ubuntu使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install squid</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install squid</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>squid -v</code>检查squid是否安装好。</p>\n<ol start=\"2\">\n<li>配置squid</li>\n</ol>\n<p>打开squid配置文件<code>/etc/squid/squid.conf</code>。没有就新建此文件</p>\n<p>将文件内容修改为：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> http_port 设置监听端口，默认为3128</span></span><br><span class=\"line\">http_port 3128</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class=\"built_in\">log</span>/squid/access.log文件, </span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class=\"line\">access_log daemon:/var/log/squid/access.log combined</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> visible_hotname 设置代理服务器的主机名</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 默认取本机的hostname</span></span><br><span class=\"line\">visible_hostname funway.aliyun.proxy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80    # http</span><br><span class=\"line\">acl Safe_ports port 21    # ftp</span><br><span class=\"line\">acl Safe_ports port 443    # https</span><br><span class=\"line\">acl Safe_ports port 70    # gopher</span><br><span class=\"line\">acl Safe_ports port 210    # wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280    # http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488    # gss-http</span><br><span class=\"line\">acl Safe_ports port 591    # filemaker</span><br><span class=\"line\">acl Safe_ports port 777    # multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非Safe_ports的请求</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Only allow cachemgr access from localhost</span></span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\">http_access deny manager</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许来自本地的请求</span></span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拒绝所有请求，最后兜底的规则</span></span><br><span class=\"line\">http_access deny all</span><br></pre></td></tr></table></figure>\n\n<p>更多详细的配置参数解释，请参考博文《<a href=\"https://www.hawu.me/operation/852\">使用squid搭建代理服务器</a>》</p>\n<p>配置squid只能本地地址访问。</p>\n<ol start=\"3\">\n<li>运行squid</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid start //运行</span><br><span class=\"line\">service squid status //查看squid运行状态</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-安装配置stunnel服务端\"><a href=\"#3-2-安装配置stunnel服务端\" class=\"headerlink\" title=\"3.2 安装配置stunnel服务端\"></a>3.2 安装配置stunnel服务端</h2><ol>\n<li>生成自签名证书，如果没有openssl需要先安装。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure>\n\n<p>将生成的证书，复制到/etc/stunnel文件夹下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp stunnel.pem /etc/stunnel</span><br></pre></td></tr></table></figure>\n\n<p>这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。</p>\n<ol>\n<li>下载安装stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>设置stunnel配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; 设置工作目录，没有目录需要先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; 设置stunnel的pid文件路径（在chroot下）</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 设置stunnel工作的用户（组）</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\"></span><br><span class=\"line\">; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)</span><br><span class=\"line\">; 默认为5</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）</span><br><span class=\"line\">output = /stunnel.log</span><br><span class=\"line\"></span><br><span class=\"line\">; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）</span><br><span class=\"line\">cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">; 私钥文件</span><br><span class=\"line\">key = /etc/stunnel/stunnel.pem</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。</span><br><span class=\"line\">; 自定义服务名squid-proxy</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class=\"line\">accept = 3129</span><br><span class=\"line\">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class=\"line\">connect = localhost:3128</span><br><span class=\"line\"></span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\">; * 下面这些配置我都注释掉了，但也需要了解下 *</span><br><span class=\"line\">; **************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置是否对传输数据进行压缩，默认不开启。</span><br><span class=\"line\">; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）</span><br><span class=\"line\">;compression = zlib</span><br><span class=\"line\"></span><br><span class=\"line\">; 设置ssl版本,这个也是跟安装的openssl有关的</span><br><span class=\"line\">;sslVersion = TLSv1</span><br><span class=\"line\"></span><br><span class=\"line\">; Authentication stuff needs to be configured to prevent MITM attacks</span><br><span class=\"line\">; It is important to understand that this option was solely designed for access control and not for authorization</span><br><span class=\"line\">; It is not enabled by default!</span><br><span class=\"line\">; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，</span><br><span class=\"line\">; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。</span><br><span class=\"line\">; 这是有效防止中间人攻击的手段</span><br><span class=\"line\">; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）</span><br><span class=\"line\">; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）</span><br><span class=\"line\">;verify = 2</span><br><span class=\"line\">; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。</span><br><span class=\"line\">;CAfile = /etc/stunnel/stunnel-client.pem</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>启动停止stunnel</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start //开启stunnel</span><br><span class=\"line\">service stunnel restart //重启</span><br><span class=\"line\">service stunnel stop //停止</span><br><span class=\"line\">service stunnel status  //查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：国内服务器配置Stunnel客户端\"><a href=\"#4：国内服务器配置Stunnel客户端\" class=\"headerlink\" title=\"4：国内服务器配置Stunnel客户端\"></a>4：国内服务器配置Stunnel客户端</h1><p>国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。</p>\n<ol>\n<li>在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。</li>\n</ol>\n<p>本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组-&gt;防火墙-&gt;添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。</p>\n<ol start=\"2\">\n<li>配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。</li>\n</ol>\n<p>查看开放端口，如果没有firewall，请先安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n\n<p>设置需要开放的端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=3128/tcp --permanent//设置</span><br><span class=\"line\">firewall-cmd --reload//生效</span><br></pre></td></tr></table></figure>\n\n<p>此时再查看开放的端口，就能看到3128端口已开放。</p>\n<ol start=\"3\">\n<li>安装stunnel客户端。</li>\n</ol>\n<p>ubuntu使用:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install stunnel</span><br></pre></td></tr></table></figure>\n\n<p>centos使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install stunnel</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>设置stunnel客户端配置文件</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建</span><br><span class=\"line\">chroot = /var/run/stunnel/</span><br><span class=\"line\">; stunnel工作的用户组</span><br><span class=\"line\">setuid = root</span><br><span class=\"line\">setgid = root</span><br><span class=\"line\">; stunnel工作时候的pid</span><br><span class=\"line\">pid = /stunnel.pid</span><br><span class=\"line\">; 日志等级</span><br><span class=\"line\">debug = 7</span><br><span class=\"line\">; 日志文件</span><br><span class=\"line\">output = /var/log/stunnel/stunnel.log</span><br><span class=\"line\">; 表示以client模式启动stunnel，默认client = no，即server模式</span><br><span class=\"line\">client = yes</span><br><span class=\"line\">; 定义一个服务</span><br><span class=\"line\">[squid-proxy]</span><br><span class=\"line\">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class=\"line\">accept = 3128</span><br><span class=\"line\">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class=\"line\">connect = xx.xx.xx.xx:3129</span><br><span class=\"line\">; 需要验证对方发过来的证书</span><br><span class=\"line\">verify = 2</span><br><span class=\"line\">; 用来进行证书验证的文件（里面有stunnel server的证书）</span><br><span class=\"line\">CAfile = /etc/stunnel/stunnel-server.pem</span><br><span class=\"line\">; 客户端不需要传递自己的证书，所以注释掉</span><br><span class=\"line\">;cert = /etc/stunnel/stunnel.pem</span><br><span class=\"line\">;key = /etc/stunnel/stunnel.key</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。</li>\n</ol>\n<p>配置文件里<code>CAfile = /etc/stunnel/stunnel-server.pem</code>写明了我们需要将公钥保存的位置和公钥的文件名。</p>\n<p>我们只需要将，3.2节生成的证书打开，复制已<code>BEGIN CERTIFICATION</code>开头到<code>END CERTIFICATION</code>结束的公钥。然后，新建<code>/etc/stunnel/stunnel-server.pem</code>文件，将公钥粘贴进去。</p>\n<p>这样stunnel客户端就能将数据加密后发送给stunnel服务器了。</p>\n<ol start=\"6\">\n<li>启动和停止stunnel</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service stunnel start &#x2F;&#x2F;开启stunnel</span><br><span class=\"line\">service stunnel restart &#x2F;&#x2F;重启</span><br><span class=\"line\">service stunnel stop &#x2F;&#x2F;停止</span><br><span class=\"line\">service stunnel status  &#x2F;&#x2F;查看状态</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：不足和优化\"><a href=\"#5：不足和优化\" class=\"headerlink\" title=\"5：不足和优化\"></a>5：不足和优化</h1><h2 id=\"5-1-代理方法的不足\"><a href=\"#5-1-代理方法的不足\" class=\"headerlink\" title=\"5.1 代理方法的不足\"></a>5.1 代理方法的不足</h2><ol>\n<li><p>由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。</p>\n</li>\n<li><p>stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。</p>\n</li>\n</ol>\n<h2 id=\"5-2-优化\"><a href=\"#5-2-优化\" class=\"headerlink\" title=\"5.2 优化\"></a>5.2 优化</h2><ol>\n<li>配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid</li>\n</ol>\n<ul>\n<li>修改配置文件<code>/etc/squid/squid.conf</code>，在<code>http_access deny all</code>之前追加以下内容，并注释掉<code>http_access allow localhost</code></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> auth_param 设置代理的认证方式</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 用法：auth_param scheme parameter [setting]</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。</span></span><br><span class=\"line\">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> children 设置后台启动几个认证程序进程</span></span><br><span class=\"line\">auth_param basic children 3</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> credentialsttl 设置认证失效时间，过期后需重新认证</span></span><br><span class=\"line\">auth_param basic credentialsttl 10 hours</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”</span></span><br><span class=\"line\">auth_param basic realm welecome to using my proxy</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 添加名为AuthUsers访问列表，表示通过认证的用户</span></span><br><span class=\"line\">acl AuthUsers proxy_auth REQUIRED</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 允许AuthUsers的代理请求</span></span><br><span class=\"line\">http_access allow AuthUsers</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>新建密码文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">htpasswd -c /etc/squid/passwd qifei</span><br></pre></td></tr></table></figure>\n\n<p>如果没有htpasswd，则按提示安装。输入密码即可。</p>\n<ul>\n<li>重启squid</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service squid restart</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。</li>\n</ol>\n<h1 id=\"6：问题和调试\"><a href=\"#6：问题和调试\" class=\"headerlink\" title=\"6：问题和调试\"></a>6：问题和调试</h1><h2 id=\"6-1-国内squid能接通，但无法访问网络\"><a href=\"#6-1-国内squid能接通，但无法访问网络\" class=\"headerlink\" title=\"6.1 国内squid能接通，但无法访问网络\"></a>6.1 国内squid能接通，但无法访问网络</h2><p>这可能是服务器端口没开</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;port.ping.pe&#x2F;xx.xx.xx.xx:port</span><br></pre></td></tr></table></figure>\n\n<p>将上述网址，修改ip地址和端口后，通过浏览器打开，看看服务器端口是否能够接通，如果显示failed，那么参照第四章内容，安装firewald，并打开对应端口。</p>\n<h2 id=\"6-2-中国移动只能访问谷歌而无法访问YouTube\"><a href=\"#6-2-中国移动只能访问谷歌而无法访问YouTube\" class=\"headerlink\" title=\"6.2 中国移动只能访问谷歌而无法访问YouTube\"></a>6.2 中国移动只能访问谷歌而无法访问YouTube</h2><h3 id=\"5-30日更新：\"><a href=\"#5-30日更新：\" class=\"headerlink\" title=\"5.30日更新：\"></a>5.30日更新：</h3><p>在经过一段时间的使用后，上种方法存在一些弊端。</p>\n<p>在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。</p>\n<p>利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url<code>youtube.com</code>。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。</p>\n<p>而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。</p>\n<p>之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。</p>\n<p>查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。</p>\n<p>在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。</p>\n<p>因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。</p>\n<p>最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。</p>\n<p>这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。</p>\n<h3 id=\"5-31日更新：\"><a href=\"#5-31日更新：\" class=\"headerlink\" title=\"5.31日更新：\"></a>5.31日更新：</h3><p>我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。</p>\n<p>我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。</p>\n<p>我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。</p>\n<p>猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。</p>\n<p><strong>结论</strong>，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。</p>\n<p>这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。</p>\n<p>通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。</p>\n<p>而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。</p>\n<p>总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。</p>\n<h2 id=\"6-3-使用用户名和密码手机软件不能弹出登陆框\"><a href=\"#6-3-使用用户名和密码手机软件不能弹出登陆框\" class=\"headerlink\" title=\"6.3 使用用户名和密码手机软件不能弹出登陆框\"></a>6.3 使用用户名和密码手机软件不能弹出登陆框</h2><p>在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。</p>\n<h3 id=\"方法1：完全开放代理\"><a href=\"#方法1：完全开放代理\" class=\"headerlink\" title=\"方法1：完全开放代理\"></a>方法1：完全开放代理</h3><p>修改<code>squid.conf</code>关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。</p>\n<h3 id=\"方法2：IP限制\"><a href=\"#方法2：IP限制\" class=\"headerlink\" title=\"方法2：IP限制\"></a>方法2：IP限制</h3><p>在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。</p>\n<p>完整拓扑结构：用户主机-&gt;squid（国内）-&gt;stunnel（国内）-&gt;stunnel（国外）-&gt;squid（国外）-&gt;网站服务器</p>\n<p>添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。</p>\n<h3 id=\"方法3：网页验证加自定义ACL辅助器验证\"><a href=\"#方法3：网页验证加自定义ACL辅助器验证\" class=\"headerlink\" title=\"方法3：网页验证加自定义ACL辅助器验证\"></a>方法3：网页验证加自定义ACL辅助器验证</h3><p>第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。</p>\n<p><strong>设计思路</strong></p>\n<ol>\n<li>用户设置ip和端口，无密码连接代理服务器。</li>\n<li>用户打开浏览器，访问任意网页</li>\n<li>利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。</li>\n<li>网页后台验证用户输入的用户名和密码。并保存用户ip。</li>\n<li>编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。</li>\n</ol>\n<h3 id=\"方法4：自定义验证器加ACL辅助器验证\"><a href=\"#方法4：自定义验证器加ACL辅助器验证\" class=\"headerlink\" title=\"方法4：自定义验证器加ACL辅助器验证\"></a>方法4：自定义验证器加ACL辅助器验证</h3><p>第一次登陆，弹出代理登陆框，通过后保存ip</p>\n<ol>\n<li>用户设置ip和端口，连接代理服务器。</li>\n<li>代理服务器通过ACL辅助器验证此IP是否在白名单中。</li>\n<li>不在白名单则，进入自定义验证器，在，则通过代理。</li>\n<li>进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。</li>\n</ol>\n<p>我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png","popularPost_tmp_gaData":{"updated":"Sun Nov 15 2020 09:59:47 GMT+0100 (GMT+01:00)","title":"利用Stunnel+Squid代理实现国内无客户端访问外网","path":"2020/05/28/利用Stunnel+squid代理实现国内无客户端访问外网/","eyeCatchImage":"https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-05-28T21:26:23.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-05-28T21:26:23.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Linux","tags":["Stunnel","Squid"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"计算机网络技术学习笔记","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-04-26T11:05:49.000Z","password":null,"summary":"都是大学计算机二三级要考的内容，由于部分知识已经遗忘了，所以重新看一遍，这里介绍了网络的分类、IP地址的分类，路由器、交换机的使用和配置，还有一些路由协议的工作方式。","_content":"\n# 1：基础概念\n\n1. 局域网、城域网、广域网的区别\n\n2. 实训任务：宽带城域网的逻辑结构，“三个平台一个出口”\n\n管理平台、业务平台、网络平台（核心层、汇聚层、接入层）、城市宽带出口- \n\n核心层：\n\n- 为汇聚层的网络提供高速分组转发，为城市提供一个高速安全与具有QoS保障能力的数据传输环境\n- 提供城市的宽带IP出口\n- 用户访问Internet所需的路由访问\n\n汇聚层：\n\n- 汇聚接入层的用户流量\n- 进行本地路由，QoS优先级的管理等\n- 用户流量转发到核心层\n\n接入层：\n\n- 连接最终用户\n\n三层结构思想：上层负责下层的数据汇聚，核心提供出口和QoS、汇聚本地路由、接入服务用户。\n\n3. QoS服务质量的保证：\n\n- 资源预留、区分服务、多协议标记交换\n\nRPR：弹性分组环，工作技术，动态分组传输（DPT），在光以太网上高效传输IP分组的传输技术。顺时针传输的光纤叫做外环，内外环都可以传输数据分组和控制分组\n\n# 2：中小型网格系统总体规划\n\n**考点：路由器技术指标、网格系统分层设计、交换机技术指标、网络服务器性能**\n\n## 2.1 基础知识\n\n### 2.1.1 基于网络的信息系统基本结构\n\n- 网络运行环境：机房和电源\n- 网络系统\n- 网络操作系统\n- 网络应用软件开发和运行环境\n\n### 2.1.2 网络需求调研与系统设计的基本原则\n\n## 2.2 实训任务\n\n### 2.2.1 网络用户调查与网络工程需求分析\n\n网络需求分析包括：网络总体需求分析、综合布线需求分析、网络可用性与可靠性分析、网络安全性分析\n\n### 2.2.2 路由器选型的依据\n\n1. 路由器的分类——根据路由器背板交换能力划分\n\n交换能力大于**40Gbps**的为高端路由器\n\n2. 路由器的技术指标\n\n- 吞吐量：包转发能力。能力与**端口数量、端口效率、包长、包类型**有关\n\n- 背板能力：路由器的输入端与输出端之间的物理通道。传统，共享背板，高性能，交换式结构。背板能力决定了吞吐量\n- 丢包率：持续负荷下，包丢失的概率。衡量路由器超负荷工作时的指标\n- 延时与延时抖动：第一个比特进入路由器，到该帧的最后一个比特离开路由器所经历的时间。高速路由器，1518B的IP包，延时要求小于1ms。延时抖动指延时的变化量，语音、视频对延时抖动要求较高。\n- 突发处理能力：最小帧间隔发送数据包而不引起丢失的最大发送速率\n- 路由表容量\n- 服务质量：主要表现在队列管理机制、端口硬件队列管理和QoS协议上\n- 网管能力\n- 可靠性和可用性：设备的冗余、热插拔、无故障工作时间、内部钟表精度\n\n### 2.2.3 交换机分类与主要技术指标\n\n1. 交换机的分类\n\n2. 交换机的性能指标\n\n- 背板带宽\n- 全双工端口带宽：端口数x端口速率x2\n\n### 2.2.4 网络服务器选型\n\n1. 分类\n\n   文件服务器、数据库服务器、Internet通用服务器、应用服务器\n\n应用服务器的主要技术特点：采用浏览器/服务器（B/S）模式。传统的（C/S）客户/服务器\n\n2. 功能\n\n- 热插拔\n- RAID磁盘冗余阵列\n\n- CISC处理器结构\n\n3. 网络服务器性能\n\n- 运算处理能力\n- 磁盘存储能力\n- 系统的高可靠性=MTBF/（MTBF+MRBR），MTBF，平均无故障时间，MRBR，平均修复时间\n\n# 3：IP地址规划设计\n\n## 3.1 基础知识\n\n### 3.1.1 IP地址的概念和划分地址新技术的研究\n\n标准分类：A类、B类、C类IP地址采用包括网络号-主机号\n\n划分子网的三级结构：网络号-子网号-主机号\n\n无类域间路由（CIDR）：也称超网，将连续小的网络组成一个大的网络\n\n网络地址转换（NAT）：公司内部每一台主机分配不能再Internet上使用的专用IP地址，访问外网时，专用IP地址转换成全局IP地址。\n\n### 3.1.2 标准分类IP地址\n\nA类：0+7位网络号+24位主机号：1.0.0.0~127.255.255.255\n\nB类：10+14位网络号+16位主机号：128.0.0.0~191.255.255.255\n\nC类：110+21位网络号+8位主机号：192.0.0.0~223.255.255.255\n\nD类：1110+21位组播地址：224.0.0.0~\n\nE类：11110+保留号\n\n1. A类地址，一共127块，第一块和最后一块保留用作特殊用途，另外，网络号=10的，用于专用地址，其余125块可指派给一些机构，可用的主机号为2^24-2.\n2. B类地址，网络号长度为14位，网络号总数为16384，因此每个B类网络可以有2^16=65536个主机号。全0和全1保留用于特殊目的，因此允许分配的主机号位65534个。\n3. C类地址，网络号长度21位，主机号长度为8位，允许有2097152个网络位，允许分配的主机号为254个。\n\n特殊地址形式：\n\n- 直接广播地址：在A类B类C类IP地址中，主机号是全1，那么这个主机号为直接广播地址\n- 受限广播地址：32位全为1的广播地址（255.255.255.255）为受限广播地址，用来将一个分组以广播方式发送给本网络的所有主机。\n- 这个网络上的特定主机地址：网络号全零，主机号不变\n- 回送地址：A类地址中的127.0.0.0是回送地址，他是一个保留地址，会送地址用于网络软件测试和本地进程间通信\n\n### 3.1.3 划分子网的三级网络结构\n\n1. 子网的基本概念\n\n2. 三级层次是IP地址：netID——subnetID——hostID\n\n3. 子网掩码的概念：如何从一个IP地址中提取出子网号。\n\nA类地址：8位网络号：全1，24位主机号全0-。255.0.0.0\n\nB类：255.255.0.0\n\nC类：255.255.255.0\n\n计算：\n\nB类地址，要分出64个子网，从主机位借6位，现在网络号22位，主机位10位，子网掩码是，网络号全1，主机号全0，所以子网掩码为，255.255.252.0或者“网络号/22”.\n\n分128个子网，则网络号23位，主机号9位，子网掩码：255.255.254.0\n\n## 3.2 实训任务\n\n网络地址转换NAT工作原理\n\n- 静态NAT（一对一）\n- 动态地址NAT（一对多）\n- 网络地址端口装欢NAPT（端口区分）\n\nIPv6地址的主要特征\n\n- 新的协议格式，巨大的地址空间，有效的分机寻址和路由结构，地址自动配置，支持QoS服务\n- IP v6地址长度规定为128位，用16位边界划分，每个16位段转换更4位十六进制数字，用冒号分隔\n- 压缩零，有一段连续的十六进制段都为0，用双冒号压缩，FE8C::2AA:FF:FE9A:4CA2。段内压缩，只能压缩前面的零，双冒号在一个地址中只能出现一次。\n- IPv6不支持子网掩码，FE8C::2AA:FF:FE9A:4CA2/48。用前缀位表示48位前缀。\n\n# 4：路由设计技术\n\n考点：RIP路由协议、OSPF、BGP、IP路由选择和路由汇聚\n\n内部路由协议：RIP、OSPF\n\n外部路由协议：BGP\n\n## 4.1 路由信息协议（RIP）的工作过程：\n\n1. 路由表的建立，初始化的路由只包含所有与该路由器直接相连的网络的路由。距离为0.\n2. 路由表信息的更新\n\n- 如果自己的路由表没有该项，增加该项，距离+1\n- 如果自己的路由表已有该项\n  - 原距离比对方的距离（跳数）+1还要大，距离设置为对方距离+1。路由为对方\n  - 原距离比对方的距离+1还要小，保持不变。\n  - 相同不变\n\n路由刷新保温主要内容是由若干（V、D）组成的表\n\n## 4.2 最短路径优先协议（OSPF）\n\n### 4.2.1 和RIP比较，其特点\n\n1. OSPF是使用**分布式链路状态协议**；\n2. 链路状态度量主要是指**费用、距离、延时、带宽**。RIP主要看跳数；\n3. 链路状态发生变化时，用**洪泛法**向所有路由器发送此信息；\n4. 所有的OSFPF路由器交换链路状态信息，**最终建立一个链路状态数据库**，这个数据库实际上就是**全网的拓扑结构图**；\n5. OSPF可以将一个自治系统再划分为若干个更小的范围，即**区域**，每个区域有一个**32位的区域标识符**，一个区域路由器**不超过200个**。\n\n自治系统内部的区域划分，好处在于利用洪泛法将链路状态信息范围局限再每个区域而不是整个自治系统。**层次结构划分**，将一个自治系统划分成**若干区域与一个主干区域**。主干区域内部的路由器叫主干路由器，连接各个区域的路由器叫做区域边界路由器，区域边界路由器接收从其他区域来的信息。\n\n### 4.2.2 OSPF协议的执行过程\n\n1. 初始化过程：OSPF让每个路由器用数据库描述分组和相邻路由器交换本数据库已有的链路状态摘要信息，摘要信息主要址出哪些路由器的链路状态信息已经写入数据库。\n2. 网络云心过程：只要一个路由器的链路发生变化，该路由器就要使用链路状态发送分组信息。\n\n## 4.3 外部网关协议BGP\n\n基本思想：\n\n- 外部网关协议是不同自治系统的路由器之间交换路由信息的协议。\n- BGP-4采用了路由向量路由协议，每个自治系统至少选择一个路由器作为自治系统的“发言人”，一个BGP发言人与其他自治系统的发言人交换路由信息要先建立TCP连接。\n\nBGP路由选择协议的工作过程\n\n1. BGP初始化过程：BGP**刚刚运行时，交换整个路由表，以后只需要在发生变化时更新有变化的部分**；\n2. BGP协议的四种分组：\n\n- 打开分组：与另一个BGP发言人建立关系；\n- 更新分组：发送某一路由信息，以及列出要撤销的多条路由；\n- 保活分组：确认打开分组，以及周期证实相邻边界路由器存在；\n- 通知分组：发送检测到的差错。\n\nBGP发言人周期（30秒）交换“保活分组”。\n\n“更新分组”是BGP协议的核心。\n\n# 5：局域网技术\n\n考点：以太网组网方法（快速以太网）、局域网组网设备（集线器、交换机）、综合布线子系统设计（水平子系统、建筑群子系统）\n\n## 5.1 基础知识\n\n### 5.1.1 局域网组网的基础知识\n\n局域网（LAN）是指分布在相对较小距离范围内的计算机网络。\n\n局域网标准：IEEE802——>数据链路层分为了两个子层，LLC子层和MAC子层\n\n交换式局域网的基本概念，交换局域网是相对共享式局域网而言。局域网交换机可以在多个端口之间建立多个并发连接。主要采用**快捷交换方式和存储转发方式**\n\n虚拟局域网的基本概念（VLAN），以**软件**的方法将网络中的节点按工作性质与需要划分成若干“逻辑局域网”。\n\n方法通常四种：\n\n- 基于端口的虚拟局域网\n- 基于MAC地址的虚拟局域网\n- 基于网络层地址定义的虚拟局域网\n- 基于IP广播组的虚拟局域网\n\n### 5.1.2 综合布线的概念\n\n综合布线是一种模块化的、灵活性极高的建筑物内或建筑群之间的信息传输通道。由不同系列和规格的不见组成，包括：传输介质、相关连接硬件以及电气保护设备。\n\n特点：兼容性、开放性等\n\n组成：**工作区、配线（水平子系统）、干线（垂直子系统）、设备间、建筑群、管理**六大子系统\n\n## 5.2 实训任务\n\n1. 以太网组网的基本方法\n\n以太网的物理层标准的命名方法：\n\nIEEE802.3x(Mb/s) |Type-y|Name(局域网名称)\n\n10BASE-5，10M网，Base基带传输方式，y为网络的最大长度，单位100m。\n\n10BASE-T标准以太网组网的设计方法，-T表示非屏蔽双绞线和RJ-45接口\n\n快速以太网组网的基本设计方法：\n\n特点：IEEE802.3u、 可工作在10M和100M\n\n快速以太网介质专用接口MII\n\n快速以太网的物理标准：\n\n- 100BASE-TX：使用**5类非屏蔽双绞线或屏蔽双绞线**（抗干扰性更强），两队双绞线，**一对用于发送，一对用于接收**。在传输中使用**4B/5B编码**方式。最大网段长度为100m。支持**全双工**\n\n- 100BASE-FX：两条**光纤**。**全双工**\n- 100BASE-T4：**4对3类**非屏蔽双绞线，3对用于传送数据，1对用于检测冲突信号。传输**8B/6T编码**。**半双工**。\n\n全双工：任意时刻，信号双向传输信号。是一种点到点连接方式，支持全双工的以太网拓扑结构一定是星形。\n\n10Mbps与100Mpbs速率自动协商功能，只能用于使用双绞线的以太网，需要在500ms内完成。\n\n2. 中继器\n\n中继器是网络物理层上面的连接设备。通过对数据信号的重新发送或转发，来扩大网络传输的设备。\n\n543规则：是以太网标准中规定了以太网只允许出现5个网段，最多使用4个中继器，其中3段可以连接计算机\n\n3. 集线器\n\n多端口的中继器，区别仅在于中继器只是连接两个网段，而集线器能够提供更多端口服务，采用**CSMA/CD**介质访问控制方法。连接一个集线器的**所有节点共享一个冲突域**。\n\n**串联一个集线器可以监听**该链路中的数据包。\n\n连接到一个集线器的节点，**不能同时发送数据帧，但能同时接收**\n\n4. 网桥\n\n工作在数据链路层的设备。局域网互联，交换数据和共享资源\n\n特征：能互联两个采用**不同数据链路层协议、不同传输介质、不同传输速率**的网络。网桥以接收、储存、地址过滤和转发实现连接。\n\n网桥最重要的维护工作是构建和维护MAC地址表。MAC地址表记录了不同的节点的物理地址与网桥转发端口的关系。\n\n为避免网桥互联时的环状结构，透明网桥使用生成树算法。\n\n生成树协议：其能够逻辑地阻断网络中存在地冗余链路，以消除路径中地环路，活动链路出现故障时，重新激活冗余链路来恢复网络的连接。\n\n5. 交换机\n\n交换机可以在他的多个端口之间建立并发连接，交换式以太网是典型地交换式局域网，它的核心部件是以太网交换机。\n\n交换机与网桥地主要区别：网桥一般只有一个CPU，通过软件方法完成网桥地接收、存储、地址过滤与转发等。\n\n交换机使用为帧转发设计地专用集成电路芯片ASIC。或采取多个CPU并发工作地计算机结构\n\n6. 综合布线系统子系统设计\n\n- 工作区子系统设计：指从设备出线到信息插座地整个区域\n\n确定信息插座地数量和类型：信息插座分为，嵌入式安装插座（暗盒）、表面安装插座（明盒）、多介质信息插座（光纤和铜缆）\n\n适配器的选用：设备连接处用的不同信息插座，可用专用电缆和适配器。挡在单一信息插座上，进行两项服务，应用“Y”型适配器。选用电缆类型不同与设备所需的电缆类型时，以及在连接使用不同信号的数模转换货数据速率转换，应采用适配器。\n\n- 水平子系统设计\n\n采用5类或超5类4对非屏蔽双绞线，90m以内\n\n- 管理子系统设计\n\n- 干线子系统设计\n\n建筑物主馈电缆\n\n- 建筑群子系统\n\n两个或以上建筑物之间，由电缆、光缆和入楼处线缆上过流过压的电器保护设备\n\n最好的是——管道布线法\n\n------\n\n# 6： 局域网交换机\n\n## 6.1 基础知识\n\n### 6.1.1 局域网交换机的基本功能\n\n交换机的基本概念：工作在数据链路层的网络设备。交换机根据进入端口数据帧中的MAC地址，过滤、转发数据帧。独占数据通道、独享信道带宽，同时允许多对站点进行通信、系统带宽等于所有端口带宽之和。\n\n交换机的功能：\n\n1. 建立和维护一个表示**MAC地址与交换机端口**对应关系的交换表。\n2. 在发送节点和接收节点之间建立一个**虚连接**。\n\n3. 完成数据帧的转发和过滤。\n\n交换机分析每一个进来的数据帧，根据帧中的目的MAC地址，通过查询交换表，确定是丢弃还是转发。\n\n### 6.1.2 局域网交换机的工作原理\n\n交换机的工作原理与网桥相似，通过自学习的方式。\n\n### 6.1.3 交换表内容的建立和维护\n\n交换表的内容：**目的MAC地址**、该地址所对应的**交换机端口号**以及所在的**虚拟子网**。\n\n交换表的建立，初始时是空的，通过学习建立。\n\n交换表的维护，一定时间后，表项未被更新，则被删除\n\n交换结构：\n\n- 软件交换结构，串/并转换->RAM->并/串转换；\n- 矩阵交换结构，根据源端口与目的端口打开交换矩阵中相应的开关；\n- 总线交换结构，数据帧都按时隙在总线上传输，\n\n交换模式：快速转发、碎片丢弃、存储转发\n\n- 快速转发模式，一旦检测到**6个字节**，目的地址就立即进行转发操作。无法经过校验、纠错即被直接转发。\n- 存储转发模式，先存储起来，然后进行循环冗余码校验检查，再对错误帧进行处理，才去除数据帧的目的地址，进行转发操作。延时大，支持不同速度的端口间转发。\n- 碎片丢弃交换模式，检测数据帧是否冲突碎片，判断数据帧是否为64字节\n\n### 6.1.3 虚拟局域网VLAN技术\n\n以交换式网络为基础，把网络上的用户终端被划分为多个逻辑工作组。逻辑组设立一个独立的逻辑网段和广播域。不受用户所在的物理位置和物理网段的限制。通过软件完成。\n\n- VLAN工作在OSi参考模型的第2层，数据链路层。\n- 其广播的信息只能发送给该VLAN的节点\n- 唯一不同的子网号，VLAN只能通过第三层路由才能通信\n\nVLAN的标识：VLAN ID或VLAN name\n\nVLAN ID由IEEE 802.1Q标准规定**12位二进制**，1~1000用于以太网。\n\nVLAN name由32位字符表示，可以是字母或数字\n\nVLAN Trunk（虚拟中继）：主干线路上传输多个VLAN的信息，连接主干线路的两台交换机端口，应具有Trunk功能\n\n### 6.1.4 生成树协议STP\n\nBPDU报文，每两秒或是再网络发生故障、网络拓扑变化时，发送新的BPDU。\n\nBPDU两种类型，配置BPDU（不超过35个字节），拓扑变化通知BPDU（不超过4字节）\n\n## 6.2 实训任务\n\n1. 使用console配置交换机，超级端口设置参数9600bps，8位数字\n2. telnet命令配置，再windows“运行”输入指令`telnet x.x.x.x:端口号`\n3. 使用浏览器配置交换机，计算机已安装TCP/IP协议，计算机和交换机都有IP地址；计算机安装有JAVA的WEB浏览器；交换机有管理权限的用户密码；交换机支持http服务，并启用。\n\n------\n\n# 7：路由器及其配置\n\n考点：路由器基础与基本命令、接口配置、Pos接口配置、访问控制列表、静态路由、RIP协议、OSPF协议配置\n\n## 7.1 基础知识\n\n### 7.1.1 路由器概述\n\n工作在**网络层**的设备，选择**最佳路径**，将数据从源主机传送到目的端主机。路由器具有异构网络、广域网互联、**隔离广播**的能力。\n\n### 7.1.2 路由器工作原理\n\n1. 路由选择，路由器依据目的IP地址的网络地址，通过路由算法，确定一条最佳路径。\n2. 分组转发，根据最佳路径信息，将其转发给下一跳路由器、目的端口或是缺省路由器。\n\n缺省路由也称缺省网关。**分组转发的思想，目的IP地址不变，目的MAC地址，逐跳修改。**\n\n3. 路由表，目的网络地址及其对应端口，下一跳路由器的名字，缺省路由信息\n\n### 7.1.3 路由器的结构\n\n1. 中央处理器\n\n2. 非易失性随机存储器NVRAM：存储路由器的启动配置文件\n3. 闪存FLASH：保存操作系统的映像文件和一些微代码\n4. 接口：局域网接口、广域网接口\n\n配置接口：console控制接口和AUX辅助接口。AUX通过拨号方式实现远程访问\n\n路由器接口名字和编号 f 0/5，f：FastEthernet；mod/port，模块号/端口\n\n### 7.1.4 路由器的工作模式\n\n1. 用户模式\n\n通过控制台或Telnet登陆路由器后，用户可以浏览路由器的某些信息。默认提示符：router>\n\n2. 特权模式\n\n用户模式后输入enable。可以管理系统时钟、错误检测、查看和保存配置文件、清除内存、重启。提示符：router#\n\n3. 全局配置模式\n\n在特权模式下，输入configure terminal。配置路由器全局性参数（主机名、口令、TFTP服务器、静态路由）。提示符：router（config）#\n\n4. 其他配置模式\n\n包括接口配置模式、虚拟终端配置模式、路由配置模式等。\n\n5. 设置模式\n\n用户创建第一次的配置文件\n\n6. RXBOOT模式\n\n路由器的维护模式，**恢复密码**\n\n## 7.2 实训任务\n\n1. 路由器的操作\n\nAUX通过远程拨号配置路由器\n\n2. 路由器的配置\n\nrouter(config)#line vty 0 15\n\nrouter(config-line)#password zzz ***\n\n3. 使用TFTP配置路由器\n\n**广域网接口配置：**\n\n- 配置异步串行口（为用户提供拨号上网服务）\n\ninterface a1。封装格式只能为ppp\n\n- 配置同步串行口\n\n用于DDN专线、帧中继、卫星\n\ninterface s1/1；Bandwidth 2048（带宽2M，单位为kb）；封装hdlc或ppp协议，hdlc为缺省\n\n- 配置POS接口\n\ninterface POS3/0；Crc 32（校验位16和32）；Posframing sdh（可选帧格式是SDH和SONET）\n\n- loopback接口配置\n\n一个虚拟接口，接口号有效值为0~2147483647，主要用为管理地址，永远处于激活状态。子网掩码为255.255.255.255。int loopback 0\n\n**路由器的静态路由配置：**\n\n- 静态路由的配置方法：\n\nRouter(config)#p route <目的网络地址><子网掩码><下一跳路由器的IP地址>\n\n- 静态默认路由配置方法\n\n如果路由表中无匹配表项，且路由表中有默认路由，路由器按默认路由的吓一跳地址妆发数据\n\nRouter(config)#ip route 0.0.0.0 0.0.0.0 212.112.8.6\n\n**动态路由协议的配置**\n\n- RIP动态路由协议的配置\n\nRIP路由协议依据路由器的跳数(hop数)。最大跳数为15。不可带子网掩码\n\n1. 配置被动接口，只收不发\n2. 配置路由过滤\n3. 配置管理距离\n4. 定义邻居路由器\n\n- OSPF动态路由协议的配置\n\nOSPF的基本配置\n\n1. 使用network定义参与OSPF的子网地址\n\n   Router(config)# router ospf 63\n\n   Router(config-router)# network 131.107.25.1 0.0.0.0 area 0（0.0.0.0为反掩码或通配符）\n\n   Router(config-router)# area 0 range 131.107.25.1 255.255.255.255\n\n2. 参数配置\n\n配置被动接口、配置路由过滤、配置管理地址、配置引入外部路由到OSPF的参数\n\n**路由器的DHCP功能及其配置**\n\nIP地址分配有动态和静态两种方式。\n\n工作原理：DHCP采用C/S工作模式，一，建立和管理IP地址池，二，接收并处理DHCP客户端提出的请求。\n\n- DHCP服务器配置\n\n1. 配置IP地址池的名称，并进入DHCP Pool配置模式\n\n   Router(config)# ip dhcp pool ttt\n\n2. 配置IP地址池\n3. 配置不用于动态分配的IP地址\n4. 配置IP地址池的缺省网关\n5. 配置IP地址池的域名系统\n6. 配置IP地址池的地址租约时间\n7. 取消地址冲突记录日志\n\n- 路由器IP访问控制列表的功能\n\n主要功能：ACL可以当作一种网络控制工具，用来过滤流入和流出接口的数据包","source":"_posts/计算机网络技术学习笔记.md","raw":"---\ntitle: 计算机网络技术学习笔记\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-04-26 13:05:49\npassword:\nsummary: 都是大学计算机二三级要考的内容，由于部分知识已经遗忘了，所以重新看一遍，这里介绍了网络的分类、IP地址的分类，路由器、交换机的使用和配置，还有一些路由协议的工作方式。\ntags: 网络技术\ncategories: 学习笔记\n---\n\n# 1：基础概念\n\n1. 局域网、城域网、广域网的区别\n\n2. 实训任务：宽带城域网的逻辑结构，“三个平台一个出口”\n\n管理平台、业务平台、网络平台（核心层、汇聚层、接入层）、城市宽带出口- \n\n核心层：\n\n- 为汇聚层的网络提供高速分组转发，为城市提供一个高速安全与具有QoS保障能力的数据传输环境\n- 提供城市的宽带IP出口\n- 用户访问Internet所需的路由访问\n\n汇聚层：\n\n- 汇聚接入层的用户流量\n- 进行本地路由，QoS优先级的管理等\n- 用户流量转发到核心层\n\n接入层：\n\n- 连接最终用户\n\n三层结构思想：上层负责下层的数据汇聚，核心提供出口和QoS、汇聚本地路由、接入服务用户。\n\n3. QoS服务质量的保证：\n\n- 资源预留、区分服务、多协议标记交换\n\nRPR：弹性分组环，工作技术，动态分组传输（DPT），在光以太网上高效传输IP分组的传输技术。顺时针传输的光纤叫做外环，内外环都可以传输数据分组和控制分组\n\n# 2：中小型网格系统总体规划\n\n**考点：路由器技术指标、网格系统分层设计、交换机技术指标、网络服务器性能**\n\n## 2.1 基础知识\n\n### 2.1.1 基于网络的信息系统基本结构\n\n- 网络运行环境：机房和电源\n- 网络系统\n- 网络操作系统\n- 网络应用软件开发和运行环境\n\n### 2.1.2 网络需求调研与系统设计的基本原则\n\n## 2.2 实训任务\n\n### 2.2.1 网络用户调查与网络工程需求分析\n\n网络需求分析包括：网络总体需求分析、综合布线需求分析、网络可用性与可靠性分析、网络安全性分析\n\n### 2.2.2 路由器选型的依据\n\n1. 路由器的分类——根据路由器背板交换能力划分\n\n交换能力大于**40Gbps**的为高端路由器\n\n2. 路由器的技术指标\n\n- 吞吐量：包转发能力。能力与**端口数量、端口效率、包长、包类型**有关\n\n- 背板能力：路由器的输入端与输出端之间的物理通道。传统，共享背板，高性能，交换式结构。背板能力决定了吞吐量\n- 丢包率：持续负荷下，包丢失的概率。衡量路由器超负荷工作时的指标\n- 延时与延时抖动：第一个比特进入路由器，到该帧的最后一个比特离开路由器所经历的时间。高速路由器，1518B的IP包，延时要求小于1ms。延时抖动指延时的变化量，语音、视频对延时抖动要求较高。\n- 突发处理能力：最小帧间隔发送数据包而不引起丢失的最大发送速率\n- 路由表容量\n- 服务质量：主要表现在队列管理机制、端口硬件队列管理和QoS协议上\n- 网管能力\n- 可靠性和可用性：设备的冗余、热插拔、无故障工作时间、内部钟表精度\n\n### 2.2.3 交换机分类与主要技术指标\n\n1. 交换机的分类\n\n2. 交换机的性能指标\n\n- 背板带宽\n- 全双工端口带宽：端口数x端口速率x2\n\n### 2.2.4 网络服务器选型\n\n1. 分类\n\n   文件服务器、数据库服务器、Internet通用服务器、应用服务器\n\n应用服务器的主要技术特点：采用浏览器/服务器（B/S）模式。传统的（C/S）客户/服务器\n\n2. 功能\n\n- 热插拔\n- RAID磁盘冗余阵列\n\n- CISC处理器结构\n\n3. 网络服务器性能\n\n- 运算处理能力\n- 磁盘存储能力\n- 系统的高可靠性=MTBF/（MTBF+MRBR），MTBF，平均无故障时间，MRBR，平均修复时间\n\n# 3：IP地址规划设计\n\n## 3.1 基础知识\n\n### 3.1.1 IP地址的概念和划分地址新技术的研究\n\n标准分类：A类、B类、C类IP地址采用包括网络号-主机号\n\n划分子网的三级结构：网络号-子网号-主机号\n\n无类域间路由（CIDR）：也称超网，将连续小的网络组成一个大的网络\n\n网络地址转换（NAT）：公司内部每一台主机分配不能再Internet上使用的专用IP地址，访问外网时，专用IP地址转换成全局IP地址。\n\n### 3.1.2 标准分类IP地址\n\nA类：0+7位网络号+24位主机号：1.0.0.0~127.255.255.255\n\nB类：10+14位网络号+16位主机号：128.0.0.0~191.255.255.255\n\nC类：110+21位网络号+8位主机号：192.0.0.0~223.255.255.255\n\nD类：1110+21位组播地址：224.0.0.0~\n\nE类：11110+保留号\n\n1. A类地址，一共127块，第一块和最后一块保留用作特殊用途，另外，网络号=10的，用于专用地址，其余125块可指派给一些机构，可用的主机号为2^24-2.\n2. B类地址，网络号长度为14位，网络号总数为16384，因此每个B类网络可以有2^16=65536个主机号。全0和全1保留用于特殊目的，因此允许分配的主机号位65534个。\n3. C类地址，网络号长度21位，主机号长度为8位，允许有2097152个网络位，允许分配的主机号为254个。\n\n特殊地址形式：\n\n- 直接广播地址：在A类B类C类IP地址中，主机号是全1，那么这个主机号为直接广播地址\n- 受限广播地址：32位全为1的广播地址（255.255.255.255）为受限广播地址，用来将一个分组以广播方式发送给本网络的所有主机。\n- 这个网络上的特定主机地址：网络号全零，主机号不变\n- 回送地址：A类地址中的127.0.0.0是回送地址，他是一个保留地址，会送地址用于网络软件测试和本地进程间通信\n\n### 3.1.3 划分子网的三级网络结构\n\n1. 子网的基本概念\n\n2. 三级层次是IP地址：netID——subnetID——hostID\n\n3. 子网掩码的概念：如何从一个IP地址中提取出子网号。\n\nA类地址：8位网络号：全1，24位主机号全0-。255.0.0.0\n\nB类：255.255.0.0\n\nC类：255.255.255.0\n\n计算：\n\nB类地址，要分出64个子网，从主机位借6位，现在网络号22位，主机位10位，子网掩码是，网络号全1，主机号全0，所以子网掩码为，255.255.252.0或者“网络号/22”.\n\n分128个子网，则网络号23位，主机号9位，子网掩码：255.255.254.0\n\n## 3.2 实训任务\n\n网络地址转换NAT工作原理\n\n- 静态NAT（一对一）\n- 动态地址NAT（一对多）\n- 网络地址端口装欢NAPT（端口区分）\n\nIPv6地址的主要特征\n\n- 新的协议格式，巨大的地址空间，有效的分机寻址和路由结构，地址自动配置，支持QoS服务\n- IP v6地址长度规定为128位，用16位边界划分，每个16位段转换更4位十六进制数字，用冒号分隔\n- 压缩零，有一段连续的十六进制段都为0，用双冒号压缩，FE8C::2AA:FF:FE9A:4CA2。段内压缩，只能压缩前面的零，双冒号在一个地址中只能出现一次。\n- IPv6不支持子网掩码，FE8C::2AA:FF:FE9A:4CA2/48。用前缀位表示48位前缀。\n\n# 4：路由设计技术\n\n考点：RIP路由协议、OSPF、BGP、IP路由选择和路由汇聚\n\n内部路由协议：RIP、OSPF\n\n外部路由协议：BGP\n\n## 4.1 路由信息协议（RIP）的工作过程：\n\n1. 路由表的建立，初始化的路由只包含所有与该路由器直接相连的网络的路由。距离为0.\n2. 路由表信息的更新\n\n- 如果自己的路由表没有该项，增加该项，距离+1\n- 如果自己的路由表已有该项\n  - 原距离比对方的距离（跳数）+1还要大，距离设置为对方距离+1。路由为对方\n  - 原距离比对方的距离+1还要小，保持不变。\n  - 相同不变\n\n路由刷新保温主要内容是由若干（V、D）组成的表\n\n## 4.2 最短路径优先协议（OSPF）\n\n### 4.2.1 和RIP比较，其特点\n\n1. OSPF是使用**分布式链路状态协议**；\n2. 链路状态度量主要是指**费用、距离、延时、带宽**。RIP主要看跳数；\n3. 链路状态发生变化时，用**洪泛法**向所有路由器发送此信息；\n4. 所有的OSFPF路由器交换链路状态信息，**最终建立一个链路状态数据库**，这个数据库实际上就是**全网的拓扑结构图**；\n5. OSPF可以将一个自治系统再划分为若干个更小的范围，即**区域**，每个区域有一个**32位的区域标识符**，一个区域路由器**不超过200个**。\n\n自治系统内部的区域划分，好处在于利用洪泛法将链路状态信息范围局限再每个区域而不是整个自治系统。**层次结构划分**，将一个自治系统划分成**若干区域与一个主干区域**。主干区域内部的路由器叫主干路由器，连接各个区域的路由器叫做区域边界路由器，区域边界路由器接收从其他区域来的信息。\n\n### 4.2.2 OSPF协议的执行过程\n\n1. 初始化过程：OSPF让每个路由器用数据库描述分组和相邻路由器交换本数据库已有的链路状态摘要信息，摘要信息主要址出哪些路由器的链路状态信息已经写入数据库。\n2. 网络云心过程：只要一个路由器的链路发生变化，该路由器就要使用链路状态发送分组信息。\n\n## 4.3 外部网关协议BGP\n\n基本思想：\n\n- 外部网关协议是不同自治系统的路由器之间交换路由信息的协议。\n- BGP-4采用了路由向量路由协议，每个自治系统至少选择一个路由器作为自治系统的“发言人”，一个BGP发言人与其他自治系统的发言人交换路由信息要先建立TCP连接。\n\nBGP路由选择协议的工作过程\n\n1. BGP初始化过程：BGP**刚刚运行时，交换整个路由表，以后只需要在发生变化时更新有变化的部分**；\n2. BGP协议的四种分组：\n\n- 打开分组：与另一个BGP发言人建立关系；\n- 更新分组：发送某一路由信息，以及列出要撤销的多条路由；\n- 保活分组：确认打开分组，以及周期证实相邻边界路由器存在；\n- 通知分组：发送检测到的差错。\n\nBGP发言人周期（30秒）交换“保活分组”。\n\n“更新分组”是BGP协议的核心。\n\n# 5：局域网技术\n\n考点：以太网组网方法（快速以太网）、局域网组网设备（集线器、交换机）、综合布线子系统设计（水平子系统、建筑群子系统）\n\n## 5.1 基础知识\n\n### 5.1.1 局域网组网的基础知识\n\n局域网（LAN）是指分布在相对较小距离范围内的计算机网络。\n\n局域网标准：IEEE802——>数据链路层分为了两个子层，LLC子层和MAC子层\n\n交换式局域网的基本概念，交换局域网是相对共享式局域网而言。局域网交换机可以在多个端口之间建立多个并发连接。主要采用**快捷交换方式和存储转发方式**\n\n虚拟局域网的基本概念（VLAN），以**软件**的方法将网络中的节点按工作性质与需要划分成若干“逻辑局域网”。\n\n方法通常四种：\n\n- 基于端口的虚拟局域网\n- 基于MAC地址的虚拟局域网\n- 基于网络层地址定义的虚拟局域网\n- 基于IP广播组的虚拟局域网\n\n### 5.1.2 综合布线的概念\n\n综合布线是一种模块化的、灵活性极高的建筑物内或建筑群之间的信息传输通道。由不同系列和规格的不见组成，包括：传输介质、相关连接硬件以及电气保护设备。\n\n特点：兼容性、开放性等\n\n组成：**工作区、配线（水平子系统）、干线（垂直子系统）、设备间、建筑群、管理**六大子系统\n\n## 5.2 实训任务\n\n1. 以太网组网的基本方法\n\n以太网的物理层标准的命名方法：\n\nIEEE802.3x(Mb/s) |Type-y|Name(局域网名称)\n\n10BASE-5，10M网，Base基带传输方式，y为网络的最大长度，单位100m。\n\n10BASE-T标准以太网组网的设计方法，-T表示非屏蔽双绞线和RJ-45接口\n\n快速以太网组网的基本设计方法：\n\n特点：IEEE802.3u、 可工作在10M和100M\n\n快速以太网介质专用接口MII\n\n快速以太网的物理标准：\n\n- 100BASE-TX：使用**5类非屏蔽双绞线或屏蔽双绞线**（抗干扰性更强），两队双绞线，**一对用于发送，一对用于接收**。在传输中使用**4B/5B编码**方式。最大网段长度为100m。支持**全双工**\n\n- 100BASE-FX：两条**光纤**。**全双工**\n- 100BASE-T4：**4对3类**非屏蔽双绞线，3对用于传送数据，1对用于检测冲突信号。传输**8B/6T编码**。**半双工**。\n\n全双工：任意时刻，信号双向传输信号。是一种点到点连接方式，支持全双工的以太网拓扑结构一定是星形。\n\n10Mbps与100Mpbs速率自动协商功能，只能用于使用双绞线的以太网，需要在500ms内完成。\n\n2. 中继器\n\n中继器是网络物理层上面的连接设备。通过对数据信号的重新发送或转发，来扩大网络传输的设备。\n\n543规则：是以太网标准中规定了以太网只允许出现5个网段，最多使用4个中继器，其中3段可以连接计算机\n\n3. 集线器\n\n多端口的中继器，区别仅在于中继器只是连接两个网段，而集线器能够提供更多端口服务，采用**CSMA/CD**介质访问控制方法。连接一个集线器的**所有节点共享一个冲突域**。\n\n**串联一个集线器可以监听**该链路中的数据包。\n\n连接到一个集线器的节点，**不能同时发送数据帧，但能同时接收**\n\n4. 网桥\n\n工作在数据链路层的设备。局域网互联，交换数据和共享资源\n\n特征：能互联两个采用**不同数据链路层协议、不同传输介质、不同传输速率**的网络。网桥以接收、储存、地址过滤和转发实现连接。\n\n网桥最重要的维护工作是构建和维护MAC地址表。MAC地址表记录了不同的节点的物理地址与网桥转发端口的关系。\n\n为避免网桥互联时的环状结构，透明网桥使用生成树算法。\n\n生成树协议：其能够逻辑地阻断网络中存在地冗余链路，以消除路径中地环路，活动链路出现故障时，重新激活冗余链路来恢复网络的连接。\n\n5. 交换机\n\n交换机可以在他的多个端口之间建立并发连接，交换式以太网是典型地交换式局域网，它的核心部件是以太网交换机。\n\n交换机与网桥地主要区别：网桥一般只有一个CPU，通过软件方法完成网桥地接收、存储、地址过滤与转发等。\n\n交换机使用为帧转发设计地专用集成电路芯片ASIC。或采取多个CPU并发工作地计算机结构\n\n6. 综合布线系统子系统设计\n\n- 工作区子系统设计：指从设备出线到信息插座地整个区域\n\n确定信息插座地数量和类型：信息插座分为，嵌入式安装插座（暗盒）、表面安装插座（明盒）、多介质信息插座（光纤和铜缆）\n\n适配器的选用：设备连接处用的不同信息插座，可用专用电缆和适配器。挡在单一信息插座上，进行两项服务，应用“Y”型适配器。选用电缆类型不同与设备所需的电缆类型时，以及在连接使用不同信号的数模转换货数据速率转换，应采用适配器。\n\n- 水平子系统设计\n\n采用5类或超5类4对非屏蔽双绞线，90m以内\n\n- 管理子系统设计\n\n- 干线子系统设计\n\n建筑物主馈电缆\n\n- 建筑群子系统\n\n两个或以上建筑物之间，由电缆、光缆和入楼处线缆上过流过压的电器保护设备\n\n最好的是——管道布线法\n\n------\n\n# 6： 局域网交换机\n\n## 6.1 基础知识\n\n### 6.1.1 局域网交换机的基本功能\n\n交换机的基本概念：工作在数据链路层的网络设备。交换机根据进入端口数据帧中的MAC地址，过滤、转发数据帧。独占数据通道、独享信道带宽，同时允许多对站点进行通信、系统带宽等于所有端口带宽之和。\n\n交换机的功能：\n\n1. 建立和维护一个表示**MAC地址与交换机端口**对应关系的交换表。\n2. 在发送节点和接收节点之间建立一个**虚连接**。\n\n3. 完成数据帧的转发和过滤。\n\n交换机分析每一个进来的数据帧，根据帧中的目的MAC地址，通过查询交换表，确定是丢弃还是转发。\n\n### 6.1.2 局域网交换机的工作原理\n\n交换机的工作原理与网桥相似，通过自学习的方式。\n\n### 6.1.3 交换表内容的建立和维护\n\n交换表的内容：**目的MAC地址**、该地址所对应的**交换机端口号**以及所在的**虚拟子网**。\n\n交换表的建立，初始时是空的，通过学习建立。\n\n交换表的维护，一定时间后，表项未被更新，则被删除\n\n交换结构：\n\n- 软件交换结构，串/并转换->RAM->并/串转换；\n- 矩阵交换结构，根据源端口与目的端口打开交换矩阵中相应的开关；\n- 总线交换结构，数据帧都按时隙在总线上传输，\n\n交换模式：快速转发、碎片丢弃、存储转发\n\n- 快速转发模式，一旦检测到**6个字节**，目的地址就立即进行转发操作。无法经过校验、纠错即被直接转发。\n- 存储转发模式，先存储起来，然后进行循环冗余码校验检查，再对错误帧进行处理，才去除数据帧的目的地址，进行转发操作。延时大，支持不同速度的端口间转发。\n- 碎片丢弃交换模式，检测数据帧是否冲突碎片，判断数据帧是否为64字节\n\n### 6.1.3 虚拟局域网VLAN技术\n\n以交换式网络为基础，把网络上的用户终端被划分为多个逻辑工作组。逻辑组设立一个独立的逻辑网段和广播域。不受用户所在的物理位置和物理网段的限制。通过软件完成。\n\n- VLAN工作在OSi参考模型的第2层，数据链路层。\n- 其广播的信息只能发送给该VLAN的节点\n- 唯一不同的子网号，VLAN只能通过第三层路由才能通信\n\nVLAN的标识：VLAN ID或VLAN name\n\nVLAN ID由IEEE 802.1Q标准规定**12位二进制**，1~1000用于以太网。\n\nVLAN name由32位字符表示，可以是字母或数字\n\nVLAN Trunk（虚拟中继）：主干线路上传输多个VLAN的信息，连接主干线路的两台交换机端口，应具有Trunk功能\n\n### 6.1.4 生成树协议STP\n\nBPDU报文，每两秒或是再网络发生故障、网络拓扑变化时，发送新的BPDU。\n\nBPDU两种类型，配置BPDU（不超过35个字节），拓扑变化通知BPDU（不超过4字节）\n\n## 6.2 实训任务\n\n1. 使用console配置交换机，超级端口设置参数9600bps，8位数字\n2. telnet命令配置，再windows“运行”输入指令`telnet x.x.x.x:端口号`\n3. 使用浏览器配置交换机，计算机已安装TCP/IP协议，计算机和交换机都有IP地址；计算机安装有JAVA的WEB浏览器；交换机有管理权限的用户密码；交换机支持http服务，并启用。\n\n------\n\n# 7：路由器及其配置\n\n考点：路由器基础与基本命令、接口配置、Pos接口配置、访问控制列表、静态路由、RIP协议、OSPF协议配置\n\n## 7.1 基础知识\n\n### 7.1.1 路由器概述\n\n工作在**网络层**的设备，选择**最佳路径**，将数据从源主机传送到目的端主机。路由器具有异构网络、广域网互联、**隔离广播**的能力。\n\n### 7.1.2 路由器工作原理\n\n1. 路由选择，路由器依据目的IP地址的网络地址，通过路由算法，确定一条最佳路径。\n2. 分组转发，根据最佳路径信息，将其转发给下一跳路由器、目的端口或是缺省路由器。\n\n缺省路由也称缺省网关。**分组转发的思想，目的IP地址不变，目的MAC地址，逐跳修改。**\n\n3. 路由表，目的网络地址及其对应端口，下一跳路由器的名字，缺省路由信息\n\n### 7.1.3 路由器的结构\n\n1. 中央处理器\n\n2. 非易失性随机存储器NVRAM：存储路由器的启动配置文件\n3. 闪存FLASH：保存操作系统的映像文件和一些微代码\n4. 接口：局域网接口、广域网接口\n\n配置接口：console控制接口和AUX辅助接口。AUX通过拨号方式实现远程访问\n\n路由器接口名字和编号 f 0/5，f：FastEthernet；mod/port，模块号/端口\n\n### 7.1.4 路由器的工作模式\n\n1. 用户模式\n\n通过控制台或Telnet登陆路由器后，用户可以浏览路由器的某些信息。默认提示符：router>\n\n2. 特权模式\n\n用户模式后输入enable。可以管理系统时钟、错误检测、查看和保存配置文件、清除内存、重启。提示符：router#\n\n3. 全局配置模式\n\n在特权模式下，输入configure terminal。配置路由器全局性参数（主机名、口令、TFTP服务器、静态路由）。提示符：router（config）#\n\n4. 其他配置模式\n\n包括接口配置模式、虚拟终端配置模式、路由配置模式等。\n\n5. 设置模式\n\n用户创建第一次的配置文件\n\n6. RXBOOT模式\n\n路由器的维护模式，**恢复密码**\n\n## 7.2 实训任务\n\n1. 路由器的操作\n\nAUX通过远程拨号配置路由器\n\n2. 路由器的配置\n\nrouter(config)#line vty 0 15\n\nrouter(config-line)#password zzz ***\n\n3. 使用TFTP配置路由器\n\n**广域网接口配置：**\n\n- 配置异步串行口（为用户提供拨号上网服务）\n\ninterface a1。封装格式只能为ppp\n\n- 配置同步串行口\n\n用于DDN专线、帧中继、卫星\n\ninterface s1/1；Bandwidth 2048（带宽2M，单位为kb）；封装hdlc或ppp协议，hdlc为缺省\n\n- 配置POS接口\n\ninterface POS3/0；Crc 32（校验位16和32）；Posframing sdh（可选帧格式是SDH和SONET）\n\n- loopback接口配置\n\n一个虚拟接口，接口号有效值为0~2147483647，主要用为管理地址，永远处于激活状态。子网掩码为255.255.255.255。int loopback 0\n\n**路由器的静态路由配置：**\n\n- 静态路由的配置方法：\n\nRouter(config)#p route <目的网络地址><子网掩码><下一跳路由器的IP地址>\n\n- 静态默认路由配置方法\n\n如果路由表中无匹配表项，且路由表中有默认路由，路由器按默认路由的吓一跳地址妆发数据\n\nRouter(config)#ip route 0.0.0.0 0.0.0.0 212.112.8.6\n\n**动态路由协议的配置**\n\n- RIP动态路由协议的配置\n\nRIP路由协议依据路由器的跳数(hop数)。最大跳数为15。不可带子网掩码\n\n1. 配置被动接口，只收不发\n2. 配置路由过滤\n3. 配置管理距离\n4. 定义邻居路由器\n\n- OSPF动态路由协议的配置\n\nOSPF的基本配置\n\n1. 使用network定义参与OSPF的子网地址\n\n   Router(config)# router ospf 63\n\n   Router(config-router)# network 131.107.25.1 0.0.0.0 area 0（0.0.0.0为反掩码或通配符）\n\n   Router(config-router)# area 0 range 131.107.25.1 255.255.255.255\n\n2. 参数配置\n\n配置被动接口、配置路由过滤、配置管理地址、配置引入外部路由到OSPF的参数\n\n**路由器的DHCP功能及其配置**\n\nIP地址分配有动态和静态两种方式。\n\n工作原理：DHCP采用C/S工作模式，一，建立和管理IP地址池，二，接收并处理DHCP客户端提出的请求。\n\n- DHCP服务器配置\n\n1. 配置IP地址池的名称，并进入DHCP Pool配置模式\n\n   Router(config)# ip dhcp pool ttt\n\n2. 配置IP地址池\n3. 配置不用于动态分配的IP地址\n4. 配置IP地址池的缺省网关\n5. 配置IP地址池的域名系统\n6. 配置IP地址池的地址租约时间\n7. 取消地址冲突记录日志\n\n- 路由器IP访问控制列表的功能\n\n主要功能：ACL可以当作一种网络控制工具，用来过滤流入和流出接口的数据包","slug":"计算机网络技术学习笔记","published":1,"updated":"2020-06-20T06:48:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaev006mp0vz89be0wsl","content":"<h1 id=\"1：基础概念\"><a href=\"#1：基础概念\" class=\"headerlink\" title=\"1：基础概念\"></a>1：基础概念</h1><ol>\n<li><p>局域网、城域网、广域网的区别</p>\n</li>\n<li><p>实训任务：宽带城域网的逻辑结构，“三个平台一个出口”</p>\n</li>\n</ol>\n<p>管理平台、业务平台、网络平台（核心层、汇聚层、接入层）、城市宽带出口- </p>\n<p>核心层：</p>\n<ul>\n<li>为汇聚层的网络提供高速分组转发，为城市提供一个高速安全与具有QoS保障能力的数据传输环境</li>\n<li>提供城市的宽带IP出口</li>\n<li>用户访问Internet所需的路由访问</li>\n</ul>\n<p>汇聚层：</p>\n<ul>\n<li>汇聚接入层的用户流量</li>\n<li>进行本地路由，QoS优先级的管理等</li>\n<li>用户流量转发到核心层</li>\n</ul>\n<p>接入层：</p>\n<ul>\n<li>连接最终用户</li>\n</ul>\n<p>三层结构思想：上层负责下层的数据汇聚，核心提供出口和QoS、汇聚本地路由、接入服务用户。</p>\n<ol start=\"3\">\n<li>QoS服务质量的保证：</li>\n</ol>\n<ul>\n<li>资源预留、区分服务、多协议标记交换</li>\n</ul>\n<p>RPR：弹性分组环，工作技术，动态分组传输（DPT），在光以太网上高效传输IP分组的传输技术。顺时针传输的光纤叫做外环，内外环都可以传输数据分组和控制分组</p>\n<h1 id=\"2：中小型网格系统总体规划\"><a href=\"#2：中小型网格系统总体规划\" class=\"headerlink\" title=\"2：中小型网格系统总体规划\"></a>2：中小型网格系统总体规划</h1><p><strong>考点：路由器技术指标、网格系统分层设计、交换机技术指标、网络服务器性能</strong></p>\n<h2 id=\"2-1-基础知识\"><a href=\"#2-1-基础知识\" class=\"headerlink\" title=\"2.1 基础知识\"></a>2.1 基础知识</h2><h3 id=\"2-1-1-基于网络的信息系统基本结构\"><a href=\"#2-1-1-基于网络的信息系统基本结构\" class=\"headerlink\" title=\"2.1.1 基于网络的信息系统基本结构\"></a>2.1.1 基于网络的信息系统基本结构</h3><ul>\n<li>网络运行环境：机房和电源</li>\n<li>网络系统</li>\n<li>网络操作系统</li>\n<li>网络应用软件开发和运行环境</li>\n</ul>\n<h3 id=\"2-1-2-网络需求调研与系统设计的基本原则\"><a href=\"#2-1-2-网络需求调研与系统设计的基本原则\" class=\"headerlink\" title=\"2.1.2 网络需求调研与系统设计的基本原则\"></a>2.1.2 网络需求调研与系统设计的基本原则</h3><h2 id=\"2-2-实训任务\"><a href=\"#2-2-实训任务\" class=\"headerlink\" title=\"2.2 实训任务\"></a>2.2 实训任务</h2><h3 id=\"2-2-1-网络用户调查与网络工程需求分析\"><a href=\"#2-2-1-网络用户调查与网络工程需求分析\" class=\"headerlink\" title=\"2.2.1 网络用户调查与网络工程需求分析\"></a>2.2.1 网络用户调查与网络工程需求分析</h3><p>网络需求分析包括：网络总体需求分析、综合布线需求分析、网络可用性与可靠性分析、网络安全性分析</p>\n<h3 id=\"2-2-2-路由器选型的依据\"><a href=\"#2-2-2-路由器选型的依据\" class=\"headerlink\" title=\"2.2.2 路由器选型的依据\"></a>2.2.2 路由器选型的依据</h3><ol>\n<li>路由器的分类——根据路由器背板交换能力划分</li>\n</ol>\n<p>交换能力大于<strong>40Gbps</strong>的为高端路由器</p>\n<ol start=\"2\">\n<li>路由器的技术指标</li>\n</ol>\n<ul>\n<li><p>吞吐量：包转发能力。能力与<strong>端口数量、端口效率、包长、包类型</strong>有关</p>\n</li>\n<li><p>背板能力：路由器的输入端与输出端之间的物理通道。传统，共享背板，高性能，交换式结构。背板能力决定了吞吐量</p>\n</li>\n<li><p>丢包率：持续负荷下，包丢失的概率。衡量路由器超负荷工作时的指标</p>\n</li>\n<li><p>延时与延时抖动：第一个比特进入路由器，到该帧的最后一个比特离开路由器所经历的时间。高速路由器，1518B的IP包，延时要求小于1ms。延时抖动指延时的变化量，语音、视频对延时抖动要求较高。</p>\n</li>\n<li><p>突发处理能力：最小帧间隔发送数据包而不引起丢失的最大发送速率</p>\n</li>\n<li><p>路由表容量</p>\n</li>\n<li><p>服务质量：主要表现在队列管理机制、端口硬件队列管理和QoS协议上</p>\n</li>\n<li><p>网管能力</p>\n</li>\n<li><p>可靠性和可用性：设备的冗余、热插拔、无故障工作时间、内部钟表精度</p>\n</li>\n</ul>\n<h3 id=\"2-2-3-交换机分类与主要技术指标\"><a href=\"#2-2-3-交换机分类与主要技术指标\" class=\"headerlink\" title=\"2.2.3 交换机分类与主要技术指标\"></a>2.2.3 交换机分类与主要技术指标</h3><ol>\n<li><p>交换机的分类</p>\n</li>\n<li><p>交换机的性能指标</p>\n</li>\n</ol>\n<ul>\n<li>背板带宽</li>\n<li>全双工端口带宽：端口数x端口速率x2</li>\n</ul>\n<h3 id=\"2-2-4-网络服务器选型\"><a href=\"#2-2-4-网络服务器选型\" class=\"headerlink\" title=\"2.2.4 网络服务器选型\"></a>2.2.4 网络服务器选型</h3><ol>\n<li><p>分类</p>\n<p>文件服务器、数据库服务器、Internet通用服务器、应用服务器</p>\n</li>\n</ol>\n<p>应用服务器的主要技术特点：采用浏览器/服务器（B/S）模式。传统的（C/S）客户/服务器</p>\n<ol start=\"2\">\n<li>功能</li>\n</ol>\n<ul>\n<li><p>热插拔</p>\n</li>\n<li><p>RAID磁盘冗余阵列</p>\n</li>\n<li><p>CISC处理器结构</p>\n</li>\n</ul>\n<ol start=\"3\">\n<li>网络服务器性能</li>\n</ol>\n<ul>\n<li>运算处理能力</li>\n<li>磁盘存储能力</li>\n<li>系统的高可靠性=MTBF/（MTBF+MRBR），MTBF，平均无故障时间，MRBR，平均修复时间</li>\n</ul>\n<h1 id=\"3：IP地址规划设计\"><a href=\"#3：IP地址规划设计\" class=\"headerlink\" title=\"3：IP地址规划设计\"></a>3：IP地址规划设计</h1><h2 id=\"3-1-基础知识\"><a href=\"#3-1-基础知识\" class=\"headerlink\" title=\"3.1 基础知识\"></a>3.1 基础知识</h2><h3 id=\"3-1-1-IP地址的概念和划分地址新技术的研究\"><a href=\"#3-1-1-IP地址的概念和划分地址新技术的研究\" class=\"headerlink\" title=\"3.1.1 IP地址的概念和划分地址新技术的研究\"></a>3.1.1 IP地址的概念和划分地址新技术的研究</h3><p>标准分类：A类、B类、C类IP地址采用包括网络号-主机号</p>\n<p>划分子网的三级结构：网络号-子网号-主机号</p>\n<p>无类域间路由（CIDR）：也称超网，将连续小的网络组成一个大的网络</p>\n<p>网络地址转换（NAT）：公司内部每一台主机分配不能再Internet上使用的专用IP地址，访问外网时，专用IP地址转换成全局IP地址。</p>\n<h3 id=\"3-1-2-标准分类IP地址\"><a href=\"#3-1-2-标准分类IP地址\" class=\"headerlink\" title=\"3.1.2 标准分类IP地址\"></a>3.1.2 标准分类IP地址</h3><p>A类：0+7位网络号+24位主机号：1.0.0.0~127.255.255.255</p>\n<p>B类：10+14位网络号+16位主机号：128.0.0.0~191.255.255.255</p>\n<p>C类：110+21位网络号+8位主机号：192.0.0.0~223.255.255.255</p>\n<p>D类：1110+21位组播地址：224.0.0.0~</p>\n<p>E类：11110+保留号</p>\n<ol>\n<li>A类地址，一共127块，第一块和最后一块保留用作特殊用途，另外，网络号=10的，用于专用地址，其余125块可指派给一些机构，可用的主机号为2^24-2.</li>\n<li>B类地址，网络号长度为14位，网络号总数为16384，因此每个B类网络可以有2^16=65536个主机号。全0和全1保留用于特殊目的，因此允许分配的主机号位65534个。</li>\n<li>C类地址，网络号长度21位，主机号长度为8位，允许有2097152个网络位，允许分配的主机号为254个。</li>\n</ol>\n<p>特殊地址形式：</p>\n<ul>\n<li>直接广播地址：在A类B类C类IP地址中，主机号是全1，那么这个主机号为直接广播地址</li>\n<li>受限广播地址：32位全为1的广播地址（255.255.255.255）为受限广播地址，用来将一个分组以广播方式发送给本网络的所有主机。</li>\n<li>这个网络上的特定主机地址：网络号全零，主机号不变</li>\n<li>回送地址：A类地址中的127.0.0.0是回送地址，他是一个保留地址，会送地址用于网络软件测试和本地进程间通信</li>\n</ul>\n<h3 id=\"3-1-3-划分子网的三级网络结构\"><a href=\"#3-1-3-划分子网的三级网络结构\" class=\"headerlink\" title=\"3.1.3 划分子网的三级网络结构\"></a>3.1.3 划分子网的三级网络结构</h3><ol>\n<li><p>子网的基本概念</p>\n</li>\n<li><p>三级层次是IP地址：netID——subnetID——hostID</p>\n</li>\n<li><p>子网掩码的概念：如何从一个IP地址中提取出子网号。</p>\n</li>\n</ol>\n<p>A类地址：8位网络号：全1，24位主机号全0-。255.0.0.0</p>\n<p>B类：255.255.0.0</p>\n<p>C类：255.255.255.0</p>\n<p>计算：</p>\n<p>B类地址，要分出64个子网，从主机位借6位，现在网络号22位，主机位10位，子网掩码是，网络号全1，主机号全0，所以子网掩码为，255.255.252.0或者“网络号/22”.</p>\n<p>分128个子网，则网络号23位，主机号9位，子网掩码：255.255.254.0</p>\n<h2 id=\"3-2-实训任务\"><a href=\"#3-2-实训任务\" class=\"headerlink\" title=\"3.2 实训任务\"></a>3.2 实训任务</h2><p>网络地址转换NAT工作原理</p>\n<ul>\n<li>静态NAT（一对一）</li>\n<li>动态地址NAT（一对多）</li>\n<li>网络地址端口装欢NAPT（端口区分）</li>\n</ul>\n<p>IPv6地址的主要特征</p>\n<ul>\n<li>新的协议格式，巨大的地址空间，有效的分机寻址和路由结构，地址自动配置，支持QoS服务</li>\n<li>IP v6地址长度规定为128位，用16位边界划分，每个16位段转换更4位十六进制数字，用冒号分隔</li>\n<li>压缩零，有一段连续的十六进制段都为0，用双冒号压缩，FE8C::2AA:FF:FE9A:4CA2。段内压缩，只能压缩前面的零，双冒号在一个地址中只能出现一次。</li>\n<li>IPv6不支持子网掩码，FE8C::2AA:FF:FE9A:4CA2/48。用前缀位表示48位前缀。</li>\n</ul>\n<h1 id=\"4：路由设计技术\"><a href=\"#4：路由设计技术\" class=\"headerlink\" title=\"4：路由设计技术\"></a>4：路由设计技术</h1><p>考点：RIP路由协议、OSPF、BGP、IP路由选择和路由汇聚</p>\n<p>内部路由协议：RIP、OSPF</p>\n<p>外部路由协议：BGP</p>\n<h2 id=\"4-1-路由信息协议（RIP）的工作过程：\"><a href=\"#4-1-路由信息协议（RIP）的工作过程：\" class=\"headerlink\" title=\"4.1 路由信息协议（RIP）的工作过程：\"></a>4.1 路由信息协议（RIP）的工作过程：</h2><ol>\n<li>路由表的建立，初始化的路由只包含所有与该路由器直接相连的网络的路由。距离为0.</li>\n<li>路由表信息的更新</li>\n</ol>\n<ul>\n<li>如果自己的路由表没有该项，增加该项，距离+1</li>\n<li>如果自己的路由表已有该项<ul>\n<li>原距离比对方的距离（跳数）+1还要大，距离设置为对方距离+1。路由为对方</li>\n<li>原距离比对方的距离+1还要小，保持不变。</li>\n<li>相同不变</li>\n</ul>\n</li>\n</ul>\n<p>路由刷新保温主要内容是由若干（V、D）组成的表</p>\n<h2 id=\"4-2-最短路径优先协议（OSPF）\"><a href=\"#4-2-最短路径优先协议（OSPF）\" class=\"headerlink\" title=\"4.2 最短路径优先协议（OSPF）\"></a>4.2 最短路径优先协议（OSPF）</h2><h3 id=\"4-2-1-和RIP比较，其特点\"><a href=\"#4-2-1-和RIP比较，其特点\" class=\"headerlink\" title=\"4.2.1 和RIP比较，其特点\"></a>4.2.1 和RIP比较，其特点</h3><ol>\n<li>OSPF是使用<strong>分布式链路状态协议</strong>；</li>\n<li>链路状态度量主要是指<strong>费用、距离、延时、带宽</strong>。RIP主要看跳数；</li>\n<li>链路状态发生变化时，用<strong>洪泛法</strong>向所有路由器发送此信息；</li>\n<li>所有的OSFPF路由器交换链路状态信息，<strong>最终建立一个链路状态数据库</strong>，这个数据库实际上就是<strong>全网的拓扑结构图</strong>；</li>\n<li>OSPF可以将一个自治系统再划分为若干个更小的范围，即<strong>区域</strong>，每个区域有一个<strong>32位的区域标识符</strong>，一个区域路由器<strong>不超过200个</strong>。</li>\n</ol>\n<p>自治系统内部的区域划分，好处在于利用洪泛法将链路状态信息范围局限再每个区域而不是整个自治系统。<strong>层次结构划分</strong>，将一个自治系统划分成<strong>若干区域与一个主干区域</strong>。主干区域内部的路由器叫主干路由器，连接各个区域的路由器叫做区域边界路由器，区域边界路由器接收从其他区域来的信息。</p>\n<h3 id=\"4-2-2-OSPF协议的执行过程\"><a href=\"#4-2-2-OSPF协议的执行过程\" class=\"headerlink\" title=\"4.2.2 OSPF协议的执行过程\"></a>4.2.2 OSPF协议的执行过程</h3><ol>\n<li>初始化过程：OSPF让每个路由器用数据库描述分组和相邻路由器交换本数据库已有的链路状态摘要信息，摘要信息主要址出哪些路由器的链路状态信息已经写入数据库。</li>\n<li>网络云心过程：只要一个路由器的链路发生变化，该路由器就要使用链路状态发送分组信息。</li>\n</ol>\n<h2 id=\"4-3-外部网关协议BGP\"><a href=\"#4-3-外部网关协议BGP\" class=\"headerlink\" title=\"4.3 外部网关协议BGP\"></a>4.3 外部网关协议BGP</h2><p>基本思想：</p>\n<ul>\n<li>外部网关协议是不同自治系统的路由器之间交换路由信息的协议。</li>\n<li>BGP-4采用了路由向量路由协议，每个自治系统至少选择一个路由器作为自治系统的“发言人”，一个BGP发言人与其他自治系统的发言人交换路由信息要先建立TCP连接。</li>\n</ul>\n<p>BGP路由选择协议的工作过程</p>\n<ol>\n<li>BGP初始化过程：BGP<strong>刚刚运行时，交换整个路由表，以后只需要在发生变化时更新有变化的部分</strong>；</li>\n<li>BGP协议的四种分组：</li>\n</ol>\n<ul>\n<li>打开分组：与另一个BGP发言人建立关系；</li>\n<li>更新分组：发送某一路由信息，以及列出要撤销的多条路由；</li>\n<li>保活分组：确认打开分组，以及周期证实相邻边界路由器存在；</li>\n<li>通知分组：发送检测到的差错。</li>\n</ul>\n<p>BGP发言人周期（30秒）交换“保活分组”。</p>\n<p>“更新分组”是BGP协议的核心。</p>\n<h1 id=\"5：局域网技术\"><a href=\"#5：局域网技术\" class=\"headerlink\" title=\"5：局域网技术\"></a>5：局域网技术</h1><p>考点：以太网组网方法（快速以太网）、局域网组网设备（集线器、交换机）、综合布线子系统设计（水平子系统、建筑群子系统）</p>\n<h2 id=\"5-1-基础知识\"><a href=\"#5-1-基础知识\" class=\"headerlink\" title=\"5.1 基础知识\"></a>5.1 基础知识</h2><h3 id=\"5-1-1-局域网组网的基础知识\"><a href=\"#5-1-1-局域网组网的基础知识\" class=\"headerlink\" title=\"5.1.1 局域网组网的基础知识\"></a>5.1.1 局域网组网的基础知识</h3><p>局域网（LAN）是指分布在相对较小距离范围内的计算机网络。</p>\n<p>局域网标准：IEEE802——&gt;数据链路层分为了两个子层，LLC子层和MAC子层</p>\n<p>交换式局域网的基本概念，交换局域网是相对共享式局域网而言。局域网交换机可以在多个端口之间建立多个并发连接。主要采用<strong>快捷交换方式和存储转发方式</strong></p>\n<p>虚拟局域网的基本概念（VLAN），以<strong>软件</strong>的方法将网络中的节点按工作性质与需要划分成若干“逻辑局域网”。</p>\n<p>方法通常四种：</p>\n<ul>\n<li>基于端口的虚拟局域网</li>\n<li>基于MAC地址的虚拟局域网</li>\n<li>基于网络层地址定义的虚拟局域网</li>\n<li>基于IP广播组的虚拟局域网</li>\n</ul>\n<h3 id=\"5-1-2-综合布线的概念\"><a href=\"#5-1-2-综合布线的概念\" class=\"headerlink\" title=\"5.1.2 综合布线的概念\"></a>5.1.2 综合布线的概念</h3><p>综合布线是一种模块化的、灵活性极高的建筑物内或建筑群之间的信息传输通道。由不同系列和规格的不见组成，包括：传输介质、相关连接硬件以及电气保护设备。</p>\n<p>特点：兼容性、开放性等</p>\n<p>组成：<strong>工作区、配线（水平子系统）、干线（垂直子系统）、设备间、建筑群、管理</strong>六大子系统</p>\n<h2 id=\"5-2-实训任务\"><a href=\"#5-2-实训任务\" class=\"headerlink\" title=\"5.2 实训任务\"></a>5.2 实训任务</h2><ol>\n<li>以太网组网的基本方法</li>\n</ol>\n<p>以太网的物理层标准的命名方法：</p>\n<p>IEEE802.3x(Mb/s) |Type-y|Name(局域网名称)</p>\n<p>10BASE-5，10M网，Base基带传输方式，y为网络的最大长度，单位100m。</p>\n<p>10BASE-T标准以太网组网的设计方法，-T表示非屏蔽双绞线和RJ-45接口</p>\n<p>快速以太网组网的基本设计方法：</p>\n<p>特点：IEEE802.3u、 可工作在10M和100M</p>\n<p>快速以太网介质专用接口MII</p>\n<p>快速以太网的物理标准：</p>\n<ul>\n<li><p>100BASE-TX：使用<strong>5类非屏蔽双绞线或屏蔽双绞线</strong>（抗干扰性更强），两队双绞线，<strong>一对用于发送，一对用于接收</strong>。在传输中使用<strong>4B/5B编码</strong>方式。最大网段长度为100m。支持<strong>全双工</strong></p>\n</li>\n<li><p>100BASE-FX：两条<strong>光纤</strong>。<strong>全双工</strong></p>\n</li>\n<li><p>100BASE-T4：<strong>4对3类</strong>非屏蔽双绞线，3对用于传送数据，1对用于检测冲突信号。传输<strong>8B/6T编码</strong>。<strong>半双工</strong>。</p>\n</li>\n</ul>\n<p>全双工：任意时刻，信号双向传输信号。是一种点到点连接方式，支持全双工的以太网拓扑结构一定是星形。</p>\n<p>10Mbps与100Mpbs速率自动协商功能，只能用于使用双绞线的以太网，需要在500ms内完成。</p>\n<ol start=\"2\">\n<li>中继器</li>\n</ol>\n<p>中继器是网络物理层上面的连接设备。通过对数据信号的重新发送或转发，来扩大网络传输的设备。</p>\n<p>543规则：是以太网标准中规定了以太网只允许出现5个网段，最多使用4个中继器，其中3段可以连接计算机</p>\n<ol start=\"3\">\n<li>集线器</li>\n</ol>\n<p>多端口的中继器，区别仅在于中继器只是连接两个网段，而集线器能够提供更多端口服务，采用<strong>CSMA/CD</strong>介质访问控制方法。连接一个集线器的<strong>所有节点共享一个冲突域</strong>。</p>\n<p><strong>串联一个集线器可以监听</strong>该链路中的数据包。</p>\n<p>连接到一个集线器的节点，<strong>不能同时发送数据帧，但能同时接收</strong></p>\n<ol start=\"4\">\n<li>网桥</li>\n</ol>\n<p>工作在数据链路层的设备。局域网互联，交换数据和共享资源</p>\n<p>特征：能互联两个采用<strong>不同数据链路层协议、不同传输介质、不同传输速率</strong>的网络。网桥以接收、储存、地址过滤和转发实现连接。</p>\n<p>网桥最重要的维护工作是构建和维护MAC地址表。MAC地址表记录了不同的节点的物理地址与网桥转发端口的关系。</p>\n<p>为避免网桥互联时的环状结构，透明网桥使用生成树算法。</p>\n<p>生成树协议：其能够逻辑地阻断网络中存在地冗余链路，以消除路径中地环路，活动链路出现故障时，重新激活冗余链路来恢复网络的连接。</p>\n<ol start=\"5\">\n<li>交换机</li>\n</ol>\n<p>交换机可以在他的多个端口之间建立并发连接，交换式以太网是典型地交换式局域网，它的核心部件是以太网交换机。</p>\n<p>交换机与网桥地主要区别：网桥一般只有一个CPU，通过软件方法完成网桥地接收、存储、地址过滤与转发等。</p>\n<p>交换机使用为帧转发设计地专用集成电路芯片ASIC。或采取多个CPU并发工作地计算机结构</p>\n<ol start=\"6\">\n<li>综合布线系统子系统设计</li>\n</ol>\n<ul>\n<li>工作区子系统设计：指从设备出线到信息插座地整个区域</li>\n</ul>\n<p>确定信息插座地数量和类型：信息插座分为，嵌入式安装插座（暗盒）、表面安装插座（明盒）、多介质信息插座（光纤和铜缆）</p>\n<p>适配器的选用：设备连接处用的不同信息插座，可用专用电缆和适配器。挡在单一信息插座上，进行两项服务，应用“Y”型适配器。选用电缆类型不同与设备所需的电缆类型时，以及在连接使用不同信号的数模转换货数据速率转换，应采用适配器。</p>\n<ul>\n<li>水平子系统设计</li>\n</ul>\n<p>采用5类或超5类4对非屏蔽双绞线，90m以内</p>\n<ul>\n<li><p>管理子系统设计</p>\n</li>\n<li><p>干线子系统设计</p>\n</li>\n</ul>\n<p>建筑物主馈电缆</p>\n<ul>\n<li>建筑群子系统</li>\n</ul>\n<p>两个或以上建筑物之间，由电缆、光缆和入楼处线缆上过流过压的电器保护设备</p>\n<p>最好的是——管道布线法</p>\n<hr>\n<h1 id=\"6：-局域网交换机\"><a href=\"#6：-局域网交换机\" class=\"headerlink\" title=\"6： 局域网交换机\"></a>6： 局域网交换机</h1><h2 id=\"6-1-基础知识\"><a href=\"#6-1-基础知识\" class=\"headerlink\" title=\"6.1 基础知识\"></a>6.1 基础知识</h2><h3 id=\"6-1-1-局域网交换机的基本功能\"><a href=\"#6-1-1-局域网交换机的基本功能\" class=\"headerlink\" title=\"6.1.1 局域网交换机的基本功能\"></a>6.1.1 局域网交换机的基本功能</h3><p>交换机的基本概念：工作在数据链路层的网络设备。交换机根据进入端口数据帧中的MAC地址，过滤、转发数据帧。独占数据通道、独享信道带宽，同时允许多对站点进行通信、系统带宽等于所有端口带宽之和。</p>\n<p>交换机的功能：</p>\n<ol>\n<li><p>建立和维护一个表示<strong>MAC地址与交换机端口</strong>对应关系的交换表。</p>\n</li>\n<li><p>在发送节点和接收节点之间建立一个<strong>虚连接</strong>。</p>\n</li>\n<li><p>完成数据帧的转发和过滤。</p>\n</li>\n</ol>\n<p>交换机分析每一个进来的数据帧，根据帧中的目的MAC地址，通过查询交换表，确定是丢弃还是转发。</p>\n<h3 id=\"6-1-2-局域网交换机的工作原理\"><a href=\"#6-1-2-局域网交换机的工作原理\" class=\"headerlink\" title=\"6.1.2 局域网交换机的工作原理\"></a>6.1.2 局域网交换机的工作原理</h3><p>交换机的工作原理与网桥相似，通过自学习的方式。</p>\n<h3 id=\"6-1-3-交换表内容的建立和维护\"><a href=\"#6-1-3-交换表内容的建立和维护\" class=\"headerlink\" title=\"6.1.3 交换表内容的建立和维护\"></a>6.1.3 交换表内容的建立和维护</h3><p>交换表的内容：<strong>目的MAC地址</strong>、该地址所对应的<strong>交换机端口号</strong>以及所在的<strong>虚拟子网</strong>。</p>\n<p>交换表的建立，初始时是空的，通过学习建立。</p>\n<p>交换表的维护，一定时间后，表项未被更新，则被删除</p>\n<p>交换结构：</p>\n<ul>\n<li>软件交换结构，串/并转换-&gt;RAM-&gt;并/串转换；</li>\n<li>矩阵交换结构，根据源端口与目的端口打开交换矩阵中相应的开关；</li>\n<li>总线交换结构，数据帧都按时隙在总线上传输，</li>\n</ul>\n<p>交换模式：快速转发、碎片丢弃、存储转发</p>\n<ul>\n<li>快速转发模式，一旦检测到<strong>6个字节</strong>，目的地址就立即进行转发操作。无法经过校验、纠错即被直接转发。</li>\n<li>存储转发模式，先存储起来，然后进行循环冗余码校验检查，再对错误帧进行处理，才去除数据帧的目的地址，进行转发操作。延时大，支持不同速度的端口间转发。</li>\n<li>碎片丢弃交换模式，检测数据帧是否冲突碎片，判断数据帧是否为64字节</li>\n</ul>\n<h3 id=\"6-1-3-虚拟局域网VLAN技术\"><a href=\"#6-1-3-虚拟局域网VLAN技术\" class=\"headerlink\" title=\"6.1.3 虚拟局域网VLAN技术\"></a>6.1.3 虚拟局域网VLAN技术</h3><p>以交换式网络为基础，把网络上的用户终端被划分为多个逻辑工作组。逻辑组设立一个独立的逻辑网段和广播域。不受用户所在的物理位置和物理网段的限制。通过软件完成。</p>\n<ul>\n<li>VLAN工作在OSi参考模型的第2层，数据链路层。</li>\n<li>其广播的信息只能发送给该VLAN的节点</li>\n<li>唯一不同的子网号，VLAN只能通过第三层路由才能通信</li>\n</ul>\n<p>VLAN的标识：VLAN ID或VLAN name</p>\n<p>VLAN ID由IEEE 802.1Q标准规定<strong>12位二进制</strong>，1~1000用于以太网。</p>\n<p>VLAN name由32位字符表示，可以是字母或数字</p>\n<p>VLAN Trunk（虚拟中继）：主干线路上传输多个VLAN的信息，连接主干线路的两台交换机端口，应具有Trunk功能</p>\n<h3 id=\"6-1-4-生成树协议STP\"><a href=\"#6-1-4-生成树协议STP\" class=\"headerlink\" title=\"6.1.4 生成树协议STP\"></a>6.1.4 生成树协议STP</h3><p>BPDU报文，每两秒或是再网络发生故障、网络拓扑变化时，发送新的BPDU。</p>\n<p>BPDU两种类型，配置BPDU（不超过35个字节），拓扑变化通知BPDU（不超过4字节）</p>\n<h2 id=\"6-2-实训任务\"><a href=\"#6-2-实训任务\" class=\"headerlink\" title=\"6.2 实训任务\"></a>6.2 实训任务</h2><ol>\n<li>使用console配置交换机，超级端口设置参数9600bps，8位数字</li>\n<li>telnet命令配置，再windows“运行”输入指令<code>telnet x.x.x.x:端口号</code></li>\n<li>使用浏览器配置交换机，计算机已安装TCP/IP协议，计算机和交换机都有IP地址；计算机安装有JAVA的WEB浏览器；交换机有管理权限的用户密码；交换机支持http服务，并启用。</li>\n</ol>\n<hr>\n<h1 id=\"7：路由器及其配置\"><a href=\"#7：路由器及其配置\" class=\"headerlink\" title=\"7：路由器及其配置\"></a>7：路由器及其配置</h1><p>考点：路由器基础与基本命令、接口配置、Pos接口配置、访问控制列表、静态路由、RIP协议、OSPF协议配置</p>\n<h2 id=\"7-1-基础知识\"><a href=\"#7-1-基础知识\" class=\"headerlink\" title=\"7.1 基础知识\"></a>7.1 基础知识</h2><h3 id=\"7-1-1-路由器概述\"><a href=\"#7-1-1-路由器概述\" class=\"headerlink\" title=\"7.1.1 路由器概述\"></a>7.1.1 路由器概述</h3><p>工作在<strong>网络层</strong>的设备，选择<strong>最佳路径</strong>，将数据从源主机传送到目的端主机。路由器具有异构网络、广域网互联、<strong>隔离广播</strong>的能力。</p>\n<h3 id=\"7-1-2-路由器工作原理\"><a href=\"#7-1-2-路由器工作原理\" class=\"headerlink\" title=\"7.1.2 路由器工作原理\"></a>7.1.2 路由器工作原理</h3><ol>\n<li>路由选择，路由器依据目的IP地址的网络地址，通过路由算法，确定一条最佳路径。</li>\n<li>分组转发，根据最佳路径信息，将其转发给下一跳路由器、目的端口或是缺省路由器。</li>\n</ol>\n<p>缺省路由也称缺省网关。<strong>分组转发的思想，目的IP地址不变，目的MAC地址，逐跳修改。</strong></p>\n<ol start=\"3\">\n<li>路由表，目的网络地址及其对应端口，下一跳路由器的名字，缺省路由信息</li>\n</ol>\n<h3 id=\"7-1-3-路由器的结构\"><a href=\"#7-1-3-路由器的结构\" class=\"headerlink\" title=\"7.1.3 路由器的结构\"></a>7.1.3 路由器的结构</h3><ol>\n<li><p>中央处理器</p>\n</li>\n<li><p>非易失性随机存储器NVRAM：存储路由器的启动配置文件</p>\n</li>\n<li><p>闪存FLASH：保存操作系统的映像文件和一些微代码</p>\n</li>\n<li><p>接口：局域网接口、广域网接口</p>\n</li>\n</ol>\n<p>配置接口：console控制接口和AUX辅助接口。AUX通过拨号方式实现远程访问</p>\n<p>路由器接口名字和编号 f 0/5，f：FastEthernet；mod/port，模块号/端口</p>\n<h3 id=\"7-1-4-路由器的工作模式\"><a href=\"#7-1-4-路由器的工作模式\" class=\"headerlink\" title=\"7.1.4 路由器的工作模式\"></a>7.1.4 路由器的工作模式</h3><ol>\n<li>用户模式</li>\n</ol>\n<p>通过控制台或Telnet登陆路由器后，用户可以浏览路由器的某些信息。默认提示符：router&gt;</p>\n<ol start=\"2\">\n<li>特权模式</li>\n</ol>\n<p>用户模式后输入enable。可以管理系统时钟、错误检测、查看和保存配置文件、清除内存、重启。提示符：router#</p>\n<ol start=\"3\">\n<li>全局配置模式</li>\n</ol>\n<p>在特权模式下，输入configure terminal。配置路由器全局性参数（主机名、口令、TFTP服务器、静态路由）。提示符：router（config）#</p>\n<ol start=\"4\">\n<li>其他配置模式</li>\n</ol>\n<p>包括接口配置模式、虚拟终端配置模式、路由配置模式等。</p>\n<ol start=\"5\">\n<li>设置模式</li>\n</ol>\n<p>用户创建第一次的配置文件</p>\n<ol start=\"6\">\n<li>RXBOOT模式</li>\n</ol>\n<p>路由器的维护模式，<strong>恢复密码</strong></p>\n<h2 id=\"7-2-实训任务\"><a href=\"#7-2-实训任务\" class=\"headerlink\" title=\"7.2 实训任务\"></a>7.2 实训任务</h2><ol>\n<li>路由器的操作</li>\n</ol>\n<p>AUX通过远程拨号配置路由器</p>\n<ol start=\"2\">\n<li>路由器的配置</li>\n</ol>\n<p>router(config)#line vty 0 15</p>\n<p>router(config-line)#password zzz ***</p>\n<ol start=\"3\">\n<li>使用TFTP配置路由器</li>\n</ol>\n<p><strong>广域网接口配置：</strong></p>\n<ul>\n<li>配置异步串行口（为用户提供拨号上网服务）</li>\n</ul>\n<p>interface a1。封装格式只能为ppp</p>\n<ul>\n<li>配置同步串行口</li>\n</ul>\n<p>用于DDN专线、帧中继、卫星</p>\n<p>interface s1/1；Bandwidth 2048（带宽2M，单位为kb）；封装hdlc或ppp协议，hdlc为缺省</p>\n<ul>\n<li>配置POS接口</li>\n</ul>\n<p>interface POS3/0；Crc 32（校验位16和32）；Posframing sdh（可选帧格式是SDH和SONET）</p>\n<ul>\n<li>loopback接口配置</li>\n</ul>\n<p>一个虚拟接口，接口号有效值为0~2147483647，主要用为管理地址，永远处于激活状态。子网掩码为255.255.255.255。int loopback 0</p>\n<p><strong>路由器的静态路由配置：</strong></p>\n<ul>\n<li>静态路由的配置方法：</li>\n</ul>\n<p>Router(config)#p route &lt;目的网络地址&gt;&lt;子网掩码&gt;&lt;下一跳路由器的IP地址&gt;</p>\n<ul>\n<li>静态默认路由配置方法</li>\n</ul>\n<p>如果路由表中无匹配表项，且路由表中有默认路由，路由器按默认路由的吓一跳地址妆发数据</p>\n<p>Router(config)#ip route 0.0.0.0 0.0.0.0 212.112.8.6</p>\n<p><strong>动态路由协议的配置</strong></p>\n<ul>\n<li>RIP动态路由协议的配置</li>\n</ul>\n<p>RIP路由协议依据路由器的跳数(hop数)。最大跳数为15。不可带子网掩码</p>\n<ol>\n<li>配置被动接口，只收不发</li>\n<li>配置路由过滤</li>\n<li>配置管理距离</li>\n<li>定义邻居路由器</li>\n</ol>\n<ul>\n<li>OSPF动态路由协议的配置</li>\n</ul>\n<p>OSPF的基本配置</p>\n<ol>\n<li><p>使用network定义参与OSPF的子网地址</p>\n<p>Router(config)# router ospf 63</p>\n<p>Router(config-router)# network 131.107.25.1 0.0.0.0 area 0（0.0.0.0为反掩码或通配符）</p>\n<p>Router(config-router)# area 0 range 131.107.25.1 255.255.255.255</p>\n</li>\n<li><p>参数配置</p>\n</li>\n</ol>\n<p>配置被动接口、配置路由过滤、配置管理地址、配置引入外部路由到OSPF的参数</p>\n<p><strong>路由器的DHCP功能及其配置</strong></p>\n<p>IP地址分配有动态和静态两种方式。</p>\n<p>工作原理：DHCP采用C/S工作模式，一，建立和管理IP地址池，二，接收并处理DHCP客户端提出的请求。</p>\n<ul>\n<li>DHCP服务器配置</li>\n</ul>\n<ol>\n<li><p>配置IP地址池的名称，并进入DHCP Pool配置模式</p>\n<p>Router(config)# ip dhcp pool ttt</p>\n</li>\n<li><p>配置IP地址池</p>\n</li>\n<li><p>配置不用于动态分配的IP地址</p>\n</li>\n<li><p>配置IP地址池的缺省网关</p>\n</li>\n<li><p>配置IP地址池的域名系统</p>\n</li>\n<li><p>配置IP地址池的地址租约时间</p>\n</li>\n<li><p>取消地址冲突记录日志</p>\n</li>\n</ol>\n<ul>\n<li>路由器IP访问控制列表的功能</li>\n</ul>\n<p>主要功能：ACL可以当作一种网络控制工具，用来过滤流入和流出接口的数据包</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：基础概念\"><a href=\"#1：基础概念\" class=\"headerlink\" title=\"1：基础概念\"></a>1：基础概念</h1><ol>\n<li><p>局域网、城域网、广域网的区别</p>\n</li>\n<li><p>实训任务：宽带城域网的逻辑结构，“三个平台一个出口”</p>\n</li>\n</ol>\n<p>管理平台、业务平台、网络平台（核心层、汇聚层、接入层）、城市宽带出口- </p>\n<p>核心层：</p>\n<ul>\n<li>为汇聚层的网络提供高速分组转发，为城市提供一个高速安全与具有QoS保障能力的数据传输环境</li>\n<li>提供城市的宽带IP出口</li>\n<li>用户访问Internet所需的路由访问</li>\n</ul>\n<p>汇聚层：</p>\n<ul>\n<li>汇聚接入层的用户流量</li>\n<li>进行本地路由，QoS优先级的管理等</li>\n<li>用户流量转发到核心层</li>\n</ul>\n<p>接入层：</p>\n<ul>\n<li>连接最终用户</li>\n</ul>\n<p>三层结构思想：上层负责下层的数据汇聚，核心提供出口和QoS、汇聚本地路由、接入服务用户。</p>\n<ol start=\"3\">\n<li>QoS服务质量的保证：</li>\n</ol>\n<ul>\n<li>资源预留、区分服务、多协议标记交换</li>\n</ul>\n<p>RPR：弹性分组环，工作技术，动态分组传输（DPT），在光以太网上高效传输IP分组的传输技术。顺时针传输的光纤叫做外环，内外环都可以传输数据分组和控制分组</p>\n<h1 id=\"2：中小型网格系统总体规划\"><a href=\"#2：中小型网格系统总体规划\" class=\"headerlink\" title=\"2：中小型网格系统总体规划\"></a>2：中小型网格系统总体规划</h1><p><strong>考点：路由器技术指标、网格系统分层设计、交换机技术指标、网络服务器性能</strong></p>\n<h2 id=\"2-1-基础知识\"><a href=\"#2-1-基础知识\" class=\"headerlink\" title=\"2.1 基础知识\"></a>2.1 基础知识</h2><h3 id=\"2-1-1-基于网络的信息系统基本结构\"><a href=\"#2-1-1-基于网络的信息系统基本结构\" class=\"headerlink\" title=\"2.1.1 基于网络的信息系统基本结构\"></a>2.1.1 基于网络的信息系统基本结构</h3><ul>\n<li>网络运行环境：机房和电源</li>\n<li>网络系统</li>\n<li>网络操作系统</li>\n<li>网络应用软件开发和运行环境</li>\n</ul>\n<h3 id=\"2-1-2-网络需求调研与系统设计的基本原则\"><a href=\"#2-1-2-网络需求调研与系统设计的基本原则\" class=\"headerlink\" title=\"2.1.2 网络需求调研与系统设计的基本原则\"></a>2.1.2 网络需求调研与系统设计的基本原则</h3><h2 id=\"2-2-实训任务\"><a href=\"#2-2-实训任务\" class=\"headerlink\" title=\"2.2 实训任务\"></a>2.2 实训任务</h2><h3 id=\"2-2-1-网络用户调查与网络工程需求分析\"><a href=\"#2-2-1-网络用户调查与网络工程需求分析\" class=\"headerlink\" title=\"2.2.1 网络用户调查与网络工程需求分析\"></a>2.2.1 网络用户调查与网络工程需求分析</h3><p>网络需求分析包括：网络总体需求分析、综合布线需求分析、网络可用性与可靠性分析、网络安全性分析</p>\n<h3 id=\"2-2-2-路由器选型的依据\"><a href=\"#2-2-2-路由器选型的依据\" class=\"headerlink\" title=\"2.2.2 路由器选型的依据\"></a>2.2.2 路由器选型的依据</h3><ol>\n<li>路由器的分类——根据路由器背板交换能力划分</li>\n</ol>\n<p>交换能力大于<strong>40Gbps</strong>的为高端路由器</p>\n<ol start=\"2\">\n<li>路由器的技术指标</li>\n</ol>\n<ul>\n<li><p>吞吐量：包转发能力。能力与<strong>端口数量、端口效率、包长、包类型</strong>有关</p>\n</li>\n<li><p>背板能力：路由器的输入端与输出端之间的物理通道。传统，共享背板，高性能，交换式结构。背板能力决定了吞吐量</p>\n</li>\n<li><p>丢包率：持续负荷下，包丢失的概率。衡量路由器超负荷工作时的指标</p>\n</li>\n<li><p>延时与延时抖动：第一个比特进入路由器，到该帧的最后一个比特离开路由器所经历的时间。高速路由器，1518B的IP包，延时要求小于1ms。延时抖动指延时的变化量，语音、视频对延时抖动要求较高。</p>\n</li>\n<li><p>突发处理能力：最小帧间隔发送数据包而不引起丢失的最大发送速率</p>\n</li>\n<li><p>路由表容量</p>\n</li>\n<li><p>服务质量：主要表现在队列管理机制、端口硬件队列管理和QoS协议上</p>\n</li>\n<li><p>网管能力</p>\n</li>\n<li><p>可靠性和可用性：设备的冗余、热插拔、无故障工作时间、内部钟表精度</p>\n</li>\n</ul>\n<h3 id=\"2-2-3-交换机分类与主要技术指标\"><a href=\"#2-2-3-交换机分类与主要技术指标\" class=\"headerlink\" title=\"2.2.3 交换机分类与主要技术指标\"></a>2.2.3 交换机分类与主要技术指标</h3><ol>\n<li><p>交换机的分类</p>\n</li>\n<li><p>交换机的性能指标</p>\n</li>\n</ol>\n<ul>\n<li>背板带宽</li>\n<li>全双工端口带宽：端口数x端口速率x2</li>\n</ul>\n<h3 id=\"2-2-4-网络服务器选型\"><a href=\"#2-2-4-网络服务器选型\" class=\"headerlink\" title=\"2.2.4 网络服务器选型\"></a>2.2.4 网络服务器选型</h3><ol>\n<li><p>分类</p>\n<p>文件服务器、数据库服务器、Internet通用服务器、应用服务器</p>\n</li>\n</ol>\n<p>应用服务器的主要技术特点：采用浏览器/服务器（B/S）模式。传统的（C/S）客户/服务器</p>\n<ol start=\"2\">\n<li>功能</li>\n</ol>\n<ul>\n<li><p>热插拔</p>\n</li>\n<li><p>RAID磁盘冗余阵列</p>\n</li>\n<li><p>CISC处理器结构</p>\n</li>\n</ul>\n<ol start=\"3\">\n<li>网络服务器性能</li>\n</ol>\n<ul>\n<li>运算处理能力</li>\n<li>磁盘存储能力</li>\n<li>系统的高可靠性=MTBF/（MTBF+MRBR），MTBF，平均无故障时间，MRBR，平均修复时间</li>\n</ul>\n<h1 id=\"3：IP地址规划设计\"><a href=\"#3：IP地址规划设计\" class=\"headerlink\" title=\"3：IP地址规划设计\"></a>3：IP地址规划设计</h1><h2 id=\"3-1-基础知识\"><a href=\"#3-1-基础知识\" class=\"headerlink\" title=\"3.1 基础知识\"></a>3.1 基础知识</h2><h3 id=\"3-1-1-IP地址的概念和划分地址新技术的研究\"><a href=\"#3-1-1-IP地址的概念和划分地址新技术的研究\" class=\"headerlink\" title=\"3.1.1 IP地址的概念和划分地址新技术的研究\"></a>3.1.1 IP地址的概念和划分地址新技术的研究</h3><p>标准分类：A类、B类、C类IP地址采用包括网络号-主机号</p>\n<p>划分子网的三级结构：网络号-子网号-主机号</p>\n<p>无类域间路由（CIDR）：也称超网，将连续小的网络组成一个大的网络</p>\n<p>网络地址转换（NAT）：公司内部每一台主机分配不能再Internet上使用的专用IP地址，访问外网时，专用IP地址转换成全局IP地址。</p>\n<h3 id=\"3-1-2-标准分类IP地址\"><a href=\"#3-1-2-标准分类IP地址\" class=\"headerlink\" title=\"3.1.2 标准分类IP地址\"></a>3.1.2 标准分类IP地址</h3><p>A类：0+7位网络号+24位主机号：1.0.0.0~127.255.255.255</p>\n<p>B类：10+14位网络号+16位主机号：128.0.0.0~191.255.255.255</p>\n<p>C类：110+21位网络号+8位主机号：192.0.0.0~223.255.255.255</p>\n<p>D类：1110+21位组播地址：224.0.0.0~</p>\n<p>E类：11110+保留号</p>\n<ol>\n<li>A类地址，一共127块，第一块和最后一块保留用作特殊用途，另外，网络号=10的，用于专用地址，其余125块可指派给一些机构，可用的主机号为2^24-2.</li>\n<li>B类地址，网络号长度为14位，网络号总数为16384，因此每个B类网络可以有2^16=65536个主机号。全0和全1保留用于特殊目的，因此允许分配的主机号位65534个。</li>\n<li>C类地址，网络号长度21位，主机号长度为8位，允许有2097152个网络位，允许分配的主机号为254个。</li>\n</ol>\n<p>特殊地址形式：</p>\n<ul>\n<li>直接广播地址：在A类B类C类IP地址中，主机号是全1，那么这个主机号为直接广播地址</li>\n<li>受限广播地址：32位全为1的广播地址（255.255.255.255）为受限广播地址，用来将一个分组以广播方式发送给本网络的所有主机。</li>\n<li>这个网络上的特定主机地址：网络号全零，主机号不变</li>\n<li>回送地址：A类地址中的127.0.0.0是回送地址，他是一个保留地址，会送地址用于网络软件测试和本地进程间通信</li>\n</ul>\n<h3 id=\"3-1-3-划分子网的三级网络结构\"><a href=\"#3-1-3-划分子网的三级网络结构\" class=\"headerlink\" title=\"3.1.3 划分子网的三级网络结构\"></a>3.1.3 划分子网的三级网络结构</h3><ol>\n<li><p>子网的基本概念</p>\n</li>\n<li><p>三级层次是IP地址：netID——subnetID——hostID</p>\n</li>\n<li><p>子网掩码的概念：如何从一个IP地址中提取出子网号。</p>\n</li>\n</ol>\n<p>A类地址：8位网络号：全1，24位主机号全0-。255.0.0.0</p>\n<p>B类：255.255.0.0</p>\n<p>C类：255.255.255.0</p>\n<p>计算：</p>\n<p>B类地址，要分出64个子网，从主机位借6位，现在网络号22位，主机位10位，子网掩码是，网络号全1，主机号全0，所以子网掩码为，255.255.252.0或者“网络号/22”.</p>\n<p>分128个子网，则网络号23位，主机号9位，子网掩码：255.255.254.0</p>\n<h2 id=\"3-2-实训任务\"><a href=\"#3-2-实训任务\" class=\"headerlink\" title=\"3.2 实训任务\"></a>3.2 实训任务</h2><p>网络地址转换NAT工作原理</p>\n<ul>\n<li>静态NAT（一对一）</li>\n<li>动态地址NAT（一对多）</li>\n<li>网络地址端口装欢NAPT（端口区分）</li>\n</ul>\n<p>IPv6地址的主要特征</p>\n<ul>\n<li>新的协议格式，巨大的地址空间，有效的分机寻址和路由结构，地址自动配置，支持QoS服务</li>\n<li>IP v6地址长度规定为128位，用16位边界划分，每个16位段转换更4位十六进制数字，用冒号分隔</li>\n<li>压缩零，有一段连续的十六进制段都为0，用双冒号压缩，FE8C::2AA:FF:FE9A:4CA2。段内压缩，只能压缩前面的零，双冒号在一个地址中只能出现一次。</li>\n<li>IPv6不支持子网掩码，FE8C::2AA:FF:FE9A:4CA2/48。用前缀位表示48位前缀。</li>\n</ul>\n<h1 id=\"4：路由设计技术\"><a href=\"#4：路由设计技术\" class=\"headerlink\" title=\"4：路由设计技术\"></a>4：路由设计技术</h1><p>考点：RIP路由协议、OSPF、BGP、IP路由选择和路由汇聚</p>\n<p>内部路由协议：RIP、OSPF</p>\n<p>外部路由协议：BGP</p>\n<h2 id=\"4-1-路由信息协议（RIP）的工作过程：\"><a href=\"#4-1-路由信息协议（RIP）的工作过程：\" class=\"headerlink\" title=\"4.1 路由信息协议（RIP）的工作过程：\"></a>4.1 路由信息协议（RIP）的工作过程：</h2><ol>\n<li>路由表的建立，初始化的路由只包含所有与该路由器直接相连的网络的路由。距离为0.</li>\n<li>路由表信息的更新</li>\n</ol>\n<ul>\n<li>如果自己的路由表没有该项，增加该项，距离+1</li>\n<li>如果自己的路由表已有该项<ul>\n<li>原距离比对方的距离（跳数）+1还要大，距离设置为对方距离+1。路由为对方</li>\n<li>原距离比对方的距离+1还要小，保持不变。</li>\n<li>相同不变</li>\n</ul>\n</li>\n</ul>\n<p>路由刷新保温主要内容是由若干（V、D）组成的表</p>\n<h2 id=\"4-2-最短路径优先协议（OSPF）\"><a href=\"#4-2-最短路径优先协议（OSPF）\" class=\"headerlink\" title=\"4.2 最短路径优先协议（OSPF）\"></a>4.2 最短路径优先协议（OSPF）</h2><h3 id=\"4-2-1-和RIP比较，其特点\"><a href=\"#4-2-1-和RIP比较，其特点\" class=\"headerlink\" title=\"4.2.1 和RIP比较，其特点\"></a>4.2.1 和RIP比较，其特点</h3><ol>\n<li>OSPF是使用<strong>分布式链路状态协议</strong>；</li>\n<li>链路状态度量主要是指<strong>费用、距离、延时、带宽</strong>。RIP主要看跳数；</li>\n<li>链路状态发生变化时，用<strong>洪泛法</strong>向所有路由器发送此信息；</li>\n<li>所有的OSFPF路由器交换链路状态信息，<strong>最终建立一个链路状态数据库</strong>，这个数据库实际上就是<strong>全网的拓扑结构图</strong>；</li>\n<li>OSPF可以将一个自治系统再划分为若干个更小的范围，即<strong>区域</strong>，每个区域有一个<strong>32位的区域标识符</strong>，一个区域路由器<strong>不超过200个</strong>。</li>\n</ol>\n<p>自治系统内部的区域划分，好处在于利用洪泛法将链路状态信息范围局限再每个区域而不是整个自治系统。<strong>层次结构划分</strong>，将一个自治系统划分成<strong>若干区域与一个主干区域</strong>。主干区域内部的路由器叫主干路由器，连接各个区域的路由器叫做区域边界路由器，区域边界路由器接收从其他区域来的信息。</p>\n<h3 id=\"4-2-2-OSPF协议的执行过程\"><a href=\"#4-2-2-OSPF协议的执行过程\" class=\"headerlink\" title=\"4.2.2 OSPF协议的执行过程\"></a>4.2.2 OSPF协议的执行过程</h3><ol>\n<li>初始化过程：OSPF让每个路由器用数据库描述分组和相邻路由器交换本数据库已有的链路状态摘要信息，摘要信息主要址出哪些路由器的链路状态信息已经写入数据库。</li>\n<li>网络云心过程：只要一个路由器的链路发生变化，该路由器就要使用链路状态发送分组信息。</li>\n</ol>\n<h2 id=\"4-3-外部网关协议BGP\"><a href=\"#4-3-外部网关协议BGP\" class=\"headerlink\" title=\"4.3 外部网关协议BGP\"></a>4.3 外部网关协议BGP</h2><p>基本思想：</p>\n<ul>\n<li>外部网关协议是不同自治系统的路由器之间交换路由信息的协议。</li>\n<li>BGP-4采用了路由向量路由协议，每个自治系统至少选择一个路由器作为自治系统的“发言人”，一个BGP发言人与其他自治系统的发言人交换路由信息要先建立TCP连接。</li>\n</ul>\n<p>BGP路由选择协议的工作过程</p>\n<ol>\n<li>BGP初始化过程：BGP<strong>刚刚运行时，交换整个路由表，以后只需要在发生变化时更新有变化的部分</strong>；</li>\n<li>BGP协议的四种分组：</li>\n</ol>\n<ul>\n<li>打开分组：与另一个BGP发言人建立关系；</li>\n<li>更新分组：发送某一路由信息，以及列出要撤销的多条路由；</li>\n<li>保活分组：确认打开分组，以及周期证实相邻边界路由器存在；</li>\n<li>通知分组：发送检测到的差错。</li>\n</ul>\n<p>BGP发言人周期（30秒）交换“保活分组”。</p>\n<p>“更新分组”是BGP协议的核心。</p>\n<h1 id=\"5：局域网技术\"><a href=\"#5：局域网技术\" class=\"headerlink\" title=\"5：局域网技术\"></a>5：局域网技术</h1><p>考点：以太网组网方法（快速以太网）、局域网组网设备（集线器、交换机）、综合布线子系统设计（水平子系统、建筑群子系统）</p>\n<h2 id=\"5-1-基础知识\"><a href=\"#5-1-基础知识\" class=\"headerlink\" title=\"5.1 基础知识\"></a>5.1 基础知识</h2><h3 id=\"5-1-1-局域网组网的基础知识\"><a href=\"#5-1-1-局域网组网的基础知识\" class=\"headerlink\" title=\"5.1.1 局域网组网的基础知识\"></a>5.1.1 局域网组网的基础知识</h3><p>局域网（LAN）是指分布在相对较小距离范围内的计算机网络。</p>\n<p>局域网标准：IEEE802——&gt;数据链路层分为了两个子层，LLC子层和MAC子层</p>\n<p>交换式局域网的基本概念，交换局域网是相对共享式局域网而言。局域网交换机可以在多个端口之间建立多个并发连接。主要采用<strong>快捷交换方式和存储转发方式</strong></p>\n<p>虚拟局域网的基本概念（VLAN），以<strong>软件</strong>的方法将网络中的节点按工作性质与需要划分成若干“逻辑局域网”。</p>\n<p>方法通常四种：</p>\n<ul>\n<li>基于端口的虚拟局域网</li>\n<li>基于MAC地址的虚拟局域网</li>\n<li>基于网络层地址定义的虚拟局域网</li>\n<li>基于IP广播组的虚拟局域网</li>\n</ul>\n<h3 id=\"5-1-2-综合布线的概念\"><a href=\"#5-1-2-综合布线的概念\" class=\"headerlink\" title=\"5.1.2 综合布线的概念\"></a>5.1.2 综合布线的概念</h3><p>综合布线是一种模块化的、灵活性极高的建筑物内或建筑群之间的信息传输通道。由不同系列和规格的不见组成，包括：传输介质、相关连接硬件以及电气保护设备。</p>\n<p>特点：兼容性、开放性等</p>\n<p>组成：<strong>工作区、配线（水平子系统）、干线（垂直子系统）、设备间、建筑群、管理</strong>六大子系统</p>\n<h2 id=\"5-2-实训任务\"><a href=\"#5-2-实训任务\" class=\"headerlink\" title=\"5.2 实训任务\"></a>5.2 实训任务</h2><ol>\n<li>以太网组网的基本方法</li>\n</ol>\n<p>以太网的物理层标准的命名方法：</p>\n<p>IEEE802.3x(Mb/s) |Type-y|Name(局域网名称)</p>\n<p>10BASE-5，10M网，Base基带传输方式，y为网络的最大长度，单位100m。</p>\n<p>10BASE-T标准以太网组网的设计方法，-T表示非屏蔽双绞线和RJ-45接口</p>\n<p>快速以太网组网的基本设计方法：</p>\n<p>特点：IEEE802.3u、 可工作在10M和100M</p>\n<p>快速以太网介质专用接口MII</p>\n<p>快速以太网的物理标准：</p>\n<ul>\n<li><p>100BASE-TX：使用<strong>5类非屏蔽双绞线或屏蔽双绞线</strong>（抗干扰性更强），两队双绞线，<strong>一对用于发送，一对用于接收</strong>。在传输中使用<strong>4B/5B编码</strong>方式。最大网段长度为100m。支持<strong>全双工</strong></p>\n</li>\n<li><p>100BASE-FX：两条<strong>光纤</strong>。<strong>全双工</strong></p>\n</li>\n<li><p>100BASE-T4：<strong>4对3类</strong>非屏蔽双绞线，3对用于传送数据，1对用于检测冲突信号。传输<strong>8B/6T编码</strong>。<strong>半双工</strong>。</p>\n</li>\n</ul>\n<p>全双工：任意时刻，信号双向传输信号。是一种点到点连接方式，支持全双工的以太网拓扑结构一定是星形。</p>\n<p>10Mbps与100Mpbs速率自动协商功能，只能用于使用双绞线的以太网，需要在500ms内完成。</p>\n<ol start=\"2\">\n<li>中继器</li>\n</ol>\n<p>中继器是网络物理层上面的连接设备。通过对数据信号的重新发送或转发，来扩大网络传输的设备。</p>\n<p>543规则：是以太网标准中规定了以太网只允许出现5个网段，最多使用4个中继器，其中3段可以连接计算机</p>\n<ol start=\"3\">\n<li>集线器</li>\n</ol>\n<p>多端口的中继器，区别仅在于中继器只是连接两个网段，而集线器能够提供更多端口服务，采用<strong>CSMA/CD</strong>介质访问控制方法。连接一个集线器的<strong>所有节点共享一个冲突域</strong>。</p>\n<p><strong>串联一个集线器可以监听</strong>该链路中的数据包。</p>\n<p>连接到一个集线器的节点，<strong>不能同时发送数据帧，但能同时接收</strong></p>\n<ol start=\"4\">\n<li>网桥</li>\n</ol>\n<p>工作在数据链路层的设备。局域网互联，交换数据和共享资源</p>\n<p>特征：能互联两个采用<strong>不同数据链路层协议、不同传输介质、不同传输速率</strong>的网络。网桥以接收、储存、地址过滤和转发实现连接。</p>\n<p>网桥最重要的维护工作是构建和维护MAC地址表。MAC地址表记录了不同的节点的物理地址与网桥转发端口的关系。</p>\n<p>为避免网桥互联时的环状结构，透明网桥使用生成树算法。</p>\n<p>生成树协议：其能够逻辑地阻断网络中存在地冗余链路，以消除路径中地环路，活动链路出现故障时，重新激活冗余链路来恢复网络的连接。</p>\n<ol start=\"5\">\n<li>交换机</li>\n</ol>\n<p>交换机可以在他的多个端口之间建立并发连接，交换式以太网是典型地交换式局域网，它的核心部件是以太网交换机。</p>\n<p>交换机与网桥地主要区别：网桥一般只有一个CPU，通过软件方法完成网桥地接收、存储、地址过滤与转发等。</p>\n<p>交换机使用为帧转发设计地专用集成电路芯片ASIC。或采取多个CPU并发工作地计算机结构</p>\n<ol start=\"6\">\n<li>综合布线系统子系统设计</li>\n</ol>\n<ul>\n<li>工作区子系统设计：指从设备出线到信息插座地整个区域</li>\n</ul>\n<p>确定信息插座地数量和类型：信息插座分为，嵌入式安装插座（暗盒）、表面安装插座（明盒）、多介质信息插座（光纤和铜缆）</p>\n<p>适配器的选用：设备连接处用的不同信息插座，可用专用电缆和适配器。挡在单一信息插座上，进行两项服务，应用“Y”型适配器。选用电缆类型不同与设备所需的电缆类型时，以及在连接使用不同信号的数模转换货数据速率转换，应采用适配器。</p>\n<ul>\n<li>水平子系统设计</li>\n</ul>\n<p>采用5类或超5类4对非屏蔽双绞线，90m以内</p>\n<ul>\n<li><p>管理子系统设计</p>\n</li>\n<li><p>干线子系统设计</p>\n</li>\n</ul>\n<p>建筑物主馈电缆</p>\n<ul>\n<li>建筑群子系统</li>\n</ul>\n<p>两个或以上建筑物之间，由电缆、光缆和入楼处线缆上过流过压的电器保护设备</p>\n<p>最好的是——管道布线法</p>\n<hr>\n<h1 id=\"6：-局域网交换机\"><a href=\"#6：-局域网交换机\" class=\"headerlink\" title=\"6： 局域网交换机\"></a>6： 局域网交换机</h1><h2 id=\"6-1-基础知识\"><a href=\"#6-1-基础知识\" class=\"headerlink\" title=\"6.1 基础知识\"></a>6.1 基础知识</h2><h3 id=\"6-1-1-局域网交换机的基本功能\"><a href=\"#6-1-1-局域网交换机的基本功能\" class=\"headerlink\" title=\"6.1.1 局域网交换机的基本功能\"></a>6.1.1 局域网交换机的基本功能</h3><p>交换机的基本概念：工作在数据链路层的网络设备。交换机根据进入端口数据帧中的MAC地址，过滤、转发数据帧。独占数据通道、独享信道带宽，同时允许多对站点进行通信、系统带宽等于所有端口带宽之和。</p>\n<p>交换机的功能：</p>\n<ol>\n<li><p>建立和维护一个表示<strong>MAC地址与交换机端口</strong>对应关系的交换表。</p>\n</li>\n<li><p>在发送节点和接收节点之间建立一个<strong>虚连接</strong>。</p>\n</li>\n<li><p>完成数据帧的转发和过滤。</p>\n</li>\n</ol>\n<p>交换机分析每一个进来的数据帧，根据帧中的目的MAC地址，通过查询交换表，确定是丢弃还是转发。</p>\n<h3 id=\"6-1-2-局域网交换机的工作原理\"><a href=\"#6-1-2-局域网交换机的工作原理\" class=\"headerlink\" title=\"6.1.2 局域网交换机的工作原理\"></a>6.1.2 局域网交换机的工作原理</h3><p>交换机的工作原理与网桥相似，通过自学习的方式。</p>\n<h3 id=\"6-1-3-交换表内容的建立和维护\"><a href=\"#6-1-3-交换表内容的建立和维护\" class=\"headerlink\" title=\"6.1.3 交换表内容的建立和维护\"></a>6.1.3 交换表内容的建立和维护</h3><p>交换表的内容：<strong>目的MAC地址</strong>、该地址所对应的<strong>交换机端口号</strong>以及所在的<strong>虚拟子网</strong>。</p>\n<p>交换表的建立，初始时是空的，通过学习建立。</p>\n<p>交换表的维护，一定时间后，表项未被更新，则被删除</p>\n<p>交换结构：</p>\n<ul>\n<li>软件交换结构，串/并转换-&gt;RAM-&gt;并/串转换；</li>\n<li>矩阵交换结构，根据源端口与目的端口打开交换矩阵中相应的开关；</li>\n<li>总线交换结构，数据帧都按时隙在总线上传输，</li>\n</ul>\n<p>交换模式：快速转发、碎片丢弃、存储转发</p>\n<ul>\n<li>快速转发模式，一旦检测到<strong>6个字节</strong>，目的地址就立即进行转发操作。无法经过校验、纠错即被直接转发。</li>\n<li>存储转发模式，先存储起来，然后进行循环冗余码校验检查，再对错误帧进行处理，才去除数据帧的目的地址，进行转发操作。延时大，支持不同速度的端口间转发。</li>\n<li>碎片丢弃交换模式，检测数据帧是否冲突碎片，判断数据帧是否为64字节</li>\n</ul>\n<h3 id=\"6-1-3-虚拟局域网VLAN技术\"><a href=\"#6-1-3-虚拟局域网VLAN技术\" class=\"headerlink\" title=\"6.1.3 虚拟局域网VLAN技术\"></a>6.1.3 虚拟局域网VLAN技术</h3><p>以交换式网络为基础，把网络上的用户终端被划分为多个逻辑工作组。逻辑组设立一个独立的逻辑网段和广播域。不受用户所在的物理位置和物理网段的限制。通过软件完成。</p>\n<ul>\n<li>VLAN工作在OSi参考模型的第2层，数据链路层。</li>\n<li>其广播的信息只能发送给该VLAN的节点</li>\n<li>唯一不同的子网号，VLAN只能通过第三层路由才能通信</li>\n</ul>\n<p>VLAN的标识：VLAN ID或VLAN name</p>\n<p>VLAN ID由IEEE 802.1Q标准规定<strong>12位二进制</strong>，1~1000用于以太网。</p>\n<p>VLAN name由32位字符表示，可以是字母或数字</p>\n<p>VLAN Trunk（虚拟中继）：主干线路上传输多个VLAN的信息，连接主干线路的两台交换机端口，应具有Trunk功能</p>\n<h3 id=\"6-1-4-生成树协议STP\"><a href=\"#6-1-4-生成树协议STP\" class=\"headerlink\" title=\"6.1.4 生成树协议STP\"></a>6.1.4 生成树协议STP</h3><p>BPDU报文，每两秒或是再网络发生故障、网络拓扑变化时，发送新的BPDU。</p>\n<p>BPDU两种类型，配置BPDU（不超过35个字节），拓扑变化通知BPDU（不超过4字节）</p>\n<h2 id=\"6-2-实训任务\"><a href=\"#6-2-实训任务\" class=\"headerlink\" title=\"6.2 实训任务\"></a>6.2 实训任务</h2><ol>\n<li>使用console配置交换机，超级端口设置参数9600bps，8位数字</li>\n<li>telnet命令配置，再windows“运行”输入指令<code>telnet x.x.x.x:端口号</code></li>\n<li>使用浏览器配置交换机，计算机已安装TCP/IP协议，计算机和交换机都有IP地址；计算机安装有JAVA的WEB浏览器；交换机有管理权限的用户密码；交换机支持http服务，并启用。</li>\n</ol>\n<hr>\n<h1 id=\"7：路由器及其配置\"><a href=\"#7：路由器及其配置\" class=\"headerlink\" title=\"7：路由器及其配置\"></a>7：路由器及其配置</h1><p>考点：路由器基础与基本命令、接口配置、Pos接口配置、访问控制列表、静态路由、RIP协议、OSPF协议配置</p>\n<h2 id=\"7-1-基础知识\"><a href=\"#7-1-基础知识\" class=\"headerlink\" title=\"7.1 基础知识\"></a>7.1 基础知识</h2><h3 id=\"7-1-1-路由器概述\"><a href=\"#7-1-1-路由器概述\" class=\"headerlink\" title=\"7.1.1 路由器概述\"></a>7.1.1 路由器概述</h3><p>工作在<strong>网络层</strong>的设备，选择<strong>最佳路径</strong>，将数据从源主机传送到目的端主机。路由器具有异构网络、广域网互联、<strong>隔离广播</strong>的能力。</p>\n<h3 id=\"7-1-2-路由器工作原理\"><a href=\"#7-1-2-路由器工作原理\" class=\"headerlink\" title=\"7.1.2 路由器工作原理\"></a>7.1.2 路由器工作原理</h3><ol>\n<li>路由选择，路由器依据目的IP地址的网络地址，通过路由算法，确定一条最佳路径。</li>\n<li>分组转发，根据最佳路径信息，将其转发给下一跳路由器、目的端口或是缺省路由器。</li>\n</ol>\n<p>缺省路由也称缺省网关。<strong>分组转发的思想，目的IP地址不变，目的MAC地址，逐跳修改。</strong></p>\n<ol start=\"3\">\n<li>路由表，目的网络地址及其对应端口，下一跳路由器的名字，缺省路由信息</li>\n</ol>\n<h3 id=\"7-1-3-路由器的结构\"><a href=\"#7-1-3-路由器的结构\" class=\"headerlink\" title=\"7.1.3 路由器的结构\"></a>7.1.3 路由器的结构</h3><ol>\n<li><p>中央处理器</p>\n</li>\n<li><p>非易失性随机存储器NVRAM：存储路由器的启动配置文件</p>\n</li>\n<li><p>闪存FLASH：保存操作系统的映像文件和一些微代码</p>\n</li>\n<li><p>接口：局域网接口、广域网接口</p>\n</li>\n</ol>\n<p>配置接口：console控制接口和AUX辅助接口。AUX通过拨号方式实现远程访问</p>\n<p>路由器接口名字和编号 f 0/5，f：FastEthernet；mod/port，模块号/端口</p>\n<h3 id=\"7-1-4-路由器的工作模式\"><a href=\"#7-1-4-路由器的工作模式\" class=\"headerlink\" title=\"7.1.4 路由器的工作模式\"></a>7.1.4 路由器的工作模式</h3><ol>\n<li>用户模式</li>\n</ol>\n<p>通过控制台或Telnet登陆路由器后，用户可以浏览路由器的某些信息。默认提示符：router&gt;</p>\n<ol start=\"2\">\n<li>特权模式</li>\n</ol>\n<p>用户模式后输入enable。可以管理系统时钟、错误检测、查看和保存配置文件、清除内存、重启。提示符：router#</p>\n<ol start=\"3\">\n<li>全局配置模式</li>\n</ol>\n<p>在特权模式下，输入configure terminal。配置路由器全局性参数（主机名、口令、TFTP服务器、静态路由）。提示符：router（config）#</p>\n<ol start=\"4\">\n<li>其他配置模式</li>\n</ol>\n<p>包括接口配置模式、虚拟终端配置模式、路由配置模式等。</p>\n<ol start=\"5\">\n<li>设置模式</li>\n</ol>\n<p>用户创建第一次的配置文件</p>\n<ol start=\"6\">\n<li>RXBOOT模式</li>\n</ol>\n<p>路由器的维护模式，<strong>恢复密码</strong></p>\n<h2 id=\"7-2-实训任务\"><a href=\"#7-2-实训任务\" class=\"headerlink\" title=\"7.2 实训任务\"></a>7.2 实训任务</h2><ol>\n<li>路由器的操作</li>\n</ol>\n<p>AUX通过远程拨号配置路由器</p>\n<ol start=\"2\">\n<li>路由器的配置</li>\n</ol>\n<p>router(config)#line vty 0 15</p>\n<p>router(config-line)#password zzz ***</p>\n<ol start=\"3\">\n<li>使用TFTP配置路由器</li>\n</ol>\n<p><strong>广域网接口配置：</strong></p>\n<ul>\n<li>配置异步串行口（为用户提供拨号上网服务）</li>\n</ul>\n<p>interface a1。封装格式只能为ppp</p>\n<ul>\n<li>配置同步串行口</li>\n</ul>\n<p>用于DDN专线、帧中继、卫星</p>\n<p>interface s1/1；Bandwidth 2048（带宽2M，单位为kb）；封装hdlc或ppp协议，hdlc为缺省</p>\n<ul>\n<li>配置POS接口</li>\n</ul>\n<p>interface POS3/0；Crc 32（校验位16和32）；Posframing sdh（可选帧格式是SDH和SONET）</p>\n<ul>\n<li>loopback接口配置</li>\n</ul>\n<p>一个虚拟接口，接口号有效值为0~2147483647，主要用为管理地址，永远处于激活状态。子网掩码为255.255.255.255。int loopback 0</p>\n<p><strong>路由器的静态路由配置：</strong></p>\n<ul>\n<li>静态路由的配置方法：</li>\n</ul>\n<p>Router(config)#p route &lt;目的网络地址&gt;&lt;子网掩码&gt;&lt;下一跳路由器的IP地址&gt;</p>\n<ul>\n<li>静态默认路由配置方法</li>\n</ul>\n<p>如果路由表中无匹配表项，且路由表中有默认路由，路由器按默认路由的吓一跳地址妆发数据</p>\n<p>Router(config)#ip route 0.0.0.0 0.0.0.0 212.112.8.6</p>\n<p><strong>动态路由协议的配置</strong></p>\n<ul>\n<li>RIP动态路由协议的配置</li>\n</ul>\n<p>RIP路由协议依据路由器的跳数(hop数)。最大跳数为15。不可带子网掩码</p>\n<ol>\n<li>配置被动接口，只收不发</li>\n<li>配置路由过滤</li>\n<li>配置管理距离</li>\n<li>定义邻居路由器</li>\n</ol>\n<ul>\n<li>OSPF动态路由协议的配置</li>\n</ul>\n<p>OSPF的基本配置</p>\n<ol>\n<li><p>使用network定义参与OSPF的子网地址</p>\n<p>Router(config)# router ospf 63</p>\n<p>Router(config-router)# network 131.107.25.1 0.0.0.0 area 0（0.0.0.0为反掩码或通配符）</p>\n<p>Router(config-router)# area 0 range 131.107.25.1 255.255.255.255</p>\n</li>\n<li><p>参数配置</p>\n</li>\n</ol>\n<p>配置被动接口、配置路由过滤、配置管理地址、配置引入外部路由到OSPF的参数</p>\n<p><strong>路由器的DHCP功能及其配置</strong></p>\n<p>IP地址分配有动态和静态两种方式。</p>\n<p>工作原理：DHCP采用C/S工作模式，一，建立和管理IP地址池，二，接收并处理DHCP客户端提出的请求。</p>\n<ul>\n<li>DHCP服务器配置</li>\n</ul>\n<ol>\n<li><p>配置IP地址池的名称，并进入DHCP Pool配置模式</p>\n<p>Router(config)# ip dhcp pool ttt</p>\n</li>\n<li><p>配置IP地址池</p>\n</li>\n<li><p>配置不用于动态分配的IP地址</p>\n</li>\n<li><p>配置IP地址池的缺省网关</p>\n</li>\n<li><p>配置IP地址池的域名系统</p>\n</li>\n<li><p>配置IP地址池的地址租约时间</p>\n</li>\n<li><p>取消地址冲突记录日志</p>\n</li>\n</ol>\n<ul>\n<li>路由器IP访问控制列表的功能</li>\n</ul>\n<p>主要功能：ACL可以当作一种网络控制工具，用来过滤流入和流出接口的数据包</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:48:08 GMT+0200 (GMT+02:00)","title":"计算机网络技术学习笔记","path":"2020/04/26/计算机网络技术学习笔记/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-04-26T11:05:49.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-26T11:05:49.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["网络技术"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"JAVA安卓编程笔记","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2019-11-18T19:41:49.000Z","password":null,"summary":"大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。","_content":"\n# 第一章 前言\n\n大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。\n\n两年前，我使用的还是联想的i5五系列cpu、机械硬盘、4g内存，这个电脑配置使得我当时用eplise开发安卓程序非常麻烦，打开一个安卓虚拟机需要花很长的时间。半年前，我更换了Surface，用上了8+128G内存+固态硬盘。也更新了最新的i5八系列cpu，电脑配置有了显著提高，运行安卓开发程序也游刃有余了。\n\n而这次重启安卓学习之旅，我将使用AS进行安卓开发。虽然AS目前已支持C/C++做程序开发，但我仍将选择JAVA作为开发语言，以提高我的JAVA水平。\n\n# 第二章 安装Android Studio\n\n从 https://developer.android.com/studio 下载IDE和SDK后，进行相应安装和配置。安装教程，从网课和CDSN论坛均可找到。不再赘述。\n\n此处说明安装时遇到的坑。\n\n1. SDK安装后，在SDK管理工具中添加SDK目录即andriod-sdk提示`android sdk location should not contain whitespace`\n\n2. 问题1解决后紧接着出现提示`Target folder is neither empty nor does it point to an existing SDK installtion.`\n\n问题分析和解决办法：\n\n1. 提示意思为SDK的目录路径中出现空格。在我的问题中是，Program Files文件夹名称中间有空格，于是我在根路径重新创建了一个以Andriod为名的文件夹，并将andriod-sdk移到此路径下。\n2. 提示为，选择的文件夹既不是空的也不是sdk的文件夹，原因是我将sdk目录指向了Andriod为名的文件夹，正确的路径是上步创建Andriod文件下的andriod-sdk。\n\n安装好SDK后，还要给AS安装虚拟机，运行AS后，在Tools菜单下找到AVD Manager（虚拟机管理器），添加合适分辨率、Andriod版本的虚拟机即可。\n\n# 第三章 应用的资源访问\n\n## 3.1 认识Android目录\n\n1. res资源\n   * drawable-？dpi（l,h,m,x）：不同分辨率下的资源文件，如图片的大小。\n   * values：安卓应用界面上需要显示的各类文本标签文字。\n   * layout：界面布局文件。\n   * menu：存放菜单\n\n2. gen（ADT中）或JAVA（AS中）\n\n   由IDE自动生成的包文件\n\n   \n\n## 3.2 通用资源访问\n\n1. 基于Java代码访问资源\n\n   * Java代码访问方式:\n   \n```java\n[\\<packge-name>.]R.   //R类所在包路径可省略\n<resource_type>.<resource_name>  //resource_type：资源类型如color等。\n```\n\n   * Java访问示例\n   \n   * //从drawable目录中加载图片，设置为背景图片\n\n```java\ngetWindow().setBackgroundDrawableResource(R.drawable.back)\n```\n\n   * //从string设置字符串资源，设置为文本框的显示内容\n\n```java\nTextView title=(TextView)findViewById(R.id.title);  \ntitle.setText(R.string.titleinfo);\n```\n\n2. 在XML配置文件中访问资源\n\n   * XML资源访问方式:\n\n```xml\n@[<package_name>:]\n<resource_type>/<resource_name>\n```\n\n   * XML资源定义示例\n\n```xml\n<resources>\n<color name=\" blue \" >#ff00ff</color>\n<string name=\" title \" >\nConfirmation</string>\n</resources>\n```\n\n   * 在XML中使用资源示例\n\n     * XML资源使用实例片段\n\n```xml\n<EditText android:layout_width=\"match_parent\"\n\tandroid:layout_height=\"match_parent\"\n\tandroid:text=\" @string/title\"\n\tandroid:textColor=\" @color/blue\" \n/>\n</EditText>\n```\n\n\n\n## 3.3 安卓中字符串、颜色和尺寸应用\n\n1. 资源列表\n\n   字符串、颜色、尺寸资源，存放在XML文件内，位于/res/values目录下。\n\n   如字符串资源：/res/values/strings.xml。R类中名称：R.string\n\n2. 颜色表示方法\n\n   * 使用Color类的常量\n\n     如：`int color = Color.BLUE;//创建一个蓝色`\n\n   * 使用Color类的静态方法argb创建颜色\n\n     `int color = Color.argb\\(127.255.0.255\\);//半透明紫色`\n\n   * 在XML资源文件定义颜色值\n\n```xml\n<resources>\n<color name=\" blue \" >#ff00ff</color>\n<string name=\" title \" >\nConfirmation</string>\n</resources>\n```\n\n3. 使用示例\n\n4. res和assets区别\n\n   * res内的文件被映射到R.java，基于资源ID直接访问。\n\n   * assets需通过资源管理器访问。\n\n   * res下不可以创建子目录，assets可以有目录结构。\n\n   * 读取文件资源的方式不同\n\n     * 读取res/raw下的文件资源，通过当前Activity中的`getResources()`方法：\n\n```java\nInputStream is = getResources().\nopenRawResource(R.id.filename);\n```\n\n- 读取assets下的文件资源，通过当前活动的资源管理器assetmanager读取相应的资源文件：\n\n```java\nAssetManager am = getAssets();//通过当前的Activity的getAsset()方法。\nInputStream is = am.open(\"filename\");//基于文件名读取资源。\n```\n\n\n\n## 3.4 Drawable资源\n\n1. Drawable资源\n\n   * 主要是需要绘制的资源，比如图片资源。\n\n   * 主要格式有\\*.png、\\*.jpg等。\n\n   * 图片放入/res/drawable-xxx目录下。\n\n   * 安卓SDK会在编译应用自动加载图片。\n\n   * 资源文件在R.java资源类中生成该资源的索引。\n\n2. Drawable资源类型\n\n   * StateListDrawable资源（动态切换背景）\n   * LayerDrawable资源（图层叠加）\n   * ShapeDrawable资源（绘图）\n   * ClipDrawable资源\n   * AnimationDrawable资源（动画）\n\n\n\n## 3.5 安卓项目布局文件\n\n1. 什么是安卓布局文件？\n   * 定义用户界面上各个组建之间的组织结构。\n   * XML格式文件，安卓系统负责初始化。\n   * 实现界面布局和逻辑代码的分离。\n   * 修改和更新界面非常简便，无需修改代码。\n   * 布局文件是树形结构，使用根节点。\n   * 一般在布局控件中放置界面显示组建LinearLayout中放入textview文本标签\n   * 通过节点属性设置显示界面组建的属性：大小、颜色和边距等。\n\n2. 布局示例\n\n3. 布局文件节点属性示例\n\n   `android:id=\"@+id/button_id\"`\n\n   * @表示XML解析器应该解析ID字符串把它作为ID资源。\n   * +符号表示一个新的资源名字，会被创建且加入到资源列表中（R.java）\n   * @string/@color等可用于访问其他资源。\n   * 组建id在android应用中是唯一的。\n\n| 主题              | 内容                                                         |\n| ----------------- | :----------------------------------------------------------- |\n| 资源位置          | res/layout/my_layout.xml                                     |\n| 布局XML文件格式   | 使用&lt;?xml version= \"1.0\"encoding=\"utf-8\" ?><br>&lt;布局类xmlns:android=\"http://schemas.android.<br>Com/apk/res/android\" id= \"@id+/string_na`<br>`me\"(属性)><br>&lt;视图组件或者其他嵌套布局类><br>&lt;requestFocus/><br>&lt;/布局类> |\n| 获得XML资源的方法 | Activity.setContentView()                                    |\n| 引用XML资源的格式 | Java代码中：R.layout.my_layout。<br>XML文件中：@[package:]layout/my_layout |\n| 资源位置          | res/layout/my_layout.xml                                     |\n\n\n\n## 3.6 AndroidManifest.xml项目配置文件\n\n1. 什么是AndroidManifest.xml\n\n   位于根目录下，文件名不可修改。\n\n   该文件中 &lt;manifest>和 &lt;application>是必需的且只能出现一次。\n\n2. 描述Android应用使用的组建和系统配置信息\n\n   * 应用使用的组建及其实现类（Activity/Service等）\n   * 需要使用的安卓系统权限。\n   * 声明其他应用程序与该应用程序交互需要的权限\n   * 该应用程序所需的安卓API版本。\n   * 列出该应用程序所需类库。\n\n   \n\n# 第四章 界面编程任务分析与设计\n\n\n\n## 4.1 循序渐进\n\n1. Activity简介\n   * 安卓的视图组件，四大组件之一。\n   * 定义用户可以看到触摸到的界面。\n   * 活动内使用各种界面组件，实现交互动作。\n   * 通过活动，用户界面之间切换跳转、进行数据传递。\n\n2. Activity概念\n   \n* 用来包装用户界面组件的容器，实现用户和界面组件之间的交互。\n  \n3. 案列分析教学特点和注意事项\n   * 界面编程案例分析教学特点\n     * 案例：基于安卓系统的计算器\n     * 特点：案例驱动，实践先行\n     * 优势：在实践中学习抽象的概念\n   * 界面编程案例分析注意事项\n     * 知识要点：活动的概念和使用\n     * 分析技巧：如何将实际中的问题进行分析；分析问题和解决问题的方法\n     * 编码技巧：在案例中学习编码技巧\n\n4. 计算器案例\n\n   * 操作过程：\n\n     1. 用户输入两个计算数；\n\n     2. 选择计算类型；\n\n     3. 点击计算按钮，进行计算\n\n     4. 将结果展示给用户\n\n        \n\n## 4.2 活动的创建和使用\n\n1. 创建活动应用程序\n   * 应用程序通常由多个活动松耦合的组成\n   * 活动是界面上的组件在屏幕上展示的容器\n   * 活动通过布局文件展示界面布局的内容\n   * 活动的生命周期，利用周期的方法扩展\n\n2. 创建活动步骤\n   * 声明活动类名，继承于活动\n   * 实现`onCreate(Bundle bundle)`方法，在系统初始化完成活动对象之后，进行用户自定义的初始化活动\n   * 在`onCreate(View view)`设置用户界面的布局文件\n   * 通过活动中的`findViewById(int id)`获取各个界面组件，并基于其属性和方法进行相应的操作\n   * 如果需要在销毁活动进行处理，可以实现`onDestroy()`的方法。\n\n\n\n## 4.3 活动的声明和配置\n\n1. 活动的声明和配置\n\n   * 活动定义后需在AndroidManifest.xml中声明\n\n   * `<application.../>·节点内添加·<activity.../>·子元素\n\n   * 在`<activity>`子节点内定义Activity的类型（入口活动）\n\n```java\n<activity android:name=\"com.quck.android.calculator\"\nandroid:icon=\"@drawable/pic.png\"\nandroid:label=\"@string/app_name\" >\n//略去其中内容\n</activity>\n```\n\n2. 配置活动——示例分析\n\n   活动的主要配置属性有如下三个：\n\n   * name：指定该活动的类名\n\n   * icon：是定该活动对象的图标（可选）\n\n   * label：指定该活动的标签\n\n   * 在`<activity>`节点中指定一个或者多个`<intent-filter.../>`元素Intent的类型和Action决定活动是否会接收消息。\n\n     \n\n## 4.4 活动之间的数据交换和调用\n\n1. 活动之间的数据交换和调用\n   * 活动之间跳转，需传递数据信息\n   * 通过Intent来进行数据传递\n   * 数据需要放入Intent或者Bundle之内\n\n2. 什么是Bundle？\n   \n* Bundle类是一个key-value对，一个映射，把字符串映射为各种类型。\n  \n3. 数据交换\n   * 写入数据\n     * `putExtras(Bundle data)`向Intent中放入需要携带的Bundle数据\n     * `putXXX(String key, Xxx data)`向Bundle放入Int,Long,String等各种类型的数据\n     * `putSerializable(String key, Serialzable data)`:向Bundle中放入一份可序列化对象\n   * 读取数据\n     * `getExtras()`从Intent中读取需要携带的Bundle数据\n     * `getXXX(String key)`从Bundle，Intent读取int,Long,String等各种类型的数据\n     * `getSerializable(String key)`从Bundle，Intent中读取一个可序列化的对象\n   * 活动交换示例\n   * Intent vs Bundle\n     * 相同点：传递数据时，作用相同\n     * 不同点：在多个活动之间传递相同数据时，推荐使用Bundle来储存和传递数据，减少重复的读写操作\n     * 例：活动跳转A->B->C传递相同数据\n       * 如果使用Intent，则需要在A、B、C的Intent之间进行数据的复制\n       * 如果使用Bundle，则可直接传递Bundle对象即可\n\n4. 返回数据\n\n   * `startActivityForResult(Intent intent, int requestCode)`\n\n     跳转到指定的活动\n\n     参数intent：指定目的活动类名\n\n     参数requestCode：由程序中自定义的识别码，用以区分不同的七点活动\n\n   * `setResult(int resultCode, Intent data)`\n\n     设置resultCode表示结果的Activity，第二个参数保存传递的结果数据\n\n   * `onActivityResult(int requestCode, int resultCode, Intent data)`\n\n     参数requestCode：起点活动定义唯一值\n\n     参数resultCode：目的活动定义的唯一标识值\n\n     参数data：从墓地活动返回的数据\n\n5. 数据使用步骤\n   * 起点活动，调用`startActivityForResult()`跳转目的活动\n   * 在目的活动中调用`setResult()`\n   * 在起点活动覆写`onActivityResult()`在方法内获取目的活动返回的数据\n\n\n\n# 第五章 服务开发和广播事件\n\n\n\n## 5.1 循序渐进\n\n* 案列：音乐播放器\n\n  * 任务概述\n\n  * 功能分析\n\n    界面设计\n\n    实现暂停、播放和停止\n\n    播放同时，显示歌手和音乐名称\n\n  * 用户界面设计\n\n    主界面\n\n  * 技术要点\n\n    服务的创建、调用\n\n    服务和活动之间的通信\n\n    Intent对象的使用\n\n  * 案例演示\n\n* 案例任务分析和设计\n\n  音乐播放器界面分析\n\n* 核心代码设计和实现\n\n  核心代码编写步骤：\n\n  1. 创建安卓项目MusicBox\n  2. 在res/loyout目录，创建播放器的主界面布局文件\n  3. 定义一个MusicBoxContant的常量类存放程序中用到的静态或不变的信息\n  4. 创建音乐播放器的服务类\n  5. 在全局配置文件中，声明服务类\n  6. 定义实现音乐播放器的主界面\n  7. 定义事项ActicityReciver事件接收器，接受音乐服务状态变化广播事件的接收器\n  8. 定义实现按钮事件接收器，播放和停止按钮，发送广播事件\n\n   \n\n## 5.2 安卓中的系统服务\n\n* 安卓将诸多常用功能内置为系统服务\n\n* 提供简单的获取系统服务的方式\n\n* 系统服务涵盖了安卓绝大部分常用功能，如，拨打电话，发送短信\n\n1. 安卓中获取系统服务\n\n   * 获取系统服务代码示例\n\n     `TelephonyManager phoneManager=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);`\n\n   * 强制类型转化\n\n     * 在程序运行过程中，将父类型对象转化为子类型对象。\n     * 由于子类型相比父类型的内涵丰富，属性方法更多，所以要把父类型转化为子类型时，需要强制转化，成为强制类型转换。\n     * 并不是所有父类型都可以转化为子类型，要根据具体的使用情况来做具体的判断。\n\n\n\n## 5.3 广播接收机制\n\n1. 广播消息\n   * 广播是一种在应用程序之间传输信息的计指\n   * BroadcastReceiver广播接收者\n   * 广播消息Intent（消息载体）\n   * 被订阅广播的多个广播接收者接收\n   * 消息订阅者不了解发送者\n2. 广播接收者\n   * BroadcastReceiver对发出的广播事件进行过滤，应用程序通知其他应用程序某些数据已经下载完毕。\n   * 广播接收者没有图形界面\n   * 广播可以有多个接收者，彼此不知晓。广播接收者之间匿名\n\n3. 监听广播机制\n   * 广播和事件监听器是分离的\n   * 通过安卓系统进行广播、接收广播事件\n   * 注册和移除监听通过安卓系统来完成\n   * 安卓系统提供很多广播定义在`android.content.Intent`类中\n\n4. 广播方法\n\n   `sendBroadcast()`:普通模式\n\n   * 所有注册了广播的接收者会获得事件通知\n   * 接收者接受顺序不确定并发地在各自的应用进程中执行\n   * 接收者和发送者不知晓\n\n   `sendOrderedBroadcast()`:有序广播模式\n\n   * 接收者依照设定的优先级高低依次接受\n\n   * 高优先级接收者可以中断后续广播的接收，`BroadcastReceiver.abortBroadcast()`终止这个广播事件的传播，低优先级的触发器组件不再有机会接收\n\n   * 高优先级接收者可添加额外信息给后续接收者\n\n     `BroadcastReceiver.setResult()`\n\n5. 监听广播实现\n   * 获取广播事件的消息接口名称\n   * 事件定制的广播接收器，添加相应的处理逻辑\n   * 注册广播接收器到安卓系统中\n\n6. 监听广播实现示例\n\n```java\n   public class MyBroadcastReceiver extends BroadcastReceiver{\n   //action名称，此为固定的字符\n   String SMS_RECEIVED=\"android.provider.Telephony.SMS_RECEIVED\";\n   @Override\n   public void onReceive(COntext context, Intent intent){\n   //如事件有短信接收，则执行\n   if(intent.getAction().quals(SMS_RECEIVED)){\n   //进行短信接收到之后的逻辑处理\n   }\n   }\n   }\n```\n\n7. 监听广播注册\n\n   在manifest中注册监听器\n\n```java\n   <!--声明接收器-->\n   <receiver android:name = \".MyBroadReceiver\">\n   \t<!--接收事件的过滤条件声明和优先级-->\n   \t<intent-filter android:priority=\"1000\">\n   \t\t<!--支持接收的事件类型-->\n   \t<action android:name=\"android.provider.Telephony.SMS_RECEIVED\"/>\n        </intent-filter>\n   </receiver>\n   <!--监听系统级事件，需要相应的权限：接收者和发送短信的权限-->\n   <uses-permission android:name=\"android.permission.RECEIVE_SMS\"/>\n       <uses-permission android:name=\"android.permission.SEND_SMS\"/>\n```\n\n   在运行代码中注册广播监听器\n```java\n   //创建监听器对象\n   MyBroadcastReceiver myMsgInfoReceiver=new MyBroadcastReceiver();\n   //声明IntentFilter，描述可以接收的广播消息\n   IntentFilter intentFilter=new IntentFilter(\"android.provider.Telephony.SMS_RECEIED\");\n   //调用Activity的方法，注册监听器\n   registerReceiver(mBatteryInfoReceiver,intentFilter)\n```\n\n8. 广播事件生命周期\n   - 广播消息到来，新建BroadcastReceiver对象\n   - 调用`onReceive()`方法，执行操作\n   - 操作完成后，对象被销毁\n   - 事件出发—>创建事件监听器对象—>调用监听器的`onReceiver()`—>销毁事件监听器的对象—>结束操作，返回\n\n9. 广播事件注意事项\n   - 在广播接收器中响应逻辑中不能执行比较耗时的操作\n   - 在onReceive()方法中执行超过10秒，就会弹出无响应对话框。","source":"_posts/重温安卓编程.md","raw":"---\ntitle: JAVA安卓编程笔记\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2019-11-18 20:41:49\npassword:\nsummary: 大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。\ntags: 安卓编程\ncategories: 学习笔记\n---\n\n# 第一章 前言\n\n大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。\n\n两年前，我使用的还是联想的i5五系列cpu、机械硬盘、4g内存，这个电脑配置使得我当时用eplise开发安卓程序非常麻烦，打开一个安卓虚拟机需要花很长的时间。半年前，我更换了Surface，用上了8+128G内存+固态硬盘。也更新了最新的i5八系列cpu，电脑配置有了显著提高，运行安卓开发程序也游刃有余了。\n\n而这次重启安卓学习之旅，我将使用AS进行安卓开发。虽然AS目前已支持C/C++做程序开发，但我仍将选择JAVA作为开发语言，以提高我的JAVA水平。\n\n# 第二章 安装Android Studio\n\n从 https://developer.android.com/studio 下载IDE和SDK后，进行相应安装和配置。安装教程，从网课和CDSN论坛均可找到。不再赘述。\n\n此处说明安装时遇到的坑。\n\n1. SDK安装后，在SDK管理工具中添加SDK目录即andriod-sdk提示`android sdk location should not contain whitespace`\n\n2. 问题1解决后紧接着出现提示`Target folder is neither empty nor does it point to an existing SDK installtion.`\n\n问题分析和解决办法：\n\n1. 提示意思为SDK的目录路径中出现空格。在我的问题中是，Program Files文件夹名称中间有空格，于是我在根路径重新创建了一个以Andriod为名的文件夹，并将andriod-sdk移到此路径下。\n2. 提示为，选择的文件夹既不是空的也不是sdk的文件夹，原因是我将sdk目录指向了Andriod为名的文件夹，正确的路径是上步创建Andriod文件下的andriod-sdk。\n\n安装好SDK后，还要给AS安装虚拟机，运行AS后，在Tools菜单下找到AVD Manager（虚拟机管理器），添加合适分辨率、Andriod版本的虚拟机即可。\n\n# 第三章 应用的资源访问\n\n## 3.1 认识Android目录\n\n1. res资源\n   * drawable-？dpi（l,h,m,x）：不同分辨率下的资源文件，如图片的大小。\n   * values：安卓应用界面上需要显示的各类文本标签文字。\n   * layout：界面布局文件。\n   * menu：存放菜单\n\n2. gen（ADT中）或JAVA（AS中）\n\n   由IDE自动生成的包文件\n\n   \n\n## 3.2 通用资源访问\n\n1. 基于Java代码访问资源\n\n   * Java代码访问方式:\n   \n```java\n[\\<packge-name>.]R.   //R类所在包路径可省略\n<resource_type>.<resource_name>  //resource_type：资源类型如color等。\n```\n\n   * Java访问示例\n   \n   * //从drawable目录中加载图片，设置为背景图片\n\n```java\ngetWindow().setBackgroundDrawableResource(R.drawable.back)\n```\n\n   * //从string设置字符串资源，设置为文本框的显示内容\n\n```java\nTextView title=(TextView)findViewById(R.id.title);  \ntitle.setText(R.string.titleinfo);\n```\n\n2. 在XML配置文件中访问资源\n\n   * XML资源访问方式:\n\n```xml\n@[<package_name>:]\n<resource_type>/<resource_name>\n```\n\n   * XML资源定义示例\n\n```xml\n<resources>\n<color name=\" blue \" >#ff00ff</color>\n<string name=\" title \" >\nConfirmation</string>\n</resources>\n```\n\n   * 在XML中使用资源示例\n\n     * XML资源使用实例片段\n\n```xml\n<EditText android:layout_width=\"match_parent\"\n\tandroid:layout_height=\"match_parent\"\n\tandroid:text=\" @string/title\"\n\tandroid:textColor=\" @color/blue\" \n/>\n</EditText>\n```\n\n\n\n## 3.3 安卓中字符串、颜色和尺寸应用\n\n1. 资源列表\n\n   字符串、颜色、尺寸资源，存放在XML文件内，位于/res/values目录下。\n\n   如字符串资源：/res/values/strings.xml。R类中名称：R.string\n\n2. 颜色表示方法\n\n   * 使用Color类的常量\n\n     如：`int color = Color.BLUE;//创建一个蓝色`\n\n   * 使用Color类的静态方法argb创建颜色\n\n     `int color = Color.argb\\(127.255.0.255\\);//半透明紫色`\n\n   * 在XML资源文件定义颜色值\n\n```xml\n<resources>\n<color name=\" blue \" >#ff00ff</color>\n<string name=\" title \" >\nConfirmation</string>\n</resources>\n```\n\n3. 使用示例\n\n4. res和assets区别\n\n   * res内的文件被映射到R.java，基于资源ID直接访问。\n\n   * assets需通过资源管理器访问。\n\n   * res下不可以创建子目录，assets可以有目录结构。\n\n   * 读取文件资源的方式不同\n\n     * 读取res/raw下的文件资源，通过当前Activity中的`getResources()`方法：\n\n```java\nInputStream is = getResources().\nopenRawResource(R.id.filename);\n```\n\n- 读取assets下的文件资源，通过当前活动的资源管理器assetmanager读取相应的资源文件：\n\n```java\nAssetManager am = getAssets();//通过当前的Activity的getAsset()方法。\nInputStream is = am.open(\"filename\");//基于文件名读取资源。\n```\n\n\n\n## 3.4 Drawable资源\n\n1. Drawable资源\n\n   * 主要是需要绘制的资源，比如图片资源。\n\n   * 主要格式有\\*.png、\\*.jpg等。\n\n   * 图片放入/res/drawable-xxx目录下。\n\n   * 安卓SDK会在编译应用自动加载图片。\n\n   * 资源文件在R.java资源类中生成该资源的索引。\n\n2. Drawable资源类型\n\n   * StateListDrawable资源（动态切换背景）\n   * LayerDrawable资源（图层叠加）\n   * ShapeDrawable资源（绘图）\n   * ClipDrawable资源\n   * AnimationDrawable资源（动画）\n\n\n\n## 3.5 安卓项目布局文件\n\n1. 什么是安卓布局文件？\n   * 定义用户界面上各个组建之间的组织结构。\n   * XML格式文件，安卓系统负责初始化。\n   * 实现界面布局和逻辑代码的分离。\n   * 修改和更新界面非常简便，无需修改代码。\n   * 布局文件是树形结构，使用根节点。\n   * 一般在布局控件中放置界面显示组建LinearLayout中放入textview文本标签\n   * 通过节点属性设置显示界面组建的属性：大小、颜色和边距等。\n\n2. 布局示例\n\n3. 布局文件节点属性示例\n\n   `android:id=\"@+id/button_id\"`\n\n   * @表示XML解析器应该解析ID字符串把它作为ID资源。\n   * +符号表示一个新的资源名字，会被创建且加入到资源列表中（R.java）\n   * @string/@color等可用于访问其他资源。\n   * 组建id在android应用中是唯一的。\n\n| 主题              | 内容                                                         |\n| ----------------- | :----------------------------------------------------------- |\n| 资源位置          | res/layout/my_layout.xml                                     |\n| 布局XML文件格式   | 使用&lt;?xml version= \"1.0\"encoding=\"utf-8\" ?><br>&lt;布局类xmlns:android=\"http://schemas.android.<br>Com/apk/res/android\" id= \"@id+/string_na`<br>`me\"(属性)><br>&lt;视图组件或者其他嵌套布局类><br>&lt;requestFocus/><br>&lt;/布局类> |\n| 获得XML资源的方法 | Activity.setContentView()                                    |\n| 引用XML资源的格式 | Java代码中：R.layout.my_layout。<br>XML文件中：@[package:]layout/my_layout |\n| 资源位置          | res/layout/my_layout.xml                                     |\n\n\n\n## 3.6 AndroidManifest.xml项目配置文件\n\n1. 什么是AndroidManifest.xml\n\n   位于根目录下，文件名不可修改。\n\n   该文件中 &lt;manifest>和 &lt;application>是必需的且只能出现一次。\n\n2. 描述Android应用使用的组建和系统配置信息\n\n   * 应用使用的组建及其实现类（Activity/Service等）\n   * 需要使用的安卓系统权限。\n   * 声明其他应用程序与该应用程序交互需要的权限\n   * 该应用程序所需的安卓API版本。\n   * 列出该应用程序所需类库。\n\n   \n\n# 第四章 界面编程任务分析与设计\n\n\n\n## 4.1 循序渐进\n\n1. Activity简介\n   * 安卓的视图组件，四大组件之一。\n   * 定义用户可以看到触摸到的界面。\n   * 活动内使用各种界面组件，实现交互动作。\n   * 通过活动，用户界面之间切换跳转、进行数据传递。\n\n2. Activity概念\n   \n* 用来包装用户界面组件的容器，实现用户和界面组件之间的交互。\n  \n3. 案列分析教学特点和注意事项\n   * 界面编程案例分析教学特点\n     * 案例：基于安卓系统的计算器\n     * 特点：案例驱动，实践先行\n     * 优势：在实践中学习抽象的概念\n   * 界面编程案例分析注意事项\n     * 知识要点：活动的概念和使用\n     * 分析技巧：如何将实际中的问题进行分析；分析问题和解决问题的方法\n     * 编码技巧：在案例中学习编码技巧\n\n4. 计算器案例\n\n   * 操作过程：\n\n     1. 用户输入两个计算数；\n\n     2. 选择计算类型；\n\n     3. 点击计算按钮，进行计算\n\n     4. 将结果展示给用户\n\n        \n\n## 4.2 活动的创建和使用\n\n1. 创建活动应用程序\n   * 应用程序通常由多个活动松耦合的组成\n   * 活动是界面上的组件在屏幕上展示的容器\n   * 活动通过布局文件展示界面布局的内容\n   * 活动的生命周期，利用周期的方法扩展\n\n2. 创建活动步骤\n   * 声明活动类名，继承于活动\n   * 实现`onCreate(Bundle bundle)`方法，在系统初始化完成活动对象之后，进行用户自定义的初始化活动\n   * 在`onCreate(View view)`设置用户界面的布局文件\n   * 通过活动中的`findViewById(int id)`获取各个界面组件，并基于其属性和方法进行相应的操作\n   * 如果需要在销毁活动进行处理，可以实现`onDestroy()`的方法。\n\n\n\n## 4.3 活动的声明和配置\n\n1. 活动的声明和配置\n\n   * 活动定义后需在AndroidManifest.xml中声明\n\n   * `<application.../>·节点内添加·<activity.../>·子元素\n\n   * 在`<activity>`子节点内定义Activity的类型（入口活动）\n\n```java\n<activity android:name=\"com.quck.android.calculator\"\nandroid:icon=\"@drawable/pic.png\"\nandroid:label=\"@string/app_name\" >\n//略去其中内容\n</activity>\n```\n\n2. 配置活动——示例分析\n\n   活动的主要配置属性有如下三个：\n\n   * name：指定该活动的类名\n\n   * icon：是定该活动对象的图标（可选）\n\n   * label：指定该活动的标签\n\n   * 在`<activity>`节点中指定一个或者多个`<intent-filter.../>`元素Intent的类型和Action决定活动是否会接收消息。\n\n     \n\n## 4.4 活动之间的数据交换和调用\n\n1. 活动之间的数据交换和调用\n   * 活动之间跳转，需传递数据信息\n   * 通过Intent来进行数据传递\n   * 数据需要放入Intent或者Bundle之内\n\n2. 什么是Bundle？\n   \n* Bundle类是一个key-value对，一个映射，把字符串映射为各种类型。\n  \n3. 数据交换\n   * 写入数据\n     * `putExtras(Bundle data)`向Intent中放入需要携带的Bundle数据\n     * `putXXX(String key, Xxx data)`向Bundle放入Int,Long,String等各种类型的数据\n     * `putSerializable(String key, Serialzable data)`:向Bundle中放入一份可序列化对象\n   * 读取数据\n     * `getExtras()`从Intent中读取需要携带的Bundle数据\n     * `getXXX(String key)`从Bundle，Intent读取int,Long,String等各种类型的数据\n     * `getSerializable(String key)`从Bundle，Intent中读取一个可序列化的对象\n   * 活动交换示例\n   * Intent vs Bundle\n     * 相同点：传递数据时，作用相同\n     * 不同点：在多个活动之间传递相同数据时，推荐使用Bundle来储存和传递数据，减少重复的读写操作\n     * 例：活动跳转A->B->C传递相同数据\n       * 如果使用Intent，则需要在A、B、C的Intent之间进行数据的复制\n       * 如果使用Bundle，则可直接传递Bundle对象即可\n\n4. 返回数据\n\n   * `startActivityForResult(Intent intent, int requestCode)`\n\n     跳转到指定的活动\n\n     参数intent：指定目的活动类名\n\n     参数requestCode：由程序中自定义的识别码，用以区分不同的七点活动\n\n   * `setResult(int resultCode, Intent data)`\n\n     设置resultCode表示结果的Activity，第二个参数保存传递的结果数据\n\n   * `onActivityResult(int requestCode, int resultCode, Intent data)`\n\n     参数requestCode：起点活动定义唯一值\n\n     参数resultCode：目的活动定义的唯一标识值\n\n     参数data：从墓地活动返回的数据\n\n5. 数据使用步骤\n   * 起点活动，调用`startActivityForResult()`跳转目的活动\n   * 在目的活动中调用`setResult()`\n   * 在起点活动覆写`onActivityResult()`在方法内获取目的活动返回的数据\n\n\n\n# 第五章 服务开发和广播事件\n\n\n\n## 5.1 循序渐进\n\n* 案列：音乐播放器\n\n  * 任务概述\n\n  * 功能分析\n\n    界面设计\n\n    实现暂停、播放和停止\n\n    播放同时，显示歌手和音乐名称\n\n  * 用户界面设计\n\n    主界面\n\n  * 技术要点\n\n    服务的创建、调用\n\n    服务和活动之间的通信\n\n    Intent对象的使用\n\n  * 案例演示\n\n* 案例任务分析和设计\n\n  音乐播放器界面分析\n\n* 核心代码设计和实现\n\n  核心代码编写步骤：\n\n  1. 创建安卓项目MusicBox\n  2. 在res/loyout目录，创建播放器的主界面布局文件\n  3. 定义一个MusicBoxContant的常量类存放程序中用到的静态或不变的信息\n  4. 创建音乐播放器的服务类\n  5. 在全局配置文件中，声明服务类\n  6. 定义实现音乐播放器的主界面\n  7. 定义事项ActicityReciver事件接收器，接受音乐服务状态变化广播事件的接收器\n  8. 定义实现按钮事件接收器，播放和停止按钮，发送广播事件\n\n   \n\n## 5.2 安卓中的系统服务\n\n* 安卓将诸多常用功能内置为系统服务\n\n* 提供简单的获取系统服务的方式\n\n* 系统服务涵盖了安卓绝大部分常用功能，如，拨打电话，发送短信\n\n1. 安卓中获取系统服务\n\n   * 获取系统服务代码示例\n\n     `TelephonyManager phoneManager=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);`\n\n   * 强制类型转化\n\n     * 在程序运行过程中，将父类型对象转化为子类型对象。\n     * 由于子类型相比父类型的内涵丰富，属性方法更多，所以要把父类型转化为子类型时，需要强制转化，成为强制类型转换。\n     * 并不是所有父类型都可以转化为子类型，要根据具体的使用情况来做具体的判断。\n\n\n\n## 5.3 广播接收机制\n\n1. 广播消息\n   * 广播是一种在应用程序之间传输信息的计指\n   * BroadcastReceiver广播接收者\n   * 广播消息Intent（消息载体）\n   * 被订阅广播的多个广播接收者接收\n   * 消息订阅者不了解发送者\n2. 广播接收者\n   * BroadcastReceiver对发出的广播事件进行过滤，应用程序通知其他应用程序某些数据已经下载完毕。\n   * 广播接收者没有图形界面\n   * 广播可以有多个接收者，彼此不知晓。广播接收者之间匿名\n\n3. 监听广播机制\n   * 广播和事件监听器是分离的\n   * 通过安卓系统进行广播、接收广播事件\n   * 注册和移除监听通过安卓系统来完成\n   * 安卓系统提供很多广播定义在`android.content.Intent`类中\n\n4. 广播方法\n\n   `sendBroadcast()`:普通模式\n\n   * 所有注册了广播的接收者会获得事件通知\n   * 接收者接受顺序不确定并发地在各自的应用进程中执行\n   * 接收者和发送者不知晓\n\n   `sendOrderedBroadcast()`:有序广播模式\n\n   * 接收者依照设定的优先级高低依次接受\n\n   * 高优先级接收者可以中断后续广播的接收，`BroadcastReceiver.abortBroadcast()`终止这个广播事件的传播，低优先级的触发器组件不再有机会接收\n\n   * 高优先级接收者可添加额外信息给后续接收者\n\n     `BroadcastReceiver.setResult()`\n\n5. 监听广播实现\n   * 获取广播事件的消息接口名称\n   * 事件定制的广播接收器，添加相应的处理逻辑\n   * 注册广播接收器到安卓系统中\n\n6. 监听广播实现示例\n\n```java\n   public class MyBroadcastReceiver extends BroadcastReceiver{\n   //action名称，此为固定的字符\n   String SMS_RECEIVED=\"android.provider.Telephony.SMS_RECEIVED\";\n   @Override\n   public void onReceive(COntext context, Intent intent){\n   //如事件有短信接收，则执行\n   if(intent.getAction().quals(SMS_RECEIVED)){\n   //进行短信接收到之后的逻辑处理\n   }\n   }\n   }\n```\n\n7. 监听广播注册\n\n   在manifest中注册监听器\n\n```java\n   <!--声明接收器-->\n   <receiver android:name = \".MyBroadReceiver\">\n   \t<!--接收事件的过滤条件声明和优先级-->\n   \t<intent-filter android:priority=\"1000\">\n   \t\t<!--支持接收的事件类型-->\n   \t<action android:name=\"android.provider.Telephony.SMS_RECEIVED\"/>\n        </intent-filter>\n   </receiver>\n   <!--监听系统级事件，需要相应的权限：接收者和发送短信的权限-->\n   <uses-permission android:name=\"android.permission.RECEIVE_SMS\"/>\n       <uses-permission android:name=\"android.permission.SEND_SMS\"/>\n```\n\n   在运行代码中注册广播监听器\n```java\n   //创建监听器对象\n   MyBroadcastReceiver myMsgInfoReceiver=new MyBroadcastReceiver();\n   //声明IntentFilter，描述可以接收的广播消息\n   IntentFilter intentFilter=new IntentFilter(\"android.provider.Telephony.SMS_RECEIED\");\n   //调用Activity的方法，注册监听器\n   registerReceiver(mBatteryInfoReceiver,intentFilter)\n```\n\n8. 广播事件生命周期\n   - 广播消息到来，新建BroadcastReceiver对象\n   - 调用`onReceive()`方法，执行操作\n   - 操作完成后，对象被销毁\n   - 事件出发—>创建事件监听器对象—>调用监听器的`onReceiver()`—>销毁事件监听器的对象—>结束操作，返回\n\n9. 广播事件注意事项\n   - 在广播接收器中响应逻辑中不能执行比较耗时的操作\n   - 在onReceive()方法中执行超过10秒，就会弹出无响应对话框。","slug":"重温安卓编程","published":1,"updated":"2020-06-20T06:47:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgaxsaew006pp0vz6wf12gtd","content":"<h1 id=\"第一章-前言\"><a href=\"#第一章-前言\" class=\"headerlink\" title=\"第一章 前言\"></a>第一章 前言</h1><p>大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。</p>\n<p>两年前，我使用的还是联想的i5五系列cpu、机械硬盘、4g内存，这个电脑配置使得我当时用eplise开发安卓程序非常麻烦，打开一个安卓虚拟机需要花很长的时间。半年前，我更换了Surface，用上了8+128G内存+固态硬盘。也更新了最新的i5八系列cpu，电脑配置有了显著提高，运行安卓开发程序也游刃有余了。</p>\n<p>而这次重启安卓学习之旅，我将使用AS进行安卓开发。虽然AS目前已支持C/C++做程序开发，但我仍将选择JAVA作为开发语言，以提高我的JAVA水平。</p>\n<h1 id=\"第二章-安装Android-Studio\"><a href=\"#第二章-安装Android-Studio\" class=\"headerlink\" title=\"第二章 安装Android Studio\"></a>第二章 安装Android Studio</h1><p>从 <a href=\"https://developer.android.com/studio\">https://developer.android.com/studio</a> 下载IDE和SDK后，进行相应安装和配置。安装教程，从网课和CDSN论坛均可找到。不再赘述。</p>\n<p>此处说明安装时遇到的坑。</p>\n<ol>\n<li><p>SDK安装后，在SDK管理工具中添加SDK目录即andriod-sdk提示<code>android sdk location should not contain whitespace</code></p>\n</li>\n<li><p>问题1解决后紧接着出现提示<code>Target folder is neither empty nor does it point to an existing SDK installtion.</code></p>\n</li>\n</ol>\n<p>问题分析和解决办法：</p>\n<ol>\n<li>提示意思为SDK的目录路径中出现空格。在我的问题中是，Program Files文件夹名称中间有空格，于是我在根路径重新创建了一个以Andriod为名的文件夹，并将andriod-sdk移到此路径下。</li>\n<li>提示为，选择的文件夹既不是空的也不是sdk的文件夹，原因是我将sdk目录指向了Andriod为名的文件夹，正确的路径是上步创建Andriod文件下的andriod-sdk。</li>\n</ol>\n<p>安装好SDK后，还要给AS安装虚拟机，运行AS后，在Tools菜单下找到AVD Manager（虚拟机管理器），添加合适分辨率、Andriod版本的虚拟机即可。</p>\n<h1 id=\"第三章-应用的资源访问\"><a href=\"#第三章-应用的资源访问\" class=\"headerlink\" title=\"第三章 应用的资源访问\"></a>第三章 应用的资源访问</h1><h2 id=\"3-1-认识Android目录\"><a href=\"#3-1-认识Android目录\" class=\"headerlink\" title=\"3.1 认识Android目录\"></a>3.1 认识Android目录</h2><ol>\n<li><p>res资源</p>\n<ul>\n<li>drawable-？dpi（l,h,m,x）：不同分辨率下的资源文件，如图片的大小。</li>\n<li>values：安卓应用界面上需要显示的各类文本标签文字。</li>\n<li>layout：界面布局文件。</li>\n<li>menu：存放菜单</li>\n</ul>\n</li>\n<li><p>gen（ADT中）或JAVA（AS中）</p>\n<p>由IDE自动生成的包文件</p>\n</li>\n</ol>\n<h2 id=\"3-2-通用资源访问\"><a href=\"#3-2-通用资源访问\" class=\"headerlink\" title=\"3.2 通用资源访问\"></a>3.2 通用资源访问</h2><ol>\n<li><p>基于Java代码访问资源</p>\n<ul>\n<li>Java代码访问方式:</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[\\&lt;packge-name&gt;.]R.   <span class=\"comment\">//R类所在包路径可省略</span></span><br><span class=\"line\">&lt;resource_type&gt;.&lt;resource_name&gt;  <span class=\"comment\">//resource_type：资源类型如color等。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>Java访问示例</p>\n</li>\n<li><p>//从drawable目录中加载图片，设置为背景图片</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getWindow().setBackgroundDrawableResource(R.drawable.back)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>//从string设置字符串资源，设置为文本框的显示内容</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TextView title=(TextView)findViewById(R.id.title);  </span><br><span class=\"line\">title.setText(R.string.titleinfo);</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>在XML配置文件中访问资源</p>\n<ul>\n<li>XML资源访问方式:</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@[<span class=\"tag\">&lt;<span class=\"name\">package_name</span>&gt;</span>:]</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resource_type</span>&gt;</span>/<span class=\"tag\">&lt;<span class=\"name\">resource_name</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>XML资源定义示例</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">color</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; blue &quot;</span> &gt;</span>#ff00ff<span class=\"tag\">&lt;/<span class=\"name\">color</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; title &quot;</span> &gt;</span></span><br><span class=\"line\">Confirmation<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在XML中使用资源示例</p>\n<ul>\n<li>XML资源使用实例片段</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">android:text</span>=<span class=\"string\">&quot; @string/title&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">android:textColor</span>=<span class=\"string\">&quot; @color/blue&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">EditText</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-3-安卓中字符串、颜色和尺寸应用\"><a href=\"#3-3-安卓中字符串、颜色和尺寸应用\" class=\"headerlink\" title=\"3.3 安卓中字符串、颜色和尺寸应用\"></a>3.3 安卓中字符串、颜色和尺寸应用</h2><ol>\n<li><p>资源列表</p>\n<p>字符串、颜色、尺寸资源，存放在XML文件内，位于/res/values目录下。</p>\n<p>如字符串资源：/res/values/strings.xml。R类中名称：R.string</p>\n</li>\n<li><p>颜色表示方法</p>\n<ul>\n<li><p>使用Color类的常量</p>\n<p>如：<code>int color = Color.BLUE;//创建一个蓝色</code></p>\n</li>\n<li><p>使用Color类的静态方法argb创建颜色</p>\n<p><code>int color = Color.argb\\(127.255.0.255\\);//半透明紫色</code></p>\n</li>\n<li><p>在XML资源文件定义颜色值</p>\n</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">color</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; blue &quot;</span> &gt;</span>#ff00ff<span class=\"tag\">&lt;/<span class=\"name\">color</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; title &quot;</span> &gt;</span></span><br><span class=\"line\">Confirmation<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>使用示例</p>\n</li>\n<li><p>res和assets区别</p>\n<ul>\n<li><p>res内的文件被映射到R.java，基于资源ID直接访问。</p>\n</li>\n<li><p>assets需通过资源管理器访问。</p>\n</li>\n<li><p>res下不可以创建子目录，assets可以有目录结构。</p>\n</li>\n<li><p>读取文件资源的方式不同</p>\n<ul>\n<li>读取res/raw下的文件资源，通过当前Activity中的<code>getResources()</code>方法：</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">InputStream is = getResources().</span><br><span class=\"line\">openRawResource(R.id.filename);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>读取assets下的文件资源，通过当前活动的资源管理器assetmanager读取相应的资源文件：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AssetManager am = getAssets();<span class=\"comment\">//通过当前的Activity的getAsset()方法。</span></span><br><span class=\"line\">InputStream is = am.open(<span class=\"string\">&quot;filename&quot;</span>);<span class=\"comment\">//基于文件名读取资源。</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-4-Drawable资源\"><a href=\"#3-4-Drawable资源\" class=\"headerlink\" title=\"3.4 Drawable资源\"></a>3.4 Drawable资源</h2><ol>\n<li><p>Drawable资源</p>\n<ul>\n<li><p>主要是需要绘制的资源，比如图片资源。</p>\n</li>\n<li><p>主要格式有*.png、*.jpg等。</p>\n</li>\n<li><p>图片放入/res/drawable-xxx目录下。</p>\n</li>\n<li><p>安卓SDK会在编译应用自动加载图片。</p>\n</li>\n<li><p>资源文件在R.java资源类中生成该资源的索引。</p>\n</li>\n</ul>\n</li>\n<li><p>Drawable资源类型</p>\n<ul>\n<li>StateListDrawable资源（动态切换背景）</li>\n<li>LayerDrawable资源（图层叠加）</li>\n<li>ShapeDrawable资源（绘图）</li>\n<li>ClipDrawable资源</li>\n<li>AnimationDrawable资源（动画）</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"3-5-安卓项目布局文件\"><a href=\"#3-5-安卓项目布局文件\" class=\"headerlink\" title=\"3.5 安卓项目布局文件\"></a>3.5 安卓项目布局文件</h2><ol>\n<li><p>什么是安卓布局文件？</p>\n<ul>\n<li>定义用户界面上各个组建之间的组织结构。</li>\n<li>XML格式文件，安卓系统负责初始化。</li>\n<li>实现界面布局和逻辑代码的分离。</li>\n<li>修改和更新界面非常简便，无需修改代码。</li>\n<li>布局文件是树形结构，使用根节点。</li>\n<li>一般在布局控件中放置界面显示组建LinearLayout中放入textview文本标签</li>\n<li>通过节点属性设置显示界面组建的属性：大小、颜色和边距等。</li>\n</ul>\n</li>\n<li><p>布局示例</p>\n</li>\n<li><p>布局文件节点属性示例</p>\n<p><code>android:id=&quot;@+id/button_id&quot;</code></p>\n<ul>\n<li>@表示XML解析器应该解析ID字符串把它作为ID资源。</li>\n<li>+符号表示一个新的资源名字，会被创建且加入到资源列表中（R.java）</li>\n<li>@string/@color等可用于访问其他资源。</li>\n<li>组建id在android应用中是唯一的。</li>\n</ul>\n</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>主题</th>\n<th align=\"left\">内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>资源位置</td>\n<td align=\"left\">res/layout/my_layout.xml</td>\n</tr>\n<tr>\n<td>布局XML文件格式</td>\n<td align=\"left\">使用&lt;?xml version= “1.0”encoding=”utf-8” ?&gt;<br>&lt;布局类xmlns:android=”<a href=\"http://schemas.android/\">http://schemas.android</a>.<br>Com/apk/res/android” id= “@id+/string_na<code>&lt;br&gt;</code>me”(属性)&gt;<br>&lt;视图组件或者其他嵌套布局类&gt;<br>&lt;requestFocus/&gt;<br>&lt;/布局类&gt;</td>\n</tr>\n<tr>\n<td>获得XML资源的方法</td>\n<td align=\"left\">Activity.setContentView()</td>\n</tr>\n<tr>\n<td>引用XML资源的格式</td>\n<td align=\"left\">Java代码中：R.layout.my_layout。<br>XML文件中：@[package:]layout/my_layout</td>\n</tr>\n<tr>\n<td>资源位置</td>\n<td align=\"left\">res/layout/my_layout.xml</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-6-AndroidManifest-xml项目配置文件\"><a href=\"#3-6-AndroidManifest-xml项目配置文件\" class=\"headerlink\" title=\"3.6 AndroidManifest.xml项目配置文件\"></a>3.6 AndroidManifest.xml项目配置文件</h2><ol>\n<li><p>什么是AndroidManifest.xml</p>\n<p>位于根目录下，文件名不可修改。</p>\n<p>该文件中 &lt;manifest&gt;和 &lt;application&gt;是必需的且只能出现一次。</p>\n</li>\n<li><p>描述Android应用使用的组建和系统配置信息</p>\n<ul>\n<li>应用使用的组建及其实现类（Activity/Service等）</li>\n<li>需要使用的安卓系统权限。</li>\n<li>声明其他应用程序与该应用程序交互需要的权限</li>\n<li>该应用程序所需的安卓API版本。</li>\n<li>列出该应用程序所需类库。</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"第四章-界面编程任务分析与设计\"><a href=\"#第四章-界面编程任务分析与设计\" class=\"headerlink\" title=\"第四章 界面编程任务分析与设计\"></a>第四章 界面编程任务分析与设计</h1><h2 id=\"4-1-循序渐进\"><a href=\"#4-1-循序渐进\" class=\"headerlink\" title=\"4.1 循序渐进\"></a>4.1 循序渐进</h2><ol>\n<li><p>Activity简介</p>\n<ul>\n<li>安卓的视图组件，四大组件之一。</li>\n<li>定义用户可以看到触摸到的界面。</li>\n<li>活动内使用各种界面组件，实现交互动作。</li>\n<li>通过活动，用户界面之间切换跳转、进行数据传递。</li>\n</ul>\n</li>\n<li><p>Activity概念</p>\n</li>\n</ol>\n<ul>\n<li>用来包装用户界面组件的容器，实现用户和界面组件之间的交互。</li>\n</ul>\n<ol start=\"3\">\n<li><p>案列分析教学特点和注意事项</p>\n<ul>\n<li>界面编程案例分析教学特点<ul>\n<li>案例：基于安卓系统的计算器</li>\n<li>特点：案例驱动，实践先行</li>\n<li>优势：在实践中学习抽象的概念</li>\n</ul>\n</li>\n<li>界面编程案例分析注意事项<ul>\n<li>知识要点：活动的概念和使用</li>\n<li>分析技巧：如何将实际中的问题进行分析；分析问题和解决问题的方法</li>\n<li>编码技巧：在案例中学习编码技巧</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>计算器案例</p>\n<ul>\n<li><p>操作过程：</p>\n<ol>\n<li><p>用户输入两个计算数；</p>\n</li>\n<li><p>选择计算类型；</p>\n</li>\n<li><p>点击计算按钮，进行计算</p>\n</li>\n<li><p>将结果展示给用户</p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"4-2-活动的创建和使用\"><a href=\"#4-2-活动的创建和使用\" class=\"headerlink\" title=\"4.2 活动的创建和使用\"></a>4.2 活动的创建和使用</h2><ol>\n<li><p>创建活动应用程序</p>\n<ul>\n<li>应用程序通常由多个活动松耦合的组成</li>\n<li>活动是界面上的组件在屏幕上展示的容器</li>\n<li>活动通过布局文件展示界面布局的内容</li>\n<li>活动的生命周期，利用周期的方法扩展</li>\n</ul>\n</li>\n<li><p>创建活动步骤</p>\n<ul>\n<li>声明活动类名，继承于活动</li>\n<li>实现<code>onCreate(Bundle bundle)</code>方法，在系统初始化完成活动对象之后，进行用户自定义的初始化活动</li>\n<li>在<code>onCreate(View view)</code>设置用户界面的布局文件</li>\n<li>通过活动中的<code>findViewById(int id)</code>获取各个界面组件，并基于其属性和方法进行相应的操作</li>\n<li>如果需要在销毁活动进行处理，可以实现<code>onDestroy()</code>的方法。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"4-3-活动的声明和配置\"><a href=\"#4-3-活动的声明和配置\" class=\"headerlink\" title=\"4.3 活动的声明和配置\"></a>4.3 活动的声明和配置</h2><ol>\n<li><p>活动的声明和配置</p>\n<ul>\n<li><p>活动定义后需在AndroidManifest.xml中声明</p>\n</li>\n<li><p>`&lt;application…/&gt;·节点内添加·&lt;activity…/&gt;·子元素</p>\n</li>\n<li><p>在<code>&lt;activity&gt;</code>子节点内定义Activity的类型（入口活动）</p>\n</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;activity android:name=<span class=\"string\">&quot;com.quck.android.calculator&quot;</span></span><br><span class=\"line\">android:icon=<span class=\"string\">&quot;@drawable/pic.png&quot;</span></span><br><span class=\"line\">android:label=<span class=\"string\">&quot;@string/app_name&quot;</span> &gt;</span><br><span class=\"line\"><span class=\"comment\">//略去其中内容</span></span><br><span class=\"line\">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>配置活动——示例分析</p>\n<p>活动的主要配置属性有如下三个：</p>\n<ul>\n<li><p>name：指定该活动的类名</p>\n</li>\n<li><p>icon：是定该活动对象的图标（可选）</p>\n</li>\n<li><p>label：指定该活动的标签</p>\n</li>\n<li><p>在<code>&lt;activity&gt;</code>节点中指定一个或者多个<code>&lt;intent-filter.../&gt;</code>元素Intent的类型和Action决定活动是否会接收消息。</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"4-4-活动之间的数据交换和调用\"><a href=\"#4-4-活动之间的数据交换和调用\" class=\"headerlink\" title=\"4.4 活动之间的数据交换和调用\"></a>4.4 活动之间的数据交换和调用</h2><ol>\n<li><p>活动之间的数据交换和调用</p>\n<ul>\n<li>活动之间跳转，需传递数据信息</li>\n<li>通过Intent来进行数据传递</li>\n<li>数据需要放入Intent或者Bundle之内</li>\n</ul>\n</li>\n<li><p>什么是Bundle？</p>\n</li>\n</ol>\n<ul>\n<li>Bundle类是一个key-value对，一个映射，把字符串映射为各种类型。</li>\n</ul>\n<ol start=\"3\">\n<li><p>数据交换</p>\n<ul>\n<li>写入数据<ul>\n<li><code>putExtras(Bundle data)</code>向Intent中放入需要携带的Bundle数据</li>\n<li><code>putXXX(String key, Xxx data)</code>向Bundle放入Int,Long,String等各种类型的数据</li>\n<li><code>putSerializable(String key, Serialzable data)</code>:向Bundle中放入一份可序列化对象</li>\n</ul>\n</li>\n<li>读取数据<ul>\n<li><code>getExtras()</code>从Intent中读取需要携带的Bundle数据</li>\n<li><code>getXXX(String key)</code>从Bundle，Intent读取int,Long,String等各种类型的数据</li>\n<li><code>getSerializable(String key)</code>从Bundle，Intent中读取一个可序列化的对象</li>\n</ul>\n</li>\n<li>活动交换示例</li>\n<li>Intent vs Bundle<ul>\n<li>相同点：传递数据时，作用相同</li>\n<li>不同点：在多个活动之间传递相同数据时，推荐使用Bundle来储存和传递数据，减少重复的读写操作</li>\n<li>例：活动跳转A-&gt;B-&gt;C传递相同数据<ul>\n<li>如果使用Intent，则需要在A、B、C的Intent之间进行数据的复制</li>\n<li>如果使用Bundle，则可直接传递Bundle对象即可</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>返回数据</p>\n<ul>\n<li><p><code>startActivityForResult(Intent intent, int requestCode)</code></p>\n<p>跳转到指定的活动</p>\n<p>参数intent：指定目的活动类名</p>\n<p>参数requestCode：由程序中自定义的识别码，用以区分不同的七点活动</p>\n</li>\n<li><p><code>setResult(int resultCode, Intent data)</code></p>\n<p>设置resultCode表示结果的Activity，第二个参数保存传递的结果数据</p>\n</li>\n<li><p><code>onActivityResult(int requestCode, int resultCode, Intent data)</code></p>\n<p>参数requestCode：起点活动定义唯一值</p>\n<p>参数resultCode：目的活动定义的唯一标识值</p>\n<p>参数data：从墓地活动返回的数据</p>\n</li>\n</ul>\n</li>\n<li><p>数据使用步骤</p>\n<ul>\n<li>起点活动，调用<code>startActivityForResult()</code>跳转目的活动</li>\n<li>在目的活动中调用<code>setResult()</code></li>\n<li>在起点活动覆写<code>onActivityResult()</code>在方法内获取目的活动返回的数据</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"第五章-服务开发和广播事件\"><a href=\"#第五章-服务开发和广播事件\" class=\"headerlink\" title=\"第五章 服务开发和广播事件\"></a>第五章 服务开发和广播事件</h1><h2 id=\"5-1-循序渐进\"><a href=\"#5-1-循序渐进\" class=\"headerlink\" title=\"5.1 循序渐进\"></a>5.1 循序渐进</h2><ul>\n<li><p>案列：音乐播放器</p>\n<ul>\n<li><p>任务概述</p>\n</li>\n<li><p>功能分析</p>\n<p>界面设计</p>\n<p>实现暂停、播放和停止</p>\n<p>播放同时，显示歌手和音乐名称</p>\n</li>\n<li><p>用户界面设计</p>\n<p>主界面</p>\n</li>\n<li><p>技术要点</p>\n<p>服务的创建、调用</p>\n<p>服务和活动之间的通信</p>\n<p>Intent对象的使用</p>\n</li>\n<li><p>案例演示</p>\n</li>\n</ul>\n</li>\n<li><p>案例任务分析和设计</p>\n<p>音乐播放器界面分析</p>\n</li>\n<li><p>核心代码设计和实现</p>\n<p>核心代码编写步骤：</p>\n<ol>\n<li>创建安卓项目MusicBox</li>\n<li>在res/loyout目录，创建播放器的主界面布局文件</li>\n<li>定义一个MusicBoxContant的常量类存放程序中用到的静态或不变的信息</li>\n<li>创建音乐播放器的服务类</li>\n<li>在全局配置文件中，声明服务类</li>\n<li>定义实现音乐播放器的主界面</li>\n<li>定义事项ActicityReciver事件接收器，接受音乐服务状态变化广播事件的接收器</li>\n<li>定义实现按钮事件接收器，播放和停止按钮，发送广播事件</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"5-2-安卓中的系统服务\"><a href=\"#5-2-安卓中的系统服务\" class=\"headerlink\" title=\"5.2 安卓中的系统服务\"></a>5.2 安卓中的系统服务</h2><ul>\n<li><p>安卓将诸多常用功能内置为系统服务</p>\n</li>\n<li><p>提供简单的获取系统服务的方式</p>\n</li>\n<li><p>系统服务涵盖了安卓绝大部分常用功能，如，拨打电话，发送短信</p>\n</li>\n</ul>\n<ol>\n<li><p>安卓中获取系统服务</p>\n<ul>\n<li><p>获取系统服务代码示例</p>\n<p><code>TelephonyManager phoneManager=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);</code></p>\n</li>\n<li><p>强制类型转化</p>\n<ul>\n<li>在程序运行过程中，将父类型对象转化为子类型对象。</li>\n<li>由于子类型相比父类型的内涵丰富，属性方法更多，所以要把父类型转化为子类型时，需要强制转化，成为强制类型转换。</li>\n<li>并不是所有父类型都可以转化为子类型，要根据具体的使用情况来做具体的判断。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"5-3-广播接收机制\"><a href=\"#5-3-广播接收机制\" class=\"headerlink\" title=\"5.3 广播接收机制\"></a>5.3 广播接收机制</h2><ol>\n<li><p>广播消息</p>\n<ul>\n<li>广播是一种在应用程序之间传输信息的计指</li>\n<li>BroadcastReceiver广播接收者</li>\n<li>广播消息Intent（消息载体）</li>\n<li>被订阅广播的多个广播接收者接收</li>\n<li>消息订阅者不了解发送者</li>\n</ul>\n</li>\n<li><p>广播接收者</p>\n<ul>\n<li>BroadcastReceiver对发出的广播事件进行过滤，应用程序通知其他应用程序某些数据已经下载完毕。</li>\n<li>广播接收者没有图形界面</li>\n<li>广播可以有多个接收者，彼此不知晓。广播接收者之间匿名</li>\n</ul>\n</li>\n<li><p>监听广播机制</p>\n<ul>\n<li>广播和事件监听器是分离的</li>\n<li>通过安卓系统进行广播、接收广播事件</li>\n<li>注册和移除监听通过安卓系统来完成</li>\n<li>安卓系统提供很多广播定义在<code>android.content.Intent</code>类中</li>\n</ul>\n</li>\n<li><p>广播方法</p>\n<p><code>sendBroadcast()</code>:普通模式</p>\n<ul>\n<li>所有注册了广播的接收者会获得事件通知</li>\n<li>接收者接受顺序不确定并发地在各自的应用进程中执行</li>\n<li>接收者和发送者不知晓</li>\n</ul>\n<p><code>sendOrderedBroadcast()</code>:有序广播模式</p>\n<ul>\n<li><p>接收者依照设定的优先级高低依次接受</p>\n</li>\n<li><p>高优先级接收者可以中断后续广播的接收，<code>BroadcastReceiver.abortBroadcast()</code>终止这个广播事件的传播，低优先级的触发器组件不再有机会接收</p>\n</li>\n<li><p>高优先级接收者可添加额外信息给后续接收者</p>\n<p><code>BroadcastReceiver.setResult()</code></p>\n</li>\n</ul>\n</li>\n<li><p>监听广播实现</p>\n<ul>\n<li>获取广播事件的消息接口名称</li>\n<li>事件定制的广播接收器，添加相应的处理逻辑</li>\n<li>注册广播接收器到安卓系统中</li>\n</ul>\n</li>\n<li><p>监听广播实现示例</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBroadcastReceiver</span> <span class=\"keyword\">extends</span> <span class=\"title\">BroadcastReceiver</span></span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//action名称，此为固定的字符</span></span><br><span class=\"line\">String SMS_RECEIVED=<span class=\"string\">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>;</span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onReceive</span><span class=\"params\">(COntext context, Intent intent)</span></span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//如事件有短信接收，则执行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(intent.getAction().quals(SMS_RECEIVED))&#123;</span><br><span class=\"line\"><span class=\"comment\">//进行短信接收到之后的逻辑处理</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"7\">\n<li><p>监听广播注册</p>\n<p>在manifest中注册监听器</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--声明接收器--&gt;</span><br><span class=\"line\">&lt;receiver android:name = <span class=\"string\">&quot;.MyBroadReceiver&quot;</span>&gt;</span><br><span class=\"line\">\t&lt;!--接收事件的过滤条件声明和优先级--&gt;</span><br><span class=\"line\">\t&lt;intent-filter android:priority=<span class=\"string\">&quot;1000&quot;</span>&gt;</span><br><span class=\"line\">\t\t&lt;!--支持接收的事件类型--&gt;</span><br><span class=\"line\">\t&lt;action android:name=<span class=\"string\">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>/&gt;</span><br><span class=\"line\">     &lt;/intent-filter&gt;</span><br><span class=\"line\">&lt;/receiver&gt;</span><br><span class=\"line\">&lt;!--监听系统级事件，需要相应的权限：接收者和发送短信的权限--&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=<span class=\"string\">&quot;android.permission.RECEIVE_SMS&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;uses-permission android:name=<span class=\"string\">&quot;android.permission.SEND_SMS&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>\n\n<p>   在运行代码中注册广播监听器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建监听器对象</span></span><br><span class=\"line\">MyBroadcastReceiver myMsgInfoReceiver=<span class=\"keyword\">new</span> MyBroadcastReceiver();</span><br><span class=\"line\"><span class=\"comment\">//声明IntentFilter，描述可以接收的广播消息</span></span><br><span class=\"line\">IntentFilter intentFilter=<span class=\"keyword\">new</span> IntentFilter(<span class=\"string\">&quot;android.provider.Telephony.SMS_RECEIED&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//调用Activity的方法，注册监听器</span></span><br><span class=\"line\">registerReceiver(mBatteryInfoReceiver,intentFilter)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"8\">\n<li><p>广播事件生命周期</p>\n<ul>\n<li>广播消息到来，新建BroadcastReceiver对象</li>\n<li>调用<code>onReceive()</code>方法，执行操作</li>\n<li>操作完成后，对象被销毁</li>\n<li>事件出发—&gt;创建事件监听器对象—&gt;调用监听器的<code>onReceiver()</code>—&gt;销毁事件监听器的对象—&gt;结束操作，返回</li>\n</ul>\n</li>\n<li><p>广播事件注意事项</p>\n<ul>\n<li>在广播接收器中响应逻辑中不能执行比较耗时的操作</li>\n<li>在onReceive()方法中执行超过10秒，就会弹出无响应对话框。</li>\n</ul>\n</li>\n</ol>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"第一章-前言\"><a href=\"#第一章-前言\" class=\"headerlink\" title=\"第一章 前言\"></a>第一章 前言</h1><p>大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。</p>\n<p>两年前，我使用的还是联想的i5五系列cpu、机械硬盘、4g内存，这个电脑配置使得我当时用eplise开发安卓程序非常麻烦，打开一个安卓虚拟机需要花很长的时间。半年前，我更换了Surface，用上了8+128G内存+固态硬盘。也更新了最新的i5八系列cpu，电脑配置有了显著提高，运行安卓开发程序也游刃有余了。</p>\n<p>而这次重启安卓学习之旅，我将使用AS进行安卓开发。虽然AS目前已支持C/C++做程序开发，但我仍将选择JAVA作为开发语言，以提高我的JAVA水平。</p>\n<h1 id=\"第二章-安装Android-Studio\"><a href=\"#第二章-安装Android-Studio\" class=\"headerlink\" title=\"第二章 安装Android Studio\"></a>第二章 安装Android Studio</h1><p>从 <a href=\"https://developer.android.com/studio\">https://developer.android.com/studio</a> 下载IDE和SDK后，进行相应安装和配置。安装教程，从网课和CDSN论坛均可找到。不再赘述。</p>\n<p>此处说明安装时遇到的坑。</p>\n<ol>\n<li><p>SDK安装后，在SDK管理工具中添加SDK目录即andriod-sdk提示<code>android sdk location should not contain whitespace</code></p>\n</li>\n<li><p>问题1解决后紧接着出现提示<code>Target folder is neither empty nor does it point to an existing SDK installtion.</code></p>\n</li>\n</ol>\n<p>问题分析和解决办法：</p>\n<ol>\n<li>提示意思为SDK的目录路径中出现空格。在我的问题中是，Program Files文件夹名称中间有空格，于是我在根路径重新创建了一个以Andriod为名的文件夹，并将andriod-sdk移到此路径下。</li>\n<li>提示为，选择的文件夹既不是空的也不是sdk的文件夹，原因是我将sdk目录指向了Andriod为名的文件夹，正确的路径是上步创建Andriod文件下的andriod-sdk。</li>\n</ol>\n<p>安装好SDK后，还要给AS安装虚拟机，运行AS后，在Tools菜单下找到AVD Manager（虚拟机管理器），添加合适分辨率、Andriod版本的虚拟机即可。</p>\n<h1 id=\"第三章-应用的资源访问\"><a href=\"#第三章-应用的资源访问\" class=\"headerlink\" title=\"第三章 应用的资源访问\"></a>第三章 应用的资源访问</h1><h2 id=\"3-1-认识Android目录\"><a href=\"#3-1-认识Android目录\" class=\"headerlink\" title=\"3.1 认识Android目录\"></a>3.1 认识Android目录</h2><ol>\n<li><p>res资源</p>\n<ul>\n<li>drawable-？dpi（l,h,m,x）：不同分辨率下的资源文件，如图片的大小。</li>\n<li>values：安卓应用界面上需要显示的各类文本标签文字。</li>\n<li>layout：界面布局文件。</li>\n<li>menu：存放菜单</li>\n</ul>\n</li>\n<li><p>gen（ADT中）或JAVA（AS中）</p>\n<p>由IDE自动生成的包文件</p>\n</li>\n</ol>\n<h2 id=\"3-2-通用资源访问\"><a href=\"#3-2-通用资源访问\" class=\"headerlink\" title=\"3.2 通用资源访问\"></a>3.2 通用资源访问</h2><ol>\n<li><p>基于Java代码访问资源</p>\n<ul>\n<li>Java代码访问方式:</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[\\&lt;packge-name&gt;.]R.   <span class=\"comment\">//R类所在包路径可省略</span></span><br><span class=\"line\">&lt;resource_type&gt;.&lt;resource_name&gt;  <span class=\"comment\">//resource_type：资源类型如color等。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>Java访问示例</p>\n</li>\n<li><p>//从drawable目录中加载图片，设置为背景图片</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getWindow().setBackgroundDrawableResource(R.drawable.back)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>//从string设置字符串资源，设置为文本框的显示内容</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TextView title=(TextView)findViewById(R.id.title);  </span><br><span class=\"line\">title.setText(R.string.titleinfo);</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>在XML配置文件中访问资源</p>\n<ul>\n<li>XML资源访问方式:</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@[<span class=\"tag\">&lt;<span class=\"name\">package_name</span>&gt;</span>:]</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resource_type</span>&gt;</span>/<span class=\"tag\">&lt;<span class=\"name\">resource_name</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>XML资源定义示例</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">color</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; blue &quot;</span> &gt;</span>#ff00ff<span class=\"tag\">&lt;/<span class=\"name\">color</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; title &quot;</span> &gt;</span></span><br><span class=\"line\">Confirmation<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在XML中使用资源示例</p>\n<ul>\n<li>XML资源使用实例片段</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">EditText</span> <span class=\"attr\">android:layout_width</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">android:layout_height</span>=<span class=\"string\">&quot;match_parent&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">android:text</span>=<span class=\"string\">&quot; @string/title&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t<span class=\"attr\">android:textColor</span>=<span class=\"string\">&quot; @color/blue&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">EditText</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-3-安卓中字符串、颜色和尺寸应用\"><a href=\"#3-3-安卓中字符串、颜色和尺寸应用\" class=\"headerlink\" title=\"3.3 安卓中字符串、颜色和尺寸应用\"></a>3.3 安卓中字符串、颜色和尺寸应用</h2><ol>\n<li><p>资源列表</p>\n<p>字符串、颜色、尺寸资源，存放在XML文件内，位于/res/values目录下。</p>\n<p>如字符串资源：/res/values/strings.xml。R类中名称：R.string</p>\n</li>\n<li><p>颜色表示方法</p>\n<ul>\n<li><p>使用Color类的常量</p>\n<p>如：<code>int color = Color.BLUE;//创建一个蓝色</code></p>\n</li>\n<li><p>使用Color类的静态方法argb创建颜色</p>\n<p><code>int color = Color.argb\\(127.255.0.255\\);//半透明紫色</code></p>\n</li>\n<li><p>在XML资源文件定义颜色值</p>\n</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">color</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; blue &quot;</span> &gt;</span>#ff00ff<span class=\"tag\">&lt;/<span class=\"name\">color</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot; title &quot;</span> &gt;</span></span><br><span class=\"line\">Confirmation<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>使用示例</p>\n</li>\n<li><p>res和assets区别</p>\n<ul>\n<li><p>res内的文件被映射到R.java，基于资源ID直接访问。</p>\n</li>\n<li><p>assets需通过资源管理器访问。</p>\n</li>\n<li><p>res下不可以创建子目录，assets可以有目录结构。</p>\n</li>\n<li><p>读取文件资源的方式不同</p>\n<ul>\n<li>读取res/raw下的文件资源，通过当前Activity中的<code>getResources()</code>方法：</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">InputStream is = getResources().</span><br><span class=\"line\">openRawResource(R.id.filename);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>读取assets下的文件资源，通过当前活动的资源管理器assetmanager读取相应的资源文件：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AssetManager am = getAssets();<span class=\"comment\">//通过当前的Activity的getAsset()方法。</span></span><br><span class=\"line\">InputStream is = am.open(<span class=\"string\">&quot;filename&quot;</span>);<span class=\"comment\">//基于文件名读取资源。</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-4-Drawable资源\"><a href=\"#3-4-Drawable资源\" class=\"headerlink\" title=\"3.4 Drawable资源\"></a>3.4 Drawable资源</h2><ol>\n<li><p>Drawable资源</p>\n<ul>\n<li><p>主要是需要绘制的资源，比如图片资源。</p>\n</li>\n<li><p>主要格式有*.png、*.jpg等。</p>\n</li>\n<li><p>图片放入/res/drawable-xxx目录下。</p>\n</li>\n<li><p>安卓SDK会在编译应用自动加载图片。</p>\n</li>\n<li><p>资源文件在R.java资源类中生成该资源的索引。</p>\n</li>\n</ul>\n</li>\n<li><p>Drawable资源类型</p>\n<ul>\n<li>StateListDrawable资源（动态切换背景）</li>\n<li>LayerDrawable资源（图层叠加）</li>\n<li>ShapeDrawable资源（绘图）</li>\n<li>ClipDrawable资源</li>\n<li>AnimationDrawable资源（动画）</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"3-5-安卓项目布局文件\"><a href=\"#3-5-安卓项目布局文件\" class=\"headerlink\" title=\"3.5 安卓项目布局文件\"></a>3.5 安卓项目布局文件</h2><ol>\n<li><p>什么是安卓布局文件？</p>\n<ul>\n<li>定义用户界面上各个组建之间的组织结构。</li>\n<li>XML格式文件，安卓系统负责初始化。</li>\n<li>实现界面布局和逻辑代码的分离。</li>\n<li>修改和更新界面非常简便，无需修改代码。</li>\n<li>布局文件是树形结构，使用根节点。</li>\n<li>一般在布局控件中放置界面显示组建LinearLayout中放入textview文本标签</li>\n<li>通过节点属性设置显示界面组建的属性：大小、颜色和边距等。</li>\n</ul>\n</li>\n<li><p>布局示例</p>\n</li>\n<li><p>布局文件节点属性示例</p>\n<p><code>android:id=&quot;@+id/button_id&quot;</code></p>\n<ul>\n<li>@表示XML解析器应该解析ID字符串把它作为ID资源。</li>\n<li>+符号表示一个新的资源名字，会被创建且加入到资源列表中（R.java）</li>\n<li>@string/@color等可用于访问其他资源。</li>\n<li>组建id在android应用中是唯一的。</li>\n</ul>\n</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>主题</th>\n<th align=\"left\">内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>资源位置</td>\n<td align=\"left\">res/layout/my_layout.xml</td>\n</tr>\n<tr>\n<td>布局XML文件格式</td>\n<td align=\"left\">使用&lt;?xml version= “1.0”encoding=”utf-8” ?&gt;<br>&lt;布局类xmlns:android=”<a href=\"http://schemas.android/\">http://schemas.android</a>.<br>Com/apk/res/android” id= “@id+/string_na<code>&lt;br&gt;</code>me”(属性)&gt;<br>&lt;视图组件或者其他嵌套布局类&gt;<br>&lt;requestFocus/&gt;<br>&lt;/布局类&gt;</td>\n</tr>\n<tr>\n<td>获得XML资源的方法</td>\n<td align=\"left\">Activity.setContentView()</td>\n</tr>\n<tr>\n<td>引用XML资源的格式</td>\n<td align=\"left\">Java代码中：R.layout.my_layout。<br>XML文件中：@[package:]layout/my_layout</td>\n</tr>\n<tr>\n<td>资源位置</td>\n<td align=\"left\">res/layout/my_layout.xml</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-6-AndroidManifest-xml项目配置文件\"><a href=\"#3-6-AndroidManifest-xml项目配置文件\" class=\"headerlink\" title=\"3.6 AndroidManifest.xml项目配置文件\"></a>3.6 AndroidManifest.xml项目配置文件</h2><ol>\n<li><p>什么是AndroidManifest.xml</p>\n<p>位于根目录下，文件名不可修改。</p>\n<p>该文件中 &lt;manifest&gt;和 &lt;application&gt;是必需的且只能出现一次。</p>\n</li>\n<li><p>描述Android应用使用的组建和系统配置信息</p>\n<ul>\n<li>应用使用的组建及其实现类（Activity/Service等）</li>\n<li>需要使用的安卓系统权限。</li>\n<li>声明其他应用程序与该应用程序交互需要的权限</li>\n<li>该应用程序所需的安卓API版本。</li>\n<li>列出该应用程序所需类库。</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"第四章-界面编程任务分析与设计\"><a href=\"#第四章-界面编程任务分析与设计\" class=\"headerlink\" title=\"第四章 界面编程任务分析与设计\"></a>第四章 界面编程任务分析与设计</h1><h2 id=\"4-1-循序渐进\"><a href=\"#4-1-循序渐进\" class=\"headerlink\" title=\"4.1 循序渐进\"></a>4.1 循序渐进</h2><ol>\n<li><p>Activity简介</p>\n<ul>\n<li>安卓的视图组件，四大组件之一。</li>\n<li>定义用户可以看到触摸到的界面。</li>\n<li>活动内使用各种界面组件，实现交互动作。</li>\n<li>通过活动，用户界面之间切换跳转、进行数据传递。</li>\n</ul>\n</li>\n<li><p>Activity概念</p>\n</li>\n</ol>\n<ul>\n<li>用来包装用户界面组件的容器，实现用户和界面组件之间的交互。</li>\n</ul>\n<ol start=\"3\">\n<li><p>案列分析教学特点和注意事项</p>\n<ul>\n<li>界面编程案例分析教学特点<ul>\n<li>案例：基于安卓系统的计算器</li>\n<li>特点：案例驱动，实践先行</li>\n<li>优势：在实践中学习抽象的概念</li>\n</ul>\n</li>\n<li>界面编程案例分析注意事项<ul>\n<li>知识要点：活动的概念和使用</li>\n<li>分析技巧：如何将实际中的问题进行分析；分析问题和解决问题的方法</li>\n<li>编码技巧：在案例中学习编码技巧</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>计算器案例</p>\n<ul>\n<li><p>操作过程：</p>\n<ol>\n<li><p>用户输入两个计算数；</p>\n</li>\n<li><p>选择计算类型；</p>\n</li>\n<li><p>点击计算按钮，进行计算</p>\n</li>\n<li><p>将结果展示给用户</p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"4-2-活动的创建和使用\"><a href=\"#4-2-活动的创建和使用\" class=\"headerlink\" title=\"4.2 活动的创建和使用\"></a>4.2 活动的创建和使用</h2><ol>\n<li><p>创建活动应用程序</p>\n<ul>\n<li>应用程序通常由多个活动松耦合的组成</li>\n<li>活动是界面上的组件在屏幕上展示的容器</li>\n<li>活动通过布局文件展示界面布局的内容</li>\n<li>活动的生命周期，利用周期的方法扩展</li>\n</ul>\n</li>\n<li><p>创建活动步骤</p>\n<ul>\n<li>声明活动类名，继承于活动</li>\n<li>实现<code>onCreate(Bundle bundle)</code>方法，在系统初始化完成活动对象之后，进行用户自定义的初始化活动</li>\n<li>在<code>onCreate(View view)</code>设置用户界面的布局文件</li>\n<li>通过活动中的<code>findViewById(int id)</code>获取各个界面组件，并基于其属性和方法进行相应的操作</li>\n<li>如果需要在销毁活动进行处理，可以实现<code>onDestroy()</code>的方法。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"4-3-活动的声明和配置\"><a href=\"#4-3-活动的声明和配置\" class=\"headerlink\" title=\"4.3 活动的声明和配置\"></a>4.3 活动的声明和配置</h2><ol>\n<li><p>活动的声明和配置</p>\n<ul>\n<li><p>活动定义后需在AndroidManifest.xml中声明</p>\n</li>\n<li><p>`&lt;application…/&gt;·节点内添加·&lt;activity…/&gt;·子元素</p>\n</li>\n<li><p>在<code>&lt;activity&gt;</code>子节点内定义Activity的类型（入口活动）</p>\n</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;activity android:name=<span class=\"string\">&quot;com.quck.android.calculator&quot;</span></span><br><span class=\"line\">android:icon=<span class=\"string\">&quot;@drawable/pic.png&quot;</span></span><br><span class=\"line\">android:label=<span class=\"string\">&quot;@string/app_name&quot;</span> &gt;</span><br><span class=\"line\"><span class=\"comment\">//略去其中内容</span></span><br><span class=\"line\">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>配置活动——示例分析</p>\n<p>活动的主要配置属性有如下三个：</p>\n<ul>\n<li><p>name：指定该活动的类名</p>\n</li>\n<li><p>icon：是定该活动对象的图标（可选）</p>\n</li>\n<li><p>label：指定该活动的标签</p>\n</li>\n<li><p>在<code>&lt;activity&gt;</code>节点中指定一个或者多个<code>&lt;intent-filter.../&gt;</code>元素Intent的类型和Action决定活动是否会接收消息。</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"4-4-活动之间的数据交换和调用\"><a href=\"#4-4-活动之间的数据交换和调用\" class=\"headerlink\" title=\"4.4 活动之间的数据交换和调用\"></a>4.4 活动之间的数据交换和调用</h2><ol>\n<li><p>活动之间的数据交换和调用</p>\n<ul>\n<li>活动之间跳转，需传递数据信息</li>\n<li>通过Intent来进行数据传递</li>\n<li>数据需要放入Intent或者Bundle之内</li>\n</ul>\n</li>\n<li><p>什么是Bundle？</p>\n</li>\n</ol>\n<ul>\n<li>Bundle类是一个key-value对，一个映射，把字符串映射为各种类型。</li>\n</ul>\n<ol start=\"3\">\n<li><p>数据交换</p>\n<ul>\n<li>写入数据<ul>\n<li><code>putExtras(Bundle data)</code>向Intent中放入需要携带的Bundle数据</li>\n<li><code>putXXX(String key, Xxx data)</code>向Bundle放入Int,Long,String等各种类型的数据</li>\n<li><code>putSerializable(String key, Serialzable data)</code>:向Bundle中放入一份可序列化对象</li>\n</ul>\n</li>\n<li>读取数据<ul>\n<li><code>getExtras()</code>从Intent中读取需要携带的Bundle数据</li>\n<li><code>getXXX(String key)</code>从Bundle，Intent读取int,Long,String等各种类型的数据</li>\n<li><code>getSerializable(String key)</code>从Bundle，Intent中读取一个可序列化的对象</li>\n</ul>\n</li>\n<li>活动交换示例</li>\n<li>Intent vs Bundle<ul>\n<li>相同点：传递数据时，作用相同</li>\n<li>不同点：在多个活动之间传递相同数据时，推荐使用Bundle来储存和传递数据，减少重复的读写操作</li>\n<li>例：活动跳转A-&gt;B-&gt;C传递相同数据<ul>\n<li>如果使用Intent，则需要在A、B、C的Intent之间进行数据的复制</li>\n<li>如果使用Bundle，则可直接传递Bundle对象即可</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>返回数据</p>\n<ul>\n<li><p><code>startActivityForResult(Intent intent, int requestCode)</code></p>\n<p>跳转到指定的活动</p>\n<p>参数intent：指定目的活动类名</p>\n<p>参数requestCode：由程序中自定义的识别码，用以区分不同的七点活动</p>\n</li>\n<li><p><code>setResult(int resultCode, Intent data)</code></p>\n<p>设置resultCode表示结果的Activity，第二个参数保存传递的结果数据</p>\n</li>\n<li><p><code>onActivityResult(int requestCode, int resultCode, Intent data)</code></p>\n<p>参数requestCode：起点活动定义唯一值</p>\n<p>参数resultCode：目的活动定义的唯一标识值</p>\n<p>参数data：从墓地活动返回的数据</p>\n</li>\n</ul>\n</li>\n<li><p>数据使用步骤</p>\n<ul>\n<li>起点活动，调用<code>startActivityForResult()</code>跳转目的活动</li>\n<li>在目的活动中调用<code>setResult()</code></li>\n<li>在起点活动覆写<code>onActivityResult()</code>在方法内获取目的活动返回的数据</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"第五章-服务开发和广播事件\"><a href=\"#第五章-服务开发和广播事件\" class=\"headerlink\" title=\"第五章 服务开发和广播事件\"></a>第五章 服务开发和广播事件</h1><h2 id=\"5-1-循序渐进\"><a href=\"#5-1-循序渐进\" class=\"headerlink\" title=\"5.1 循序渐进\"></a>5.1 循序渐进</h2><ul>\n<li><p>案列：音乐播放器</p>\n<ul>\n<li><p>任务概述</p>\n</li>\n<li><p>功能分析</p>\n<p>界面设计</p>\n<p>实现暂停、播放和停止</p>\n<p>播放同时，显示歌手和音乐名称</p>\n</li>\n<li><p>用户界面设计</p>\n<p>主界面</p>\n</li>\n<li><p>技术要点</p>\n<p>服务的创建、调用</p>\n<p>服务和活动之间的通信</p>\n<p>Intent对象的使用</p>\n</li>\n<li><p>案例演示</p>\n</li>\n</ul>\n</li>\n<li><p>案例任务分析和设计</p>\n<p>音乐播放器界面分析</p>\n</li>\n<li><p>核心代码设计和实现</p>\n<p>核心代码编写步骤：</p>\n<ol>\n<li>创建安卓项目MusicBox</li>\n<li>在res/loyout目录，创建播放器的主界面布局文件</li>\n<li>定义一个MusicBoxContant的常量类存放程序中用到的静态或不变的信息</li>\n<li>创建音乐播放器的服务类</li>\n<li>在全局配置文件中，声明服务类</li>\n<li>定义实现音乐播放器的主界面</li>\n<li>定义事项ActicityReciver事件接收器，接受音乐服务状态变化广播事件的接收器</li>\n<li>定义实现按钮事件接收器，播放和停止按钮，发送广播事件</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"5-2-安卓中的系统服务\"><a href=\"#5-2-安卓中的系统服务\" class=\"headerlink\" title=\"5.2 安卓中的系统服务\"></a>5.2 安卓中的系统服务</h2><ul>\n<li><p>安卓将诸多常用功能内置为系统服务</p>\n</li>\n<li><p>提供简单的获取系统服务的方式</p>\n</li>\n<li><p>系统服务涵盖了安卓绝大部分常用功能，如，拨打电话，发送短信</p>\n</li>\n</ul>\n<ol>\n<li><p>安卓中获取系统服务</p>\n<ul>\n<li><p>获取系统服务代码示例</p>\n<p><code>TelephonyManager phoneManager=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);</code></p>\n</li>\n<li><p>强制类型转化</p>\n<ul>\n<li>在程序运行过程中，将父类型对象转化为子类型对象。</li>\n<li>由于子类型相比父类型的内涵丰富，属性方法更多，所以要把父类型转化为子类型时，需要强制转化，成为强制类型转换。</li>\n<li>并不是所有父类型都可以转化为子类型，要根据具体的使用情况来做具体的判断。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"5-3-广播接收机制\"><a href=\"#5-3-广播接收机制\" class=\"headerlink\" title=\"5.3 广播接收机制\"></a>5.3 广播接收机制</h2><ol>\n<li><p>广播消息</p>\n<ul>\n<li>广播是一种在应用程序之间传输信息的计指</li>\n<li>BroadcastReceiver广播接收者</li>\n<li>广播消息Intent（消息载体）</li>\n<li>被订阅广播的多个广播接收者接收</li>\n<li>消息订阅者不了解发送者</li>\n</ul>\n</li>\n<li><p>广播接收者</p>\n<ul>\n<li>BroadcastReceiver对发出的广播事件进行过滤，应用程序通知其他应用程序某些数据已经下载完毕。</li>\n<li>广播接收者没有图形界面</li>\n<li>广播可以有多个接收者，彼此不知晓。广播接收者之间匿名</li>\n</ul>\n</li>\n<li><p>监听广播机制</p>\n<ul>\n<li>广播和事件监听器是分离的</li>\n<li>通过安卓系统进行广播、接收广播事件</li>\n<li>注册和移除监听通过安卓系统来完成</li>\n<li>安卓系统提供很多广播定义在<code>android.content.Intent</code>类中</li>\n</ul>\n</li>\n<li><p>广播方法</p>\n<p><code>sendBroadcast()</code>:普通模式</p>\n<ul>\n<li>所有注册了广播的接收者会获得事件通知</li>\n<li>接收者接受顺序不确定并发地在各自的应用进程中执行</li>\n<li>接收者和发送者不知晓</li>\n</ul>\n<p><code>sendOrderedBroadcast()</code>:有序广播模式</p>\n<ul>\n<li><p>接收者依照设定的优先级高低依次接受</p>\n</li>\n<li><p>高优先级接收者可以中断后续广播的接收，<code>BroadcastReceiver.abortBroadcast()</code>终止这个广播事件的传播，低优先级的触发器组件不再有机会接收</p>\n</li>\n<li><p>高优先级接收者可添加额外信息给后续接收者</p>\n<p><code>BroadcastReceiver.setResult()</code></p>\n</li>\n</ul>\n</li>\n<li><p>监听广播实现</p>\n<ul>\n<li>获取广播事件的消息接口名称</li>\n<li>事件定制的广播接收器，添加相应的处理逻辑</li>\n<li>注册广播接收器到安卓系统中</li>\n</ul>\n</li>\n<li><p>监听广播实现示例</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBroadcastReceiver</span> <span class=\"keyword\">extends</span> <span class=\"title\">BroadcastReceiver</span></span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//action名称，此为固定的字符</span></span><br><span class=\"line\">String SMS_RECEIVED=<span class=\"string\">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>;</span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onReceive</span><span class=\"params\">(COntext context, Intent intent)</span></span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//如事件有短信接收，则执行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(intent.getAction().quals(SMS_RECEIVED))&#123;</span><br><span class=\"line\"><span class=\"comment\">//进行短信接收到之后的逻辑处理</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"7\">\n<li><p>监听广播注册</p>\n<p>在manifest中注册监听器</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--声明接收器--&gt;</span><br><span class=\"line\">&lt;receiver android:name = <span class=\"string\">&quot;.MyBroadReceiver&quot;</span>&gt;</span><br><span class=\"line\">\t&lt;!--接收事件的过滤条件声明和优先级--&gt;</span><br><span class=\"line\">\t&lt;intent-filter android:priority=<span class=\"string\">&quot;1000&quot;</span>&gt;</span><br><span class=\"line\">\t\t&lt;!--支持接收的事件类型--&gt;</span><br><span class=\"line\">\t&lt;action android:name=<span class=\"string\">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>/&gt;</span><br><span class=\"line\">     &lt;/intent-filter&gt;</span><br><span class=\"line\">&lt;/receiver&gt;</span><br><span class=\"line\">&lt;!--监听系统级事件，需要相应的权限：接收者和发送短信的权限--&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=<span class=\"string\">&quot;android.permission.RECEIVE_SMS&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;uses-permission android:name=<span class=\"string\">&quot;android.permission.SEND_SMS&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>\n\n<p>   在运行代码中注册广播监听器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建监听器对象</span></span><br><span class=\"line\">MyBroadcastReceiver myMsgInfoReceiver=<span class=\"keyword\">new</span> MyBroadcastReceiver();</span><br><span class=\"line\"><span class=\"comment\">//声明IntentFilter，描述可以接收的广播消息</span></span><br><span class=\"line\">IntentFilter intentFilter=<span class=\"keyword\">new</span> IntentFilter(<span class=\"string\">&quot;android.provider.Telephony.SMS_RECEIED&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//调用Activity的方法，注册监听器</span></span><br><span class=\"line\">registerReceiver(mBatteryInfoReceiver,intentFilter)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"8\">\n<li><p>广播事件生命周期</p>\n<ul>\n<li>广播消息到来，新建BroadcastReceiver对象</li>\n<li>调用<code>onReceive()</code>方法，执行操作</li>\n<li>操作完成后，对象被销毁</li>\n<li>事件出发—&gt;创建事件监听器对象—&gt;调用监听器的<code>onReceiver()</code>—&gt;销毁事件监听器的对象—&gt;结束操作，返回</li>\n</ul>\n</li>\n<li><p>广播事件注意事项</p>\n<ul>\n<li>在广播接收器中响应逻辑中不能执行比较耗时的操作</li>\n<li>在onReceive()方法中执行超过10秒，就会弹出无响应对话框。</li>\n</ul>\n</li>\n</ol>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jun 20 2020 08:47:20 GMT+0200 (GMT+02:00)","title":"JAVA安卓编程笔记","path":"2019/11/18/重温安卓编程/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2019-11-18T19:41:49.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2019-11-18T19:41:49.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["安卓编程"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"已知多个地点经纬度的最优路径规划","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-10-18T22:42:00.000Z","password":null,"summary":null,"_content":"\n# 1：为什么规划路线\n\n这是统一美团饿了么订单后的后续工作，要求对多个指定的配送地点进行统计，并计算出从花店出发，到配送完所有地点返回花店的可能路程，并得出最优的路线。。\n\n# 2：设计思想\n\n假设有四个配送点ABCD，配送的路线会有24种可能，枚举所有可能，并计算从花店到第一个配送点，依次再有三个配送点，然后返回花店的距离。比较这二十四种路线的距离，距离最少的，选为最优路线。\n\n在Python中，使用`itertools`迭代库中的`permutations`方法，对路径可能进行排列。通过`haversine`公式计算两个经纬度之间的距离。\n\n# 3：Python程序\n\n```python\n# -*- encoding: utf-8 -*-\n'''\n@file_name    :shortest_dist.py\n@description  :\n@time         :2020/10/18 20:24:21\n@author       :Qifei\n@version      :1.0\n'''\nfrom math import radians, cos, sin, asin, sqrt\nfrom itertools import permutations\n\nclass Route():\n    def __init__(self,data):\n        self.data = data\n        self.home = {'lng':'104.270910','lat':'30.876583'}\n        self.distances = []\n        self.routes = []\n        #排列各种可能的路线\n        self.iter_routes = permutations(data,len(data))\n        #将排列后的迭代类型数据转为列表类型\n        for iter_route in self.iter_routes:\n            self.routes.append(list(iter_route))\n    #返回最优路线的列表排序\n    def best_route(self):\n        for route in self.routes:\n            distance = 0\n            if len(route) > 1:\n                for i in range(len(route)-1):\n                    distance += self.calc_distance(route[i+1]['lng'],route[i+1]['lat'],route[i]['lng'],route[i]['lat'])\n            distance += self.calc_distance(self.home['lng'],self.home['lat'],route[0]['lng'],route[0]['lat'])\n            distance += self.calc_distance(self.home['lng'],self.home['lat'],route[-1]['lng'],route[-1]['lat'])\n            self.distances.append(distance)\n        return self.routes[self.distances.index(min(self.distances))]\n\n\t#计算两个经纬度之间的距离\n    def calc_distance(self,lon1, lat1, lon2, lat2):\n        # 将十进制度数转化为弧度\n        lon1, lat1, lon2, lat2 = map(radians, [float(lon1), float(lat1), float(lon2), float(lat2)])\n        # haversine公式\n        dlon = lon2 - lon1 \n        dlat = lat2 - lat1 \n        a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2\n        c = 2 * asin(sqrt(a)) \n        r = 6371 # 地球平均半径，单位为公里\n        return c * r * 1000\n\nif __name__ == '__main__':\n    data = [{'name':'大弯中学','lng':'104.278184','lat':'30.879862'},{'name':'怡湖公园','lng':'104.261332','lat':'30.878314'},{'name':'大弯小学','lng':'104.270611','lat':'30.880657'},{'name':'长河郡','lng':'104.278201','lat':'30.872356'}]\n    route = Route(data)\n    # print(route.calc_distance(data[0]['lng'],data[0]['lat'],data[0]['lng'],data[0]['lat']))\n    \n    best_route = route.best_route()\n    print(best_route)\n    # print(route.distances)\n\n\n```\n\n","source":"_posts/已知多个地点经纬度的最优路径规划.md","raw":"---\ntitle: 已知多个地点经纬度的最优路径规划\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-10-19 00:42:00\npassword:\nsummary:\ntags: -Python\ncategories: Python\n---\n\n# 1：为什么规划路线\n\n这是统一美团饿了么订单后的后续工作，要求对多个指定的配送地点进行统计，并计算出从花店出发，到配送完所有地点返回花店的可能路程，并得出最优的路线。。\n\n# 2：设计思想\n\n假设有四个配送点ABCD，配送的路线会有24种可能，枚举所有可能，并计算从花店到第一个配送点，依次再有三个配送点，然后返回花店的距离。比较这二十四种路线的距离，距离最少的，选为最优路线。\n\n在Python中，使用`itertools`迭代库中的`permutations`方法，对路径可能进行排列。通过`haversine`公式计算两个经纬度之间的距离。\n\n# 3：Python程序\n\n```python\n# -*- encoding: utf-8 -*-\n'''\n@file_name    :shortest_dist.py\n@description  :\n@time         :2020/10/18 20:24:21\n@author       :Qifei\n@version      :1.0\n'''\nfrom math import radians, cos, sin, asin, sqrt\nfrom itertools import permutations\n\nclass Route():\n    def __init__(self,data):\n        self.data = data\n        self.home = {'lng':'104.270910','lat':'30.876583'}\n        self.distances = []\n        self.routes = []\n        #排列各种可能的路线\n        self.iter_routes = permutations(data,len(data))\n        #将排列后的迭代类型数据转为列表类型\n        for iter_route in self.iter_routes:\n            self.routes.append(list(iter_route))\n    #返回最优路线的列表排序\n    def best_route(self):\n        for route in self.routes:\n            distance = 0\n            if len(route) > 1:\n                for i in range(len(route)-1):\n                    distance += self.calc_distance(route[i+1]['lng'],route[i+1]['lat'],route[i]['lng'],route[i]['lat'])\n            distance += self.calc_distance(self.home['lng'],self.home['lat'],route[0]['lng'],route[0]['lat'])\n            distance += self.calc_distance(self.home['lng'],self.home['lat'],route[-1]['lng'],route[-1]['lat'])\n            self.distances.append(distance)\n        return self.routes[self.distances.index(min(self.distances))]\n\n\t#计算两个经纬度之间的距离\n    def calc_distance(self,lon1, lat1, lon2, lat2):\n        # 将十进制度数转化为弧度\n        lon1, lat1, lon2, lat2 = map(radians, [float(lon1), float(lat1), float(lon2), float(lat2)])\n        # haversine公式\n        dlon = lon2 - lon1 \n        dlat = lat2 - lat1 \n        a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2\n        c = 2 * asin(sqrt(a)) \n        r = 6371 # 地球平均半径，单位为公里\n        return c * r * 1000\n\nif __name__ == '__main__':\n    data = [{'name':'大弯中学','lng':'104.278184','lat':'30.879862'},{'name':'怡湖公园','lng':'104.261332','lat':'30.878314'},{'name':'大弯小学','lng':'104.270611','lat':'30.880657'},{'name':'长河郡','lng':'104.278201','lat':'30.872356'}]\n    route = Route(data)\n    # print(route.calc_distance(data[0]['lng'],data[0]['lat'],data[0]['lng'],data[0]['lat']))\n    \n    best_route = route.best_route()\n    print(best_route)\n    # print(route.distances)\n\n\n```\n\n","slug":"已知多个地点经纬度的最优路径规划","published":1,"updated":"2020-10-18T23:38:32.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgfr41lu0000lkvzdp8tcapz","content":"<h1 id=\"1：为什么规划路线\"><a href=\"#1：为什么规划路线\" class=\"headerlink\" title=\"1：为什么规划路线\"></a>1：为什么规划路线</h1><p>这是统一美团饿了么订单后的后续工作，要求对多个指定的配送地点进行统计，并计算出从花店出发，到配送完所有地点返回花店的可能路程，并得出最优的路线。。</p>\n<h1 id=\"2：设计思想\"><a href=\"#2：设计思想\" class=\"headerlink\" title=\"2：设计思想\"></a>2：设计思想</h1><p>假设有四个配送点ABCD，配送的路线会有24种可能，枚举所有可能，并计算从花店到第一个配送点，依次再有三个配送点，然后返回花店的距离。比较这二十四种路线的距离，距离最少的，选为最优路线。</p>\n<p>在Python中，使用<code>itertools</code>迭代库中的<code>permutations</code>方法，对路径可能进行排列。通过<code>haversine</code>公式计算两个经纬度之间的距离。</p>\n<h1 id=\"3：Python程序\"><a href=\"#3：Python程序\" class=\"headerlink\" title=\"3：Python程序\"></a>3：Python程序</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- encoding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">@file_name    :shortest_dist.py</span></span><br><span class=\"line\"><span class=\"string\">@description  :</span></span><br><span class=\"line\"><span class=\"string\">@time         :2020/10/18 20:24:21</span></span><br><span class=\"line\"><span class=\"string\">@author       :Qifei</span></span><br><span class=\"line\"><span class=\"string\">@version      :1.0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> math <span class=\"keyword\">import</span> radians, cos, sin, asin, sqrt</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> permutations</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Route</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,data</span>):</span></span><br><span class=\"line\">        self.data = data</span><br><span class=\"line\">        self.home = &#123;<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.270910&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.876583&#x27;</span>&#125;</span><br><span class=\"line\">        self.distances = []</span><br><span class=\"line\">        self.routes = []</span><br><span class=\"line\">        <span class=\"comment\">#排列各种可能的路线</span></span><br><span class=\"line\">        self.iter_routes = permutations(data,len(data))</span><br><span class=\"line\">        <span class=\"comment\">#将排列后的迭代类型数据转为列表类型</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> iter_route <span class=\"keyword\">in</span> self.iter_routes:</span><br><span class=\"line\">            self.routes.append(list(iter_route))</span><br><span class=\"line\">    <span class=\"comment\">#返回最优路线的列表排序</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">best_route</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> route <span class=\"keyword\">in</span> self.routes:</span><br><span class=\"line\">            distance = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> len(route) &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(route)<span class=\"number\">-1</span>):</span><br><span class=\"line\">                    distance += self.calc_distance(route[i+<span class=\"number\">1</span>][<span class=\"string\">&#x27;lng&#x27;</span>],route[i+<span class=\"number\">1</span>][<span class=\"string\">&#x27;lat&#x27;</span>],route[i][<span class=\"string\">&#x27;lng&#x27;</span>],route[i][<span class=\"string\">&#x27;lat&#x27;</span>])</span><br><span class=\"line\">            distance += self.calc_distance(self.home[<span class=\"string\">&#x27;lng&#x27;</span>],self.home[<span class=\"string\">&#x27;lat&#x27;</span>],route[<span class=\"number\">0</span>][<span class=\"string\">&#x27;lng&#x27;</span>],route[<span class=\"number\">0</span>][<span class=\"string\">&#x27;lat&#x27;</span>])</span><br><span class=\"line\">            distance += self.calc_distance(self.home[<span class=\"string\">&#x27;lng&#x27;</span>],self.home[<span class=\"string\">&#x27;lat&#x27;</span>],route[<span class=\"number\">-1</span>][<span class=\"string\">&#x27;lng&#x27;</span>],route[<span class=\"number\">-1</span>][<span class=\"string\">&#x27;lat&#x27;</span>])</span><br><span class=\"line\">            self.distances.append(distance)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.routes[self.distances.index(min(self.distances))]</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">#计算两个经纬度之间的距离</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">calc_distance</span>(<span class=\"params\">self,lon1, lat1, lon2, lat2</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># 将十进制度数转化为弧度</span></span><br><span class=\"line\">        lon1, lat1, lon2, lat2 = map(radians, [float(lon1), float(lat1), float(lon2), float(lat2)])</span><br><span class=\"line\">        <span class=\"comment\"># haversine公式</span></span><br><span class=\"line\">        dlon = lon2 - lon1 </span><br><span class=\"line\">        dlat = lat2 - lat1 </span><br><span class=\"line\">        a = sin(dlat/<span class=\"number\">2</span>)**<span class=\"number\">2</span> + cos(lat1) * cos(lat2) * sin(dlon/<span class=\"number\">2</span>)**<span class=\"number\">2</span></span><br><span class=\"line\">        c = <span class=\"number\">2</span> * asin(sqrt(a)) </span><br><span class=\"line\">        r = <span class=\"number\">6371</span> <span class=\"comment\"># 地球平均半径，单位为公里</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> c * r * <span class=\"number\">1000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    data = [&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;大弯中学&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.278184&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.879862&#x27;</span>&#125;,&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;怡湖公园&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.261332&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.878314&#x27;</span>&#125;,&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;大弯小学&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.270611&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.880657&#x27;</span>&#125;,&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;长河郡&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.278201&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.872356&#x27;</span>&#125;]</span><br><span class=\"line\">    route = Route(data)</span><br><span class=\"line\">    <span class=\"comment\"># print(route.calc_distance(data[0][&#x27;lng&#x27;],data[0][&#x27;lat&#x27;],data[0][&#x27;lng&#x27;],data[0][&#x27;lat&#x27;]))</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    best_route = route.best_route()</span><br><span class=\"line\">    print(best_route)</span><br><span class=\"line\">    <span class=\"comment\"># print(route.distances)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：为什么规划路线\"><a href=\"#1：为什么规划路线\" class=\"headerlink\" title=\"1：为什么规划路线\"></a>1：为什么规划路线</h1><p>这是统一美团饿了么订单后的后续工作，要求对多个指定的配送地点进行统计，并计算出从花店出发，到配送完所有地点返回花店的可能路程，并得出最优的路线。。</p>\n<h1 id=\"2：设计思想\"><a href=\"#2：设计思想\" class=\"headerlink\" title=\"2：设计思想\"></a>2：设计思想</h1><p>假设有四个配送点ABCD，配送的路线会有24种可能，枚举所有可能，并计算从花店到第一个配送点，依次再有三个配送点，然后返回花店的距离。比较这二十四种路线的距离，距离最少的，选为最优路线。</p>\n<p>在Python中，使用<code>itertools</code>迭代库中的<code>permutations</code>方法，对路径可能进行排列。通过<code>haversine</code>公式计算两个经纬度之间的距离。</p>\n<h1 id=\"3：Python程序\"><a href=\"#3：Python程序\" class=\"headerlink\" title=\"3：Python程序\"></a>3：Python程序</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- encoding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">@file_name    :shortest_dist.py</span></span><br><span class=\"line\"><span class=\"string\">@description  :</span></span><br><span class=\"line\"><span class=\"string\">@time         :2020/10/18 20:24:21</span></span><br><span class=\"line\"><span class=\"string\">@author       :Qifei</span></span><br><span class=\"line\"><span class=\"string\">@version      :1.0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> math <span class=\"keyword\">import</span> radians, cos, sin, asin, sqrt</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> permutations</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Route</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,data</span>):</span></span><br><span class=\"line\">        self.data = data</span><br><span class=\"line\">        self.home = &#123;<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.270910&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.876583&#x27;</span>&#125;</span><br><span class=\"line\">        self.distances = []</span><br><span class=\"line\">        self.routes = []</span><br><span class=\"line\">        <span class=\"comment\">#排列各种可能的路线</span></span><br><span class=\"line\">        self.iter_routes = permutations(data,len(data))</span><br><span class=\"line\">        <span class=\"comment\">#将排列后的迭代类型数据转为列表类型</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> iter_route <span class=\"keyword\">in</span> self.iter_routes:</span><br><span class=\"line\">            self.routes.append(list(iter_route))</span><br><span class=\"line\">    <span class=\"comment\">#返回最优路线的列表排序</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">best_route</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> route <span class=\"keyword\">in</span> self.routes:</span><br><span class=\"line\">            distance = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> len(route) &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(route)<span class=\"number\">-1</span>):</span><br><span class=\"line\">                    distance += self.calc_distance(route[i+<span class=\"number\">1</span>][<span class=\"string\">&#x27;lng&#x27;</span>],route[i+<span class=\"number\">1</span>][<span class=\"string\">&#x27;lat&#x27;</span>],route[i][<span class=\"string\">&#x27;lng&#x27;</span>],route[i][<span class=\"string\">&#x27;lat&#x27;</span>])</span><br><span class=\"line\">            distance += self.calc_distance(self.home[<span class=\"string\">&#x27;lng&#x27;</span>],self.home[<span class=\"string\">&#x27;lat&#x27;</span>],route[<span class=\"number\">0</span>][<span class=\"string\">&#x27;lng&#x27;</span>],route[<span class=\"number\">0</span>][<span class=\"string\">&#x27;lat&#x27;</span>])</span><br><span class=\"line\">            distance += self.calc_distance(self.home[<span class=\"string\">&#x27;lng&#x27;</span>],self.home[<span class=\"string\">&#x27;lat&#x27;</span>],route[<span class=\"number\">-1</span>][<span class=\"string\">&#x27;lng&#x27;</span>],route[<span class=\"number\">-1</span>][<span class=\"string\">&#x27;lat&#x27;</span>])</span><br><span class=\"line\">            self.distances.append(distance)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.routes[self.distances.index(min(self.distances))]</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">#计算两个经纬度之间的距离</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">calc_distance</span>(<span class=\"params\">self,lon1, lat1, lon2, lat2</span>):</span></span><br><span class=\"line\">        <span class=\"comment\"># 将十进制度数转化为弧度</span></span><br><span class=\"line\">        lon1, lat1, lon2, lat2 = map(radians, [float(lon1), float(lat1), float(lon2), float(lat2)])</span><br><span class=\"line\">        <span class=\"comment\"># haversine公式</span></span><br><span class=\"line\">        dlon = lon2 - lon1 </span><br><span class=\"line\">        dlat = lat2 - lat1 </span><br><span class=\"line\">        a = sin(dlat/<span class=\"number\">2</span>)**<span class=\"number\">2</span> + cos(lat1) * cos(lat2) * sin(dlon/<span class=\"number\">2</span>)**<span class=\"number\">2</span></span><br><span class=\"line\">        c = <span class=\"number\">2</span> * asin(sqrt(a)) </span><br><span class=\"line\">        r = <span class=\"number\">6371</span> <span class=\"comment\"># 地球平均半径，单位为公里</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> c * r * <span class=\"number\">1000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    data = [&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;大弯中学&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.278184&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.879862&#x27;</span>&#125;,&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;怡湖公园&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.261332&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.878314&#x27;</span>&#125;,&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;大弯小学&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.270611&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.880657&#x27;</span>&#125;,&#123;<span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;长河郡&#x27;</span>,<span class=\"string\">&#x27;lng&#x27;</span>:<span class=\"string\">&#x27;104.278201&#x27;</span>,<span class=\"string\">&#x27;lat&#x27;</span>:<span class=\"string\">&#x27;30.872356&#x27;</span>&#125;]</span><br><span class=\"line\">    route = Route(data)</span><br><span class=\"line\">    <span class=\"comment\"># print(route.calc_distance(data[0][&#x27;lng&#x27;],data[0][&#x27;lat&#x27;],data[0][&#x27;lng&#x27;],data[0][&#x27;lat&#x27;]))</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    best_route = route.best_route()</span><br><span class=\"line\">    print(best_route)</span><br><span class=\"line\">    <span class=\"comment\"># print(route.distances)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Mon Oct 19 2020 01:38:32 GMT+0200 (GMT+02:00)","title":"已知多个地点经纬度的最优路径规划","path":"2020/10/19/已知多个地点经纬度的最优路径规划/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-10-18T22:42:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-10-18T22:42:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"Python","tags":["-Python"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"外卖平台订单爬取之美团外卖商家版","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-10-17T16:49:09.000Z","password":null,"summary":null,"_content":"\n# 1：root手机\n\n昨天，我利用mitmproxy成功拦截了饿了么服务器返回的订单信息。今天，我准备故技重施，获取美团订单。残酷的现实给我炽热地心浇了一盆冷水。无论我如何调整mitmproxy和美团外卖商家版，都无法获取到美团服务器返回的数据。更确切地说，美团服务器似乎发现，有这么一个小偷，准备偷取它返回给客户端地数据。因此拒绝给客户端传递数据。\n\n我在网上找了一些解答，在安卓7.0之后，安卓系统允许安卓应用不信任用户上传地CA证书，众所周知，在中间人攻击中，将代理服务器的CA证书添加到安卓用户证书里，这样代理服务器在客户端和https服务端之间做个信使，他们的来回信件，信使就能拆开阅读，再封好发出去。现在安卓系统允许安卓应用设置是否信任用户证书，很明显，美团外卖商家版，不支持用户自定义证书。\n\n好在，安卓系统有个要求，就是系统证书都是被认可的。而添加系统证书，需要修改手机system文件夹，需要将手机root。\n\n待root手机：三星S8+\n\n工具：Odin线刷工具，第三方recovery TWRP，Tomato卡刷包（卡刷包含root）。\n\n# 2：添加CA证书为系统证书\n\nmitmproxy会在其运行目录生成一个`.mitmproxy`隐藏目录，目录中的`mitmproxy-ca-cert.pem`是可以直接放到系统证书目录下的证书。首先需要将它更名为统一的格式。\n\n```shell\n#openssl版本在1.0以上的版本的执行这一句\nopenssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem\t\n#openssl版本在1.0以下的版本的执行这一句\nopenssl x509 -inform PEM -subject_hash -in mitmproxy-ca-cert.pem\n```\n\n生成`347bacb5`证书的hash值，然后将`mitmproxy-ca-cert.pem`更名为`347bacb5.0`\n\n将更名后的证书放到安卓系统证书目录，root后的安卓手机，可以直接打开RE管理器进入系统目录\n\n```\n/system/etc/security/cacerts\n```\n\n重启手机。修改wifi代理，并连接mitmproxy。\n\n打开美团外卖商家版，不再报没有网络连接的错误。此时即可以从代理中截获解码后的信息了。\n\n# 3：截获订单请求数据\n\n开启mitmproxy，开始收集请求。在美团上下单，可以截获下单后，美团服务器发送到客户端的订单信息。\n\n进行中订单请求地址，部分内容已打码：\n\n```\nhttps://eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?region_id=10***0100&region_version=153***1&__skck=8f5973b0***&__skts=16***8&__skua=d41d8c***8427e&__skno=94899011-***\n```\n\n预订单请求地址：\n\n```\nhttps://eapi.waimai.meituan.com/api/retail/order/pre/orders?region_id=1000510100&region_version=1534166411&__skck=8f5973b085446090f224af74e30e0181&__skts=1603035614&__skua=d41d8cd98f00b204e9800998ecf8427e&__skno=ed5fa567-5e33-4186-806a-e1ee884b5d5c&__skcy=hNEhcBUBRBinXjXwhZ%2BoMtvkMu8%3D\n```\n\n进行中响应内容：\n\n```JSON\n{\n\t\"msg\": \"Success\",\n\t\"code\": 0,\n\t\"data\": {\n\t\t\"serverTime\": 1603013219,\n\t\t\"news\": [{\n\t\t\t\"agreeBtn\": 0,\n\t\t\t\"reject_reason\": \"\",\n\t\t\t\"rejectBtn\": 0,\n\t\t\t\"apply_refund_type\": 0,\n\t\t\t\"appealReason\": \"\",\n\t\t\t\"pay_status\": 3,\n\t\t\t\"payExpireTime\": 0,\n\t\t\t\"orderDescription\": \"\",\n\t\t\t\"pay_status_desc\": \"已付款\",\n\t\t\t\"apply_reason\": \"\",\n\t\t\t\"applyRefundTime\": 0,\n\t\t\t\"rejectRefundTime\": \"\",\n\t\t\t\"appealRefundTime\": 0,\n\t\t\t\"refundFinishTime\": \"\",\n\t\t\t\"isPartRefundApply\": 0,\n\t\t\t\"isAllowPartRefund\": 0,\n\t\t\t\"isAllowAllRefund\": false,\n\t\t\t\"hasMigratedToRetail\": true,\n\t\t\t\"returnSubStatus\": 0,\n\t\t\t\"logistics\": {\n\t\t\t\t\"id\": -1,\n\t\t\t\t\"type\": 101,\n\t\t\t\t\"icon\": \"\",\n\t\t\t\t\"name\": \"\",\n\t\t\t\t\"status\": -1,\n\t\t\t\t\"statusDesc\": \"\",\n\t\t\t\t\"sendTime\": -1,\n\t\t\t\t\"confirmTime\": -1,\n\t\t\t\t\"arrivePoiTime\": -1,\n\t\t\t\t\"selfDeliveryTime\": -1,\n\t\t\t\t\"fetchTime\": -1,\n\t\t\t\t\"completedTime\": -1,\n\t\t\t\t\"cancelTime\": -1,\n\t\t\t\t\"collectTime\": 0,\n\t\t\t\t\"departureTime\": 0,\n\t\t\t\t\"reachTime\": 0,\n\t\t\t\t\"takeTime\": 0,\n\t\t\t\t\"timeOut\": -1,\n\t\t\t\t\"code\": \"\",\n\t\t\t\t\"valid\": 1,\n\t\t\t\t\"shippingFee\": 0.0,\n\t\t\t\t\"tipFee\": 0.0,\n\t\t\t\t\"shippingTips\": \"\",\n\t\t\t\t\"couponAmount\": 0.0,\n\t\t\t\t\"activityName\": \"\",\n\t\t\t\t\"activityAmount\": 0.0,\n\t\t\t\t\"extraFee\": 0.0,\n\t\t\t\t\"payAmount\": 0.0,\n\t\t\t\t\"shippingFeeBase\": 0.0,\n\t\t\t\t\"payType\": \"\",\n\t\t\t\t\"zbType\": 0,\n\t\t\t\t\"orderDistance\": 0.0,\n\t\t\t\t\"ifSelfLogistics\": 0,\n\t\t\t\t\"isCanChangeSelfLogistics\": 0,\n\t\t\t\t\"dispatcher\": {\n\t\t\t\t\t\"name\": \"\",\n\t\t\t\t\t\"mobile\": \"\",\n\t\t\t\t\t\"icon\": \"\",\n\t\t\t\t\t\"role\": \"配送员\",\n\t\t\t\t\t\"type\": -1,\n\t\t\t\t\t\"typeName\": \"\"\n\t\t\t\t},\n\t\t\t\t\"dispatchMaster\": {\n\t\t\t\t\t\"name\": \"站点\",\n\t\t\t\t\t\"mobile\": \"\",\n\t\t\t\t\t\"icon\": \"\",\n\t\t\t\t\t\"role\": \"站长\"\n\t\t\t\t},\n\t\t\t\t\"dispatchAssistant\": {\n\t\t\t\t\t\"name\": \"站点备用\",\n\t\t\t\t\t\"mobile\": \"\",\n\t\t\t\t\t\"icon\": \"\",\n\t\t\t\t\t\"role\": \"站长助理\"\n\t\t\t\t},\n\t\t\t\t\"unionDispatcher\": {\n\t\t\t\t\t\"name\": \"\",\n\t\t\t\t\t\"mobile\": \"\"\n\t\t\t\t},\n\t\t\t\t\"logisticsSubCode\": \"\",\n\t\t\t\t\"dispatchOrderId\": -1,\n\t\t\t\t\"delayPushSecond\": 0,\n\t\t\t\t\"delayPushMin\": 0,\n\t\t\t\t\"assignTime\": 0,\n\t\t\t\t\"thirdLogisticsCode\": \"\"\n\t\t\t},\n\t\t\t\"printRelayBarCode\": false,\n\t\t\t\"utime\": 1603013218,\n\t\t\t\"refundType\": -1,\n\t\t\t\"isCanChangeSelfLogistics\": 0,\n\t\t\t\"refundProcessEndTips\": \"\",\n\t\t\t\"ifSelfLogistics\": 0,\n\t\t\t\"cancelButtonShow\": 0,\n\t\t\t\"foodDoneInfo\": {\n\t\t\t\t\"isShowFoodDoneBlock\": 0,\n\t\t\t\t\"isfoodDone\": 0,\n\t\t\t\t\"foodDoneStatus\": \"拣货完成\",\n\t\t\t\t\"foodDoneTime\": 0,\n\t\t\t\t\"foodSendOutTimeDeadline\": 0,\n\t\t\t\t\"diningMinutes\": 0,\n\t\t\t\t\"foodSendDeviceInfo\": \"\"\n\t\t\t},\n\t\t\t\"logisticsAbnormalInfo\": {\n\t\t\t\t\"isLogisticsAbnormal\": 0,\n\t\t\t\t\"logisticsAbnormalDesc\": \"\",\n\t\t\t\t\"logisticsAbnormalType\": 0,\n\t\t\t\t\"isShowLogisticsReport\": 0,\n\t\t\t\t\"logisticsReportDesc\": \"\"\n\t\t\t},\n\t\t\t\"refundOtherInfos\": {\n\t\t\t\t\"returnStatusDesc\": \"\",\n\t\t\t\t\"returnSubStatusDesc\": \"\",\n\t\t\t\t\"returnMaxPayAcount\": 100.0,\n\t\t\t\t\"returnSubStatus\": 0,\n\t\t\t\t\"countDownDesc\": \"\",\n\t\t\t\t\"refundViewId\": 0,\n\t\t\t\t\"serviceType\": 0,\n\t\t\t\t\"refundRuleUrl\": \"http://s3plus.sankuai.com/v1/mss_03d0d9cf21144ba0b7747ba1dc1acf6e/order/refund_rules.html\"\n\t\t\t},\n\t\t\t\"refundInfoList\": [],\n\t\t\t\"refundGoodsInfoList\": [],\n\t\t\t\"isAppealApply\": 0,\n\t\t\t\"compensationInfo\": {\n\t\t\t\t\"id\": 0,\n\t\t\t\t\"title\": \"\",\n\t\t\t\t\"time\": 0,\n\t\t\t\t\"moneyDesc\": \"\",\n\t\t\t\t\"reason\": \"\",\n\t\t\t\t\"pictures\": [],\n\t\t\t\t\"appealInfo\": \"\"\n\t\t\t},\n\t\t\t\"orderImValid\": 1,\n\t\t\t\"imGuideContent\": \"\",\n\t\t\t\"imReplyDefaultContent\": \"\",\n\t\t\t\"isAllowPriceDiffRefund\": false,\n\t\t\t\"confirmDeliveryStatus\": 0,\n\t\t\t\"id\": 56367**02186,\n\t\t\t\"wm_poi_id\": 5636780,\n\t\t\t\"wm_poi_order_dayseq\": 1,\n\t\t\t\"wm_order_id_view\": 563678***186,\n\t\t\t\"num\": 1,\n\t\t\t\"poi_name\": \"**鲜花店\",\n\t\t\t\"order_source\": 1,\n\t\t\t\"order_source_desc\": \"手机APP下单\",\n\t\t\t\"shipping_fee\": 0.0,\n\t\t\t\"recipient_name\": \"谢先生\",\n\t\t\t\"recipient_phone\": \"178**858,4109\",\n\t\t\t\"recipient_address\": \"\",\n\t\t\t\"total_after\": 10.0,\n\t\t\t\"total_before\": 10.0,\n\t\t\t\"boxpriceTotal\": 0.0,\n\t\t\t\"remark\": \"[贺卡内容]贺卡内容 [其他备注]备注内容\",\n\t\t\t\"environmentalFriendlyOrder\": 0,\n\t\t\t\"status\": 4,\n\t\t\t\"order_time\": 1603013207,\n\t\t\t\"order_time_fmt\": \"10-18 17:26\",\n\t\t\t\"confirmOrderTime\": 1603013218,\n\t\t\t\"details\": [{\n\t\t\t\t\"id\": 1945297344,\n\t\t\t\t\"food_name\": \"8枝红色非洲菊 \",\n\t\t\t\t\"food_price\": 10.0,\n\t\t\t\t\"originalFoodPrice\": 10.0,\n\t\t\t\t\"unit\": \"份\",\n\t\t\t\t\"count\": 1,\n\t\t\t\t\"box_num\": 1.0,\n\t\t\t\t\"box_price\": 0.0,\n\t\t\t\t\"cartId\": 0,\n\t\t\t\t\"cartName\": \"1号口袋\",\n\t\t\t\t\"upcCode\": \"\",\n\t\t\t\t\"skuCode\": \"\",\n\t\t\t\t\"locatorCode\": \"\",\n\t\t\t\t\"discountPoint\": \"\",\n\t\t\t\t\"discountRemark\": \"\",\n\t\t\t\t\"picUrl\": \"http://p0.meituan.net/wmproduct/d852b****0fa2d7f3d1adf7d95423.jpg\",\n\t\t\t\t\"specification\": \"\"\n\t\t\t}],\n\t\t\t\"discounts\": [],\n\t\t\t\"tips\": [],\n\t\t\t\"canBeCancelled\": 1,\n\t\t\t\"cancel_reason\": \"\",\n\t\t\t\"is_pre_order\": 0,\n\t\t\t\"delivery_btime\": 0,\n\t\t\t\"pre_order_delivery_info\": \"\",\n\t\t\t\"pay_utime\": 1603013218,\n\t\t\t\"pay_utime_fmt\": \"2020-10-18 17:26:58\",\n\t\t\t\"online_paid_info\": \"\",\n\t\t\t\"pre_order_remind\": 0,\n\t\t\t\"pre_order_tip\": \"预订单：期望送达时间\",\n\t\t\t\"overtime_paid_info\": \"\",\n\t\t\t\"invoice_title\": \"\",\n\t\t\t\"wm_order_pay_type\": 2,\n\t\t\t\"actual_pay_type\": 2,\n\t\t\t\"dispatch_code\": \"\",\n\t\t\t\"longitude\": 104251302,\n\t\t\t\"latitude\": 30880900,\n\t\t\t\"inArea\": 1,\n\t\t\t\"orderDistance\": 2120.0,\n\t\t\t\"addressLongitude\": 104251302,\n\t\t\t\"addressLatitude\": 30880900,\n\t\t\t\"riderPayment\": \"\",\n\t\t\t\"zbShippingFee\": \"\",\n\t\t\t\"zbShippingTips\": \"\",\n\t\t\t\"tipsVos\": [],\n\t\t\t\"status_desc\": \"已接单\",\n\t\t\t\"delivery_btime_fmt\": \"\",\n\t\t\t\"logistics_code\": \"\",\n\t\t\t\"logisticsService\": 1,\n\t\t\t\"logistics_status\": -1,\n\t\t\t\"hasFrozen\": 0,\n\t\t\t\"estimateArrivalTime\": 1603020418,\n\t\t\t\"poi_push_day\": 20201018,\n\t\t\t\"bindedPhone\": \"178**858,4109\",\n\t\t\t\"isLargeAmountOrder\": 0,\n\t\t\t\"userOrderCount\": 2,\n\t\t\t\"pickType\": 0,\n\t\t\t\"isUsePrivacyPhone\": 1,\n\t\t\t\"privacyPhone\": \"1788**4858,4109\",\n\t\t\t\"phoneShow\": \"178**8转4109\",\n\t\t\t\"privacyPhoneStatus\": 0,\n\t\t\t\"recipientPhoneShow\": \"手机尾号2605\",\n\t\t\t\"packageBagMoney\": 0.0,\n\t\t\t\"wmUserId\": 371311890,\n\t\t\t\"confirmTime\": 1603013218,\n\t\t\t\"cansunStatus\": 0,\n\t\t\t\"cansunInfo\": [],\n\t\t\t\"wmChargeBusiness\": {\n\t\t\t\t\"wmOrderViewId\": 56367802727202186,\n\t\t\t\t\"activityAmount\": \"0.0\",\n\t\t\t\t\"activityDetails\": [],\n\t\t\t\t\"commisionAmount\": \"-1.0\",\n\t\t\t\t\"settleAmount\": \"8.95\",\n\t\t\t\t\"offlineOrderSkPayAmount\": \"0.0\",\n\t\t\t\t\"shippingType\": \"0000\",\n\t\t\t\t\"commisionDetails\": [{\n\t\t\t\t\t\"chargeAmount\": \"-1.0\",\n\t\t\t\t\t\"chargeDesc\": \"服务费\"\n\t\t\t\t}],\n\t\t\t\t\"userOnlinePayAfter\": \"\",\n\t\t\t\t\"discounts\": [],\n\t\t\t\t\"isDowngrade\": false,\n\t\t\t\t\"shippingFee\": \"0.0\",\n\t\t\t\t\"riderPayment\": \"\",\n\t\t\t\t\"isRiderPay\": false,\n\t\t\t\t\"giftDetails\": [],\n\t\t\t\t\"userPayAmount\": \"0.0\",\n\t\t\t\t\"foodAmount\": \"10.0\",\n\t\t\t\t\"userPayTotalAmount\": \"10.0\",\n\t\t\t\t\"donateAmount\": \"-0.05\",\n\t\t\t\t\"agreementAmount\": 0.0,\n\t\t\t\t\"chargeMode\": 1\n\t\t\t},\n\t\t\t\"userTips\": [{\n\t\t\t\t\"category\": 17,\n\t\t\t\t\"type\": \"下单2次\",\n\t\t\t\t\"info\": \"该用户过去90天完成订单数\"\n\t\t\t}],\n\t\t\t\"bindedPrivacyPhoneList\": [{\n\t\t\t\t\"privacyPhoneShow\": \"130**773转5108\",\n\t\t\t\t\"privacyPhone\": \"13**4773,5108\"\n\t\t\t}],\n\t\t\t\"backupField\": [],\n\t\t\t\"onTimeInsurance\": {\n\t\t\t\t\"effect\": 0,\n\t\t\t\t\"desc\": \"\",\n\t\t\t\t\"status\": 0\n\t\t\t},\n\t\t\t\"foodSafeInsurance\": {\n\t\t\t\t\"effect\": 0,\n\t\t\t\t\"desc\": \"\",\n\t\t\t\t\"status\": 0\n\t\t\t},\n\t\t\t\"thirdLogistics\": {\n\t\t\t\t\"courierName\": \"\",\n\t\t\t\t\"courierPhone\": \"\",\n\t\t\t\t\"logisticsPlatformName\": \"\",\n\t\t\t\t\"logisticsPlatformCode\": \"\",\n\t\t\t\t\"deliverTime\": \"\",\n\t\t\t\t\"allowAlterType\": true\n\t\t\t},\n\t\t\t\"preMakerValid\": 1,\n\t\t\t\"retailOrderPreMakerInfo\": {\n\t\t\t\t\"preMakerPrivacyPhoneShow\": \"1788**37转9232\",\n\t\t\t\t\"preMakerPhoneShow\": \"178**7转9232\",\n\t\t\t\t\"preMakerPhone\": \"178**137,9232\",\n\t\t\t\t\"preMakerTag\": \"购花使者\",\n\t\t\t\t\"preMakerPrivacyPhoneShowAfter\": \"1******8137转9232\",\n\t\t\t\t\"preMakerBackupPrivacyPhone\": [{\n\t\t\t\t\t\"privacyPhoneShow\": \"185**029转1199\",\n\t\t\t\t\t\"privacyPhone\": \"18**4029,1199\"\n\t\t\t\t}]\n\t\t\t}\n\t\t}],\n\t\t\"changes\": [],\n\t\t\"orderSynCtime\": 1603013219,\n\t\t\"orderSynUtime\": 1603013219\n\t}\n}\n```\n\n## 3.1 确认送达时间：\n\n```json\n\"estimateArrivalTime\": 1603020418,\n```\n\n从信息中提取到送达时间的时间戳，时间戳是指，格林威治时间从1970-01-01 00:00:00到某个时间点所经历的秒数，可以表达绝对时间领域的一个时刻。其转化为我们所能够阅读的时间，是根据计算机系统时间来计算的。不同时区的计算机得到的结果是不一样的。上述时间戳，转为北京时间后是`2020-10-18 19:26:58`。在转换时，默认时根据计算机所在时区转换。所以，最好指定转换时区。\n\n```python\nimport pytz\nts = 1566395745\ntz = pytz.timezone(' Asia/Shanghai')\ndt = pytz.datetime.datetime.fromtimestamp(ts, tz)\ndt.strftime('%Y-%m-%d %H:%M:%S')\n12345\n```\n\n结果为：`2019-08-21 09:55:45`\n\n## 3.2 送达地点\n\n在信息中，是没有配送地点的内容的，如果，通过appium来点击`查看地址`在爬取地址信息，就过于麻烦。再次研究订单信息JSON数据后，我发现，在订单中，有一行数据为\n\n```JSON\n\t\t\t\"addressLongitude\": 104251302,\n\t\t\t\"addressLatitude\": 30880900,\n```\n\n这是地址编码，对应的是经纬度信息。在[高德地图API接口手册](https://lbs.amap.com/api/webservice/guide/api/georegeo/)中，我找到了适合地址解码的api\n\n```\nhttps://restapi.amap.com/v3/geocode/regeo?output=xml&location=116.310003,39.991957&key=<用户的key>&radius=1000&extensions=all\n```\n\n测试后，从api返回的地址正是收货地址。\n\n可以看到，Longitude经度，Latitude维度。这个参数是以六位小数结尾的数据。。而订单中，是没有把小数位表现出来的，所以需要单独修改。\n\n> 为了让饿了么和美团的订单，具有相同的格式，我们需要修改之前确定的饿了么订单对象。把送达时间统一更改为时间戳，把地址信息统一转为地理编码后的经纬度。\n\n# 4：Python编程\n\n下面是包含了饿了么和美团外卖的完整程序\n\n```python\n# -*- encoding: utf-8 -*-\n'''\n@file_name    :order.py\n@description  :\n@time         :2020/10/16 21:25:01\n@author       :Qifei\n@version      :1.0\n'''\n\nimport mitmproxy.http\nimport json\n\n#顾客类\nclass Customer(object):\n    def __init__(self,name,tel):\n        self.name = name \n        self.tel = tel\n       \n\n#商品类\nclass Good(object):\n    def __init__(self,name,number,img):\n        self.name = name\n        self.number = number\n        self.img = img\n\n#订单类\nclass Order(Customer):\n    def __init__(self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods):\n        Customer.__init__(self,name,tel)\n        self.addr_long = addr_long\n        self.addr_latu = addr_latu\n        self.note = note\n        self.arri_time = arri_time\n        self.order_id = order_id\n        self.goods = goods\n        self.platform = platform\n\n#截获饿了么订单\nclass ElemeOrders():\n    def __init__(self):\n        self.orders = []\n\n    def response(self, flow: mitmproxy.http.flow):\n        if \"bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?\" in flow.request.url:\n            data = json.loads(flow.response.text)[\"data\"]\n            for total_order_list in data['total_order_list']:\n                for order_list in total_order_list['order_list']:\n                    goods = []\n                    for good in order_list['order_goods']['goods_list']:\n                        good_buffer = Good(good['name'],good['number'],good['url'])\n                        goods.append(good_buffer)\n                    order = Order('eleme',order_list['order_basic']['user_real_name']+order_list['order_basic']['sex'],order_list['order_basic']['user_phone'],str(order_list['order_basic']['user_address_lng']),str(order_list['order_basic']['user_address_lat']),order_list['order_basic']['user_note'],order_list['order_basic']['takeout_average_time'],order_list['order_basic']['order_id'],goods)\n                    self.orders.append(order)\n            print(self.orders)\n\n #截获美团订单\nclass MeituanOrders():\n    def __init__(self):\n        self.orders = []\n\n    def response(self, flow: mitmproxy.http.flow):\n        if \"eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?\" in flow.request.url:\n            data = json.loads(flow.response.text)[\"data\"]\n            for order_list in data['news']:\n                goods = []\n                for good in order_list['details']:\n                    good_buffer = Good(good['food_name'],good['count'],good['picUrl'])\n                    goods.append(good_buffer)\n                order = Order('meituan',order_list['recipient_name'],order_list['recipient_phone'],self.geo_format(order_list['longitude']),self.geo_format(order_list['latitude']),order_list['remark'],order_list['estimateArrivalTime'],order_list['id'],goods)\n                self.orders.append(order)\n            print(self.orders[0].name)\n\n    #将经纬度162787612转为162.787612\n    def geo_format(self,int_geo):\n        str_geo = str(int_geo)  #162787612\n        list_geo = list(str_geo)    #['1','6','2','7','8','7','6','1','2']\n        list_geo.insert(-6,'.')\n        new_str = ''.join(list_geo)\n        return new_str\n\n#mitmproxy插件\naddons = [\n    ElemeOrders(),\n    MeituanOrders()\n]\n```\n\n# 5：参考资料\n\n《[给Android7及以上的手机安装系统级证书，实现Fiddler或者其他程序的HTTPS的抓包](https://blog.csdn.net/djzhao627/article/details/102812783)》\n\n《[python将时间戳转换为指定时区时间](https://blog.csdn.net/Crazy_zh/article/details/100013256)》","source":"_posts/外卖平台订单爬取之美团外卖商家版.md","raw":"---\ntitle: 外卖平台订单爬取之美团外卖商家版\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-10-17 18:49:09\npassword:\nsummary:\ntags: -TWRP\ncategories: 爬虫\n---\n\n# 1：root手机\n\n昨天，我利用mitmproxy成功拦截了饿了么服务器返回的订单信息。今天，我准备故技重施，获取美团订单。残酷的现实给我炽热地心浇了一盆冷水。无论我如何调整mitmproxy和美团外卖商家版，都无法获取到美团服务器返回的数据。更确切地说，美团服务器似乎发现，有这么一个小偷，准备偷取它返回给客户端地数据。因此拒绝给客户端传递数据。\n\n我在网上找了一些解答，在安卓7.0之后，安卓系统允许安卓应用不信任用户上传地CA证书，众所周知，在中间人攻击中，将代理服务器的CA证书添加到安卓用户证书里，这样代理服务器在客户端和https服务端之间做个信使，他们的来回信件，信使就能拆开阅读，再封好发出去。现在安卓系统允许安卓应用设置是否信任用户证书，很明显，美团外卖商家版，不支持用户自定义证书。\n\n好在，安卓系统有个要求，就是系统证书都是被认可的。而添加系统证书，需要修改手机system文件夹，需要将手机root。\n\n待root手机：三星S8+\n\n工具：Odin线刷工具，第三方recovery TWRP，Tomato卡刷包（卡刷包含root）。\n\n# 2：添加CA证书为系统证书\n\nmitmproxy会在其运行目录生成一个`.mitmproxy`隐藏目录，目录中的`mitmproxy-ca-cert.pem`是可以直接放到系统证书目录下的证书。首先需要将它更名为统一的格式。\n\n```shell\n#openssl版本在1.0以上的版本的执行这一句\nopenssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem\t\n#openssl版本在1.0以下的版本的执行这一句\nopenssl x509 -inform PEM -subject_hash -in mitmproxy-ca-cert.pem\n```\n\n生成`347bacb5`证书的hash值，然后将`mitmproxy-ca-cert.pem`更名为`347bacb5.0`\n\n将更名后的证书放到安卓系统证书目录，root后的安卓手机，可以直接打开RE管理器进入系统目录\n\n```\n/system/etc/security/cacerts\n```\n\n重启手机。修改wifi代理，并连接mitmproxy。\n\n打开美团外卖商家版，不再报没有网络连接的错误。此时即可以从代理中截获解码后的信息了。\n\n# 3：截获订单请求数据\n\n开启mitmproxy，开始收集请求。在美团上下单，可以截获下单后，美团服务器发送到客户端的订单信息。\n\n进行中订单请求地址，部分内容已打码：\n\n```\nhttps://eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?region_id=10***0100&region_version=153***1&__skck=8f5973b0***&__skts=16***8&__skua=d41d8c***8427e&__skno=94899011-***\n```\n\n预订单请求地址：\n\n```\nhttps://eapi.waimai.meituan.com/api/retail/order/pre/orders?region_id=1000510100&region_version=1534166411&__skck=8f5973b085446090f224af74e30e0181&__skts=1603035614&__skua=d41d8cd98f00b204e9800998ecf8427e&__skno=ed5fa567-5e33-4186-806a-e1ee884b5d5c&__skcy=hNEhcBUBRBinXjXwhZ%2BoMtvkMu8%3D\n```\n\n进行中响应内容：\n\n```JSON\n{\n\t\"msg\": \"Success\",\n\t\"code\": 0,\n\t\"data\": {\n\t\t\"serverTime\": 1603013219,\n\t\t\"news\": [{\n\t\t\t\"agreeBtn\": 0,\n\t\t\t\"reject_reason\": \"\",\n\t\t\t\"rejectBtn\": 0,\n\t\t\t\"apply_refund_type\": 0,\n\t\t\t\"appealReason\": \"\",\n\t\t\t\"pay_status\": 3,\n\t\t\t\"payExpireTime\": 0,\n\t\t\t\"orderDescription\": \"\",\n\t\t\t\"pay_status_desc\": \"已付款\",\n\t\t\t\"apply_reason\": \"\",\n\t\t\t\"applyRefundTime\": 0,\n\t\t\t\"rejectRefundTime\": \"\",\n\t\t\t\"appealRefundTime\": 0,\n\t\t\t\"refundFinishTime\": \"\",\n\t\t\t\"isPartRefundApply\": 0,\n\t\t\t\"isAllowPartRefund\": 0,\n\t\t\t\"isAllowAllRefund\": false,\n\t\t\t\"hasMigratedToRetail\": true,\n\t\t\t\"returnSubStatus\": 0,\n\t\t\t\"logistics\": {\n\t\t\t\t\"id\": -1,\n\t\t\t\t\"type\": 101,\n\t\t\t\t\"icon\": \"\",\n\t\t\t\t\"name\": \"\",\n\t\t\t\t\"status\": -1,\n\t\t\t\t\"statusDesc\": \"\",\n\t\t\t\t\"sendTime\": -1,\n\t\t\t\t\"confirmTime\": -1,\n\t\t\t\t\"arrivePoiTime\": -1,\n\t\t\t\t\"selfDeliveryTime\": -1,\n\t\t\t\t\"fetchTime\": -1,\n\t\t\t\t\"completedTime\": -1,\n\t\t\t\t\"cancelTime\": -1,\n\t\t\t\t\"collectTime\": 0,\n\t\t\t\t\"departureTime\": 0,\n\t\t\t\t\"reachTime\": 0,\n\t\t\t\t\"takeTime\": 0,\n\t\t\t\t\"timeOut\": -1,\n\t\t\t\t\"code\": \"\",\n\t\t\t\t\"valid\": 1,\n\t\t\t\t\"shippingFee\": 0.0,\n\t\t\t\t\"tipFee\": 0.0,\n\t\t\t\t\"shippingTips\": \"\",\n\t\t\t\t\"couponAmount\": 0.0,\n\t\t\t\t\"activityName\": \"\",\n\t\t\t\t\"activityAmount\": 0.0,\n\t\t\t\t\"extraFee\": 0.0,\n\t\t\t\t\"payAmount\": 0.0,\n\t\t\t\t\"shippingFeeBase\": 0.0,\n\t\t\t\t\"payType\": \"\",\n\t\t\t\t\"zbType\": 0,\n\t\t\t\t\"orderDistance\": 0.0,\n\t\t\t\t\"ifSelfLogistics\": 0,\n\t\t\t\t\"isCanChangeSelfLogistics\": 0,\n\t\t\t\t\"dispatcher\": {\n\t\t\t\t\t\"name\": \"\",\n\t\t\t\t\t\"mobile\": \"\",\n\t\t\t\t\t\"icon\": \"\",\n\t\t\t\t\t\"role\": \"配送员\",\n\t\t\t\t\t\"type\": -1,\n\t\t\t\t\t\"typeName\": \"\"\n\t\t\t\t},\n\t\t\t\t\"dispatchMaster\": {\n\t\t\t\t\t\"name\": \"站点\",\n\t\t\t\t\t\"mobile\": \"\",\n\t\t\t\t\t\"icon\": \"\",\n\t\t\t\t\t\"role\": \"站长\"\n\t\t\t\t},\n\t\t\t\t\"dispatchAssistant\": {\n\t\t\t\t\t\"name\": \"站点备用\",\n\t\t\t\t\t\"mobile\": \"\",\n\t\t\t\t\t\"icon\": \"\",\n\t\t\t\t\t\"role\": \"站长助理\"\n\t\t\t\t},\n\t\t\t\t\"unionDispatcher\": {\n\t\t\t\t\t\"name\": \"\",\n\t\t\t\t\t\"mobile\": \"\"\n\t\t\t\t},\n\t\t\t\t\"logisticsSubCode\": \"\",\n\t\t\t\t\"dispatchOrderId\": -1,\n\t\t\t\t\"delayPushSecond\": 0,\n\t\t\t\t\"delayPushMin\": 0,\n\t\t\t\t\"assignTime\": 0,\n\t\t\t\t\"thirdLogisticsCode\": \"\"\n\t\t\t},\n\t\t\t\"printRelayBarCode\": false,\n\t\t\t\"utime\": 1603013218,\n\t\t\t\"refundType\": -1,\n\t\t\t\"isCanChangeSelfLogistics\": 0,\n\t\t\t\"refundProcessEndTips\": \"\",\n\t\t\t\"ifSelfLogistics\": 0,\n\t\t\t\"cancelButtonShow\": 0,\n\t\t\t\"foodDoneInfo\": {\n\t\t\t\t\"isShowFoodDoneBlock\": 0,\n\t\t\t\t\"isfoodDone\": 0,\n\t\t\t\t\"foodDoneStatus\": \"拣货完成\",\n\t\t\t\t\"foodDoneTime\": 0,\n\t\t\t\t\"foodSendOutTimeDeadline\": 0,\n\t\t\t\t\"diningMinutes\": 0,\n\t\t\t\t\"foodSendDeviceInfo\": \"\"\n\t\t\t},\n\t\t\t\"logisticsAbnormalInfo\": {\n\t\t\t\t\"isLogisticsAbnormal\": 0,\n\t\t\t\t\"logisticsAbnormalDesc\": \"\",\n\t\t\t\t\"logisticsAbnormalType\": 0,\n\t\t\t\t\"isShowLogisticsReport\": 0,\n\t\t\t\t\"logisticsReportDesc\": \"\"\n\t\t\t},\n\t\t\t\"refundOtherInfos\": {\n\t\t\t\t\"returnStatusDesc\": \"\",\n\t\t\t\t\"returnSubStatusDesc\": \"\",\n\t\t\t\t\"returnMaxPayAcount\": 100.0,\n\t\t\t\t\"returnSubStatus\": 0,\n\t\t\t\t\"countDownDesc\": \"\",\n\t\t\t\t\"refundViewId\": 0,\n\t\t\t\t\"serviceType\": 0,\n\t\t\t\t\"refundRuleUrl\": \"http://s3plus.sankuai.com/v1/mss_03d0d9cf21144ba0b7747ba1dc1acf6e/order/refund_rules.html\"\n\t\t\t},\n\t\t\t\"refundInfoList\": [],\n\t\t\t\"refundGoodsInfoList\": [],\n\t\t\t\"isAppealApply\": 0,\n\t\t\t\"compensationInfo\": {\n\t\t\t\t\"id\": 0,\n\t\t\t\t\"title\": \"\",\n\t\t\t\t\"time\": 0,\n\t\t\t\t\"moneyDesc\": \"\",\n\t\t\t\t\"reason\": \"\",\n\t\t\t\t\"pictures\": [],\n\t\t\t\t\"appealInfo\": \"\"\n\t\t\t},\n\t\t\t\"orderImValid\": 1,\n\t\t\t\"imGuideContent\": \"\",\n\t\t\t\"imReplyDefaultContent\": \"\",\n\t\t\t\"isAllowPriceDiffRefund\": false,\n\t\t\t\"confirmDeliveryStatus\": 0,\n\t\t\t\"id\": 56367**02186,\n\t\t\t\"wm_poi_id\": 5636780,\n\t\t\t\"wm_poi_order_dayseq\": 1,\n\t\t\t\"wm_order_id_view\": 563678***186,\n\t\t\t\"num\": 1,\n\t\t\t\"poi_name\": \"**鲜花店\",\n\t\t\t\"order_source\": 1,\n\t\t\t\"order_source_desc\": \"手机APP下单\",\n\t\t\t\"shipping_fee\": 0.0,\n\t\t\t\"recipient_name\": \"谢先生\",\n\t\t\t\"recipient_phone\": \"178**858,4109\",\n\t\t\t\"recipient_address\": \"\",\n\t\t\t\"total_after\": 10.0,\n\t\t\t\"total_before\": 10.0,\n\t\t\t\"boxpriceTotal\": 0.0,\n\t\t\t\"remark\": \"[贺卡内容]贺卡内容 [其他备注]备注内容\",\n\t\t\t\"environmentalFriendlyOrder\": 0,\n\t\t\t\"status\": 4,\n\t\t\t\"order_time\": 1603013207,\n\t\t\t\"order_time_fmt\": \"10-18 17:26\",\n\t\t\t\"confirmOrderTime\": 1603013218,\n\t\t\t\"details\": [{\n\t\t\t\t\"id\": 1945297344,\n\t\t\t\t\"food_name\": \"8枝红色非洲菊 \",\n\t\t\t\t\"food_price\": 10.0,\n\t\t\t\t\"originalFoodPrice\": 10.0,\n\t\t\t\t\"unit\": \"份\",\n\t\t\t\t\"count\": 1,\n\t\t\t\t\"box_num\": 1.0,\n\t\t\t\t\"box_price\": 0.0,\n\t\t\t\t\"cartId\": 0,\n\t\t\t\t\"cartName\": \"1号口袋\",\n\t\t\t\t\"upcCode\": \"\",\n\t\t\t\t\"skuCode\": \"\",\n\t\t\t\t\"locatorCode\": \"\",\n\t\t\t\t\"discountPoint\": \"\",\n\t\t\t\t\"discountRemark\": \"\",\n\t\t\t\t\"picUrl\": \"http://p0.meituan.net/wmproduct/d852b****0fa2d7f3d1adf7d95423.jpg\",\n\t\t\t\t\"specification\": \"\"\n\t\t\t}],\n\t\t\t\"discounts\": [],\n\t\t\t\"tips\": [],\n\t\t\t\"canBeCancelled\": 1,\n\t\t\t\"cancel_reason\": \"\",\n\t\t\t\"is_pre_order\": 0,\n\t\t\t\"delivery_btime\": 0,\n\t\t\t\"pre_order_delivery_info\": \"\",\n\t\t\t\"pay_utime\": 1603013218,\n\t\t\t\"pay_utime_fmt\": \"2020-10-18 17:26:58\",\n\t\t\t\"online_paid_info\": \"\",\n\t\t\t\"pre_order_remind\": 0,\n\t\t\t\"pre_order_tip\": \"预订单：期望送达时间\",\n\t\t\t\"overtime_paid_info\": \"\",\n\t\t\t\"invoice_title\": \"\",\n\t\t\t\"wm_order_pay_type\": 2,\n\t\t\t\"actual_pay_type\": 2,\n\t\t\t\"dispatch_code\": \"\",\n\t\t\t\"longitude\": 104251302,\n\t\t\t\"latitude\": 30880900,\n\t\t\t\"inArea\": 1,\n\t\t\t\"orderDistance\": 2120.0,\n\t\t\t\"addressLongitude\": 104251302,\n\t\t\t\"addressLatitude\": 30880900,\n\t\t\t\"riderPayment\": \"\",\n\t\t\t\"zbShippingFee\": \"\",\n\t\t\t\"zbShippingTips\": \"\",\n\t\t\t\"tipsVos\": [],\n\t\t\t\"status_desc\": \"已接单\",\n\t\t\t\"delivery_btime_fmt\": \"\",\n\t\t\t\"logistics_code\": \"\",\n\t\t\t\"logisticsService\": 1,\n\t\t\t\"logistics_status\": -1,\n\t\t\t\"hasFrozen\": 0,\n\t\t\t\"estimateArrivalTime\": 1603020418,\n\t\t\t\"poi_push_day\": 20201018,\n\t\t\t\"bindedPhone\": \"178**858,4109\",\n\t\t\t\"isLargeAmountOrder\": 0,\n\t\t\t\"userOrderCount\": 2,\n\t\t\t\"pickType\": 0,\n\t\t\t\"isUsePrivacyPhone\": 1,\n\t\t\t\"privacyPhone\": \"1788**4858,4109\",\n\t\t\t\"phoneShow\": \"178**8转4109\",\n\t\t\t\"privacyPhoneStatus\": 0,\n\t\t\t\"recipientPhoneShow\": \"手机尾号2605\",\n\t\t\t\"packageBagMoney\": 0.0,\n\t\t\t\"wmUserId\": 371311890,\n\t\t\t\"confirmTime\": 1603013218,\n\t\t\t\"cansunStatus\": 0,\n\t\t\t\"cansunInfo\": [],\n\t\t\t\"wmChargeBusiness\": {\n\t\t\t\t\"wmOrderViewId\": 56367802727202186,\n\t\t\t\t\"activityAmount\": \"0.0\",\n\t\t\t\t\"activityDetails\": [],\n\t\t\t\t\"commisionAmount\": \"-1.0\",\n\t\t\t\t\"settleAmount\": \"8.95\",\n\t\t\t\t\"offlineOrderSkPayAmount\": \"0.0\",\n\t\t\t\t\"shippingType\": \"0000\",\n\t\t\t\t\"commisionDetails\": [{\n\t\t\t\t\t\"chargeAmount\": \"-1.0\",\n\t\t\t\t\t\"chargeDesc\": \"服务费\"\n\t\t\t\t}],\n\t\t\t\t\"userOnlinePayAfter\": \"\",\n\t\t\t\t\"discounts\": [],\n\t\t\t\t\"isDowngrade\": false,\n\t\t\t\t\"shippingFee\": \"0.0\",\n\t\t\t\t\"riderPayment\": \"\",\n\t\t\t\t\"isRiderPay\": false,\n\t\t\t\t\"giftDetails\": [],\n\t\t\t\t\"userPayAmount\": \"0.0\",\n\t\t\t\t\"foodAmount\": \"10.0\",\n\t\t\t\t\"userPayTotalAmount\": \"10.0\",\n\t\t\t\t\"donateAmount\": \"-0.05\",\n\t\t\t\t\"agreementAmount\": 0.0,\n\t\t\t\t\"chargeMode\": 1\n\t\t\t},\n\t\t\t\"userTips\": [{\n\t\t\t\t\"category\": 17,\n\t\t\t\t\"type\": \"下单2次\",\n\t\t\t\t\"info\": \"该用户过去90天完成订单数\"\n\t\t\t}],\n\t\t\t\"bindedPrivacyPhoneList\": [{\n\t\t\t\t\"privacyPhoneShow\": \"130**773转5108\",\n\t\t\t\t\"privacyPhone\": \"13**4773,5108\"\n\t\t\t}],\n\t\t\t\"backupField\": [],\n\t\t\t\"onTimeInsurance\": {\n\t\t\t\t\"effect\": 0,\n\t\t\t\t\"desc\": \"\",\n\t\t\t\t\"status\": 0\n\t\t\t},\n\t\t\t\"foodSafeInsurance\": {\n\t\t\t\t\"effect\": 0,\n\t\t\t\t\"desc\": \"\",\n\t\t\t\t\"status\": 0\n\t\t\t},\n\t\t\t\"thirdLogistics\": {\n\t\t\t\t\"courierName\": \"\",\n\t\t\t\t\"courierPhone\": \"\",\n\t\t\t\t\"logisticsPlatformName\": \"\",\n\t\t\t\t\"logisticsPlatformCode\": \"\",\n\t\t\t\t\"deliverTime\": \"\",\n\t\t\t\t\"allowAlterType\": true\n\t\t\t},\n\t\t\t\"preMakerValid\": 1,\n\t\t\t\"retailOrderPreMakerInfo\": {\n\t\t\t\t\"preMakerPrivacyPhoneShow\": \"1788**37转9232\",\n\t\t\t\t\"preMakerPhoneShow\": \"178**7转9232\",\n\t\t\t\t\"preMakerPhone\": \"178**137,9232\",\n\t\t\t\t\"preMakerTag\": \"购花使者\",\n\t\t\t\t\"preMakerPrivacyPhoneShowAfter\": \"1******8137转9232\",\n\t\t\t\t\"preMakerBackupPrivacyPhone\": [{\n\t\t\t\t\t\"privacyPhoneShow\": \"185**029转1199\",\n\t\t\t\t\t\"privacyPhone\": \"18**4029,1199\"\n\t\t\t\t}]\n\t\t\t}\n\t\t}],\n\t\t\"changes\": [],\n\t\t\"orderSynCtime\": 1603013219,\n\t\t\"orderSynUtime\": 1603013219\n\t}\n}\n```\n\n## 3.1 确认送达时间：\n\n```json\n\"estimateArrivalTime\": 1603020418,\n```\n\n从信息中提取到送达时间的时间戳，时间戳是指，格林威治时间从1970-01-01 00:00:00到某个时间点所经历的秒数，可以表达绝对时间领域的一个时刻。其转化为我们所能够阅读的时间，是根据计算机系统时间来计算的。不同时区的计算机得到的结果是不一样的。上述时间戳，转为北京时间后是`2020-10-18 19:26:58`。在转换时，默认时根据计算机所在时区转换。所以，最好指定转换时区。\n\n```python\nimport pytz\nts = 1566395745\ntz = pytz.timezone(' Asia/Shanghai')\ndt = pytz.datetime.datetime.fromtimestamp(ts, tz)\ndt.strftime('%Y-%m-%d %H:%M:%S')\n12345\n```\n\n结果为：`2019-08-21 09:55:45`\n\n## 3.2 送达地点\n\n在信息中，是没有配送地点的内容的，如果，通过appium来点击`查看地址`在爬取地址信息，就过于麻烦。再次研究订单信息JSON数据后，我发现，在订单中，有一行数据为\n\n```JSON\n\t\t\t\"addressLongitude\": 104251302,\n\t\t\t\"addressLatitude\": 30880900,\n```\n\n这是地址编码，对应的是经纬度信息。在[高德地图API接口手册](https://lbs.amap.com/api/webservice/guide/api/georegeo/)中，我找到了适合地址解码的api\n\n```\nhttps://restapi.amap.com/v3/geocode/regeo?output=xml&location=116.310003,39.991957&key=<用户的key>&radius=1000&extensions=all\n```\n\n测试后，从api返回的地址正是收货地址。\n\n可以看到，Longitude经度，Latitude维度。这个参数是以六位小数结尾的数据。。而订单中，是没有把小数位表现出来的，所以需要单独修改。\n\n> 为了让饿了么和美团的订单，具有相同的格式，我们需要修改之前确定的饿了么订单对象。把送达时间统一更改为时间戳，把地址信息统一转为地理编码后的经纬度。\n\n# 4：Python编程\n\n下面是包含了饿了么和美团外卖的完整程序\n\n```python\n# -*- encoding: utf-8 -*-\n'''\n@file_name    :order.py\n@description  :\n@time         :2020/10/16 21:25:01\n@author       :Qifei\n@version      :1.0\n'''\n\nimport mitmproxy.http\nimport json\n\n#顾客类\nclass Customer(object):\n    def __init__(self,name,tel):\n        self.name = name \n        self.tel = tel\n       \n\n#商品类\nclass Good(object):\n    def __init__(self,name,number,img):\n        self.name = name\n        self.number = number\n        self.img = img\n\n#订单类\nclass Order(Customer):\n    def __init__(self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods):\n        Customer.__init__(self,name,tel)\n        self.addr_long = addr_long\n        self.addr_latu = addr_latu\n        self.note = note\n        self.arri_time = arri_time\n        self.order_id = order_id\n        self.goods = goods\n        self.platform = platform\n\n#截获饿了么订单\nclass ElemeOrders():\n    def __init__(self):\n        self.orders = []\n\n    def response(self, flow: mitmproxy.http.flow):\n        if \"bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?\" in flow.request.url:\n            data = json.loads(flow.response.text)[\"data\"]\n            for total_order_list in data['total_order_list']:\n                for order_list in total_order_list['order_list']:\n                    goods = []\n                    for good in order_list['order_goods']['goods_list']:\n                        good_buffer = Good(good['name'],good['number'],good['url'])\n                        goods.append(good_buffer)\n                    order = Order('eleme',order_list['order_basic']['user_real_name']+order_list['order_basic']['sex'],order_list['order_basic']['user_phone'],str(order_list['order_basic']['user_address_lng']),str(order_list['order_basic']['user_address_lat']),order_list['order_basic']['user_note'],order_list['order_basic']['takeout_average_time'],order_list['order_basic']['order_id'],goods)\n                    self.orders.append(order)\n            print(self.orders)\n\n #截获美团订单\nclass MeituanOrders():\n    def __init__(self):\n        self.orders = []\n\n    def response(self, flow: mitmproxy.http.flow):\n        if \"eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?\" in flow.request.url:\n            data = json.loads(flow.response.text)[\"data\"]\n            for order_list in data['news']:\n                goods = []\n                for good in order_list['details']:\n                    good_buffer = Good(good['food_name'],good['count'],good['picUrl'])\n                    goods.append(good_buffer)\n                order = Order('meituan',order_list['recipient_name'],order_list['recipient_phone'],self.geo_format(order_list['longitude']),self.geo_format(order_list['latitude']),order_list['remark'],order_list['estimateArrivalTime'],order_list['id'],goods)\n                self.orders.append(order)\n            print(self.orders[0].name)\n\n    #将经纬度162787612转为162.787612\n    def geo_format(self,int_geo):\n        str_geo = str(int_geo)  #162787612\n        list_geo = list(str_geo)    #['1','6','2','7','8','7','6','1','2']\n        list_geo.insert(-6,'.')\n        new_str = ''.join(list_geo)\n        return new_str\n\n#mitmproxy插件\naddons = [\n    ElemeOrders(),\n    MeituanOrders()\n]\n```\n\n# 5：参考资料\n\n《[给Android7及以上的手机安装系统级证书，实现Fiddler或者其他程序的HTTPS的抓包](https://blog.csdn.net/djzhao627/article/details/102812783)》\n\n《[python将时间戳转换为指定时区时间](https://blog.csdn.net/Crazy_zh/article/details/100013256)》","slug":"外卖平台订单爬取之美团外卖商家版","published":1,"updated":"2020-10-18T15:43:44.512Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgfr41mu0004lkvz6g6v5jc2","content":"<h1 id=\"1：root手机\"><a href=\"#1：root手机\" class=\"headerlink\" title=\"1：root手机\"></a>1：root手机</h1><p>昨天，我利用mitmproxy成功拦截了饿了么服务器返回的订单信息。今天，我准备故技重施，获取美团订单。残酷的现实给我炽热地心浇了一盆冷水。无论我如何调整mitmproxy和美团外卖商家版，都无法获取到美团服务器返回的数据。更确切地说，美团服务器似乎发现，有这么一个小偷，准备偷取它返回给客户端地数据。因此拒绝给客户端传递数据。</p>\n<p>我在网上找了一些解答，在安卓7.0之后，安卓系统允许安卓应用不信任用户上传地CA证书，众所周知，在中间人攻击中，将代理服务器的CA证书添加到安卓用户证书里，这样代理服务器在客户端和https服务端之间做个信使，他们的来回信件，信使就能拆开阅读，再封好发出去。现在安卓系统允许安卓应用设置是否信任用户证书，很明显，美团外卖商家版，不支持用户自定义证书。</p>\n<p>好在，安卓系统有个要求，就是系统证书都是被认可的。而添加系统证书，需要修改手机system文件夹，需要将手机root。</p>\n<p>待root手机：三星S8+</p>\n<p>工具：Odin线刷工具，第三方recovery TWRP，Tomato卡刷包（卡刷包含root）。</p>\n<h1 id=\"2：添加CA证书为系统证书\"><a href=\"#2：添加CA证书为系统证书\" class=\"headerlink\" title=\"2：添加CA证书为系统证书\"></a>2：添加CA证书为系统证书</h1><p>mitmproxy会在其运行目录生成一个<code>.mitmproxy</code>隐藏目录，目录中的<code>mitmproxy-ca-cert.pem</code>是可以直接放到系统证书目录下的证书。首先需要将它更名为统一的格式。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">openssl版本在1.0以上的版本的执行这一句</span></span><br><span class=\"line\">openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem\t</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">openssl版本在1.0以下的版本的执行这一句</span></span><br><span class=\"line\">openssl x509 -inform PEM -subject_hash -in mitmproxy-ca-cert.pem</span><br></pre></td></tr></table></figure>\n\n<p>生成<code>347bacb5</code>证书的hash值，然后将<code>mitmproxy-ca-cert.pem</code>更名为<code>347bacb5.0</code></p>\n<p>将更名后的证书放到安卓系统证书目录，root后的安卓手机，可以直接打开RE管理器进入系统目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts</span><br></pre></td></tr></table></figure>\n\n<p>重启手机。修改wifi代理，并连接mitmproxy。</p>\n<p>打开美团外卖商家版，不再报没有网络连接的错误。此时即可以从代理中截获解码后的信息了。</p>\n<h1 id=\"3：截获订单请求数据\"><a href=\"#3：截获订单请求数据\" class=\"headerlink\" title=\"3：截获订单请求数据\"></a>3：截获订单请求数据</h1><p>开启mitmproxy，开始收集请求。在美团上下单，可以截获下单后，美团服务器发送到客户端的订单信息。</p>\n<p>进行中订单请求地址，部分内容已打码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;eapi.waimai.meituan.com&#x2F;api&#x2F;retail&#x2F;order&#x2F;supplement&#x2F;increment&#x2F;orders?region_id&#x3D;10***0100&amp;region_version&#x3D;153***1&amp;__skck&#x3D;8f5973b0***&amp;__skts&#x3D;16***8&amp;__skua&#x3D;d41d8c***8427e&amp;__skno&#x3D;94899011-***</span><br></pre></td></tr></table></figure>\n\n<p>预订单请求地址：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;eapi.waimai.meituan.com&#x2F;api&#x2F;retail&#x2F;order&#x2F;pre&#x2F;orders?region_id&#x3D;1000510100&amp;region_version&#x3D;1534166411&amp;__skck&#x3D;8f5973b085446090f224af74e30e0181&amp;__skts&#x3D;1603035614&amp;__skua&#x3D;d41d8cd98f00b204e9800998ecf8427e&amp;__skno&#x3D;ed5fa567-5e33-4186-806a-e1ee884b5d5c&amp;__skcy&#x3D;hNEhcBUBRBinXjXwhZ%2BoMtvkMu8%3D</span><br></pre></td></tr></table></figure>\n\n<p>进行中响应内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">&quot;msg&quot;</span>: <span class=\"string\">&quot;Success&quot;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;data&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;serverTime&quot;</span>: <span class=\"number\">1603013219</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;news&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;agreeBtn&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;reject_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;rejectBtn&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;apply_refund_type&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;appealReason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_status&quot;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;payExpireTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;orderDescription&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_status_desc&quot;</span>: <span class=\"string\">&quot;已付款&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;apply_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;applyRefundTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;rejectRefundTime&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;appealRefundTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundFinishTime&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isPartRefundApply&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAllowPartRefund&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAllowAllRefund&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;hasMigratedToRetail&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;returnSubStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logistics&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"number\">101</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;statusDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;sendTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;confirmTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;arrivePoiTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;selfDeliveryTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;fetchTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;completedTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cancelTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;collectTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;departureTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;reachTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;takeTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;timeOut&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;valid&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingFee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;tipFee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingTips&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;couponAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityName&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;extraFee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;payAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingFeeBase&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;payType&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;zbType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;orderDistance&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;ifSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isCanChangeSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatcher&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;role&quot;</span>: <span class=\"string\">&quot;配送员&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;typeName&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatchMaster&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;站点&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;role&quot;</span>: <span class=\"string\">&quot;站长&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatchAssistant&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;站点备用&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;role&quot;</span>: <span class=\"string\">&quot;站长助理&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;unionDispatcher&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsSubCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatchOrderId&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;delayPushSecond&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;delayPushMin&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;assignTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;thirdLogisticsCode&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;printRelayBarCode&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;utime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundType&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isCanChangeSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundProcessEndTips&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;ifSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cancelButtonShow&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;foodDoneInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isShowFoodDoneBlock&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isfoodDone&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodDoneStatus&quot;</span>: <span class=\"string\">&quot;拣货完成&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodDoneTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodSendOutTimeDeadline&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;diningMinutes&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodSendDeviceInfo&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logisticsAbnormalInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isLogisticsAbnormal&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsAbnormalDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsAbnormalType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isShowLogisticsReport&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsReportDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundOtherInfos&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnStatusDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnSubStatusDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnMaxPayAcount&quot;</span>: <span class=\"number\">100.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnSubStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;countDownDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;refundViewId&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;serviceType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;refundRuleUrl&quot;</span>: <span class=\"string\">&quot;http://s3plus.sankuai.com/v1/mss_03d0d9cf21144ba0b7747ba1dc1acf6e/order/refund_rules.html&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundInfoList&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundGoodsInfoList&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAppealApply&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;compensationInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;moneyDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;pictures&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;appealInfo&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;orderImValid&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;imGuideContent&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;imReplyDefaultContent&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAllowPriceDiffRefund&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;confirmDeliveryStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">56367</span>**<span class=\"number\">02186</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_poi_id&quot;</span>: <span class=\"number\">5636780</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_poi_order_dayseq&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_order_id_view&quot;</span>: <span class=\"number\">563678</span>***<span class=\"number\">186</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;num&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;poi_name&quot;</span>: <span class=\"string\">&quot;**鲜花店&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_source&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_source_desc&quot;</span>: <span class=\"string\">&quot;手机APP下单&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;shipping_fee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipient_name&quot;</span>: <span class=\"string\">&quot;谢先生&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipient_phone&quot;</span>: <span class=\"string\">&quot;178**858,4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipient_address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;total_after&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;total_before&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;boxpriceTotal&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;remark&quot;</span>: <span class=\"string\">&quot;[贺卡内容]贺卡内容 [其他备注]备注内容&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;environmentalFriendlyOrder&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_time&quot;</span>: <span class=\"number\">1603013207</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_time_fmt&quot;</span>: <span class=\"string\">&quot;10-18 17:26&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;confirmOrderTime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;details&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">1945297344</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;food_name&quot;</span>: <span class=\"string\">&quot;8枝红色非洲菊 &quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;food_price&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;originalFoodPrice&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;unit&quot;</span>: <span class=\"string\">&quot;份&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;count&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;box_num&quot;</span>: <span class=\"number\">1.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;box_price&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cartId&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cartName&quot;</span>: <span class=\"string\">&quot;1号口袋&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;upcCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;skuCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;locatorCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;discountPoint&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;discountRemark&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;picUrl&quot;</span>: <span class=\"string\">&quot;http://p0.meituan.net/wmproduct/d852b****0fa2d7f3d1adf7d95423.jpg&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;specification&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;discounts&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;tips&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;canBeCancelled&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cancel_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;is_pre_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;delivery_btime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pre_order_delivery_info&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_utime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_utime_fmt&quot;</span>: <span class=\"string\">&quot;2020-10-18 17:26:58&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;online_paid_info&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pre_order_remind&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pre_order_tip&quot;</span>: <span class=\"string\">&quot;预订单：期望送达时间&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;overtime_paid_info&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;invoice_title&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_order_pay_type&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;actual_pay_type&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;dispatch_code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;longitude&quot;</span>: <span class=\"number\">104251302</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;latitude&quot;</span>: <span class=\"number\">30880900</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;inArea&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;orderDistance&quot;</span>: <span class=\"number\">2120.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;addressLongitude&quot;</span>: <span class=\"number\">104251302</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;addressLatitude&quot;</span>: <span class=\"number\">30880900</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;riderPayment&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;zbShippingFee&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;zbShippingTips&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;tipsVos&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;status_desc&quot;</span>: <span class=\"string\">&quot;已接单&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;delivery_btime_fmt&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logistics_code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logisticsService&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logistics_status&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;hasFrozen&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;estimateArrivalTime&quot;</span>: <span class=\"number\">1603020418</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;poi_push_day&quot;</span>: <span class=\"number\">20201018</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;bindedPhone&quot;</span>: <span class=\"string\">&quot;178**858,4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isLargeAmountOrder&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;userOrderCount&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pickType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isUsePrivacyPhone&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;privacyPhone&quot;</span>: <span class=\"string\">&quot;1788**4858,4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;phoneShow&quot;</span>: <span class=\"string\">&quot;178**8转4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;privacyPhoneStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipientPhoneShow&quot;</span>: <span class=\"string\">&quot;手机尾号2605&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;packageBagMoney&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wmUserId&quot;</span>: <span class=\"number\">371311890</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;confirmTime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cansunStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cansunInfo&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wmChargeBusiness&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;wmOrderViewId&quot;</span>: <span class=\"number\">56367802727202186</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityAmount&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityDetails&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;commisionAmount&quot;</span>: <span class=\"string\">&quot;-1.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;settleAmount&quot;</span>: <span class=\"string\">&quot;8.95&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;offlineOrderSkPayAmount&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingType&quot;</span>: <span class=\"string\">&quot;0000&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;commisionDetails&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;chargeAmount&quot;</span>: <span class=\"string\">&quot;-1.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;chargeDesc&quot;</span>: <span class=\"string\">&quot;服务费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;userOnlinePayAfter&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;discounts&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isDowngrade&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingFee&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;riderPayment&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isRiderPay&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;giftDetails&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;userPayAmount&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodAmount&quot;</span>: <span class=\"string\">&quot;10.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;userPayTotalAmount&quot;</span>: <span class=\"string\">&quot;10.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;donateAmount&quot;</span>: <span class=\"string\">&quot;-0.05&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;agreementAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;chargeMode&quot;</span>: <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;userTips&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;category&quot;</span>: <span class=\"number\">17</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;下单2次&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;info&quot;</span>: <span class=\"string\">&quot;该用户过去90天完成订单数&quot;</span></span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;bindedPrivacyPhoneList&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;privacyPhoneShow&quot;</span>: <span class=\"string\">&quot;130**773转5108&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;privacyPhone&quot;</span>: <span class=\"string\">&quot;13**4773,5108&quot;</span></span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;backupField&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;onTimeInsurance&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;effect&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;foodSafeInsurance&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;effect&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;thirdLogistics&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;courierName&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;courierPhone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsPlatformName&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsPlatformCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;deliverTime&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;allowAlterType&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;preMakerValid&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;retailOrderPreMakerInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPrivacyPhoneShow&quot;</span>: <span class=\"string\">&quot;1788**37转9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPhoneShow&quot;</span>: <span class=\"string\">&quot;178**7转9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPhone&quot;</span>: <span class=\"string\">&quot;178**137,9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerTag&quot;</span>: <span class=\"string\">&quot;购花使者&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPrivacyPhoneShowAfter&quot;</span>: <span class=\"string\">&quot;1******8137转9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerBackupPrivacyPhone&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;privacyPhoneShow&quot;</span>: <span class=\"string\">&quot;185**029转1199&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;privacyPhone&quot;</span>: <span class=\"string\">&quot;18**4029,1199&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;],</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;changes&quot;</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;orderSynCtime&quot;</span>: <span class=\"number\">1603013219</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;orderSynUtime&quot;</span>: <span class=\"number\">1603013219</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-1-确认送达时间：\"><a href=\"#3-1-确认送达时间：\" class=\"headerlink\" title=\"3.1 确认送达时间：\"></a>3.1 确认送达时间：</h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;estimateArrivalTime&quot;: 1603020418,</span><br></pre></td></tr></table></figure>\n\n<p>从信息中提取到送达时间的时间戳，时间戳是指，格林威治时间从1970-01-01 00:00:00到某个时间点所经历的秒数，可以表达绝对时间领域的一个时刻。其转化为我们所能够阅读的时间，是根据计算机系统时间来计算的。不同时区的计算机得到的结果是不一样的。上述时间戳，转为北京时间后是<code>2020-10-18 19:26:58</code>。在转换时，默认时根据计算机所在时区转换。所以，最好指定转换时区。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pytz</span><br><span class=\"line\">ts = <span class=\"number\">1566395745</span></span><br><span class=\"line\">tz = pytz.timezone(<span class=\"string\">&#x27; Asia/Shanghai&#x27;</span>)</span><br><span class=\"line\">dt = pytz.datetime.datetime.fromtimestamp(ts, tz)</span><br><span class=\"line\">dt.strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n\n<p>结果为：<code>2019-08-21 09:55:45</code></p>\n<h2 id=\"3-2-送达地点\"><a href=\"#3-2-送达地点\" class=\"headerlink\" title=\"3.2 送达地点\"></a>3.2 送达地点</h2><p>在信息中，是没有配送地点的内容的，如果，通过appium来点击<code>查看地址</code>在爬取地址信息，就过于麻烦。再次研究订单信息JSON数据后，我发现，在订单中，有一行数据为</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;addressLongitude&quot;: 104251302,</span><br><span class=\"line\">&quot;addressLatitude&quot;: 30880900,</span><br></pre></td></tr></table></figure>\n\n<p>这是地址编码，对应的是经纬度信息。在<a href=\"https://lbs.amap.com/api/webservice/guide/api/georegeo/\">高德地图API接口手册</a>中，我找到了适合地址解码的api</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;restapi.amap.com&#x2F;v3&#x2F;geocode&#x2F;regeo?output&#x3D;xml&amp;location&#x3D;116.310003,39.991957&amp;key&#x3D;&lt;用户的key&gt;&amp;radius&#x3D;1000&amp;extensions&#x3D;all</span><br></pre></td></tr></table></figure>\n\n<p>测试后，从api返回的地址正是收货地址。</p>\n<p>可以看到，Longitude经度，Latitude维度。这个参数是以六位小数结尾的数据。。而订单中，是没有把小数位表现出来的，所以需要单独修改。</p>\n<blockquote>\n<p>为了让饿了么和美团的订单，具有相同的格式，我们需要修改之前确定的饿了么订单对象。把送达时间统一更改为时间戳，把地址信息统一转为地理编码后的经纬度。</p>\n</blockquote>\n<h1 id=\"4：Python编程\"><a href=\"#4：Python编程\" class=\"headerlink\" title=\"4：Python编程\"></a>4：Python编程</h1><p>下面是包含了饿了么和美团外卖的完整程序</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- encoding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">@file_name    :order.py</span></span><br><span class=\"line\"><span class=\"string\">@description  :</span></span><br><span class=\"line\"><span class=\"string\">@time         :2020/10/16 21:25:01</span></span><br><span class=\"line\"><span class=\"string\">@author       :Qifei</span></span><br><span class=\"line\"><span class=\"string\">@version      :1.0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> mitmproxy.http</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#顾客类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Customer</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,tel</span>):</span></span><br><span class=\"line\">        self.name = name </span><br><span class=\"line\">        self.tel = tel</span><br><span class=\"line\">       </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#商品类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Good</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,number,img</span>):</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.number = number</span><br><span class=\"line\">        self.img = img</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#订单类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Order</span>(<span class=\"params\">Customer</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods</span>):</span></span><br><span class=\"line\">        Customer.__init__(self,name,tel)</span><br><span class=\"line\">        self.addr_long = addr_long</span><br><span class=\"line\">        self.addr_latu = addr_latu</span><br><span class=\"line\">        self.note = note</span><br><span class=\"line\">        self.arri_time = arri_time</span><br><span class=\"line\">        self.order_id = order_id</span><br><span class=\"line\">        self.goods = goods</span><br><span class=\"line\">        self.platform = platform</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#截获饿了么订单</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ElemeOrders</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.orders = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">response</span>(<span class=\"params\">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?&quot;</span> <span class=\"keyword\">in</span> flow.request.url:</span><br><span class=\"line\">            data = json.loads(flow.response.text)[<span class=\"string\">&quot;data&quot;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">for</span> total_order_list <span class=\"keyword\">in</span> data[<span class=\"string\">&#x27;total_order_list&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> order_list <span class=\"keyword\">in</span> total_order_list[<span class=\"string\">&#x27;order_list&#x27;</span>]:</span><br><span class=\"line\">                    goods = []</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> good <span class=\"keyword\">in</span> order_list[<span class=\"string\">&#x27;order_goods&#x27;</span>][<span class=\"string\">&#x27;goods_list&#x27;</span>]:</span><br><span class=\"line\">                        good_buffer = Good(good[<span class=\"string\">&#x27;name&#x27;</span>],good[<span class=\"string\">&#x27;number&#x27;</span>],good[<span class=\"string\">&#x27;url&#x27;</span>])</span><br><span class=\"line\">                        goods.append(good_buffer)</span><br><span class=\"line\">                    order = Order(<span class=\"string\">&#x27;eleme&#x27;</span>,order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_real_name&#x27;</span>]+order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;sex&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_phone&#x27;</span>],str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lng&#x27;</span>]),str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lat&#x27;</span>]),order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_note&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;takeout_average_time&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;order_id&#x27;</span>],goods)</span><br><span class=\"line\">                    self.orders.append(order)</span><br><span class=\"line\">            print(self.orders)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">#截获美团订单</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MeituanOrders</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.orders = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">response</span>(<span class=\"params\">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?&quot;</span> <span class=\"keyword\">in</span> flow.request.url:</span><br><span class=\"line\">            data = json.loads(flow.response.text)[<span class=\"string\">&quot;data&quot;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">for</span> order_list <span class=\"keyword\">in</span> data[<span class=\"string\">&#x27;news&#x27;</span>]:</span><br><span class=\"line\">                goods = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span> good <span class=\"keyword\">in</span> order_list[<span class=\"string\">&#x27;details&#x27;</span>]:</span><br><span class=\"line\">                    good_buffer = Good(good[<span class=\"string\">&#x27;food_name&#x27;</span>],good[<span class=\"string\">&#x27;count&#x27;</span>],good[<span class=\"string\">&#x27;picUrl&#x27;</span>])</span><br><span class=\"line\">                    goods.append(good_buffer)</span><br><span class=\"line\">                order = Order(<span class=\"string\">&#x27;meituan&#x27;</span>,order_list[<span class=\"string\">&#x27;recipient_name&#x27;</span>],order_list[<span class=\"string\">&#x27;recipient_phone&#x27;</span>],self.geo_format(order_list[<span class=\"string\">&#x27;longitude&#x27;</span>]),self.geo_format(order_list[<span class=\"string\">&#x27;latitude&#x27;</span>]),order_list[<span class=\"string\">&#x27;remark&#x27;</span>],order_list[<span class=\"string\">&#x27;estimateArrivalTime&#x27;</span>],order_list[<span class=\"string\">&#x27;id&#x27;</span>],goods)</span><br><span class=\"line\">                self.orders.append(order)</span><br><span class=\"line\">            print(self.orders[<span class=\"number\">0</span>].name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#将经纬度162787612转为162.787612</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">geo_format</span>(<span class=\"params\">self,int_geo</span>):</span></span><br><span class=\"line\">        str_geo = str(int_geo)  <span class=\"comment\">#162787612</span></span><br><span class=\"line\">        list_geo = list(str_geo)    <span class=\"comment\">#[&#x27;1&#x27;,&#x27;6&#x27;,&#x27;2&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;7&#x27;,&#x27;6&#x27;,&#x27;1&#x27;,&#x27;2&#x27;]</span></span><br><span class=\"line\">        list_geo.insert(<span class=\"number\">-6</span>,<span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">        new_str = <span class=\"string\">&#x27;&#x27;</span>.join(list_geo)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> new_str</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#mitmproxy插件</span></span><br><span class=\"line\">addons = [</span><br><span class=\"line\">    ElemeOrders(),</span><br><span class=\"line\">    MeituanOrders()</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://blog.csdn.net/djzhao627/article/details/102812783\">给Android7及以上的手机安装系统级证书，实现Fiddler或者其他程序的HTTPS的抓包</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/Crazy_zh/article/details/100013256\">python将时间戳转换为指定时区时间</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：root手机\"><a href=\"#1：root手机\" class=\"headerlink\" title=\"1：root手机\"></a>1：root手机</h1><p>昨天，我利用mitmproxy成功拦截了饿了么服务器返回的订单信息。今天，我准备故技重施，获取美团订单。残酷的现实给我炽热地心浇了一盆冷水。无论我如何调整mitmproxy和美团外卖商家版，都无法获取到美团服务器返回的数据。更确切地说，美团服务器似乎发现，有这么一个小偷，准备偷取它返回给客户端地数据。因此拒绝给客户端传递数据。</p>\n<p>我在网上找了一些解答，在安卓7.0之后，安卓系统允许安卓应用不信任用户上传地CA证书，众所周知，在中间人攻击中，将代理服务器的CA证书添加到安卓用户证书里，这样代理服务器在客户端和https服务端之间做个信使，他们的来回信件，信使就能拆开阅读，再封好发出去。现在安卓系统允许安卓应用设置是否信任用户证书，很明显，美团外卖商家版，不支持用户自定义证书。</p>\n<p>好在，安卓系统有个要求，就是系统证书都是被认可的。而添加系统证书，需要修改手机system文件夹，需要将手机root。</p>\n<p>待root手机：三星S8+</p>\n<p>工具：Odin线刷工具，第三方recovery TWRP，Tomato卡刷包（卡刷包含root）。</p>\n<h1 id=\"2：添加CA证书为系统证书\"><a href=\"#2：添加CA证书为系统证书\" class=\"headerlink\" title=\"2：添加CA证书为系统证书\"></a>2：添加CA证书为系统证书</h1><p>mitmproxy会在其运行目录生成一个<code>.mitmproxy</code>隐藏目录，目录中的<code>mitmproxy-ca-cert.pem</code>是可以直接放到系统证书目录下的证书。首先需要将它更名为统一的格式。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">openssl版本在1.0以上的版本的执行这一句</span></span><br><span class=\"line\">openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem\t</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">openssl版本在1.0以下的版本的执行这一句</span></span><br><span class=\"line\">openssl x509 -inform PEM -subject_hash -in mitmproxy-ca-cert.pem</span><br></pre></td></tr></table></figure>\n\n<p>生成<code>347bacb5</code>证书的hash值，然后将<code>mitmproxy-ca-cert.pem</code>更名为<code>347bacb5.0</code></p>\n<p>将更名后的证书放到安卓系统证书目录，root后的安卓手机，可以直接打开RE管理器进入系统目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts</span><br></pre></td></tr></table></figure>\n\n<p>重启手机。修改wifi代理，并连接mitmproxy。</p>\n<p>打开美团外卖商家版，不再报没有网络连接的错误。此时即可以从代理中截获解码后的信息了。</p>\n<h1 id=\"3：截获订单请求数据\"><a href=\"#3：截获订单请求数据\" class=\"headerlink\" title=\"3：截获订单请求数据\"></a>3：截获订单请求数据</h1><p>开启mitmproxy，开始收集请求。在美团上下单，可以截获下单后，美团服务器发送到客户端的订单信息。</p>\n<p>进行中订单请求地址，部分内容已打码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;eapi.waimai.meituan.com&#x2F;api&#x2F;retail&#x2F;order&#x2F;supplement&#x2F;increment&#x2F;orders?region_id&#x3D;10***0100&amp;region_version&#x3D;153***1&amp;__skck&#x3D;8f5973b0***&amp;__skts&#x3D;16***8&amp;__skua&#x3D;d41d8c***8427e&amp;__skno&#x3D;94899011-***</span><br></pre></td></tr></table></figure>\n\n<p>预订单请求地址：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;eapi.waimai.meituan.com&#x2F;api&#x2F;retail&#x2F;order&#x2F;pre&#x2F;orders?region_id&#x3D;1000510100&amp;region_version&#x3D;1534166411&amp;__skck&#x3D;8f5973b085446090f224af74e30e0181&amp;__skts&#x3D;1603035614&amp;__skua&#x3D;d41d8cd98f00b204e9800998ecf8427e&amp;__skno&#x3D;ed5fa567-5e33-4186-806a-e1ee884b5d5c&amp;__skcy&#x3D;hNEhcBUBRBinXjXwhZ%2BoMtvkMu8%3D</span><br></pre></td></tr></table></figure>\n\n<p>进行中响应内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">&quot;msg&quot;</span>: <span class=\"string\">&quot;Success&quot;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;data&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;serverTime&quot;</span>: <span class=\"number\">1603013219</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;news&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;agreeBtn&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;reject_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;rejectBtn&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;apply_refund_type&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;appealReason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_status&quot;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;payExpireTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;orderDescription&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_status_desc&quot;</span>: <span class=\"string\">&quot;已付款&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;apply_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;applyRefundTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;rejectRefundTime&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;appealRefundTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundFinishTime&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isPartRefundApply&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAllowPartRefund&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAllowAllRefund&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;hasMigratedToRetail&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;returnSubStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logistics&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"number\">101</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;statusDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;sendTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;confirmTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;arrivePoiTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;selfDeliveryTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;fetchTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;completedTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cancelTime&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;collectTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;departureTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;reachTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;takeTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;timeOut&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;valid&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingFee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;tipFee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingTips&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;couponAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityName&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;extraFee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;payAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingFeeBase&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;payType&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;zbType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;orderDistance&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;ifSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isCanChangeSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatcher&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;role&quot;</span>: <span class=\"string\">&quot;配送员&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;typeName&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatchMaster&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;站点&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;role&quot;</span>: <span class=\"string\">&quot;站长&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatchAssistant&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;站点备用&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;icon&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;role&quot;</span>: <span class=\"string\">&quot;站长助理&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;unionDispatcher&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;mobile&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsSubCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;dispatchOrderId&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;delayPushSecond&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;delayPushMin&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;assignTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;thirdLogisticsCode&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;printRelayBarCode&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;utime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundType&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isCanChangeSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundProcessEndTips&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;ifSelfLogistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cancelButtonShow&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;foodDoneInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isShowFoodDoneBlock&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isfoodDone&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodDoneStatus&quot;</span>: <span class=\"string\">&quot;拣货完成&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodDoneTime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodSendOutTimeDeadline&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;diningMinutes&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodSendDeviceInfo&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logisticsAbnormalInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isLogisticsAbnormal&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsAbnormalDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsAbnormalType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isShowLogisticsReport&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsReportDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundOtherInfos&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnStatusDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnSubStatusDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnMaxPayAcount&quot;</span>: <span class=\"number\">100.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;returnSubStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;countDownDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;refundViewId&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;serviceType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;refundRuleUrl&quot;</span>: <span class=\"string\">&quot;http://s3plus.sankuai.com/v1/mss_03d0d9cf21144ba0b7747ba1dc1acf6e/order/refund_rules.html&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundInfoList&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;refundGoodsInfoList&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAppealApply&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;compensationInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;moneyDesc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;pictures&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;appealInfo&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;orderImValid&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;imGuideContent&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;imReplyDefaultContent&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isAllowPriceDiffRefund&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;confirmDeliveryStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">56367</span>**<span class=\"number\">02186</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_poi_id&quot;</span>: <span class=\"number\">5636780</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_poi_order_dayseq&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_order_id_view&quot;</span>: <span class=\"number\">563678</span>***<span class=\"number\">186</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;num&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;poi_name&quot;</span>: <span class=\"string\">&quot;**鲜花店&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_source&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_source_desc&quot;</span>: <span class=\"string\">&quot;手机APP下单&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;shipping_fee&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipient_name&quot;</span>: <span class=\"string\">&quot;谢先生&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipient_phone&quot;</span>: <span class=\"string\">&quot;178**858,4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipient_address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;total_after&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;total_before&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;boxpriceTotal&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;remark&quot;</span>: <span class=\"string\">&quot;[贺卡内容]贺卡内容 [其他备注]备注内容&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;environmentalFriendlyOrder&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_time&quot;</span>: <span class=\"number\">1603013207</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_time_fmt&quot;</span>: <span class=\"string\">&quot;10-18 17:26&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;confirmOrderTime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;details&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;id&quot;</span>: <span class=\"number\">1945297344</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;food_name&quot;</span>: <span class=\"string\">&quot;8枝红色非洲菊 &quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;food_price&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;originalFoodPrice&quot;</span>: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;unit&quot;</span>: <span class=\"string\">&quot;份&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;count&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;box_num&quot;</span>: <span class=\"number\">1.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;box_price&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cartId&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cartName&quot;</span>: <span class=\"string\">&quot;1号口袋&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;upcCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;skuCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;locatorCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;discountPoint&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;discountRemark&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;picUrl&quot;</span>: <span class=\"string\">&quot;http://p0.meituan.net/wmproduct/d852b****0fa2d7f3d1adf7d95423.jpg&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;specification&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;discounts&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;tips&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;canBeCancelled&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cancel_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;is_pre_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;delivery_btime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pre_order_delivery_info&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_utime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pay_utime_fmt&quot;</span>: <span class=\"string\">&quot;2020-10-18 17:26:58&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;online_paid_info&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pre_order_remind&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pre_order_tip&quot;</span>: <span class=\"string\">&quot;预订单：期望送达时间&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;overtime_paid_info&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;invoice_title&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wm_order_pay_type&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;actual_pay_type&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;dispatch_code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;longitude&quot;</span>: <span class=\"number\">104251302</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;latitude&quot;</span>: <span class=\"number\">30880900</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;inArea&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;orderDistance&quot;</span>: <span class=\"number\">2120.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;addressLongitude&quot;</span>: <span class=\"number\">104251302</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;addressLatitude&quot;</span>: <span class=\"number\">30880900</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;riderPayment&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;zbShippingFee&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;zbShippingTips&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;tipsVos&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;status_desc&quot;</span>: <span class=\"string\">&quot;已接单&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;delivery_btime_fmt&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logistics_code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logisticsService&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;logistics_status&quot;</span>: <span class=\"number\">-1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;hasFrozen&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;estimateArrivalTime&quot;</span>: <span class=\"number\">1603020418</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;poi_push_day&quot;</span>: <span class=\"number\">20201018</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;bindedPhone&quot;</span>: <span class=\"string\">&quot;178**858,4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isLargeAmountOrder&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;userOrderCount&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;pickType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;isUsePrivacyPhone&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;privacyPhone&quot;</span>: <span class=\"string\">&quot;1788**4858,4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;phoneShow&quot;</span>: <span class=\"string\">&quot;178**8转4109&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;privacyPhoneStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;recipientPhoneShow&quot;</span>: <span class=\"string\">&quot;手机尾号2605&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;packageBagMoney&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wmUserId&quot;</span>: <span class=\"number\">371311890</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;confirmTime&quot;</span>: <span class=\"number\">1603013218</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cansunStatus&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;cansunInfo&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wmChargeBusiness&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;wmOrderViewId&quot;</span>: <span class=\"number\">56367802727202186</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityAmount&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;activityDetails&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;commisionAmount&quot;</span>: <span class=\"string\">&quot;-1.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;settleAmount&quot;</span>: <span class=\"string\">&quot;8.95&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;offlineOrderSkPayAmount&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingType&quot;</span>: <span class=\"string\">&quot;0000&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;commisionDetails&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;chargeAmount&quot;</span>: <span class=\"string\">&quot;-1.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;chargeDesc&quot;</span>: <span class=\"string\">&quot;服务费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;userOnlinePayAfter&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;discounts&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isDowngrade&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shippingFee&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;riderPayment&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;isRiderPay&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;giftDetails&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;userPayAmount&quot;</span>: <span class=\"string\">&quot;0.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;foodAmount&quot;</span>: <span class=\"string\">&quot;10.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;userPayTotalAmount&quot;</span>: <span class=\"string\">&quot;10.0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;donateAmount&quot;</span>: <span class=\"string\">&quot;-0.05&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;agreementAmount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;chargeMode&quot;</span>: <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;userTips&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;category&quot;</span>: <span class=\"number\">17</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;下单2次&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;info&quot;</span>: <span class=\"string\">&quot;该用户过去90天完成订单数&quot;</span></span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;bindedPrivacyPhoneList&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;privacyPhoneShow&quot;</span>: <span class=\"string\">&quot;130**773转5108&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;privacyPhone&quot;</span>: <span class=\"string\">&quot;13**4773,5108&quot;</span></span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;backupField&quot;</span>: [],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;onTimeInsurance&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;effect&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;foodSafeInsurance&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;effect&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;thirdLogistics&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;courierName&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;courierPhone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsPlatformName&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;logisticsPlatformCode&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;deliverTime&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;allowAlterType&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;preMakerValid&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;retailOrderPreMakerInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPrivacyPhoneShow&quot;</span>: <span class=\"string\">&quot;1788**37转9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPhoneShow&quot;</span>: <span class=\"string\">&quot;178**7转9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPhone&quot;</span>: <span class=\"string\">&quot;178**137,9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerTag&quot;</span>: <span class=\"string\">&quot;购花使者&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerPrivacyPhoneShowAfter&quot;</span>: <span class=\"string\">&quot;1******8137转9232&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;preMakerBackupPrivacyPhone&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;privacyPhoneShow&quot;</span>: <span class=\"string\">&quot;185**029转1199&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;privacyPhone&quot;</span>: <span class=\"string\">&quot;18**4029,1199&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;],</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;changes&quot;</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;orderSynCtime&quot;</span>: <span class=\"number\">1603013219</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;orderSynUtime&quot;</span>: <span class=\"number\">1603013219</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-1-确认送达时间：\"><a href=\"#3-1-确认送达时间：\" class=\"headerlink\" title=\"3.1 确认送达时间：\"></a>3.1 确认送达时间：</h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;estimateArrivalTime&quot;: 1603020418,</span><br></pre></td></tr></table></figure>\n\n<p>从信息中提取到送达时间的时间戳，时间戳是指，格林威治时间从1970-01-01 00:00:00到某个时间点所经历的秒数，可以表达绝对时间领域的一个时刻。其转化为我们所能够阅读的时间，是根据计算机系统时间来计算的。不同时区的计算机得到的结果是不一样的。上述时间戳，转为北京时间后是<code>2020-10-18 19:26:58</code>。在转换时，默认时根据计算机所在时区转换。所以，最好指定转换时区。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pytz</span><br><span class=\"line\">ts = <span class=\"number\">1566395745</span></span><br><span class=\"line\">tz = pytz.timezone(<span class=\"string\">&#x27; Asia/Shanghai&#x27;</span>)</span><br><span class=\"line\">dt = pytz.datetime.datetime.fromtimestamp(ts, tz)</span><br><span class=\"line\">dt.strftime(<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n\n<p>结果为：<code>2019-08-21 09:55:45</code></p>\n<h2 id=\"3-2-送达地点\"><a href=\"#3-2-送达地点\" class=\"headerlink\" title=\"3.2 送达地点\"></a>3.2 送达地点</h2><p>在信息中，是没有配送地点的内容的，如果，通过appium来点击<code>查看地址</code>在爬取地址信息，就过于麻烦。再次研究订单信息JSON数据后，我发现，在订单中，有一行数据为</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;addressLongitude&quot;: 104251302,</span><br><span class=\"line\">&quot;addressLatitude&quot;: 30880900,</span><br></pre></td></tr></table></figure>\n\n<p>这是地址编码，对应的是经纬度信息。在<a href=\"https://lbs.amap.com/api/webservice/guide/api/georegeo/\">高德地图API接口手册</a>中，我找到了适合地址解码的api</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;restapi.amap.com&#x2F;v3&#x2F;geocode&#x2F;regeo?output&#x3D;xml&amp;location&#x3D;116.310003,39.991957&amp;key&#x3D;&lt;用户的key&gt;&amp;radius&#x3D;1000&amp;extensions&#x3D;all</span><br></pre></td></tr></table></figure>\n\n<p>测试后，从api返回的地址正是收货地址。</p>\n<p>可以看到，Longitude经度，Latitude维度。这个参数是以六位小数结尾的数据。。而订单中，是没有把小数位表现出来的，所以需要单独修改。</p>\n<blockquote>\n<p>为了让饿了么和美团的订单，具有相同的格式，我们需要修改之前确定的饿了么订单对象。把送达时间统一更改为时间戳，把地址信息统一转为地理编码后的经纬度。</p>\n</blockquote>\n<h1 id=\"4：Python编程\"><a href=\"#4：Python编程\" class=\"headerlink\" title=\"4：Python编程\"></a>4：Python编程</h1><p>下面是包含了饿了么和美团外卖的完整程序</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- encoding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">@file_name    :order.py</span></span><br><span class=\"line\"><span class=\"string\">@description  :</span></span><br><span class=\"line\"><span class=\"string\">@time         :2020/10/16 21:25:01</span></span><br><span class=\"line\"><span class=\"string\">@author       :Qifei</span></span><br><span class=\"line\"><span class=\"string\">@version      :1.0</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> mitmproxy.http</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#顾客类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Customer</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,tel</span>):</span></span><br><span class=\"line\">        self.name = name </span><br><span class=\"line\">        self.tel = tel</span><br><span class=\"line\">       </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#商品类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Good</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,number,img</span>):</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.number = number</span><br><span class=\"line\">        self.img = img</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#订单类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Order</span>(<span class=\"params\">Customer</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods</span>):</span></span><br><span class=\"line\">        Customer.__init__(self,name,tel)</span><br><span class=\"line\">        self.addr_long = addr_long</span><br><span class=\"line\">        self.addr_latu = addr_latu</span><br><span class=\"line\">        self.note = note</span><br><span class=\"line\">        self.arri_time = arri_time</span><br><span class=\"line\">        self.order_id = order_id</span><br><span class=\"line\">        self.goods = goods</span><br><span class=\"line\">        self.platform = platform</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#截获饿了么订单</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ElemeOrders</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.orders = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">response</span>(<span class=\"params\">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?&quot;</span> <span class=\"keyword\">in</span> flow.request.url:</span><br><span class=\"line\">            data = json.loads(flow.response.text)[<span class=\"string\">&quot;data&quot;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">for</span> total_order_list <span class=\"keyword\">in</span> data[<span class=\"string\">&#x27;total_order_list&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> order_list <span class=\"keyword\">in</span> total_order_list[<span class=\"string\">&#x27;order_list&#x27;</span>]:</span><br><span class=\"line\">                    goods = []</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> good <span class=\"keyword\">in</span> order_list[<span class=\"string\">&#x27;order_goods&#x27;</span>][<span class=\"string\">&#x27;goods_list&#x27;</span>]:</span><br><span class=\"line\">                        good_buffer = Good(good[<span class=\"string\">&#x27;name&#x27;</span>],good[<span class=\"string\">&#x27;number&#x27;</span>],good[<span class=\"string\">&#x27;url&#x27;</span>])</span><br><span class=\"line\">                        goods.append(good_buffer)</span><br><span class=\"line\">                    order = Order(<span class=\"string\">&#x27;eleme&#x27;</span>,order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_real_name&#x27;</span>]+order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;sex&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_phone&#x27;</span>],str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lng&#x27;</span>]),str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lat&#x27;</span>]),order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_note&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;takeout_average_time&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;order_id&#x27;</span>],goods)</span><br><span class=\"line\">                    self.orders.append(order)</span><br><span class=\"line\">            print(self.orders)</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">#截获美团订单</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MeituanOrders</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.orders = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">response</span>(<span class=\"params\">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?&quot;</span> <span class=\"keyword\">in</span> flow.request.url:</span><br><span class=\"line\">            data = json.loads(flow.response.text)[<span class=\"string\">&quot;data&quot;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">for</span> order_list <span class=\"keyword\">in</span> data[<span class=\"string\">&#x27;news&#x27;</span>]:</span><br><span class=\"line\">                goods = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span> good <span class=\"keyword\">in</span> order_list[<span class=\"string\">&#x27;details&#x27;</span>]:</span><br><span class=\"line\">                    good_buffer = Good(good[<span class=\"string\">&#x27;food_name&#x27;</span>],good[<span class=\"string\">&#x27;count&#x27;</span>],good[<span class=\"string\">&#x27;picUrl&#x27;</span>])</span><br><span class=\"line\">                    goods.append(good_buffer)</span><br><span class=\"line\">                order = Order(<span class=\"string\">&#x27;meituan&#x27;</span>,order_list[<span class=\"string\">&#x27;recipient_name&#x27;</span>],order_list[<span class=\"string\">&#x27;recipient_phone&#x27;</span>],self.geo_format(order_list[<span class=\"string\">&#x27;longitude&#x27;</span>]),self.geo_format(order_list[<span class=\"string\">&#x27;latitude&#x27;</span>]),order_list[<span class=\"string\">&#x27;remark&#x27;</span>],order_list[<span class=\"string\">&#x27;estimateArrivalTime&#x27;</span>],order_list[<span class=\"string\">&#x27;id&#x27;</span>],goods)</span><br><span class=\"line\">                self.orders.append(order)</span><br><span class=\"line\">            print(self.orders[<span class=\"number\">0</span>].name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#将经纬度162787612转为162.787612</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">geo_format</span>(<span class=\"params\">self,int_geo</span>):</span></span><br><span class=\"line\">        str_geo = str(int_geo)  <span class=\"comment\">#162787612</span></span><br><span class=\"line\">        list_geo = list(str_geo)    <span class=\"comment\">#[&#x27;1&#x27;,&#x27;6&#x27;,&#x27;2&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;7&#x27;,&#x27;6&#x27;,&#x27;1&#x27;,&#x27;2&#x27;]</span></span><br><span class=\"line\">        list_geo.insert(<span class=\"number\">-6</span>,<span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">        new_str = <span class=\"string\">&#x27;&#x27;</span>.join(list_geo)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> new_str</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#mitmproxy插件</span></span><br><span class=\"line\">addons = [</span><br><span class=\"line\">    ElemeOrders(),</span><br><span class=\"line\">    MeituanOrders()</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://blog.csdn.net/djzhao627/article/details/102812783\">给Android7及以上的手机安装系统级证书，实现Fiddler或者其他程序的HTTPS的抓包</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/Crazy_zh/article/details/100013256\">python将时间戳转换为指定时区时间</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Oct 18 2020 17:43:44 GMT+0200 (GMT+02:00)","title":"外卖平台订单爬取之美团外卖商家版","path":"2020/10/17/外卖平台订单爬取之美团外卖商家版/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-10-17T16:49:09.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-10-17T16:49:09.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"爬虫","tags":["-TWRP"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"外卖平台订单爬取之饿了么零售商家版","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-10-16T21:46:27.000Z","password":null,"summary":null,"_content":"\n# 1：简单说两句\n\n这是我一个准备做的完整项目中的一个小部分。从很早以前，我就在思考，如何将美团和饿了么以及我自己做的小程序订单合并在一起，这样来实现统一的管理。。之所以要统一管理，是因为我母亲从事鲜花零售，在节假日里，会有大量的订单，而鲜花的包扎是个时间活。制作和配送，以及订单的处理，繁杂的程序会让人晕头转向。为了减轻我母亲的节假日压力，我想到了一些方法，来帮助她管理订单。\n\n完整的项目是，汇总小程序、美团、饿了么的订单。将订单返回的信息，通过处理，按配送时间排序，经过处理后通过企业微信api推送给微信。因为，花店的配送人员都是我母亲找的，他们受教育程度低，有的因为不识字，连导航都不会用。所以，需要把订单的位置信息，通过百度地图api转为url发送给配送员。另外，还可以制作一个程序，在程序上实时更新，新订单。。每当一束花被做好，我母亲就可从程序中将该订单从等待制作的列表中移除。。每当，有一个订单被送出，也可在程序上控制美团等客户端发送对应消息。\n\n这一切都是非常美好的，对零售商家的体验会非常友好。但是，因为我无法取得美团和饿了么的开发者资格，也就拿不到他们的接口授权。。于是，我想到了，利用利用mitmproxy获取美团饿了么的订单信息。通过appium自动化控制手机。无论是mitmrpoxy还是appium对python程序都是非常友好的。\n\n那么现在开始我的第一步，利用mitmproxy爬取饿了么零售商家版订单信息。\n\n# 2：mitmproxy安装与使用\n\n**安装**\n\n```python\npip install mitmproxy\n```\n\n**开启**\n\n```shell\nmitmweb\n#或者mitmproxy mitmdump\n```\n\n**与python配合**\n\n```python\nmitmdump -s eleme.py\n```\n\n**手机使用mitmproxy开启的代理**：\n\n更改wifi高级设置里的代理模式为手动，主机填写mitmproxy运行的电脑局域网ip。可通过ifconfig查看。\n\n端口为8080\n\n此时打开baidu.com会提示不安全，而且mitmproxy应该开始记录了。\n\n手机打开网页`mitm.it`下载对应系统的证书文件。安卓下载后直接安装。。\n\n再上网就不会提示不安全了。\n\n# 3：响应内容\n\n在开启mitmweb后，从打开的网页上可以观察到手机的整个数据流，在手机上刷新订单页，就能截获饿了么发送回来的订单信息。\n\n将响应内容提取出来，并把JSON数据格式化，部分关键信息已打码。\n\n```json\n{\n\t\"data\": {\n\t\t\"curr_page\": 1,\n\t\t\"order_count\": 1,\n\t\t\"page_count\": 1,\n\t\t\"page_size\": 20,\n\t\t\"total_order_list\": [{\n\t\t\t\"mills\": 1602518400000,\n\t\t\t\"order_list\": [{\n\t\t\t\t\"cold_chain_cost\": {\n\t\t\t\t\t\"price\": \"0.00\",\n\t\t\t\t\t\"title\": \"冷链服务费\"\n\t\t\t\t},\n\t\t\t\t\"compensationInfo\": {\n\t\t\t\t\t\"enableCompensable\": false,\n\t\t\t\t\t\"timeRemaining\": 0\n\t\t\t\t},\n\t\t\t\t\"extract_commission\": {\n\t\t\t\t\t\"brief_desc\": \"请以结算账单为准\",\n\t\t\t\t\t\"commission_total\": \"15.00\",\n\t\t\t\t\t\"title\": \"抽取佣金\"\n\t\t\t\t},\n\t\t\t\t\"goods_discount\": {\n\t\t\t\t\t\"discount_account\": \"-￥3.00\",\n\t\t\t\t\t\"discount_list\": [{\n\t\t\t\t\t\t\"desc\": \"\",\n\t\t\t\t\t\t\"hasLineBelow\": 1,\n\t\t\t\t\t\t\"list\": [{\n\t\t\t\t\t\t\t\"price\": \"￥3.00\",\n\t\t\t\t\t\t\t\"title\": \"商家配送费补贴\"\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"price\": \"￥3.00\",\n\t\t\t\t\t\t\t\"title\": \"小计\"\n\t\t\t\t\t\t}],\n\t\t\t\t\t\t\"title\": \"商户补贴金额\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"desc\": \"\",\n\t\t\t\t\t\t\"hasLineBelow\": null,\n\t\t\t\t\t\t\"list\": [{\n\t\t\t\t\t\t\t\"title\": \"配送费满减\"\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"title\": \"(商家补贴:￥3.00元)\"\n\t\t\t\t\t\t}],\n\t\t\t\t\t\t\"title\": \"活动明细\"\n\t\t\t\t\t}],\n\t\t\t\t\t\"title\": \"顾客优惠合计\",\n\t\t\t\t\t\"user_discount_account\": \"-￥3.00\"\n\t\t\t\t},\n\t\t\t\t\"grayInfo\": {\n\t\t\t\t\t\"hummingBirdGray\": 0\n\t\t\t\t},\n\t\t\t\t\"orderSettle\": {\n\t\t\t\t\t\"baseLogisticsAmt\": \"0.00\",\n\t\t\t\t\t\"baseLogisticsDesc\": \"本单收取固定物流费\",\n\t\t\t\t\t\"commissionAmt\": \"15.00\",\n\t\t\t\t\t\"commissionDesc\": \"请以结算账单为准\",\n\t\t\t\t\t\"shopInAmount\": \"0.00\"\n\t\t\t\t},\n\t\t\t\t\"order_basic\": {\n\t\t\t\t\t\"apply_cancel_feed\": {\n\t\t\t\t\t\t\"feed_list\": [{\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 12:55\",\n\t\t\t\t\t\t\t\"cancel_title\": \"订单已完成(商户)\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 09:10\",\n\t\t\t\t\t\t\t\"cancel_title\": \"商家已接单\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 09:10\",\n\t\t\t\t\t\t\t\"cancel_title\": \"订单已支付\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 09:09\",\n\t\t\t\t\t\t\t\"cancel_title\": \"创建订单\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t\"apply_cancel_status\": 886,\n\t\t\t\t\t\"auto_confirm_order\": 0,\n\t\t\t\t\t\"batch\": 2000000000000000001,\n\t\t\t\t\t\"business_type\": 0,\n\t\t\t\t\t\"call_delivery_delay\": \"\",\n\t\t\t\t\t\"cancel_reason\": \"\",\n\t\t\t\t\t\"cancel_reason_explain\": \"\",\n\t\t\t\t\t\"cancel_reason_status\": \"0\",\n\t\t\t\t\t\"check_out_button\": 0,\n\t\t\t\t\t\"city_name\": \"成都市\",\n\t\t\t\t\t\"confirmButton\": 1,\n\t\t\t\t\t\"confirm_time\": \"1602551413\",\n\t\t\t\t\t\"create_time\": \"1602551397\",\n\t\t\t\t\t\"delivery_delay_time\": \"\",\n\t\t\t\t\t\"delivery_exception_code\": 0,\n\t\t\t\t\t\"delivery_exception_state\": \"\",\n\t\t\t\t\t\"delivery_name\": \"\",\n\t\t\t\t\t\"delivery_party\": \"self\",\n\t\t\t\t\t\"delivery_staff_phone\": \"\",\n\t\t\t\t\t\"delivery_state\": \"0\",\n\t\t\t\t\t\"delivery_state_desc\": \"\",\n\t\t\t\t\t\"delivery_tip_amount\": 0.0,\n\t\t\t\t\t\"distance\": \"<1.8千米\",\n\t\t\t\t\t\"due_deliver_time_by_ofc\": \"\",\n\t\t\t\t\t\"ele_fengniao_info\": {\n\t\t\t\t\t\t\"is_fengniao_call_again\": 0,\n\t\t\t\t\t\t\"is_fengniao_switch_self\": 0,\n\t\t\t\t\t\t\"no_delivery\": 0\n\t\t\t\t\t},\n\t\t\t\t\t\"ele_zhongbao_info\": {\n\t\t\t\t\t\t\"delivery_fee\": 0,\n\t\t\t\t\t\t\"is_show\": false,\n\t\t\t\t\t\t\"op_status\": 0\n\t\t\t\t\t},\n\t\t\t\t\t\"eleme_finish_refund\": 0,\n\t\t\t\t\t\"eleme_order_id\": \"5009809679236497411\",\n\t\t\t\t\t\"evoip_order\": 2,\n\t\t\t\t\t\"express_company\": \"\",\n\t\t\t\t\t\"express_id\": \"0\",\n\t\t\t\t\t\"feed_to_show\": \"order_log\",\n\t\t\t\t\t\"finished_time\": \"1602564946\",\n\t\t\t\t\t\"gift_greeting\": \"\",\n\t\t\t\t\t\"gift_phone\": \"13***502\",\n\t\t\t\t\t\"hbirdRunErrandsInfo\": {\n\t\t\t\t\t\t\"addTipsButton\": 0,\n\t\t\t\t\t\t\"callButton\": 0,\n\t\t\t\t\t\t\"cancelCallButton\": 0,\n\t\t\t\t\t\t\"payType\": null\n\t\t\t\t\t},\n\t\t\t\t\t\"idempotentId\": \"20201017025815254005000100027411822742\",\n\t\t\t\t\t\"invoice_price\": \"100.00\",\n\t\t\t\t\t\"invoice_title\": \"\",\n\t\t\t\t\t\"is_alipay_order\": 0,\n\t\t\t\t\t\"is_baidu_logistics\": 0,\n\t\t\t\t\t\"is_can_auto_confirm\": 0,\n\t\t\t\t\t\"is_city_delivery\": 0,\n\t\t\t\t\t\"is_cold_order\": 0,\n\t\t\t\t\t\"is_compensation_show\": 0,\n\t\t\t\t\t\"is_cook_overtime\": 0,\n\t\t\t\t\t\"is_from_tp_new_retail\": true,\n\t\t\t\t\t\"is_print\": 1,\n\t\t\t\t\t\"is_privacy_hide\": 1,\n\t\t\t\t\t\"is_ranger_show\": 1,\n\t\t\t\t\t\"is_show_express\": 0,\n\t\t\t\t\t\"ivr_tip\": \"\",\n\t\t\t\t\t\"meal_num\": \"\",\n\t\t\t\t\t\"need_invoice\": 0,\n\t\t\t\t\t\"orderUserPhone\": \"136****3502\",\n\t\t\t\t\t\"orderUserPrivacyPhone\": \"\",\n\t\t\t\t\t\"order_from\": \"2\",\n\t\t\t\t\t\"order_id\": \"50098***97411\",\n\t\t\t\t\t\"order_index\": \"1\",\n\t\t\t\t\t\"order_list_type\": {\n\t\t\t\t\t\t\"is_cancel\": 0,\n\t\t\t\t\t\t\"is_exception\": 0,\n\t\t\t\t\t\t\"is_new\": 0,\n\t\t\t\t\t\t\"is_remind\": 0,\n\t\t\t\t\t\t\"is_reserve\": 1,\n\t\t\t\t\t\t\"is_user_part_refund\": 0\n\t\t\t\t\t},\n\t\t\t\t\t\"order_time_line\": [{\n\t\t\t\t\t\t\"code\": \"101004\",\n\t\t\t\t\t\t\"time\": \"10/13 12:55\",\n\t\t\t\t\t\t\"title\": \"订单已完成(商户)\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"code\": \"100004\",\n\t\t\t\t\t\t\"time\": \"10/13 09:10\",\n\t\t\t\t\t\t\"title\": \"商家已接单\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"code\": \"100001\",\n\t\t\t\t\t\t\"time\": \"10/13 09:10\",\n\t\t\t\t\t\t\"title\": \"订单已支付\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"code\": \"100000\",\n\t\t\t\t\t\t\"time\": \"10/13 09:09\",\n\t\t\t\t\t\t\"title\": \"创建订单\"\n\t\t\t\t\t}],\n\t\t\t\t\t\"order_type\": 4,\n\t\t\t\t\t\"part_refund_support\": 0,\n\t\t\t\t\t\"pay_display\": 1,\n\t\t\t\t\t\"pay_status\": \"已支付\",\n\t\t\t\t\t\"pc_order_label\": [],\n\t\t\t\t\t\"pick_info\": {\n\t\t\t\t\t\t\"expect_finish_time\": \"02:58:15\",\n\t\t\t\t\t\t\"left_time\": \"0\",\n\t\t\t\t\t\t\"pick_button\": \"0\",\n\t\t\t\t\t\t\"show\": \"0\",\n\t\t\t\t\t\t\"timestamp\": \"\"\n\t\t\t\t\t},\n\t\t\t\t\t\"privacy_phone\": \"\",\n\t\t\t\t\t\"range_status\": 0,\n\t\t\t\t\t\"real_status\": 5,\n\t\t\t\t\t\"real_status_desc\": \"商家已经确认订单\",\n\t\t\t\t\t\"refund_attribute\": 0,\n\t\t\t\t\t\"refund_logs\": [],\n\t\t\t\t\t\"refund_req_info\": [],\n\t\t\t\t\t\"refuseButton\": 1,\n\t\t\t\t\t\"remind_undeal\": 0,\n\t\t\t\t\t\"remind_wait_time\": \"\",\n\t\t\t\t\t\"responsible_party\": \"暂无\",\n\t\t\t\t\t\"self_order_completed_button\": 0,\n\t\t\t\t\t\"send_time\": \"请10月13日 13:00送达\",\n\t\t\t\t\t\"send_time_print\": \"13日 13:00送达\",\n\t\t\t\t\t\"service_phone\": \"10105757\",\n\t\t\t\t\t\"set_express\": 0,\n\t\t\t\t\t\"sex\": \"女士\",\n\t\t\t\t\t\"shopPicked\": 1,\n\t\t\t\t\t\"shop_info\": {\n\t\t\t\t\t\t\"location_shop\": {\n\t\t\t\t\t\t\t\"latitude\": \"35**3**7\",\n\t\t\t\t\t\t\t\"longitude\": \"***4431E7\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"shop_address\": null\n\t\t\t\t\t},\n\t\t\t\t\t\"shop_name\": \"**鲜花店\",\n\t\t\t\t\t\"shop_phone\": \"13***65\",\n\t\t\t\t\t\"shop_user_distance\": \"\",\n\t\t\t\t\t\"show_add_tip\": 0,\n\t\t\t\t\t\"show_cancel_button\": false,\n\t\t\t\t\t\"show_know_button\": 0,\n\t\t\t\t\t\"show_shop_pack\": 0,\n\t\t\t\t\t\"status\": 9,\n\t\t\t\t\t\"status_desc\": \" 已完结\",\n\t\t\t\t\t\"supplier_id\": \"0\",\n\t\t\t\t\t\"supplier_name\": \"\",\n\t\t\t\t\t\"takeout_average_time\": 1602565200,\n\t\t\t\t\t\"takeout_phone\": \"136****065\",\n\t\t\t\t\t\"taxer_id\": \"\",\n\t\t\t\t\t\"thirty_min_service\": 0,\n\t\t\t\t\t\"userTags\": [2],\n\t\t\t\t\t\"user_address\": \"为了保护顾客隐私，隐藏地址信息\",\n\t\t\t\t\t\"user_address_lat\": \"30.890345\",\n\t\t\t\t\t\"user_address_lng\": \"104.261772\",\n\t\t\t\t\t\"user_id\": \"576192986\",\n\t\t\t\t\t\"user_note\": \"送给我好朋友的生日花，写几句祝福语，谢谢\",\n\t\t\t\t\t\"user_order_num_str\": \"超百次下单\",\n\t\t\t\t\t\"user_phone\": \"177****7520\",\n\t\t\t\t\t\"user_phone_call\": \"\",\n\t\t\t\t\t\"user_phone_star\": \"\",\n\t\t\t\t\t\"user_real_name\": \"珊\",\n\t\t\t\t\t\"vip_status\": 0,\n\t\t\t\t\t\"waimai_release_id\": \"159766693\",\n\t\t\t\t\t\"wxIconPath\": \"\",\n\t\t\t\t\t\"wxNickname\": \"\",\n\t\t\t\t\t\"zone_tips_required\": 0\n\t\t\t\t},\n\t\t\t\t\"order_goods\": {\n\t\t\t\t\t\"cart_num\": 1,\n\t\t\t\t\t\"goods_list\": [{\n\t\t\t\t\t\t\"customer_price\": \"98.00\",\n\t\t\t\t\t\t\"ext\": {\n\t\t\t\t\t\t\t\"attr\": \"\",\n\t\t\t\t\t\t\t\"cart_id\": \"1\",\n\t\t\t\t\t\t\t\"cold_chain\": null,\n\t\t\t\t\t\t\t\"combo_attr\": [],\n\t\t\t\t\t\t\t\"customer_total_discount\": \"\",\n\t\t\t\t\t\t\t\"discount_desc\": \"\",\n\t\t\t\t\t\t\t\"ext_code\": \"\",\n\t\t\t\t\t\t\t\"is_combo\": 0,\n\t\t\t\t\t\t\t\"process_label\": [],\n\t\t\t\t\t\t\t\"product_index\": null,\n\t\t\t\t\t\t\t\"property_label\": [],\n\t\t\t\t\t\t\t\"shop_total_discount\": \"\",\n\t\t\t\t\t\t\t\"store_attr\": {\n\t\t\t\t\t\t\t\t\"bar_code\": \"wm367**65\",\n\t\t\t\t\t\t\t\t\"category_name\": \"爱情表白\",\n\t\t\t\t\t\t\t\t\"shelf_position\": \"\",\n\t\t\t\t\t\t\t\t\"sku_id\": \"1597871782222488\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"unique_id\": \"13***678\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fix_weight\": 0,\n\t\t\t\t\t\t\"gift_info\": null,\n\t\t\t\t\t\t\"gmids\": null,\n\t\t\t\t\t\t\"hasgift\": 0,\n\t\t\t\t\t\t\"isNoReasonToReturn\": false,\n\t\t\t\t\t\t\"isfreegift\": 0,\n\t\t\t\t\t\t\"name\": \"【七夕专属】19朵红玫瑰礼盒+银叶\",\n\t\t\t\t\t\t\"number\": 1,\n\t\t\t\t\t\t\"orig_price\": \"98.00\",\n\t\t\t\t\t\t\"orig_unit_price\": \"98.00\",\n\t\t\t\t\t\t\"printing_price\": \"98.00\",\n\t\t\t\t\t\t\"shop_price\": \"98.00\",\n\t\t\t\t\t\t\"shop_unit_price\": \"98.00\",\n\t\t\t\t\t\t\"total_weight\": 999,\n\t\t\t\t\t\t\"unique_id\": \"130047***9119678\",\n\t\t\t\t\t\t\"url\": \"https://img.alic***i2/111483146/O1CN01wVILGS1Z6udgswHe4_!!111483146-0-***.jpg\",\n\t\t\t\t\t\t\"weight\": 999,\n\t\t\t\t\t\t\"weight_can_update\": false,\n\t\t\t\t\t\t\"weight_flag\": 2\n\t\t\t\t\t}],\n\t\t\t\t\t\"goods_total\": 1\n\t\t\t\t},\n\t\t\t\t\"order_meal_fee\": {\n\t\t\t\t\t\"price\": \"0.00\",\n\t\t\t\t\t\"title\": \"包装费\"\n\t\t\t\t},\n\t\t\t\t\"order_operations\": [],\n\t\t\t\t\"order_sub_total\": {\n\t\t\t\t\t\"discount\": 0,\n\t\t\t\t\t\"formula_desc\": \"\",\n\t\t\t\t\t\"number\": 1,\n\t\t\t\t\t\"price\": \"98.00\",\n\t\t\t\t\t\"title\": \"商品小计\"\n\t\t\t\t},\n\t\t\t\t\"order_total\": {\n\t\t\t\t\t\"customer_price\": \"100.00\",\n\t\t\t\t\t\"customer_title\": \"本单顾客实际支付\",\n\t\t\t\t\t\"number\": 1,\n\t\t\t\t\t\"pay_type\": 1,\n\t\t\t\t\t\"shop_price\": \"85.00\",\n\t\t\t\t\t\"shop_price_final\": \"85.00\",\n\t\t\t\t\t\"title\": \"预计收入\",\n\t\t\t\t\t\"title_after\": null,\n\t\t\t\t\t\"total_desc\": \"本单顾客实际支付100.00元\"\n\t\t\t\t},\n\t\t\t\t\"other_total_cost\": {\n\t\t\t\t\t\"price\": \"5.00\",\n\t\t\t\t\t\"title\": \"其他费用合计\"\n\t\t\t\t},\n\t\t\t\t\"prescriptionDrugsInfo\": {\n\t\t\t\t\t\"auditButton\": 0,\n\t\t\t\t\t\"prescriptionOrder\": false,\n\t\t\t\t\t\"processMsg\": \"系统正在处理中\"\n\t\t\t\t},\n\t\t\t\t\"prescription_info\": {\n\t\t\t\t\t\"is_prescription_order\": 0\n\t\t\t\t},\n\t\t\t\t\"shop_other_discount\": {\n\t\t\t\t\t\"customer_discount_list\": [],\n\t\t\t\t\t\"customer_discount_total\": 0,\n\t\t\t\t\t\"price\": \"-0.00\",\n\t\t\t\t\t\"shop_discount_list\": [],\n\t\t\t\t\t\"shop_discount_total\": 0,\n\t\t\t\t\t\"sub_total_desc\": \"以上明细为商户承担的顾客优惠费用，最终订单收入请以对账单为准。\",\n\t\t\t\t\t\"title\": \"商户其他优惠\"\n\t\t\t\t},\n\t\t\t\t\"takeout_cost\": {\n\t\t\t\t\t\"price\": \"5.00\",\n\t\t\t\t\t\"title\": \"配送费\"\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"title\": \"10月13日\"\n\t\t}]\n\t},\n\t\"errmsg\": \"\",\n\t\"errno\": 0,\n\t\"req_params\": [{\n\t\t\"asap_type\": null,\n\t\t\"end_timestamp\": \"2020-10-16\",\n\t\t\"is_asap\": null,\n\t\t\"keyword\": \"\",\n\t\t\"new_system\": 1,\n\t\t\"order_status\": 9,\n\t\t\"page\": 1,\n\t\t\"pageSize\": 20,\n\t\t\"shop_id\": null,\n\t\t\"start_timestamp\": \"2020-10-10\"\n\t}, {\n\t\t\"appVersion\": \"2.2.3\",\n\t\t\"authedSupplierIds\": [],\n\t\t\"brand\": \"samsung\",\n\t\t\"channel\": \"mobile\",\n\t\t\"cuid\": \"12B9828F9D0D3E389BA181D5A286A514|fw+G+2QPhBBAD8Yubtg6qGDX\",\n\t\t\"from\": \"android\",\n\t\t\"isBoss\": false,\n\t\t\"isManager\": false,\n\t\t\"isMobile\": false,\n\t\t\"isShop\": true,\n\t\t\"isSupplier\": false,\n\t\t\"manager\": {\n\t\t\t\"bossUserId\": null\n\t\t},\n\t\t\"pcVersion\": \"\",\n\t\t\"roleInfo\": {\n\t\t\t\"shopRoleId\": \"159766693\"\n\t\t},\n\t\t\"shopInfo\": {\n\t\t\t\"eleId\": 159766693,\n\t\t\t\"wid\": \"159766693\"\n\t\t},\n\t\t\"supplierInfo\": {\n\t\t\t\"supplierId\": \"0\"\n\t\t},\n\t\t\"userInfo\": {\n\t\t\t\"loginRole\": 1,\n\t\t\t\"loginSubUserType\": 0,\n\t\t\t\"loginUserId\": \"1597***50001\",\n\t\t\t\"phone\": \"13***65\",\n\t\t\t\"shopUserId\": \"15973**001\",\n\t\t\t\"userName\": \"x***65\"\n\t\t}\n\t}]\n}\n```\n\n\n\n# 4：Python程序\n\n对上述JSON数据进行分析，在Python中用json.load把JSON数据转化为字典和列表格式数据，方便我们提取信息。\n\n```python\nimport mitmproxy.http\nimport json\n\n#顾客类\nclass Customer(object):\n    def __init__(self,name,tel):\n        self.name = name \n        self.tel = tel\n       \n\n#商品类\nclass Good(object):\n    def __init__(self,name,number,img):\n        self.name = name\n        self.number = number\n        self.img = img\n\n#订单类\nclass Order(Customer):\n    def __init__(self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods):\n        Customer.__init__(self,name,tel)\n        self.addr_long = addr_long\n        self.addr_latu = addr_latu\n        self.note = note\n        self.arri_time = arri_time\n        self.order_id = order_id\n        self.goods = goods\n        self.platform = platform\n\n\nclass ElemeOrders():\n    def __init__(self):\n        self.orders = []\n\n    def response(self, flow: mitmproxy.http.flow):\n        if \"bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?\" in flow.request.url:\n            data = json.loads(flow.response.text)[\"data\"]\n            for total_order_list in data['total_order_list']:\n                for order_list in total_order_list['order_list']:\n                    goods = []\n                    for good in order_list['order_goods']['goods_list']:\n                        good_buffer = Good(good['name'],good['number'],good['url'])\n                        goods.append(good_buffer)\n                    order = Order('eleme',order_list['order_basic']['user_real_name']+order_list['order_basic']['sex'],order_list['order_basic']['user_phone'],str(order_list['order_basic']['user_address_lng']),str(order_list['order_basic']['user_address_lat']),order_list['order_basic']['user_note'],order_list['order_basic']['takeout_average_time'],order_list['order_basic']['order_id'],goods)\n                    self.orders.append(order)\n            print(self.orders)\n```\n\n经过简单的测试，程序能够拿到完整的订单信息。一次性搞定，没有bug。\n\n在这个程序中，主要需要关注的是，Mitm类中的self.orders这个变量，可以看到，这个变量是一个列表，它包含了大于等于1个订单。每个订单，都是一个Order类的实例化，Order类中最后一个变量goods是一个列表，这个列表由多个实例化的Good类组成。因为一个订单可能包含多种商品。\n\n具体如何利用这些信息，还需要再Mitm()类中做修改。而提取单个订单类，比如第一个订单，直接使用`self.orders[0]`，要提取第一个订单中的第一件商品`self.orders[0].goods[0]`。\n\n其他的，比如第一个订单收货人：`self.orders[0].name`\n\n第一个订单的第一件商品的名称：`self.orders[0].goods[0].name`\n\n后续我可能会将它保存到数据库中，方便下次提取和修改信息。\n\n# 5：参考资料\n\n《[使用 mitmproxy + python 做拦截代理](https://blog.csdn.net/freeking101/article/details/83901842)》\n\n《[APP爬虫入门，Appium+Mitmproxy强势组合实现抖音的数据爬取](https://www.weiney.com/2072.html)》","source":"_posts/外卖平台订单爬取之饿了么零售商家版.md","raw":"---\ntitle: 外卖平台订单爬取之饿了么零售商家版\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-10-16 23:46:27\npassword:\nsummary:\ntags: \n- Mitmproxy\n- Python\ncategories: 爬虫\n---\n\n# 1：简单说两句\n\n这是我一个准备做的完整项目中的一个小部分。从很早以前，我就在思考，如何将美团和饿了么以及我自己做的小程序订单合并在一起，这样来实现统一的管理。。之所以要统一管理，是因为我母亲从事鲜花零售，在节假日里，会有大量的订单，而鲜花的包扎是个时间活。制作和配送，以及订单的处理，繁杂的程序会让人晕头转向。为了减轻我母亲的节假日压力，我想到了一些方法，来帮助她管理订单。\n\n完整的项目是，汇总小程序、美团、饿了么的订单。将订单返回的信息，通过处理，按配送时间排序，经过处理后通过企业微信api推送给微信。因为，花店的配送人员都是我母亲找的，他们受教育程度低，有的因为不识字，连导航都不会用。所以，需要把订单的位置信息，通过百度地图api转为url发送给配送员。另外，还可以制作一个程序，在程序上实时更新，新订单。。每当一束花被做好，我母亲就可从程序中将该订单从等待制作的列表中移除。。每当，有一个订单被送出，也可在程序上控制美团等客户端发送对应消息。\n\n这一切都是非常美好的，对零售商家的体验会非常友好。但是，因为我无法取得美团和饿了么的开发者资格，也就拿不到他们的接口授权。。于是，我想到了，利用利用mitmproxy获取美团饿了么的订单信息。通过appium自动化控制手机。无论是mitmrpoxy还是appium对python程序都是非常友好的。\n\n那么现在开始我的第一步，利用mitmproxy爬取饿了么零售商家版订单信息。\n\n# 2：mitmproxy安装与使用\n\n**安装**\n\n```python\npip install mitmproxy\n```\n\n**开启**\n\n```shell\nmitmweb\n#或者mitmproxy mitmdump\n```\n\n**与python配合**\n\n```python\nmitmdump -s eleme.py\n```\n\n**手机使用mitmproxy开启的代理**：\n\n更改wifi高级设置里的代理模式为手动，主机填写mitmproxy运行的电脑局域网ip。可通过ifconfig查看。\n\n端口为8080\n\n此时打开baidu.com会提示不安全，而且mitmproxy应该开始记录了。\n\n手机打开网页`mitm.it`下载对应系统的证书文件。安卓下载后直接安装。。\n\n再上网就不会提示不安全了。\n\n# 3：响应内容\n\n在开启mitmweb后，从打开的网页上可以观察到手机的整个数据流，在手机上刷新订单页，就能截获饿了么发送回来的订单信息。\n\n将响应内容提取出来，并把JSON数据格式化，部分关键信息已打码。\n\n```json\n{\n\t\"data\": {\n\t\t\"curr_page\": 1,\n\t\t\"order_count\": 1,\n\t\t\"page_count\": 1,\n\t\t\"page_size\": 20,\n\t\t\"total_order_list\": [{\n\t\t\t\"mills\": 1602518400000,\n\t\t\t\"order_list\": [{\n\t\t\t\t\"cold_chain_cost\": {\n\t\t\t\t\t\"price\": \"0.00\",\n\t\t\t\t\t\"title\": \"冷链服务费\"\n\t\t\t\t},\n\t\t\t\t\"compensationInfo\": {\n\t\t\t\t\t\"enableCompensable\": false,\n\t\t\t\t\t\"timeRemaining\": 0\n\t\t\t\t},\n\t\t\t\t\"extract_commission\": {\n\t\t\t\t\t\"brief_desc\": \"请以结算账单为准\",\n\t\t\t\t\t\"commission_total\": \"15.00\",\n\t\t\t\t\t\"title\": \"抽取佣金\"\n\t\t\t\t},\n\t\t\t\t\"goods_discount\": {\n\t\t\t\t\t\"discount_account\": \"-￥3.00\",\n\t\t\t\t\t\"discount_list\": [{\n\t\t\t\t\t\t\"desc\": \"\",\n\t\t\t\t\t\t\"hasLineBelow\": 1,\n\t\t\t\t\t\t\"list\": [{\n\t\t\t\t\t\t\t\"price\": \"￥3.00\",\n\t\t\t\t\t\t\t\"title\": \"商家配送费补贴\"\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"price\": \"￥3.00\",\n\t\t\t\t\t\t\t\"title\": \"小计\"\n\t\t\t\t\t\t}],\n\t\t\t\t\t\t\"title\": \"商户补贴金额\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"desc\": \"\",\n\t\t\t\t\t\t\"hasLineBelow\": null,\n\t\t\t\t\t\t\"list\": [{\n\t\t\t\t\t\t\t\"title\": \"配送费满减\"\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"title\": \"(商家补贴:￥3.00元)\"\n\t\t\t\t\t\t}],\n\t\t\t\t\t\t\"title\": \"活动明细\"\n\t\t\t\t\t}],\n\t\t\t\t\t\"title\": \"顾客优惠合计\",\n\t\t\t\t\t\"user_discount_account\": \"-￥3.00\"\n\t\t\t\t},\n\t\t\t\t\"grayInfo\": {\n\t\t\t\t\t\"hummingBirdGray\": 0\n\t\t\t\t},\n\t\t\t\t\"orderSettle\": {\n\t\t\t\t\t\"baseLogisticsAmt\": \"0.00\",\n\t\t\t\t\t\"baseLogisticsDesc\": \"本单收取固定物流费\",\n\t\t\t\t\t\"commissionAmt\": \"15.00\",\n\t\t\t\t\t\"commissionDesc\": \"请以结算账单为准\",\n\t\t\t\t\t\"shopInAmount\": \"0.00\"\n\t\t\t\t},\n\t\t\t\t\"order_basic\": {\n\t\t\t\t\t\"apply_cancel_feed\": {\n\t\t\t\t\t\t\"feed_list\": [{\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 12:55\",\n\t\t\t\t\t\t\t\"cancel_title\": \"订单已完成(商户)\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 09:10\",\n\t\t\t\t\t\t\t\"cancel_title\": \"商家已接单\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 09:10\",\n\t\t\t\t\t\t\t\"cancel_title\": \"订单已支付\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\"cancel_content\": \"\",\n\t\t\t\t\t\t\t\"cancel_extra\": \"\",\n\t\t\t\t\t\t\t\"cancel_time\": \"10月13日 09:09\",\n\t\t\t\t\t\t\t\"cancel_title\": \"创建订单\",\n\t\t\t\t\t\t\t\"end_time\": \"\",\n\t\t\t\t\t\t\t\"left_time\": 0,\n\t\t\t\t\t\t\t\"left_time_show\": \"\",\n\t\t\t\t\t\t\t\"refund_price\": \"\",\n\t\t\t\t\t\t\t\"user_apply_refund_pic\": []\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t\"apply_cancel_status\": 886,\n\t\t\t\t\t\"auto_confirm_order\": 0,\n\t\t\t\t\t\"batch\": 2000000000000000001,\n\t\t\t\t\t\"business_type\": 0,\n\t\t\t\t\t\"call_delivery_delay\": \"\",\n\t\t\t\t\t\"cancel_reason\": \"\",\n\t\t\t\t\t\"cancel_reason_explain\": \"\",\n\t\t\t\t\t\"cancel_reason_status\": \"0\",\n\t\t\t\t\t\"check_out_button\": 0,\n\t\t\t\t\t\"city_name\": \"成都市\",\n\t\t\t\t\t\"confirmButton\": 1,\n\t\t\t\t\t\"confirm_time\": \"1602551413\",\n\t\t\t\t\t\"create_time\": \"1602551397\",\n\t\t\t\t\t\"delivery_delay_time\": \"\",\n\t\t\t\t\t\"delivery_exception_code\": 0,\n\t\t\t\t\t\"delivery_exception_state\": \"\",\n\t\t\t\t\t\"delivery_name\": \"\",\n\t\t\t\t\t\"delivery_party\": \"self\",\n\t\t\t\t\t\"delivery_staff_phone\": \"\",\n\t\t\t\t\t\"delivery_state\": \"0\",\n\t\t\t\t\t\"delivery_state_desc\": \"\",\n\t\t\t\t\t\"delivery_tip_amount\": 0.0,\n\t\t\t\t\t\"distance\": \"<1.8千米\",\n\t\t\t\t\t\"due_deliver_time_by_ofc\": \"\",\n\t\t\t\t\t\"ele_fengniao_info\": {\n\t\t\t\t\t\t\"is_fengniao_call_again\": 0,\n\t\t\t\t\t\t\"is_fengniao_switch_self\": 0,\n\t\t\t\t\t\t\"no_delivery\": 0\n\t\t\t\t\t},\n\t\t\t\t\t\"ele_zhongbao_info\": {\n\t\t\t\t\t\t\"delivery_fee\": 0,\n\t\t\t\t\t\t\"is_show\": false,\n\t\t\t\t\t\t\"op_status\": 0\n\t\t\t\t\t},\n\t\t\t\t\t\"eleme_finish_refund\": 0,\n\t\t\t\t\t\"eleme_order_id\": \"5009809679236497411\",\n\t\t\t\t\t\"evoip_order\": 2,\n\t\t\t\t\t\"express_company\": \"\",\n\t\t\t\t\t\"express_id\": \"0\",\n\t\t\t\t\t\"feed_to_show\": \"order_log\",\n\t\t\t\t\t\"finished_time\": \"1602564946\",\n\t\t\t\t\t\"gift_greeting\": \"\",\n\t\t\t\t\t\"gift_phone\": \"13***502\",\n\t\t\t\t\t\"hbirdRunErrandsInfo\": {\n\t\t\t\t\t\t\"addTipsButton\": 0,\n\t\t\t\t\t\t\"callButton\": 0,\n\t\t\t\t\t\t\"cancelCallButton\": 0,\n\t\t\t\t\t\t\"payType\": null\n\t\t\t\t\t},\n\t\t\t\t\t\"idempotentId\": \"20201017025815254005000100027411822742\",\n\t\t\t\t\t\"invoice_price\": \"100.00\",\n\t\t\t\t\t\"invoice_title\": \"\",\n\t\t\t\t\t\"is_alipay_order\": 0,\n\t\t\t\t\t\"is_baidu_logistics\": 0,\n\t\t\t\t\t\"is_can_auto_confirm\": 0,\n\t\t\t\t\t\"is_city_delivery\": 0,\n\t\t\t\t\t\"is_cold_order\": 0,\n\t\t\t\t\t\"is_compensation_show\": 0,\n\t\t\t\t\t\"is_cook_overtime\": 0,\n\t\t\t\t\t\"is_from_tp_new_retail\": true,\n\t\t\t\t\t\"is_print\": 1,\n\t\t\t\t\t\"is_privacy_hide\": 1,\n\t\t\t\t\t\"is_ranger_show\": 1,\n\t\t\t\t\t\"is_show_express\": 0,\n\t\t\t\t\t\"ivr_tip\": \"\",\n\t\t\t\t\t\"meal_num\": \"\",\n\t\t\t\t\t\"need_invoice\": 0,\n\t\t\t\t\t\"orderUserPhone\": \"136****3502\",\n\t\t\t\t\t\"orderUserPrivacyPhone\": \"\",\n\t\t\t\t\t\"order_from\": \"2\",\n\t\t\t\t\t\"order_id\": \"50098***97411\",\n\t\t\t\t\t\"order_index\": \"1\",\n\t\t\t\t\t\"order_list_type\": {\n\t\t\t\t\t\t\"is_cancel\": 0,\n\t\t\t\t\t\t\"is_exception\": 0,\n\t\t\t\t\t\t\"is_new\": 0,\n\t\t\t\t\t\t\"is_remind\": 0,\n\t\t\t\t\t\t\"is_reserve\": 1,\n\t\t\t\t\t\t\"is_user_part_refund\": 0\n\t\t\t\t\t},\n\t\t\t\t\t\"order_time_line\": [{\n\t\t\t\t\t\t\"code\": \"101004\",\n\t\t\t\t\t\t\"time\": \"10/13 12:55\",\n\t\t\t\t\t\t\"title\": \"订单已完成(商户)\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"code\": \"100004\",\n\t\t\t\t\t\t\"time\": \"10/13 09:10\",\n\t\t\t\t\t\t\"title\": \"商家已接单\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"code\": \"100001\",\n\t\t\t\t\t\t\"time\": \"10/13 09:10\",\n\t\t\t\t\t\t\"title\": \"订单已支付\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"code\": \"100000\",\n\t\t\t\t\t\t\"time\": \"10/13 09:09\",\n\t\t\t\t\t\t\"title\": \"创建订单\"\n\t\t\t\t\t}],\n\t\t\t\t\t\"order_type\": 4,\n\t\t\t\t\t\"part_refund_support\": 0,\n\t\t\t\t\t\"pay_display\": 1,\n\t\t\t\t\t\"pay_status\": \"已支付\",\n\t\t\t\t\t\"pc_order_label\": [],\n\t\t\t\t\t\"pick_info\": {\n\t\t\t\t\t\t\"expect_finish_time\": \"02:58:15\",\n\t\t\t\t\t\t\"left_time\": \"0\",\n\t\t\t\t\t\t\"pick_button\": \"0\",\n\t\t\t\t\t\t\"show\": \"0\",\n\t\t\t\t\t\t\"timestamp\": \"\"\n\t\t\t\t\t},\n\t\t\t\t\t\"privacy_phone\": \"\",\n\t\t\t\t\t\"range_status\": 0,\n\t\t\t\t\t\"real_status\": 5,\n\t\t\t\t\t\"real_status_desc\": \"商家已经确认订单\",\n\t\t\t\t\t\"refund_attribute\": 0,\n\t\t\t\t\t\"refund_logs\": [],\n\t\t\t\t\t\"refund_req_info\": [],\n\t\t\t\t\t\"refuseButton\": 1,\n\t\t\t\t\t\"remind_undeal\": 0,\n\t\t\t\t\t\"remind_wait_time\": \"\",\n\t\t\t\t\t\"responsible_party\": \"暂无\",\n\t\t\t\t\t\"self_order_completed_button\": 0,\n\t\t\t\t\t\"send_time\": \"请10月13日 13:00送达\",\n\t\t\t\t\t\"send_time_print\": \"13日 13:00送达\",\n\t\t\t\t\t\"service_phone\": \"10105757\",\n\t\t\t\t\t\"set_express\": 0,\n\t\t\t\t\t\"sex\": \"女士\",\n\t\t\t\t\t\"shopPicked\": 1,\n\t\t\t\t\t\"shop_info\": {\n\t\t\t\t\t\t\"location_shop\": {\n\t\t\t\t\t\t\t\"latitude\": \"35**3**7\",\n\t\t\t\t\t\t\t\"longitude\": \"***4431E7\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"shop_address\": null\n\t\t\t\t\t},\n\t\t\t\t\t\"shop_name\": \"**鲜花店\",\n\t\t\t\t\t\"shop_phone\": \"13***65\",\n\t\t\t\t\t\"shop_user_distance\": \"\",\n\t\t\t\t\t\"show_add_tip\": 0,\n\t\t\t\t\t\"show_cancel_button\": false,\n\t\t\t\t\t\"show_know_button\": 0,\n\t\t\t\t\t\"show_shop_pack\": 0,\n\t\t\t\t\t\"status\": 9,\n\t\t\t\t\t\"status_desc\": \" 已完结\",\n\t\t\t\t\t\"supplier_id\": \"0\",\n\t\t\t\t\t\"supplier_name\": \"\",\n\t\t\t\t\t\"takeout_average_time\": 1602565200,\n\t\t\t\t\t\"takeout_phone\": \"136****065\",\n\t\t\t\t\t\"taxer_id\": \"\",\n\t\t\t\t\t\"thirty_min_service\": 0,\n\t\t\t\t\t\"userTags\": [2],\n\t\t\t\t\t\"user_address\": \"为了保护顾客隐私，隐藏地址信息\",\n\t\t\t\t\t\"user_address_lat\": \"30.890345\",\n\t\t\t\t\t\"user_address_lng\": \"104.261772\",\n\t\t\t\t\t\"user_id\": \"576192986\",\n\t\t\t\t\t\"user_note\": \"送给我好朋友的生日花，写几句祝福语，谢谢\",\n\t\t\t\t\t\"user_order_num_str\": \"超百次下单\",\n\t\t\t\t\t\"user_phone\": \"177****7520\",\n\t\t\t\t\t\"user_phone_call\": \"\",\n\t\t\t\t\t\"user_phone_star\": \"\",\n\t\t\t\t\t\"user_real_name\": \"珊\",\n\t\t\t\t\t\"vip_status\": 0,\n\t\t\t\t\t\"waimai_release_id\": \"159766693\",\n\t\t\t\t\t\"wxIconPath\": \"\",\n\t\t\t\t\t\"wxNickname\": \"\",\n\t\t\t\t\t\"zone_tips_required\": 0\n\t\t\t\t},\n\t\t\t\t\"order_goods\": {\n\t\t\t\t\t\"cart_num\": 1,\n\t\t\t\t\t\"goods_list\": [{\n\t\t\t\t\t\t\"customer_price\": \"98.00\",\n\t\t\t\t\t\t\"ext\": {\n\t\t\t\t\t\t\t\"attr\": \"\",\n\t\t\t\t\t\t\t\"cart_id\": \"1\",\n\t\t\t\t\t\t\t\"cold_chain\": null,\n\t\t\t\t\t\t\t\"combo_attr\": [],\n\t\t\t\t\t\t\t\"customer_total_discount\": \"\",\n\t\t\t\t\t\t\t\"discount_desc\": \"\",\n\t\t\t\t\t\t\t\"ext_code\": \"\",\n\t\t\t\t\t\t\t\"is_combo\": 0,\n\t\t\t\t\t\t\t\"process_label\": [],\n\t\t\t\t\t\t\t\"product_index\": null,\n\t\t\t\t\t\t\t\"property_label\": [],\n\t\t\t\t\t\t\t\"shop_total_discount\": \"\",\n\t\t\t\t\t\t\t\"store_attr\": {\n\t\t\t\t\t\t\t\t\"bar_code\": \"wm367**65\",\n\t\t\t\t\t\t\t\t\"category_name\": \"爱情表白\",\n\t\t\t\t\t\t\t\t\"shelf_position\": \"\",\n\t\t\t\t\t\t\t\t\"sku_id\": \"1597871782222488\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"unique_id\": \"13***678\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fix_weight\": 0,\n\t\t\t\t\t\t\"gift_info\": null,\n\t\t\t\t\t\t\"gmids\": null,\n\t\t\t\t\t\t\"hasgift\": 0,\n\t\t\t\t\t\t\"isNoReasonToReturn\": false,\n\t\t\t\t\t\t\"isfreegift\": 0,\n\t\t\t\t\t\t\"name\": \"【七夕专属】19朵红玫瑰礼盒+银叶\",\n\t\t\t\t\t\t\"number\": 1,\n\t\t\t\t\t\t\"orig_price\": \"98.00\",\n\t\t\t\t\t\t\"orig_unit_price\": \"98.00\",\n\t\t\t\t\t\t\"printing_price\": \"98.00\",\n\t\t\t\t\t\t\"shop_price\": \"98.00\",\n\t\t\t\t\t\t\"shop_unit_price\": \"98.00\",\n\t\t\t\t\t\t\"total_weight\": 999,\n\t\t\t\t\t\t\"unique_id\": \"130047***9119678\",\n\t\t\t\t\t\t\"url\": \"https://img.alic***i2/111483146/O1CN01wVILGS1Z6udgswHe4_!!111483146-0-***.jpg\",\n\t\t\t\t\t\t\"weight\": 999,\n\t\t\t\t\t\t\"weight_can_update\": false,\n\t\t\t\t\t\t\"weight_flag\": 2\n\t\t\t\t\t}],\n\t\t\t\t\t\"goods_total\": 1\n\t\t\t\t},\n\t\t\t\t\"order_meal_fee\": {\n\t\t\t\t\t\"price\": \"0.00\",\n\t\t\t\t\t\"title\": \"包装费\"\n\t\t\t\t},\n\t\t\t\t\"order_operations\": [],\n\t\t\t\t\"order_sub_total\": {\n\t\t\t\t\t\"discount\": 0,\n\t\t\t\t\t\"formula_desc\": \"\",\n\t\t\t\t\t\"number\": 1,\n\t\t\t\t\t\"price\": \"98.00\",\n\t\t\t\t\t\"title\": \"商品小计\"\n\t\t\t\t},\n\t\t\t\t\"order_total\": {\n\t\t\t\t\t\"customer_price\": \"100.00\",\n\t\t\t\t\t\"customer_title\": \"本单顾客实际支付\",\n\t\t\t\t\t\"number\": 1,\n\t\t\t\t\t\"pay_type\": 1,\n\t\t\t\t\t\"shop_price\": \"85.00\",\n\t\t\t\t\t\"shop_price_final\": \"85.00\",\n\t\t\t\t\t\"title\": \"预计收入\",\n\t\t\t\t\t\"title_after\": null,\n\t\t\t\t\t\"total_desc\": \"本单顾客实际支付100.00元\"\n\t\t\t\t},\n\t\t\t\t\"other_total_cost\": {\n\t\t\t\t\t\"price\": \"5.00\",\n\t\t\t\t\t\"title\": \"其他费用合计\"\n\t\t\t\t},\n\t\t\t\t\"prescriptionDrugsInfo\": {\n\t\t\t\t\t\"auditButton\": 0,\n\t\t\t\t\t\"prescriptionOrder\": false,\n\t\t\t\t\t\"processMsg\": \"系统正在处理中\"\n\t\t\t\t},\n\t\t\t\t\"prescription_info\": {\n\t\t\t\t\t\"is_prescription_order\": 0\n\t\t\t\t},\n\t\t\t\t\"shop_other_discount\": {\n\t\t\t\t\t\"customer_discount_list\": [],\n\t\t\t\t\t\"customer_discount_total\": 0,\n\t\t\t\t\t\"price\": \"-0.00\",\n\t\t\t\t\t\"shop_discount_list\": [],\n\t\t\t\t\t\"shop_discount_total\": 0,\n\t\t\t\t\t\"sub_total_desc\": \"以上明细为商户承担的顾客优惠费用，最终订单收入请以对账单为准。\",\n\t\t\t\t\t\"title\": \"商户其他优惠\"\n\t\t\t\t},\n\t\t\t\t\"takeout_cost\": {\n\t\t\t\t\t\"price\": \"5.00\",\n\t\t\t\t\t\"title\": \"配送费\"\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"title\": \"10月13日\"\n\t\t}]\n\t},\n\t\"errmsg\": \"\",\n\t\"errno\": 0,\n\t\"req_params\": [{\n\t\t\"asap_type\": null,\n\t\t\"end_timestamp\": \"2020-10-16\",\n\t\t\"is_asap\": null,\n\t\t\"keyword\": \"\",\n\t\t\"new_system\": 1,\n\t\t\"order_status\": 9,\n\t\t\"page\": 1,\n\t\t\"pageSize\": 20,\n\t\t\"shop_id\": null,\n\t\t\"start_timestamp\": \"2020-10-10\"\n\t}, {\n\t\t\"appVersion\": \"2.2.3\",\n\t\t\"authedSupplierIds\": [],\n\t\t\"brand\": \"samsung\",\n\t\t\"channel\": \"mobile\",\n\t\t\"cuid\": \"12B9828F9D0D3E389BA181D5A286A514|fw+G+2QPhBBAD8Yubtg6qGDX\",\n\t\t\"from\": \"android\",\n\t\t\"isBoss\": false,\n\t\t\"isManager\": false,\n\t\t\"isMobile\": false,\n\t\t\"isShop\": true,\n\t\t\"isSupplier\": false,\n\t\t\"manager\": {\n\t\t\t\"bossUserId\": null\n\t\t},\n\t\t\"pcVersion\": \"\",\n\t\t\"roleInfo\": {\n\t\t\t\"shopRoleId\": \"159766693\"\n\t\t},\n\t\t\"shopInfo\": {\n\t\t\t\"eleId\": 159766693,\n\t\t\t\"wid\": \"159766693\"\n\t\t},\n\t\t\"supplierInfo\": {\n\t\t\t\"supplierId\": \"0\"\n\t\t},\n\t\t\"userInfo\": {\n\t\t\t\"loginRole\": 1,\n\t\t\t\"loginSubUserType\": 0,\n\t\t\t\"loginUserId\": \"1597***50001\",\n\t\t\t\"phone\": \"13***65\",\n\t\t\t\"shopUserId\": \"15973**001\",\n\t\t\t\"userName\": \"x***65\"\n\t\t}\n\t}]\n}\n```\n\n\n\n# 4：Python程序\n\n对上述JSON数据进行分析，在Python中用json.load把JSON数据转化为字典和列表格式数据，方便我们提取信息。\n\n```python\nimport mitmproxy.http\nimport json\n\n#顾客类\nclass Customer(object):\n    def __init__(self,name,tel):\n        self.name = name \n        self.tel = tel\n       \n\n#商品类\nclass Good(object):\n    def __init__(self,name,number,img):\n        self.name = name\n        self.number = number\n        self.img = img\n\n#订单类\nclass Order(Customer):\n    def __init__(self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods):\n        Customer.__init__(self,name,tel)\n        self.addr_long = addr_long\n        self.addr_latu = addr_latu\n        self.note = note\n        self.arri_time = arri_time\n        self.order_id = order_id\n        self.goods = goods\n        self.platform = platform\n\n\nclass ElemeOrders():\n    def __init__(self):\n        self.orders = []\n\n    def response(self, flow: mitmproxy.http.flow):\n        if \"bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?\" in flow.request.url:\n            data = json.loads(flow.response.text)[\"data\"]\n            for total_order_list in data['total_order_list']:\n                for order_list in total_order_list['order_list']:\n                    goods = []\n                    for good in order_list['order_goods']['goods_list']:\n                        good_buffer = Good(good['name'],good['number'],good['url'])\n                        goods.append(good_buffer)\n                    order = Order('eleme',order_list['order_basic']['user_real_name']+order_list['order_basic']['sex'],order_list['order_basic']['user_phone'],str(order_list['order_basic']['user_address_lng']),str(order_list['order_basic']['user_address_lat']),order_list['order_basic']['user_note'],order_list['order_basic']['takeout_average_time'],order_list['order_basic']['order_id'],goods)\n                    self.orders.append(order)\n            print(self.orders)\n```\n\n经过简单的测试，程序能够拿到完整的订单信息。一次性搞定，没有bug。\n\n在这个程序中，主要需要关注的是，Mitm类中的self.orders这个变量，可以看到，这个变量是一个列表，它包含了大于等于1个订单。每个订单，都是一个Order类的实例化，Order类中最后一个变量goods是一个列表，这个列表由多个实例化的Good类组成。因为一个订单可能包含多种商品。\n\n具体如何利用这些信息，还需要再Mitm()类中做修改。而提取单个订单类，比如第一个订单，直接使用`self.orders[0]`，要提取第一个订单中的第一件商品`self.orders[0].goods[0]`。\n\n其他的，比如第一个订单收货人：`self.orders[0].name`\n\n第一个订单的第一件商品的名称：`self.orders[0].goods[0].name`\n\n后续我可能会将它保存到数据库中，方便下次提取和修改信息。\n\n# 5：参考资料\n\n《[使用 mitmproxy + python 做拦截代理](https://blog.csdn.net/freeking101/article/details/83901842)》\n\n《[APP爬虫入门，Appium+Mitmproxy强势组合实现抖音的数据爬取](https://www.weiney.com/2072.html)》","slug":"外卖平台订单爬取之饿了么零售商家版","published":1,"updated":"2020-10-18T15:11:16.585Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckgfr41n40005lkvzenhpgluj","content":"<h1 id=\"1：简单说两句\"><a href=\"#1：简单说两句\" class=\"headerlink\" title=\"1：简单说两句\"></a>1：简单说两句</h1><p>这是我一个准备做的完整项目中的一个小部分。从很早以前，我就在思考，如何将美团和饿了么以及我自己做的小程序订单合并在一起，这样来实现统一的管理。。之所以要统一管理，是因为我母亲从事鲜花零售，在节假日里，会有大量的订单，而鲜花的包扎是个时间活。制作和配送，以及订单的处理，繁杂的程序会让人晕头转向。为了减轻我母亲的节假日压力，我想到了一些方法，来帮助她管理订单。</p>\n<p>完整的项目是，汇总小程序、美团、饿了么的订单。将订单返回的信息，通过处理，按配送时间排序，经过处理后通过企业微信api推送给微信。因为，花店的配送人员都是我母亲找的，他们受教育程度低，有的因为不识字，连导航都不会用。所以，需要把订单的位置信息，通过百度地图api转为url发送给配送员。另外，还可以制作一个程序，在程序上实时更新，新订单。。每当一束花被做好，我母亲就可从程序中将该订单从等待制作的列表中移除。。每当，有一个订单被送出，也可在程序上控制美团等客户端发送对应消息。</p>\n<p>这一切都是非常美好的，对零售商家的体验会非常友好。但是，因为我无法取得美团和饿了么的开发者资格，也就拿不到他们的接口授权。。于是，我想到了，利用利用mitmproxy获取美团饿了么的订单信息。通过appium自动化控制手机。无论是mitmrpoxy还是appium对python程序都是非常友好的。</p>\n<p>那么现在开始我的第一步，利用mitmproxy爬取饿了么零售商家版订单信息。</p>\n<h1 id=\"2：mitmproxy安装与使用\"><a href=\"#2：mitmproxy安装与使用\" class=\"headerlink\" title=\"2：mitmproxy安装与使用\"></a>2：mitmproxy安装与使用</h1><p><strong>安装</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install mitmproxy</span><br></pre></td></tr></table></figure>\n\n<p><strong>开启</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mitmweb</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">或者mitmproxy mitmdump</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>与python配合</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mitmdump -s eleme.py</span><br></pre></td></tr></table></figure>\n\n<p><strong>手机使用mitmproxy开启的代理</strong>：</p>\n<p>更改wifi高级设置里的代理模式为手动，主机填写mitmproxy运行的电脑局域网ip。可通过ifconfig查看。</p>\n<p>端口为8080</p>\n<p>此时打开baidu.com会提示不安全，而且mitmproxy应该开始记录了。</p>\n<p>手机打开网页<code>mitm.it</code>下载对应系统的证书文件。安卓下载后直接安装。。</p>\n<p>再上网就不会提示不安全了。</p>\n<h1 id=\"3：响应内容\"><a href=\"#3：响应内容\" class=\"headerlink\" title=\"3：响应内容\"></a>3：响应内容</h1><p>在开启mitmweb后，从打开的网页上可以观察到手机的整个数据流，在手机上刷新订单页，就能截获饿了么发送回来的订单信息。</p>\n<p>将响应内容提取出来，并把JSON数据格式化，部分关键信息已打码。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">&quot;data&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;curr_page&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;order_count&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;page_count&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;page_size&quot;</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;total_order_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;mills&quot;</span>: <span class=\"number\">1602518400000</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cold_chain_cost&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;冷链服务费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;compensationInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;enableCompensable&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;timeRemaining&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;extract_commission&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;brief_desc&quot;</span>: <span class=\"string\">&quot;请以结算账单为准&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;commission_total&quot;</span>: <span class=\"string\">&quot;15.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;抽取佣金&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;goods_discount&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;discount_account&quot;</span>: <span class=\"string\">&quot;-￥3.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;discount_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;hasLineBelow&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;￥3.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商家配送费补贴&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;￥3.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;小计&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商户补贴金额&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;hasLineBelow&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;配送费满减&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;(商家补贴:￥3.00元)&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;活动明细&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;顾客优惠合计&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_discount_account&quot;</span>: <span class=\"string\">&quot;-￥3.00&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;grayInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;hummingBirdGray&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;orderSettle&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;baseLogisticsAmt&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;baseLogisticsDesc&quot;</span>: <span class=\"string\">&quot;本单收取固定物流费&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;commissionAmt&quot;</span>: <span class=\"string\">&quot;15.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;commissionDesc&quot;</span>: <span class=\"string\">&quot;请以结算账单为准&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shopInAmount&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_basic&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;apply_cancel_feed&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;feed_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 12:55&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;订单已完成(商户)&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;商家已接单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;订单已支付&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 09:09&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;创建订单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;]</span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;apply_cancel_status&quot;</span>: <span class=\"number\">886</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;auto_confirm_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;batch&quot;</span>: <span class=\"number\">2000000000000000001</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;business_type&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;call_delivery_delay&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cancel_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cancel_reason_explain&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cancel_reason_status&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;check_out_button&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;city_name&quot;</span>: <span class=\"string\">&quot;成都市&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;confirmButton&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;confirm_time&quot;</span>: <span class=\"string\">&quot;1602551413&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;create_time&quot;</span>: <span class=\"string\">&quot;1602551397&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_delay_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_exception_code&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_exception_state&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_party&quot;</span>: <span class=\"string\">&quot;self&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_staff_phone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_state&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_state_desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_tip_amount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;distance&quot;</span>: <span class=\"string\">&quot;&lt;1.8千米&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;due_deliver_time_by_ofc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;ele_fengniao_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_fengniao_call_again&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_fengniao_switch_self&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;no_delivery&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;ele_zhongbao_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;delivery_fee&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_show&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;op_status&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;eleme_finish_refund&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;eleme_order_id&quot;</span>: <span class=\"string\">&quot;5009809679236497411&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;evoip_order&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;express_company&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;express_id&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;feed_to_show&quot;</span>: <span class=\"string\">&quot;order_log&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;finished_time&quot;</span>: <span class=\"string\">&quot;1602564946&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;gift_greeting&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;gift_phone&quot;</span>: <span class=\"string\">&quot;13***502&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;hbirdRunErrandsInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;addTipsButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;callButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;cancelCallButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;payType&quot;</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;idempotentId&quot;</span>: <span class=\"string\">&quot;20201017025815254005000100027411822742&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;invoice_price&quot;</span>: <span class=\"string\">&quot;100.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;invoice_title&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_alipay_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_baidu_logistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_can_auto_confirm&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_city_delivery&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_cold_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_compensation_show&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_cook_overtime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_from_tp_new_retail&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_print&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_privacy_hide&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_ranger_show&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_show_express&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;ivr_tip&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;meal_num&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;need_invoice&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;orderUserPhone&quot;</span>: <span class=\"string\">&quot;136****3502&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;orderUserPrivacyPhone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_from&quot;</span>: <span class=\"string\">&quot;2&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_id&quot;</span>: <span class=\"string\">&quot;50098***97411&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_index&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_list_type&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_cancel&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_exception&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_new&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_remind&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_reserve&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_user_part_refund&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_time_line&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;101004&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 12:55&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;订单已完成(商户)&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;100004&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商家已接单&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;100001&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;订单已支付&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;100000&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 09:09&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;创建订单&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_type&quot;</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;part_refund_support&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pay_display&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pay_status&quot;</span>: <span class=\"string\">&quot;已支付&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pc_order_label&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pick_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;expect_finish_time&quot;</span>: <span class=\"string\">&quot;02:58:15&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;pick_button&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;show&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;timestamp&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;privacy_phone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;range_status&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;real_status&quot;</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;real_status_desc&quot;</span>: <span class=\"string\">&quot;商家已经确认订单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refund_attribute&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refund_logs&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refund_req_info&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refuseButton&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;remind_undeal&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;remind_wait_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;responsible_party&quot;</span>: <span class=\"string\">&quot;暂无&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;self_order_completed_button&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;send_time&quot;</span>: <span class=\"string\">&quot;请10月13日 13:00送达&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;send_time_print&quot;</span>: <span class=\"string\">&quot;13日 13:00送达&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;service_phone&quot;</span>: <span class=\"string\">&quot;10105757&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;set_express&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;sex&quot;</span>: <span class=\"string\">&quot;女士&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shopPicked&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;location_shop&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;latitude&quot;</span>: <span class=\"string\">&quot;35**3**7&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;longitude&quot;</span>: <span class=\"string\">&quot;***4431E7&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;shop_address&quot;</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_name&quot;</span>: <span class=\"string\">&quot;**鲜花店&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_phone&quot;</span>: <span class=\"string\">&quot;13***65&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_user_distance&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_add_tip&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_cancel_button&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_know_button&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_shop_pack&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">9</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;status_desc&quot;</span>: <span class=\"string\">&quot; 已完结&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;supplier_id&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;supplier_name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;takeout_average_time&quot;</span>: <span class=\"number\">1602565200</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;takeout_phone&quot;</span>: <span class=\"string\">&quot;136****065&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;taxer_id&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;thirty_min_service&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;userTags&quot;</span>: [<span class=\"number\">2</span>],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_address&quot;</span>: <span class=\"string\">&quot;为了保护顾客隐私，隐藏地址信息&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_address_lat&quot;</span>: <span class=\"string\">&quot;30.890345&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_address_lng&quot;</span>: <span class=\"string\">&quot;104.261772&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_id&quot;</span>: <span class=\"string\">&quot;576192986&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_note&quot;</span>: <span class=\"string\">&quot;送给我好朋友的生日花，写几句祝福语，谢谢&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_order_num_str&quot;</span>: <span class=\"string\">&quot;超百次下单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_phone&quot;</span>: <span class=\"string\">&quot;177****7520&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_phone_call&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_phone_star&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_real_name&quot;</span>: <span class=\"string\">&quot;珊&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;vip_status&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;waimai_release_id&quot;</span>: <span class=\"string\">&quot;159766693&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;wxIconPath&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;wxNickname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;zone_tips_required&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_goods&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cart_num&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;goods_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;customer_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;ext&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;attr&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cart_id&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cold_chain&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;combo_attr&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;customer_total_discount&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;discount_desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;ext_code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;is_combo&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;process_label&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;product_index&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;property_label&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;shop_total_discount&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;store_attr&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;bar_code&quot;</span>: <span class=\"string\">&quot;wm367**65&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;category_name&quot;</span>: <span class=\"string\">&quot;爱情表白&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;shelf_position&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;sku_id&quot;</span>: <span class=\"string\">&quot;1597871782222488&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;unique_id&quot;</span>: <span class=\"string\">&quot;13***678&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;fix_weight&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;gift_info&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;gmids&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;hasgift&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;isNoReasonToReturn&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;isfreegift&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;【七夕专属】19朵红玫瑰礼盒+银叶&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;number&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;orig_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;orig_unit_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;printing_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;shop_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;shop_unit_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;total_weight&quot;</span>: <span class=\"number\">999</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;unique_id&quot;</span>: <span class=\"string\">&quot;130047***9119678&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;url&quot;</span>: <span class=\"string\">&quot;https://img.alic***i2/111483146/O1CN01wVILGS1Z6udgswHe4_!!111483146-0-***.jpg&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;weight&quot;</span>: <span class=\"number\">999</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;weight_can_update&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;weight_flag&quot;</span>: <span class=\"number\">2</span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;goods_total&quot;</span>: <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_meal_fee&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;包装费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_operations&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_sub_total&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;discount&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;formula_desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;number&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商品小计&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_total&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_price&quot;</span>: <span class=\"string\">&quot;100.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_title&quot;</span>: <span class=\"string\">&quot;本单顾客实际支付&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;number&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pay_type&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_price&quot;</span>: <span class=\"string\">&quot;85.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_price_final&quot;</span>: <span class=\"string\">&quot;85.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;预计收入&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title_after&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;total_desc&quot;</span>: <span class=\"string\">&quot;本单顾客实际支付100.00元&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;other_total_cost&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;5.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;其他费用合计&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;prescriptionDrugsInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;auditButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;prescriptionOrder&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;processMsg&quot;</span>: <span class=\"string\">&quot;系统正在处理中&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;prescription_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_prescription_order&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shop_other_discount&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_discount_list&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_discount_total&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;-0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_discount_list&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_discount_total&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;sub_total_desc&quot;</span>: <span class=\"string\">&quot;以上明细为商户承担的顾客优惠费用，最终订单收入请以对账单为准。&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商户其他优惠&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;takeout_cost&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;5.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;配送费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;10月13日&quot;</span></span><br><span class=\"line\">\t\t&#125;]</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;errmsg&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;errno&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;req_params&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;asap_type&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;end_timestamp&quot;</span>: <span class=\"string\">&quot;2020-10-16&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;is_asap&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;keyword&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;new_system&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;order_status&quot;</span>: <span class=\"number\">9</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;page&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;pageSize&quot;</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;shop_id&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;start_timestamp&quot;</span>: <span class=\"string\">&quot;2020-10-10&quot;</span></span><br><span class=\"line\">\t&#125;, &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;appVersion&quot;</span>: <span class=\"string\">&quot;2.2.3&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;authedSupplierIds&quot;</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;brand&quot;</span>: <span class=\"string\">&quot;samsung&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;channel&quot;</span>: <span class=\"string\">&quot;mobile&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;cuid&quot;</span>: <span class=\"string\">&quot;12B9828F9D0D3E389BA181D5A286A514|fw+G+2QPhBBAD8Yubtg6qGDX&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;from&quot;</span>: <span class=\"string\">&quot;android&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isBoss&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isManager&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isMobile&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isShop&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isSupplier&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;manager&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;bossUserId&quot;</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;pcVersion&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;roleInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;shopRoleId&quot;</span>: <span class=\"string\">&quot;159766693&quot;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;shopInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;eleId&quot;</span>: <span class=\"number\">159766693</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wid&quot;</span>: <span class=\"string\">&quot;159766693&quot;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;supplierInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;supplierId&quot;</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;userInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;loginRole&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;loginSubUserType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;loginUserId&quot;</span>: <span class=\"string\">&quot;1597***50001&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;phone&quot;</span>: <span class=\"string\">&quot;13***65&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;shopUserId&quot;</span>: <span class=\"string\">&quot;15973**001&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;userName&quot;</span>: <span class=\"string\">&quot;x***65&quot;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"4：Python程序\"><a href=\"#4：Python程序\" class=\"headerlink\" title=\"4：Python程序\"></a>4：Python程序</h1><p>对上述JSON数据进行分析，在Python中用json.load把JSON数据转化为字典和列表格式数据，方便我们提取信息。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> mitmproxy.http</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#顾客类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Customer</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,tel</span>):</span></span><br><span class=\"line\">        self.name = name </span><br><span class=\"line\">        self.tel = tel</span><br><span class=\"line\">       </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#商品类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Good</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,number,img</span>):</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.number = number</span><br><span class=\"line\">        self.img = img</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#订单类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Order</span>(<span class=\"params\">Customer</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods</span>):</span></span><br><span class=\"line\">        Customer.__init__(self,name,tel)</span><br><span class=\"line\">        self.addr_long = addr_long</span><br><span class=\"line\">        self.addr_latu = addr_latu</span><br><span class=\"line\">        self.note = note</span><br><span class=\"line\">        self.arri_time = arri_time</span><br><span class=\"line\">        self.order_id = order_id</span><br><span class=\"line\">        self.goods = goods</span><br><span class=\"line\">        self.platform = platform</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ElemeOrders</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.orders = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">response</span>(<span class=\"params\">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?&quot;</span> <span class=\"keyword\">in</span> flow.request.url:</span><br><span class=\"line\">            data = json.loads(flow.response.text)[<span class=\"string\">&quot;data&quot;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">for</span> total_order_list <span class=\"keyword\">in</span> data[<span class=\"string\">&#x27;total_order_list&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> order_list <span class=\"keyword\">in</span> total_order_list[<span class=\"string\">&#x27;order_list&#x27;</span>]:</span><br><span class=\"line\">                    goods = []</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> good <span class=\"keyword\">in</span> order_list[<span class=\"string\">&#x27;order_goods&#x27;</span>][<span class=\"string\">&#x27;goods_list&#x27;</span>]:</span><br><span class=\"line\">                        good_buffer = Good(good[<span class=\"string\">&#x27;name&#x27;</span>],good[<span class=\"string\">&#x27;number&#x27;</span>],good[<span class=\"string\">&#x27;url&#x27;</span>])</span><br><span class=\"line\">                        goods.append(good_buffer)</span><br><span class=\"line\">                    order = Order(<span class=\"string\">&#x27;eleme&#x27;</span>,order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_real_name&#x27;</span>]+order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;sex&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_phone&#x27;</span>],str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lng&#x27;</span>]),str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lat&#x27;</span>]),order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_note&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;takeout_average_time&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;order_id&#x27;</span>],goods)</span><br><span class=\"line\">                    self.orders.append(order)</span><br><span class=\"line\">            print(self.orders)</span><br></pre></td></tr></table></figure>\n\n<p>经过简单的测试，程序能够拿到完整的订单信息。一次性搞定，没有bug。</p>\n<p>在这个程序中，主要需要关注的是，Mitm类中的self.orders这个变量，可以看到，这个变量是一个列表，它包含了大于等于1个订单。每个订单，都是一个Order类的实例化，Order类中最后一个变量goods是一个列表，这个列表由多个实例化的Good类组成。因为一个订单可能包含多种商品。</p>\n<p>具体如何利用这些信息，还需要再Mitm()类中做修改。而提取单个订单类，比如第一个订单，直接使用<code>self.orders[0]</code>，要提取第一个订单中的第一件商品<code>self.orders[0].goods[0]</code>。</p>\n<p>其他的，比如第一个订单收货人：<code>self.orders[0].name</code></p>\n<p>第一个订单的第一件商品的名称：<code>self.orders[0].goods[0].name</code></p>\n<p>后续我可能会将它保存到数据库中，方便下次提取和修改信息。</p>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://blog.csdn.net/freeking101/article/details/83901842\">使用 mitmproxy + python 做拦截代理</a>》</p>\n<p>《<a href=\"https://www.weiney.com/2072.html\">APP爬虫入门，Appium+Mitmproxy强势组合实现抖音的数据爬取</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：简单说两句\"><a href=\"#1：简单说两句\" class=\"headerlink\" title=\"1：简单说两句\"></a>1：简单说两句</h1><p>这是我一个准备做的完整项目中的一个小部分。从很早以前，我就在思考，如何将美团和饿了么以及我自己做的小程序订单合并在一起，这样来实现统一的管理。。之所以要统一管理，是因为我母亲从事鲜花零售，在节假日里，会有大量的订单，而鲜花的包扎是个时间活。制作和配送，以及订单的处理，繁杂的程序会让人晕头转向。为了减轻我母亲的节假日压力，我想到了一些方法，来帮助她管理订单。</p>\n<p>完整的项目是，汇总小程序、美团、饿了么的订单。将订单返回的信息，通过处理，按配送时间排序，经过处理后通过企业微信api推送给微信。因为，花店的配送人员都是我母亲找的，他们受教育程度低，有的因为不识字，连导航都不会用。所以，需要把订单的位置信息，通过百度地图api转为url发送给配送员。另外，还可以制作一个程序，在程序上实时更新，新订单。。每当一束花被做好，我母亲就可从程序中将该订单从等待制作的列表中移除。。每当，有一个订单被送出，也可在程序上控制美团等客户端发送对应消息。</p>\n<p>这一切都是非常美好的，对零售商家的体验会非常友好。但是，因为我无法取得美团和饿了么的开发者资格，也就拿不到他们的接口授权。。于是，我想到了，利用利用mitmproxy获取美团饿了么的订单信息。通过appium自动化控制手机。无论是mitmrpoxy还是appium对python程序都是非常友好的。</p>\n<p>那么现在开始我的第一步，利用mitmproxy爬取饿了么零售商家版订单信息。</p>\n<h1 id=\"2：mitmproxy安装与使用\"><a href=\"#2：mitmproxy安装与使用\" class=\"headerlink\" title=\"2：mitmproxy安装与使用\"></a>2：mitmproxy安装与使用</h1><p><strong>安装</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install mitmproxy</span><br></pre></td></tr></table></figure>\n\n<p><strong>开启</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mitmweb</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">或者mitmproxy mitmdump</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>与python配合</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mitmdump -s eleme.py</span><br></pre></td></tr></table></figure>\n\n<p><strong>手机使用mitmproxy开启的代理</strong>：</p>\n<p>更改wifi高级设置里的代理模式为手动，主机填写mitmproxy运行的电脑局域网ip。可通过ifconfig查看。</p>\n<p>端口为8080</p>\n<p>此时打开baidu.com会提示不安全，而且mitmproxy应该开始记录了。</p>\n<p>手机打开网页<code>mitm.it</code>下载对应系统的证书文件。安卓下载后直接安装。。</p>\n<p>再上网就不会提示不安全了。</p>\n<h1 id=\"3：响应内容\"><a href=\"#3：响应内容\" class=\"headerlink\" title=\"3：响应内容\"></a>3：响应内容</h1><p>在开启mitmweb后，从打开的网页上可以观察到手机的整个数据流，在手机上刷新订单页，就能截获饿了么发送回来的订单信息。</p>\n<p>将响应内容提取出来，并把JSON数据格式化，部分关键信息已打码。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">&quot;data&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;curr_page&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;order_count&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;page_count&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;page_size&quot;</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;total_order_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;mills&quot;</span>: <span class=\"number\">1602518400000</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;order_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;cold_chain_cost&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;冷链服务费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;compensationInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;enableCompensable&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;timeRemaining&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;extract_commission&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;brief_desc&quot;</span>: <span class=\"string\">&quot;请以结算账单为准&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;commission_total&quot;</span>: <span class=\"string\">&quot;15.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;抽取佣金&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;goods_discount&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;discount_account&quot;</span>: <span class=\"string\">&quot;-￥3.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;discount_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;hasLineBelow&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;￥3.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商家配送费补贴&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;￥3.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;小计&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商户补贴金额&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;hasLineBelow&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;配送费满减&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;(商家补贴:￥3.00元)&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;活动明细&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;顾客优惠合计&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_discount_account&quot;</span>: <span class=\"string\">&quot;-￥3.00&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;grayInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;hummingBirdGray&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;orderSettle&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;baseLogisticsAmt&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;baseLogisticsDesc&quot;</span>: <span class=\"string\">&quot;本单收取固定物流费&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;commissionAmt&quot;</span>: <span class=\"string\">&quot;15.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;commissionDesc&quot;</span>: <span class=\"string\">&quot;请以结算账单为准&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shopInAmount&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_basic&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;apply_cancel_feed&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;feed_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 12:55&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;订单已完成(商户)&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;商家已接单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;订单已支付&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_content&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_extra&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_time&quot;</span>: <span class=\"string\">&quot;10月13日 09:09&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cancel_title&quot;</span>: <span class=\"string\">&quot;创建订单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;end_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;left_time_show&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;refund_price&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class=\"line\">\t\t\t\t\t\t&#125;]</span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;apply_cancel_status&quot;</span>: <span class=\"number\">886</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;auto_confirm_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;batch&quot;</span>: <span class=\"number\">2000000000000000001</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;business_type&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;call_delivery_delay&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cancel_reason&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cancel_reason_explain&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cancel_reason_status&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;check_out_button&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;city_name&quot;</span>: <span class=\"string\">&quot;成都市&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;confirmButton&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;confirm_time&quot;</span>: <span class=\"string\">&quot;1602551413&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;create_time&quot;</span>: <span class=\"string\">&quot;1602551397&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_delay_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_exception_code&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_exception_state&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_party&quot;</span>: <span class=\"string\">&quot;self&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_staff_phone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_state&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_state_desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;delivery_tip_amount&quot;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;distance&quot;</span>: <span class=\"string\">&quot;&lt;1.8千米&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;due_deliver_time_by_ofc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;ele_fengniao_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_fengniao_call_again&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_fengniao_switch_self&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;no_delivery&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;ele_zhongbao_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;delivery_fee&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_show&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;op_status&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;eleme_finish_refund&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;eleme_order_id&quot;</span>: <span class=\"string\">&quot;5009809679236497411&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;evoip_order&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;express_company&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;express_id&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;feed_to_show&quot;</span>: <span class=\"string\">&quot;order_log&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;finished_time&quot;</span>: <span class=\"string\">&quot;1602564946&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;gift_greeting&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;gift_phone&quot;</span>: <span class=\"string\">&quot;13***502&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;hbirdRunErrandsInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;addTipsButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;callButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;cancelCallButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;payType&quot;</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;idempotentId&quot;</span>: <span class=\"string\">&quot;20201017025815254005000100027411822742&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;invoice_price&quot;</span>: <span class=\"string\">&quot;100.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;invoice_title&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_alipay_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_baidu_logistics&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_can_auto_confirm&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_city_delivery&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_cold_order&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_compensation_show&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_cook_overtime&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_from_tp_new_retail&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_print&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_privacy_hide&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_ranger_show&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_show_express&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;ivr_tip&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;meal_num&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;need_invoice&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;orderUserPhone&quot;</span>: <span class=\"string\">&quot;136****3502&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;orderUserPrivacyPhone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_from&quot;</span>: <span class=\"string\">&quot;2&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_id&quot;</span>: <span class=\"string\">&quot;50098***97411&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_index&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_list_type&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_cancel&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_exception&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_new&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_remind&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_reserve&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;is_user_part_refund&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_time_line&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;101004&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 12:55&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;订单已完成(商户)&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;100004&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商家已接单&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;100001&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 09:10&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;订单已支付&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;, &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;code&quot;</span>: <span class=\"string\">&quot;100000&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;time&quot;</span>: <span class=\"string\">&quot;10/13 09:09&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;创建订单&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;order_type&quot;</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;part_refund_support&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pay_display&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pay_status&quot;</span>: <span class=\"string\">&quot;已支付&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pc_order_label&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pick_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;expect_finish_time&quot;</span>: <span class=\"string\">&quot;02:58:15&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;left_time&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;pick_button&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;show&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;timestamp&quot;</span>: <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;privacy_phone&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;range_status&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;real_status&quot;</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;real_status_desc&quot;</span>: <span class=\"string\">&quot;商家已经确认订单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refund_attribute&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refund_logs&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refund_req_info&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;refuseButton&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;remind_undeal&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;remind_wait_time&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;responsible_party&quot;</span>: <span class=\"string\">&quot;暂无&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;self_order_completed_button&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;send_time&quot;</span>: <span class=\"string\">&quot;请10月13日 13:00送达&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;send_time_print&quot;</span>: <span class=\"string\">&quot;13日 13:00送达&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;service_phone&quot;</span>: <span class=\"string\">&quot;10105757&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;set_express&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;sex&quot;</span>: <span class=\"string\">&quot;女士&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shopPicked&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;location_shop&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;latitude&quot;</span>: <span class=\"string\">&quot;35**3**7&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;longitude&quot;</span>: <span class=\"string\">&quot;***4431E7&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;shop_address&quot;</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_name&quot;</span>: <span class=\"string\">&quot;**鲜花店&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_phone&quot;</span>: <span class=\"string\">&quot;13***65&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_user_distance&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_add_tip&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_cancel_button&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_know_button&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;show_shop_pack&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">9</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;status_desc&quot;</span>: <span class=\"string\">&quot; 已完结&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;supplier_id&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;supplier_name&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;takeout_average_time&quot;</span>: <span class=\"number\">1602565200</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;takeout_phone&quot;</span>: <span class=\"string\">&quot;136****065&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;taxer_id&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;thirty_min_service&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;userTags&quot;</span>: [<span class=\"number\">2</span>],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_address&quot;</span>: <span class=\"string\">&quot;为了保护顾客隐私，隐藏地址信息&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_address_lat&quot;</span>: <span class=\"string\">&quot;30.890345&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_address_lng&quot;</span>: <span class=\"string\">&quot;104.261772&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_id&quot;</span>: <span class=\"string\">&quot;576192986&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_note&quot;</span>: <span class=\"string\">&quot;送给我好朋友的生日花，写几句祝福语，谢谢&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_order_num_str&quot;</span>: <span class=\"string\">&quot;超百次下单&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_phone&quot;</span>: <span class=\"string\">&quot;177****7520&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_phone_call&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_phone_star&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;user_real_name&quot;</span>: <span class=\"string\">&quot;珊&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;vip_status&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;waimai_release_id&quot;</span>: <span class=\"string\">&quot;159766693&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;wxIconPath&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;wxNickname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;zone_tips_required&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_goods&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;cart_num&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;goods_list&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;customer_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;ext&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;attr&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cart_id&quot;</span>: <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;cold_chain&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;combo_attr&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;customer_total_discount&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;discount_desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;ext_code&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;is_combo&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;process_label&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;product_index&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;property_label&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;shop_total_discount&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;store_attr&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;bar_code&quot;</span>: <span class=\"string\">&quot;wm367**65&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;category_name&quot;</span>: <span class=\"string\">&quot;爱情表白&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;shelf_position&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"attr\">&quot;sku_id&quot;</span>: <span class=\"string\">&quot;1597871782222488&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"attr\">&quot;unique_id&quot;</span>: <span class=\"string\">&quot;13***678&quot;</span></span><br><span class=\"line\">\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;fix_weight&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;gift_info&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;gmids&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;hasgift&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;isNoReasonToReturn&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;isfreegift&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;【七夕专属】19朵红玫瑰礼盒+银叶&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;number&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;orig_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;orig_unit_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;printing_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;shop_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;shop_unit_price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;total_weight&quot;</span>: <span class=\"number\">999</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;unique_id&quot;</span>: <span class=\"string\">&quot;130047***9119678&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;url&quot;</span>: <span class=\"string\">&quot;https://img.alic***i2/111483146/O1CN01wVILGS1Z6udgswHe4_!!111483146-0-***.jpg&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;weight&quot;</span>: <span class=\"number\">999</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;weight_can_update&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">&quot;weight_flag&quot;</span>: <span class=\"number\">2</span></span><br><span class=\"line\">\t\t\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;goods_total&quot;</span>: <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_meal_fee&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;包装费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_operations&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_sub_total&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;discount&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;formula_desc&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;number&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;98.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商品小计&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;order_total&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_price&quot;</span>: <span class=\"string\">&quot;100.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_title&quot;</span>: <span class=\"string\">&quot;本单顾客实际支付&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;number&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;pay_type&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_price&quot;</span>: <span class=\"string\">&quot;85.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_price_final&quot;</span>: <span class=\"string\">&quot;85.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;预计收入&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title_after&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;total_desc&quot;</span>: <span class=\"string\">&quot;本单顾客实际支付100.00元&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;other_total_cost&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;5.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;其他费用合计&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;prescriptionDrugsInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;auditButton&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;prescriptionOrder&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;processMsg&quot;</span>: <span class=\"string\">&quot;系统正在处理中&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;prescription_info&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;is_prescription_order&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;shop_other_discount&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_discount_list&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;customer_discount_total&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;-0.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_discount_list&quot;</span>: [],</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;shop_discount_total&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;sub_total_desc&quot;</span>: <span class=\"string\">&quot;以上明细为商户承担的顾客优惠费用，最终订单收入请以对账单为准。&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;商户其他优惠&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;takeout_cost&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;price&quot;</span>: <span class=\"string\">&quot;5.00&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;配送费&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;],</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;title&quot;</span>: <span class=\"string\">&quot;10月13日&quot;</span></span><br><span class=\"line\">\t\t&#125;]</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;errmsg&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;errno&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;req_params&quot;</span>: [&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;asap_type&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;end_timestamp&quot;</span>: <span class=\"string\">&quot;2020-10-16&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;is_asap&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;keyword&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;new_system&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;order_status&quot;</span>: <span class=\"number\">9</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;page&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;pageSize&quot;</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;shop_id&quot;</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;start_timestamp&quot;</span>: <span class=\"string\">&quot;2020-10-10&quot;</span></span><br><span class=\"line\">\t&#125;, &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;appVersion&quot;</span>: <span class=\"string\">&quot;2.2.3&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;authedSupplierIds&quot;</span>: [],</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;brand&quot;</span>: <span class=\"string\">&quot;samsung&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;channel&quot;</span>: <span class=\"string\">&quot;mobile&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;cuid&quot;</span>: <span class=\"string\">&quot;12B9828F9D0D3E389BA181D5A286A514|fw+G+2QPhBBAD8Yubtg6qGDX&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;from&quot;</span>: <span class=\"string\">&quot;android&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isBoss&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isManager&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isMobile&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isShop&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;isSupplier&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;manager&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;bossUserId&quot;</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;pcVersion&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;roleInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;shopRoleId&quot;</span>: <span class=\"string\">&quot;159766693&quot;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;shopInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;eleId&quot;</span>: <span class=\"number\">159766693</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;wid&quot;</span>: <span class=\"string\">&quot;159766693&quot;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;supplierInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;supplierId&quot;</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;userInfo&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;loginRole&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;loginSubUserType&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;loginUserId&quot;</span>: <span class=\"string\">&quot;1597***50001&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;phone&quot;</span>: <span class=\"string\">&quot;13***65&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;shopUserId&quot;</span>: <span class=\"string\">&quot;15973**001&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;userName&quot;</span>: <span class=\"string\">&quot;x***65&quot;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"4：Python程序\"><a href=\"#4：Python程序\" class=\"headerlink\" title=\"4：Python程序\"></a>4：Python程序</h1><p>对上述JSON数据进行分析，在Python中用json.load把JSON数据转化为字典和列表格式数据，方便我们提取信息。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> mitmproxy.http</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#顾客类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Customer</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,tel</span>):</span></span><br><span class=\"line\">        self.name = name </span><br><span class=\"line\">        self.tel = tel</span><br><span class=\"line\">       </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#商品类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Good</span>(<span class=\"params\">object</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,name,number,img</span>):</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.number = number</span><br><span class=\"line\">        self.img = img</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#订单类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Order</span>(<span class=\"params\">Customer</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods</span>):</span></span><br><span class=\"line\">        Customer.__init__(self,name,tel)</span><br><span class=\"line\">        self.addr_long = addr_long</span><br><span class=\"line\">        self.addr_latu = addr_latu</span><br><span class=\"line\">        self.note = note</span><br><span class=\"line\">        self.arri_time = arri_time</span><br><span class=\"line\">        self.order_id = order_id</span><br><span class=\"line\">        self.goods = goods</span><br><span class=\"line\">        self.platform = platform</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ElemeOrders</span>():</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        self.orders = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">response</span>(<span class=\"params\">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?&quot;</span> <span class=\"keyword\">in</span> flow.request.url:</span><br><span class=\"line\">            data = json.loads(flow.response.text)[<span class=\"string\">&quot;data&quot;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">for</span> total_order_list <span class=\"keyword\">in</span> data[<span class=\"string\">&#x27;total_order_list&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> order_list <span class=\"keyword\">in</span> total_order_list[<span class=\"string\">&#x27;order_list&#x27;</span>]:</span><br><span class=\"line\">                    goods = []</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> good <span class=\"keyword\">in</span> order_list[<span class=\"string\">&#x27;order_goods&#x27;</span>][<span class=\"string\">&#x27;goods_list&#x27;</span>]:</span><br><span class=\"line\">                        good_buffer = Good(good[<span class=\"string\">&#x27;name&#x27;</span>],good[<span class=\"string\">&#x27;number&#x27;</span>],good[<span class=\"string\">&#x27;url&#x27;</span>])</span><br><span class=\"line\">                        goods.append(good_buffer)</span><br><span class=\"line\">                    order = Order(<span class=\"string\">&#x27;eleme&#x27;</span>,order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_real_name&#x27;</span>]+order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;sex&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_phone&#x27;</span>],str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lng&#x27;</span>]),str(order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_address_lat&#x27;</span>]),order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;user_note&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;takeout_average_time&#x27;</span>],order_list[<span class=\"string\">&#x27;order_basic&#x27;</span>][<span class=\"string\">&#x27;order_id&#x27;</span>],goods)</span><br><span class=\"line\">                    self.orders.append(order)</span><br><span class=\"line\">            print(self.orders)</span><br></pre></td></tr></table></figure>\n\n<p>经过简单的测试，程序能够拿到完整的订单信息。一次性搞定，没有bug。</p>\n<p>在这个程序中，主要需要关注的是，Mitm类中的self.orders这个变量，可以看到，这个变量是一个列表，它包含了大于等于1个订单。每个订单，都是一个Order类的实例化，Order类中最后一个变量goods是一个列表，这个列表由多个实例化的Good类组成。因为一个订单可能包含多种商品。</p>\n<p>具体如何利用这些信息，还需要再Mitm()类中做修改。而提取单个订单类，比如第一个订单，直接使用<code>self.orders[0]</code>，要提取第一个订单中的第一件商品<code>self.orders[0].goods[0]</code>。</p>\n<p>其他的，比如第一个订单收货人：<code>self.orders[0].name</code></p>\n<p>第一个订单的第一件商品的名称：<code>self.orders[0].goods[0].name</code></p>\n<p>后续我可能会将它保存到数据库中，方便下次提取和修改信息。</p>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://blog.csdn.net/freeking101/article/details/83901842\">使用 mitmproxy + python 做拦截代理</a>》</p>\n<p>《<a href=\"https://www.weiney.com/2072.html\">APP爬虫入门，Appium+Mitmproxy强势组合实现抖音的数据爬取</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Oct 18 2020 17:11:16 GMT+0200 (GMT+02:00)","title":"外卖平台订单爬取之饿了么零售商家版","path":"2020/10/16/外卖平台订单爬取之饿了么零售商家版/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-10-16T21:46:27.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-10-16T21:46:27.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"爬虫","tags":["Python","Mitmproxy"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"如何利用ADB开发王者荣耀外挂","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-10-24T09:51:01.000Z","password":null,"summary":null,"_content":"\n# 1：思路\n\nADB全称安卓设备调试工具，是谷歌官方提供帮助安卓开发者调试自身应用的一个轻量级工具包，总大小只有几兆。通过shell指令可以实现对安装了安卓系统的手机进行控制，包括开关机，开关应用程序，控制屏幕、音量、相机等操作。利用ADB控制屏幕的功能，可以通过程序来实现快速换装、婉儿一键上天等操作。由于ADB是一种模拟人在屏幕上操作的工具，不会修改王者荣耀的内部文件，也不用root手机，所有是不会被王者荣耀检测到，也不会被封号。只需要简单配置让安装了ADB的电脑连接手机，即可实现程序控制王者角色。因为ADB支持通过TCP/IP协议，可以让电脑脱离数据线远程调试手机。\n\n**那么这个外挂完整的工作过程是什么样的呢？**\n\n1. 在电脑上安装ADB工具，并将其目录放到系统环境或用户环境变量中。开启手机的USB调试功能，通过ADB远程调试功能连接手机。\n\n2. 编写一个安卓应用程序，程序使用安卓的悬浮窗功能。在王者荣耀面板上层悬浮一个按钮。点击按钮，发送一个http的get请求。\n\n3. 在安装了ADB的电脑上安装一个http服务器用于接收悬浮按钮发送的get请求。简单的http服务器是基于python内自带的http server。\n\n4. http服务器接收到请求后，执行已经写好的ADB指令，控制手机，实现婉儿一键上天。\n\n看看使用效果吧！\n\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n    <iframe src=\"//player.bilibili.com/player.html?aid=415048053&bvid=BV18V411y7rw&cid=249226194&page=1&high_quality=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\">\n    </iframe>\n</div>\n\n# 2：ADB工具及调试手机\n\n## 2.1 下载ADB\n\n在网上下载ADB工具包：[下载地址](https://developer.android.com/studio/releases/platform-tools)（需要连接外网）\n\n解压后，获得一个名为`platform-tools`的工具包，包内含有`adb.exe`程序，即为安卓调试工具。\n\n## 2.2 设置环境\n\n在windows中搜索`huanjing`打开环境变量面板。\n\n![](https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png)\n\n依次点击`环境变量`，点击系统变量下的名为`Path`的一行，点击`编辑`.\n\n![](https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png)\n\n点击新建，将`platform-tools`文件夹的完整路径添加到变量中，例：我的工具包存放在`C:\\Users\\9752\\.AndroidStudio3.5\\platform-tools`\n\n点击`确认`，然后关闭此窗口。\n\n在windows中搜索`cmd`，打开终端窗口，输入`adb`回车。\n\n![](https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png)\n\n出现上文，则配置成功。\n\n## 2.3 连接手机\n\n**打开手机开发者模式**\n\n通常是手机设置中，找到版本信息或者内核信息，然后点击七下，在设置中就会出现开发者模式了。具体方法可以自行谷歌。\n\n打开开发者模式的`USB调试`\n\n通过**原装**数据线连接电脑，**有的非原装数据线只能充电不能传输数据**。\n\n连接电脑后，需要在手机上允许此电脑调试，最好一律允许此电脑调试。\n\n在终端中输入`adb devices`查看是否连接上了手机。\n\n## 2.4 开启远程调试\n\n> 也可不用远程，直接使用数据线也是可以的。\n\n让手机和电脑处在相同的WiFi下\n\n电脑通过数据线连接手机后，终端输入\n\n```shell\nadb tcpip 5555\n```\n\n拔掉数据线。在WiFi设置里，查看手机的局域网ip地址，通常是`192.168.xxx.xxx`，或者`10.xxx.xxx.xxx`\n\n修改为你的手机ip地址，连接手机：\n\n```shell\nadb connect 192.168.xxx.xxx:5555\n```\n\n## 2.5 主要用到的ADB指令\n\n```shell\n// 模拟点击，屏幕上横坐标纵坐标分别为100 120的位置\n// 要查看具体坐标值，可以打开开发者选项->指针位置\nadb shell input tap 100 120\n\n// 模拟滑动，从位置（0,1000）滑动到(800,600)\nadb shell input swipe 0 1000 800 600\n\n// 模拟长按，在位置（100,200）长按500毫秒\nadb shell input swipe 100 200 100 200 500// 开启adb服务\n```\n\n其中位置信息，需要在手机上获取。\n\n在**开发者模式**中打开**显示指针**\n\n通过按住屏幕，就能实时显示按压住的位置的x轴和y轴信息。\n\n此时已经可以尝试用ADB指令控制屏幕了。\n\n## 2.6 控制婉儿上天\n\n不同的手机，需要自己寻找合适的坐标点来实现婉儿的技能释放。\n\n```shell\n向前移动：abd shell input swipe 450 1105 544 983 600\n向后移动：adb shell input swipe 450 1105 217 1400 800\n普工：adb shell input tap 2726 1226\n一技能：adb shell input swipe 2290 1267 2748 790 100\n二技能：adb shell input swipe 2451 1010 2793 670 100\n三技能：adb shell input swipe 2721 860 2721 860 200\n\n向前直线上天：adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2748 790 100&&input swipe 450 1105 743 781 1000\"\n原地上天：adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2100 1376 100&&input swipe 450 1105 217 1400 800&&input swipe 450 1105 777 1150 500\"\n```\n\n## 2.7 一键换装\n\n```shell\n打开商店： adb shell input tap 2873 102\n装备： adb shell input tap 2173 1278\n出售： adb shell input tap 2525 1153\n关闭商店： adb shell input tap 2624 167\n购买预选：adb shell input tap 2832 243\n完整操作链：adb shell \"input tap 2873 102&&input tap 2173 1278&&input tap 2525 1153&&input tap 2624 167&&input tap 2832 243\"\n```\n\n# 3：搭建http服务器\n\n在电脑上安装好python环境。\n\n新建一个`takeoff.py`文件。编辑文件：\n\n```python\nimport os\nfrom http.server import BaseHTTPRequestHandler\nfrom urllib import parse\n\nclass GetHandler(BaseHTTPRequestHandler):\n\n    def do_GET(self):\n        parsed_path = parse.urlparse(self.path)\n        query = parse.parse_qs(parsed_path.query)\n        if query['skill'][0] == '1':\n            os.system('adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2748 790 100&&input swipe 450 1105 743 781 1000\"')\n            message = '执行直线起飞指令'\n        elif query['skill'][0] == '2':\n            os.system('adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2100 1376 100&&input swipe 450 1105 217 1400 800&&input swipe 450 1105 777 1150 500\"')\n            message = '执行原地起飞指令'\n        elif query['skill'][0] == '3':\n            os.system('adb shell \"input tap 2873 102&&input tap 2173 1278&&input tap 2525 1153&&input tap 2624 167&&input tap 2832 243\"')\n            message = '执行快速换装指令'\n        else:\n            message = '无指令运行'\n        self.send_response(200)\n        self.send_header('Content-Type',\n                         'text/plain; charset=utf-8')\n        self.end_headers()\n        self.wfile.write(message.encode('utf-8'))\n\nif __name__ == '__main__':\n    from http.server import HTTPServer\n    server = HTTPServer(('0.0.0.0', 9797), GetHandler)\n    print('服务器启动成功, 使用<Ctrl-C> 来停止。。')\n    server.serve_forever()\n```\n\n需要将`os.system()`中的**内容替换为自己**的。\n\n> 修改上面的程序很重要，因为不同分辨率手机，需要的adb指令是不一样的，如果不修改，基本上不可能会实现理想的操作，除非你跟我用的相同的手机，三星S10+。\n\n通过python运行这个文件就已经建立好了http服务器。\n\n```shell\npython3 filepath/takeoff.py\n#filepath修改为takeoff.py的路径。比如C:/Users/999/Desktop/takeoff.py\n#显示，服务器启动成功, 使用<Ctrl-C> 来停止。。则启动成功\n```\n\n查看电脑的局域网ip地址，终端输入\n\n```shell\nipconfig\n```\n\n通常是`192.168.xxx.xxx`，或者`10.xxx.xxx.xxx`\n\n在电脑浏览器中，访问：`192.168.xxx.xxx:9797/?skill=1`就能实现直线上天了。skill =2和skill=3分别对应原地上天和一键换装。\n\n此时，如果在手机浏览器上访问`192.168.xxx.xxx:9797/?skill=1`，应该是访问不通的，因为windows自带的防火墙，是不允许局域网下的其他设备访问未开放的端口的。你需要**关闭局域网防火墙**。\n\n> 关闭防火墙是存在一定风险的，如果你用的公共场所的WiFi，我建议不要关闭。如果是家庭WiFi，记得在使用完后再次开启防火墙。\n\nwindows搜索`fanghuoqiang`注意不要用汉字搜索，用拼音。打开**防火墙和网络保护**\n\n如果是家庭WiFi，则点击专用网络。\n\n![](https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png)\n\n将防火墙**关闭**。\n\n此时在手机浏览器上也能访问到http服务器了。\n\n# 4：王者局内悬浮按钮\n\n新建一个安卓项目，开发一个悬浮按钮，在王者内点击按钮，就能给http服务器发送请求，然后服务器通过adb再返过来控制局内角色。\n\n开发新项目，我直接选择站在巨人肩膀上。https://github.com/dongzhong/TestForFloatingWindow 直接对这个仓库里提供的悬浮窗功能进行修改。。关键程序如下：\n\n```java\n//FloatingButtonService2.java\nprivate void showFloatingWindow() {\n        if (Settings.canDrawOverlays(this)) {\n            button2 = new Button(getApplicationContext());\n            button2.setText(\"装\");//按键上的字，表示按下这个按钮一键换装\n            button2.setBackgroundColor(Color.argb(120,0,255,0));\n            windowManager.addView(button2, layoutParams);\n            button2.setOnClickListener(new View.OnClickListener() {\n                @Override\n                public void onClick(View v) {\n                    send();\n                }\n            });\n            button2.setOnTouchListener(new FloatingOnTouchListener());\n\n        }\n    }\n    private void send() {\n        //开启线程，发送get请求\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                //value对应http服务器接收的技能\n                //在http服务器中，设置的，skill=1，直线上天，skill=2，原地上天，skill=3，换装\n                char value = '3';\n                //这里修改为http服务器地址。\n                String path = \"http://192.168.0.109:9797/?skill=\"+value;\n                try {\n                    URL url = new URL(path);\n                    HttpURLConnection conn = (HttpURLConnection) url.openConnection();\n                    conn.setRequestMethod(\"GET\");\n                    InputStream in = conn.getInputStream();\n                    conn.disconnect();\n                } catch (MalformedURLException e) {\n                    e.printStackTrace();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n\n            }\n        }).start();\n    }\n```\n\n这只是其中一个一键换装的按钮，另外还需要修改一键上天的按钮。在`FloatingButtonService.java`中，两个程序，都相似。。修改完后，直接编译，就可以使用了。\n\n完整的项目地址：https://github.com/xieqifei/Expandskill\n\n安卓项目，可以直接通过git克隆\n\n```shell\ngit clone https://github.com/xieqifei/Expandskill.git\n```\n\n修改程序后，直接编译即可。\n\n# 5：参考资料\n\n《[android adb常用命令收集](https://www.jianshu.com/p/85066854c9e6)》\n\n《[Android adb远程调试](https://blog.csdn.net/u012785382/article/details/79171782)》\n\n《[http.server — 实现 Web 服务器的基础类](https://learnku.com/docs/pymotw/httpserver-base-classes-for-implementing-web-servers/3436)》\n\n《[Android HTTP请求方式:HttpURLConnection](https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html)》\n\n《[Android悬浮窗的实现](https://blog.csdn.net/dongzhong1990/article/details/80512706)》","source":"_posts/如何利用ADB开发王者荣耀外挂.md","raw":"---\ntitle: 如何利用ADB开发王者荣耀外挂\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-10-24 11:51:01\npassword:\nsummary:\ntags:\n- ADB\n- Python\n- Java\ncategories: 安卓编程\n---\n\n# 1：思路\n\nADB全称安卓设备调试工具，是谷歌官方提供帮助安卓开发者调试自身应用的一个轻量级工具包，总大小只有几兆。通过shell指令可以实现对安装了安卓系统的手机进行控制，包括开关机，开关应用程序，控制屏幕、音量、相机等操作。利用ADB控制屏幕的功能，可以通过程序来实现快速换装、婉儿一键上天等操作。由于ADB是一种模拟人在屏幕上操作的工具，不会修改王者荣耀的内部文件，也不用root手机，所有是不会被王者荣耀检测到，也不会被封号。只需要简单配置让安装了ADB的电脑连接手机，即可实现程序控制王者角色。因为ADB支持通过TCP/IP协议，可以让电脑脱离数据线远程调试手机。\n\n**那么这个外挂完整的工作过程是什么样的呢？**\n\n1. 在电脑上安装ADB工具，并将其目录放到系统环境或用户环境变量中。开启手机的USB调试功能，通过ADB远程调试功能连接手机。\n\n2. 编写一个安卓应用程序，程序使用安卓的悬浮窗功能。在王者荣耀面板上层悬浮一个按钮。点击按钮，发送一个http的get请求。\n\n3. 在安装了ADB的电脑上安装一个http服务器用于接收悬浮按钮发送的get请求。简单的http服务器是基于python内自带的http server。\n\n4. http服务器接收到请求后，执行已经写好的ADB指令，控制手机，实现婉儿一键上天。\n\n看看使用效果吧！\n\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n    <iframe src=\"//player.bilibili.com/player.html?aid=415048053&bvid=BV18V411y7rw&cid=249226194&page=1&high_quality=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\">\n    </iframe>\n</div>\n\n# 2：ADB工具及调试手机\n\n## 2.1 下载ADB\n\n在网上下载ADB工具包：[下载地址](https://developer.android.com/studio/releases/platform-tools)（需要连接外网）\n\n解压后，获得一个名为`platform-tools`的工具包，包内含有`adb.exe`程序，即为安卓调试工具。\n\n## 2.2 设置环境\n\n在windows中搜索`huanjing`打开环境变量面板。\n\n![](https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png)\n\n依次点击`环境变量`，点击系统变量下的名为`Path`的一行，点击`编辑`.\n\n![](https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png)\n\n点击新建，将`platform-tools`文件夹的完整路径添加到变量中，例：我的工具包存放在`C:\\Users\\9752\\.AndroidStudio3.5\\platform-tools`\n\n点击`确认`，然后关闭此窗口。\n\n在windows中搜索`cmd`，打开终端窗口，输入`adb`回车。\n\n![](https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png)\n\n出现上文，则配置成功。\n\n## 2.3 连接手机\n\n**打开手机开发者模式**\n\n通常是手机设置中，找到版本信息或者内核信息，然后点击七下，在设置中就会出现开发者模式了。具体方法可以自行谷歌。\n\n打开开发者模式的`USB调试`\n\n通过**原装**数据线连接电脑，**有的非原装数据线只能充电不能传输数据**。\n\n连接电脑后，需要在手机上允许此电脑调试，最好一律允许此电脑调试。\n\n在终端中输入`adb devices`查看是否连接上了手机。\n\n## 2.4 开启远程调试\n\n> 也可不用远程，直接使用数据线也是可以的。\n\n让手机和电脑处在相同的WiFi下\n\n电脑通过数据线连接手机后，终端输入\n\n```shell\nadb tcpip 5555\n```\n\n拔掉数据线。在WiFi设置里，查看手机的局域网ip地址，通常是`192.168.xxx.xxx`，或者`10.xxx.xxx.xxx`\n\n修改为你的手机ip地址，连接手机：\n\n```shell\nadb connect 192.168.xxx.xxx:5555\n```\n\n## 2.5 主要用到的ADB指令\n\n```shell\n// 模拟点击，屏幕上横坐标纵坐标分别为100 120的位置\n// 要查看具体坐标值，可以打开开发者选项->指针位置\nadb shell input tap 100 120\n\n// 模拟滑动，从位置（0,1000）滑动到(800,600)\nadb shell input swipe 0 1000 800 600\n\n// 模拟长按，在位置（100,200）长按500毫秒\nadb shell input swipe 100 200 100 200 500// 开启adb服务\n```\n\n其中位置信息，需要在手机上获取。\n\n在**开发者模式**中打开**显示指针**\n\n通过按住屏幕，就能实时显示按压住的位置的x轴和y轴信息。\n\n此时已经可以尝试用ADB指令控制屏幕了。\n\n## 2.6 控制婉儿上天\n\n不同的手机，需要自己寻找合适的坐标点来实现婉儿的技能释放。\n\n```shell\n向前移动：abd shell input swipe 450 1105 544 983 600\n向后移动：adb shell input swipe 450 1105 217 1400 800\n普工：adb shell input tap 2726 1226\n一技能：adb shell input swipe 2290 1267 2748 790 100\n二技能：adb shell input swipe 2451 1010 2793 670 100\n三技能：adb shell input swipe 2721 860 2721 860 200\n\n向前直线上天：adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2748 790 100&&input swipe 450 1105 743 781 1000\"\n原地上天：adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2100 1376 100&&input swipe 450 1105 217 1400 800&&input swipe 450 1105 777 1150 500\"\n```\n\n## 2.7 一键换装\n\n```shell\n打开商店： adb shell input tap 2873 102\n装备： adb shell input tap 2173 1278\n出售： adb shell input tap 2525 1153\n关闭商店： adb shell input tap 2624 167\n购买预选：adb shell input tap 2832 243\n完整操作链：adb shell \"input tap 2873 102&&input tap 2173 1278&&input tap 2525 1153&&input tap 2624 167&&input tap 2832 243\"\n```\n\n# 3：搭建http服务器\n\n在电脑上安装好python环境。\n\n新建一个`takeoff.py`文件。编辑文件：\n\n```python\nimport os\nfrom http.server import BaseHTTPRequestHandler\nfrom urllib import parse\n\nclass GetHandler(BaseHTTPRequestHandler):\n\n    def do_GET(self):\n        parsed_path = parse.urlparse(self.path)\n        query = parse.parse_qs(parsed_path.query)\n        if query['skill'][0] == '1':\n            os.system('adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2748 790 100&&input swipe 450 1105 743 781 1000\"')\n            message = '执行直线起飞指令'\n        elif query['skill'][0] == '2':\n            os.system('adb shell \"input swipe 2451 1010 2793 670 100&&input swipe 2721 860 2721 860 200&&input swipe 450 1105 544 983 600&&input tap 2726 1226&&input swipe 2290 1267 2100 1376 100&&input swipe 450 1105 217 1400 800&&input swipe 450 1105 777 1150 500\"')\n            message = '执行原地起飞指令'\n        elif query['skill'][0] == '3':\n            os.system('adb shell \"input tap 2873 102&&input tap 2173 1278&&input tap 2525 1153&&input tap 2624 167&&input tap 2832 243\"')\n            message = '执行快速换装指令'\n        else:\n            message = '无指令运行'\n        self.send_response(200)\n        self.send_header('Content-Type',\n                         'text/plain; charset=utf-8')\n        self.end_headers()\n        self.wfile.write(message.encode('utf-8'))\n\nif __name__ == '__main__':\n    from http.server import HTTPServer\n    server = HTTPServer(('0.0.0.0', 9797), GetHandler)\n    print('服务器启动成功, 使用<Ctrl-C> 来停止。。')\n    server.serve_forever()\n```\n\n需要将`os.system()`中的**内容替换为自己**的。\n\n> 修改上面的程序很重要，因为不同分辨率手机，需要的adb指令是不一样的，如果不修改，基本上不可能会实现理想的操作，除非你跟我用的相同的手机，三星S10+。\n\n通过python运行这个文件就已经建立好了http服务器。\n\n```shell\npython3 filepath/takeoff.py\n#filepath修改为takeoff.py的路径。比如C:/Users/999/Desktop/takeoff.py\n#显示，服务器启动成功, 使用<Ctrl-C> 来停止。。则启动成功\n```\n\n查看电脑的局域网ip地址，终端输入\n\n```shell\nipconfig\n```\n\n通常是`192.168.xxx.xxx`，或者`10.xxx.xxx.xxx`\n\n在电脑浏览器中，访问：`192.168.xxx.xxx:9797/?skill=1`就能实现直线上天了。skill =2和skill=3分别对应原地上天和一键换装。\n\n此时，如果在手机浏览器上访问`192.168.xxx.xxx:9797/?skill=1`，应该是访问不通的，因为windows自带的防火墙，是不允许局域网下的其他设备访问未开放的端口的。你需要**关闭局域网防火墙**。\n\n> 关闭防火墙是存在一定风险的，如果你用的公共场所的WiFi，我建议不要关闭。如果是家庭WiFi，记得在使用完后再次开启防火墙。\n\nwindows搜索`fanghuoqiang`注意不要用汉字搜索，用拼音。打开**防火墙和网络保护**\n\n如果是家庭WiFi，则点击专用网络。\n\n![](https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png)\n\n将防火墙**关闭**。\n\n此时在手机浏览器上也能访问到http服务器了。\n\n# 4：王者局内悬浮按钮\n\n新建一个安卓项目，开发一个悬浮按钮，在王者内点击按钮，就能给http服务器发送请求，然后服务器通过adb再返过来控制局内角色。\n\n开发新项目，我直接选择站在巨人肩膀上。https://github.com/dongzhong/TestForFloatingWindow 直接对这个仓库里提供的悬浮窗功能进行修改。。关键程序如下：\n\n```java\n//FloatingButtonService2.java\nprivate void showFloatingWindow() {\n        if (Settings.canDrawOverlays(this)) {\n            button2 = new Button(getApplicationContext());\n            button2.setText(\"装\");//按键上的字，表示按下这个按钮一键换装\n            button2.setBackgroundColor(Color.argb(120,0,255,0));\n            windowManager.addView(button2, layoutParams);\n            button2.setOnClickListener(new View.OnClickListener() {\n                @Override\n                public void onClick(View v) {\n                    send();\n                }\n            });\n            button2.setOnTouchListener(new FloatingOnTouchListener());\n\n        }\n    }\n    private void send() {\n        //开启线程，发送get请求\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                //value对应http服务器接收的技能\n                //在http服务器中，设置的，skill=1，直线上天，skill=2，原地上天，skill=3，换装\n                char value = '3';\n                //这里修改为http服务器地址。\n                String path = \"http://192.168.0.109:9797/?skill=\"+value;\n                try {\n                    URL url = new URL(path);\n                    HttpURLConnection conn = (HttpURLConnection) url.openConnection();\n                    conn.setRequestMethod(\"GET\");\n                    InputStream in = conn.getInputStream();\n                    conn.disconnect();\n                } catch (MalformedURLException e) {\n                    e.printStackTrace();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n\n            }\n        }).start();\n    }\n```\n\n这只是其中一个一键换装的按钮，另外还需要修改一键上天的按钮。在`FloatingButtonService.java`中，两个程序，都相似。。修改完后，直接编译，就可以使用了。\n\n完整的项目地址：https://github.com/xieqifei/Expandskill\n\n安卓项目，可以直接通过git克隆\n\n```shell\ngit clone https://github.com/xieqifei/Expandskill.git\n```\n\n修改程序后，直接编译即可。\n\n# 5：参考资料\n\n《[android adb常用命令收集](https://www.jianshu.com/p/85066854c9e6)》\n\n《[Android adb远程调试](https://blog.csdn.net/u012785382/article/details/79171782)》\n\n《[http.server — 实现 Web 服务器的基础类](https://learnku.com/docs/pymotw/httpserver-base-classes-for-implementing-web-servers/3436)》\n\n《[Android HTTP请求方式:HttpURLConnection](https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html)》\n\n《[Android悬浮窗的实现](https://blog.csdn.net/dongzhong1990/article/details/80512706)》","slug":"如何利用ADB开发王者荣耀外挂","published":1,"updated":"2020-10-24T18:32:32.932Z","_id":"ckgo0pgyt000064vz4gtt7x3s","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1：思路\"><a href=\"#1：思路\" class=\"headerlink\" title=\"1：思路\"></a>1：思路</h1><p>ADB全称安卓设备调试工具，是谷歌官方提供帮助安卓开发者调试自身应用的一个轻量级工具包，总大小只有几兆。通过shell指令可以实现对安装了安卓系统的手机进行控制，包括开关机，开关应用程序，控制屏幕、音量、相机等操作。利用ADB控制屏幕的功能，可以通过程序来实现快速换装、婉儿一键上天等操作。由于ADB是一种模拟人在屏幕上操作的工具，不会修改王者荣耀的内部文件，也不用root手机，所有是不会被王者荣耀检测到，也不会被封号。只需要简单配置让安装了ADB的电脑连接手机，即可实现程序控制王者角色。因为ADB支持通过TCP/IP协议，可以让电脑脱离数据线远程调试手机。</p>\n<p><strong>那么这个外挂完整的工作过程是什么样的呢？</strong></p>\n<ol>\n<li><p>在电脑上安装ADB工具，并将其目录放到系统环境或用户环境变量中。开启手机的USB调试功能，通过ADB远程调试功能连接手机。</p>\n</li>\n<li><p>编写一个安卓应用程序，程序使用安卓的悬浮窗功能。在王者荣耀面板上层悬浮一个按钮。点击按钮，发送一个http的get请求。</p>\n</li>\n<li><p>在安装了ADB的电脑上安装一个http服务器用于接收悬浮按钮发送的get请求。简单的http服务器是基于python内自带的http server。</p>\n</li>\n<li><p>http服务器接收到请求后，执行已经写好的ADB指令，控制手机，实现婉儿一键上天。</p>\n</li>\n</ol>\n<p>看看使用效果吧！</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n    <iframe src=\"//player.bilibili.com/player.html?aid=415048053&bvid=BV18V411y7rw&cid=249226194&page=1&high_quality=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\">\n    </iframe>\n</div>\n\n<h1 id=\"2：ADB工具及调试手机\"><a href=\"#2：ADB工具及调试手机\" class=\"headerlink\" title=\"2：ADB工具及调试手机\"></a>2：ADB工具及调试手机</h1><h2 id=\"2-1-下载ADB\"><a href=\"#2-1-下载ADB\" class=\"headerlink\" title=\"2.1 下载ADB\"></a>2.1 下载ADB</h2><p>在网上下载ADB工具包：<a href=\"https://developer.android.com/studio/releases/platform-tools\">下载地址</a>（需要连接外网）</p>\n<p>解压后，获得一个名为<code>platform-tools</code>的工具包，包内含有<code>adb.exe</code>程序，即为安卓调试工具。</p>\n<h2 id=\"2-2-设置环境\"><a href=\"#2-2-设置环境\" class=\"headerlink\" title=\"2.2 设置环境\"></a>2.2 设置环境</h2><p>在windows中搜索<code>huanjing</code>打开环境变量面板。</p>\n<p><img src=\"https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>依次点击<code>环境变量</code>，点击系统变量下的名为<code>Path</code>的一行，点击<code>编辑</code>.</p>\n<p><img src=\"https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>点击新建，将<code>platform-tools</code>文件夹的完整路径添加到变量中，例：我的工具包存放在<code>C:\\Users\\9752\\.AndroidStudio3.5\\platform-tools</code></p>\n<p>点击<code>确认</code>，然后关闭此窗口。</p>\n<p>在windows中搜索<code>cmd</code>，打开终端窗口，输入<code>adb</code>回车。</p>\n<p><img src=\"https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>出现上文，则配置成功。</p>\n<h2 id=\"2-3-连接手机\"><a href=\"#2-3-连接手机\" class=\"headerlink\" title=\"2.3 连接手机\"></a>2.3 连接手机</h2><p><strong>打开手机开发者模式</strong></p>\n<p>通常是手机设置中，找到版本信息或者内核信息，然后点击七下，在设置中就会出现开发者模式了。具体方法可以自行谷歌。</p>\n<p>打开开发者模式的<code>USB调试</code></p>\n<p>通过<strong>原装</strong>数据线连接电脑，<strong>有的非原装数据线只能充电不能传输数据</strong>。</p>\n<p>连接电脑后，需要在手机上允许此电脑调试，最好一律允许此电脑调试。</p>\n<p>在终端中输入<code>adb devices</code>查看是否连接上了手机。</p>\n<h2 id=\"2-4-开启远程调试\"><a href=\"#2-4-开启远程调试\" class=\"headerlink\" title=\"2.4 开启远程调试\"></a>2.4 开启远程调试</h2><blockquote>\n<p>也可不用远程，直接使用数据线也是可以的。</p>\n</blockquote>\n<p>让手机和电脑处在相同的WiFi下</p>\n<p>电脑通过数据线连接手机后，终端输入</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb tcpip 5555</span><br></pre></td></tr></table></figure>\n\n<p>拔掉数据线。在WiFi设置里，查看手机的局域网ip地址，通常是<code>192.168.xxx.xxx</code>，或者<code>10.xxx.xxx.xxx</code></p>\n<p>修改为你的手机ip地址，连接手机：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb connect 192.168.xxx.xxx:5555</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-主要用到的ADB指令\"><a href=\"#2-5-主要用到的ADB指令\" class=\"headerlink\" title=\"2.5 主要用到的ADB指令\"></a>2.5 主要用到的ADB指令</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 模拟点击，屏幕上横坐标纵坐标分别为100 120的位置</span><br><span class=\"line\">// 要查看具体坐标值，可以打开开发者选项-&gt;指针位置</span><br><span class=\"line\">adb shell input tap 100 120</span><br><span class=\"line\"></span><br><span class=\"line\">// 模拟滑动，从位置（0,1000）滑动到(800,600)</span><br><span class=\"line\">adb shell input swipe 0 1000 800 600</span><br><span class=\"line\"></span><br><span class=\"line\">// 模拟长按，在位置（100,200）长按500毫秒</span><br><span class=\"line\">adb shell input swipe 100 200 100 200 500// 开启adb服务</span><br></pre></td></tr></table></figure>\n\n<p>其中位置信息，需要在手机上获取。</p>\n<p>在<strong>开发者模式</strong>中打开<strong>显示指针</strong></p>\n<p>通过按住屏幕，就能实时显示按压住的位置的x轴和y轴信息。</p>\n<p>此时已经可以尝试用ADB指令控制屏幕了。</p>\n<h2 id=\"2-6-控制婉儿上天\"><a href=\"#2-6-控制婉儿上天\" class=\"headerlink\" title=\"2.6 控制婉儿上天\"></a>2.6 控制婉儿上天</h2><p>不同的手机，需要自己寻找合适的坐标点来实现婉儿的技能释放。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">向前移动：abd shell input swipe 450 1105 544 983 600</span><br><span class=\"line\">向后移动：adb shell input swipe 450 1105 217 1400 800</span><br><span class=\"line\">普工：adb shell input tap 2726 1226</span><br><span class=\"line\">一技能：adb shell input swipe 2290 1267 2748 790 100</span><br><span class=\"line\">二技能：adb shell input swipe 2451 1010 2793 670 100</span><br><span class=\"line\">三技能：adb shell input swipe 2721 860 2721 860 200</span><br><span class=\"line\"></span><br><span class=\"line\">向前直线上天：adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2748 790 100&amp;&amp;input swipe 450 1105 743 781 1000&quot;</span><br><span class=\"line\">原地上天：adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2100 1376 100&amp;&amp;input swipe 450 1105 217 1400 800&amp;&amp;input swipe 450 1105 777 1150 500&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-一键换装\"><a href=\"#2-7-一键换装\" class=\"headerlink\" title=\"2.7 一键换装\"></a>2.7 一键换装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">打开商店： adb shell input tap 2873 102</span><br><span class=\"line\">装备： adb shell input tap 2173 1278</span><br><span class=\"line\">出售： adb shell input tap 2525 1153</span><br><span class=\"line\">关闭商店： adb shell input tap 2624 167</span><br><span class=\"line\">购买预选：adb shell input tap 2832 243</span><br><span class=\"line\">完整操作链：adb shell &quot;input tap 2873 102&amp;&amp;input tap 2173 1278&amp;&amp;input tap 2525 1153&amp;&amp;input tap 2624 167&amp;&amp;input tap 2832 243&quot;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：搭建http服务器\"><a href=\"#3：搭建http服务器\" class=\"headerlink\" title=\"3：搭建http服务器\"></a>3：搭建http服务器</h1><p>在电脑上安装好python环境。</p>\n<p>新建一个<code>takeoff.py</code>文件。编辑文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> http.server <span class=\"keyword\">import</span> BaseHTTPRequestHandler</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> parse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GetHandler</span>(<span class=\"params\">BaseHTTPRequestHandler</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">do_GET</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        parsed_path = parse.urlparse(self.path)</span><br><span class=\"line\">        query = parse.parse_qs(parsed_path.query)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> query[<span class=\"string\">&#x27;skill&#x27;</span>][<span class=\"number\">0</span>] == <span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">            os.system(<span class=\"string\">&#x27;adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2748 790 100&amp;&amp;input swipe 450 1105 743 781 1000&quot;&#x27;</span>)</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;执行直线起飞指令&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> query[<span class=\"string\">&#x27;skill&#x27;</span>][<span class=\"number\">0</span>] == <span class=\"string\">&#x27;2&#x27;</span>:</span><br><span class=\"line\">            os.system(<span class=\"string\">&#x27;adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2100 1376 100&amp;&amp;input swipe 450 1105 217 1400 800&amp;&amp;input swipe 450 1105 777 1150 500&quot;&#x27;</span>)</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;执行原地起飞指令&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> query[<span class=\"string\">&#x27;skill&#x27;</span>][<span class=\"number\">0</span>] == <span class=\"string\">&#x27;3&#x27;</span>:</span><br><span class=\"line\">            os.system(<span class=\"string\">&#x27;adb shell &quot;input tap 2873 102&amp;&amp;input tap 2173 1278&amp;&amp;input tap 2525 1153&amp;&amp;input tap 2624 167&amp;&amp;input tap 2832 243&quot;&#x27;</span>)</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;执行快速换装指令&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;无指令运行&#x27;</span></span><br><span class=\"line\">        self.send_response(<span class=\"number\">200</span>)</span><br><span class=\"line\">        self.send_header(<span class=\"string\">&#x27;Content-Type&#x27;</span>,</span><br><span class=\"line\">                         <span class=\"string\">&#x27;text/plain; charset=utf-8&#x27;</span>)</span><br><span class=\"line\">        self.end_headers()</span><br><span class=\"line\">        self.wfile.write(message.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">from</span> http.server <span class=\"keyword\">import</span> HTTPServer</span><br><span class=\"line\">    server = HTTPServer((<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"number\">9797</span>), GetHandler)</span><br><span class=\"line\">    print(<span class=\"string\">&#x27;服务器启动成功, 使用&lt;Ctrl-C&gt; 来停止。。&#x27;</span>)</span><br><span class=\"line\">    server.serve_forever()</span><br></pre></td></tr></table></figure>\n\n<p>需要将<code>os.system()</code>中的<strong>内容替换为自己</strong>的。</p>\n<blockquote>\n<p>修改上面的程序很重要，因为不同分辨率手机，需要的adb指令是不一样的，如果不修改，基本上不可能会实现理想的操作，除非你跟我用的相同的手机，三星S10+。</p>\n</blockquote>\n<p>通过python运行这个文件就已经建立好了http服务器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 filepath/takeoff.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">filepath修改为takeoff.py的路径。比如C:/Users/999/Desktop/takeoff.py</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">显示，服务器启动成功, 使用&lt;Ctrl-C&gt; 来停止。。则启动成功</span></span><br></pre></td></tr></table></figure>\n\n<p>查看电脑的局域网ip地址，终端输入</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipconfig</span><br></pre></td></tr></table></figure>\n\n<p>通常是<code>192.168.xxx.xxx</code>，或者<code>10.xxx.xxx.xxx</code></p>\n<p>在电脑浏览器中，访问：<code>192.168.xxx.xxx:9797/?skill=1</code>就能实现直线上天了。skill =2和skill=3分别对应原地上天和一键换装。</p>\n<p>此时，如果在手机浏览器上访问<code>192.168.xxx.xxx:9797/?skill=1</code>，应该是访问不通的，因为windows自带的防火墙，是不允许局域网下的其他设备访问未开放的端口的。你需要<strong>关闭局域网防火墙</strong>。</p>\n<blockquote>\n<p>关闭防火墙是存在一定风险的，如果你用的公共场所的WiFi，我建议不要关闭。如果是家庭WiFi，记得在使用完后再次开启防火墙。</p>\n</blockquote>\n<p>windows搜索<code>fanghuoqiang</code>注意不要用汉字搜索，用拼音。打开<strong>防火墙和网络保护</strong></p>\n<p>如果是家庭WiFi，则点击专用网络。</p>\n<p><img src=\"https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>将防火墙<strong>关闭</strong>。</p>\n<p>此时在手机浏览器上也能访问到http服务器了。</p>\n<h1 id=\"4：王者局内悬浮按钮\"><a href=\"#4：王者局内悬浮按钮\" class=\"headerlink\" title=\"4：王者局内悬浮按钮\"></a>4：王者局内悬浮按钮</h1><p>新建一个安卓项目，开发一个悬浮按钮，在王者内点击按钮，就能给http服务器发送请求，然后服务器通过adb再返过来控制局内角色。</p>\n<p>开发新项目，我直接选择站在巨人肩膀上。<a href=\"https://github.com/dongzhong/TestForFloatingWindow\">https://github.com/dongzhong/TestForFloatingWindow</a> 直接对这个仓库里提供的悬浮窗功能进行修改。。关键程序如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//FloatingButtonService2.java</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">showFloatingWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Settings.canDrawOverlays(<span class=\"keyword\">this</span>)) &#123;</span><br><span class=\"line\">            button2 = <span class=\"keyword\">new</span> Button(getApplicationContext());</span><br><span class=\"line\">            button2.setText(<span class=\"string\">&quot;装&quot;</span>);<span class=\"comment\">//按键上的字，表示按下这个按钮一键换装</span></span><br><span class=\"line\">            button2.setBackgroundColor(Color.argb(<span class=\"number\">120</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\">            windowManager.addView(button2, layoutParams);</span><br><span class=\"line\">            button2.setOnClickListener(<span class=\"keyword\">new</span> View.OnClickListener() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onClick</span><span class=\"params\">(View v)</span> </span>&#123;</span><br><span class=\"line\">                    send();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            button2.setOnTouchListener(<span class=\"keyword\">new</span> FloatingOnTouchListener());</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//开启线程，发送get请求</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//value对应http服务器接收的技能</span></span><br><span class=\"line\">                <span class=\"comment\">//在http服务器中，设置的，skill=1，直线上天，skill=2，原地上天，skill=3，换装</span></span><br><span class=\"line\">                <span class=\"keyword\">char</span> value = <span class=\"string\">&#x27;3&#x27;</span>;</span><br><span class=\"line\">                <span class=\"comment\">//这里修改为http服务器地址。</span></span><br><span class=\"line\">                String path = <span class=\"string\">&quot;http://192.168.0.109:9797/?skill=&quot;</span>+value;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    URL url = <span class=\"keyword\">new</span> URL(path);</span><br><span class=\"line\">                    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class=\"line\">                    conn.setRequestMethod(<span class=\"string\">&quot;GET&quot;</span>);</span><br><span class=\"line\">                    InputStream in = conn.getInputStream();</span><br><span class=\"line\">                    conn.disconnect();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (MalformedURLException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这只是其中一个一键换装的按钮，另外还需要修改一键上天的按钮。在<code>FloatingButtonService.java</code>中，两个程序，都相似。。修改完后，直接编译，就可以使用了。</p>\n<p>完整的项目地址：<a href=\"https://github.com/xieqifei/Expandskill\">https://github.com/xieqifei/Expandskill</a></p>\n<p>安卓项目，可以直接通过git克隆</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/xieqifei/Expandskill.git</span><br></pre></td></tr></table></figure>\n\n<p>修改程序后，直接编译即可。</p>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://www.jianshu.com/p/85066854c9e6\">android adb常用命令收集</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/u012785382/article/details/79171782\">Android adb远程调试</a>》</p>\n<p>《<a href=\"https://learnku.com/docs/pymotw/httpserver-base-classes-for-implementing-web-servers/3436\">http.server — 实现 Web 服务器的基础类</a>》</p>\n<p>《<a href=\"https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html\">Android HTTP请求方式:HttpURLConnection</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/dongzhong1990/article/details/80512706\">Android悬浮窗的实现</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：思路\"><a href=\"#1：思路\" class=\"headerlink\" title=\"1：思路\"></a>1：思路</h1><p>ADB全称安卓设备调试工具，是谷歌官方提供帮助安卓开发者调试自身应用的一个轻量级工具包，总大小只有几兆。通过shell指令可以实现对安装了安卓系统的手机进行控制，包括开关机，开关应用程序，控制屏幕、音量、相机等操作。利用ADB控制屏幕的功能，可以通过程序来实现快速换装、婉儿一键上天等操作。由于ADB是一种模拟人在屏幕上操作的工具，不会修改王者荣耀的内部文件，也不用root手机，所有是不会被王者荣耀检测到，也不会被封号。只需要简单配置让安装了ADB的电脑连接手机，即可实现程序控制王者角色。因为ADB支持通过TCP/IP协议，可以让电脑脱离数据线远程调试手机。</p>\n<p><strong>那么这个外挂完整的工作过程是什么样的呢？</strong></p>\n<ol>\n<li><p>在电脑上安装ADB工具，并将其目录放到系统环境或用户环境变量中。开启手机的USB调试功能，通过ADB远程调试功能连接手机。</p>\n</li>\n<li><p>编写一个安卓应用程序，程序使用安卓的悬浮窗功能。在王者荣耀面板上层悬浮一个按钮。点击按钮，发送一个http的get请求。</p>\n</li>\n<li><p>在安装了ADB的电脑上安装一个http服务器用于接收悬浮按钮发送的get请求。简单的http服务器是基于python内自带的http server。</p>\n</li>\n<li><p>http服务器接收到请求后，执行已经写好的ADB指令，控制手机，实现婉儿一键上天。</p>\n</li>\n</ol>\n<p>看看使用效果吧！</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n    <iframe src=\"//player.bilibili.com/player.html?aid=415048053&bvid=BV18V411y7rw&cid=249226194&page=1&high_quality=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\">\n    </iframe>\n</div>\n\n<h1 id=\"2：ADB工具及调试手机\"><a href=\"#2：ADB工具及调试手机\" class=\"headerlink\" title=\"2：ADB工具及调试手机\"></a>2：ADB工具及调试手机</h1><h2 id=\"2-1-下载ADB\"><a href=\"#2-1-下载ADB\" class=\"headerlink\" title=\"2.1 下载ADB\"></a>2.1 下载ADB</h2><p>在网上下载ADB工具包：<a href=\"https://developer.android.com/studio/releases/platform-tools\">下载地址</a>（需要连接外网）</p>\n<p>解压后，获得一个名为<code>platform-tools</code>的工具包，包内含有<code>adb.exe</code>程序，即为安卓调试工具。</p>\n<h2 id=\"2-2-设置环境\"><a href=\"#2-2-设置环境\" class=\"headerlink\" title=\"2.2 设置环境\"></a>2.2 设置环境</h2><p>在windows中搜索<code>huanjing</code>打开环境变量面板。</p>\n<p><img src=\"https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png\"></p>\n<p>依次点击<code>环境变量</code>，点击系统变量下的名为<code>Path</code>的一行，点击<code>编辑</code>.</p>\n<p><img src=\"https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png\"></p>\n<p>点击新建，将<code>platform-tools</code>文件夹的完整路径添加到变量中，例：我的工具包存放在<code>C:\\Users\\9752\\.AndroidStudio3.5\\platform-tools</code></p>\n<p>点击<code>确认</code>，然后关闭此窗口。</p>\n<p>在windows中搜索<code>cmd</code>，打开终端窗口，输入<code>adb</code>回车。</p>\n<p><img src=\"https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png\"></p>\n<p>出现上文，则配置成功。</p>\n<h2 id=\"2-3-连接手机\"><a href=\"#2-3-连接手机\" class=\"headerlink\" title=\"2.3 连接手机\"></a>2.3 连接手机</h2><p><strong>打开手机开发者模式</strong></p>\n<p>通常是手机设置中，找到版本信息或者内核信息，然后点击七下，在设置中就会出现开发者模式了。具体方法可以自行谷歌。</p>\n<p>打开开发者模式的<code>USB调试</code></p>\n<p>通过<strong>原装</strong>数据线连接电脑，<strong>有的非原装数据线只能充电不能传输数据</strong>。</p>\n<p>连接电脑后，需要在手机上允许此电脑调试，最好一律允许此电脑调试。</p>\n<p>在终端中输入<code>adb devices</code>查看是否连接上了手机。</p>\n<h2 id=\"2-4-开启远程调试\"><a href=\"#2-4-开启远程调试\" class=\"headerlink\" title=\"2.4 开启远程调试\"></a>2.4 开启远程调试</h2><blockquote>\n<p>也可不用远程，直接使用数据线也是可以的。</p>\n</blockquote>\n<p>让手机和电脑处在相同的WiFi下</p>\n<p>电脑通过数据线连接手机后，终端输入</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb tcpip 5555</span><br></pre></td></tr></table></figure>\n\n<p>拔掉数据线。在WiFi设置里，查看手机的局域网ip地址，通常是<code>192.168.xxx.xxx</code>，或者<code>10.xxx.xxx.xxx</code></p>\n<p>修改为你的手机ip地址，连接手机：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb connect 192.168.xxx.xxx:5555</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-主要用到的ADB指令\"><a href=\"#2-5-主要用到的ADB指令\" class=\"headerlink\" title=\"2.5 主要用到的ADB指令\"></a>2.5 主要用到的ADB指令</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 模拟点击，屏幕上横坐标纵坐标分别为100 120的位置</span><br><span class=\"line\">// 要查看具体坐标值，可以打开开发者选项-&gt;指针位置</span><br><span class=\"line\">adb shell input tap 100 120</span><br><span class=\"line\"></span><br><span class=\"line\">// 模拟滑动，从位置（0,1000）滑动到(800,600)</span><br><span class=\"line\">adb shell input swipe 0 1000 800 600</span><br><span class=\"line\"></span><br><span class=\"line\">// 模拟长按，在位置（100,200）长按500毫秒</span><br><span class=\"line\">adb shell input swipe 100 200 100 200 500// 开启adb服务</span><br></pre></td></tr></table></figure>\n\n<p>其中位置信息，需要在手机上获取。</p>\n<p>在<strong>开发者模式</strong>中打开<strong>显示指针</strong></p>\n<p>通过按住屏幕，就能实时显示按压住的位置的x轴和y轴信息。</p>\n<p>此时已经可以尝试用ADB指令控制屏幕了。</p>\n<h2 id=\"2-6-控制婉儿上天\"><a href=\"#2-6-控制婉儿上天\" class=\"headerlink\" title=\"2.6 控制婉儿上天\"></a>2.6 控制婉儿上天</h2><p>不同的手机，需要自己寻找合适的坐标点来实现婉儿的技能释放。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">向前移动：abd shell input swipe 450 1105 544 983 600</span><br><span class=\"line\">向后移动：adb shell input swipe 450 1105 217 1400 800</span><br><span class=\"line\">普工：adb shell input tap 2726 1226</span><br><span class=\"line\">一技能：adb shell input swipe 2290 1267 2748 790 100</span><br><span class=\"line\">二技能：adb shell input swipe 2451 1010 2793 670 100</span><br><span class=\"line\">三技能：adb shell input swipe 2721 860 2721 860 200</span><br><span class=\"line\"></span><br><span class=\"line\">向前直线上天：adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2748 790 100&amp;&amp;input swipe 450 1105 743 781 1000&quot;</span><br><span class=\"line\">原地上天：adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2100 1376 100&amp;&amp;input swipe 450 1105 217 1400 800&amp;&amp;input swipe 450 1105 777 1150 500&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-一键换装\"><a href=\"#2-7-一键换装\" class=\"headerlink\" title=\"2.7 一键换装\"></a>2.7 一键换装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">打开商店： adb shell input tap 2873 102</span><br><span class=\"line\">装备： adb shell input tap 2173 1278</span><br><span class=\"line\">出售： adb shell input tap 2525 1153</span><br><span class=\"line\">关闭商店： adb shell input tap 2624 167</span><br><span class=\"line\">购买预选：adb shell input tap 2832 243</span><br><span class=\"line\">完整操作链：adb shell &quot;input tap 2873 102&amp;&amp;input tap 2173 1278&amp;&amp;input tap 2525 1153&amp;&amp;input tap 2624 167&amp;&amp;input tap 2832 243&quot;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3：搭建http服务器\"><a href=\"#3：搭建http服务器\" class=\"headerlink\" title=\"3：搭建http服务器\"></a>3：搭建http服务器</h1><p>在电脑上安装好python环境。</p>\n<p>新建一个<code>takeoff.py</code>文件。编辑文件：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> http.server <span class=\"keyword\">import</span> BaseHTTPRequestHandler</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> parse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GetHandler</span>(<span class=\"params\">BaseHTTPRequestHandler</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">do_GET</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        parsed_path = parse.urlparse(self.path)</span><br><span class=\"line\">        query = parse.parse_qs(parsed_path.query)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> query[<span class=\"string\">&#x27;skill&#x27;</span>][<span class=\"number\">0</span>] == <span class=\"string\">&#x27;1&#x27;</span>:</span><br><span class=\"line\">            os.system(<span class=\"string\">&#x27;adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2748 790 100&amp;&amp;input swipe 450 1105 743 781 1000&quot;&#x27;</span>)</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;执行直线起飞指令&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> query[<span class=\"string\">&#x27;skill&#x27;</span>][<span class=\"number\">0</span>] == <span class=\"string\">&#x27;2&#x27;</span>:</span><br><span class=\"line\">            os.system(<span class=\"string\">&#x27;adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2100 1376 100&amp;&amp;input swipe 450 1105 217 1400 800&amp;&amp;input swipe 450 1105 777 1150 500&quot;&#x27;</span>)</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;执行原地起飞指令&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> query[<span class=\"string\">&#x27;skill&#x27;</span>][<span class=\"number\">0</span>] == <span class=\"string\">&#x27;3&#x27;</span>:</span><br><span class=\"line\">            os.system(<span class=\"string\">&#x27;adb shell &quot;input tap 2873 102&amp;&amp;input tap 2173 1278&amp;&amp;input tap 2525 1153&amp;&amp;input tap 2624 167&amp;&amp;input tap 2832 243&quot;&#x27;</span>)</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;执行快速换装指令&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            message = <span class=\"string\">&#x27;无指令运行&#x27;</span></span><br><span class=\"line\">        self.send_response(<span class=\"number\">200</span>)</span><br><span class=\"line\">        self.send_header(<span class=\"string\">&#x27;Content-Type&#x27;</span>,</span><br><span class=\"line\">                         <span class=\"string\">&#x27;text/plain; charset=utf-8&#x27;</span>)</span><br><span class=\"line\">        self.end_headers()</span><br><span class=\"line\">        self.wfile.write(message.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">from</span> http.server <span class=\"keyword\">import</span> HTTPServer</span><br><span class=\"line\">    server = HTTPServer((<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"number\">9797</span>), GetHandler)</span><br><span class=\"line\">    print(<span class=\"string\">&#x27;服务器启动成功, 使用&lt;Ctrl-C&gt; 来停止。。&#x27;</span>)</span><br><span class=\"line\">    server.serve_forever()</span><br></pre></td></tr></table></figure>\n\n<p>需要将<code>os.system()</code>中的<strong>内容替换为自己</strong>的。</p>\n<blockquote>\n<p>修改上面的程序很重要，因为不同分辨率手机，需要的adb指令是不一样的，如果不修改，基本上不可能会实现理想的操作，除非你跟我用的相同的手机，三星S10+。</p>\n</blockquote>\n<p>通过python运行这个文件就已经建立好了http服务器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 filepath/takeoff.py</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">filepath修改为takeoff.py的路径。比如C:/Users/999/Desktop/takeoff.py</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">显示，服务器启动成功, 使用&lt;Ctrl-C&gt; 来停止。。则启动成功</span></span><br></pre></td></tr></table></figure>\n\n<p>查看电脑的局域网ip地址，终端输入</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipconfig</span><br></pre></td></tr></table></figure>\n\n<p>通常是<code>192.168.xxx.xxx</code>，或者<code>10.xxx.xxx.xxx</code></p>\n<p>在电脑浏览器中，访问：<code>192.168.xxx.xxx:9797/?skill=1</code>就能实现直线上天了。skill =2和skill=3分别对应原地上天和一键换装。</p>\n<p>此时，如果在手机浏览器上访问<code>192.168.xxx.xxx:9797/?skill=1</code>，应该是访问不通的，因为windows自带的防火墙，是不允许局域网下的其他设备访问未开放的端口的。你需要<strong>关闭局域网防火墙</strong>。</p>\n<blockquote>\n<p>关闭防火墙是存在一定风险的，如果你用的公共场所的WiFi，我建议不要关闭。如果是家庭WiFi，记得在使用完后再次开启防火墙。</p>\n</blockquote>\n<p>windows搜索<code>fanghuoqiang</code>注意不要用汉字搜索，用拼音。打开<strong>防火墙和网络保护</strong></p>\n<p>如果是家庭WiFi，则点击专用网络。</p>\n<p><img src=\"https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png\"></p>\n<p>将防火墙<strong>关闭</strong>。</p>\n<p>此时在手机浏览器上也能访问到http服务器了。</p>\n<h1 id=\"4：王者局内悬浮按钮\"><a href=\"#4：王者局内悬浮按钮\" class=\"headerlink\" title=\"4：王者局内悬浮按钮\"></a>4：王者局内悬浮按钮</h1><p>新建一个安卓项目，开发一个悬浮按钮，在王者内点击按钮，就能给http服务器发送请求，然后服务器通过adb再返过来控制局内角色。</p>\n<p>开发新项目，我直接选择站在巨人肩膀上。<a href=\"https://github.com/dongzhong/TestForFloatingWindow\">https://github.com/dongzhong/TestForFloatingWindow</a> 直接对这个仓库里提供的悬浮窗功能进行修改。。关键程序如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//FloatingButtonService2.java</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">showFloatingWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Settings.canDrawOverlays(<span class=\"keyword\">this</span>)) &#123;</span><br><span class=\"line\">            button2 = <span class=\"keyword\">new</span> Button(getApplicationContext());</span><br><span class=\"line\">            button2.setText(<span class=\"string\">&quot;装&quot;</span>);<span class=\"comment\">//按键上的字，表示按下这个按钮一键换装</span></span><br><span class=\"line\">            button2.setBackgroundColor(Color.argb(<span class=\"number\">120</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>));</span><br><span class=\"line\">            windowManager.addView(button2, layoutParams);</span><br><span class=\"line\">            button2.setOnClickListener(<span class=\"keyword\">new</span> View.OnClickListener() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onClick</span><span class=\"params\">(View v)</span> </span>&#123;</span><br><span class=\"line\">                    send();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            button2.setOnTouchListener(<span class=\"keyword\">new</span> FloatingOnTouchListener());</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//开启线程，发送get请求</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//value对应http服务器接收的技能</span></span><br><span class=\"line\">                <span class=\"comment\">//在http服务器中，设置的，skill=1，直线上天，skill=2，原地上天，skill=3，换装</span></span><br><span class=\"line\">                <span class=\"keyword\">char</span> value = <span class=\"string\">&#x27;3&#x27;</span>;</span><br><span class=\"line\">                <span class=\"comment\">//这里修改为http服务器地址。</span></span><br><span class=\"line\">                String path = <span class=\"string\">&quot;http://192.168.0.109:9797/?skill=&quot;</span>+value;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    URL url = <span class=\"keyword\">new</span> URL(path);</span><br><span class=\"line\">                    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class=\"line\">                    conn.setRequestMethod(<span class=\"string\">&quot;GET&quot;</span>);</span><br><span class=\"line\">                    InputStream in = conn.getInputStream();</span><br><span class=\"line\">                    conn.disconnect();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (MalformedURLException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这只是其中一个一键换装的按钮，另外还需要修改一键上天的按钮。在<code>FloatingButtonService.java</code>中，两个程序，都相似。。修改完后，直接编译，就可以使用了。</p>\n<p>完整的项目地址：<a href=\"https://github.com/xieqifei/Expandskill\">https://github.com/xieqifei/Expandskill</a></p>\n<p>安卓项目，可以直接通过git克隆</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/xieqifei/Expandskill.git</span><br></pre></td></tr></table></figure>\n\n<p>修改程序后，直接编译即可。</p>\n<h1 id=\"5：参考资料\"><a href=\"#5：参考资料\" class=\"headerlink\" title=\"5：参考资料\"></a>5：参考资料</h1><p>《<a href=\"https://www.jianshu.com/p/85066854c9e6\">android adb常用命令收集</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/u012785382/article/details/79171782\">Android adb远程调试</a>》</p>\n<p>《<a href=\"https://learnku.com/docs/pymotw/httpserver-base-classes-for-implementing-web-servers/3436\">http.server — 实现 Web 服务器的基础类</a>》</p>\n<p>《<a href=\"https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html\">Android HTTP请求方式:HttpURLConnection</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/dongzhong1990/article/details/80512706\">Android悬浮窗的实现</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png","popularPost_tmp_gaData":{"updated":"Sat Oct 24 2020 20:32:32 GMT+0200 (GMT+02:00)","title":"如何利用ADB开发王者荣耀外挂","path":"2020/10/24/如何利用ADB开发王者荣耀外挂/","eyeCatchImage":"https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-10-24T09:51:01.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-10-24T09:51:01.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"安卓编程","tags":["ADB","Python","Java"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"北大人工智能实践——TensorFlow2","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-11-12T15:10:33.000Z","password":null,"summary":null,"_content":"\n# 1：人工智能三学派\t\n\n- 准备数据\n- 搭建网络\n- 优化参数\n- 应用网络\n\n# 2：神经网络设计过程\n\n鸢尾花的分类：\n\n通过测量花萼长、花萼宽。\n\nif语句case语句——**专家系统**把专家的经验告知计算机，计算机执行逻辑判断。给出分类\n\n神经网络：采集大量数据对构成数据集。\n\n# 3：张量生成\n\n张量（Tensor）：多维数组（列表）\t阶：张量的维数\n\n| 阶   | 名字 | 例子      |\n| ---- | ---- | --------- |\n| 0    | 标量 | S=1 2 3   |\n| 1    | 向量 | v=[1,2,3] |\n| 2    | 矩阵 |           |\n| n    | 张量 |           |\n\n创建张量\n\n```python\na = tf.constan(张量内容,dtype = 数据类型)\nprint(a)\nprint(a.dtype)\nprint(a.shape)\n```\n\n```python\ntf.zeros(维度)\ntf.ones(维度)\ntf.fill(维度，指定值)\nc = tf.fill([2,2],9)\t//两行两列\n```\n\n```python\ntf.random.normal(维度,mean=均值,stddev=标准差)\ntf.random.truncated_normal(维度，mean=均值,stddev=标准差)\ntf.random.uniform(维度,minval=最小值,maxval=最大值)\n```\n\n# 4：常用函数\n\n```\ntf.cast(张量名,dtype=数据类型)\t//强制转换数据类型\ntf.reduce_min()\t//计算最大值\ntf.reduce_max()\n```\n\n\n\n```python\ntf.reduce_mean(张量名,axis=操作轴)\t//计算张量延指定维度平均值\ntf.reduce_sum(张量名,axis=操作轴)\t//计算沿指定维度的和\n```\n\n未指定操作轴，则为对全部数进行操作\n\n变量：\n\n```\ntf.Variable(初始值)\n```\n\n数学运算\n\n```\ntf.add()\ntf.subtract()\ntf.multiply()\ntf.divide()\n//只有维度相同才能进行四则运算\ntf.square(张量名)\t平方\ntf.pow()\t//n次方\ntf.sqrt()\t//开方\n```\n\n矩阵乘\n\n```python\ntf.matmul(矩阵1，矩阵2)\n```\n\n特征和标签对应：\n\n```\nfeatures = tf.constant([12,23,10,14])\nlabels = tf.constant([0,1,1,0])\ndataset = tf.data.Dataset.from_tensor_slices((features,labels))\n```\n\n计算梯度\n\n```python\nwith tf.GradientTape() as tape:\n\tw = tf.Variable(tf.constant(3.0))\n\tloss = tf.pow(w,2)\ngrad = tape.gradient(loss,w)\n```\n\n**enumerate**\n\n```python\nseq = ['one','two','three']\nfor i,element in enumerate(seq):\n\tprint(i,element)\n```\n\n独热编码：\n\n标记类别：1表示是，0表示否\n\n```\ntf.one_hot(待转换数据，depth=几分类)\n```\n\n输出符合概率分布：\n\n```python\ntf.nn.softmax(x)\n\ny = tf.constant([1.01,2.01,-0.66])\ny_pro = tf.nn.softmax(y)\n```\n\n参数自更新：\n\n```\nw = tf.Variable(4)\nw.assign_sub(1)\t//w-=1\nprint(w)\n```\n\n返回最大值索引\n\n```\ntf.argmax(张量名，axis=操作轴)\n```\n\n条件语句：\n\n```\ntf.where(条件语句,真返回A,假返回B)\n```\n\n返回[0,1)之间的随机数\n\n```python\nnp.random.RandomState.rand(维度)\n```\n\n将两个数组按垂直方向叠加（一维—>二维）：\n\n```python\nnp.vstack(数组1，数组2)\n```\n\n```python\nx,y = np.mgrid[1:3:1,2:4:0.5]\t//x=[[1 1 1 1]\n                                     [2 2 2 2]]\n\t\t\t\t\t\t\t\t\ty=[[2 2.5 3 3.5]\n                                       [2 2.5 3 3.5]] \ngird = np.c_[x.ravel(),y.ravel()]\t//ravel()降维到一维，np.c_[数组1，数组2]配对。\n```\n\n# 5：神经网络(NN)复杂度\n\nNN复杂度：多用NN层数和NN参数的个数表示。\n\n- 空间复杂度\n- 时间复杂度\n\n学习率:\n$$\nw_{t+1} = w_t+lr*gradient\n$$\n指数衰减学习率:\n$$\n指数衰减学习率=初始学习率*学习率衰减率^{当前轮数/多少轮衰减一次}\n\\\\\\\\epoch= 40\n\\\\\\\\LR\\_BASE= 0.2\n\\\\\\\\LR\\_DECAY= 0.99\n\\\\\\\\LR\\_STEP=1\n$$\n\n```python\nfor epoch in range(epoch):\n    lr = LR_BASE*LR_DECAY**(epoch/LR_STEP)\n    with tf.GradientTape() as tape:\n        loss = tf.square(w+1)\n    grads = tape.gradient(loss,w)\n    w.assign_sub(lr*grads)\n```\n\n# 6：激活函数\n\n$$\ny = f(wx+b)\n$$\n\n- Sigmoid函数\n\n$$\nf(x)=\\frac{1}{1+e^{-x}}\n$$\n\n```python\ntf.nn.sigmoid(x)\n```\n\n> 易造成梯度消失\n>\n> 输出非0均值，收敛慢\n>\n> 幂运算复杂，训练时间长\n\n- Tanh函数\n\n$$\nf(x) = \\frac{1-e^{-2x}}{1+e^{-2x}}\n$$\n\n```\ntf.math.tanh(x)\n```\n\n- Relu函数\n\n$$\n\\begin{align}\nf(x)=& max(x,0)\n\\\\\\\\=& \\begin{cases}\n0\\qquad x<0\\\\\nx\\qquad x>=0\n\\end{cases}\n\\end{align}\n$$\n\n```\ntf.nn.relu(x)\n```\n\n- Leaky Relu函数\n\n$$\nf(x)=max(ax,x)\n$$\n\n```\ntf.nn.leaky_relu(x)\n```\n\n> 初学者：\n>\n> - 首选Relu函数\n> - 学习率设置较小值\n> - 输入特征标准化，让输入特征满足以0为均值，1为标准差的正态分布\n> - 初始参数中心化，让随机生成的参数满足以0为均值，sqrt(2/当前层输入特征个数)为标准差的正态分布\n\n# 7：损失函数\n\nloss：预测值(y)与已知答案(y_)的差距\n\n- 均方误差mse：\n\n$$\nMSE(y\\_,y)=\\frac{\\sum^n_{i=1}(y-y\\_)^2}{n}\n$$\n\n```python\nloss_mse = tf.reduce_mean(tf.square(y-y_))\n```\n\n- 自定义损失函数\n\ny_:标准答案\n\ny:预测答案\n$$\nf(y\\_,y)=\\begin{cases}\nPROFIT*(y\\_-y)\\quad y<y\\_ \\ 预测的y少了，损失利润\n\\\\COST*(y-y\\_)\\quad y>=y\\_ \\ 预测的y多了，损失成本\n\\end{cases}\n$$\n\n```python\nloss_diy = tf.reduce_sum(tf.where(tf.greater(y,y_),COST(y-y_),PROFIT(y_-y)))\t//y>y_?,为真COST，为假PROFIT\n```\n\n- 交叉熵损失函数CE：表征两个概率分布之间的距离\n\n$$\nH(y\\_,y)=-\\sum y\\_*lny\n$$\n\n```python\ntf.losses.categorical_crossentropy(y_,y)\n```\n\n- softmax和交叉熵结合\n\nsoftmax计算概率分布\n\n```python\ntf.nn.softmax_cross_entropy_with_logits(y_,y)\n```\n\n# 8：缓解过拟合\n\n- 正则化缓解过拟合\n\n正则化在损失函数中引入模型复杂度指标，利用给W加权值，弱化训练数据的噪声。\n\n$$\nloss=loss(y与y\\_)+REGULARIZER*losss(w)\n$$\n\nL2正则化\n\n```\nwith tf.GradientTape() as tape:\n\th1 = tf.matmul(x_train,w1)+b1\n\th1 = tf.nn.relu(h1)\n\ty = tf.matmul(h1,w2) + b2\n\tloss_mse = tf.reduce_mean(tf.square(y_train - y))\n\tloss_regularization = []\n\tloss_regularization.append(tf.nn.l2_loss(w1))\n\tloss_regularization.append(tf.nn.l2_loss(w2))\n\tloss_regularization = tf.reduce_sum(loss_regularization)\n\tloss = loss_mse + 0.03*loss_regularization\n\t\n```\n\n# 9：优化器\n\n$m_t$：一阶动量(与梯度相关的函数)\t$V_t$：二阶动量(与梯度平方相关的函数)\n\n下降梯度$\\eta_t=lr*m_t/\\sqrt{V_t}$\n\n更新参数$w_{t+1}=w_t-\\eta_t$\n\n> 不同的优化器，只是定义了不同的动量函数\n\n- SGD，梯度下降法\n\n$m_t=g_t$   $V_t=1$\n\n$w_{t+1}=w_t-lr*g_t$\n\n\n\n- SGDM，SGD基础上增加了一阶动量\n\n$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$\n\n$V_t=1$\n\n\n\n- Adagrad，在SGD基础上增加二阶动量\n\n$m_t=g_t$ \n\n$V_t=\\sum^t_{\\tau=1}g^2_\\tau$\n\n\n\n- RMSProp，SGD基础上增加二阶动量\n\n$m_t=g_t$  \n\n$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$\n\n\n\n- Adam，同时结合SGDM一阶动量和RMSProp二阶动量\n\n$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$\n\n修正一阶动量的偏差：$\\hat{m_t}=\\frac{m_t}{1-\\beta^t_1}$\n\n$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$\n\n修正二阶动量的偏差：$\\hat{V_t}=\\frac{V_t}{1-\\beta^t_2}$\n\n# 10：搭建八股网络-Sequential\n\ntf.keras搭建网络八股\n\n六步法：\n\n1. import\n2. train,test\n3. model = tf.keras.models.Sequential\n4. model.compile\n5. model.fit\n6. model.summary\n\n- Sequential，描述各层网络\n\n拉直层：tf.keras.layers.Flatten()\n\n全连接层：tf.keras.layers.Dense(神经元个数,activation=\"激活函数\",kernel_regularizer=哪种正则化)\n\n> activation：relu、softmax、sigmoid、tanh\n>\n> kernel_regularizer：tf.keras.regularizers.l1()、tf.keras.regularizers.l2()\n\n卷积层：tf.keras.layers.Conv2D(filters = 卷积核个数,kernel_size = 卷积核尺寸,strides = 卷积步长,padding = \"valid\"or\"same\")\n\nLSTM层：tf.keras.layers.LSTM()\n\n- Compile\n\n```python\nmodel.compile(optimizer = 优化器,loss=损失函数,metrics=[\"准确率\"])\n```\n\n- Fit\n\n```\nmodel.fit(训练集的输入特征，训练集的标签，bathc_size=,epochs=,validation_data=(测试集的输入特征，测试集的标签)，validation_split=从训练集划分多少比例给测试集，validation_freq=多少次epoch测试一次)\n```\n\n- Summary\n\n```\nmodel.summary()\n```\n\n# 11：搭建网络八股-class\n\n```python\nclass MyModel(Model):\n\tdef __init__(self):\n\t\tsuper(MyModel,self).__init__()\n        定义网络结构块\n    def call(self,x):\n        调用网络结构块，实现前向传播\n        reutrn y\n        \n model = MyModel()\n```\n\n# 12：MNIST数据集\n\n提供6万张28*28像素点的0-9手写数字图片和标签，用于训练\n\n1万张28*28像素点的0-9手写数组图片和标签，用于测试\n\n- 导入MNIST数据集\n\n```\nmnist = tf.keras.datasets.mnist\n(x_train,y_train),(x_test,y_test)=mnist.load_data()\n```\n\n- 作为输入特征，将数据拉伸为一维数组\n\n```\ntf.keras.layers.Flatten()\n```\n\n# 13：Fasion_MNIST数据集\n\n```python\nimport tensorflow as tf\n\nfasion = tf.keras.datasets.fashion_mnist\n(x_train, y_train),(x_test,y_test) = fasion.load_data()\nx_train,x_test = x_train/255.0,x_test/255.0\n\nmodel = tf.keras.models.Sequential([\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(128,activation='relu'),\n    tf.keras.layers.Dense(10,activation = 'softmax')\n])\n\nmodel.compile(optimizer=\"adam\",loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),metrics=['sparse_categorical_accuracy'])\nmodel.fit(x_train,y_train,batch_size = 32,epochs=5,validation_data=(x_test,y_test),validation_freq = 1)\nmodel.summary()\n```\n\n# 14：自制数据集\n\n![](https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png)\n\n在`mnist_image_label`文件夹下有两个文件夹`mnist_train_jpg_60000`和`mnist_test_jpg_10000`\n\n每个文件夹分别放了对应个数的图片以及一个.txt文件，文件内容如上，jpg名+空格+标签\n\n现在需要重写`(x_train,y_train),(x_test,y_test)=mnist.load_data()`中的load_data()方法。\n\n```python\ndef generateds(path,txt):\n    f = open(txt,'r')\n    contents = f.readlines()\n    f.close()\n    x,y_ = [],[]\n    for content in contents:\n        value = content.split()\n        img_path = path+value[0]\n        img = Image.open(img_path)\n        img = np.array(img.convert('L'))\n        img = img/255.\n        x.append(img)\n        y_.append(value[1])\n        print('loading:'+content)\n    x = np.array(x)\n    y_ = np.array(y_)\n    y_ = y_.astype(np.int64)\n    return x,y_\n```\n\n保存数据集\n\n```python\nnp.save(保存路径带拓展,保存的内容)\n```\n\n# 15：数据增强\n\n```python\nimage_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(\n\trescale = 所有数据将乘以该数值\n\trotation = 随机旋转角度值范围\n    width_shift_range = 随机宽度偏移量\n    height_shift_range = 随机高度偏移量\n    horizontal_flip = 是否随机水平翻转\n    zoom_range = 随机缩放的范围[1-n,1+n])\nimage_gen_train.fit(x_train)\n```\n\nfit()中的数据是四位数据，所以需要对其reshape\n\nx_train = x_train.reshape(x_train.shape[0],28,28,1)\n\n最后的1表示灰度值。\n\nmodel.fit()方法内修改为\n\n```python\nmodel.fit(image_gen_train.flow(x_train,y_train,batch_size = 32),epochs=5,validation_data=(x_test,y_test),validation_freq = 1)\n```\n\n# 16：断点续训\n\n读取模型：\n\nload_weights(路径文件名)\n\n```python\ncheckpoint_save_path = \"./checkpoint/mnist.ckpt\"\nif os.path.exists(checkpoint_save_path + '.index')\n\tprint('-----load the model------')\n    model.load_weights(checkpoint_save_path)\n```\n\n保存模型\n\n```python\ncallback = tf.keras.callbacks.ModelCheckpoint(\n\tfilepath = 路径文件名,\n\tsave_weights_only=True/False,\n\tsave_best_only = True/False)\nhistory = model.fit(……callbacks = [cp_callback])\n```\n\n# 17：参数提取\n\nmodel.trainable_variables 返回模型中可训练的参数\n\n设置print输出格式\n\n```python\nnp.set_printoptions(threshold = 超过多少省略显示)\t#threshold=np.inf表示无限\n```\n\n```python\nnp.set_printoptions(threshold = np.inf)\nprint(model.trainable_variables)\nfile = open('./weights.txt','w')\nfor v in model.trainable_variables:\n\tfile.write(str(v.name)+'\\n')\n    file.write(str(v.shape)+'\\n')\n    file.write(str(v.numpy())+'\\n')\nfile.close()\n```\n\n# 18：acc曲线和loss曲线可视化\n\n```python\nhistory = model.fit()\nacc = history.history['sparse_categorical_accuracy']\t#训练集准确率\nval_acc = history.history['val_sparse_categorical_accuracy']\t#测试集准确率\nloss = history.history['loss']\t#训练集loss\nval_loss = history.history['val_loss']\t#测试集loss\n```\n\n画图\n\n```python\nplt.subplot(1,2,1)\nplt.plot(acc,label=\"Training Accuracy\")\nplt.plot(val_acc,label=\"Validation Accuracy\")\nplt.title(\"Training and Validation Accuracy\")\nplt.legend()\n\nplt.subplot(1,2,2)\nplt.plot(loss,label=\"Training Loss\")\nplt.plot(val_loss,label=\"Validation Loss\")\nplt.title('Training and Validation Loss')\nplt.legend()\nplt.show()\n```\n\n# 19：样例预测\n\npredict(输入特征,batch_size=整数)\n\n```python\n#复现模型\nmodel = tf.keras.models.Sequential([\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(128,activation = 'relu'),\n    tf.keras.layers.Dense(10,activation = 'softmax')])\n#加载参数\nmodel.load_weights(model_save_path)\n#预测结果\nresult = model.predict(x_predict)\n```\n\n# 20：卷积计算过程\n\n原始彩色图片——>若干层特征提取——>全连接网络\n\n主要模块：(CBAPD)\n\n卷积(Convolutional)->批标准化(BN)->激活(Activation)->池化(Pooling)->舍弃(Dropout)\n\n# 21：感受野\n\n感受野：卷积神经网络各输出特征图中的每个像素点，在原始输入图片上映射区域的大小。\n\n比如：\n\n1：\n\n5x5原始图，使用3x3卷积核，生成的3x3特征图，那么其感受野是3.\n\n将生成的3x3特征图，再次使用3x3卷积核作用，生成1x1特征图，那么这个特征图相对于原始图，感受野为5.\n\n2：\n\n5x5原始图，使用5x5卷积核，生成1x1特征图，其感受野同样为5\n\n长款x大于10时，两层3x3卷积核性能优于一层5x5卷积核\n\n# 22：全零填充\n\n特征图一圈填充零。\n\n特征图边长\n$$\npadding=\\begin{cases}\nSAME(全0填充)\\ \\frac{入长}{步长}\\ (向上取整)\n\\\\VALID(不全0填充)\\ \\frac{入长-核长+1}{步长}\\ (向上取整)\n\\end{cases}\n$$\n\n# 23：描述卷积层\n\n```python\ntf.keras.layers.Conv2D(\n\tfilter = 卷积核个数,\n    kernel_size = 卷积核尺寸，\t#正方形写核长整数，或（核高，核宽）\n    strides = 滑动步长,\t#横纵相同写步长整数，或（纵向步长，横向步长）\n    padding = \"same\" or \"valid\"\t#全零填充same，非全零valid\n    activation = \"relu\" or \"sigmoid\",\n    input_shape = (高，宽，通道数)\t#输入特征图维度，可省\n)\n```\n\n# 24：批标准化（Batch Normalization）\n\n标准化：使数据符合0均值，1为标准差的分布\n\n批标准化：对一小批数据，做标准化\n$$\nH'^k_i = \\frac{H^k_i-\\mu^k_{batch}}{\\sigma_{batch}^k}\n$$\nk：第k个卷积核\n\ni：第i个像素点\n\nH'：批标准化之后\n\nH：批标准化之前\n\n上述式子，要求批标准化之前的特征数据即满足正态分布。\n\n通常使用：\n$$\nx^k_i=\\gamma_kH'^k_i+\\beta_k\n$$\n$\\gamma_k$:缩放因子\n\n$\\beta_k$:偏移因子\n\n调整分布的宽窄和偏移。\n\nBN层位于，卷积层之后，激活层之前。\n\n```\ntf.keras.layers.BatchNormalization()\n```\n\n# 25：池化\n\n池化用于减少特征数据量。\n\n最大池化，均值池化\n\n```python\ntf.keras.layers.MaxPool2D(\n\tpool_size=池化核尺寸\n\tstrides=池化步长\n\tpadding='valid' or 'same'\t#全零填充？\n)\ntf.keras.layers.AveragePooling2D()\n```\n\n# 26：舍弃（dropout）\n\n在神经网络训练时，将一部分神经元按照一定概率从神经网络中暂时舍弃，神经网络使用时，被舍弃的神经元恢复连接。\n\n```python\ntf.keras.layers.Dropout(舍弃概率)\n```\n\n# 27：Cifar10数据集\n\n五万张32*32像素点的是分类彩色图片和标签，用于训练\n\n测试1万张\n\n# 28：LeNet\n\n输入：32*32\n\n","source":"_posts/北大人工智能实践——TensorFlow2.md","raw":"---\ntitle: 北大人工智能实践——TensorFlow2\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-11-12 16:10:33\npassword:\nsummary:\ntags: 人工智能\ncategories: 学习笔记\n---\n\n# 1：人工智能三学派\t\n\n- 准备数据\n- 搭建网络\n- 优化参数\n- 应用网络\n\n# 2：神经网络设计过程\n\n鸢尾花的分类：\n\n通过测量花萼长、花萼宽。\n\nif语句case语句——**专家系统**把专家的经验告知计算机，计算机执行逻辑判断。给出分类\n\n神经网络：采集大量数据对构成数据集。\n\n# 3：张量生成\n\n张量（Tensor）：多维数组（列表）\t阶：张量的维数\n\n| 阶   | 名字 | 例子      |\n| ---- | ---- | --------- |\n| 0    | 标量 | S=1 2 3   |\n| 1    | 向量 | v=[1,2,3] |\n| 2    | 矩阵 |           |\n| n    | 张量 |           |\n\n创建张量\n\n```python\na = tf.constan(张量内容,dtype = 数据类型)\nprint(a)\nprint(a.dtype)\nprint(a.shape)\n```\n\n```python\ntf.zeros(维度)\ntf.ones(维度)\ntf.fill(维度，指定值)\nc = tf.fill([2,2],9)\t//两行两列\n```\n\n```python\ntf.random.normal(维度,mean=均值,stddev=标准差)\ntf.random.truncated_normal(维度，mean=均值,stddev=标准差)\ntf.random.uniform(维度,minval=最小值,maxval=最大值)\n```\n\n# 4：常用函数\n\n```\ntf.cast(张量名,dtype=数据类型)\t//强制转换数据类型\ntf.reduce_min()\t//计算最大值\ntf.reduce_max()\n```\n\n\n\n```python\ntf.reduce_mean(张量名,axis=操作轴)\t//计算张量延指定维度平均值\ntf.reduce_sum(张量名,axis=操作轴)\t//计算沿指定维度的和\n```\n\n未指定操作轴，则为对全部数进行操作\n\n变量：\n\n```\ntf.Variable(初始值)\n```\n\n数学运算\n\n```\ntf.add()\ntf.subtract()\ntf.multiply()\ntf.divide()\n//只有维度相同才能进行四则运算\ntf.square(张量名)\t平方\ntf.pow()\t//n次方\ntf.sqrt()\t//开方\n```\n\n矩阵乘\n\n```python\ntf.matmul(矩阵1，矩阵2)\n```\n\n特征和标签对应：\n\n```\nfeatures = tf.constant([12,23,10,14])\nlabels = tf.constant([0,1,1,0])\ndataset = tf.data.Dataset.from_tensor_slices((features,labels))\n```\n\n计算梯度\n\n```python\nwith tf.GradientTape() as tape:\n\tw = tf.Variable(tf.constant(3.0))\n\tloss = tf.pow(w,2)\ngrad = tape.gradient(loss,w)\n```\n\n**enumerate**\n\n```python\nseq = ['one','two','three']\nfor i,element in enumerate(seq):\n\tprint(i,element)\n```\n\n独热编码：\n\n标记类别：1表示是，0表示否\n\n```\ntf.one_hot(待转换数据，depth=几分类)\n```\n\n输出符合概率分布：\n\n```python\ntf.nn.softmax(x)\n\ny = tf.constant([1.01,2.01,-0.66])\ny_pro = tf.nn.softmax(y)\n```\n\n参数自更新：\n\n```\nw = tf.Variable(4)\nw.assign_sub(1)\t//w-=1\nprint(w)\n```\n\n返回最大值索引\n\n```\ntf.argmax(张量名，axis=操作轴)\n```\n\n条件语句：\n\n```\ntf.where(条件语句,真返回A,假返回B)\n```\n\n返回[0,1)之间的随机数\n\n```python\nnp.random.RandomState.rand(维度)\n```\n\n将两个数组按垂直方向叠加（一维—>二维）：\n\n```python\nnp.vstack(数组1，数组2)\n```\n\n```python\nx,y = np.mgrid[1:3:1,2:4:0.5]\t//x=[[1 1 1 1]\n                                     [2 2 2 2]]\n\t\t\t\t\t\t\t\t\ty=[[2 2.5 3 3.5]\n                                       [2 2.5 3 3.5]] \ngird = np.c_[x.ravel(),y.ravel()]\t//ravel()降维到一维，np.c_[数组1，数组2]配对。\n```\n\n# 5：神经网络(NN)复杂度\n\nNN复杂度：多用NN层数和NN参数的个数表示。\n\n- 空间复杂度\n- 时间复杂度\n\n学习率:\n$$\nw_{t+1} = w_t+lr*gradient\n$$\n指数衰减学习率:\n$$\n指数衰减学习率=初始学习率*学习率衰减率^{当前轮数/多少轮衰减一次}\n\\\\\\\\epoch= 40\n\\\\\\\\LR\\_BASE= 0.2\n\\\\\\\\LR\\_DECAY= 0.99\n\\\\\\\\LR\\_STEP=1\n$$\n\n```python\nfor epoch in range(epoch):\n    lr = LR_BASE*LR_DECAY**(epoch/LR_STEP)\n    with tf.GradientTape() as tape:\n        loss = tf.square(w+1)\n    grads = tape.gradient(loss,w)\n    w.assign_sub(lr*grads)\n```\n\n# 6：激活函数\n\n$$\ny = f(wx+b)\n$$\n\n- Sigmoid函数\n\n$$\nf(x)=\\frac{1}{1+e^{-x}}\n$$\n\n```python\ntf.nn.sigmoid(x)\n```\n\n> 易造成梯度消失\n>\n> 输出非0均值，收敛慢\n>\n> 幂运算复杂，训练时间长\n\n- Tanh函数\n\n$$\nf(x) = \\frac{1-e^{-2x}}{1+e^{-2x}}\n$$\n\n```\ntf.math.tanh(x)\n```\n\n- Relu函数\n\n$$\n\\begin{align}\nf(x)=& max(x,0)\n\\\\\\\\=& \\begin{cases}\n0\\qquad x<0\\\\\nx\\qquad x>=0\n\\end{cases}\n\\end{align}\n$$\n\n```\ntf.nn.relu(x)\n```\n\n- Leaky Relu函数\n\n$$\nf(x)=max(ax,x)\n$$\n\n```\ntf.nn.leaky_relu(x)\n```\n\n> 初学者：\n>\n> - 首选Relu函数\n> - 学习率设置较小值\n> - 输入特征标准化，让输入特征满足以0为均值，1为标准差的正态分布\n> - 初始参数中心化，让随机生成的参数满足以0为均值，sqrt(2/当前层输入特征个数)为标准差的正态分布\n\n# 7：损失函数\n\nloss：预测值(y)与已知答案(y_)的差距\n\n- 均方误差mse：\n\n$$\nMSE(y\\_,y)=\\frac{\\sum^n_{i=1}(y-y\\_)^2}{n}\n$$\n\n```python\nloss_mse = tf.reduce_mean(tf.square(y-y_))\n```\n\n- 自定义损失函数\n\ny_:标准答案\n\ny:预测答案\n$$\nf(y\\_,y)=\\begin{cases}\nPROFIT*(y\\_-y)\\quad y<y\\_ \\ 预测的y少了，损失利润\n\\\\COST*(y-y\\_)\\quad y>=y\\_ \\ 预测的y多了，损失成本\n\\end{cases}\n$$\n\n```python\nloss_diy = tf.reduce_sum(tf.where(tf.greater(y,y_),COST(y-y_),PROFIT(y_-y)))\t//y>y_?,为真COST，为假PROFIT\n```\n\n- 交叉熵损失函数CE：表征两个概率分布之间的距离\n\n$$\nH(y\\_,y)=-\\sum y\\_*lny\n$$\n\n```python\ntf.losses.categorical_crossentropy(y_,y)\n```\n\n- softmax和交叉熵结合\n\nsoftmax计算概率分布\n\n```python\ntf.nn.softmax_cross_entropy_with_logits(y_,y)\n```\n\n# 8：缓解过拟合\n\n- 正则化缓解过拟合\n\n正则化在损失函数中引入模型复杂度指标，利用给W加权值，弱化训练数据的噪声。\n\n$$\nloss=loss(y与y\\_)+REGULARIZER*losss(w)\n$$\n\nL2正则化\n\n```\nwith tf.GradientTape() as tape:\n\th1 = tf.matmul(x_train,w1)+b1\n\th1 = tf.nn.relu(h1)\n\ty = tf.matmul(h1,w2) + b2\n\tloss_mse = tf.reduce_mean(tf.square(y_train - y))\n\tloss_regularization = []\n\tloss_regularization.append(tf.nn.l2_loss(w1))\n\tloss_regularization.append(tf.nn.l2_loss(w2))\n\tloss_regularization = tf.reduce_sum(loss_regularization)\n\tloss = loss_mse + 0.03*loss_regularization\n\t\n```\n\n# 9：优化器\n\n$m_t$：一阶动量(与梯度相关的函数)\t$V_t$：二阶动量(与梯度平方相关的函数)\n\n下降梯度$\\eta_t=lr*m_t/\\sqrt{V_t}$\n\n更新参数$w_{t+1}=w_t-\\eta_t$\n\n> 不同的优化器，只是定义了不同的动量函数\n\n- SGD，梯度下降法\n\n$m_t=g_t$   $V_t=1$\n\n$w_{t+1}=w_t-lr*g_t$\n\n\n\n- SGDM，SGD基础上增加了一阶动量\n\n$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$\n\n$V_t=1$\n\n\n\n- Adagrad，在SGD基础上增加二阶动量\n\n$m_t=g_t$ \n\n$V_t=\\sum^t_{\\tau=1}g^2_\\tau$\n\n\n\n- RMSProp，SGD基础上增加二阶动量\n\n$m_t=g_t$  \n\n$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$\n\n\n\n- Adam，同时结合SGDM一阶动量和RMSProp二阶动量\n\n$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$\n\n修正一阶动量的偏差：$\\hat{m_t}=\\frac{m_t}{1-\\beta^t_1}$\n\n$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$\n\n修正二阶动量的偏差：$\\hat{V_t}=\\frac{V_t}{1-\\beta^t_2}$\n\n# 10：搭建八股网络-Sequential\n\ntf.keras搭建网络八股\n\n六步法：\n\n1. import\n2. train,test\n3. model = tf.keras.models.Sequential\n4. model.compile\n5. model.fit\n6. model.summary\n\n- Sequential，描述各层网络\n\n拉直层：tf.keras.layers.Flatten()\n\n全连接层：tf.keras.layers.Dense(神经元个数,activation=\"激活函数\",kernel_regularizer=哪种正则化)\n\n> activation：relu、softmax、sigmoid、tanh\n>\n> kernel_regularizer：tf.keras.regularizers.l1()、tf.keras.regularizers.l2()\n\n卷积层：tf.keras.layers.Conv2D(filters = 卷积核个数,kernel_size = 卷积核尺寸,strides = 卷积步长,padding = \"valid\"or\"same\")\n\nLSTM层：tf.keras.layers.LSTM()\n\n- Compile\n\n```python\nmodel.compile(optimizer = 优化器,loss=损失函数,metrics=[\"准确率\"])\n```\n\n- Fit\n\n```\nmodel.fit(训练集的输入特征，训练集的标签，bathc_size=,epochs=,validation_data=(测试集的输入特征，测试集的标签)，validation_split=从训练集划分多少比例给测试集，validation_freq=多少次epoch测试一次)\n```\n\n- Summary\n\n```\nmodel.summary()\n```\n\n# 11：搭建网络八股-class\n\n```python\nclass MyModel(Model):\n\tdef __init__(self):\n\t\tsuper(MyModel,self).__init__()\n        定义网络结构块\n    def call(self,x):\n        调用网络结构块，实现前向传播\n        reutrn y\n        \n model = MyModel()\n```\n\n# 12：MNIST数据集\n\n提供6万张28*28像素点的0-9手写数字图片和标签，用于训练\n\n1万张28*28像素点的0-9手写数组图片和标签，用于测试\n\n- 导入MNIST数据集\n\n```\nmnist = tf.keras.datasets.mnist\n(x_train,y_train),(x_test,y_test)=mnist.load_data()\n```\n\n- 作为输入特征，将数据拉伸为一维数组\n\n```\ntf.keras.layers.Flatten()\n```\n\n# 13：Fasion_MNIST数据集\n\n```python\nimport tensorflow as tf\n\nfasion = tf.keras.datasets.fashion_mnist\n(x_train, y_train),(x_test,y_test) = fasion.load_data()\nx_train,x_test = x_train/255.0,x_test/255.0\n\nmodel = tf.keras.models.Sequential([\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(128,activation='relu'),\n    tf.keras.layers.Dense(10,activation = 'softmax')\n])\n\nmodel.compile(optimizer=\"adam\",loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),metrics=['sparse_categorical_accuracy'])\nmodel.fit(x_train,y_train,batch_size = 32,epochs=5,validation_data=(x_test,y_test),validation_freq = 1)\nmodel.summary()\n```\n\n# 14：自制数据集\n\n![](https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png)\n\n在`mnist_image_label`文件夹下有两个文件夹`mnist_train_jpg_60000`和`mnist_test_jpg_10000`\n\n每个文件夹分别放了对应个数的图片以及一个.txt文件，文件内容如上，jpg名+空格+标签\n\n现在需要重写`(x_train,y_train),(x_test,y_test)=mnist.load_data()`中的load_data()方法。\n\n```python\ndef generateds(path,txt):\n    f = open(txt,'r')\n    contents = f.readlines()\n    f.close()\n    x,y_ = [],[]\n    for content in contents:\n        value = content.split()\n        img_path = path+value[0]\n        img = Image.open(img_path)\n        img = np.array(img.convert('L'))\n        img = img/255.\n        x.append(img)\n        y_.append(value[1])\n        print('loading:'+content)\n    x = np.array(x)\n    y_ = np.array(y_)\n    y_ = y_.astype(np.int64)\n    return x,y_\n```\n\n保存数据集\n\n```python\nnp.save(保存路径带拓展,保存的内容)\n```\n\n# 15：数据增强\n\n```python\nimage_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(\n\trescale = 所有数据将乘以该数值\n\trotation = 随机旋转角度值范围\n    width_shift_range = 随机宽度偏移量\n    height_shift_range = 随机高度偏移量\n    horizontal_flip = 是否随机水平翻转\n    zoom_range = 随机缩放的范围[1-n,1+n])\nimage_gen_train.fit(x_train)\n```\n\nfit()中的数据是四位数据，所以需要对其reshape\n\nx_train = x_train.reshape(x_train.shape[0],28,28,1)\n\n最后的1表示灰度值。\n\nmodel.fit()方法内修改为\n\n```python\nmodel.fit(image_gen_train.flow(x_train,y_train,batch_size = 32),epochs=5,validation_data=(x_test,y_test),validation_freq = 1)\n```\n\n# 16：断点续训\n\n读取模型：\n\nload_weights(路径文件名)\n\n```python\ncheckpoint_save_path = \"./checkpoint/mnist.ckpt\"\nif os.path.exists(checkpoint_save_path + '.index')\n\tprint('-----load the model------')\n    model.load_weights(checkpoint_save_path)\n```\n\n保存模型\n\n```python\ncallback = tf.keras.callbacks.ModelCheckpoint(\n\tfilepath = 路径文件名,\n\tsave_weights_only=True/False,\n\tsave_best_only = True/False)\nhistory = model.fit(……callbacks = [cp_callback])\n```\n\n# 17：参数提取\n\nmodel.trainable_variables 返回模型中可训练的参数\n\n设置print输出格式\n\n```python\nnp.set_printoptions(threshold = 超过多少省略显示)\t#threshold=np.inf表示无限\n```\n\n```python\nnp.set_printoptions(threshold = np.inf)\nprint(model.trainable_variables)\nfile = open('./weights.txt','w')\nfor v in model.trainable_variables:\n\tfile.write(str(v.name)+'\\n')\n    file.write(str(v.shape)+'\\n')\n    file.write(str(v.numpy())+'\\n')\nfile.close()\n```\n\n# 18：acc曲线和loss曲线可视化\n\n```python\nhistory = model.fit()\nacc = history.history['sparse_categorical_accuracy']\t#训练集准确率\nval_acc = history.history['val_sparse_categorical_accuracy']\t#测试集准确率\nloss = history.history['loss']\t#训练集loss\nval_loss = history.history['val_loss']\t#测试集loss\n```\n\n画图\n\n```python\nplt.subplot(1,2,1)\nplt.plot(acc,label=\"Training Accuracy\")\nplt.plot(val_acc,label=\"Validation Accuracy\")\nplt.title(\"Training and Validation Accuracy\")\nplt.legend()\n\nplt.subplot(1,2,2)\nplt.plot(loss,label=\"Training Loss\")\nplt.plot(val_loss,label=\"Validation Loss\")\nplt.title('Training and Validation Loss')\nplt.legend()\nplt.show()\n```\n\n# 19：样例预测\n\npredict(输入特征,batch_size=整数)\n\n```python\n#复现模型\nmodel = tf.keras.models.Sequential([\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(128,activation = 'relu'),\n    tf.keras.layers.Dense(10,activation = 'softmax')])\n#加载参数\nmodel.load_weights(model_save_path)\n#预测结果\nresult = model.predict(x_predict)\n```\n\n# 20：卷积计算过程\n\n原始彩色图片——>若干层特征提取——>全连接网络\n\n主要模块：(CBAPD)\n\n卷积(Convolutional)->批标准化(BN)->激活(Activation)->池化(Pooling)->舍弃(Dropout)\n\n# 21：感受野\n\n感受野：卷积神经网络各输出特征图中的每个像素点，在原始输入图片上映射区域的大小。\n\n比如：\n\n1：\n\n5x5原始图，使用3x3卷积核，生成的3x3特征图，那么其感受野是3.\n\n将生成的3x3特征图，再次使用3x3卷积核作用，生成1x1特征图，那么这个特征图相对于原始图，感受野为5.\n\n2：\n\n5x5原始图，使用5x5卷积核，生成1x1特征图，其感受野同样为5\n\n长款x大于10时，两层3x3卷积核性能优于一层5x5卷积核\n\n# 22：全零填充\n\n特征图一圈填充零。\n\n特征图边长\n$$\npadding=\\begin{cases}\nSAME(全0填充)\\ \\frac{入长}{步长}\\ (向上取整)\n\\\\VALID(不全0填充)\\ \\frac{入长-核长+1}{步长}\\ (向上取整)\n\\end{cases}\n$$\n\n# 23：描述卷积层\n\n```python\ntf.keras.layers.Conv2D(\n\tfilter = 卷积核个数,\n    kernel_size = 卷积核尺寸，\t#正方形写核长整数，或（核高，核宽）\n    strides = 滑动步长,\t#横纵相同写步长整数，或（纵向步长，横向步长）\n    padding = \"same\" or \"valid\"\t#全零填充same，非全零valid\n    activation = \"relu\" or \"sigmoid\",\n    input_shape = (高，宽，通道数)\t#输入特征图维度，可省\n)\n```\n\n# 24：批标准化（Batch Normalization）\n\n标准化：使数据符合0均值，1为标准差的分布\n\n批标准化：对一小批数据，做标准化\n$$\nH'^k_i = \\frac{H^k_i-\\mu^k_{batch}}{\\sigma_{batch}^k}\n$$\nk：第k个卷积核\n\ni：第i个像素点\n\nH'：批标准化之后\n\nH：批标准化之前\n\n上述式子，要求批标准化之前的特征数据即满足正态分布。\n\n通常使用：\n$$\nx^k_i=\\gamma_kH'^k_i+\\beta_k\n$$\n$\\gamma_k$:缩放因子\n\n$\\beta_k$:偏移因子\n\n调整分布的宽窄和偏移。\n\nBN层位于，卷积层之后，激活层之前。\n\n```\ntf.keras.layers.BatchNormalization()\n```\n\n# 25：池化\n\n池化用于减少特征数据量。\n\n最大池化，均值池化\n\n```python\ntf.keras.layers.MaxPool2D(\n\tpool_size=池化核尺寸\n\tstrides=池化步长\n\tpadding='valid' or 'same'\t#全零填充？\n)\ntf.keras.layers.AveragePooling2D()\n```\n\n# 26：舍弃（dropout）\n\n在神经网络训练时，将一部分神经元按照一定概率从神经网络中暂时舍弃，神经网络使用时，被舍弃的神经元恢复连接。\n\n```python\ntf.keras.layers.Dropout(舍弃概率)\n```\n\n# 27：Cifar10数据集\n\n五万张32*32像素点的是分类彩色图片和标签，用于训练\n\n测试1万张\n\n# 28：LeNet\n\n输入：32*32\n\n","slug":"北大人工智能实践——TensorFlow2","published":1,"updated":"2020-11-16T17:58:27.052Z","_id":"ckhi87lwq0000jgvzdit3h8gw","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1：人工智能三学派\"><a href=\"#1：人工智能三学派\" class=\"headerlink\" title=\"1：人工智能三学派\"></a>1：人工智能三学派</h1><ul>\n<li>准备数据</li>\n<li>搭建网络</li>\n<li>优化参数</li>\n<li>应用网络</li>\n</ul>\n<h1 id=\"2：神经网络设计过程\"><a href=\"#2：神经网络设计过程\" class=\"headerlink\" title=\"2：神经网络设计过程\"></a>2：神经网络设计过程</h1><p>鸢尾花的分类：</p>\n<p>通过测量花萼长、花萼宽。</p>\n<p>if语句case语句——<strong>专家系统</strong>把专家的经验告知计算机，计算机执行逻辑判断。给出分类</p>\n<p>神经网络：采集大量数据对构成数据集。</p>\n<h1 id=\"3：张量生成\"><a href=\"#3：张量生成\" class=\"headerlink\" title=\"3：张量生成\"></a>3：张量生成</h1><p>张量（Tensor）：多维数组（列表）    阶：张量的维数</p>\n<table>\n<thead>\n<tr>\n<th>阶</th>\n<th>名字</th>\n<th>例子</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>标量</td>\n<td>S=1 2 3</td>\n</tr>\n<tr>\n<td>1</td>\n<td>向量</td>\n<td>v=[1,2,3]</td>\n</tr>\n<tr>\n<td>2</td>\n<td>矩阵</td>\n<td></td>\n</tr>\n<tr>\n<td>n</td>\n<td>张量</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>创建张量</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = tf.constan(张量内容,dtype = 数据类型)</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(a.dtype)</span><br><span class=\"line\">print(a.shape)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.zeros(维度)</span><br><span class=\"line\">tf.ones(维度)</span><br><span class=\"line\">tf.fill(维度，指定值)</span><br><span class=\"line\">c = tf.fill([<span class=\"number\">2</span>,<span class=\"number\">2</span>],<span class=\"number\">9</span>)\t//两行两列</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.random.normal(维度,mean=均值,stddev=标准差)</span><br><span class=\"line\">tf.random.truncated_normal(维度，mean=均值,stddev=标准差)</span><br><span class=\"line\">tf.random.uniform(维度,minval=最小值,maxval=最大值)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：常用函数\"><a href=\"#4：常用函数\" class=\"headerlink\" title=\"4：常用函数\"></a>4：常用函数</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.cast(张量名,dtype&#x3D;数据类型)\t&#x2F;&#x2F;强制转换数据类型</span><br><span class=\"line\">tf.reduce_min()\t&#x2F;&#x2F;计算最大值</span><br><span class=\"line\">tf.reduce_max()</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.reduce_mean(张量名,axis=操作轴)\t//计算张量延指定维度平均值</span><br><span class=\"line\">tf.reduce_sum(张量名,axis=操作轴)\t//计算沿指定维度的和</span><br></pre></td></tr></table></figure>\n\n<p>未指定操作轴，则为对全部数进行操作</p>\n<p>变量：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.Variable(初始值)</span><br></pre></td></tr></table></figure>\n\n<p>数学运算</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.add()</span><br><span class=\"line\">tf.subtract()</span><br><span class=\"line\">tf.multiply()</span><br><span class=\"line\">tf.divide()</span><br><span class=\"line\">&#x2F;&#x2F;只有维度相同才能进行四则运算</span><br><span class=\"line\">tf.square(张量名)\t平方</span><br><span class=\"line\">tf.pow()\t&#x2F;&#x2F;n次方</span><br><span class=\"line\">tf.sqrt()\t&#x2F;&#x2F;开方</span><br></pre></td></tr></table></figure>\n\n<p>矩阵乘</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.matmul(矩阵<span class=\"number\">1</span>，矩阵<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p>特征和标签对应：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">features &#x3D; tf.constant([12,23,10,14])</span><br><span class=\"line\">labels &#x3D; tf.constant([0,1,1,0])</span><br><span class=\"line\">dataset &#x3D; tf.data.Dataset.from_tensor_slices((features,labels))</span><br></pre></td></tr></table></figure>\n\n<p>计算梯度</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> tf.GradientTape() <span class=\"keyword\">as</span> tape:</span><br><span class=\"line\">\tw = tf.Variable(tf.constant(<span class=\"number\">3.0</span>))</span><br><span class=\"line\">\tloss = tf.pow(w,<span class=\"number\">2</span>)</span><br><span class=\"line\">grad = tape.gradient(loss,w)</span><br></pre></td></tr></table></figure>\n\n<p><strong>enumerate</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">seq = [<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i,element <span class=\"keyword\">in</span> enumerate(seq):</span><br><span class=\"line\">\tprint(i,element)</span><br></pre></td></tr></table></figure>\n\n<p>独热编码：</p>\n<p>标记类别：1表示是，0表示否</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.one_hot(待转换数据，depth&#x3D;几分类)</span><br></pre></td></tr></table></figure>\n\n<p>输出符合概率分布：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.softmax(x)</span><br><span class=\"line\"></span><br><span class=\"line\">y = tf.constant([<span class=\"number\">1.01</span>,<span class=\"number\">2.01</span>,<span class=\"number\">-0.66</span>])</span><br><span class=\"line\">y_pro = tf.nn.softmax(y)</span><br></pre></td></tr></table></figure>\n\n<p>参数自更新：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">w &#x3D; tf.Variable(4)</span><br><span class=\"line\">w.assign_sub(1)\t&#x2F;&#x2F;w-&#x3D;1</span><br><span class=\"line\">print(w)</span><br></pre></td></tr></table></figure>\n\n<p>返回最大值索引</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.argmax(张量名，axis&#x3D;操作轴)</span><br></pre></td></tr></table></figure>\n\n<p>条件语句：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.where(条件语句,真返回A,假返回B)</span><br></pre></td></tr></table></figure>\n\n<p>返回[0,1)之间的随机数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.random.RandomState.rand(维度)</span><br></pre></td></tr></table></figure>\n\n<p>将两个数组按垂直方向叠加（一维—&gt;二维）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.vstack(数组<span class=\"number\">1</span>，数组<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x,y = np.mgrid[<span class=\"number\">1</span>:<span class=\"number\">3</span>:<span class=\"number\">1</span>,<span class=\"number\">2</span>:<span class=\"number\">4</span>:<span class=\"number\">0.5</span>]\t//x=[[<span class=\"number\">1</span> <span class=\"number\">1</span> <span class=\"number\">1</span> <span class=\"number\">1</span>]</span><br><span class=\"line\">                                     [<span class=\"number\">2</span> <span class=\"number\">2</span> <span class=\"number\">2</span> <span class=\"number\">2</span>]]</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\ty=[[<span class=\"number\">2</span> <span class=\"number\">2.5</span> <span class=\"number\">3</span> <span class=\"number\">3.5</span>]</span><br><span class=\"line\">                                       [<span class=\"number\">2</span> <span class=\"number\">2.5</span> <span class=\"number\">3</span> <span class=\"number\">3.5</span>]] </span><br><span class=\"line\">gird = np.c_[x.ravel(),y.ravel()]\t//ravel()降维到一维，np.c_[数组<span class=\"number\">1</span>，数组<span class=\"number\">2</span>]配对。</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：神经网络-NN-复杂度\"><a href=\"#5：神经网络-NN-复杂度\" class=\"headerlink\" title=\"5：神经网络(NN)复杂度\"></a>5：神经网络(NN)复杂度</h1><p>NN复杂度：多用NN层数和NN参数的个数表示。</p>\n<ul>\n<li>空间复杂度</li>\n<li>时间复杂度</li>\n</ul>\n<p>学习率:<br>$$<br>w_{t+1} = w_t+lr<em>gradient<br>$$<br>指数衰减学习率:<br>$$<br>指数衰减学习率=初始学习率</em>学习率衰减率^{当前轮数/多少轮衰减一次}<br>\\\\epoch= 40<br>\\\\LR_BASE= 0.2<br>\\\\LR_DECAY= 0.99<br>\\\\LR_STEP=1<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> range(epoch):</span><br><span class=\"line\">    lr = LR_BASE*LR_DECAY**(epoch/LR_STEP)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> tf.GradientTape() <span class=\"keyword\">as</span> tape:</span><br><span class=\"line\">        loss = tf.square(w+<span class=\"number\">1</span>)</span><br><span class=\"line\">    grads = tape.gradient(loss,w)</span><br><span class=\"line\">    w.assign_sub(lr*grads)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6：激活函数\"><a href=\"#6：激活函数\" class=\"headerlink\" title=\"6：激活函数\"></a>6：激活函数</h1><p>$$<br>y = f(wx+b)<br>$$</p>\n<ul>\n<li>Sigmoid函数</li>\n</ul>\n<p>$$<br>f(x)=\\frac{1}{1+e^{-x}}<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.sigmoid(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>易造成梯度消失</p>\n<p>输出非0均值，收敛慢</p>\n<p>幂运算复杂，训练时间长</p>\n</blockquote>\n<ul>\n<li>Tanh函数</li>\n</ul>\n<p>$$<br>f(x) = \\frac{1-e^{-2x}}{1+e^{-2x}}<br>$$</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.math.tanh(x)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Relu函数</li>\n</ul>\n<p>$$<br>\\begin{align}<br>f(x)=&amp; max(x,0)<br>\\\\=&amp; \\begin{cases}<br>0\\qquad x&lt;0\\<br>x\\qquad x&gt;=0<br>\\end{cases}<br>\\end{align}<br>$$</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.relu(x)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Leaky Relu函数</li>\n</ul>\n<p>$$<br>f(x)=max(ax,x)<br>$$</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.leaky_relu(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>初学者：</p>\n<ul>\n<li>首选Relu函数</li>\n<li>学习率设置较小值</li>\n<li>输入特征标准化，让输入特征满足以0为均值，1为标准差的正态分布</li>\n<li>初始参数中心化，让随机生成的参数满足以0为均值，sqrt(2/当前层输入特征个数)为标准差的正态分布</li>\n</ul>\n</blockquote>\n<h1 id=\"7：损失函数\"><a href=\"#7：损失函数\" class=\"headerlink\" title=\"7：损失函数\"></a>7：损失函数</h1><p>loss：预测值(y)与已知答案(y_)的差距</p>\n<ul>\n<li>均方误差mse：</li>\n</ul>\n<p>$$<br>MSE(y_,y)=\\frac{\\sum^n_{i=1}(y-y_)^2}{n}<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_mse = tf.reduce_mean(tf.square(y-y_))</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>自定义损失函数</li>\n</ul>\n<p>y_:标准答案</p>\n<p>y:预测答案<br>$$<br>f(y_,y)=\\begin{cases}<br>PROFIT*(y_-y)\\quad y&lt;y_ \\ 预测的y少了，损失利润<br>\\COST*(y-y_)\\quad y&gt;=y_ \\ 预测的y多了，损失成本<br>\\end{cases}<br>$$</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_diy = tf.reduce_sum(tf.where(tf.greater(y,y_),COST(y-y_),PROFIT(y_-y)))\t//y&gt;y_?,为真COST，为假PROFIT</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>交叉熵损失函数CE：表征两个概率分布之间的距离</li>\n</ul>\n<p>$$<br>H(y_,y)=-\\sum y_*lny<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.losses.categorical_crossentropy(y_,y)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>softmax和交叉熵结合</li>\n</ul>\n<p>softmax计算概率分布</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.softmax_cross_entropy_with_logits(y_,y)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"8：缓解过拟合\"><a href=\"#8：缓解过拟合\" class=\"headerlink\" title=\"8：缓解过拟合\"></a>8：缓解过拟合</h1><ul>\n<li>正则化缓解过拟合</li>\n</ul>\n<p>正则化在损失函数中引入模型复杂度指标，利用给W加权值，弱化训练数据的噪声。</p>\n<p>$$<br>loss=loss(y与y_)+REGULARIZER*losss(w)<br>$$</p>\n<p>L2正则化</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">with tf.GradientTape() as tape:</span><br><span class=\"line\">\th1 &#x3D; tf.matmul(x_train,w1)+b1</span><br><span class=\"line\">\th1 &#x3D; tf.nn.relu(h1)</span><br><span class=\"line\">\ty &#x3D; tf.matmul(h1,w2) + b2</span><br><span class=\"line\">\tloss_mse &#x3D; tf.reduce_mean(tf.square(y_train - y))</span><br><span class=\"line\">\tloss_regularization &#x3D; []</span><br><span class=\"line\">\tloss_regularization.append(tf.nn.l2_loss(w1))</span><br><span class=\"line\">\tloss_regularization.append(tf.nn.l2_loss(w2))</span><br><span class=\"line\">\tloss_regularization &#x3D; tf.reduce_sum(loss_regularization)</span><br><span class=\"line\">\tloss &#x3D; loss_mse + 0.03*loss_regularization</span><br><span class=\"line\">\t</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"9：优化器\"><a href=\"#9：优化器\" class=\"headerlink\" title=\"9：优化器\"></a>9：优化器</h1><p>$m_t$：一阶动量(与梯度相关的函数)    $V_t$：二阶动量(与梯度平方相关的函数)</p>\n<p>下降梯度$\\eta_t=lr*m_t/\\sqrt{V_t}$</p>\n<p>更新参数$w_{t+1}=w_t-\\eta_t$</p>\n<blockquote>\n<p>不同的优化器，只是定义了不同的动量函数</p>\n</blockquote>\n<ul>\n<li>SGD，梯度下降法</li>\n</ul>\n<p>$m_t=g_t$   $V_t=1$</p>\n<p>$w_{t+1}=w_t-lr*g_t$</p>\n<ul>\n<li>SGDM，SGD基础上增加了一阶动量</li>\n</ul>\n<p>$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$</p>\n<p>$V_t=1$</p>\n<ul>\n<li>Adagrad，在SGD基础上增加二阶动量</li>\n</ul>\n<p>$m_t=g_t$ </p>\n<p>$V_t=\\sum^t_{\\tau=1}g^2_\\tau$</p>\n<ul>\n<li>RMSProp，SGD基础上增加二阶动量</li>\n</ul>\n<p>$m_t=g_t$  </p>\n<p>$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$</p>\n<ul>\n<li>Adam，同时结合SGDM一阶动量和RMSProp二阶动量</li>\n</ul>\n<p>$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$</p>\n<p>修正一阶动量的偏差：$\\hat{m_t}=\\frac{m_t}{1-\\beta^t_1}$</p>\n<p>$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$</p>\n<p>修正二阶动量的偏差：$\\hat{V_t}=\\frac{V_t}{1-\\beta^t_2}$</p>\n<h1 id=\"10：搭建八股网络-Sequential\"><a href=\"#10：搭建八股网络-Sequential\" class=\"headerlink\" title=\"10：搭建八股网络-Sequential\"></a>10：搭建八股网络-Sequential</h1><p>tf.keras搭建网络八股</p>\n<p>六步法：</p>\n<ol>\n<li>import</li>\n<li>train,test</li>\n<li>model = tf.keras.models.Sequential</li>\n<li>model.compile</li>\n<li>model.fit</li>\n<li>model.summary</li>\n</ol>\n<ul>\n<li>Sequential，描述各层网络</li>\n</ul>\n<p>拉直层：tf.keras.layers.Flatten()</p>\n<p>全连接层：tf.keras.layers.Dense(神经元个数,activation=”激活函数”,kernel_regularizer=哪种正则化)</p>\n<blockquote>\n<p>activation：relu、softmax、sigmoid、tanh</p>\n<p>kernel_regularizer：tf.keras.regularizers.l1()、tf.keras.regularizers.l2()</p>\n</blockquote>\n<p>卷积层：tf.keras.layers.Conv2D(filters = 卷积核个数,kernel_size = 卷积核尺寸,strides = 卷积步长,padding = “valid”or”same”)</p>\n<p>LSTM层：tf.keras.layers.LSTM()</p>\n<ul>\n<li>Compile</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.compile(optimizer = 优化器,loss=损失函数,metrics=[<span class=\"string\">&quot;准确率&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Fit</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.fit(训练集的输入特征，训练集的标签，bathc_size&#x3D;,epochs&#x3D;,validation_data&#x3D;(测试集的输入特征，测试集的标签)，validation_split&#x3D;从训练集划分多少比例给测试集，validation_freq&#x3D;多少次epoch测试一次)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Summary</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.summary()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"11：搭建网络八股-class\"><a href=\"#11：搭建网络八股-class\" class=\"headerlink\" title=\"11：搭建网络八股-class\"></a>11：搭建网络八股-class</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyModel</span>(<span class=\"params\">Model</span>):</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">\t\tsuper(MyModel,self).__init__()</span><br><span class=\"line\">        定义网络结构块</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">call</span>(<span class=\"params\">self,x</span>):</span></span><br><span class=\"line\">        调用网络结构块，实现前向传播</span><br><span class=\"line\">        reutrn y</span><br><span class=\"line\">        </span><br><span class=\"line\"> model = MyModel()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"12：MNIST数据集\"><a href=\"#12：MNIST数据集\" class=\"headerlink\" title=\"12：MNIST数据集\"></a>12：MNIST数据集</h1><p>提供6万张28*28像素点的0-9手写数字图片和标签，用于训练</p>\n<p>1万张28*28像素点的0-9手写数组图片和标签，用于测试</p>\n<ul>\n<li>导入MNIST数据集</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mnist &#x3D; tf.keras.datasets.mnist</span><br><span class=\"line\">(x_train,y_train),(x_test,y_test)&#x3D;mnist.load_data()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>作为输入特征，将数据拉伸为一维数组</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.Flatten()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"13：Fasion-MNIST数据集\"><a href=\"#13：Fasion-MNIST数据集\" class=\"headerlink\" title=\"13：Fasion_MNIST数据集\"></a>13：Fasion_MNIST数据集</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tensorflow <span class=\"keyword\">as</span> tf</span><br><span class=\"line\"></span><br><span class=\"line\">fasion = tf.keras.datasets.fashion_mnist</span><br><span class=\"line\">(x_train, y_train),(x_test,y_test) = fasion.load_data()</span><br><span class=\"line\">x_train,x_test = x_train/<span class=\"number\">255.0</span>,x_test/<span class=\"number\">255.0</span></span><br><span class=\"line\"></span><br><span class=\"line\">model = tf.keras.models.Sequential([</span><br><span class=\"line\">    tf.keras.layers.Flatten(),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">128</span>,activation=<span class=\"string\">&#x27;relu&#x27;</span>),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">10</span>,activation = <span class=\"string\">&#x27;softmax&#x27;</span>)</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\">model.compile(optimizer=<span class=\"string\">&quot;adam&quot;</span>,loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class=\"literal\">False</span>),metrics=[<span class=\"string\">&#x27;sparse_categorical_accuracy&#x27;</span>])</span><br><span class=\"line\">model.fit(x_train,y_train,batch_size = <span class=\"number\">32</span>,epochs=<span class=\"number\">5</span>,validation_data=(x_test,y_test),validation_freq = <span class=\"number\">1</span>)</span><br><span class=\"line\">model.summary()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"14：自制数据集\"><a href=\"#14：自制数据集\" class=\"headerlink\" title=\"14：自制数据集\"></a>14：自制数据集</h1><p><img src=\"https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>在<code>mnist_image_label</code>文件夹下有两个文件夹<code>mnist_train_jpg_60000</code>和<code>mnist_test_jpg_10000</code></p>\n<p>每个文件夹分别放了对应个数的图片以及一个.txt文件，文件内容如上，jpg名+空格+标签</p>\n<p>现在需要重写<code>(x_train,y_train),(x_test,y_test)=mnist.load_data()</code>中的load_data()方法。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">generateds</span>(<span class=\"params\">path,txt</span>):</span></span><br><span class=\"line\">    f = open(txt,<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">    contents = f.readlines()</span><br><span class=\"line\">    f.close()</span><br><span class=\"line\">    x,y_ = [],[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> content <span class=\"keyword\">in</span> contents:</span><br><span class=\"line\">        value = content.split()</span><br><span class=\"line\">        img_path = path+value[<span class=\"number\">0</span>]</span><br><span class=\"line\">        img = Image.open(img_path)</span><br><span class=\"line\">        img = np.array(img.convert(<span class=\"string\">&#x27;L&#x27;</span>))</span><br><span class=\"line\">        img = img/<span class=\"number\">255.</span></span><br><span class=\"line\">        x.append(img)</span><br><span class=\"line\">        y_.append(value[<span class=\"number\">1</span>])</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;loading:&#x27;</span>+content)</span><br><span class=\"line\">    x = np.array(x)</span><br><span class=\"line\">    y_ = np.array(y_)</span><br><span class=\"line\">    y_ = y_.astype(np.int64)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x,y_</span><br></pre></td></tr></table></figure>\n\n<p>保存数据集</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.save(保存路径带拓展,保存的内容)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"15：数据增强\"><a href=\"#15：数据增强\" class=\"headerlink\" title=\"15：数据增强\"></a>15：数据增强</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">image_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(</span><br><span class=\"line\">\trescale = 所有数据将乘以该数值</span><br><span class=\"line\">\trotation = 随机旋转角度值范围</span><br><span class=\"line\">    width_shift_range = 随机宽度偏移量</span><br><span class=\"line\">    height_shift_range = 随机高度偏移量</span><br><span class=\"line\">    horizontal_flip = 是否随机水平翻转</span><br><span class=\"line\">    zoom_range = 随机缩放的范围[<span class=\"number\">1</span>-n,<span class=\"number\">1</span>+n])</span><br><span class=\"line\">image_gen_train.fit(x_train)</span><br></pre></td></tr></table></figure>\n\n<p>fit()中的数据是四位数据，所以需要对其reshape</p>\n<p>x_train = x_train.reshape(x_train.shape[0],28,28,1)</p>\n<p>最后的1表示灰度值。</p>\n<p>model.fit()方法内修改为</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.fit(image_gen_train.flow(x_train,y_train,batch_size = <span class=\"number\">32</span>),epochs=<span class=\"number\">5</span>,validation_data=(x_test,y_test),validation_freq = <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"16：断点续训\"><a href=\"#16：断点续训\" class=\"headerlink\" title=\"16：断点续训\"></a>16：断点续训</h1><p>读取模型：</p>\n<p>load_weights(路径文件名)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checkpoint_save_path = <span class=\"string\">&quot;./checkpoint/mnist.ckpt&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> os.path.exists(checkpoint_save_path + <span class=\"string\">&#x27;.index&#x27;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&#x27;-----load the model------&#x27;</span>)</span><br><span class=\"line\">    model.load_weights(checkpoint_save_path)</span><br></pre></td></tr></table></figure>\n\n<p>保存模型</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">callback = tf.keras.callbacks.ModelCheckpoint(</span><br><span class=\"line\">\tfilepath = 路径文件名,</span><br><span class=\"line\">\tsave_weights_only=<span class=\"literal\">True</span>/<span class=\"literal\">False</span>,</span><br><span class=\"line\">\tsave_best_only = <span class=\"literal\">True</span>/<span class=\"literal\">False</span>)</span><br><span class=\"line\">history = model.fit(……callbacks = [cp_callback])</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"17：参数提取\"><a href=\"#17：参数提取\" class=\"headerlink\" title=\"17：参数提取\"></a>17：参数提取</h1><p>model.trainable_variables 返回模型中可训练的参数</p>\n<p>设置print输出格式</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.set_printoptions(threshold = 超过多少省略显示)\t<span class=\"comment\">#threshold=np.inf表示无限</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.set_printoptions(threshold = np.inf)</span><br><span class=\"line\">print(model.trainable_variables)</span><br><span class=\"line\">file = open(<span class=\"string\">&#x27;./weights.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> model.trainable_variables:</span><br><span class=\"line\">\tfile.write(str(v.name)+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    file.write(str(v.shape)+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    file.write(str(v.numpy())+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">file.close()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"18：acc曲线和loss曲线可视化\"><a href=\"#18：acc曲线和loss曲线可视化\" class=\"headerlink\" title=\"18：acc曲线和loss曲线可视化\"></a>18：acc曲线和loss曲线可视化</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">history = model.fit()</span><br><span class=\"line\">acc = history.history[<span class=\"string\">&#x27;sparse_categorical_accuracy&#x27;</span>]\t<span class=\"comment\">#训练集准确率</span></span><br><span class=\"line\">val_acc = history.history[<span class=\"string\">&#x27;val_sparse_categorical_accuracy&#x27;</span>]\t<span class=\"comment\">#测试集准确率</span></span><br><span class=\"line\">loss = history.history[<span class=\"string\">&#x27;loss&#x27;</span>]\t<span class=\"comment\">#训练集loss</span></span><br><span class=\"line\">val_loss = history.history[<span class=\"string\">&#x27;val_loss&#x27;</span>]\t<span class=\"comment\">#测试集loss</span></span><br></pre></td></tr></table></figure>\n\n<p>画图</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">plt.plot(acc,label=<span class=\"string\">&quot;Training Accuracy&quot;</span>)</span><br><span class=\"line\">plt.plot(val_acc,label=<span class=\"string\">&quot;Validation Accuracy&quot;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&quot;Training and Validation Accuracy&quot;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\"></span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">plt.plot(loss,label=<span class=\"string\">&quot;Training Loss&quot;</span>)</span><br><span class=\"line\">plt.plot(val_loss,label=<span class=\"string\">&quot;Validation Loss&quot;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;Training and Validation Loss&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"19：样例预测\"><a href=\"#19：样例预测\" class=\"headerlink\" title=\"19：样例预测\"></a>19：样例预测</h1><p>predict(输入特征,batch_size=整数)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#复现模型</span></span><br><span class=\"line\">model = tf.keras.models.Sequential([</span><br><span class=\"line\">    tf.keras.layers.Flatten(),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">128</span>,activation = <span class=\"string\">&#x27;relu&#x27;</span>),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">10</span>,activation = <span class=\"string\">&#x27;softmax&#x27;</span>)])</span><br><span class=\"line\"><span class=\"comment\">#加载参数</span></span><br><span class=\"line\">model.load_weights(model_save_path)</span><br><span class=\"line\"><span class=\"comment\">#预测结果</span></span><br><span class=\"line\">result = model.predict(x_predict)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"20：卷积计算过程\"><a href=\"#20：卷积计算过程\" class=\"headerlink\" title=\"20：卷积计算过程\"></a>20：卷积计算过程</h1><p>原始彩色图片——&gt;若干层特征提取——&gt;全连接网络</p>\n<p>主要模块：(CBAPD)</p>\n<p>卷积(Convolutional)-&gt;批标准化(BN)-&gt;激活(Activation)-&gt;池化(Pooling)-&gt;舍弃(Dropout)</p>\n<h1 id=\"21：感受野\"><a href=\"#21：感受野\" class=\"headerlink\" title=\"21：感受野\"></a>21：感受野</h1><p>感受野：卷积神经网络各输出特征图中的每个像素点，在原始输入图片上映射区域的大小。</p>\n<p>比如：</p>\n<p>1：</p>\n<p>5x5原始图，使用3x3卷积核，生成的3x3特征图，那么其感受野是3.</p>\n<p>将生成的3x3特征图，再次使用3x3卷积核作用，生成1x1特征图，那么这个特征图相对于原始图，感受野为5.</p>\n<p>2：</p>\n<p>5x5原始图，使用5x5卷积核，生成1x1特征图，其感受野同样为5</p>\n<p>长款x大于10时，两层3x3卷积核性能优于一层5x5卷积核</p>\n<h1 id=\"22：全零填充\"><a href=\"#22：全零填充\" class=\"headerlink\" title=\"22：全零填充\"></a>22：全零填充</h1><p>特征图一圈填充零。</p>\n<p>特征图边长<br>$$<br>padding=\\begin{cases}<br>SAME(全0填充)\\ \\frac{入长}{步长}\\ (向上取整)<br>\\VALID(不全0填充)\\ \\frac{入长-核长+1}{步长}\\ (向上取整)<br>\\end{cases}<br>$$</p>\n<h1 id=\"23：描述卷积层\"><a href=\"#23：描述卷积层\" class=\"headerlink\" title=\"23：描述卷积层\"></a>23：描述卷积层</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.Conv2D(</span><br><span class=\"line\">\tfilter = 卷积核个数,</span><br><span class=\"line\">    kernel_size = 卷积核尺寸，\t<span class=\"comment\">#正方形写核长整数，或（核高，核宽）</span></span><br><span class=\"line\">    strides = 滑动步长,\t<span class=\"comment\">#横纵相同写步长整数，或（纵向步长，横向步长）</span></span><br><span class=\"line\">    padding = <span class=\"string\">&quot;same&quot;</span> <span class=\"keyword\">or</span> <span class=\"string\">&quot;valid&quot;</span>\t<span class=\"comment\">#全零填充same，非全零valid</span></span><br><span class=\"line\">    activation = <span class=\"string\">&quot;relu&quot;</span> <span class=\"keyword\">or</span> <span class=\"string\">&quot;sigmoid&quot;</span>,</span><br><span class=\"line\">    input_shape = (高，宽，通道数)\t<span class=\"comment\">#输入特征图维度，可省</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"24：批标准化（Batch-Normalization）\"><a href=\"#24：批标准化（Batch-Normalization）\" class=\"headerlink\" title=\"24：批标准化（Batch Normalization）\"></a>24：批标准化（Batch Normalization）</h1><p>标准化：使数据符合0均值，1为标准差的分布</p>\n<p>批标准化：对一小批数据，做标准化<br>$$<br>H’^k_i = \\frac{H^k_i-\\mu^k_{batch}}{\\sigma_{batch}^k}<br>$$<br>k：第k个卷积核</p>\n<p>i：第i个像素点</p>\n<p>H’：批标准化之后</p>\n<p>H：批标准化之前</p>\n<p>上述式子，要求批标准化之前的特征数据即满足正态分布。</p>\n<p>通常使用：<br>$$<br>x^k_i=\\gamma_kH’^k_i+\\beta_k<br>$$<br>$\\gamma_k$:缩放因子</p>\n<p>$\\beta_k$:偏移因子</p>\n<p>调整分布的宽窄和偏移。</p>\n<p>BN层位于，卷积层之后，激活层之前。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.BatchNormalization()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"25：池化\"><a href=\"#25：池化\" class=\"headerlink\" title=\"25：池化\"></a>25：池化</h1><p>池化用于减少特征数据量。</p>\n<p>最大池化，均值池化</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.MaxPool2D(</span><br><span class=\"line\">\tpool_size=池化核尺寸</span><br><span class=\"line\">\tstrides=池化步长</span><br><span class=\"line\">\tpadding=<span class=\"string\">&#x27;valid&#x27;</span> <span class=\"keyword\">or</span> <span class=\"string\">&#x27;same&#x27;</span>\t<span class=\"comment\">#全零填充？</span></span><br><span class=\"line\">)</span><br><span class=\"line\">tf.keras.layers.AveragePooling2D()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"26：舍弃（dropout）\"><a href=\"#26：舍弃（dropout）\" class=\"headerlink\" title=\"26：舍弃（dropout）\"></a>26：舍弃（dropout）</h1><p>在神经网络训练时，将一部分神经元按照一定概率从神经网络中暂时舍弃，神经网络使用时，被舍弃的神经元恢复连接。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.Dropout(舍弃概率)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"27：Cifar10数据集\"><a href=\"#27：Cifar10数据集\" class=\"headerlink\" title=\"27：Cifar10数据集\"></a>27：Cifar10数据集</h1><p>五万张32*32像素点的是分类彩色图片和标签，用于训练</p>\n<p>测试1万张</p>\n<h1 id=\"28：LeNet\"><a href=\"#28：LeNet\" class=\"headerlink\" title=\"28：LeNet\"></a>28：LeNet</h1><p>输入：32*32</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：人工智能三学派\"><a href=\"#1：人工智能三学派\" class=\"headerlink\" title=\"1：人工智能三学派\"></a>1：人工智能三学派</h1><ul>\n<li>准备数据</li>\n<li>搭建网络</li>\n<li>优化参数</li>\n<li>应用网络</li>\n</ul>\n<h1 id=\"2：神经网络设计过程\"><a href=\"#2：神经网络设计过程\" class=\"headerlink\" title=\"2：神经网络设计过程\"></a>2：神经网络设计过程</h1><p>鸢尾花的分类：</p>\n<p>通过测量花萼长、花萼宽。</p>\n<p>if语句case语句——<strong>专家系统</strong>把专家的经验告知计算机，计算机执行逻辑判断。给出分类</p>\n<p>神经网络：采集大量数据对构成数据集。</p>\n<h1 id=\"3：张量生成\"><a href=\"#3：张量生成\" class=\"headerlink\" title=\"3：张量生成\"></a>3：张量生成</h1><p>张量（Tensor）：多维数组（列表）    阶：张量的维数</p>\n<table>\n<thead>\n<tr>\n<th>阶</th>\n<th>名字</th>\n<th>例子</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>标量</td>\n<td>S=1 2 3</td>\n</tr>\n<tr>\n<td>1</td>\n<td>向量</td>\n<td>v=[1,2,3]</td>\n</tr>\n<tr>\n<td>2</td>\n<td>矩阵</td>\n<td></td>\n</tr>\n<tr>\n<td>n</td>\n<td>张量</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>创建张量</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = tf.constan(张量内容,dtype = 数据类型)</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(a.dtype)</span><br><span class=\"line\">print(a.shape)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.zeros(维度)</span><br><span class=\"line\">tf.ones(维度)</span><br><span class=\"line\">tf.fill(维度，指定值)</span><br><span class=\"line\">c = tf.fill([<span class=\"number\">2</span>,<span class=\"number\">2</span>],<span class=\"number\">9</span>)\t//两行两列</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.random.normal(维度,mean=均值,stddev=标准差)</span><br><span class=\"line\">tf.random.truncated_normal(维度，mean=均值,stddev=标准差)</span><br><span class=\"line\">tf.random.uniform(维度,minval=最小值,maxval=最大值)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4：常用函数\"><a href=\"#4：常用函数\" class=\"headerlink\" title=\"4：常用函数\"></a>4：常用函数</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.cast(张量名,dtype&#x3D;数据类型)\t&#x2F;&#x2F;强制转换数据类型</span><br><span class=\"line\">tf.reduce_min()\t&#x2F;&#x2F;计算最大值</span><br><span class=\"line\">tf.reduce_max()</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.reduce_mean(张量名,axis=操作轴)\t//计算张量延指定维度平均值</span><br><span class=\"line\">tf.reduce_sum(张量名,axis=操作轴)\t//计算沿指定维度的和</span><br></pre></td></tr></table></figure>\n\n<p>未指定操作轴，则为对全部数进行操作</p>\n<p>变量：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.Variable(初始值)</span><br></pre></td></tr></table></figure>\n\n<p>数学运算</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.add()</span><br><span class=\"line\">tf.subtract()</span><br><span class=\"line\">tf.multiply()</span><br><span class=\"line\">tf.divide()</span><br><span class=\"line\">&#x2F;&#x2F;只有维度相同才能进行四则运算</span><br><span class=\"line\">tf.square(张量名)\t平方</span><br><span class=\"line\">tf.pow()\t&#x2F;&#x2F;n次方</span><br><span class=\"line\">tf.sqrt()\t&#x2F;&#x2F;开方</span><br></pre></td></tr></table></figure>\n\n<p>矩阵乘</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.matmul(矩阵<span class=\"number\">1</span>，矩阵<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p>特征和标签对应：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">features &#x3D; tf.constant([12,23,10,14])</span><br><span class=\"line\">labels &#x3D; tf.constant([0,1,1,0])</span><br><span class=\"line\">dataset &#x3D; tf.data.Dataset.from_tensor_slices((features,labels))</span><br></pre></td></tr></table></figure>\n\n<p>计算梯度</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> tf.GradientTape() <span class=\"keyword\">as</span> tape:</span><br><span class=\"line\">\tw = tf.Variable(tf.constant(<span class=\"number\">3.0</span>))</span><br><span class=\"line\">\tloss = tf.pow(w,<span class=\"number\">2</span>)</span><br><span class=\"line\">grad = tape.gradient(loss,w)</span><br></pre></td></tr></table></figure>\n\n<p><strong>enumerate</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">seq = [<span class=\"string\">&#x27;one&#x27;</span>,<span class=\"string\">&#x27;two&#x27;</span>,<span class=\"string\">&#x27;three&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i,element <span class=\"keyword\">in</span> enumerate(seq):</span><br><span class=\"line\">\tprint(i,element)</span><br></pre></td></tr></table></figure>\n\n<p>独热编码：</p>\n<p>标记类别：1表示是，0表示否</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.one_hot(待转换数据，depth&#x3D;几分类)</span><br></pre></td></tr></table></figure>\n\n<p>输出符合概率分布：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.softmax(x)</span><br><span class=\"line\"></span><br><span class=\"line\">y = tf.constant([<span class=\"number\">1.01</span>,<span class=\"number\">2.01</span>,<span class=\"number\">-0.66</span>])</span><br><span class=\"line\">y_pro = tf.nn.softmax(y)</span><br></pre></td></tr></table></figure>\n\n<p>参数自更新：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">w &#x3D; tf.Variable(4)</span><br><span class=\"line\">w.assign_sub(1)\t&#x2F;&#x2F;w-&#x3D;1</span><br><span class=\"line\">print(w)</span><br></pre></td></tr></table></figure>\n\n<p>返回最大值索引</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.argmax(张量名，axis&#x3D;操作轴)</span><br></pre></td></tr></table></figure>\n\n<p>条件语句：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.where(条件语句,真返回A,假返回B)</span><br></pre></td></tr></table></figure>\n\n<p>返回[0,1)之间的随机数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.random.RandomState.rand(维度)</span><br></pre></td></tr></table></figure>\n\n<p>将两个数组按垂直方向叠加（一维—&gt;二维）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.vstack(数组<span class=\"number\">1</span>，数组<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x,y = np.mgrid[<span class=\"number\">1</span>:<span class=\"number\">3</span>:<span class=\"number\">1</span>,<span class=\"number\">2</span>:<span class=\"number\">4</span>:<span class=\"number\">0.5</span>]\t//x=[[<span class=\"number\">1</span> <span class=\"number\">1</span> <span class=\"number\">1</span> <span class=\"number\">1</span>]</span><br><span class=\"line\">                                     [<span class=\"number\">2</span> <span class=\"number\">2</span> <span class=\"number\">2</span> <span class=\"number\">2</span>]]</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\ty=[[<span class=\"number\">2</span> <span class=\"number\">2.5</span> <span class=\"number\">3</span> <span class=\"number\">3.5</span>]</span><br><span class=\"line\">                                       [<span class=\"number\">2</span> <span class=\"number\">2.5</span> <span class=\"number\">3</span> <span class=\"number\">3.5</span>]] </span><br><span class=\"line\">gird = np.c_[x.ravel(),y.ravel()]\t//ravel()降维到一维，np.c_[数组<span class=\"number\">1</span>，数组<span class=\"number\">2</span>]配对。</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"5：神经网络-NN-复杂度\"><a href=\"#5：神经网络-NN-复杂度\" class=\"headerlink\" title=\"5：神经网络(NN)复杂度\"></a>5：神经网络(NN)复杂度</h1><p>NN复杂度：多用NN层数和NN参数的个数表示。</p>\n<ul>\n<li>空间复杂度</li>\n<li>时间复杂度</li>\n</ul>\n<p>学习率:<br>$$<br>w_{t+1} = w_t+lr<em>gradient<br>$$<br>指数衰减学习率:<br>$$<br>指数衰减学习率=初始学习率</em>学习率衰减率^{当前轮数/多少轮衰减一次}<br>\\\\epoch= 40<br>\\\\LR_BASE= 0.2<br>\\\\LR_DECAY= 0.99<br>\\\\LR_STEP=1<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> range(epoch):</span><br><span class=\"line\">    lr = LR_BASE*LR_DECAY**(epoch/LR_STEP)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> tf.GradientTape() <span class=\"keyword\">as</span> tape:</span><br><span class=\"line\">        loss = tf.square(w+<span class=\"number\">1</span>)</span><br><span class=\"line\">    grads = tape.gradient(loss,w)</span><br><span class=\"line\">    w.assign_sub(lr*grads)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"6：激活函数\"><a href=\"#6：激活函数\" class=\"headerlink\" title=\"6：激活函数\"></a>6：激活函数</h1><p>$$<br>y = f(wx+b)<br>$$</p>\n<ul>\n<li>Sigmoid函数</li>\n</ul>\n<p>$$<br>f(x)=\\frac{1}{1+e^{-x}}<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.sigmoid(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>易造成梯度消失</p>\n<p>输出非0均值，收敛慢</p>\n<p>幂运算复杂，训练时间长</p>\n</blockquote>\n<ul>\n<li>Tanh函数</li>\n</ul>\n<p>$$<br>f(x) = \\frac{1-e^{-2x}}{1+e^{-2x}}<br>$$</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.math.tanh(x)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Relu函数</li>\n</ul>\n<p>$$<br>\\begin{align}<br>f(x)=&amp; max(x,0)<br>\\\\=&amp; \\begin{cases}<br>0\\qquad x&lt;0\\<br>x\\qquad x&gt;=0<br>\\end{cases}<br>\\end{align}<br>$$</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.relu(x)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Leaky Relu函数</li>\n</ul>\n<p>$$<br>f(x)=max(ax,x)<br>$$</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.leaky_relu(x)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>初学者：</p>\n<ul>\n<li>首选Relu函数</li>\n<li>学习率设置较小值</li>\n<li>输入特征标准化，让输入特征满足以0为均值，1为标准差的正态分布</li>\n<li>初始参数中心化，让随机生成的参数满足以0为均值，sqrt(2/当前层输入特征个数)为标准差的正态分布</li>\n</ul>\n</blockquote>\n<h1 id=\"7：损失函数\"><a href=\"#7：损失函数\" class=\"headerlink\" title=\"7：损失函数\"></a>7：损失函数</h1><p>loss：预测值(y)与已知答案(y_)的差距</p>\n<ul>\n<li>均方误差mse：</li>\n</ul>\n<p>$$<br>MSE(y_,y)=\\frac{\\sum^n_{i=1}(y-y_)^2}{n}<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_mse = tf.reduce_mean(tf.square(y-y_))</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>自定义损失函数</li>\n</ul>\n<p>y_:标准答案</p>\n<p>y:预测答案<br>$$<br>f(y_,y)=\\begin{cases}<br>PROFIT*(y_-y)\\quad y&lt;y_ \\ 预测的y少了，损失利润<br>\\COST*(y-y_)\\quad y&gt;=y_ \\ 预测的y多了，损失成本<br>\\end{cases}<br>$$</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_diy = tf.reduce_sum(tf.where(tf.greater(y,y_),COST(y-y_),PROFIT(y_-y)))\t//y&gt;y_?,为真COST，为假PROFIT</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>交叉熵损失函数CE：表征两个概率分布之间的距离</li>\n</ul>\n<p>$$<br>H(y_,y)=-\\sum y_*lny<br>$$</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.losses.categorical_crossentropy(y_,y)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>softmax和交叉熵结合</li>\n</ul>\n<p>softmax计算概率分布</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.nn.softmax_cross_entropy_with_logits(y_,y)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"8：缓解过拟合\"><a href=\"#8：缓解过拟合\" class=\"headerlink\" title=\"8：缓解过拟合\"></a>8：缓解过拟合</h1><ul>\n<li>正则化缓解过拟合</li>\n</ul>\n<p>正则化在损失函数中引入模型复杂度指标，利用给W加权值，弱化训练数据的噪声。</p>\n<p>$$<br>loss=loss(y与y_)+REGULARIZER*losss(w)<br>$$</p>\n<p>L2正则化</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">with tf.GradientTape() as tape:</span><br><span class=\"line\">\th1 &#x3D; tf.matmul(x_train,w1)+b1</span><br><span class=\"line\">\th1 &#x3D; tf.nn.relu(h1)</span><br><span class=\"line\">\ty &#x3D; tf.matmul(h1,w2) + b2</span><br><span class=\"line\">\tloss_mse &#x3D; tf.reduce_mean(tf.square(y_train - y))</span><br><span class=\"line\">\tloss_regularization &#x3D; []</span><br><span class=\"line\">\tloss_regularization.append(tf.nn.l2_loss(w1))</span><br><span class=\"line\">\tloss_regularization.append(tf.nn.l2_loss(w2))</span><br><span class=\"line\">\tloss_regularization &#x3D; tf.reduce_sum(loss_regularization)</span><br><span class=\"line\">\tloss &#x3D; loss_mse + 0.03*loss_regularization</span><br><span class=\"line\">\t</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"9：优化器\"><a href=\"#9：优化器\" class=\"headerlink\" title=\"9：优化器\"></a>9：优化器</h1><p>$m_t$：一阶动量(与梯度相关的函数)    $V_t$：二阶动量(与梯度平方相关的函数)</p>\n<p>下降梯度$\\eta_t=lr*m_t/\\sqrt{V_t}$</p>\n<p>更新参数$w_{t+1}=w_t-\\eta_t$</p>\n<blockquote>\n<p>不同的优化器，只是定义了不同的动量函数</p>\n</blockquote>\n<ul>\n<li>SGD，梯度下降法</li>\n</ul>\n<p>$m_t=g_t$   $V_t=1$</p>\n<p>$w_{t+1}=w_t-lr*g_t$</p>\n<ul>\n<li>SGDM，SGD基础上增加了一阶动量</li>\n</ul>\n<p>$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$</p>\n<p>$V_t=1$</p>\n<ul>\n<li>Adagrad，在SGD基础上增加二阶动量</li>\n</ul>\n<p>$m_t=g_t$ </p>\n<p>$V_t=\\sum^t_{\\tau=1}g^2_\\tau$</p>\n<ul>\n<li>RMSProp，SGD基础上增加二阶动量</li>\n</ul>\n<p>$m_t=g_t$  </p>\n<p>$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$</p>\n<ul>\n<li>Adam，同时结合SGDM一阶动量和RMSProp二阶动量</li>\n</ul>\n<p>$m_t=\\beta*m_{t-1}+(1-\\beta)*g_t$</p>\n<p>修正一阶动量的偏差：$\\hat{m_t}=\\frac{m_t}{1-\\beta^t_1}$</p>\n<p>$V_t=\\beta*V_{t-1}+(1-\\beta)*g^2_t$</p>\n<p>修正二阶动量的偏差：$\\hat{V_t}=\\frac{V_t}{1-\\beta^t_2}$</p>\n<h1 id=\"10：搭建八股网络-Sequential\"><a href=\"#10：搭建八股网络-Sequential\" class=\"headerlink\" title=\"10：搭建八股网络-Sequential\"></a>10：搭建八股网络-Sequential</h1><p>tf.keras搭建网络八股</p>\n<p>六步法：</p>\n<ol>\n<li>import</li>\n<li>train,test</li>\n<li>model = tf.keras.models.Sequential</li>\n<li>model.compile</li>\n<li>model.fit</li>\n<li>model.summary</li>\n</ol>\n<ul>\n<li>Sequential，描述各层网络</li>\n</ul>\n<p>拉直层：tf.keras.layers.Flatten()</p>\n<p>全连接层：tf.keras.layers.Dense(神经元个数,activation=”激活函数”,kernel_regularizer=哪种正则化)</p>\n<blockquote>\n<p>activation：relu、softmax、sigmoid、tanh</p>\n<p>kernel_regularizer：tf.keras.regularizers.l1()、tf.keras.regularizers.l2()</p>\n</blockquote>\n<p>卷积层：tf.keras.layers.Conv2D(filters = 卷积核个数,kernel_size = 卷积核尺寸,strides = 卷积步长,padding = “valid”or”same”)</p>\n<p>LSTM层：tf.keras.layers.LSTM()</p>\n<ul>\n<li>Compile</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.compile(optimizer = 优化器,loss=损失函数,metrics=[<span class=\"string\">&quot;准确率&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Fit</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.fit(训练集的输入特征，训练集的标签，bathc_size&#x3D;,epochs&#x3D;,validation_data&#x3D;(测试集的输入特征，测试集的标签)，validation_split&#x3D;从训练集划分多少比例给测试集，validation_freq&#x3D;多少次epoch测试一次)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Summary</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.summary()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"11：搭建网络八股-class\"><a href=\"#11：搭建网络八股-class\" class=\"headerlink\" title=\"11：搭建网络八股-class\"></a>11：搭建网络八股-class</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyModel</span>(<span class=\"params\">Model</span>):</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">\t\tsuper(MyModel,self).__init__()</span><br><span class=\"line\">        定义网络结构块</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">call</span>(<span class=\"params\">self,x</span>):</span></span><br><span class=\"line\">        调用网络结构块，实现前向传播</span><br><span class=\"line\">        reutrn y</span><br><span class=\"line\">        </span><br><span class=\"line\"> model = MyModel()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"12：MNIST数据集\"><a href=\"#12：MNIST数据集\" class=\"headerlink\" title=\"12：MNIST数据集\"></a>12：MNIST数据集</h1><p>提供6万张28*28像素点的0-9手写数字图片和标签，用于训练</p>\n<p>1万张28*28像素点的0-9手写数组图片和标签，用于测试</p>\n<ul>\n<li>导入MNIST数据集</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mnist &#x3D; tf.keras.datasets.mnist</span><br><span class=\"line\">(x_train,y_train),(x_test,y_test)&#x3D;mnist.load_data()</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>作为输入特征，将数据拉伸为一维数组</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.Flatten()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"13：Fasion-MNIST数据集\"><a href=\"#13：Fasion-MNIST数据集\" class=\"headerlink\" title=\"13：Fasion_MNIST数据集\"></a>13：Fasion_MNIST数据集</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> tensorflow <span class=\"keyword\">as</span> tf</span><br><span class=\"line\"></span><br><span class=\"line\">fasion = tf.keras.datasets.fashion_mnist</span><br><span class=\"line\">(x_train, y_train),(x_test,y_test) = fasion.load_data()</span><br><span class=\"line\">x_train,x_test = x_train/<span class=\"number\">255.0</span>,x_test/<span class=\"number\">255.0</span></span><br><span class=\"line\"></span><br><span class=\"line\">model = tf.keras.models.Sequential([</span><br><span class=\"line\">    tf.keras.layers.Flatten(),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">128</span>,activation=<span class=\"string\">&#x27;relu&#x27;</span>),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">10</span>,activation = <span class=\"string\">&#x27;softmax&#x27;</span>)</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\">model.compile(optimizer=<span class=\"string\">&quot;adam&quot;</span>,loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class=\"literal\">False</span>),metrics=[<span class=\"string\">&#x27;sparse_categorical_accuracy&#x27;</span>])</span><br><span class=\"line\">model.fit(x_train,y_train,batch_size = <span class=\"number\">32</span>,epochs=<span class=\"number\">5</span>,validation_data=(x_test,y_test),validation_freq = <span class=\"number\">1</span>)</span><br><span class=\"line\">model.summary()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"14：自制数据集\"><a href=\"#14：自制数据集\" class=\"headerlink\" title=\"14：自制数据集\"></a>14：自制数据集</h1><p><img src=\"https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png\"></p>\n<p>在<code>mnist_image_label</code>文件夹下有两个文件夹<code>mnist_train_jpg_60000</code>和<code>mnist_test_jpg_10000</code></p>\n<p>每个文件夹分别放了对应个数的图片以及一个.txt文件，文件内容如上，jpg名+空格+标签</p>\n<p>现在需要重写<code>(x_train,y_train),(x_test,y_test)=mnist.load_data()</code>中的load_data()方法。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">generateds</span>(<span class=\"params\">path,txt</span>):</span></span><br><span class=\"line\">    f = open(txt,<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">    contents = f.readlines()</span><br><span class=\"line\">    f.close()</span><br><span class=\"line\">    x,y_ = [],[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> content <span class=\"keyword\">in</span> contents:</span><br><span class=\"line\">        value = content.split()</span><br><span class=\"line\">        img_path = path+value[<span class=\"number\">0</span>]</span><br><span class=\"line\">        img = Image.open(img_path)</span><br><span class=\"line\">        img = np.array(img.convert(<span class=\"string\">&#x27;L&#x27;</span>))</span><br><span class=\"line\">        img = img/<span class=\"number\">255.</span></span><br><span class=\"line\">        x.append(img)</span><br><span class=\"line\">        y_.append(value[<span class=\"number\">1</span>])</span><br><span class=\"line\">        print(<span class=\"string\">&#x27;loading:&#x27;</span>+content)</span><br><span class=\"line\">    x = np.array(x)</span><br><span class=\"line\">    y_ = np.array(y_)</span><br><span class=\"line\">    y_ = y_.astype(np.int64)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x,y_</span><br></pre></td></tr></table></figure>\n\n<p>保存数据集</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.save(保存路径带拓展,保存的内容)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"15：数据增强\"><a href=\"#15：数据增强\" class=\"headerlink\" title=\"15：数据增强\"></a>15：数据增强</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">image_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(</span><br><span class=\"line\">\trescale = 所有数据将乘以该数值</span><br><span class=\"line\">\trotation = 随机旋转角度值范围</span><br><span class=\"line\">    width_shift_range = 随机宽度偏移量</span><br><span class=\"line\">    height_shift_range = 随机高度偏移量</span><br><span class=\"line\">    horizontal_flip = 是否随机水平翻转</span><br><span class=\"line\">    zoom_range = 随机缩放的范围[<span class=\"number\">1</span>-n,<span class=\"number\">1</span>+n])</span><br><span class=\"line\">image_gen_train.fit(x_train)</span><br></pre></td></tr></table></figure>\n\n<p>fit()中的数据是四位数据，所以需要对其reshape</p>\n<p>x_train = x_train.reshape(x_train.shape[0],28,28,1)</p>\n<p>最后的1表示灰度值。</p>\n<p>model.fit()方法内修改为</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model.fit(image_gen_train.flow(x_train,y_train,batch_size = <span class=\"number\">32</span>),epochs=<span class=\"number\">5</span>,validation_data=(x_test,y_test),validation_freq = <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"16：断点续训\"><a href=\"#16：断点续训\" class=\"headerlink\" title=\"16：断点续训\"></a>16：断点续训</h1><p>读取模型：</p>\n<p>load_weights(路径文件名)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checkpoint_save_path = <span class=\"string\">&quot;./checkpoint/mnist.ckpt&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> os.path.exists(checkpoint_save_path + <span class=\"string\">&#x27;.index&#x27;</span>)</span><br><span class=\"line\">\tprint(<span class=\"string\">&#x27;-----load the model------&#x27;</span>)</span><br><span class=\"line\">    model.load_weights(checkpoint_save_path)</span><br></pre></td></tr></table></figure>\n\n<p>保存模型</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">callback = tf.keras.callbacks.ModelCheckpoint(</span><br><span class=\"line\">\tfilepath = 路径文件名,</span><br><span class=\"line\">\tsave_weights_only=<span class=\"literal\">True</span>/<span class=\"literal\">False</span>,</span><br><span class=\"line\">\tsave_best_only = <span class=\"literal\">True</span>/<span class=\"literal\">False</span>)</span><br><span class=\"line\">history = model.fit(……callbacks = [cp_callback])</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"17：参数提取\"><a href=\"#17：参数提取\" class=\"headerlink\" title=\"17：参数提取\"></a>17：参数提取</h1><p>model.trainable_variables 返回模型中可训练的参数</p>\n<p>设置print输出格式</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.set_printoptions(threshold = 超过多少省略显示)\t<span class=\"comment\">#threshold=np.inf表示无限</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">np.set_printoptions(threshold = np.inf)</span><br><span class=\"line\">print(model.trainable_variables)</span><br><span class=\"line\">file = open(<span class=\"string\">&#x27;./weights.txt&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> model.trainable_variables:</span><br><span class=\"line\">\tfile.write(str(v.name)+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    file.write(str(v.shape)+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    file.write(str(v.numpy())+<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">file.close()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"18：acc曲线和loss曲线可视化\"><a href=\"#18：acc曲线和loss曲线可视化\" class=\"headerlink\" title=\"18：acc曲线和loss曲线可视化\"></a>18：acc曲线和loss曲线可视化</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">history = model.fit()</span><br><span class=\"line\">acc = history.history[<span class=\"string\">&#x27;sparse_categorical_accuracy&#x27;</span>]\t<span class=\"comment\">#训练集准确率</span></span><br><span class=\"line\">val_acc = history.history[<span class=\"string\">&#x27;val_sparse_categorical_accuracy&#x27;</span>]\t<span class=\"comment\">#测试集准确率</span></span><br><span class=\"line\">loss = history.history[<span class=\"string\">&#x27;loss&#x27;</span>]\t<span class=\"comment\">#训练集loss</span></span><br><span class=\"line\">val_loss = history.history[<span class=\"string\">&#x27;val_loss&#x27;</span>]\t<span class=\"comment\">#测试集loss</span></span><br></pre></td></tr></table></figure>\n\n<p>画图</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">plt.plot(acc,label=<span class=\"string\">&quot;Training Accuracy&quot;</span>)</span><br><span class=\"line\">plt.plot(val_acc,label=<span class=\"string\">&quot;Validation Accuracy&quot;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&quot;Training and Validation Accuracy&quot;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\"></span><br><span class=\"line\">plt.subplot(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">plt.plot(loss,label=<span class=\"string\">&quot;Training Loss&quot;</span>)</span><br><span class=\"line\">plt.plot(val_loss,label=<span class=\"string\">&quot;Validation Loss&quot;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;Training and Validation Loss&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"19：样例预测\"><a href=\"#19：样例预测\" class=\"headerlink\" title=\"19：样例预测\"></a>19：样例预测</h1><p>predict(输入特征,batch_size=整数)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#复现模型</span></span><br><span class=\"line\">model = tf.keras.models.Sequential([</span><br><span class=\"line\">    tf.keras.layers.Flatten(),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">128</span>,activation = <span class=\"string\">&#x27;relu&#x27;</span>),</span><br><span class=\"line\">    tf.keras.layers.Dense(<span class=\"number\">10</span>,activation = <span class=\"string\">&#x27;softmax&#x27;</span>)])</span><br><span class=\"line\"><span class=\"comment\">#加载参数</span></span><br><span class=\"line\">model.load_weights(model_save_path)</span><br><span class=\"line\"><span class=\"comment\">#预测结果</span></span><br><span class=\"line\">result = model.predict(x_predict)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"20：卷积计算过程\"><a href=\"#20：卷积计算过程\" class=\"headerlink\" title=\"20：卷积计算过程\"></a>20：卷积计算过程</h1><p>原始彩色图片——&gt;若干层特征提取——&gt;全连接网络</p>\n<p>主要模块：(CBAPD)</p>\n<p>卷积(Convolutional)-&gt;批标准化(BN)-&gt;激活(Activation)-&gt;池化(Pooling)-&gt;舍弃(Dropout)</p>\n<h1 id=\"21：感受野\"><a href=\"#21：感受野\" class=\"headerlink\" title=\"21：感受野\"></a>21：感受野</h1><p>感受野：卷积神经网络各输出特征图中的每个像素点，在原始输入图片上映射区域的大小。</p>\n<p>比如：</p>\n<p>1：</p>\n<p>5x5原始图，使用3x3卷积核，生成的3x3特征图，那么其感受野是3.</p>\n<p>将生成的3x3特征图，再次使用3x3卷积核作用，生成1x1特征图，那么这个特征图相对于原始图，感受野为5.</p>\n<p>2：</p>\n<p>5x5原始图，使用5x5卷积核，生成1x1特征图，其感受野同样为5</p>\n<p>长款x大于10时，两层3x3卷积核性能优于一层5x5卷积核</p>\n<h1 id=\"22：全零填充\"><a href=\"#22：全零填充\" class=\"headerlink\" title=\"22：全零填充\"></a>22：全零填充</h1><p>特征图一圈填充零。</p>\n<p>特征图边长<br>$$<br>padding=\\begin{cases}<br>SAME(全0填充)\\ \\frac{入长}{步长}\\ (向上取整)<br>\\VALID(不全0填充)\\ \\frac{入长-核长+1}{步长}\\ (向上取整)<br>\\end{cases}<br>$$</p>\n<h1 id=\"23：描述卷积层\"><a href=\"#23：描述卷积层\" class=\"headerlink\" title=\"23：描述卷积层\"></a>23：描述卷积层</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.Conv2D(</span><br><span class=\"line\">\tfilter = 卷积核个数,</span><br><span class=\"line\">    kernel_size = 卷积核尺寸，\t<span class=\"comment\">#正方形写核长整数，或（核高，核宽）</span></span><br><span class=\"line\">    strides = 滑动步长,\t<span class=\"comment\">#横纵相同写步长整数，或（纵向步长，横向步长）</span></span><br><span class=\"line\">    padding = <span class=\"string\">&quot;same&quot;</span> <span class=\"keyword\">or</span> <span class=\"string\">&quot;valid&quot;</span>\t<span class=\"comment\">#全零填充same，非全零valid</span></span><br><span class=\"line\">    activation = <span class=\"string\">&quot;relu&quot;</span> <span class=\"keyword\">or</span> <span class=\"string\">&quot;sigmoid&quot;</span>,</span><br><span class=\"line\">    input_shape = (高，宽，通道数)\t<span class=\"comment\">#输入特征图维度，可省</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"24：批标准化（Batch-Normalization）\"><a href=\"#24：批标准化（Batch-Normalization）\" class=\"headerlink\" title=\"24：批标准化（Batch Normalization）\"></a>24：批标准化（Batch Normalization）</h1><p>标准化：使数据符合0均值，1为标准差的分布</p>\n<p>批标准化：对一小批数据，做标准化<br>$$<br>H’^k_i = \\frac{H^k_i-\\mu^k_{batch}}{\\sigma_{batch}^k}<br>$$<br>k：第k个卷积核</p>\n<p>i：第i个像素点</p>\n<p>H’：批标准化之后</p>\n<p>H：批标准化之前</p>\n<p>上述式子，要求批标准化之前的特征数据即满足正态分布。</p>\n<p>通常使用：<br>$$<br>x^k_i=\\gamma_kH’^k_i+\\beta_k<br>$$<br>$\\gamma_k$:缩放因子</p>\n<p>$\\beta_k$:偏移因子</p>\n<p>调整分布的宽窄和偏移。</p>\n<p>BN层位于，卷积层之后，激活层之前。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.BatchNormalization()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"25：池化\"><a href=\"#25：池化\" class=\"headerlink\" title=\"25：池化\"></a>25：池化</h1><p>池化用于减少特征数据量。</p>\n<p>最大池化，均值池化</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.MaxPool2D(</span><br><span class=\"line\">\tpool_size=池化核尺寸</span><br><span class=\"line\">\tstrides=池化步长</span><br><span class=\"line\">\tpadding=<span class=\"string\">&#x27;valid&#x27;</span> <span class=\"keyword\">or</span> <span class=\"string\">&#x27;same&#x27;</span>\t<span class=\"comment\">#全零填充？</span></span><br><span class=\"line\">)</span><br><span class=\"line\">tf.keras.layers.AveragePooling2D()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"26：舍弃（dropout）\"><a href=\"#26：舍弃（dropout）\" class=\"headerlink\" title=\"26：舍弃（dropout）\"></a>26：舍弃（dropout）</h1><p>在神经网络训练时，将一部分神经元按照一定概率从神经网络中暂时舍弃，神经网络使用时，被舍弃的神经元恢复连接。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tf.keras.layers.Dropout(舍弃概率)</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"27：Cifar10数据集\"><a href=\"#27：Cifar10数据集\" class=\"headerlink\" title=\"27：Cifar10数据集\"></a>27：Cifar10数据集</h1><p>五万张32*32像素点的是分类彩色图片和标签，用于训练</p>\n<p>测试1万张</p>\n<h1 id=\"28：LeNet\"><a href=\"#28：LeNet\" class=\"headerlink\" title=\"28：LeNet\"></a>28：LeNet</h1><p>输入：32*32</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png","popularPost_tmp_gaData":{"updated":"Mon Nov 16 2020 18:58:27 GMT+0100 (GMT+01:00)","title":"北大人工智能实践——TensorFlow2","path":"2020/11/12/北大人工智能实践——TensorFlow2/","eyeCatchImage":"https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-11-12T15:10:33.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-11-12T15:10:33.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"学习笔记","tags":["人工智能"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"人工智能——激活函数","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2020-11-15T09:00:48.000Z","password":null,"summary":null,"_content":"\n# 1：什么是激活函数\n\n![](https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png)\n\n以一个简单的神经元为例。在没有激活函数时，神经元输出z等于$z=x_1w_1+x_2w_2+x_3w_3+b$\n\n而激活函数将z作为输入，得到新的神经元输出$f(z)$\n\n这里的$f(z)$即激活函数。激活函数的主要作用是使输出非线性化，即曲线化或者分段化（对应分段函数）。\n\n# 2：为什么要激活函数\n\n从$z=x_1w_1+x_2w_2+x_3w_3+b$不难看出，在没有激活函数时，我们的神经元输出，总是与输入$x_1,x_2,x_3$成线性关系。。\n\n简单点的例子，$z = x_1*w+b$。\n\n![](https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png)\n\n可以知道，这是一条直线。可以解决一个简单的二分类问题。\n\n![](https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png)\n\n如果这个二分类不是用直线分割的呢？\n\n比如，一个圆形，圆内的点是1，圆外是0。我们用直线就很难将他们区分开了。\n\n当然，也可以使用无数条小的直线来划分这两个区域，但是对比直接使用曲线，就复杂多了。\n\n为了让我们的输出函数，符合非线性特征，引入了激活函数的概念。\n\n# 3：哪些激活函数\n\n![img](https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg)\n\n- Sigmoid函数\n\nSigmoid函数只会输出0到1之间的正数，当输入无穷小时，输出为0，输入无穷大时，输出为1。\n\n**缺点**：\n\n基于反向传播（根据链式求导法则）的参数更新，随着网络层数的增加，w更新的梯度会越来越小，并逐渐接近于零。也就是所谓的梯度消失。\n\n下图是链式求导法则求w梯度的过程。这是某个神经网络中的一部分神经元。\n\n![](https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png)\n\n其中，$net_{o1}=h1*w5+h2*w6+b2$\n\n$out_{o1}=Sigmoid(net_{o1})$\n\n误差函数为$E_{o1}=\\frac{target-out_{o1}}{2}$\n\n获得$w_5$更新所需的梯度就是求$E_{o1}$对$w_5$求导。\n\n根据链式法则，\n$$\n\\frac{\\partial E_{o1}}{\\part w_5} = \\frac{\\part E_{o1}}{\\part out_{o1}}* \\frac{\\part out_{o1}}{\\part net_{o1}}* \\frac{\\part net_{o1}}{\\part w_5}\n$$\n其中$\\frac{\\part out_{o1}}{\\part net_{o1}}$就是Sigmoid函数求导。\n\n根据Sigmoid函数求导公式，\n$$\n\\frac{\\part g(z)}{\\part z} = g(z)(1-g(z))\n$$\n![](https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png)\n\n上式，$g(z)$为Sigmoid函数，其导数最大值为0.25.\n\n当神经元个数逐渐增多，前向w梯度，是后向w梯度做链式法则的结果，那么会有许多个$g'(z)$相乘。则，前向w的梯度会逐渐趋近于0。\n\n- tanh函数\n\n![](https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png)\n\n相比于Sigmod函数，其输出均值为0。\n\n缺点：\n\n仍然存在梯度消失现象。\n\n- Relu函数\n\n目前最常用的函数，只需判断输入是否大于零，小于零的输入，输出为0\n\n![](https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png)\n\n# 4：参考资料\n\n《[CNN入门讲解：什么是激活函数（Activation Function）](https://zhuanlan.zhihu.com/p/32824193)》\n\n《[常用激活函数（激励函数）理解与总结](https://blog.csdn.net/tyhj_sf/article/details/79932893)》\n\n《[BP（反向传播算法）公式推导及例题解析](https://zhuanlan.zhihu.com/p/32819991)》\n\n《[sigmoid函数的求导](https://blog.csdn.net/C_Dreams/article/details/75748005)》","source":"_posts/人工智能——激活函数.md","raw":"---\ntitle: 人工智能——激活函数\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2020-11-15 10:00:48\npassword:\nsummary:\ntags: \n - 人工智能\n - AI\ncategories: 人工智能\n---\n\n# 1：什么是激活函数\n\n![](https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png)\n\n以一个简单的神经元为例。在没有激活函数时，神经元输出z等于$z=x_1w_1+x_2w_2+x_3w_3+b$\n\n而激活函数将z作为输入，得到新的神经元输出$f(z)$\n\n这里的$f(z)$即激活函数。激活函数的主要作用是使输出非线性化，即曲线化或者分段化（对应分段函数）。\n\n# 2：为什么要激活函数\n\n从$z=x_1w_1+x_2w_2+x_3w_3+b$不难看出，在没有激活函数时，我们的神经元输出，总是与输入$x_1,x_2,x_3$成线性关系。。\n\n简单点的例子，$z = x_1*w+b$。\n\n![](https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png)\n\n可以知道，这是一条直线。可以解决一个简单的二分类问题。\n\n![](https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png)\n\n如果这个二分类不是用直线分割的呢？\n\n比如，一个圆形，圆内的点是1，圆外是0。我们用直线就很难将他们区分开了。\n\n当然，也可以使用无数条小的直线来划分这两个区域，但是对比直接使用曲线，就复杂多了。\n\n为了让我们的输出函数，符合非线性特征，引入了激活函数的概念。\n\n# 3：哪些激活函数\n\n![img](https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg)\n\n- Sigmoid函数\n\nSigmoid函数只会输出0到1之间的正数，当输入无穷小时，输出为0，输入无穷大时，输出为1。\n\n**缺点**：\n\n基于反向传播（根据链式求导法则）的参数更新，随着网络层数的增加，w更新的梯度会越来越小，并逐渐接近于零。也就是所谓的梯度消失。\n\n下图是链式求导法则求w梯度的过程。这是某个神经网络中的一部分神经元。\n\n![](https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png)\n\n其中，$net_{o1}=h1*w5+h2*w6+b2$\n\n$out_{o1}=Sigmoid(net_{o1})$\n\n误差函数为$E_{o1}=\\frac{target-out_{o1}}{2}$\n\n获得$w_5$更新所需的梯度就是求$E_{o1}$对$w_5$求导。\n\n根据链式法则，\n$$\n\\frac{\\partial E_{o1}}{\\part w_5} = \\frac{\\part E_{o1}}{\\part out_{o1}}* \\frac{\\part out_{o1}}{\\part net_{o1}}* \\frac{\\part net_{o1}}{\\part w_5}\n$$\n其中$\\frac{\\part out_{o1}}{\\part net_{o1}}$就是Sigmoid函数求导。\n\n根据Sigmoid函数求导公式，\n$$\n\\frac{\\part g(z)}{\\part z} = g(z)(1-g(z))\n$$\n![](https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png)\n\n上式，$g(z)$为Sigmoid函数，其导数最大值为0.25.\n\n当神经元个数逐渐增多，前向w梯度，是后向w梯度做链式法则的结果，那么会有许多个$g'(z)$相乘。则，前向w的梯度会逐渐趋近于0。\n\n- tanh函数\n\n![](https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png)\n\n相比于Sigmod函数，其输出均值为0。\n\n缺点：\n\n仍然存在梯度消失现象。\n\n- Relu函数\n\n目前最常用的函数，只需判断输入是否大于零，小于零的输入，输出为0\n\n![](https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png)\n\n# 4：参考资料\n\n《[CNN入门讲解：什么是激活函数（Activation Function）](https://zhuanlan.zhihu.com/p/32824193)》\n\n《[常用激活函数（激励函数）理解与总结](https://blog.csdn.net/tyhj_sf/article/details/79932893)》\n\n《[BP（反向传播算法）公式推导及例题解析](https://zhuanlan.zhihu.com/p/32819991)》\n\n《[sigmoid函数的求导](https://blog.csdn.net/C_Dreams/article/details/75748005)》","slug":"人工智能——激活函数","published":1,"updated":"2020-11-15T12:11:18.508Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckhj2wb3600009kvz0jsg7xy0","content":"<h1 id=\"1：什么是激活函数\"><a href=\"#1：什么是激活函数\" class=\"headerlink\" title=\"1：什么是激活函数\"></a>1：什么是激活函数</h1><p><img src=\"https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>以一个简单的神经元为例。在没有激活函数时，神经元输出z等于$z=x_1w_1+x_2w_2+x_3w_3+b$</p>\n<p>而激活函数将z作为输入，得到新的神经元输出$f(z)$</p>\n<p>这里的$f(z)$即激活函数。激活函数的主要作用是使输出非线性化，即曲线化或者分段化（对应分段函数）。</p>\n<h1 id=\"2：为什么要激活函数\"><a href=\"#2：为什么要激活函数\" class=\"headerlink\" title=\"2：为什么要激活函数\"></a>2：为什么要激活函数</h1><p>从$z=x_1w_1+x_2w_2+x_3w_3+b$不难看出，在没有激活函数时，我们的神经元输出，总是与输入$x_1,x_2,x_3$成线性关系。。</p>\n<p>简单点的例子，$z = x_1*w+b$。</p>\n<p><img src=\"https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>可以知道，这是一条直线。可以解决一个简单的二分类问题。</p>\n<p><img src=\"https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>如果这个二分类不是用直线分割的呢？</p>\n<p>比如，一个圆形，圆内的点是1，圆外是0。我们用直线就很难将他们区分开了。</p>\n<p>当然，也可以使用无数条小的直线来划分这两个区域，但是对比直接使用曲线，就复杂多了。</p>\n<p>为了让我们的输出函数，符合非线性特征，引入了激活函数的概念。</p>\n<h1 id=\"3：哪些激活函数\"><a href=\"#3：哪些激活函数\" class=\"headerlink\" title=\"3：哪些激活函数\"></a>3：哪些激活函数</h1><p><img src=\"https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg\" class=\"lazyload\" data-srcset=\"https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"img\"></p>\n<ul>\n<li>Sigmoid函数</li>\n</ul>\n<p>Sigmoid函数只会输出0到1之间的正数，当输入无穷小时，输出为0，输入无穷大时，输出为1。</p>\n<p><strong>缺点</strong>：</p>\n<p>基于反向传播（根据链式求导法则）的参数更新，随着网络层数的增加，w更新的梯度会越来越小，并逐渐接近于零。也就是所谓的梯度消失。</p>\n<p>下图是链式求导法则求w梯度的过程。这是某个神经网络中的一部分神经元。</p>\n<p><img src=\"https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>其中，$net_{o1}=h1<em>w5+h2</em>w6+b2$</p>\n<p>$out_{o1}=Sigmoid(net_{o1})$</p>\n<p>误差函数为$E_{o1}=\\frac{target-out_{o1}}{2}$</p>\n<p>获得$w_5$更新所需的梯度就是求$E_{o1}$对$w_5$求导。</p>\n<p>根据链式法则，<br>$$<br>\\frac{\\partial E_{o1}}{\\part w_5} = \\frac{\\part E_{o1}}{\\part out_{o1}}* \\frac{\\part out_{o1}}{\\part net_{o1}}* \\frac{\\part net_{o1}}{\\part w_5}<br>$$<br>其中$\\frac{\\part out_{o1}}{\\part net_{o1}}$就是Sigmoid函数求导。</p>\n<p>根据Sigmoid函数求导公式，<br>$$<br>\\frac{\\part g(z)}{\\part z} = g(z)(1-g(z))<br>$$<br><img src=\"https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>上式，$g(z)$为Sigmoid函数，其导数最大值为0.25.</p>\n<p>当神经元个数逐渐增多，前向w梯度，是后向w梯度做链式法则的结果，那么会有许多个$g’(z)$相乘。则，前向w的梯度会逐渐趋近于0。</p>\n<ul>\n<li>tanh函数</li>\n</ul>\n<p><img src=\"https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>相比于Sigmod函数，其输出均值为0。</p>\n<p>缺点：</p>\n<p>仍然存在梯度消失现象。</p>\n<ul>\n<li>Relu函数</li>\n</ul>\n<p>目前最常用的函数，只需判断输入是否大于零，小于零的输入，输出为0</p>\n<p><img src=\"https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h1 id=\"4：参考资料\"><a href=\"#4：参考资料\" class=\"headerlink\" title=\"4：参考资料\"></a>4：参考资料</h1><p>《<a href=\"https://zhuanlan.zhihu.com/p/32824193\">CNN入门讲解：什么是激活函数（Activation Function）</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/tyhj_sf/article/details/79932893\">常用激活函数（激励函数）理解与总结</a>》</p>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/32819991\">BP（反向传播算法）公式推导及例题解析</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/C_Dreams/article/details/75748005\">sigmoid函数的求导</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：什么是激活函数\"><a href=\"#1：什么是激活函数\" class=\"headerlink\" title=\"1：什么是激活函数\"></a>1：什么是激活函数</h1><p><img src=\"https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png\"></p>\n<p>以一个简单的神经元为例。在没有激活函数时，神经元输出z等于$z=x_1w_1+x_2w_2+x_3w_3+b$</p>\n<p>而激活函数将z作为输入，得到新的神经元输出$f(z)$</p>\n<p>这里的$f(z)$即激活函数。激活函数的主要作用是使输出非线性化，即曲线化或者分段化（对应分段函数）。</p>\n<h1 id=\"2：为什么要激活函数\"><a href=\"#2：为什么要激活函数\" class=\"headerlink\" title=\"2：为什么要激活函数\"></a>2：为什么要激活函数</h1><p>从$z=x_1w_1+x_2w_2+x_3w_3+b$不难看出，在没有激活函数时，我们的神经元输出，总是与输入$x_1,x_2,x_3$成线性关系。。</p>\n<p>简单点的例子，$z = x_1*w+b$。</p>\n<p><img src=\"https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png\"></p>\n<p>可以知道，这是一条直线。可以解决一个简单的二分类问题。</p>\n<p><img src=\"https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png\"></p>\n<p>如果这个二分类不是用直线分割的呢？</p>\n<p>比如，一个圆形，圆内的点是1，圆外是0。我们用直线就很难将他们区分开了。</p>\n<p>当然，也可以使用无数条小的直线来划分这两个区域，但是对比直接使用曲线，就复杂多了。</p>\n<p>为了让我们的输出函数，符合非线性特征，引入了激活函数的概念。</p>\n<h1 id=\"3：哪些激活函数\"><a href=\"#3：哪些激活函数\" class=\"headerlink\" title=\"3：哪些激活函数\"></a>3：哪些激活函数</h1><p><img src=\"https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg\" alt=\"img\"></p>\n<ul>\n<li>Sigmoid函数</li>\n</ul>\n<p>Sigmoid函数只会输出0到1之间的正数，当输入无穷小时，输出为0，输入无穷大时，输出为1。</p>\n<p><strong>缺点</strong>：</p>\n<p>基于反向传播（根据链式求导法则）的参数更新，随着网络层数的增加，w更新的梯度会越来越小，并逐渐接近于零。也就是所谓的梯度消失。</p>\n<p>下图是链式求导法则求w梯度的过程。这是某个神经网络中的一部分神经元。</p>\n<p><img src=\"https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png\"></p>\n<p>其中，$net_{o1}=h1<em>w5+h2</em>w6+b2$</p>\n<p>$out_{o1}=Sigmoid(net_{o1})$</p>\n<p>误差函数为$E_{o1}=\\frac{target-out_{o1}}{2}$</p>\n<p>获得$w_5$更新所需的梯度就是求$E_{o1}$对$w_5$求导。</p>\n<p>根据链式法则，<br>$$<br>\\frac{\\partial E_{o1}}{\\part w_5} = \\frac{\\part E_{o1}}{\\part out_{o1}}* \\frac{\\part out_{o1}}{\\part net_{o1}}* \\frac{\\part net_{o1}}{\\part w_5}<br>$$<br>其中$\\frac{\\part out_{o1}}{\\part net_{o1}}$就是Sigmoid函数求导。</p>\n<p>根据Sigmoid函数求导公式，<br>$$<br>\\frac{\\part g(z)}{\\part z} = g(z)(1-g(z))<br>$$<br><img src=\"https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png\"></p>\n<p>上式，$g(z)$为Sigmoid函数，其导数最大值为0.25.</p>\n<p>当神经元个数逐渐增多，前向w梯度，是后向w梯度做链式法则的结果，那么会有许多个$g’(z)$相乘。则，前向w的梯度会逐渐趋近于0。</p>\n<ul>\n<li>tanh函数</li>\n</ul>\n<p><img src=\"https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png\"></p>\n<p>相比于Sigmod函数，其输出均值为0。</p>\n<p>缺点：</p>\n<p>仍然存在梯度消失现象。</p>\n<ul>\n<li>Relu函数</li>\n</ul>\n<p>目前最常用的函数，只需判断输入是否大于零，小于零的输入，输出为0</p>\n<p><img src=\"https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png\"></p>\n<h1 id=\"4：参考资料\"><a href=\"#4：参考资料\" class=\"headerlink\" title=\"4：参考资料\"></a>4：参考资料</h1><p>《<a href=\"https://zhuanlan.zhihu.com/p/32824193\">CNN入门讲解：什么是激活函数（Activation Function）</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/tyhj_sf/article/details/79932893\">常用激活函数（激励函数）理解与总结</a>》</p>\n<p>《<a href=\"https://zhuanlan.zhihu.com/p/32819991\">BP（反向传播算法）公式推导及例题解析</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/C_Dreams/article/details/75748005\">sigmoid函数的求导</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png","popularPost_tmp_gaData":{"updated":"Sun Nov 15 2020 13:11:18 GMT+0100 (GMT+01:00)","title":"人工智能——激活函数","path":"2020/11/15/人工智能——激活函数/","eyeCatchImage":"https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-11-15T09:00:48.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-11-15T09:00:48.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"人工智能","tags":["人工智能","AI"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"基于ESP8266WIFI模块和MPU6050传感器在Arduino上开发智能信箱","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-11-24T22:37:07.000Z","password":null,"summary":null,"_content":"\n# 1：开篇\n\n在德国，每家每户都有一个信箱，家庭的电气暖账单，亲人的问候，个人的信件都会装到这个小小的箱子里。。相较于送货到人的快递，信件往往被我们所忽略，常宅在家的我，一两个星期才会检查一次信箱。虽然信件通常不重要，但检查信箱还是有点麻烦。于是，我设计了一个小小的模块，让它代替我检查信箱，每当有新的信件进入信箱，它就发送一条微信消息，提醒我取信件。\n\n## 1.1 ESP8266-01 Wifi模块\n\nwifi模块是物联网中不可或缺的一部分，通过它连上家里的wifi，向网络发送请求。调用企业微信api，来发送微信消息。\n\n![](https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png)\n\nESP8266通过串口通信与Arduino单片机通信，由3.3V直流电压供电。\n\n## 1.2 GY-521模块\n\nGY-521指围绕MPU6050芯片所设计的电路板。\n\nMPU6050芯片集成了加速度计、陀螺仪、温度传感器。通过i2c与Arduino单片机通信。工作电压为5V。\n\n![](https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png)\n\n使用MPU6050检测信箱口的运动状态，判断是否有新的信件投入。\n\n## 1.3 Arduino\n\nArduino是目前非常火的开源单片机，其周边开发板大多开源，因此，一块Arduino开发板价格非常便宜，Arduino pro mini仅十块钱。我采用的是Arduino nano。其带有usb接口，比较方便调试。但是耗电会比pro mini高。\n\n![](https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png)\n\n在投入使用时，考虑到电池优化，建议使用pro mini。这样整个系统的运行时长会更久。\n\n此外，Arduino拥有庞大的社区，大部分传感器模块都有其适配支持的开源库。开发更加容易，且不用花费大量时间阅读硬件说明书。对于追求性能优化而不是仅功能实践的人来说，还是有必要阅读传感器数据手册的。\n\nArduino用于接收传感器的数据，并处理计算，判断是否信箱口有动作，如果有，则通过wifi模块发送微信。\n\n# 2：电路设计\n\n这里只是简单的画了一个电路设计图，因为不需要再去制作PCB板，也就不用设计PCB板图。只要购买相应的模块，然后对照电路图连线即可。\n\n![](https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png)\n\n面包板图\n\n![](https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png)\n\n## 2.1 电源设计\n\n- 5V电源\n\n通过4个AA电池串联，获得一个4x1.5V的直流电，理论电压为6V，而实际上都会小于6V。因为单片机供电要求在4.5~5.5V之间，如有必要可在电池正极接一个稳压二极管。稳压二极管由硅材料制成，其正向导通时，在PN结之间产生一个0.7V左右的压降。因此从稳压二极管输出的电压就能够满足单片机供电需求。我直接连接VCC供电是没有问题的。\n\n当然也可以使用9~12V的电源连接VIN接口供电，或者直接使用充电宝，通过usb接口供电。需要注意的是，usb供电会额外增加电能损耗。\n\n- 3V3电源\n\nESP8266模块使用3V3电源，4个干电池，无法提供3V电源，使用LM1117-3.3芯片将5V降压为3V。输入和输出口各加一个2.2uF的电容，用于稳压。\n\n## 2.2 各模块接线\n\nGY521模块SCL、SDA分别为I2C的时钟和数据总线，与ArduinoSCL和SDA相连。GY521 Int引脚接Arduino D2(INT0)引脚。\n\nArduino D6引脚，输出控制电平，通过一个稳压二极管，将5V高电平转3V高电平。\n\n# 3：程序设计\n\n## 3.1 wifi模块\n\n当WIFI模块启动时，会发送一条微信消息。然后进入睡眠，当RST引脚接收到低电平->高电平时，WIFI模块将被唤醒。\n\n我猜测我的WIFI模块是存在某种问题的，当它被唤醒时，并不会进行运行loop中的内容，而是进行了未知操作。因此，我在Arduino中不得不，向RST引脚发出两次低电平，第一次用于激活WIFI模块，第二次重置WIFI模块，因为它重启的时候，就会发送一条微信消息。所以也能实现既定功能。\n\nESP8266发送https请求时，不会自动获取服务器证书，所以需要自己从服务器去获取，可以直接从浏览器拷贝下来。这里没有使用证书，而是指纹，作用相同。\n\n```c++\n#include <Arduino.h>\n#include <ESP8266WiFi.h>\n#include <ESP8266HTTPClient.h>\n#include <WiFiClientSecureBearSSL.h>\n#include <ArduinoJson.h>\n\n//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）\n#define ssid \"SSIDU\"   //WiFi名称 \n#define password \"Password\"  //WiFi密码\n\n//https://qyapi.weixin.qq.com服务器的指纹\nconst char fingerprint[] PROGMEM = \"790e6e32485bb89503ac6da87d948f5e634322a7\";\n\n//HTTPS端口443\nconst int httpsPort = 443;  \n// 企业微信api相关\nString tokenUrl = \"https://qyapi.weixin.qq.com/cgi-bin/gettoken\";\nString sendMsgUrl = \"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=\";\nString corpid = \"ww98b********d\";\nString corpsecret = \"Kh8eKMZ**********wzQoPb0SYCqV3Tgcs\";\nString agentid = \"1000002\";\n\n//发起Https请求\n\n//获取企业微信access_token\nString get_token(){\n  String token = \"123\";\n  String requestUrl = tokenUrl + \"?corpid=\"+corpid+\"&corpsecret=\"+corpsecret;\n  std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n  client->setFingerprint(fingerprint);\n  HTTPClient https;\n\n  if (https.begin(*client, requestUrl)) {  // HTTPS\n      Serial.print(\"[HTTPS] GET...\\n\");\n      // start connection and send HTTP header\n      int httpCode = https.GET();\n\n      // httpCode will be negative on error\n      if (httpCode > 0) {\n        // HTTP header has been send and Server response header has been handled\n        Serial.printf(\"[HTTPS] GET... code: %d\\n\", httpCode);\n\n        // file found at server\n        if (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) {\n          String json = https.getString();\n          Serial.println(json);\n          // 创建DynamicJsonDocument对象，json中的参数为4个。\n          const size_t capacity = JSON_OBJECT_SIZE(4) + 290;\n          DynamicJsonDocument doc(capacity);\n          //反序列化数据\n          deserializeJson(doc, json);\n          if(doc[\"errcode\"].as<int>()==0){\n              token = doc[\"access_token\"].as<String>();\n          }\n        }\n      } else {\n        Serial.printf(\"[HTTPS] GET... failed, error: %s\\n\", https.errorToString(httpCode).c_str());\n      }\n\n      https.end();\n    } else {\n      Serial.printf(\"[HTTPS] Unable to connect\\n\");\n    }\n\n    return token;\n}\n\n //调用企业微信api，发送信息。\n void send_msg(String msg){\n   //调用get_token函数，获取token\n   String token = get_token();\n   //token=123表示get_token()函数请求token失败。\n   //如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。\n   if (token == \"123\"){\n      Serial.println(\"not get token\");\n     return;\n   }else{\n      Serial.println(\"got token\");\n    }\n   //构造请求url\n   String requestUrl = sendMsgUrl + token;\n   std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n   client->setFingerprint(fingerprint);\n   HTTPClient httpClient;\n   \n   httpClient.addHeader(\"Content-Type\",\"application/json\"); \n   //与微信服务器建立连接\n   httpClient.begin(*client,requestUrl);\n   //构建json数据，用于发送请求内容\n   String json = \"{\\\"touser\\\":\\\"@all\\\",\\\"msgtype\\\":\\\"text\\\",\\\"agentid\\\":1000002,\\\"text\\\":{\\\"content\\\":\\\"\"+msg+\"\\\"},\\\"safe\\\":0,\\\"enable_id_trans\\\":0,\\\"enable_duplicate_check\\\":0,\\\"duplicate_check_interval\\\":1800}\";\n   //发送请求内容\n   Serial.println(json);\n   int httpCode = httpClient.POST(json);\n   //未完善，可能发送请求成功，但api调用失败，后续完善。\n   if (httpCode > 0) {\n     //将服务器响应头打印到串口\n     Serial.println(\"[HTTP] POST... code:\"+ httpCode);\n     //将从服务器获取的数据打印到串口\n     if (httpCode == HTTP_CODE_OK) {\n       Serial.println(\"Send success\");\n       Serial.println(\"return str:\"+httpClient.getString());\n     }\n   } else {\n     Serial.println(\"send failure\");\n   }\n   //关闭ESP8266与服务器连接\n   httpClient.end();\n }\n\n//Wifi init\nvoid wifi_init(){\n  WiFi.mode(WIFI_STA);        //设置ESP8266为无线终端工作模式\n  \n  WiFi.begin(ssid, password); //连接WiFi\n  Serial.println(\"\");\n \n  Serial.println(\"Connecting\"); Serial.println(\"\");\n  \n  // 等待连接\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(\".\");\n  }\n \n  //成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。\n  Serial.println(\"\");\n  Serial.print(\"Connected to \");\n  Serial.println(ssid);\n  Serial.print(\"IP address: \");\n  Serial.println(WiFi.localIP()); \n}\n\nvoid setup() {  \n  Serial.begin(9600);\n  wifi_init();\n}\n\nvoid loop() {\n  send_msg(\"你有一封新信件，请及时提取！\");\n  delay(3000);\n  ESP.deepSleep(0);\n}\n```\n\n## 3.2 Arduino和GY521\n\n在这里，Arduino会对MPU6050芯片进行初始化设置，然后进入睡眠模式。在MPU中，我们将除了Z轴加速度采样以外的所有检测模块都关闭，以提高电池的持久力。并当Z轴检测到大于阈值的运动时，产生运动中断，中断将GY521的INT引脚拉低，INT引脚连接Arduino INT0引脚也就是2号引脚，Arduino将在中断发生时被唤醒。唤醒后的Arduino，通过6号引脚，向ESPwifi模块的RST发送两个低电平脉冲，用于激活并重置ESP。\n\nMPU6050是提供一些低电平方案的，比如CYCLE模式，此模式下可以设置MPU的采样频率，最低可达1.25Hz，但设置此模式，MPU6050的运动检测功能将受限。\n\n```c++\n\n#include <MPU6050.h>\n#include \"Wire.h\"\n#include <avr/sleep.h>\n\n//定义Arduino引脚，2号为中断引脚，当2号引脚输入低电平，Arduino从睡眠被唤醒\n//6号引脚为输出，当6号输出低电平，ESP8266模块被激活。\n#define INTERRUPT_PIN 2\n#define ESP_ACTIVATE_PIN 6\n#define MPU6050_ADDRESS 0x68\n\n#define SIGNAL_PATH_RESET 0x68\n#define INT_PIN_CFG 0x37\n#define ACCEL_CONFIG 0x1C\n#define MOT_THR 0x1F // Motion detection threshold bits [7:0]\n#define MOT_DUR 0x20 // Duration counter threshold for motion interrupt generation, 1 kHz rate, LSB = 1 ms\n#define MOT_DETECT_CTRL 0x69\n#define INT_ENABLE 0x38\n#define WHO_AM_I_MPU6050 0x75 // Should return 0x68\n#define INT_STATUS 0x3A\n\nMPU6050 mpu;\n\nvoid mpu6050_init(){\n  \n  Wire.begin();//开启i2c通讯\n  mpu.initialize();\n  //电源管理，将陀螺仪全部关闭，只留z轴加速度\n  //如果全部设置为待机，运动检测中断将无法工作\n  mpu.setStandbyXAccelEnabled(true);\n  mpu.setStandbyXGyroEnabled(true);\n  mpu.setStandbyYAccelEnabled(true);\n  mpu.setStandbyYGyroEnabled(true);\n  mpu.setStandbyZAccelEnabled(false);//保持z轴加速度检测活跃\n  mpu.setStandbyZGyroEnabled(true);\n\n\n  //关闭温度传感器\n  mpu.setTempSensorEnabled(false);\n  // mpu.setAccelerometerPowerOnDelay(3);//设置加速度计开机延迟\n  mpu.setInterruptMode(true); // 中断时中断引脚发出低电平\n  mpu.setIntZeroMotionEnabled(false);//关闭零运动中断检测\n  mpu.setIntMotionEnabled(true); // 运动检测中断使能\n  mpu.setInterruptLatch(true); // 电平保持，直到清除\n  mpu.setInterruptLatchClear(false);//清除中断引脚电平的方法，false表示只有读取status寄存器才能清除，true读取任意寄存器都可以清除。\n  mpu.setMotionDetectionThreshold(2);//检测阈值，阈值越大，需要的震动越大，才能产生中断，单位mg\n  mpu.setMotionDetectionDuration(20);//运动持续的时长，越大，则运动需要持续越久，才能产生中断。单位ms\n  mpu.setMotionDetectionCounterDecrement(1);\n  //Write register 28 (==0x1C) to set the Digital High Pass Filter, bits 3:0. For example set it to 0x01 for 5Hz. (These 3 bits are grey in the data sheet, but they are used! Leaving them 0 means the filter always outputs 0.)\n  writeByte(MPU6050_ADDRESS, ACCEL_CONFIG, 0x01); \n  Serial.println(\"MPU init finish\");\n}\n\nvoid sleepNow() {\n  set_sleep_mode(SLEEP_MODE_PWR_DOWN);//设置Arduino睡眠模式为power down\n  sleep_enable(); //使能睡眠\n  delay(500);\n  Serial.println(\"now sleep!\");\n  delay(2000);\n  Serial.println(\"Interrupt attached!\");\n\n\n  attachInterrupt(0, wakeUp,LOW);//开启中断，0表示INT0，对应2号引脚，wakeUP是中断发生时的处理函数，LOW：2号引脚低电平时触发\n  delay(500);\n  delay(500);\n  sleep_cpu();  //进入睡眠\n}\n\n//中断处理函数\nvoid wakeUp() {\n  detachInterrupt(0);//清除中断，防止中断处理过程中，再次进入中断\n  sleep_disable();//接触睡眠模式\n  digitalWrite(ESP_ACTIVATE_PIN,LOW);//设置激活引脚为低电平，用于激活芯片\n  Serial.println(\"wake up! reset esp\");\n}\n\n//I2c通讯，写入一个字节到寄存器\nvoid writeByte(uint8_t address, uint8_t subAddress, uint8_t data) {\n  Wire.begin();\n  Wire.beginTransmission(address); // Initialize the Tx buffer\n  Wire.write(subAddress); // Put slave register address in Tx buffer\n  Wire.write(data); // Put data in Tx buffer\n  Wire.endTransmission(); // Send the Tx buffer\n\n}\n\n//初始画arduino\nvoid arduino_init(){\n    Serial.begin(9600);//设置UART通信波特率，使用串口接收。\n    pinMode(INTERRUPT_PIN,INPUT);//设置INT0，即2号引脚为输入，确保初始化的时候，引脚上有高电平。\n    pinMode(ESP_ACTIVATE_PIN,OUTPUT);//设置6号引脚为输出，用于激活ESP模块\n    digitalWrite(ESP_ACTIVATE_PIN,HIGH);//设置输出为高电平，ESP的RESET引脚以低电平激活或重置芯片。\n    Serial.println(\"arduino init finish!\");\n}\n\nvoid setup(){\n  arduino_init();\n  mpu6050_init();\n}\n\nvoid loop(){\n  sleepNow();//进入睡眠\n  int16_t zAccel = mpu.getAccelerationZ();\n  Serial.println(zAccel);\n  bool detect = mpu.getIntMotionStatus();//读取中断状态，以清除中断引脚电平。不清除，MPU中断引脚会一直保持低电平。\n  Serial.println(detect);\n  //在中断函数中，发送了一个低电平激活芯片，在这里再发送一个低电平，用于重置芯片。最后回到高电平。\n  //不能再中断函数中，发送两个电平，因为中断函数中无法使用delay()方法。而低电平必须保持一定时间才能激活ESP。\n  delay(500);\n  digitalWrite(ESP_ACTIVATE_PIN,HIGH);\n  delay(500);\n  digitalWrite(ESP_ACTIVATE_PIN,LOW);\n  Serial.println(\"rest esp\");\n  delay(500);\n  digitalWrite(ESP_ACTIVATE_PIN,HIGH);\n  delay(1000);\n}\n```\n\n","source":"_posts/基于ESP8266WIFI模块和MPU6050加速度计在Arduino上开发智能信箱.md","raw":"---\ntitle: 基于ESP8266WIFI模块和MPU6050传感器在Arduino上开发智能信箱\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-11-24 23:37:07\npassword:\nsummary:\ntags:\n- Arduino\n- ESP8266\n- MPU6050\ncategories:\t嵌入式\n---\n\n# 1：开篇\n\n在德国，每家每户都有一个信箱，家庭的电气暖账单，亲人的问候，个人的信件都会装到这个小小的箱子里。。相较于送货到人的快递，信件往往被我们所忽略，常宅在家的我，一两个星期才会检查一次信箱。虽然信件通常不重要，但检查信箱还是有点麻烦。于是，我设计了一个小小的模块，让它代替我检查信箱，每当有新的信件进入信箱，它就发送一条微信消息，提醒我取信件。\n\n## 1.1 ESP8266-01 Wifi模块\n\nwifi模块是物联网中不可或缺的一部分，通过它连上家里的wifi，向网络发送请求。调用企业微信api，来发送微信消息。\n\n![](https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png)\n\nESP8266通过串口通信与Arduino单片机通信，由3.3V直流电压供电。\n\n## 1.2 GY-521模块\n\nGY-521指围绕MPU6050芯片所设计的电路板。\n\nMPU6050芯片集成了加速度计、陀螺仪、温度传感器。通过i2c与Arduino单片机通信。工作电压为5V。\n\n![](https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png)\n\n使用MPU6050检测信箱口的运动状态，判断是否有新的信件投入。\n\n## 1.3 Arduino\n\nArduino是目前非常火的开源单片机，其周边开发板大多开源，因此，一块Arduino开发板价格非常便宜，Arduino pro mini仅十块钱。我采用的是Arduino nano。其带有usb接口，比较方便调试。但是耗电会比pro mini高。\n\n![](https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png)\n\n在投入使用时，考虑到电池优化，建议使用pro mini。这样整个系统的运行时长会更久。\n\n此外，Arduino拥有庞大的社区，大部分传感器模块都有其适配支持的开源库。开发更加容易，且不用花费大量时间阅读硬件说明书。对于追求性能优化而不是仅功能实践的人来说，还是有必要阅读传感器数据手册的。\n\nArduino用于接收传感器的数据，并处理计算，判断是否信箱口有动作，如果有，则通过wifi模块发送微信。\n\n# 2：电路设计\n\n这里只是简单的画了一个电路设计图，因为不需要再去制作PCB板，也就不用设计PCB板图。只要购买相应的模块，然后对照电路图连线即可。\n\n![](https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png)\n\n面包板图\n\n![](https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png)\n\n## 2.1 电源设计\n\n- 5V电源\n\n通过4个AA电池串联，获得一个4x1.5V的直流电，理论电压为6V，而实际上都会小于6V。因为单片机供电要求在4.5~5.5V之间，如有必要可在电池正极接一个稳压二极管。稳压二极管由硅材料制成，其正向导通时，在PN结之间产生一个0.7V左右的压降。因此从稳压二极管输出的电压就能够满足单片机供电需求。我直接连接VCC供电是没有问题的。\n\n当然也可以使用9~12V的电源连接VIN接口供电，或者直接使用充电宝，通过usb接口供电。需要注意的是，usb供电会额外增加电能损耗。\n\n- 3V3电源\n\nESP8266模块使用3V3电源，4个干电池，无法提供3V电源，使用LM1117-3.3芯片将5V降压为3V。输入和输出口各加一个2.2uF的电容，用于稳压。\n\n## 2.2 各模块接线\n\nGY521模块SCL、SDA分别为I2C的时钟和数据总线，与ArduinoSCL和SDA相连。GY521 Int引脚接Arduino D2(INT0)引脚。\n\nArduino D6引脚，输出控制电平，通过一个稳压二极管，将5V高电平转3V高电平。\n\n# 3：程序设计\n\n## 3.1 wifi模块\n\n当WIFI模块启动时，会发送一条微信消息。然后进入睡眠，当RST引脚接收到低电平->高电平时，WIFI模块将被唤醒。\n\n我猜测我的WIFI模块是存在某种问题的，当它被唤醒时，并不会进行运行loop中的内容，而是进行了未知操作。因此，我在Arduino中不得不，向RST引脚发出两次低电平，第一次用于激活WIFI模块，第二次重置WIFI模块，因为它重启的时候，就会发送一条微信消息。所以也能实现既定功能。\n\nESP8266发送https请求时，不会自动获取服务器证书，所以需要自己从服务器去获取，可以直接从浏览器拷贝下来。这里没有使用证书，而是指纹，作用相同。\n\n```c++\n#include <Arduino.h>\n#include <ESP8266WiFi.h>\n#include <ESP8266HTTPClient.h>\n#include <WiFiClientSecureBearSSL.h>\n#include <ArduinoJson.h>\n\n//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）\n#define ssid \"SSIDU\"   //WiFi名称 \n#define password \"Password\"  //WiFi密码\n\n//https://qyapi.weixin.qq.com服务器的指纹\nconst char fingerprint[] PROGMEM = \"790e6e32485bb89503ac6da87d948f5e634322a7\";\n\n//HTTPS端口443\nconst int httpsPort = 443;  \n// 企业微信api相关\nString tokenUrl = \"https://qyapi.weixin.qq.com/cgi-bin/gettoken\";\nString sendMsgUrl = \"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=\";\nString corpid = \"ww98b********d\";\nString corpsecret = \"Kh8eKMZ**********wzQoPb0SYCqV3Tgcs\";\nString agentid = \"1000002\";\n\n//发起Https请求\n\n//获取企业微信access_token\nString get_token(){\n  String token = \"123\";\n  String requestUrl = tokenUrl + \"?corpid=\"+corpid+\"&corpsecret=\"+corpsecret;\n  std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n  client->setFingerprint(fingerprint);\n  HTTPClient https;\n\n  if (https.begin(*client, requestUrl)) {  // HTTPS\n      Serial.print(\"[HTTPS] GET...\\n\");\n      // start connection and send HTTP header\n      int httpCode = https.GET();\n\n      // httpCode will be negative on error\n      if (httpCode > 0) {\n        // HTTP header has been send and Server response header has been handled\n        Serial.printf(\"[HTTPS] GET... code: %d\\n\", httpCode);\n\n        // file found at server\n        if (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) {\n          String json = https.getString();\n          Serial.println(json);\n          // 创建DynamicJsonDocument对象，json中的参数为4个。\n          const size_t capacity = JSON_OBJECT_SIZE(4) + 290;\n          DynamicJsonDocument doc(capacity);\n          //反序列化数据\n          deserializeJson(doc, json);\n          if(doc[\"errcode\"].as<int>()==0){\n              token = doc[\"access_token\"].as<String>();\n          }\n        }\n      } else {\n        Serial.printf(\"[HTTPS] GET... failed, error: %s\\n\", https.errorToString(httpCode).c_str());\n      }\n\n      https.end();\n    } else {\n      Serial.printf(\"[HTTPS] Unable to connect\\n\");\n    }\n\n    return token;\n}\n\n //调用企业微信api，发送信息。\n void send_msg(String msg){\n   //调用get_token函数，获取token\n   String token = get_token();\n   //token=123表示get_token()函数请求token失败。\n   //如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。\n   if (token == \"123\"){\n      Serial.println(\"not get token\");\n     return;\n   }else{\n      Serial.println(\"got token\");\n    }\n   //构造请求url\n   String requestUrl = sendMsgUrl + token;\n   std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n   client->setFingerprint(fingerprint);\n   HTTPClient httpClient;\n   \n   httpClient.addHeader(\"Content-Type\",\"application/json\"); \n   //与微信服务器建立连接\n   httpClient.begin(*client,requestUrl);\n   //构建json数据，用于发送请求内容\n   String json = \"{\\\"touser\\\":\\\"@all\\\",\\\"msgtype\\\":\\\"text\\\",\\\"agentid\\\":1000002,\\\"text\\\":{\\\"content\\\":\\\"\"+msg+\"\\\"},\\\"safe\\\":0,\\\"enable_id_trans\\\":0,\\\"enable_duplicate_check\\\":0,\\\"duplicate_check_interval\\\":1800}\";\n   //发送请求内容\n   Serial.println(json);\n   int httpCode = httpClient.POST(json);\n   //未完善，可能发送请求成功，但api调用失败，后续完善。\n   if (httpCode > 0) {\n     //将服务器响应头打印到串口\n     Serial.println(\"[HTTP] POST... code:\"+ httpCode);\n     //将从服务器获取的数据打印到串口\n     if (httpCode == HTTP_CODE_OK) {\n       Serial.println(\"Send success\");\n       Serial.println(\"return str:\"+httpClient.getString());\n     }\n   } else {\n     Serial.println(\"send failure\");\n   }\n   //关闭ESP8266与服务器连接\n   httpClient.end();\n }\n\n//Wifi init\nvoid wifi_init(){\n  WiFi.mode(WIFI_STA);        //设置ESP8266为无线终端工作模式\n  \n  WiFi.begin(ssid, password); //连接WiFi\n  Serial.println(\"\");\n \n  Serial.println(\"Connecting\"); Serial.println(\"\");\n  \n  // 等待连接\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(\".\");\n  }\n \n  //成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。\n  Serial.println(\"\");\n  Serial.print(\"Connected to \");\n  Serial.println(ssid);\n  Serial.print(\"IP address: \");\n  Serial.println(WiFi.localIP()); \n}\n\nvoid setup() {  \n  Serial.begin(9600);\n  wifi_init();\n}\n\nvoid loop() {\n  send_msg(\"你有一封新信件，请及时提取！\");\n  delay(3000);\n  ESP.deepSleep(0);\n}\n```\n\n## 3.2 Arduino和GY521\n\n在这里，Arduino会对MPU6050芯片进行初始化设置，然后进入睡眠模式。在MPU中，我们将除了Z轴加速度采样以外的所有检测模块都关闭，以提高电池的持久力。并当Z轴检测到大于阈值的运动时，产生运动中断，中断将GY521的INT引脚拉低，INT引脚连接Arduino INT0引脚也就是2号引脚，Arduino将在中断发生时被唤醒。唤醒后的Arduino，通过6号引脚，向ESPwifi模块的RST发送两个低电平脉冲，用于激活并重置ESP。\n\nMPU6050是提供一些低电平方案的，比如CYCLE模式，此模式下可以设置MPU的采样频率，最低可达1.25Hz，但设置此模式，MPU6050的运动检测功能将受限。\n\n```c++\n\n#include <MPU6050.h>\n#include \"Wire.h\"\n#include <avr/sleep.h>\n\n//定义Arduino引脚，2号为中断引脚，当2号引脚输入低电平，Arduino从睡眠被唤醒\n//6号引脚为输出，当6号输出低电平，ESP8266模块被激活。\n#define INTERRUPT_PIN 2\n#define ESP_ACTIVATE_PIN 6\n#define MPU6050_ADDRESS 0x68\n\n#define SIGNAL_PATH_RESET 0x68\n#define INT_PIN_CFG 0x37\n#define ACCEL_CONFIG 0x1C\n#define MOT_THR 0x1F // Motion detection threshold bits [7:0]\n#define MOT_DUR 0x20 // Duration counter threshold for motion interrupt generation, 1 kHz rate, LSB = 1 ms\n#define MOT_DETECT_CTRL 0x69\n#define INT_ENABLE 0x38\n#define WHO_AM_I_MPU6050 0x75 // Should return 0x68\n#define INT_STATUS 0x3A\n\nMPU6050 mpu;\n\nvoid mpu6050_init(){\n  \n  Wire.begin();//开启i2c通讯\n  mpu.initialize();\n  //电源管理，将陀螺仪全部关闭，只留z轴加速度\n  //如果全部设置为待机，运动检测中断将无法工作\n  mpu.setStandbyXAccelEnabled(true);\n  mpu.setStandbyXGyroEnabled(true);\n  mpu.setStandbyYAccelEnabled(true);\n  mpu.setStandbyYGyroEnabled(true);\n  mpu.setStandbyZAccelEnabled(false);//保持z轴加速度检测活跃\n  mpu.setStandbyZGyroEnabled(true);\n\n\n  //关闭温度传感器\n  mpu.setTempSensorEnabled(false);\n  // mpu.setAccelerometerPowerOnDelay(3);//设置加速度计开机延迟\n  mpu.setInterruptMode(true); // 中断时中断引脚发出低电平\n  mpu.setIntZeroMotionEnabled(false);//关闭零运动中断检测\n  mpu.setIntMotionEnabled(true); // 运动检测中断使能\n  mpu.setInterruptLatch(true); // 电平保持，直到清除\n  mpu.setInterruptLatchClear(false);//清除中断引脚电平的方法，false表示只有读取status寄存器才能清除，true读取任意寄存器都可以清除。\n  mpu.setMotionDetectionThreshold(2);//检测阈值，阈值越大，需要的震动越大，才能产生中断，单位mg\n  mpu.setMotionDetectionDuration(20);//运动持续的时长，越大，则运动需要持续越久，才能产生中断。单位ms\n  mpu.setMotionDetectionCounterDecrement(1);\n  //Write register 28 (==0x1C) to set the Digital High Pass Filter, bits 3:0. For example set it to 0x01 for 5Hz. (These 3 bits are grey in the data sheet, but they are used! Leaving them 0 means the filter always outputs 0.)\n  writeByte(MPU6050_ADDRESS, ACCEL_CONFIG, 0x01); \n  Serial.println(\"MPU init finish\");\n}\n\nvoid sleepNow() {\n  set_sleep_mode(SLEEP_MODE_PWR_DOWN);//设置Arduino睡眠模式为power down\n  sleep_enable(); //使能睡眠\n  delay(500);\n  Serial.println(\"now sleep!\");\n  delay(2000);\n  Serial.println(\"Interrupt attached!\");\n\n\n  attachInterrupt(0, wakeUp,LOW);//开启中断，0表示INT0，对应2号引脚，wakeUP是中断发生时的处理函数，LOW：2号引脚低电平时触发\n  delay(500);\n  delay(500);\n  sleep_cpu();  //进入睡眠\n}\n\n//中断处理函数\nvoid wakeUp() {\n  detachInterrupt(0);//清除中断，防止中断处理过程中，再次进入中断\n  sleep_disable();//接触睡眠模式\n  digitalWrite(ESP_ACTIVATE_PIN,LOW);//设置激活引脚为低电平，用于激活芯片\n  Serial.println(\"wake up! reset esp\");\n}\n\n//I2c通讯，写入一个字节到寄存器\nvoid writeByte(uint8_t address, uint8_t subAddress, uint8_t data) {\n  Wire.begin();\n  Wire.beginTransmission(address); // Initialize the Tx buffer\n  Wire.write(subAddress); // Put slave register address in Tx buffer\n  Wire.write(data); // Put data in Tx buffer\n  Wire.endTransmission(); // Send the Tx buffer\n\n}\n\n//初始画arduino\nvoid arduino_init(){\n    Serial.begin(9600);//设置UART通信波特率，使用串口接收。\n    pinMode(INTERRUPT_PIN,INPUT);//设置INT0，即2号引脚为输入，确保初始化的时候，引脚上有高电平。\n    pinMode(ESP_ACTIVATE_PIN,OUTPUT);//设置6号引脚为输出，用于激活ESP模块\n    digitalWrite(ESP_ACTIVATE_PIN,HIGH);//设置输出为高电平，ESP的RESET引脚以低电平激活或重置芯片。\n    Serial.println(\"arduino init finish!\");\n}\n\nvoid setup(){\n  arduino_init();\n  mpu6050_init();\n}\n\nvoid loop(){\n  sleepNow();//进入睡眠\n  int16_t zAccel = mpu.getAccelerationZ();\n  Serial.println(zAccel);\n  bool detect = mpu.getIntMotionStatus();//读取中断状态，以清除中断引脚电平。不清除，MPU中断引脚会一直保持低电平。\n  Serial.println(detect);\n  //在中断函数中，发送了一个低电平激活芯片，在这里再发送一个低电平，用于重置芯片。最后回到高电平。\n  //不能再中断函数中，发送两个电平，因为中断函数中无法使用delay()方法。而低电平必须保持一定时间才能激活ESP。\n  delay(500);\n  digitalWrite(ESP_ACTIVATE_PIN,HIGH);\n  delay(500);\n  digitalWrite(ESP_ACTIVATE_PIN,LOW);\n  Serial.println(\"rest esp\");\n  delay(500);\n  digitalWrite(ESP_ACTIVATE_PIN,HIGH);\n  delay(1000);\n}\n```\n\n","slug":"基于ESP8266WIFI模块和MPU6050加速度计在Arduino上开发智能信箱","published":1,"updated":"2020-11-30T17:29:09.825Z","_id":"cki1lyue90000ekvzaflh6z0c","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"1：开篇\"><a href=\"#1：开篇\" class=\"headerlink\" title=\"1：开篇\"></a>1：开篇</h1><p>在德国，每家每户都有一个信箱，家庭的电气暖账单，亲人的问候，个人的信件都会装到这个小小的箱子里。。相较于送货到人的快递，信件往往被我们所忽略，常宅在家的我，一两个星期才会检查一次信箱。虽然信件通常不重要，但检查信箱还是有点麻烦。于是，我设计了一个小小的模块，让它代替我检查信箱，每当有新的信件进入信箱，它就发送一条微信消息，提醒我取信件。</p>\n<h2 id=\"1-1-ESP8266-01-Wifi模块\"><a href=\"#1-1-ESP8266-01-Wifi模块\" class=\"headerlink\" title=\"1.1 ESP8266-01 Wifi模块\"></a>1.1 ESP8266-01 Wifi模块</h2><p>wifi模块是物联网中不可或缺的一部分，通过它连上家里的wifi，向网络发送请求。调用企业微信api，来发送微信消息。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>ESP8266通过串口通信与Arduino单片机通信，由3.3V直流电压供电。</p>\n<h2 id=\"1-2-GY-521模块\"><a href=\"#1-2-GY-521模块\" class=\"headerlink\" title=\"1.2 GY-521模块\"></a>1.2 GY-521模块</h2><p>GY-521指围绕MPU6050芯片所设计的电路板。</p>\n<p>MPU6050芯片集成了加速度计、陀螺仪、温度传感器。通过i2c与Arduino单片机通信。工作电压为5V。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>使用MPU6050检测信箱口的运动状态，判断是否有新的信件投入。</p>\n<h2 id=\"1-3-Arduino\"><a href=\"#1-3-Arduino\" class=\"headerlink\" title=\"1.3 Arduino\"></a>1.3 Arduino</h2><p>Arduino是目前非常火的开源单片机，其周边开发板大多开源，因此，一块Arduino开发板价格非常便宜，Arduino pro mini仅十块钱。我采用的是Arduino nano。其带有usb接口，比较方便调试。但是耗电会比pro mini高。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>在投入使用时，考虑到电池优化，建议使用pro mini。这样整个系统的运行时长会更久。</p>\n<p>此外，Arduino拥有庞大的社区，大部分传感器模块都有其适配支持的开源库。开发更加容易，且不用花费大量时间阅读硬件说明书。对于追求性能优化而不是仅功能实践的人来说，还是有必要阅读传感器数据手册的。</p>\n<p>Arduino用于接收传感器的数据，并处理计算，判断是否信箱口有动作，如果有，则通过wifi模块发送微信。</p>\n<h1 id=\"2：电路设计\"><a href=\"#2：电路设计\" class=\"headerlink\" title=\"2：电路设计\"></a>2：电路设计</h1><p>这里只是简单的画了一个电路设计图，因为不需要再去制作PCB板，也就不用设计PCB板图。只要购买相应的模块，然后对照电路图连线即可。</p>\n<p><img src=\"https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>面包板图</p>\n<p><img src=\"https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h2 id=\"2-1-电源设计\"><a href=\"#2-1-电源设计\" class=\"headerlink\" title=\"2.1 电源设计\"></a>2.1 电源设计</h2><ul>\n<li>5V电源</li>\n</ul>\n<p>通过4个AA电池串联，获得一个4x1.5V的直流电，理论电压为6V，而实际上都会小于6V。因为单片机供电要求在4.5~5.5V之间，如有必要可在电池正极接一个稳压二极管。稳压二极管由硅材料制成，其正向导通时，在PN结之间产生一个0.7V左右的压降。因此从稳压二极管输出的电压就能够满足单片机供电需求。我直接连接VCC供电是没有问题的。</p>\n<p>当然也可以使用9~12V的电源连接VIN接口供电，或者直接使用充电宝，通过usb接口供电。需要注意的是，usb供电会额外增加电能损耗。</p>\n<ul>\n<li>3V3电源</li>\n</ul>\n<p>ESP8266模块使用3V3电源，4个干电池，无法提供3V电源，使用LM1117-3.3芯片将5V降压为3V。输入和输出口各加一个2.2uF的电容，用于稳压。</p>\n<h2 id=\"2-2-各模块接线\"><a href=\"#2-2-各模块接线\" class=\"headerlink\" title=\"2.2 各模块接线\"></a>2.2 各模块接线</h2><p>GY521模块SCL、SDA分别为I2C的时钟和数据总线，与ArduinoSCL和SDA相连。GY521 Int引脚接Arduino D2(INT0)引脚。</p>\n<p>Arduino D6引脚，输出控制电平，通过一个稳压二极管，将5V高电平转3V高电平。</p>\n<h1 id=\"3：程序设计\"><a href=\"#3：程序设计\" class=\"headerlink\" title=\"3：程序设计\"></a>3：程序设计</h1><h2 id=\"3-1-wifi模块\"><a href=\"#3-1-wifi模块\" class=\"headerlink\" title=\"3.1 wifi模块\"></a>3.1 wifi模块</h2><p>当WIFI模块启动时，会发送一条微信消息。然后进入睡眠，当RST引脚接收到低电平-&gt;高电平时，WIFI模块将被唤醒。</p>\n<p>我猜测我的WIFI模块是存在某种问题的，当它被唤醒时，并不会进行运行loop中的内容，而是进行了未知操作。因此，我在Arduino中不得不，向RST引脚发出两次低电平，第一次用于激活WIFI模块，第二次重置WIFI模块，因为它重启的时候，就会发送一条微信消息。所以也能实现既定功能。</p>\n<p>ESP8266发送https请求时，不会自动获取服务器证书，所以需要自己从服务器去获取，可以直接从浏览器拷贝下来。这里没有使用证书，而是指纹，作用相同。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;Arduino.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ArduinoJson.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ssid <span class=\"meta-string\">&quot;SSIDU&quot;</span>   <span class=\"comment\">//WiFi名称 </span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> password <span class=\"meta-string\">&quot;Password&quot;</span>  <span class=\"comment\">//WiFi密码</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//https://qyapi.weixin.qq.com服务器的指纹</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span> fingerprint[] PROGMEM = <span class=\"string\">&quot;790e6e32485bb89503ac6da87d948f5e634322a7&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//HTTPS端口443</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> httpsPort = <span class=\"number\">443</span>;  </span><br><span class=\"line\"><span class=\"comment\">// 企业微信api相关</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> tokenUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> sendMsgUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> corpid = <span class=\"string\">&quot;ww98b********d&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> corpsecret = <span class=\"string\">&quot;Kh8eKMZ**********wzQoPb0SYCqV3Tgcs&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> agentid = <span class=\"string\">&quot;1000002&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//发起Https请求</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取企业微信access_token</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">String</span> <span class=\"title\">get_token</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> token = <span class=\"string\">&quot;123&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> requestUrl = tokenUrl + <span class=\"string\">&quot;?corpid=&quot;</span>+corpid+<span class=\"string\">&quot;&amp;corpsecret=&quot;</span>+corpsecret;</span><br><span class=\"line\">  <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">  client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">  HTTPClient https;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (https.<span class=\"built_in\">begin</span>(*client, requestUrl)) &#123;  <span class=\"comment\">// HTTPS</span></span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;[HTTPS] GET...\\n&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// start connection and send HTTP header</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> httpCode = https.GET();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// httpCode will be negative on error</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// HTTP header has been send and Server response header has been handled</span></span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... code: %d\\n&quot;</span>, httpCode);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// file found at server</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">String</span> json = https.getString();</span><br><span class=\"line\">          <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">          <span class=\"comment\">// 创建DynamicJsonDocument对象，json中的参数为4个。</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> <span class=\"keyword\">size_t</span> capacity = JSON_OBJECT_SIZE(<span class=\"number\">4</span>) + <span class=\"number\">290</span>;</span><br><span class=\"line\">          <span class=\"function\">DynamicJsonDocument <span class=\"title\">doc</span><span class=\"params\">(capacity)</span></span>;</span><br><span class=\"line\">          <span class=\"comment\">//反序列化数据</span></span><br><span class=\"line\">          deserializeJson(doc, json);</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(doc[<span class=\"string\">&quot;errcode&quot;</span>].as&lt;<span class=\"keyword\">int</span>&gt;()==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">              token = doc[<span class=\"string\">&quot;access_token&quot;</span>].as&lt;<span class=\"keyword\">String</span>&gt;();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... failed, error: %s\\n&quot;</span>, https.errorToString(httpCode).c_str());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      https.<span class=\"built_in\">end</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] Unable to connect\\n&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//调用企业微信api，发送信息。</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">send_msg</span><span class=\"params\">(<span class=\"keyword\">String</span> msg)</span></span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">//调用get_token函数，获取token</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> token = get_token();</span><br><span class=\"line\">   <span class=\"comment\">//token=123表示get_token()函数请求token失败。</span></span><br><span class=\"line\">   <span class=\"comment\">//如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (token == <span class=\"string\">&quot;123&quot;</span>)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;not get token&quot;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span>;</span><br><span class=\"line\">   &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;got token&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   <span class=\"comment\">//构造请求url</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> requestUrl = sendMsgUrl + token;</span><br><span class=\"line\">   <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">   client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">   HTTPClient httpClient;</span><br><span class=\"line\">   </span><br><span class=\"line\">   httpClient.addHeader(<span class=\"string\">&quot;Content-Type&quot;</span>,<span class=\"string\">&quot;application/json&quot;</span>); </span><br><span class=\"line\">   <span class=\"comment\">//与微信服务器建立连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">begin</span>(*client,requestUrl);</span><br><span class=\"line\">   <span class=\"comment\">//构建json数据，用于发送请求内容</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> json = <span class=\"string\">&quot;&#123;\\&quot;touser\\&quot;:\\&quot;@all\\&quot;,\\&quot;msgtype\\&quot;:\\&quot;text\\&quot;,\\&quot;agentid\\&quot;:1000002,\\&quot;text\\&quot;:&#123;\\&quot;content\\&quot;:\\&quot;&quot;</span>+msg+<span class=\"string\">&quot;\\&quot;&#125;,\\&quot;safe\\&quot;:0,\\&quot;enable_id_trans\\&quot;:0,\\&quot;enable_duplicate_check\\&quot;:0,\\&quot;duplicate_check_interval\\&quot;:1800&#125;&quot;</span>;</span><br><span class=\"line\">   <span class=\"comment\">//发送请求内容</span></span><br><span class=\"line\">   <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">   <span class=\"keyword\">int</span> httpCode = httpClient.POST(json);</span><br><span class=\"line\">   <span class=\"comment\">//未完善，可能发送请求成功，但api调用失败，后续完善。</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">     <span class=\"comment\">//将服务器响应头打印到串口</span></span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;[HTTP] POST... code:&quot;</span>+ httpCode);</span><br><span class=\"line\">     <span class=\"comment\">//将从服务器获取的数据打印到串口</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Send success&quot;</span>);</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;return str:&quot;</span>+httpClient.getString());</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;send failure&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"comment\">//关闭ESP8266与服务器连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">end</span>();</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Wifi init</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">wifi_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.mode(WIFI_STA);        <span class=\"comment\">//设置ESP8266为无线终端工作模式</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.<span class=\"built_in\">begin</span>(ssid, password); <span class=\"comment\">//连接WiFi</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Connecting&quot;</span>); <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 等待连接</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"built_in\">WiFi</span>.status() != WL_CONNECTED) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"comment\">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;Connected to &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(ssid);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;IP address: &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"built_in\">WiFi</span>.<span class=\"built_in\">localIP</span>()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">  wifi_init();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  send_msg(<span class=\"string\">&quot;你有一封新信件，请及时提取！&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">3000</span>);</span><br><span class=\"line\">  ESP.deepSleep(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-Arduino和GY521\"><a href=\"#3-2-Arduino和GY521\" class=\"headerlink\" title=\"3.2 Arduino和GY521\"></a>3.2 Arduino和GY521</h2><p>在这里，Arduino会对MPU6050芯片进行初始化设置，然后进入睡眠模式。在MPU中，我们将除了Z轴加速度采样以外的所有检测模块都关闭，以提高电池的持久力。并当Z轴检测到大于阈值的运动时，产生运动中断，中断将GY521的INT引脚拉低，INT引脚连接Arduino INT0引脚也就是2号引脚，Arduino将在中断发生时被唤醒。唤醒后的Arduino，通过6号引脚，向ESPwifi模块的RST发送两个低电平脉冲，用于激活并重置ESP。</p>\n<p>MPU6050是提供一些低电平方案的，比如CYCLE模式，此模式下可以设置MPU的采样频率，最低可达1.25Hz，但设置此模式，MPU6050的运动检测功能将受限。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;MPU6050.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;Wire.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;avr/sleep.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//定义Arduino引脚，2号为中断引脚，当2号引脚输入低电平，Arduino从睡眠被唤醒</span></span><br><span class=\"line\"><span class=\"comment\">//6号引脚为输出，当6号输出低电平，ESP8266模块被激活。</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INTERRUPT_PIN 2</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ESP_ACTIVATE_PIN 6</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MPU6050_ADDRESS 0x68</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SIGNAL_PATH_RESET 0x68</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INT_PIN_CFG 0x37</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ACCEL_CONFIG 0x1C</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOT_THR 0x1F <span class=\"comment\">// Motion detection threshold bits [7:0]</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOT_DUR 0x20 <span class=\"comment\">// Duration counter threshold for motion interrupt generation, 1 kHz rate, LSB = 1 ms</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOT_DETECT_CTRL 0x69</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INT_ENABLE 0x38</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> WHO_AM_I_MPU6050 0x75 <span class=\"comment\">// Should return 0x68</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INT_STATUS 0x3A</span></span><br><span class=\"line\"></span><br><span class=\"line\">MPU6050 mpu;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">mpu6050_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">begin</span>();<span class=\"comment\">//开启i2c通讯</span></span><br><span class=\"line\">  mpu.initialize();</span><br><span class=\"line\">  <span class=\"comment\">//电源管理，将陀螺仪全部关闭，只留z轴加速度</span></span><br><span class=\"line\">  <span class=\"comment\">//如果全部设置为待机，运动检测中断将无法工作</span></span><br><span class=\"line\">  mpu.setStandbyXAccelEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyXGyroEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyYAccelEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyYGyroEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyZAccelEnabled(<span class=\"literal\">false</span>);<span class=\"comment\">//保持z轴加速度检测活跃</span></span><br><span class=\"line\">  mpu.setStandbyZGyroEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//关闭温度传感器</span></span><br><span class=\"line\">  mpu.setTempSensorEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">  <span class=\"comment\">// mpu.setAccelerometerPowerOnDelay(3);//设置加速度计开机延迟</span></span><br><span class=\"line\">  mpu.setInterruptMode(<span class=\"literal\">true</span>); <span class=\"comment\">// 中断时中断引脚发出低电平</span></span><br><span class=\"line\">  mpu.setIntZeroMotionEnabled(<span class=\"literal\">false</span>);<span class=\"comment\">//关闭零运动中断检测</span></span><br><span class=\"line\">  mpu.setIntMotionEnabled(<span class=\"literal\">true</span>); <span class=\"comment\">// 运动检测中断使能</span></span><br><span class=\"line\">  mpu.setInterruptLatch(<span class=\"literal\">true</span>); <span class=\"comment\">// 电平保持，直到清除</span></span><br><span class=\"line\">  mpu.setInterruptLatchClear(<span class=\"literal\">false</span>);<span class=\"comment\">//清除中断引脚电平的方法，false表示只有读取status寄存器才能清除，true读取任意寄存器都可以清除。</span></span><br><span class=\"line\">  mpu.setMotionDetectionThreshold(<span class=\"number\">2</span>);<span class=\"comment\">//检测阈值，阈值越大，需要的震动越大，才能产生中断，单位mg</span></span><br><span class=\"line\">  mpu.setMotionDetectionDuration(<span class=\"number\">20</span>);<span class=\"comment\">//运动持续的时长，越大，则运动需要持续越久，才能产生中断。单位ms</span></span><br><span class=\"line\">  mpu.setMotionDetectionCounterDecrement(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"comment\">//Write register 28 (==0x1C) to set the Digital High Pass Filter, bits 3:0. For example set it to 0x01 for 5Hz. (These 3 bits are grey in the data sheet, but they are used! Leaving them 0 means the filter always outputs 0.)</span></span><br><span class=\"line\">  writeByte(MPU6050_ADDRESS, ACCEL_CONFIG, <span class=\"number\">0x01</span>); </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;MPU init finish&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sleepNow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<span class=\"comment\">//设置Arduino睡眠模式为power down</span></span><br><span class=\"line\">  sleep_enable(); <span class=\"comment\">//使能睡眠</span></span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;now sleep!&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">2000</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Interrupt attached!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">attachInterrupt</span>(<span class=\"number\">0</span>, wakeUp,<span class=\"literal\">LOW</span>);<span class=\"comment\">//开启中断，0表示INT0，对应2号引脚，wakeUP是中断发生时的处理函数，LOW：2号引脚低电平时触发</span></span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  sleep_cpu();  <span class=\"comment\">//进入睡眠</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//中断处理函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">wakeUp</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">detachInterrupt</span>(<span class=\"number\">0</span>);<span class=\"comment\">//清除中断，防止中断处理过程中，再次进入中断</span></span><br><span class=\"line\">  sleep_disable();<span class=\"comment\">//接触睡眠模式</span></span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">LOW</span>);<span class=\"comment\">//设置激活引脚为低电平，用于激活芯片</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;wake up! reset esp&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//I2c通讯，写入一个字节到寄存器</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">writeByte</span><span class=\"params\">(<span class=\"keyword\">uint8_t</span> address, <span class=\"keyword\">uint8_t</span> subAddress, <span class=\"keyword\">uint8_t</span> data)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">begin</span>();</span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">beginTransmission</span>(address); <span class=\"comment\">// Initialize the Tx buffer</span></span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">write</span>(subAddress); <span class=\"comment\">// Put slave register address in Tx buffer</span></span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">write</span>(data); <span class=\"comment\">// Put data in Tx buffer</span></span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">endTransmission</span>(); <span class=\"comment\">// Send the Tx buffer</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//初始画arduino</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">arduino_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);<span class=\"comment\">//设置UART通信波特率，使用串口接收。</span></span><br><span class=\"line\">    <span class=\"built_in\">pinMode</span>(INTERRUPT_PIN,<span class=\"literal\">INPUT</span>);<span class=\"comment\">//设置INT0，即2号引脚为输入，确保初始化的时候，引脚上有高电平。</span></span><br><span class=\"line\">    <span class=\"built_in\">pinMode</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">OUTPUT</span>);<span class=\"comment\">//设置6号引脚为输出，用于激活ESP模块</span></span><br><span class=\"line\">    <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">HIGH</span>);<span class=\"comment\">//设置输出为高电平，ESP的RESET引脚以低电平激活或重置芯片。</span></span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;arduino init finish!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  arduino_init();</span><br><span class=\"line\">  mpu6050_init();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  sleepNow();<span class=\"comment\">//进入睡眠</span></span><br><span class=\"line\">  <span class=\"keyword\">int16_t</span> zAccel = mpu.getAccelerationZ();</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(zAccel);</span><br><span class=\"line\">  <span class=\"keyword\">bool</span> detect = mpu.getIntMotionStatus();<span class=\"comment\">//读取中断状态，以清除中断引脚电平。不清除，MPU中断引脚会一直保持低电平。</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(detect);</span><br><span class=\"line\">  <span class=\"comment\">//在中断函数中，发送了一个低电平激活芯片，在这里再发送一个低电平，用于重置芯片。最后回到高电平。</span></span><br><span class=\"line\">  <span class=\"comment\">//不能再中断函数中，发送两个电平，因为中断函数中无法使用delay()方法。而低电平必须保持一定时间才能激活ESP。</span></span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">HIGH</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">LOW</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;rest esp&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">HIGH</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：开篇\"><a href=\"#1：开篇\" class=\"headerlink\" title=\"1：开篇\"></a>1：开篇</h1><p>在德国，每家每户都有一个信箱，家庭的电气暖账单，亲人的问候，个人的信件都会装到这个小小的箱子里。。相较于送货到人的快递，信件往往被我们所忽略，常宅在家的我，一两个星期才会检查一次信箱。虽然信件通常不重要，但检查信箱还是有点麻烦。于是，我设计了一个小小的模块，让它代替我检查信箱，每当有新的信件进入信箱，它就发送一条微信消息，提醒我取信件。</p>\n<h2 id=\"1-1-ESP8266-01-Wifi模块\"><a href=\"#1-1-ESP8266-01-Wifi模块\" class=\"headerlink\" title=\"1.1 ESP8266-01 Wifi模块\"></a>1.1 ESP8266-01 Wifi模块</h2><p>wifi模块是物联网中不可或缺的一部分，通过它连上家里的wifi，向网络发送请求。调用企业微信api，来发送微信消息。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png\"></p>\n<p>ESP8266通过串口通信与Arduino单片机通信，由3.3V直流电压供电。</p>\n<h2 id=\"1-2-GY-521模块\"><a href=\"#1-2-GY-521模块\" class=\"headerlink\" title=\"1.2 GY-521模块\"></a>1.2 GY-521模块</h2><p>GY-521指围绕MPU6050芯片所设计的电路板。</p>\n<p>MPU6050芯片集成了加速度计、陀螺仪、温度传感器。通过i2c与Arduino单片机通信。工作电压为5V。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png\"></p>\n<p>使用MPU6050检测信箱口的运动状态，判断是否有新的信件投入。</p>\n<h2 id=\"1-3-Arduino\"><a href=\"#1-3-Arduino\" class=\"headerlink\" title=\"1.3 Arduino\"></a>1.3 Arduino</h2><p>Arduino是目前非常火的开源单片机，其周边开发板大多开源，因此，一块Arduino开发板价格非常便宜，Arduino pro mini仅十块钱。我采用的是Arduino nano。其带有usb接口，比较方便调试。但是耗电会比pro mini高。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png\"></p>\n<p>在投入使用时，考虑到电池优化，建议使用pro mini。这样整个系统的运行时长会更久。</p>\n<p>此外，Arduino拥有庞大的社区，大部分传感器模块都有其适配支持的开源库。开发更加容易，且不用花费大量时间阅读硬件说明书。对于追求性能优化而不是仅功能实践的人来说，还是有必要阅读传感器数据手册的。</p>\n<p>Arduino用于接收传感器的数据，并处理计算，判断是否信箱口有动作，如果有，则通过wifi模块发送微信。</p>\n<h1 id=\"2：电路设计\"><a href=\"#2：电路设计\" class=\"headerlink\" title=\"2：电路设计\"></a>2：电路设计</h1><p>这里只是简单的画了一个电路设计图，因为不需要再去制作PCB板，也就不用设计PCB板图。只要购买相应的模块，然后对照电路图连线即可。</p>\n<p><img src=\"https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png\"></p>\n<p>面包板图</p>\n<p><img src=\"https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png\"></p>\n<h2 id=\"2-1-电源设计\"><a href=\"#2-1-电源设计\" class=\"headerlink\" title=\"2.1 电源设计\"></a>2.1 电源设计</h2><ul>\n<li>5V电源</li>\n</ul>\n<p>通过4个AA电池串联，获得一个4x1.5V的直流电，理论电压为6V，而实际上都会小于6V。因为单片机供电要求在4.5~5.5V之间，如有必要可在电池正极接一个稳压二极管。稳压二极管由硅材料制成，其正向导通时，在PN结之间产生一个0.7V左右的压降。因此从稳压二极管输出的电压就能够满足单片机供电需求。我直接连接VCC供电是没有问题的。</p>\n<p>当然也可以使用9~12V的电源连接VIN接口供电，或者直接使用充电宝，通过usb接口供电。需要注意的是，usb供电会额外增加电能损耗。</p>\n<ul>\n<li>3V3电源</li>\n</ul>\n<p>ESP8266模块使用3V3电源，4个干电池，无法提供3V电源，使用LM1117-3.3芯片将5V降压为3V。输入和输出口各加一个2.2uF的电容，用于稳压。</p>\n<h2 id=\"2-2-各模块接线\"><a href=\"#2-2-各模块接线\" class=\"headerlink\" title=\"2.2 各模块接线\"></a>2.2 各模块接线</h2><p>GY521模块SCL、SDA分别为I2C的时钟和数据总线，与ArduinoSCL和SDA相连。GY521 Int引脚接Arduino D2(INT0)引脚。</p>\n<p>Arduino D6引脚，输出控制电平，通过一个稳压二极管，将5V高电平转3V高电平。</p>\n<h1 id=\"3：程序设计\"><a href=\"#3：程序设计\" class=\"headerlink\" title=\"3：程序设计\"></a>3：程序设计</h1><h2 id=\"3-1-wifi模块\"><a href=\"#3-1-wifi模块\" class=\"headerlink\" title=\"3.1 wifi模块\"></a>3.1 wifi模块</h2><p>当WIFI模块启动时，会发送一条微信消息。然后进入睡眠，当RST引脚接收到低电平-&gt;高电平时，WIFI模块将被唤醒。</p>\n<p>我猜测我的WIFI模块是存在某种问题的，当它被唤醒时，并不会进行运行loop中的内容，而是进行了未知操作。因此，我在Arduino中不得不，向RST引脚发出两次低电平，第一次用于激活WIFI模块，第二次重置WIFI模块，因为它重启的时候，就会发送一条微信消息。所以也能实现既定功能。</p>\n<p>ESP8266发送https请求时，不会自动获取服务器证书，所以需要自己从服务器去获取，可以直接从浏览器拷贝下来。这里没有使用证书，而是指纹，作用相同。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;Arduino.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ArduinoJson.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ssid <span class=\"meta-string\">&quot;SSIDU&quot;</span>   <span class=\"comment\">//WiFi名称 </span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> password <span class=\"meta-string\">&quot;Password&quot;</span>  <span class=\"comment\">//WiFi密码</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//https://qyapi.weixin.qq.com服务器的指纹</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span> fingerprint[] PROGMEM = <span class=\"string\">&quot;790e6e32485bb89503ac6da87d948f5e634322a7&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//HTTPS端口443</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> httpsPort = <span class=\"number\">443</span>;  </span><br><span class=\"line\"><span class=\"comment\">// 企业微信api相关</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> tokenUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> sendMsgUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> corpid = <span class=\"string\">&quot;ww98b********d&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> corpsecret = <span class=\"string\">&quot;Kh8eKMZ**********wzQoPb0SYCqV3Tgcs&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> agentid = <span class=\"string\">&quot;1000002&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//发起Https请求</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取企业微信access_token</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">String</span> <span class=\"title\">get_token</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> token = <span class=\"string\">&quot;123&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> requestUrl = tokenUrl + <span class=\"string\">&quot;?corpid=&quot;</span>+corpid+<span class=\"string\">&quot;&amp;corpsecret=&quot;</span>+corpsecret;</span><br><span class=\"line\">  <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">  client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">  HTTPClient https;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (https.<span class=\"built_in\">begin</span>(*client, requestUrl)) &#123;  <span class=\"comment\">// HTTPS</span></span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;[HTTPS] GET...\\n&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// start connection and send HTTP header</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> httpCode = https.GET();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// httpCode will be negative on error</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// HTTP header has been send and Server response header has been handled</span></span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... code: %d\\n&quot;</span>, httpCode);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// file found at server</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">String</span> json = https.getString();</span><br><span class=\"line\">          <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">          <span class=\"comment\">// 创建DynamicJsonDocument对象，json中的参数为4个。</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> <span class=\"keyword\">size_t</span> capacity = JSON_OBJECT_SIZE(<span class=\"number\">4</span>) + <span class=\"number\">290</span>;</span><br><span class=\"line\">          <span class=\"function\">DynamicJsonDocument <span class=\"title\">doc</span><span class=\"params\">(capacity)</span></span>;</span><br><span class=\"line\">          <span class=\"comment\">//反序列化数据</span></span><br><span class=\"line\">          deserializeJson(doc, json);</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(doc[<span class=\"string\">&quot;errcode&quot;</span>].as&lt;<span class=\"keyword\">int</span>&gt;()==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">              token = doc[<span class=\"string\">&quot;access_token&quot;</span>].as&lt;<span class=\"keyword\">String</span>&gt;();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... failed, error: %s\\n&quot;</span>, https.errorToString(httpCode).c_str());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      https.<span class=\"built_in\">end</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] Unable to connect\\n&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//调用企业微信api，发送信息。</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">send_msg</span><span class=\"params\">(<span class=\"keyword\">String</span> msg)</span></span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">//调用get_token函数，获取token</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> token = get_token();</span><br><span class=\"line\">   <span class=\"comment\">//token=123表示get_token()函数请求token失败。</span></span><br><span class=\"line\">   <span class=\"comment\">//如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (token == <span class=\"string\">&quot;123&quot;</span>)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;not get token&quot;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span>;</span><br><span class=\"line\">   &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;got token&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   <span class=\"comment\">//构造请求url</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> requestUrl = sendMsgUrl + token;</span><br><span class=\"line\">   <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">   client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">   HTTPClient httpClient;</span><br><span class=\"line\">   </span><br><span class=\"line\">   httpClient.addHeader(<span class=\"string\">&quot;Content-Type&quot;</span>,<span class=\"string\">&quot;application/json&quot;</span>); </span><br><span class=\"line\">   <span class=\"comment\">//与微信服务器建立连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">begin</span>(*client,requestUrl);</span><br><span class=\"line\">   <span class=\"comment\">//构建json数据，用于发送请求内容</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> json = <span class=\"string\">&quot;&#123;\\&quot;touser\\&quot;:\\&quot;@all\\&quot;,\\&quot;msgtype\\&quot;:\\&quot;text\\&quot;,\\&quot;agentid\\&quot;:1000002,\\&quot;text\\&quot;:&#123;\\&quot;content\\&quot;:\\&quot;&quot;</span>+msg+<span class=\"string\">&quot;\\&quot;&#125;,\\&quot;safe\\&quot;:0,\\&quot;enable_id_trans\\&quot;:0,\\&quot;enable_duplicate_check\\&quot;:0,\\&quot;duplicate_check_interval\\&quot;:1800&#125;&quot;</span>;</span><br><span class=\"line\">   <span class=\"comment\">//发送请求内容</span></span><br><span class=\"line\">   <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">   <span class=\"keyword\">int</span> httpCode = httpClient.POST(json);</span><br><span class=\"line\">   <span class=\"comment\">//未完善，可能发送请求成功，但api调用失败，后续完善。</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">     <span class=\"comment\">//将服务器响应头打印到串口</span></span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;[HTTP] POST... code:&quot;</span>+ httpCode);</span><br><span class=\"line\">     <span class=\"comment\">//将从服务器获取的数据打印到串口</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Send success&quot;</span>);</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;return str:&quot;</span>+httpClient.getString());</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;send failure&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"comment\">//关闭ESP8266与服务器连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">end</span>();</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Wifi init</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">wifi_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.mode(WIFI_STA);        <span class=\"comment\">//设置ESP8266为无线终端工作模式</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.<span class=\"built_in\">begin</span>(ssid, password); <span class=\"comment\">//连接WiFi</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Connecting&quot;</span>); <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 等待连接</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"built_in\">WiFi</span>.status() != WL_CONNECTED) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"comment\">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;Connected to &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(ssid);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;IP address: &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"built_in\">WiFi</span>.<span class=\"built_in\">localIP</span>()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">  wifi_init();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  send_msg(<span class=\"string\">&quot;你有一封新信件，请及时提取！&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">3000</span>);</span><br><span class=\"line\">  ESP.deepSleep(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-Arduino和GY521\"><a href=\"#3-2-Arduino和GY521\" class=\"headerlink\" title=\"3.2 Arduino和GY521\"></a>3.2 Arduino和GY521</h2><p>在这里，Arduino会对MPU6050芯片进行初始化设置，然后进入睡眠模式。在MPU中，我们将除了Z轴加速度采样以外的所有检测模块都关闭，以提高电池的持久力。并当Z轴检测到大于阈值的运动时，产生运动中断，中断将GY521的INT引脚拉低，INT引脚连接Arduino INT0引脚也就是2号引脚，Arduino将在中断发生时被唤醒。唤醒后的Arduino，通过6号引脚，向ESPwifi模块的RST发送两个低电平脉冲，用于激活并重置ESP。</p>\n<p>MPU6050是提供一些低电平方案的，比如CYCLE模式，此模式下可以设置MPU的采样频率，最低可达1.25Hz，但设置此模式，MPU6050的运动检测功能将受限。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;MPU6050.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;Wire.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;avr/sleep.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//定义Arduino引脚，2号为中断引脚，当2号引脚输入低电平，Arduino从睡眠被唤醒</span></span><br><span class=\"line\"><span class=\"comment\">//6号引脚为输出，当6号输出低电平，ESP8266模块被激活。</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INTERRUPT_PIN 2</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ESP_ACTIVATE_PIN 6</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MPU6050_ADDRESS 0x68</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SIGNAL_PATH_RESET 0x68</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INT_PIN_CFG 0x37</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ACCEL_CONFIG 0x1C</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOT_THR 0x1F <span class=\"comment\">// Motion detection threshold bits [7:0]</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOT_DUR 0x20 <span class=\"comment\">// Duration counter threshold for motion interrupt generation, 1 kHz rate, LSB = 1 ms</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOT_DETECT_CTRL 0x69</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INT_ENABLE 0x38</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> WHO_AM_I_MPU6050 0x75 <span class=\"comment\">// Should return 0x68</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INT_STATUS 0x3A</span></span><br><span class=\"line\"></span><br><span class=\"line\">MPU6050 mpu;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">mpu6050_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">begin</span>();<span class=\"comment\">//开启i2c通讯</span></span><br><span class=\"line\">  mpu.initialize();</span><br><span class=\"line\">  <span class=\"comment\">//电源管理，将陀螺仪全部关闭，只留z轴加速度</span></span><br><span class=\"line\">  <span class=\"comment\">//如果全部设置为待机，运动检测中断将无法工作</span></span><br><span class=\"line\">  mpu.setStandbyXAccelEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyXGyroEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyYAccelEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyYGyroEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\">  mpu.setStandbyZAccelEnabled(<span class=\"literal\">false</span>);<span class=\"comment\">//保持z轴加速度检测活跃</span></span><br><span class=\"line\">  mpu.setStandbyZGyroEnabled(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//关闭温度传感器</span></span><br><span class=\"line\">  mpu.setTempSensorEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">  <span class=\"comment\">// mpu.setAccelerometerPowerOnDelay(3);//设置加速度计开机延迟</span></span><br><span class=\"line\">  mpu.setInterruptMode(<span class=\"literal\">true</span>); <span class=\"comment\">// 中断时中断引脚发出低电平</span></span><br><span class=\"line\">  mpu.setIntZeroMotionEnabled(<span class=\"literal\">false</span>);<span class=\"comment\">//关闭零运动中断检测</span></span><br><span class=\"line\">  mpu.setIntMotionEnabled(<span class=\"literal\">true</span>); <span class=\"comment\">// 运动检测中断使能</span></span><br><span class=\"line\">  mpu.setInterruptLatch(<span class=\"literal\">true</span>); <span class=\"comment\">// 电平保持，直到清除</span></span><br><span class=\"line\">  mpu.setInterruptLatchClear(<span class=\"literal\">false</span>);<span class=\"comment\">//清除中断引脚电平的方法，false表示只有读取status寄存器才能清除，true读取任意寄存器都可以清除。</span></span><br><span class=\"line\">  mpu.setMotionDetectionThreshold(<span class=\"number\">2</span>);<span class=\"comment\">//检测阈值，阈值越大，需要的震动越大，才能产生中断，单位mg</span></span><br><span class=\"line\">  mpu.setMotionDetectionDuration(<span class=\"number\">20</span>);<span class=\"comment\">//运动持续的时长，越大，则运动需要持续越久，才能产生中断。单位ms</span></span><br><span class=\"line\">  mpu.setMotionDetectionCounterDecrement(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"comment\">//Write register 28 (==0x1C) to set the Digital High Pass Filter, bits 3:0. For example set it to 0x01 for 5Hz. (These 3 bits are grey in the data sheet, but they are used! Leaving them 0 means the filter always outputs 0.)</span></span><br><span class=\"line\">  writeByte(MPU6050_ADDRESS, ACCEL_CONFIG, <span class=\"number\">0x01</span>); </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;MPU init finish&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sleepNow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<span class=\"comment\">//设置Arduino睡眠模式为power down</span></span><br><span class=\"line\">  sleep_enable(); <span class=\"comment\">//使能睡眠</span></span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;now sleep!&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">2000</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Interrupt attached!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">attachInterrupt</span>(<span class=\"number\">0</span>, wakeUp,<span class=\"literal\">LOW</span>);<span class=\"comment\">//开启中断，0表示INT0，对应2号引脚，wakeUP是中断发生时的处理函数，LOW：2号引脚低电平时触发</span></span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  sleep_cpu();  <span class=\"comment\">//进入睡眠</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//中断处理函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">wakeUp</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">detachInterrupt</span>(<span class=\"number\">0</span>);<span class=\"comment\">//清除中断，防止中断处理过程中，再次进入中断</span></span><br><span class=\"line\">  sleep_disable();<span class=\"comment\">//接触睡眠模式</span></span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">LOW</span>);<span class=\"comment\">//设置激活引脚为低电平，用于激活芯片</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;wake up! reset esp&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//I2c通讯，写入一个字节到寄存器</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">writeByte</span><span class=\"params\">(<span class=\"keyword\">uint8_t</span> address, <span class=\"keyword\">uint8_t</span> subAddress, <span class=\"keyword\">uint8_t</span> data)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">begin</span>();</span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">beginTransmission</span>(address); <span class=\"comment\">// Initialize the Tx buffer</span></span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">write</span>(subAddress); <span class=\"comment\">// Put slave register address in Tx buffer</span></span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">write</span>(data); <span class=\"comment\">// Put data in Tx buffer</span></span><br><span class=\"line\">  <span class=\"built_in\">Wire</span>.<span class=\"built_in\">endTransmission</span>(); <span class=\"comment\">// Send the Tx buffer</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//初始画arduino</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">arduino_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);<span class=\"comment\">//设置UART通信波特率，使用串口接收。</span></span><br><span class=\"line\">    <span class=\"built_in\">pinMode</span>(INTERRUPT_PIN,<span class=\"literal\">INPUT</span>);<span class=\"comment\">//设置INT0，即2号引脚为输入，确保初始化的时候，引脚上有高电平。</span></span><br><span class=\"line\">    <span class=\"built_in\">pinMode</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">OUTPUT</span>);<span class=\"comment\">//设置6号引脚为输出，用于激活ESP模块</span></span><br><span class=\"line\">    <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">HIGH</span>);<span class=\"comment\">//设置输出为高电平，ESP的RESET引脚以低电平激活或重置芯片。</span></span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;arduino init finish!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  arduino_init();</span><br><span class=\"line\">  mpu6050_init();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  sleepNow();<span class=\"comment\">//进入睡眠</span></span><br><span class=\"line\">  <span class=\"keyword\">int16_t</span> zAccel = mpu.getAccelerationZ();</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(zAccel);</span><br><span class=\"line\">  <span class=\"keyword\">bool</span> detect = mpu.getIntMotionStatus();<span class=\"comment\">//读取中断状态，以清除中断引脚电平。不清除，MPU中断引脚会一直保持低电平。</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(detect);</span><br><span class=\"line\">  <span class=\"comment\">//在中断函数中，发送了一个低电平激活芯片，在这里再发送一个低电平，用于重置芯片。最后回到高电平。</span></span><br><span class=\"line\">  <span class=\"comment\">//不能再中断函数中，发送两个电平，因为中断函数中无法使用delay()方法。而低电平必须保持一定时间才能激活ESP。</span></span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">HIGH</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">LOW</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;rest esp&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">  <span class=\"built_in\">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class=\"literal\">HIGH</span>);</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png","popularPost_tmp_gaData":{"updated":"Mon Nov 30 2020 18:29:09 GMT+0100 (GMT+01:00)","title":"基于ESP8266WIFI模块和MPU6050传感器在Arduino上开发智能信箱","path":"2020/11/24/基于ESP8266WIFI模块和MPU6050加速度计在Arduino上开发智能信箱/","eyeCatchImage":"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-11-24T22:37:07.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-11-24T22:37:07.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"嵌入式","tags":["Arduino","ESP8266","MPU6050"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"ESP8266从0到1","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2020-11-26T19:49:52.000Z","password":null,"summary":null,"_content":"\n# 0：前语\n\n推荐[太极创客](http://www.taichi-maker.com/)，学习ESP8266模块的更多知识。\n\n# 1：连线\n\nESP8266通过串口与电脑或者其他单片机实现交互，串口的使用比较简单。以最简单的ESP8266模块为例进行介绍。其他模块可能已经有了usb type-c或者其他接口，就直接用对应接口的线和设备连接就可以了。下图的模块，没有usb接口，因此需要我们自己连线。\n\n![](https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png)\n\n模块共引出了8个引脚，其中，\n\nVCC：接3.3V电压，为模块供电。\n\nGUD：接地\n\nGPIO0：平时直接悬空。需要刷固件的时候接地。\n\nCH_PD：通过一个10K电阻接3.3V电压，表示模块处于工作状态。否则将不工作。\n\n串口通信引脚，\n\nRXD：串口输入，表示这个引脚会接收其他模块传入的信息。与其他模块的TX引脚相连。\n\nTXD：串口输出，接其他模块的RX引脚，把数据传给其他模块。\n\n通过FTDI USB to TTL模块，可以将ESP直接和电脑连接。只需要将对应引脚与FTDI模块相连即可。\n\n# 2：简单开始\n\n下图为一个FTDI模块。将其引脚与ESP模块各引脚相连。\n\n下载FTDI模块的芯片驱动，直接搜索对应芯片就能找到。安装驱动后，将连接好的FTDI模块插入电脑，在电脑设备管理器中，能找到端口一栏，多了这个模块的端口比如(COM6)\n\n![](https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg)\n\n随意下载一个串口助手，选择FTDI模块的端口，设置波特率为115200，结束符为NL和CR。其他的默认。\n\n在串口助手上发送：AT\n\n串口助手的窗口会返回：OK，或者ERROR。\n\n如果返回OK，那么就可以通过AT指令操作ESP芯片连接WIFI或者作为AP让别人连wifi了。\n\n如果返回ERROR，那么就需要更新固件，以让ESP支持AT指令。\n\n> 未必一定要直接将ESP与电脑连接，也可以和其他单片机连接，通过对其他单片机编程，向ESP发送AT指令。重要的是，理解ESP的工作方式。\n\n# 3：更新固件\n\n如果你不小心将ESP配置错了，又不知道怎么去将它出厂设置，或者你发送AT指令总是返回ERROR，那么你就需要学习如何更新芯片固件。\n\n更新固件需要用到FTDI模块，将FTDI和ESP连接，FTDI连接电脑。\n\n首先下载[Flash下载工具](https://www.espressif.com/zh-hans/support/download/other-tools)。只有Windows系统能用。\n\n然后下载最新版本的[ESP8266 NONOS SDK](https://www.espressif.com/zh-hans/products/socs/esp8266ex/resources)。并解压。\n\n接线，需要注意，**GPIO0引脚必须接地**。\n\n|          |              |         |                                                              |                              |                                                              |\n| -------- | ------------ | ------- | ------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ |\n| **序号** | **引脚名称** | **I/O** | **描述**                                                     | **DC特性**                   | **备注**                                                     |\n| 1        | UTXD         |         | AT 串口发送输出                                              | 3.3V                         | 开机时禁止下拉                                               |\n| 2        | GND          |         | 地                                                           |                              |                                                              |\n| 3        | CH_PD(EN)    |         | 模块断电信号                                                 | 3.3V                         | 1）高电平工作； 2）低电平模块供电关掉；                      |\n| 4        | GPIO2        |         | 预留，默认悬空                                               | 3.3V                         | 开机上电时必须为高电平，禁止硬件下拉；内部默认已拉高         |\n| 5        | GPIO16       | I       | 复位信号(RESET)                                              | 3.3V                         | 低电平复位，高电平工作（默认高）；                           |\n| 6        | GPIO0        |         | 模块状态灯/工作模式选择                                      | 3.3V                         | 1）默认WiFiStatus：WiFi工作状态指示灯控制信号；2）工作模式选择：上拉：FlashBoot，工作模式；下拉：UARTDownload，下载模式（下载固件）； |\n| 7        | VCC          | I       | 模块采用单电源供电，通过 1 个VCC 电源引脚供电，电压范围：3.0V-3.6V,电流>600mA | Vmax=3.6VVmin=3.0VVnorm=3.3V | 电源供电能力请大于600mA;否则可能会引起模块工作异常，或者无线性能不好。 |\n| 8        | URXD         |         | AT 串口发送输入                                              | 3.3V                         |                                                              |\n\n![](https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png)\n\n打开flash_download_tool_v3.8.5.exe。选择Developer模式。\n\n选择8266芯片\n\n![](https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png)\n\n然后在之前解压的SDK中找到`C:\\Users……\\ESP8266_NONOS_SDK-3.0.4\\bin\\boot_v1.6.bin`文件刷入地址0x00000中\n\n![](https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png)\n\n然后点击START按钮开始，如果显示`等待上电`，在保证GPIO0接地的情况下，将RST引脚接地再断开。\n\n至此固件等待刷新完毕。\n\n# 4：AT指令\n\n完整的[AT指令PDF](https://www.espressif.com/sites/default/files/documentation/4a-esp8266_at_instruction_set_cn.pdf)\n\n常见的指令：\n\n## 基础命令\n\n- 测试：AT\n- 复位：AT+RST\n- 恢复出厂设置：AT+RESTORE\n- 查询本机IP和MAC：AT+CIFSR\n\n## 模式命令\n\n- 查询模式：AT+CWMODE?\n- 设置模式 1:STA 2:AP 3:both：AT+CWMODE=1\n- （STA）查询当前可用AP ：AT+CWLAP\n- （STA）加入可用AP ：AT+CWJAP=“ssid”,“psw”\n- （STA）退出当前AP ：AT+CWQAP\n- （AP）设置AP参数，ssid+psw+chn+ecn+n+01 ：AT+CWSAP=“哈哈”,“12345678”,3,3,4,0\n- （AP）查询AP参数：AT+CWSAP?\n\n## 客户端|服务器设置\n\n- 查询是否多连接 是1，否0 ：AT+CIPMUX?\n- 设置启动多连接1，单链接0（重启后默认0）：AT+CIPMUX=1\n- （多连接）关闭服务器，就是开启多连接客户端，默认是0 ：AT+CIPSERVER=0\n- （多连接）开启服务器,:开启+端口号port。 此时客户端要连本机，远程地址为 IP+Port ：AT+CIPSERVER=1,8080\n- （多连接）发送数据 id+Byte：AT+CIPSEND=0,10\n- （多连接）关闭TCP/UDP连接，id：AT+CIPCLOSE=0\n- （客户端单连接）建立TCP/UDP连接：AT+CIPSTART=“TCP”,“192.168.4.2”,100\n- （客户端单连接）发送数据，Byte ：AT+CIPSEND=10\n- （客户端单连接）使能穿透模式：AT+CIPMODE=1\n- （客户端单连接）进入透传模式发送：AT+CIPSEND\n- （客户端单连接）退出透传：+++\n- （客户端单连接）关闭TCP/UDP连接：AT+CIPCLOSE\n- （客户端多连接）建立TCP/UDP连接，id，TCP/UDP，IP，端口：AT+CIPSTART=0,“TCP”,“192.168.4.2”,100\n\n## 其他\n\n如果需要用到ESP通过软串口连接Arduino单片机，就需要修改ESP的波特率，ESP默认波特率是115200，而软串口只能是9600，修改波特率AT指令\n\nAT+CIOBAUD=9600\n\n如果返回ERROR，可以尝试\n\nAT+UART=9600,8,1,0,0\n\n# 5：使用Arduino IDE编写程序\n\nESP8266是可以直接使用Arduino IDE上烧录程序的。为了在Arduino IDE上直接编写程序，首先需要导入ESP8266的库。\n\n1. 在IDE的文件->首选项里边的附加开发板管理网址输入https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json\n\n或者http://arduino.esp8266.com/stable/package_esp8266com_index.json\n\n之后点击好。\n\n![](https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png)\n\n2. 在 工具->开发板选择最上方开发板管理器，之后搜索esp即可出现esp8266，选择版本之后进行安装即可。\n\n![](https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png)\n\n3. 在Arduino IDE 菜单>工具>开发板>开发板管理器 中选择你正在使用的8266开发板。\n\n如果你不清楚自己使用的是哪个开发板，可以选择generic esp8266 module，这是通用板子。\n\n4. 选择正确的端口。如果不知道自己板子连接电脑上的是哪个端口，可以打开电脑的`设备管理器`，其中有端口一栏，有详细信息。\n5. 上载程序前，将GPIO0引脚下拉接地，并将RST引脚接地在放开，上载程序时，GPIO0引脚需保持接地状态。上载完毕，将GPIO0引脚放空，并再次将RST引脚接地放开，切换到运行状态。\n\n# 6：Https请求程序\n\n这里以企业微信api发送应用消息为例，简述https请求中的get和post请求。http请求更为简单。网上资料也更多。\n\n要调取企业微信api首先需要仔细阅读其[开发文档](https://work.weixin.qq.com/api/doc/90000/90135/91039)。\n\n```c++\n#include <Arduino.h>\n#include <ESP8266WiFi.h>\n#include <ESP8266HTTPClient.h>\n#include <WiFiClientSecureBearSSL.h>\n#include <ArduinoJson.h>\n\n//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）\n#define ssid \"SSID\"   //WiFi名称 \n#define password \"PASSWORD\"  //WiFi密码\n\n//https://qyapi.weixin.qq.com网站的指纹。\n//esp通过https访问网站，都需要自己通过浏览器获取指纹，获取方法可自行搜索，在参考资料中也有文章，指纹一般几个月就需要更新一次。浏览器打开https://qyapi.weixin.qq.com/cgi-bin/gettoken获取指纹，而不只是只有主机名。\nconst char fingerprint[] PROGMEM = \"790e6e32485bb89503ac6da87d948f5e634322a7\";\n\n//HTTPS端口443\nconst int httpsPort = 443;  \n// 企业微信api相关\nString tokenUrl = \"https://qyapi.weixin.qq.com/cgi-bin/gettoken\";\nString sendMsgUrl = \"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=\";\n//以下信息需要替换，这里的均不可用\nString corpid = \"ww98b3k1b63788a7ad\";//你的企业id\nString corpsecret = \"Kh8asfasfaTrbSwRBGK5H0osnfasakjkmSYCqV3Tgcs\";//你的企业应用密钥\nString agentid = \"1000002\";//你的企业应用id\n\n//获取企业微信access_token\nString get_token(){\n  String token = \"123\";\n  String requestUrl = tokenUrl + \"?corpid=\"+corpid+\"&corpsecret=\"+corpsecret;\n  //https需要创建一个加密路径\n  std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n  client->setFingerprint(fingerprint);\n  //创建一个HTTP客户端\n  HTTPClient https;\n  //http和https的区别就是https.begin中的*client。如果没有*client,那么发送出去的就是http请求\n  //建立连接\n  if (https.begin(*client, requestUrl)) {  // HTTPS\n      Serial.print(\"[HTTPS] GET...\\n\");\n      // 发送get请求\n      int httpCode = https.GET();\n\t  //如果httpCode小于零则连接错误\n      if (httpCode > 0) {\n        Serial.printf(\"[HTTPS] GET... code: %d\\n\", httpCode);\n\n        // file found at server\n        if (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) {\n          //将返回的json序列，放到json变量\n          String json = https.getString();\n          Serial.println(json);\n          // 创建DynamicJsonDocument对象，json中的参数为4个。\n          const size_t capacity = JSON_OBJECT_SIZE(4) + 290;\n          DynamicJsonDocument doc(capacity);\n          //反序列化数据\n          deserializeJson(doc, json);\n          if(doc[\"errcode\"].as<int>()==0){\n              token = doc[\"access_token\"].as<String>();\n          }\n        }\n      } else {\n        Serial.printf(\"[HTTPS] GET... failed, error: %s\\n\", https.errorToString(httpCode).c_str());\n      }\n\n      https.end();\n    } else {\n      Serial.printf(\"[HTTPS] Unable to connect\\n\");\n    }\n\n    return token;\n}\n\n //调用企业微信api，发送信息。\n void send_msg(String msg){\n   //调用get_token函数，获取token\n   String token = get_token();\n   //token=123表示get_token()函数请求token失败。\n   //如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。\n   if (token == \"123\"){\n      Serial.println(\"not get token\");\n     return;\n   }else{\n      Serial.println(\"got token\");\n    }\n   //构造请求url\n   String requestUrl = sendMsgUrl + token;\n   std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n   client->setFingerprint(fingerprint);\n   HTTPClient httpClient;\n   \n   //与微信服务器建立连接\n   httpClient.begin(*client,requestUrl);\n   //构建json数据，用于发送请求内容\n   String json = \"{\\\"touser\\\":\\\"@all\\\",\\\"msgtype\\\":\\\"text\\\",\\\"agentid\\\":1000002,\\\"text\\\":{\\\"content\\\":\\\"\"+msg+\"\\\"},\\\"safe\\\":0,\\\"enable_id_trans\\\":0,\\\"enable_duplicate_check\\\":0,\\\"duplicate_check_interval\\\":1800}\";\n   //发送请求内容\n   Serial.println(json);\n   //将请求数据放到POST()中。\n   int httpCode = httpClient.POST(json);\n   //这里没有读取服务器返回的json数据，最好还是提取出来，判断是否发送成功。可自行添加代码\n   if (httpCode > 0) {\n     //将服务器响应头打印到串口\n     Serial.println(\"[HTTP] POST... code:\"+ httpCode);\n     //将从服务器获取的数据打印到串口\n     if (httpCode == HTTP_CODE_OK) {\n       Serial.println(\"Send success\");\n       Serial.println(\"return str:\"+httpClient.getString());\n     }\n   } else {\n     Serial.println(\"send failure\");\n   }\n   //关闭ESP8266与服务器连接\n   httpClient.end();\n }\n\n//Wifi init\nvoid wifi_init(){\n  Serial.begin(9600);\n  WiFi.mode(WIFI_STA);        //设置ESP8266为无线终端工作模式\n  \n  WiFi.begin(ssid, password); //连接WiFi\n  Serial.println(\"\");\n \n  Serial.println(\"Connecting\"); Serial.println(\"\");\n  \n  // 等待连接\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(\".\");\n  }\n \n  //成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。\n  Serial.println(\"\");\n  Serial.print(\"Connected to \");\n  Serial.println(ssid);\n  Serial.print(\"IP address: \");\n  Serial.println(WiFi.localIP()); \n}\n\nvoid setup() {\n  wifi_init();\n  send_msg(\"hello world!\");\n}\n\nvoid loop() {\n}\n```\n\n> ArduinoJSON库需要在IDE库管理中搜索安装，\n>\n> 其他库都是随ESP8266库一起安装的。\n\njson格式化和转义：http://www.bejson.com/\n\nArduinoJson Assistant：https://arduinojson.org/v6/assistant/\n\n关于ArduinoJSON详细教程可见参考资料章节\n\n# 7：低功耗方案\n\nESP8266提供三种省电模式。\n\n![](https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png)\n\n当我们的程序在某个时间段不需要使用wifi模块时，可让它进入睡眠模式，\n\nModem-Sleep模式：wifi与路由器保持连接，只在间断的时间里发送一个消息以保持连接。\n\nLight-Sleep模式：在Modem-Sleep的基础上，关闭CPU。在esp循环任务长时间不需要esp工作时，会自动进入此模式。\n\nDeep-Sleep模式：断开wifi。可用户配置。\n\ndeepsleep模式提供定时器唤醒和外部IO唤醒两种方案。\n\n1. 定时器唤醒\n\n将RST引脚接GPIO16。\n\n\n\n![](https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png)\n\n```c++\n/*\n * ESP8266 Deep sleep mode example\n * Rui Santos \n * Complete Project Details https://randomnerdtutorials.com\n */\n \nvoid setup() {\n  Serial.begin(115200);\n  Serial.setTimeout(2000);\n\n  // Wait for serial to initialize.\n  while(!Serial) { }\n  \n  // Deep sleep mode for 30 seconds, the ESP8266 wakes up by itself when GPIO 16 (D0 in NodeMCU board) is connected to the RESET pin\n  Serial.println(\"I'm awake, but I'm going into deep sleep mode for 30 seconds\");\n  ESP.deepSleep(30e6); \n\n}\n\nvoid loop() {\n}\n```\n\nESP-01芯片，GPIO16引脚并没有引出，所以，很难将RST引脚与其相接。\n\n![](https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png)\n\n2. 外部唤醒。\n\n将RST与外部单片机的IO口相接，当外部IO给RST一个低电平时，芯片将重启激活。\n\n例如使用按钮来提供低电平\n\n![](https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png)\n\n![](https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png)\n\n```c++\n/*\n * ESP8266 Deep sleep mode example\n * Rui Santos \n * Complete Project Details https://randomnerdtutorials.com\n */\n \nvoid setup() {\n  Serial.begin(115200);\n  Serial.setTimeout(2000);\n\n  // Wait for serial to initialize.\n  while(!Serial) { }\n    \n  // Deep sleep mode until RESET pin is connected to a LOW signal (for example pushbutton or magnetic reed switch)\n  Serial.println(\"I'm awake, but I'm going into deep sleep mode until RESET pin is connected to a LOW signal\");\n  ESP.deepSleep(0); \n}\n\nvoid loop() {\n}\n```\n\n3. 有的ESP模块上面带有LED灯，采用低功耗方案，务必将LED移除。\n\n# 8：与其他单片机通讯\n\nESP通过串口可与其他单片机传递信息，将ESP的TX引脚连接其他单片机RX引脚，ESP的RX连接其他单片机的TX。\n\n> 注意，ESP8266是3.3V供电，VCC需要接3.3V。如果其他单片机是5V供电，ESP的RX引脚需要分压之后连接其他单片机的TX，否则进入ESP的5V电压会烧坏芯片。ESP的TX则不用分压。\n\n下图为ESP连接Arduino Nano的接线图，途中，ESP RX引脚，通过1K和2K的电阻分压，其实也可以直接在ESP TX引脚和单片机RX引脚之间连接一个550左右的电阻。\n\n![](https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png)\n\n\n\n# 9：参考资料\n\n《[乐鑫ESP8266烧录固件、升级最新固件、刷MQTT固件](http://www.piaoyi.org/iot/espressif-ESP8266-MQTT-AT.html)》\n\n《[ESP8266 WIFI模块常用AT指令汇总](https://blog.csdn.net/weixin_44713763/article/details/104755899)》\n\n《[Arduino安装ESP8266的开发环境](https://blog.csdn.net/qq_34020487/article/details/102766314)》\n\n《[ESP8266 JSON解析](http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/esp8266-json-parse/)》\n\n《[物联网开发实用知识 – 查看网站证书指纹](http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/)》\n\n《[ESP8266 Deep Sleep with Arduino IDE (NodeMCU)](https://randomnerdtutorials.com/esp8266-deep-sleep-with-arduino-ide/)》","source":"_posts/ESP8266从0到1.md","raw":"---\ntitle: ESP8266从0到1\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2020-11-26 20:49:52\npassword:\nsummary:\ntags:\n- ESP8266\ncategories: 嵌入式\n---\n\n# 0：前语\n\n推荐[太极创客](http://www.taichi-maker.com/)，学习ESP8266模块的更多知识。\n\n# 1：连线\n\nESP8266通过串口与电脑或者其他单片机实现交互，串口的使用比较简单。以最简单的ESP8266模块为例进行介绍。其他模块可能已经有了usb type-c或者其他接口，就直接用对应接口的线和设备连接就可以了。下图的模块，没有usb接口，因此需要我们自己连线。\n\n![](https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png)\n\n模块共引出了8个引脚，其中，\n\nVCC：接3.3V电压，为模块供电。\n\nGUD：接地\n\nGPIO0：平时直接悬空。需要刷固件的时候接地。\n\nCH_PD：通过一个10K电阻接3.3V电压，表示模块处于工作状态。否则将不工作。\n\n串口通信引脚，\n\nRXD：串口输入，表示这个引脚会接收其他模块传入的信息。与其他模块的TX引脚相连。\n\nTXD：串口输出，接其他模块的RX引脚，把数据传给其他模块。\n\n通过FTDI USB to TTL模块，可以将ESP直接和电脑连接。只需要将对应引脚与FTDI模块相连即可。\n\n# 2：简单开始\n\n下图为一个FTDI模块。将其引脚与ESP模块各引脚相连。\n\n下载FTDI模块的芯片驱动，直接搜索对应芯片就能找到。安装驱动后，将连接好的FTDI模块插入电脑，在电脑设备管理器中，能找到端口一栏，多了这个模块的端口比如(COM6)\n\n![](https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg)\n\n随意下载一个串口助手，选择FTDI模块的端口，设置波特率为115200，结束符为NL和CR。其他的默认。\n\n在串口助手上发送：AT\n\n串口助手的窗口会返回：OK，或者ERROR。\n\n如果返回OK，那么就可以通过AT指令操作ESP芯片连接WIFI或者作为AP让别人连wifi了。\n\n如果返回ERROR，那么就需要更新固件，以让ESP支持AT指令。\n\n> 未必一定要直接将ESP与电脑连接，也可以和其他单片机连接，通过对其他单片机编程，向ESP发送AT指令。重要的是，理解ESP的工作方式。\n\n# 3：更新固件\n\n如果你不小心将ESP配置错了，又不知道怎么去将它出厂设置，或者你发送AT指令总是返回ERROR，那么你就需要学习如何更新芯片固件。\n\n更新固件需要用到FTDI模块，将FTDI和ESP连接，FTDI连接电脑。\n\n首先下载[Flash下载工具](https://www.espressif.com/zh-hans/support/download/other-tools)。只有Windows系统能用。\n\n然后下载最新版本的[ESP8266 NONOS SDK](https://www.espressif.com/zh-hans/products/socs/esp8266ex/resources)。并解压。\n\n接线，需要注意，**GPIO0引脚必须接地**。\n\n|          |              |         |                                                              |                              |                                                              |\n| -------- | ------------ | ------- | ------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ |\n| **序号** | **引脚名称** | **I/O** | **描述**                                                     | **DC特性**                   | **备注**                                                     |\n| 1        | UTXD         |         | AT 串口发送输出                                              | 3.3V                         | 开机时禁止下拉                                               |\n| 2        | GND          |         | 地                                                           |                              |                                                              |\n| 3        | CH_PD(EN)    |         | 模块断电信号                                                 | 3.3V                         | 1）高电平工作； 2）低电平模块供电关掉；                      |\n| 4        | GPIO2        |         | 预留，默认悬空                                               | 3.3V                         | 开机上电时必须为高电平，禁止硬件下拉；内部默认已拉高         |\n| 5        | GPIO16       | I       | 复位信号(RESET)                                              | 3.3V                         | 低电平复位，高电平工作（默认高）；                           |\n| 6        | GPIO0        |         | 模块状态灯/工作模式选择                                      | 3.3V                         | 1）默认WiFiStatus：WiFi工作状态指示灯控制信号；2）工作模式选择：上拉：FlashBoot，工作模式；下拉：UARTDownload，下载模式（下载固件）； |\n| 7        | VCC          | I       | 模块采用单电源供电，通过 1 个VCC 电源引脚供电，电压范围：3.0V-3.6V,电流>600mA | Vmax=3.6VVmin=3.0VVnorm=3.3V | 电源供电能力请大于600mA;否则可能会引起模块工作异常，或者无线性能不好。 |\n| 8        | URXD         |         | AT 串口发送输入                                              | 3.3V                         |                                                              |\n\n![](https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png)\n\n打开flash_download_tool_v3.8.5.exe。选择Developer模式。\n\n选择8266芯片\n\n![](https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png)\n\n然后在之前解压的SDK中找到`C:\\Users……\\ESP8266_NONOS_SDK-3.0.4\\bin\\boot_v1.6.bin`文件刷入地址0x00000中\n\n![](https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png)\n\n然后点击START按钮开始，如果显示`等待上电`，在保证GPIO0接地的情况下，将RST引脚接地再断开。\n\n至此固件等待刷新完毕。\n\n# 4：AT指令\n\n完整的[AT指令PDF](https://www.espressif.com/sites/default/files/documentation/4a-esp8266_at_instruction_set_cn.pdf)\n\n常见的指令：\n\n## 基础命令\n\n- 测试：AT\n- 复位：AT+RST\n- 恢复出厂设置：AT+RESTORE\n- 查询本机IP和MAC：AT+CIFSR\n\n## 模式命令\n\n- 查询模式：AT+CWMODE?\n- 设置模式 1:STA 2:AP 3:both：AT+CWMODE=1\n- （STA）查询当前可用AP ：AT+CWLAP\n- （STA）加入可用AP ：AT+CWJAP=“ssid”,“psw”\n- （STA）退出当前AP ：AT+CWQAP\n- （AP）设置AP参数，ssid+psw+chn+ecn+n+01 ：AT+CWSAP=“哈哈”,“12345678”,3,3,4,0\n- （AP）查询AP参数：AT+CWSAP?\n\n## 客户端|服务器设置\n\n- 查询是否多连接 是1，否0 ：AT+CIPMUX?\n- 设置启动多连接1，单链接0（重启后默认0）：AT+CIPMUX=1\n- （多连接）关闭服务器，就是开启多连接客户端，默认是0 ：AT+CIPSERVER=0\n- （多连接）开启服务器,:开启+端口号port。 此时客户端要连本机，远程地址为 IP+Port ：AT+CIPSERVER=1,8080\n- （多连接）发送数据 id+Byte：AT+CIPSEND=0,10\n- （多连接）关闭TCP/UDP连接，id：AT+CIPCLOSE=0\n- （客户端单连接）建立TCP/UDP连接：AT+CIPSTART=“TCP”,“192.168.4.2”,100\n- （客户端单连接）发送数据，Byte ：AT+CIPSEND=10\n- （客户端单连接）使能穿透模式：AT+CIPMODE=1\n- （客户端单连接）进入透传模式发送：AT+CIPSEND\n- （客户端单连接）退出透传：+++\n- （客户端单连接）关闭TCP/UDP连接：AT+CIPCLOSE\n- （客户端多连接）建立TCP/UDP连接，id，TCP/UDP，IP，端口：AT+CIPSTART=0,“TCP”,“192.168.4.2”,100\n\n## 其他\n\n如果需要用到ESP通过软串口连接Arduino单片机，就需要修改ESP的波特率，ESP默认波特率是115200，而软串口只能是9600，修改波特率AT指令\n\nAT+CIOBAUD=9600\n\n如果返回ERROR，可以尝试\n\nAT+UART=9600,8,1,0,0\n\n# 5：使用Arduino IDE编写程序\n\nESP8266是可以直接使用Arduino IDE上烧录程序的。为了在Arduino IDE上直接编写程序，首先需要导入ESP8266的库。\n\n1. 在IDE的文件->首选项里边的附加开发板管理网址输入https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json\n\n或者http://arduino.esp8266.com/stable/package_esp8266com_index.json\n\n之后点击好。\n\n![](https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png)\n\n2. 在 工具->开发板选择最上方开发板管理器，之后搜索esp即可出现esp8266，选择版本之后进行安装即可。\n\n![](https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png)\n\n3. 在Arduino IDE 菜单>工具>开发板>开发板管理器 中选择你正在使用的8266开发板。\n\n如果你不清楚自己使用的是哪个开发板，可以选择generic esp8266 module，这是通用板子。\n\n4. 选择正确的端口。如果不知道自己板子连接电脑上的是哪个端口，可以打开电脑的`设备管理器`，其中有端口一栏，有详细信息。\n5. 上载程序前，将GPIO0引脚下拉接地，并将RST引脚接地在放开，上载程序时，GPIO0引脚需保持接地状态。上载完毕，将GPIO0引脚放空，并再次将RST引脚接地放开，切换到运行状态。\n\n# 6：Https请求程序\n\n这里以企业微信api发送应用消息为例，简述https请求中的get和post请求。http请求更为简单。网上资料也更多。\n\n要调取企业微信api首先需要仔细阅读其[开发文档](https://work.weixin.qq.com/api/doc/90000/90135/91039)。\n\n```c++\n#include <Arduino.h>\n#include <ESP8266WiFi.h>\n#include <ESP8266HTTPClient.h>\n#include <WiFiClientSecureBearSSL.h>\n#include <ArduinoJson.h>\n\n//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）\n#define ssid \"SSID\"   //WiFi名称 \n#define password \"PASSWORD\"  //WiFi密码\n\n//https://qyapi.weixin.qq.com网站的指纹。\n//esp通过https访问网站，都需要自己通过浏览器获取指纹，获取方法可自行搜索，在参考资料中也有文章，指纹一般几个月就需要更新一次。浏览器打开https://qyapi.weixin.qq.com/cgi-bin/gettoken获取指纹，而不只是只有主机名。\nconst char fingerprint[] PROGMEM = \"790e6e32485bb89503ac6da87d948f5e634322a7\";\n\n//HTTPS端口443\nconst int httpsPort = 443;  \n// 企业微信api相关\nString tokenUrl = \"https://qyapi.weixin.qq.com/cgi-bin/gettoken\";\nString sendMsgUrl = \"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=\";\n//以下信息需要替换，这里的均不可用\nString corpid = \"ww98b3k1b63788a7ad\";//你的企业id\nString corpsecret = \"Kh8asfasfaTrbSwRBGK5H0osnfasakjkmSYCqV3Tgcs\";//你的企业应用密钥\nString agentid = \"1000002\";//你的企业应用id\n\n//获取企业微信access_token\nString get_token(){\n  String token = \"123\";\n  String requestUrl = tokenUrl + \"?corpid=\"+corpid+\"&corpsecret=\"+corpsecret;\n  //https需要创建一个加密路径\n  std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n  client->setFingerprint(fingerprint);\n  //创建一个HTTP客户端\n  HTTPClient https;\n  //http和https的区别就是https.begin中的*client。如果没有*client,那么发送出去的就是http请求\n  //建立连接\n  if (https.begin(*client, requestUrl)) {  // HTTPS\n      Serial.print(\"[HTTPS] GET...\\n\");\n      // 发送get请求\n      int httpCode = https.GET();\n\t  //如果httpCode小于零则连接错误\n      if (httpCode > 0) {\n        Serial.printf(\"[HTTPS] GET... code: %d\\n\", httpCode);\n\n        // file found at server\n        if (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) {\n          //将返回的json序列，放到json变量\n          String json = https.getString();\n          Serial.println(json);\n          // 创建DynamicJsonDocument对象，json中的参数为4个。\n          const size_t capacity = JSON_OBJECT_SIZE(4) + 290;\n          DynamicJsonDocument doc(capacity);\n          //反序列化数据\n          deserializeJson(doc, json);\n          if(doc[\"errcode\"].as<int>()==0){\n              token = doc[\"access_token\"].as<String>();\n          }\n        }\n      } else {\n        Serial.printf(\"[HTTPS] GET... failed, error: %s\\n\", https.errorToString(httpCode).c_str());\n      }\n\n      https.end();\n    } else {\n      Serial.printf(\"[HTTPS] Unable to connect\\n\");\n    }\n\n    return token;\n}\n\n //调用企业微信api，发送信息。\n void send_msg(String msg){\n   //调用get_token函数，获取token\n   String token = get_token();\n   //token=123表示get_token()函数请求token失败。\n   //如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。\n   if (token == \"123\"){\n      Serial.println(\"not get token\");\n     return;\n   }else{\n      Serial.println(\"got token\");\n    }\n   //构造请求url\n   String requestUrl = sendMsgUrl + token;\n   std::unique_ptr<BearSSL::WiFiClientSecure>client(new BearSSL::WiFiClientSecure);\n   client->setFingerprint(fingerprint);\n   HTTPClient httpClient;\n   \n   //与微信服务器建立连接\n   httpClient.begin(*client,requestUrl);\n   //构建json数据，用于发送请求内容\n   String json = \"{\\\"touser\\\":\\\"@all\\\",\\\"msgtype\\\":\\\"text\\\",\\\"agentid\\\":1000002,\\\"text\\\":{\\\"content\\\":\\\"\"+msg+\"\\\"},\\\"safe\\\":0,\\\"enable_id_trans\\\":0,\\\"enable_duplicate_check\\\":0,\\\"duplicate_check_interval\\\":1800}\";\n   //发送请求内容\n   Serial.println(json);\n   //将请求数据放到POST()中。\n   int httpCode = httpClient.POST(json);\n   //这里没有读取服务器返回的json数据，最好还是提取出来，判断是否发送成功。可自行添加代码\n   if (httpCode > 0) {\n     //将服务器响应头打印到串口\n     Serial.println(\"[HTTP] POST... code:\"+ httpCode);\n     //将从服务器获取的数据打印到串口\n     if (httpCode == HTTP_CODE_OK) {\n       Serial.println(\"Send success\");\n       Serial.println(\"return str:\"+httpClient.getString());\n     }\n   } else {\n     Serial.println(\"send failure\");\n   }\n   //关闭ESP8266与服务器连接\n   httpClient.end();\n }\n\n//Wifi init\nvoid wifi_init(){\n  Serial.begin(9600);\n  WiFi.mode(WIFI_STA);        //设置ESP8266为无线终端工作模式\n  \n  WiFi.begin(ssid, password); //连接WiFi\n  Serial.println(\"\");\n \n  Serial.println(\"Connecting\"); Serial.println(\"\");\n  \n  // 等待连接\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(\".\");\n  }\n \n  //成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。\n  Serial.println(\"\");\n  Serial.print(\"Connected to \");\n  Serial.println(ssid);\n  Serial.print(\"IP address: \");\n  Serial.println(WiFi.localIP()); \n}\n\nvoid setup() {\n  wifi_init();\n  send_msg(\"hello world!\");\n}\n\nvoid loop() {\n}\n```\n\n> ArduinoJSON库需要在IDE库管理中搜索安装，\n>\n> 其他库都是随ESP8266库一起安装的。\n\njson格式化和转义：http://www.bejson.com/\n\nArduinoJson Assistant：https://arduinojson.org/v6/assistant/\n\n关于ArduinoJSON详细教程可见参考资料章节\n\n# 7：低功耗方案\n\nESP8266提供三种省电模式。\n\n![](https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png)\n\n当我们的程序在某个时间段不需要使用wifi模块时，可让它进入睡眠模式，\n\nModem-Sleep模式：wifi与路由器保持连接，只在间断的时间里发送一个消息以保持连接。\n\nLight-Sleep模式：在Modem-Sleep的基础上，关闭CPU。在esp循环任务长时间不需要esp工作时，会自动进入此模式。\n\nDeep-Sleep模式：断开wifi。可用户配置。\n\ndeepsleep模式提供定时器唤醒和外部IO唤醒两种方案。\n\n1. 定时器唤醒\n\n将RST引脚接GPIO16。\n\n\n\n![](https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png)\n\n```c++\n/*\n * ESP8266 Deep sleep mode example\n * Rui Santos \n * Complete Project Details https://randomnerdtutorials.com\n */\n \nvoid setup() {\n  Serial.begin(115200);\n  Serial.setTimeout(2000);\n\n  // Wait for serial to initialize.\n  while(!Serial) { }\n  \n  // Deep sleep mode for 30 seconds, the ESP8266 wakes up by itself when GPIO 16 (D0 in NodeMCU board) is connected to the RESET pin\n  Serial.println(\"I'm awake, but I'm going into deep sleep mode for 30 seconds\");\n  ESP.deepSleep(30e6); \n\n}\n\nvoid loop() {\n}\n```\n\nESP-01芯片，GPIO16引脚并没有引出，所以，很难将RST引脚与其相接。\n\n![](https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png)\n\n2. 外部唤醒。\n\n将RST与外部单片机的IO口相接，当外部IO给RST一个低电平时，芯片将重启激活。\n\n例如使用按钮来提供低电平\n\n![](https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png)\n\n![](https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png)\n\n```c++\n/*\n * ESP8266 Deep sleep mode example\n * Rui Santos \n * Complete Project Details https://randomnerdtutorials.com\n */\n \nvoid setup() {\n  Serial.begin(115200);\n  Serial.setTimeout(2000);\n\n  // Wait for serial to initialize.\n  while(!Serial) { }\n    \n  // Deep sleep mode until RESET pin is connected to a LOW signal (for example pushbutton or magnetic reed switch)\n  Serial.println(\"I'm awake, but I'm going into deep sleep mode until RESET pin is connected to a LOW signal\");\n  ESP.deepSleep(0); \n}\n\nvoid loop() {\n}\n```\n\n3. 有的ESP模块上面带有LED灯，采用低功耗方案，务必将LED移除。\n\n# 8：与其他单片机通讯\n\nESP通过串口可与其他单片机传递信息，将ESP的TX引脚连接其他单片机RX引脚，ESP的RX连接其他单片机的TX。\n\n> 注意，ESP8266是3.3V供电，VCC需要接3.3V。如果其他单片机是5V供电，ESP的RX引脚需要分压之后连接其他单片机的TX，否则进入ESP的5V电压会烧坏芯片。ESP的TX则不用分压。\n\n下图为ESP连接Arduino Nano的接线图，途中，ESP RX引脚，通过1K和2K的电阻分压，其实也可以直接在ESP TX引脚和单片机RX引脚之间连接一个550左右的电阻。\n\n![](https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png)\n\n\n\n# 9：参考资料\n\n《[乐鑫ESP8266烧录固件、升级最新固件、刷MQTT固件](http://www.piaoyi.org/iot/espressif-ESP8266-MQTT-AT.html)》\n\n《[ESP8266 WIFI模块常用AT指令汇总](https://blog.csdn.net/weixin_44713763/article/details/104755899)》\n\n《[Arduino安装ESP8266的开发环境](https://blog.csdn.net/qq_34020487/article/details/102766314)》\n\n《[ESP8266 JSON解析](http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/esp8266-json-parse/)》\n\n《[物联网开发实用知识 – 查看网站证书指纹](http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/)》\n\n《[ESP8266 Deep Sleep with Arduino IDE (NodeMCU)](https://randomnerdtutorials.com/esp8266-deep-sleep-with-arduino-ide/)》","slug":"ESP8266从0到1","published":1,"updated":"2020-11-28T11:10:49.694Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cki1lyuf50009ekvzdjurbxyh","content":"<h1 id=\"0：前语\"><a href=\"#0：前语\" class=\"headerlink\" title=\"0：前语\"></a>0：前语</h1><p>推荐<a href=\"http://www.taichi-maker.com/\">太极创客</a>，学习ESP8266模块的更多知识。</p>\n<h1 id=\"1：连线\"><a href=\"#1：连线\" class=\"headerlink\" title=\"1：连线\"></a>1：连线</h1><p>ESP8266通过串口与电脑或者其他单片机实现交互，串口的使用比较简单。以最简单的ESP8266模块为例进行介绍。其他模块可能已经有了usb type-c或者其他接口，就直接用对应接口的线和设备连接就可以了。下图的模块，没有usb接口，因此需要我们自己连线。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>模块共引出了8个引脚，其中，</p>\n<p>VCC：接3.3V电压，为模块供电。</p>\n<p>GUD：接地</p>\n<p>GPIO0：平时直接悬空。需要刷固件的时候接地。</p>\n<p>CH_PD：通过一个10K电阻接3.3V电压，表示模块处于工作状态。否则将不工作。</p>\n<p>串口通信引脚，</p>\n<p>RXD：串口输入，表示这个引脚会接收其他模块传入的信息。与其他模块的TX引脚相连。</p>\n<p>TXD：串口输出，接其他模块的RX引脚，把数据传给其他模块。</p>\n<p>通过FTDI USB to TTL模块，可以将ESP直接和电脑连接。只需要将对应引脚与FTDI模块相连即可。</p>\n<h1 id=\"2：简单开始\"><a href=\"#2：简单开始\" class=\"headerlink\" title=\"2：简单开始\"></a>2：简单开始</h1><p>下图为一个FTDI模块。将其引脚与ESP模块各引脚相连。</p>\n<p>下载FTDI模块的芯片驱动，直接搜索对应芯片就能找到。安装驱动后，将连接好的FTDI模块插入电脑，在电脑设备管理器中，能找到端口一栏，多了这个模块的端口比如(COM6)</p>\n<p><img src=\"https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>随意下载一个串口助手，选择FTDI模块的端口，设置波特率为115200，结束符为NL和CR。其他的默认。</p>\n<p>在串口助手上发送：AT</p>\n<p>串口助手的窗口会返回：OK，或者ERROR。</p>\n<p>如果返回OK，那么就可以通过AT指令操作ESP芯片连接WIFI或者作为AP让别人连wifi了。</p>\n<p>如果返回ERROR，那么就需要更新固件，以让ESP支持AT指令。</p>\n<blockquote>\n<p>未必一定要直接将ESP与电脑连接，也可以和其他单片机连接，通过对其他单片机编程，向ESP发送AT指令。重要的是，理解ESP的工作方式。</p>\n</blockquote>\n<h1 id=\"3：更新固件\"><a href=\"#3：更新固件\" class=\"headerlink\" title=\"3：更新固件\"></a>3：更新固件</h1><p>如果你不小心将ESP配置错了，又不知道怎么去将它出厂设置，或者你发送AT指令总是返回ERROR，那么你就需要学习如何更新芯片固件。</p>\n<p>更新固件需要用到FTDI模块，将FTDI和ESP连接，FTDI连接电脑。</p>\n<p>首先下载<a href=\"https://www.espressif.com/zh-hans/support/download/other-tools\">Flash下载工具</a>。只有Windows系统能用。</p>\n<p>然后下载最新版本的<a href=\"https://www.espressif.com/zh-hans/products/socs/esp8266ex/resources\">ESP8266 NONOS SDK</a>。并解压。</p>\n<p>接线，需要注意，<strong>GPIO0引脚必须接地</strong>。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>序号</strong></td>\n<td><strong>引脚名称</strong></td>\n<td><strong>I/O</strong></td>\n<td><strong>描述</strong></td>\n<td><strong>DC特性</strong></td>\n<td><strong>备注</strong></td>\n</tr>\n<tr>\n<td>1</td>\n<td>UTXD</td>\n<td></td>\n<td>AT 串口发送输出</td>\n<td>3.3V</td>\n<td>开机时禁止下拉</td>\n</tr>\n<tr>\n<td>2</td>\n<td>GND</td>\n<td></td>\n<td>地</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>3</td>\n<td>CH_PD(EN)</td>\n<td></td>\n<td>模块断电信号</td>\n<td>3.3V</td>\n<td>1）高电平工作； 2）低电平模块供电关掉；</td>\n</tr>\n<tr>\n<td>4</td>\n<td>GPIO2</td>\n<td></td>\n<td>预留，默认悬空</td>\n<td>3.3V</td>\n<td>开机上电时必须为高电平，禁止硬件下拉；内部默认已拉高</td>\n</tr>\n<tr>\n<td>5</td>\n<td>GPIO16</td>\n<td>I</td>\n<td>复位信号(RESET)</td>\n<td>3.3V</td>\n<td>低电平复位，高电平工作（默认高）；</td>\n</tr>\n<tr>\n<td>6</td>\n<td>GPIO0</td>\n<td></td>\n<td>模块状态灯/工作模式选择</td>\n<td>3.3V</td>\n<td>1）默认WiFiStatus：WiFi工作状态指示灯控制信号；2）工作模式选择：上拉：FlashBoot，工作模式；下拉：UARTDownload，下载模式（下载固件）；</td>\n</tr>\n<tr>\n<td>7</td>\n<td>VCC</td>\n<td>I</td>\n<td>模块采用单电源供电，通过 1 个VCC 电源引脚供电，电压范围：3.0V-3.6V,电流&gt;600mA</td>\n<td>Vmax=3.6VVmin=3.0VVnorm=3.3V</td>\n<td>电源供电能力请大于600mA;否则可能会引起模块工作异常，或者无线性能不好。</td>\n</tr>\n<tr>\n<td>8</td>\n<td>URXD</td>\n<td></td>\n<td>AT 串口发送输入</td>\n<td>3.3V</td>\n<td></td>\n</tr>\n</tbody></table>\n<p><img src=\"https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>打开flash_download_tool_v3.8.5.exe。选择Developer模式。</p>\n<p>选择8266芯片</p>\n<p><img src=\"https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>然后在之前解压的SDK中找到<code>C:\\Users……\\ESP8266_NONOS_SDK-3.0.4\\bin\\boot_v1.6.bin</code>文件刷入地址0x00000中</p>\n<p><img src=\"https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>然后点击START按钮开始，如果显示<code>等待上电</code>，在保证GPIO0接地的情况下，将RST引脚接地再断开。</p>\n<p>至此固件等待刷新完毕。</p>\n<h1 id=\"4：AT指令\"><a href=\"#4：AT指令\" class=\"headerlink\" title=\"4：AT指令\"></a>4：AT指令</h1><p>完整的<a href=\"https://www.espressif.com/sites/default/files/documentation/4a-esp8266_at_instruction_set_cn.pdf\">AT指令PDF</a></p>\n<p>常见的指令：</p>\n<h2 id=\"基础命令\"><a href=\"#基础命令\" class=\"headerlink\" title=\"基础命令\"></a>基础命令</h2><ul>\n<li>测试：AT</li>\n<li>复位：AT+RST</li>\n<li>恢复出厂设置：AT+RESTORE</li>\n<li>查询本机IP和MAC：AT+CIFSR</li>\n</ul>\n<h2 id=\"模式命令\"><a href=\"#模式命令\" class=\"headerlink\" title=\"模式命令\"></a>模式命令</h2><ul>\n<li>查询模式：AT+CWMODE?</li>\n<li>设置模式 1:STA 2:AP 3:both：AT+CWMODE=1</li>\n<li>（STA）查询当前可用AP ：AT+CWLAP</li>\n<li>（STA）加入可用AP ：AT+CWJAP=“ssid”,“psw”</li>\n<li>（STA）退出当前AP ：AT+CWQAP</li>\n<li>（AP）设置AP参数，ssid+psw+chn+ecn+n+01 ：AT+CWSAP=“哈哈”,“12345678”,3,3,4,0</li>\n<li>（AP）查询AP参数：AT+CWSAP?</li>\n</ul>\n<h2 id=\"客户端-服务器设置\"><a href=\"#客户端-服务器设置\" class=\"headerlink\" title=\"客户端|服务器设置\"></a>客户端|服务器设置</h2><ul>\n<li>查询是否多连接 是1，否0 ：AT+CIPMUX?</li>\n<li>设置启动多连接1，单链接0（重启后默认0）：AT+CIPMUX=1</li>\n<li>（多连接）关闭服务器，就是开启多连接客户端，默认是0 ：AT+CIPSERVER=0</li>\n<li>（多连接）开启服务器,:开启+端口号port。 此时客户端要连本机，远程地址为 IP+Port ：AT+CIPSERVER=1,8080</li>\n<li>（多连接）发送数据 id+Byte：AT+CIPSEND=0,10</li>\n<li>（多连接）关闭TCP/UDP连接，id：AT+CIPCLOSE=0</li>\n<li>（客户端单连接）建立TCP/UDP连接：AT+CIPSTART=“TCP”,“192.168.4.2”,100</li>\n<li>（客户端单连接）发送数据，Byte ：AT+CIPSEND=10</li>\n<li>（客户端单连接）使能穿透模式：AT+CIPMODE=1</li>\n<li>（客户端单连接）进入透传模式发送：AT+CIPSEND</li>\n<li>（客户端单连接）退出透传：+++</li>\n<li>（客户端单连接）关闭TCP/UDP连接：AT+CIPCLOSE</li>\n<li>（客户端多连接）建立TCP/UDP连接，id，TCP/UDP，IP，端口：AT+CIPSTART=0,“TCP”,“192.168.4.2”,100</li>\n</ul>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p>如果需要用到ESP通过软串口连接Arduino单片机，就需要修改ESP的波特率，ESP默认波特率是115200，而软串口只能是9600，修改波特率AT指令</p>\n<p>AT+CIOBAUD=9600</p>\n<p>如果返回ERROR，可以尝试</p>\n<p>AT+UART=9600,8,1,0,0</p>\n<h1 id=\"5：使用Arduino-IDE编写程序\"><a href=\"#5：使用Arduino-IDE编写程序\" class=\"headerlink\" title=\"5：使用Arduino IDE编写程序\"></a>5：使用Arduino IDE编写程序</h1><p>ESP8266是可以直接使用Arduino IDE上烧录程序的。为了在Arduino IDE上直接编写程序，首先需要导入ESP8266的库。</p>\n<ol>\n<li>在IDE的文件-&gt;首选项里边的附加开发板管理网址输入<a href=\"https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json\">https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json</a></li>\n</ol>\n<p>或者<a href=\"http://arduino.esp8266.com/stable/package_esp8266com_index.json\">http://arduino.esp8266.com/stable/package_esp8266com_index.json</a></p>\n<p>之后点击好。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"2\">\n<li>在 工具-&gt;开发板选择最上方开发板管理器，之后搜索esp即可出现esp8266，选择版本之后进行安装即可。</li>\n</ol>\n<p><img src=\"https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"3\">\n<li>在Arduino IDE 菜单&gt;工具&gt;开发板&gt;开发板管理器 中选择你正在使用的8266开发板。</li>\n</ol>\n<p>如果你不清楚自己使用的是哪个开发板，可以选择generic esp8266 module，这是通用板子。</p>\n<ol start=\"4\">\n<li>选择正确的端口。如果不知道自己板子连接电脑上的是哪个端口，可以打开电脑的<code>设备管理器</code>，其中有端口一栏，有详细信息。</li>\n<li>上载程序前，将GPIO0引脚下拉接地，并将RST引脚接地在放开，上载程序时，GPIO0引脚需保持接地状态。上载完毕，将GPIO0引脚放空，并再次将RST引脚接地放开，切换到运行状态。</li>\n</ol>\n<h1 id=\"6：Https请求程序\"><a href=\"#6：Https请求程序\" class=\"headerlink\" title=\"6：Https请求程序\"></a>6：Https请求程序</h1><p>这里以企业微信api发送应用消息为例，简述https请求中的get和post请求。http请求更为简单。网上资料也更多。</p>\n<p>要调取企业微信api首先需要仔细阅读其<a href=\"https://work.weixin.qq.com/api/doc/90000/90135/91039\">开发文档</a>。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;Arduino.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ArduinoJson.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ssid <span class=\"meta-string\">&quot;SSID&quot;</span>   <span class=\"comment\">//WiFi名称 </span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> password <span class=\"meta-string\">&quot;PASSWORD&quot;</span>  <span class=\"comment\">//WiFi密码</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//https://qyapi.weixin.qq.com网站的指纹。</span></span><br><span class=\"line\"><span class=\"comment\">//esp通过https访问网站，都需要自己通过浏览器获取指纹，获取方法可自行搜索，在参考资料中也有文章，指纹一般几个月就需要更新一次。浏览器打开https://qyapi.weixin.qq.com/cgi-bin/gettoken获取指纹，而不只是只有主机名。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span> fingerprint[] PROGMEM = <span class=\"string\">&quot;790e6e32485bb89503ac6da87d948f5e634322a7&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//HTTPS端口443</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> httpsPort = <span class=\"number\">443</span>;  </span><br><span class=\"line\"><span class=\"comment\">// 企业微信api相关</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> tokenUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> sendMsgUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//以下信息需要替换，这里的均不可用</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> corpid = <span class=\"string\">&quot;ww98b3k1b63788a7ad&quot;</span>;<span class=\"comment\">//你的企业id</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> corpsecret = <span class=\"string\">&quot;Kh8asfasfaTrbSwRBGK5H0osnfasakjkmSYCqV3Tgcs&quot;</span>;<span class=\"comment\">//你的企业应用密钥</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> agentid = <span class=\"string\">&quot;1000002&quot;</span>;<span class=\"comment\">//你的企业应用id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取企业微信access_token</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">String</span> <span class=\"title\">get_token</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> token = <span class=\"string\">&quot;123&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> requestUrl = tokenUrl + <span class=\"string\">&quot;?corpid=&quot;</span>+corpid+<span class=\"string\">&quot;&amp;corpsecret=&quot;</span>+corpsecret;</span><br><span class=\"line\">  <span class=\"comment\">//https需要创建一个加密路径</span></span><br><span class=\"line\">  <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">  client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">  <span class=\"comment\">//创建一个HTTP客户端</span></span><br><span class=\"line\">  HTTPClient https;</span><br><span class=\"line\">  <span class=\"comment\">//http和https的区别就是https.begin中的*client。如果没有*client,那么发送出去的就是http请求</span></span><br><span class=\"line\">  <span class=\"comment\">//建立连接</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (https.<span class=\"built_in\">begin</span>(*client, requestUrl)) &#123;  <span class=\"comment\">// HTTPS</span></span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;[HTTPS] GET...\\n&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 发送get请求</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> httpCode = https.GET();</span><br><span class=\"line\">\t  <span class=\"comment\">//如果httpCode小于零则连接错误</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... code: %d\\n&quot;</span>, httpCode);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// file found at server</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//将返回的json序列，放到json变量</span></span><br><span class=\"line\">          <span class=\"keyword\">String</span> json = https.getString();</span><br><span class=\"line\">          <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">          <span class=\"comment\">// 创建DynamicJsonDocument对象，json中的参数为4个。</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> <span class=\"keyword\">size_t</span> capacity = JSON_OBJECT_SIZE(<span class=\"number\">4</span>) + <span class=\"number\">290</span>;</span><br><span class=\"line\">          <span class=\"function\">DynamicJsonDocument <span class=\"title\">doc</span><span class=\"params\">(capacity)</span></span>;</span><br><span class=\"line\">          <span class=\"comment\">//反序列化数据</span></span><br><span class=\"line\">          deserializeJson(doc, json);</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(doc[<span class=\"string\">&quot;errcode&quot;</span>].as&lt;<span class=\"keyword\">int</span>&gt;()==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">              token = doc[<span class=\"string\">&quot;access_token&quot;</span>].as&lt;<span class=\"keyword\">String</span>&gt;();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... failed, error: %s\\n&quot;</span>, https.errorToString(httpCode).c_str());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      https.<span class=\"built_in\">end</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] Unable to connect\\n&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//调用企业微信api，发送信息。</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">send_msg</span><span class=\"params\">(<span class=\"keyword\">String</span> msg)</span></span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">//调用get_token函数，获取token</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> token = get_token();</span><br><span class=\"line\">   <span class=\"comment\">//token=123表示get_token()函数请求token失败。</span></span><br><span class=\"line\">   <span class=\"comment\">//如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (token == <span class=\"string\">&quot;123&quot;</span>)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;not get token&quot;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span>;</span><br><span class=\"line\">   &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;got token&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   <span class=\"comment\">//构造请求url</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> requestUrl = sendMsgUrl + token;</span><br><span class=\"line\">   <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">   client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">   HTTPClient httpClient;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">//与微信服务器建立连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">begin</span>(*client,requestUrl);</span><br><span class=\"line\">   <span class=\"comment\">//构建json数据，用于发送请求内容</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> json = <span class=\"string\">&quot;&#123;\\&quot;touser\\&quot;:\\&quot;@all\\&quot;,\\&quot;msgtype\\&quot;:\\&quot;text\\&quot;,\\&quot;agentid\\&quot;:1000002,\\&quot;text\\&quot;:&#123;\\&quot;content\\&quot;:\\&quot;&quot;</span>+msg+<span class=\"string\">&quot;\\&quot;&#125;,\\&quot;safe\\&quot;:0,\\&quot;enable_id_trans\\&quot;:0,\\&quot;enable_duplicate_check\\&quot;:0,\\&quot;duplicate_check_interval\\&quot;:1800&#125;&quot;</span>;</span><br><span class=\"line\">   <span class=\"comment\">//发送请求内容</span></span><br><span class=\"line\">   <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">   <span class=\"comment\">//将请求数据放到POST()中。</span></span><br><span class=\"line\">   <span class=\"keyword\">int</span> httpCode = httpClient.POST(json);</span><br><span class=\"line\">   <span class=\"comment\">//这里没有读取服务器返回的json数据，最好还是提取出来，判断是否发送成功。可自行添加代码</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">     <span class=\"comment\">//将服务器响应头打印到串口</span></span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;[HTTP] POST... code:&quot;</span>+ httpCode);</span><br><span class=\"line\">     <span class=\"comment\">//将从服务器获取的数据打印到串口</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Send success&quot;</span>);</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;return str:&quot;</span>+httpClient.getString());</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;send failure&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"comment\">//关闭ESP8266与服务器连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">end</span>();</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Wifi init</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">wifi_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.mode(WIFI_STA);        <span class=\"comment\">//设置ESP8266为无线终端工作模式</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.<span class=\"built_in\">begin</span>(ssid, password); <span class=\"comment\">//连接WiFi</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Connecting&quot;</span>); <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 等待连接</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"built_in\">WiFi</span>.status() != WL_CONNECTED) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"comment\">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;Connected to &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(ssid);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;IP address: &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"built_in\">WiFi</span>.<span class=\"built_in\">localIP</span>()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  wifi_init();</span><br><span class=\"line\">  send_msg(<span class=\"string\">&quot;hello world!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ArduinoJSON库需要在IDE库管理中搜索安装，</p>\n<p>其他库都是随ESP8266库一起安装的。</p>\n</blockquote>\n<p>json格式化和转义：<a href=\"http://www.bejson.com/\">http://www.bejson.com/</a></p>\n<p>ArduinoJson Assistant：<a href=\"https://arduinojson.org/v6/assistant/\">https://arduinojson.org/v6/assistant/</a></p>\n<p>关于ArduinoJSON详细教程可见参考资料章节</p>\n<h1 id=\"7：低功耗方案\"><a href=\"#7：低功耗方案\" class=\"headerlink\" title=\"7：低功耗方案\"></a>7：低功耗方案</h1><p>ESP8266提供三种省电模式。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p>当我们的程序在某个时间段不需要使用wifi模块时，可让它进入睡眠模式，</p>\n<p>Modem-Sleep模式：wifi与路由器保持连接，只在间断的时间里发送一个消息以保持连接。</p>\n<p>Light-Sleep模式：在Modem-Sleep的基础上，关闭CPU。在esp循环任务长时间不需要esp工作时，会自动进入此模式。</p>\n<p>Deep-Sleep模式：断开wifi。可用户配置。</p>\n<p>deepsleep模式提供定时器唤醒和外部IO唤醒两种方案。</p>\n<ol>\n<li>定时器唤醒</li>\n</ol>\n<p>将RST引脚接GPIO16。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * ESP8266 Deep sleep mode example</span></span><br><span class=\"line\"><span class=\"comment\"> * Rui Santos </span></span><br><span class=\"line\"><span class=\"comment\"> * Complete Project Details https://randomnerdtutorials.com</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">115200</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"number\">2000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Wait for serial to initialize.</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(!<span class=\"built_in\">Serial</span>) &#123; &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Deep sleep mode for 30 seconds, the ESP8266 wakes up by itself when GPIO 16 (D0 in NodeMCU board) is connected to the RESET pin</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;I&#x27;m awake, but I&#x27;m going into deep sleep mode for 30 seconds&quot;</span>);</span><br><span class=\"line\">  ESP.deepSleep(<span class=\"number\">30e6</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ESP-01芯片，GPIO16引脚并没有引出，所以，很难将RST引脚与其相接。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<ol start=\"2\">\n<li>外部唤醒。</li>\n</ol>\n<p>将RST与外部单片机的IO口相接，当外部IO给RST一个低电平时，芯片将重启激活。</p>\n<p>例如使用按钮来提供低电平</p>\n<p><img src=\"https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<p><img src=\"https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * ESP8266 Deep sleep mode example</span></span><br><span class=\"line\"><span class=\"comment\"> * Rui Santos </span></span><br><span class=\"line\"><span class=\"comment\"> * Complete Project Details https://randomnerdtutorials.com</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">115200</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"number\">2000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Wait for serial to initialize.</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(!<span class=\"built_in\">Serial</span>) &#123; &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"comment\">// Deep sleep mode until RESET pin is connected to a LOW signal (for example pushbutton or magnetic reed switch)</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;I&#x27;m awake, but I&#x27;m going into deep sleep mode until RESET pin is connected to a LOW signal&quot;</span>);</span><br><span class=\"line\">  ESP.deepSleep(<span class=\"number\">0</span>); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>有的ESP模块上面带有LED灯，采用低功耗方案，务必将LED移除。</li>\n</ol>\n<h1 id=\"8：与其他单片机通讯\"><a href=\"#8：与其他单片机通讯\" class=\"headerlink\" title=\"8：与其他单片机通讯\"></a>8：与其他单片机通讯</h1><p>ESP通过串口可与其他单片机传递信息，将ESP的TX引脚连接其他单片机RX引脚，ESP的RX连接其他单片机的TX。</p>\n<blockquote>\n<p>注意，ESP8266是3.3V供电，VCC需要接3.3V。如果其他单片机是5V供电，ESP的RX引脚需要分压之后连接其他单片机的TX，否则进入ESP的5V电压会烧坏芯片。ESP的TX则不用分压。</p>\n</blockquote>\n<p>下图为ESP连接Arduino Nano的接线图，途中，ESP RX引脚，通过1K和2K的电阻分压，其实也可以直接在ESP TX引脚和单片机RX引脚之间连接一个550左右的电阻。</p>\n<p><img src=\"https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png\" class=\"lazyload\" data-srcset=\"https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p>\n<h1 id=\"9：参考资料\"><a href=\"#9：参考资料\" class=\"headerlink\" title=\"9：参考资料\"></a>9：参考资料</h1><p>《<a href=\"http://www.piaoyi.org/iot/espressif-ESP8266-MQTT-AT.html\">乐鑫ESP8266烧录固件、升级最新固件、刷MQTT固件</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/weixin_44713763/article/details/104755899\">ESP8266 WIFI模块常用AT指令汇总</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/qq_34020487/article/details/102766314\">Arduino安装ESP8266的开发环境</a>》</p>\n<p>《<a href=\"http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/esp8266-json-parse/\">ESP8266 JSON解析</a>》</p>\n<p>《<a href=\"http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/\">物联网开发实用知识 – 查看网站证书指纹</a>》</p>\n<p>《<a href=\"https://randomnerdtutorials.com/esp8266-deep-sleep-with-arduino-ide/\">ESP8266 Deep Sleep with Arduino IDE (NodeMCU)</a>》</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"0：前语\"><a href=\"#0：前语\" class=\"headerlink\" title=\"0：前语\"></a>0：前语</h1><p>推荐<a href=\"http://www.taichi-maker.com/\">太极创客</a>，学习ESP8266模块的更多知识。</p>\n<h1 id=\"1：连线\"><a href=\"#1：连线\" class=\"headerlink\" title=\"1：连线\"></a>1：连线</h1><p>ESP8266通过串口与电脑或者其他单片机实现交互，串口的使用比较简单。以最简单的ESP8266模块为例进行介绍。其他模块可能已经有了usb type-c或者其他接口，就直接用对应接口的线和设备连接就可以了。下图的模块，没有usb接口，因此需要我们自己连线。</p>\n<p><img src=\"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png\"></p>\n<p>模块共引出了8个引脚，其中，</p>\n<p>VCC：接3.3V电压，为模块供电。</p>\n<p>GUD：接地</p>\n<p>GPIO0：平时直接悬空。需要刷固件的时候接地。</p>\n<p>CH_PD：通过一个10K电阻接3.3V电压，表示模块处于工作状态。否则将不工作。</p>\n<p>串口通信引脚，</p>\n<p>RXD：串口输入，表示这个引脚会接收其他模块传入的信息。与其他模块的TX引脚相连。</p>\n<p>TXD：串口输出，接其他模块的RX引脚，把数据传给其他模块。</p>\n<p>通过FTDI USB to TTL模块，可以将ESP直接和电脑连接。只需要将对应引脚与FTDI模块相连即可。</p>\n<h1 id=\"2：简单开始\"><a href=\"#2：简单开始\" class=\"headerlink\" title=\"2：简单开始\"></a>2：简单开始</h1><p>下图为一个FTDI模块。将其引脚与ESP模块各引脚相连。</p>\n<p>下载FTDI模块的芯片驱动，直接搜索对应芯片就能找到。安装驱动后，将连接好的FTDI模块插入电脑，在电脑设备管理器中，能找到端口一栏，多了这个模块的端口比如(COM6)</p>\n<p><img src=\"https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg\"></p>\n<p>随意下载一个串口助手，选择FTDI模块的端口，设置波特率为115200，结束符为NL和CR。其他的默认。</p>\n<p>在串口助手上发送：AT</p>\n<p>串口助手的窗口会返回：OK，或者ERROR。</p>\n<p>如果返回OK，那么就可以通过AT指令操作ESP芯片连接WIFI或者作为AP让别人连wifi了。</p>\n<p>如果返回ERROR，那么就需要更新固件，以让ESP支持AT指令。</p>\n<blockquote>\n<p>未必一定要直接将ESP与电脑连接，也可以和其他单片机连接，通过对其他单片机编程，向ESP发送AT指令。重要的是，理解ESP的工作方式。</p>\n</blockquote>\n<h1 id=\"3：更新固件\"><a href=\"#3：更新固件\" class=\"headerlink\" title=\"3：更新固件\"></a>3：更新固件</h1><p>如果你不小心将ESP配置错了，又不知道怎么去将它出厂设置，或者你发送AT指令总是返回ERROR，那么你就需要学习如何更新芯片固件。</p>\n<p>更新固件需要用到FTDI模块，将FTDI和ESP连接，FTDI连接电脑。</p>\n<p>首先下载<a href=\"https://www.espressif.com/zh-hans/support/download/other-tools\">Flash下载工具</a>。只有Windows系统能用。</p>\n<p>然后下载最新版本的<a href=\"https://www.espressif.com/zh-hans/products/socs/esp8266ex/resources\">ESP8266 NONOS SDK</a>。并解压。</p>\n<p>接线，需要注意，<strong>GPIO0引脚必须接地</strong>。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>序号</strong></td>\n<td><strong>引脚名称</strong></td>\n<td><strong>I/O</strong></td>\n<td><strong>描述</strong></td>\n<td><strong>DC特性</strong></td>\n<td><strong>备注</strong></td>\n</tr>\n<tr>\n<td>1</td>\n<td>UTXD</td>\n<td></td>\n<td>AT 串口发送输出</td>\n<td>3.3V</td>\n<td>开机时禁止下拉</td>\n</tr>\n<tr>\n<td>2</td>\n<td>GND</td>\n<td></td>\n<td>地</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>3</td>\n<td>CH_PD(EN)</td>\n<td></td>\n<td>模块断电信号</td>\n<td>3.3V</td>\n<td>1）高电平工作； 2）低电平模块供电关掉；</td>\n</tr>\n<tr>\n<td>4</td>\n<td>GPIO2</td>\n<td></td>\n<td>预留，默认悬空</td>\n<td>3.3V</td>\n<td>开机上电时必须为高电平，禁止硬件下拉；内部默认已拉高</td>\n</tr>\n<tr>\n<td>5</td>\n<td>GPIO16</td>\n<td>I</td>\n<td>复位信号(RESET)</td>\n<td>3.3V</td>\n<td>低电平复位，高电平工作（默认高）；</td>\n</tr>\n<tr>\n<td>6</td>\n<td>GPIO0</td>\n<td></td>\n<td>模块状态灯/工作模式选择</td>\n<td>3.3V</td>\n<td>1）默认WiFiStatus：WiFi工作状态指示灯控制信号；2）工作模式选择：上拉：FlashBoot，工作模式；下拉：UARTDownload，下载模式（下载固件）；</td>\n</tr>\n<tr>\n<td>7</td>\n<td>VCC</td>\n<td>I</td>\n<td>模块采用单电源供电，通过 1 个VCC 电源引脚供电，电压范围：3.0V-3.6V,电流&gt;600mA</td>\n<td>Vmax=3.6VVmin=3.0VVnorm=3.3V</td>\n<td>电源供电能力请大于600mA;否则可能会引起模块工作异常，或者无线性能不好。</td>\n</tr>\n<tr>\n<td>8</td>\n<td>URXD</td>\n<td></td>\n<td>AT 串口发送输入</td>\n<td>3.3V</td>\n<td></td>\n</tr>\n</tbody></table>\n<p><img src=\"https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png\"></p>\n<p>打开flash_download_tool_v3.8.5.exe。选择Developer模式。</p>\n<p>选择8266芯片</p>\n<p><img src=\"https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png\"></p>\n<p>然后在之前解压的SDK中找到<code>C:\\Users……\\ESP8266_NONOS_SDK-3.0.4\\bin\\boot_v1.6.bin</code>文件刷入地址0x00000中</p>\n<p><img src=\"https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png\"></p>\n<p>然后点击START按钮开始，如果显示<code>等待上电</code>，在保证GPIO0接地的情况下，将RST引脚接地再断开。</p>\n<p>至此固件等待刷新完毕。</p>\n<h1 id=\"4：AT指令\"><a href=\"#4：AT指令\" class=\"headerlink\" title=\"4：AT指令\"></a>4：AT指令</h1><p>完整的<a href=\"https://www.espressif.com/sites/default/files/documentation/4a-esp8266_at_instruction_set_cn.pdf\">AT指令PDF</a></p>\n<p>常见的指令：</p>\n<h2 id=\"基础命令\"><a href=\"#基础命令\" class=\"headerlink\" title=\"基础命令\"></a>基础命令</h2><ul>\n<li>测试：AT</li>\n<li>复位：AT+RST</li>\n<li>恢复出厂设置：AT+RESTORE</li>\n<li>查询本机IP和MAC：AT+CIFSR</li>\n</ul>\n<h2 id=\"模式命令\"><a href=\"#模式命令\" class=\"headerlink\" title=\"模式命令\"></a>模式命令</h2><ul>\n<li>查询模式：AT+CWMODE?</li>\n<li>设置模式 1:STA 2:AP 3:both：AT+CWMODE=1</li>\n<li>（STA）查询当前可用AP ：AT+CWLAP</li>\n<li>（STA）加入可用AP ：AT+CWJAP=“ssid”,“psw”</li>\n<li>（STA）退出当前AP ：AT+CWQAP</li>\n<li>（AP）设置AP参数，ssid+psw+chn+ecn+n+01 ：AT+CWSAP=“哈哈”,“12345678”,3,3,4,0</li>\n<li>（AP）查询AP参数：AT+CWSAP?</li>\n</ul>\n<h2 id=\"客户端-服务器设置\"><a href=\"#客户端-服务器设置\" class=\"headerlink\" title=\"客户端|服务器设置\"></a>客户端|服务器设置</h2><ul>\n<li>查询是否多连接 是1，否0 ：AT+CIPMUX?</li>\n<li>设置启动多连接1，单链接0（重启后默认0）：AT+CIPMUX=1</li>\n<li>（多连接）关闭服务器，就是开启多连接客户端，默认是0 ：AT+CIPSERVER=0</li>\n<li>（多连接）开启服务器,:开启+端口号port。 此时客户端要连本机，远程地址为 IP+Port ：AT+CIPSERVER=1,8080</li>\n<li>（多连接）发送数据 id+Byte：AT+CIPSEND=0,10</li>\n<li>（多连接）关闭TCP/UDP连接，id：AT+CIPCLOSE=0</li>\n<li>（客户端单连接）建立TCP/UDP连接：AT+CIPSTART=“TCP”,“192.168.4.2”,100</li>\n<li>（客户端单连接）发送数据，Byte ：AT+CIPSEND=10</li>\n<li>（客户端单连接）使能穿透模式：AT+CIPMODE=1</li>\n<li>（客户端单连接）进入透传模式发送：AT+CIPSEND</li>\n<li>（客户端单连接）退出透传：+++</li>\n<li>（客户端单连接）关闭TCP/UDP连接：AT+CIPCLOSE</li>\n<li>（客户端多连接）建立TCP/UDP连接，id，TCP/UDP，IP，端口：AT+CIPSTART=0,“TCP”,“192.168.4.2”,100</li>\n</ul>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p>如果需要用到ESP通过软串口连接Arduino单片机，就需要修改ESP的波特率，ESP默认波特率是115200，而软串口只能是9600，修改波特率AT指令</p>\n<p>AT+CIOBAUD=9600</p>\n<p>如果返回ERROR，可以尝试</p>\n<p>AT+UART=9600,8,1,0,0</p>\n<h1 id=\"5：使用Arduino-IDE编写程序\"><a href=\"#5：使用Arduino-IDE编写程序\" class=\"headerlink\" title=\"5：使用Arduino IDE编写程序\"></a>5：使用Arduino IDE编写程序</h1><p>ESP8266是可以直接使用Arduino IDE上烧录程序的。为了在Arduino IDE上直接编写程序，首先需要导入ESP8266的库。</p>\n<ol>\n<li>在IDE的文件-&gt;首选项里边的附加开发板管理网址输入<a href=\"https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json\">https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json</a></li>\n</ol>\n<p>或者<a href=\"http://arduino.esp8266.com/stable/package_esp8266com_index.json\">http://arduino.esp8266.com/stable/package_esp8266com_index.json</a></p>\n<p>之后点击好。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png\"></p>\n<ol start=\"2\">\n<li>在 工具-&gt;开发板选择最上方开发板管理器，之后搜索esp即可出现esp8266，选择版本之后进行安装即可。</li>\n</ol>\n<p><img src=\"https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png\"></p>\n<ol start=\"3\">\n<li>在Arduino IDE 菜单&gt;工具&gt;开发板&gt;开发板管理器 中选择你正在使用的8266开发板。</li>\n</ol>\n<p>如果你不清楚自己使用的是哪个开发板，可以选择generic esp8266 module，这是通用板子。</p>\n<ol start=\"4\">\n<li>选择正确的端口。如果不知道自己板子连接电脑上的是哪个端口，可以打开电脑的<code>设备管理器</code>，其中有端口一栏，有详细信息。</li>\n<li>上载程序前，将GPIO0引脚下拉接地，并将RST引脚接地在放开，上载程序时，GPIO0引脚需保持接地状态。上载完毕，将GPIO0引脚放空，并再次将RST引脚接地放开，切换到运行状态。</li>\n</ol>\n<h1 id=\"6：Https请求程序\"><a href=\"#6：Https请求程序\" class=\"headerlink\" title=\"6：Https请求程序\"></a>6：Https请求程序</h1><p>这里以企业微信api发送应用消息为例，简述https请求中的get和post请求。http请求更为简单。网上资料也更多。</p>\n<p>要调取企业微信api首先需要仔细阅读其<a href=\"https://work.weixin.qq.com/api/doc/90000/90135/91039\">开发文档</a>。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;Arduino.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ArduinoJson.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> ssid <span class=\"meta-string\">&quot;SSID&quot;</span>   <span class=\"comment\">//WiFi名称 </span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> password <span class=\"meta-string\">&quot;PASSWORD&quot;</span>  <span class=\"comment\">//WiFi密码</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//https://qyapi.weixin.qq.com网站的指纹。</span></span><br><span class=\"line\"><span class=\"comment\">//esp通过https访问网站，都需要自己通过浏览器获取指纹，获取方法可自行搜索，在参考资料中也有文章，指纹一般几个月就需要更新一次。浏览器打开https://qyapi.weixin.qq.com/cgi-bin/gettoken获取指纹，而不只是只有主机名。</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span> fingerprint[] PROGMEM = <span class=\"string\">&quot;790e6e32485bb89503ac6da87d948f5e634322a7&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//HTTPS端口443</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> httpsPort = <span class=\"number\">443</span>;  </span><br><span class=\"line\"><span class=\"comment\">// 企业微信api相关</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> tokenUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">String</span> sendMsgUrl = <span class=\"string\">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//以下信息需要替换，这里的均不可用</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> corpid = <span class=\"string\">&quot;ww98b3k1b63788a7ad&quot;</span>;<span class=\"comment\">//你的企业id</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> corpsecret = <span class=\"string\">&quot;Kh8asfasfaTrbSwRBGK5H0osnfasakjkmSYCqV3Tgcs&quot;</span>;<span class=\"comment\">//你的企业应用密钥</span></span><br><span class=\"line\"><span class=\"keyword\">String</span> agentid = <span class=\"string\">&quot;1000002&quot;</span>;<span class=\"comment\">//你的企业应用id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取企业微信access_token</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">String</span> <span class=\"title\">get_token</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> token = <span class=\"string\">&quot;123&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">String</span> requestUrl = tokenUrl + <span class=\"string\">&quot;?corpid=&quot;</span>+corpid+<span class=\"string\">&quot;&amp;corpsecret=&quot;</span>+corpsecret;</span><br><span class=\"line\">  <span class=\"comment\">//https需要创建一个加密路径</span></span><br><span class=\"line\">  <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">  client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">  <span class=\"comment\">//创建一个HTTP客户端</span></span><br><span class=\"line\">  HTTPClient https;</span><br><span class=\"line\">  <span class=\"comment\">//http和https的区别就是https.begin中的*client。如果没有*client,那么发送出去的就是http请求</span></span><br><span class=\"line\">  <span class=\"comment\">//建立连接</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (https.<span class=\"built_in\">begin</span>(*client, requestUrl)) &#123;  <span class=\"comment\">// HTTPS</span></span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;[HTTPS] GET...\\n&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 发送get请求</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> httpCode = https.GET();</span><br><span class=\"line\">\t  <span class=\"comment\">//如果httpCode小于零则连接错误</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... code: %d\\n&quot;</span>, httpCode);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// file found at server</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//将返回的json序列，放到json变量</span></span><br><span class=\"line\">          <span class=\"keyword\">String</span> json = https.getString();</span><br><span class=\"line\">          <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">          <span class=\"comment\">// 创建DynamicJsonDocument对象，json中的参数为4个。</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> <span class=\"keyword\">size_t</span> capacity = JSON_OBJECT_SIZE(<span class=\"number\">4</span>) + <span class=\"number\">290</span>;</span><br><span class=\"line\">          <span class=\"function\">DynamicJsonDocument <span class=\"title\">doc</span><span class=\"params\">(capacity)</span></span>;</span><br><span class=\"line\">          <span class=\"comment\">//反序列化数据</span></span><br><span class=\"line\">          deserializeJson(doc, json);</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(doc[<span class=\"string\">&quot;errcode&quot;</span>].as&lt;<span class=\"keyword\">int</span>&gt;()==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">              token = doc[<span class=\"string\">&quot;access_token&quot;</span>].as&lt;<span class=\"keyword\">String</span>&gt;();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] GET... failed, error: %s\\n&quot;</span>, https.errorToString(httpCode).c_str());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      https.<span class=\"built_in\">end</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;[HTTPS] Unable to connect\\n&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//调用企业微信api，发送信息。</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">send_msg</span><span class=\"params\">(<span class=\"keyword\">String</span> msg)</span></span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">//调用get_token函数，获取token</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> token = get_token();</span><br><span class=\"line\">   <span class=\"comment\">//token=123表示get_token()函数请求token失败。</span></span><br><span class=\"line\">   <span class=\"comment\">//如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (token == <span class=\"string\">&quot;123&quot;</span>)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;not get token&quot;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span>;</span><br><span class=\"line\">   &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;got token&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   <span class=\"comment\">//构造请求url</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> requestUrl = sendMsgUrl + token;</span><br><span class=\"line\">   <span class=\"built_in\">std</span>::<span class=\"built_in\">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class=\"keyword\">new</span> BearSSL::WiFiClientSecure);</span><br><span class=\"line\">   client-&gt;setFingerprint(fingerprint);</span><br><span class=\"line\">   HTTPClient httpClient;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">//与微信服务器建立连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">begin</span>(*client,requestUrl);</span><br><span class=\"line\">   <span class=\"comment\">//构建json数据，用于发送请求内容</span></span><br><span class=\"line\">   <span class=\"keyword\">String</span> json = <span class=\"string\">&quot;&#123;\\&quot;touser\\&quot;:\\&quot;@all\\&quot;,\\&quot;msgtype\\&quot;:\\&quot;text\\&quot;,\\&quot;agentid\\&quot;:1000002,\\&quot;text\\&quot;:&#123;\\&quot;content\\&quot;:\\&quot;&quot;</span>+msg+<span class=\"string\">&quot;\\&quot;&#125;,\\&quot;safe\\&quot;:0,\\&quot;enable_id_trans\\&quot;:0,\\&quot;enable_duplicate_check\\&quot;:0,\\&quot;duplicate_check_interval\\&quot;:1800&#125;&quot;</span>;</span><br><span class=\"line\">   <span class=\"comment\">//发送请求内容</span></span><br><span class=\"line\">   <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(json);</span><br><span class=\"line\">   <span class=\"comment\">//将请求数据放到POST()中。</span></span><br><span class=\"line\">   <span class=\"keyword\">int</span> httpCode = httpClient.POST(json);</span><br><span class=\"line\">   <span class=\"comment\">//这里没有读取服务器返回的json数据，最好还是提取出来，判断是否发送成功。可自行添加代码</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (httpCode &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">     <span class=\"comment\">//将服务器响应头打印到串口</span></span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;[HTTP] POST... code:&quot;</span>+ httpCode);</span><br><span class=\"line\">     <span class=\"comment\">//将从服务器获取的数据打印到串口</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Send success&quot;</span>);</span><br><span class=\"line\">       <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;return str:&quot;</span>+httpClient.getString());</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;send failure&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"comment\">//关闭ESP8266与服务器连接</span></span><br><span class=\"line\">   httpClient.<span class=\"built_in\">end</span>();</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Wifi init</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">wifi_init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.mode(WIFI_STA);        <span class=\"comment\">//设置ESP8266为无线终端工作模式</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">WiFi</span>.<span class=\"built_in\">begin</span>(ssid, password); <span class=\"comment\">//连接WiFi</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;Connecting&quot;</span>); <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 等待连接</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"built_in\">WiFi</span>.status() != WL_CONNECTED) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">delay</span>(<span class=\"number\">500</span>);</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"comment\">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;Connected to &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(ssid);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">print</span>(<span class=\"string\">&quot;IP address: &quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"built_in\">WiFi</span>.<span class=\"built_in\">localIP</span>()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  wifi_init();</span><br><span class=\"line\">  send_msg(<span class=\"string\">&quot;hello world!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ArduinoJSON库需要在IDE库管理中搜索安装，</p>\n<p>其他库都是随ESP8266库一起安装的。</p>\n</blockquote>\n<p>json格式化和转义：<a href=\"http://www.bejson.com/\">http://www.bejson.com/</a></p>\n<p>ArduinoJson Assistant：<a href=\"https://arduinojson.org/v6/assistant/\">https://arduinojson.org/v6/assistant/</a></p>\n<p>关于ArduinoJSON详细教程可见参考资料章节</p>\n<h1 id=\"7：低功耗方案\"><a href=\"#7：低功耗方案\" class=\"headerlink\" title=\"7：低功耗方案\"></a>7：低功耗方案</h1><p>ESP8266提供三种省电模式。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png\"></p>\n<p>当我们的程序在某个时间段不需要使用wifi模块时，可让它进入睡眠模式，</p>\n<p>Modem-Sleep模式：wifi与路由器保持连接，只在间断的时间里发送一个消息以保持连接。</p>\n<p>Light-Sleep模式：在Modem-Sleep的基础上，关闭CPU。在esp循环任务长时间不需要esp工作时，会自动进入此模式。</p>\n<p>Deep-Sleep模式：断开wifi。可用户配置。</p>\n<p>deepsleep模式提供定时器唤醒和外部IO唤醒两种方案。</p>\n<ol>\n<li>定时器唤醒</li>\n</ol>\n<p>将RST引脚接GPIO16。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * ESP8266 Deep sleep mode example</span></span><br><span class=\"line\"><span class=\"comment\"> * Rui Santos </span></span><br><span class=\"line\"><span class=\"comment\"> * Complete Project Details https://randomnerdtutorials.com</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">115200</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"number\">2000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Wait for serial to initialize.</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(!<span class=\"built_in\">Serial</span>) &#123; &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Deep sleep mode for 30 seconds, the ESP8266 wakes up by itself when GPIO 16 (D0 in NodeMCU board) is connected to the RESET pin</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;I&#x27;m awake, but I&#x27;m going into deep sleep mode for 30 seconds&quot;</span>);</span><br><span class=\"line\">  ESP.deepSleep(<span class=\"number\">30e6</span>); </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ESP-01芯片，GPIO16引脚并没有引出，所以，很难将RST引脚与其相接。</p>\n<p><img src=\"https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png\"></p>\n<ol start=\"2\">\n<li>外部唤醒。</li>\n</ol>\n<p>将RST与外部单片机的IO口相接，当外部IO给RST一个低电平时，芯片将重启激活。</p>\n<p>例如使用按钮来提供低电平</p>\n<p><img src=\"https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png\"></p>\n<p><img src=\"https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * ESP8266 Deep sleep mode example</span></span><br><span class=\"line\"><span class=\"comment\"> * Rui Santos </span></span><br><span class=\"line\"><span class=\"comment\"> * Complete Project Details https://randomnerdtutorials.com</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">115200</span>);</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"number\">2000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Wait for serial to initialize.</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(!<span class=\"built_in\">Serial</span>) &#123; &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"comment\">// Deep sleep mode until RESET pin is connected to a LOW signal (for example pushbutton or magnetic reed switch)</span></span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;I&#x27;m awake, but I&#x27;m going into deep sleep mode until RESET pin is connected to a LOW signal&quot;</span>);</span><br><span class=\"line\">  ESP.deepSleep(<span class=\"number\">0</span>); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>有的ESP模块上面带有LED灯，采用低功耗方案，务必将LED移除。</li>\n</ol>\n<h1 id=\"8：与其他单片机通讯\"><a href=\"#8：与其他单片机通讯\" class=\"headerlink\" title=\"8：与其他单片机通讯\"></a>8：与其他单片机通讯</h1><p>ESP通过串口可与其他单片机传递信息，将ESP的TX引脚连接其他单片机RX引脚，ESP的RX连接其他单片机的TX。</p>\n<blockquote>\n<p>注意，ESP8266是3.3V供电，VCC需要接3.3V。如果其他单片机是5V供电，ESP的RX引脚需要分压之后连接其他单片机的TX，否则进入ESP的5V电压会烧坏芯片。ESP的TX则不用分压。</p>\n</blockquote>\n<p>下图为ESP连接Arduino Nano的接线图，途中，ESP RX引脚，通过1K和2K的电阻分压，其实也可以直接在ESP TX引脚和单片机RX引脚之间连接一个550左右的电阻。</p>\n<p><img src=\"https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png\"></p>\n<h1 id=\"9：参考资料\"><a href=\"#9：参考资料\" class=\"headerlink\" title=\"9：参考资料\"></a>9：参考资料</h1><p>《<a href=\"http://www.piaoyi.org/iot/espressif-ESP8266-MQTT-AT.html\">乐鑫ESP8266烧录固件、升级最新固件、刷MQTT固件</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/weixin_44713763/article/details/104755899\">ESP8266 WIFI模块常用AT指令汇总</a>》</p>\n<p>《<a href=\"https://blog.csdn.net/qq_34020487/article/details/102766314\">Arduino安装ESP8266的开发环境</a>》</p>\n<p>《<a href=\"http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/esp8266-json-parse/\">ESP8266 JSON解析</a>》</p>\n<p>《<a href=\"http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/\">物联网开发实用知识 – 查看网站证书指纹</a>》</p>\n<p>《<a href=\"https://randomnerdtutorials.com/esp8266-deep-sleep-with-arduino-ide/\">ESP8266 Deep Sleep with Arduino IDE (NodeMCU)</a>》</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png","popularPost_tmp_gaData":{"updated":"Sat Nov 28 2020 12:10:49 GMT+0100 (GMT+01:00)","title":"ESP8266从0到1","path":"2020/11/26/ESP8266从0到1/","eyeCatchImage":"https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png","excerpt":null,"date":{"_isAMomentObject":true,"_i":"2020-11-26T19:49:52.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-11-26T19:49:52.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"嵌入式","tags":["ESP8266"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"爬取Youtube搜索结果","top":false,"cover":false,"toc":true,"mathjax":false,"date":"2021-02-06T13:46:38.000Z","password":null,"summary":null,"_content":"\n# 1：绪\n\n最近在做一个音乐下载软件，通过搜索音乐名称，下载youtube上信息匹配度最高的视频，提取其中的音频，来获取音乐。开源软件youtube-dl已经完成了视频下载和音频提取的全部工作，我要做的就是，获取目标视频的id或者视频链接，然后调用youtube-dl下载。\n\n# 2：接口\n\n谷歌官方其实已经提供了获取YouTube搜索结果的api，直接调用即可。\n\n```python\n#调用谷歌api获取youtube搜索结果，返回匹配度最高的视频链接\ndef get_video_url_in_youtube_form_api(appKey,music_name):\n    print(\"从google api获取数据\")\n    url = \"https://youtube.googleapis.com/youtube/v3/search?q=\"+music_name+\"&key=\"+appKey\n    resp = requests.get(url)\n    resp_json = resp.json()\n    if resp.status_code ==200:\n        return \"https://www.youtube.com/watch?v=\"+resp_json['items'][0]['id']['videoId']\n    else:\n        return 500\n```\n\n但是，谷歌api是有调用上限的，也就是10000个单位，每次搜索将消耗100个单位。那么我们总共可以通过api获取搜索结果的次数就是100个。这对于个人来说，实际上已经足够了，但是，如果要向他人提供服务，就不够了。\n\n那么就只能上手爬虫了。\n\n# 3：爬取搜索结果\n\n```python\n#利用爬虫获取youtube搜索结果\ndef get_video_url_in_youtube_from_crawler(keyword):\n    url=\"https://m.youtube.com/results?search_query=\"+keyword\n    print(\"通过爬虫获取数据\")\n    resp = requests.get(url)\n    if resp.status_code==200:\n        result_json = re.findall(r'ytInitialData = (.*);</script>', resp.text)[0]\n        result_obj = json.loads(result_json)\n        try:\n            video_url = \"https://www.youtube.com/watch?v=\"+result_obj['contents']['twoColumnSearchResultsRenderer']['primaryContents']['sectionListRenderer']['contents'][0]['itemSectionRenderer']['contents'][0]['videoRenderer']['videoId']\n        except KeyError:\n            return 500\n        return video_url\n    else:\n        return 500\n\n```\n\n通过url和搜索值，构造搜索链接。获取返回的html代码。对html格式化后，可以发现，有一串包含搜索结果的json数据，藏在一个js代码中间，通过正则，将它提取出来。\n\n谷歌是有反爬虫的机制的，就是说，如果频繁通过上述程序请求数据，获取到的json不一定能获得想要的内容。这里需要使用Exception来避免报错，假如爬取失败，应当再调用api。如果有代理隧道，那么爬虫就更好了。","source":"_posts/爬取Youtube搜索结果.md","raw":"---\ntitle: 爬取Youtube搜索结果\ntop: false\ncover: false\ntoc: true\nmathjax: false\ndate: 2021-02-06 14:46:38\npassword:\nsummary:\ntags: \n - 爬虫\n - Python\ncategories: 爬虫\n---\n\n# 1：绪\n\n最近在做一个音乐下载软件，通过搜索音乐名称，下载youtube上信息匹配度最高的视频，提取其中的音频，来获取音乐。开源软件youtube-dl已经完成了视频下载和音频提取的全部工作，我要做的就是，获取目标视频的id或者视频链接，然后调用youtube-dl下载。\n\n# 2：接口\n\n谷歌官方其实已经提供了获取YouTube搜索结果的api，直接调用即可。\n\n```python\n#调用谷歌api获取youtube搜索结果，返回匹配度最高的视频链接\ndef get_video_url_in_youtube_form_api(appKey,music_name):\n    print(\"从google api获取数据\")\n    url = \"https://youtube.googleapis.com/youtube/v3/search?q=\"+music_name+\"&key=\"+appKey\n    resp = requests.get(url)\n    resp_json = resp.json()\n    if resp.status_code ==200:\n        return \"https://www.youtube.com/watch?v=\"+resp_json['items'][0]['id']['videoId']\n    else:\n        return 500\n```\n\n但是，谷歌api是有调用上限的，也就是10000个单位，每次搜索将消耗100个单位。那么我们总共可以通过api获取搜索结果的次数就是100个。这对于个人来说，实际上已经足够了，但是，如果要向他人提供服务，就不够了。\n\n那么就只能上手爬虫了。\n\n# 3：爬取搜索结果\n\n```python\n#利用爬虫获取youtube搜索结果\ndef get_video_url_in_youtube_from_crawler(keyword):\n    url=\"https://m.youtube.com/results?search_query=\"+keyword\n    print(\"通过爬虫获取数据\")\n    resp = requests.get(url)\n    if resp.status_code==200:\n        result_json = re.findall(r'ytInitialData = (.*);</script>', resp.text)[0]\n        result_obj = json.loads(result_json)\n        try:\n            video_url = \"https://www.youtube.com/watch?v=\"+result_obj['contents']['twoColumnSearchResultsRenderer']['primaryContents']['sectionListRenderer']['contents'][0]['itemSectionRenderer']['contents'][0]['videoRenderer']['videoId']\n        except KeyError:\n            return 500\n        return video_url\n    else:\n        return 500\n\n```\n\n通过url和搜索值，构造搜索链接。获取返回的html代码。对html格式化后，可以发现，有一串包含搜索结果的json数据，藏在一个js代码中间，通过正则，将它提取出来。\n\n谷歌是有反爬虫的机制的，就是说，如果频繁通过上述程序请求数据，获取到的json不一定能获得想要的内容。这里需要使用Exception来避免报错，假如爬取失败，应当再调用api。如果有代理隧道，那么爬虫就更好了。","slug":"爬取Youtube搜索结果","published":1,"updated":"2021-02-06T14:00:26.565Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckktscdl90000coo1fe0t1axy","content":"<h1 id=\"1：绪\"><a href=\"#1：绪\" class=\"headerlink\" title=\"1：绪\"></a>1：绪</h1><p>最近在做一个音乐下载软件，通过搜索音乐名称，下载youtube上信息匹配度最高的视频，提取其中的音频，来获取音乐。开源软件youtube-dl已经完成了视频下载和音频提取的全部工作，我要做的就是，获取目标视频的id或者视频链接，然后调用youtube-dl下载。</p>\n<h1 id=\"2：接口\"><a href=\"#2：接口\" class=\"headerlink\" title=\"2：接口\"></a>2：接口</h1><p>谷歌官方其实已经提供了获取YouTube搜索结果的api，直接调用即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#调用谷歌api获取youtube搜索结果，返回匹配度最高的视频链接</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_video_url_in_youtube_form_api</span>(<span class=\"params\">appKey,music_name</span>):</span></span><br><span class=\"line\">    print(<span class=\"string\">&quot;从google api获取数据&quot;</span>)</span><br><span class=\"line\">    url = <span class=\"string\">&quot;https://youtube.googleapis.com/youtube/v3/search?q=&quot;</span>+music_name+<span class=\"string\">&quot;&amp;key=&quot;</span>+appKey</span><br><span class=\"line\">    resp = requests.get(url)</span><br><span class=\"line\">    resp_json = resp.json()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> resp.status_code ==<span class=\"number\">200</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;https://www.youtube.com/watch?v=&quot;</span>+resp_json[<span class=\"string\">&#x27;items&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;id&#x27;</span>][<span class=\"string\">&#x27;videoId&#x27;</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">500</span></span><br></pre></td></tr></table></figure>\n\n<p>但是，谷歌api是有调用上限的，也就是10000个单位，每次搜索将消耗100个单位。那么我们总共可以通过api获取搜索结果的次数就是100个。这对于个人来说，实际上已经足够了，但是，如果要向他人提供服务，就不够了。</p>\n<p>那么就只能上手爬虫了。</p>\n<h1 id=\"3：爬取搜索结果\"><a href=\"#3：爬取搜索结果\" class=\"headerlink\" title=\"3：爬取搜索结果\"></a>3：爬取搜索结果</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#利用爬虫获取youtube搜索结果</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_video_url_in_youtube_from_crawler</span>(<span class=\"params\">keyword</span>):</span></span><br><span class=\"line\">    url=<span class=\"string\">&quot;https://m.youtube.com/results?search_query=&quot;</span>+keyword</span><br><span class=\"line\">    print(<span class=\"string\">&quot;通过爬虫获取数据&quot;</span>)</span><br><span class=\"line\">    resp = requests.get(url)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> resp.status_code==<span class=\"number\">200</span>:</span><br><span class=\"line\">        result_json = re.findall(<span class=\"string\">r&#x27;ytInitialData = (.*);&lt;/script&gt;&#x27;</span>, resp.text)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        result_obj = json.loads(result_json)</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            video_url = <span class=\"string\">&quot;https://www.youtube.com/watch?v=&quot;</span>+result_obj[<span class=\"string\">&#x27;contents&#x27;</span>][<span class=\"string\">&#x27;twoColumnSearchResultsRenderer&#x27;</span>][<span class=\"string\">&#x27;primaryContents&#x27;</span>][<span class=\"string\">&#x27;sectionListRenderer&#x27;</span>][<span class=\"string\">&#x27;contents&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;itemSectionRenderer&#x27;</span>][<span class=\"string\">&#x27;contents&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;videoRenderer&#x27;</span>][<span class=\"string\">&#x27;videoId&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">except</span> KeyError:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">500</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> video_url</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">500</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>通过url和搜索值，构造搜索链接。获取返回的html代码。对html格式化后，可以发现，有一串包含搜索结果的json数据，藏在一个js代码中间，通过正则，将它提取出来。</p>\n<p>谷歌是有反爬虫的机制的，就是说，如果频繁通过上述程序请求数据，获取到的json不一定能获得想要的内容。这里需要使用Exception来避免报错，假如爬取失败，应当再调用api。如果有代理隧道，那么爬虫就更好了。</p>\n","site":{"data":{"friends":[{"name":"啓飞个人网","url":"https://xieqifei.com","title":"访问主页","introduction":"软件推送，技术交流","avatar":"/medias/avatars/profile.jpg"},{"name":"godweiyang","url":"https://godweiyang.com","title":"访问主页","introduction":"ECNU NLPer","avatar":"https://godweiyang.com/medias/avatars/avatar.jpg"}],"musics":[{"name":"世间美好与你环环相扣","artist":"柏松","url":"/medias/music/shijianmeihaoyunihuanhuanxiangkou.mp3","cover":"/medias/music/avatars/shijianmeihaoyunihuanhuanxiangkou.jpg"},{"name":"像鱼","artist":"王二妮","url":"/medias/music/xiangyu.mp3","cover":"/medias/music/avatars/xiangyu.jpg"},{"name":"天亮以前说再见","artist":"何野","url":"/medias/music/tianliangyiqianshuozaijian.mp3","cover":"/medias/music/avatars/tianliangyiqianshuozaijian.jpg"},{"name":"我还想她","artist":"林俊杰","url":"/medias/music/wohaixiangta.mp3","cover":"/medias/music/avatars/wohaixiangta.jpg"}]}},"excerpt":"","more":"<h1 id=\"1：绪\"><a href=\"#1：绪\" class=\"headerlink\" title=\"1：绪\"></a>1：绪</h1><p>最近在做一个音乐下载软件，通过搜索音乐名称，下载youtube上信息匹配度最高的视频，提取其中的音频，来获取音乐。开源软件youtube-dl已经完成了视频下载和音频提取的全部工作，我要做的就是，获取目标视频的id或者视频链接，然后调用youtube-dl下载。</p>\n<h1 id=\"2：接口\"><a href=\"#2：接口\" class=\"headerlink\" title=\"2：接口\"></a>2：接口</h1><p>谷歌官方其实已经提供了获取YouTube搜索结果的api，直接调用即可。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#调用谷歌api获取youtube搜索结果，返回匹配度最高的视频链接</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_video_url_in_youtube_form_api</span>(<span class=\"params\">appKey,music_name</span>):</span></span><br><span class=\"line\">    print(<span class=\"string\">&quot;从google api获取数据&quot;</span>)</span><br><span class=\"line\">    url = <span class=\"string\">&quot;https://youtube.googleapis.com/youtube/v3/search?q=&quot;</span>+music_name+<span class=\"string\">&quot;&amp;key=&quot;</span>+appKey</span><br><span class=\"line\">    resp = requests.get(url)</span><br><span class=\"line\">    resp_json = resp.json()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> resp.status_code ==<span class=\"number\">200</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;https://www.youtube.com/watch?v=&quot;</span>+resp_json[<span class=\"string\">&#x27;items&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;id&#x27;</span>][<span class=\"string\">&#x27;videoId&#x27;</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">500</span></span><br></pre></td></tr></table></figure>\n\n<p>但是，谷歌api是有调用上限的，也就是10000个单位，每次搜索将消耗100个单位。那么我们总共可以通过api获取搜索结果的次数就是100个。这对于个人来说，实际上已经足够了，但是，如果要向他人提供服务，就不够了。</p>\n<p>那么就只能上手爬虫了。</p>\n<h1 id=\"3：爬取搜索结果\"><a href=\"#3：爬取搜索结果\" class=\"headerlink\" title=\"3：爬取搜索结果\"></a>3：爬取搜索结果</h1><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#利用爬虫获取youtube搜索结果</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_video_url_in_youtube_from_crawler</span>(<span class=\"params\">keyword</span>):</span></span><br><span class=\"line\">    url=<span class=\"string\">&quot;https://m.youtube.com/results?search_query=&quot;</span>+keyword</span><br><span class=\"line\">    print(<span class=\"string\">&quot;通过爬虫获取数据&quot;</span>)</span><br><span class=\"line\">    resp = requests.get(url)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> resp.status_code==<span class=\"number\">200</span>:</span><br><span class=\"line\">        result_json = re.findall(<span class=\"string\">r&#x27;ytInitialData = (.*);&lt;/script&gt;&#x27;</span>, resp.text)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        result_obj = json.loads(result_json)</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            video_url = <span class=\"string\">&quot;https://www.youtube.com/watch?v=&quot;</span>+result_obj[<span class=\"string\">&#x27;contents&#x27;</span>][<span class=\"string\">&#x27;twoColumnSearchResultsRenderer&#x27;</span>][<span class=\"string\">&#x27;primaryContents&#x27;</span>][<span class=\"string\">&#x27;sectionListRenderer&#x27;</span>][<span class=\"string\">&#x27;contents&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;itemSectionRenderer&#x27;</span>][<span class=\"string\">&#x27;contents&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;videoRenderer&#x27;</span>][<span class=\"string\">&#x27;videoId&#x27;</span>]</span><br><span class=\"line\">        <span class=\"keyword\">except</span> KeyError:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">500</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> video_url</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">500</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>通过url和搜索值，构造搜索链接。获取返回的html代码。对html格式化后，可以发现，有一串包含搜索结果的json数据，藏在一个js代码中间，通过正则，将它提取出来。</p>\n<p>谷歌是有反爬虫的机制的，就是说，如果频繁通过上述程序请求数据，获取到的json不一定能获得想要的内容。这里需要使用Exception来避免报错，假如爬取失败，应当再调用api。如果有代理隧道，那么爬虫就更好了。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Feb 06 2021 15:00:26 GMT+0100 (GMT+01:00)","title":"爬取Youtube搜索结果","path":"2021/02/06/爬取Youtube搜索结果/","eyeCatchImage":null,"excerpt":null,"date":{"_isAMomentObject":true,"_i":"2021-02-06T13:46:38.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2021-02-06T13:46:38.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"爬虫","tags":["Python","爬虫"],"internalLinks":[],"keywords":[],"keywordsLength":0}}],"PostAsset":[],"PostCategory":[{"post_id":"ckgaxsaac0001p0vzdznr4syg","category_id":"ckgaxsaai0004p0vzh38gbgkd","_id":"ckgaxsaaw000jp0vzhsxsfqqr"},{"post_id":"ckgaxsaag0003p0vzfzsu0ksi","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsab0000pp0vzc6rg5gpc"},{"post_id":"ckgaxsaav000ip0vzd8v28eo1","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsab3000tp0vz7zpndka3"},{"post_id":"ckgaxsaax000mp0vz515h06v8","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsab4000wp0vzfqa0681t"},{"post_id":"ckgaxsaam0007p0vz4lag53ov","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsab60010p0vz2buu0phx"},{"post_id":"ckgaxsaaz000op0vz6vpnag4o","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsab70013p0vzf6zc2cyg"},{"post_id":"ckgaxsab2000sp0vz7ltp7v7s","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsab90017p0vz4x16h201"},{"post_id":"ckgaxsaao0009p0vz7glj3ixx","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsabb001ap0vzamah29ca"},{"post_id":"ckgaxsab3000vp0vz7ak33wcc","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsabe001dp0vz9ia81bku"},{"post_id":"ckgaxsaaq000bp0vzceytfjmp","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsabh001hp0vzd6nqaej1"},{"post_id":"ckgaxsaat000gp0vz7wmk0lfo","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsabk001kp0vz4bb3h7s1"},{"post_id":"ckgaxsabd001cp0vzb02d6v7u","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsabm001np0vzh50d05ll"},{"post_id":"ckgaxsab5000zp0vz15et60f2","category_id":"ckgaxsabb001bp0vz02r5es0b","_id":"ckgaxsabo001qp0vz4ivhcdob"},{"post_id":"ckgaxsabj001jp0vzgdytcwtc","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsabs001tp0vzarpp9xxz"},{"post_id":"ckgaxsabl001mp0vzgr4yfi61","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsabu001xp0vze81m0gpb"},{"post_id":"ckgaxsab60012p0vz31u4daz9","category_id":"ckgaxsabi001ip0vz7l9hbu44","_id":"ckgaxsabx0021p0vz6jzpcobf"},{"post_id":"ckgaxsabp001sp0vz6oub185t","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsac10025p0vz3u5w867v"},{"post_id":"ckgaxsabw0020p0vz3vp9683x","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsac4002ap0vz5j1qc5ta"},{"post_id":"ckgaxsaby0023p0vzh3pd3fxu","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsac8002hp0vz86aq9lzi"},{"post_id":"ckgaxsac20026p0vz3fwwgec9","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsac9002lp0vzhdaj0kyj"},{"post_id":"ckgaxsabf001fp0vz6lzc6l3h","category_id":"ckgaxsac10024p0vzb4qs1u41","_id":"ckgaxsacb002op0vz05vj8iwg"},{"post_id":"ckgaxsac5002cp0vz0uv7ewe0","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsacd002rp0vzeblbg4b1"},{"post_id":"ckgaxsabm001op0vzgw5c8g6y","category_id":"ckgaxsac10024p0vzb4qs1u41","_id":"ckgaxsacg002up0vzcsvibiz1"},{"post_id":"ckgaxsac7002fp0vzc40x3v7d","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsach002xp0vzfgfs9j77"},{"post_id":"ckgaxsac8002jp0vz457y1fsv","category_id":"ckgaxsabb001bp0vz02r5es0b","_id":"ckgaxsacj0031p0vz2ui852c1"},{"post_id":"ckgaxsabs001vp0vzb1dy9tql","category_id":"ckgaxsac10024p0vzb4qs1u41","_id":"ckgaxsacl0034p0vz3cff0ar2"},{"post_id":"ckgaxsaca002np0vzgjz92uvl","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsacm0036p0vz2ul72m8w"},{"post_id":"ckgaxsacc002qp0vz8jyrcspx","category_id":"ckgaxsaai0004p0vzh38gbgkd","_id":"ckgaxsacp0039p0vzad2vb15m"},{"post_id":"ckgaxsac30029p0vzf9dj4g4h","category_id":"ckgaxsacb002pp0vzd89ph2g9","_id":"ckgaxsacq003cp0vz6svq1mh3"},{"post_id":"ckgaxsace002tp0vzhn7sad3w","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsacs003fp0vz3pd187hj"},{"post_id":"ckgaxsacg002wp0vz05gx1piy","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsacv003ip0vz22hr2zs0"},{"post_id":"ckgaxsaci002zp0vzcx0324fc","category_id":"ckgaxsaai0004p0vzh38gbgkd","_id":"ckgaxsacx003lp0vzbq651uqq"},{"post_id":"ckgaxsack0033p0vz94aygvs3","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsacy003op0vzggng25qj"},{"post_id":"ckgaxsaco0038p0vz56ih9qga","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsad0003sp0vzcc5vgqz3"},{"post_id":"ckgaxsacr003ep0vzgpe18oy0","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsad1003vp0vz2wdkdxko"},{"post_id":"ckgaxsacl0035p0vz08vng2dk","category_id":"ckgaxsacp003ap0vzc4zfa5lx","_id":"ckgaxsad3003zp0vz2gzj4ew4"},{"post_id":"ckgaxsacs003gp0vz4822f2a9","category_id":"ckgaxsac10024p0vzb4qs1u41","_id":"ckgaxsad40040p0vz4hid9s8l"},{"post_id":"ckgaxsacw003kp0vz1a0j8e54","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsad40041p0vz1ji6gejc"},{"post_id":"ckgaxsacp003bp0vz167wczno","category_id":"ckgaxsacp003ap0vzc4zfa5lx","_id":"ckgaxsad50044p0vzb8gsfkia"},{"post_id":"ckgaxsacx003np0vzbo0wa35c","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsad50046p0vz3rdbczfz"},{"post_id":"ckgaxsacz003rp0vzfbqeak3b","category_id":"ckgaxsaar000cp0vzer11e5s7","_id":"ckgaxsad60048p0vz8wvt6x77"},{"post_id":"ckgaxsad0003up0vz7nmyczxi","category_id":"ckgaxsacb002pp0vzd89ph2g9","_id":"ckgaxsad60049p0vzfk7x8yh6"},{"post_id":"ckgaxsad2003xp0vz67epbfod","category_id":"ckgaxsacb002pp0vzd89ph2g9","_id":"ckgaxsad6004bp0vz3vf0bop0"},{"post_id":"ckgaxsaes006fp0vz56q8g95k","category_id":"ckgaxsabb001bp0vz02r5es0b","_id":"ckgaxsaev006lp0vz3llof78h"},{"post_id":"ckgaxsaet006gp0vzfnuudtj9","category_id":"ckgaxsac10024p0vzb4qs1u41","_id":"ckgaxsaew006np0vz0z3lcx5o"},{"post_id":"ckgaxsaet006ip0vz7bxp5u1v","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsaex006rp0vzgoo39l0t"},{"post_id":"ckgaxsaev006mp0vz89be0wsl","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsaey006vp0vzhkzo8xfd"},{"post_id":"ckgaxsaew006pp0vz6wf12gtd","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckgaxsaey006yp0vza4zh57hc"},{"post_id":"ckgfr41lu0000lkvzdp8tcapz","category_id":"ckgaxsabb001bp0vz02r5es0b","_id":"ckgfr41mh0002lkvz6v31d9oc"},{"post_id":"ckgfr41mu0004lkvz6g6v5jc2","category_id":"ckgcu81wb0001tsvz2fdm3p25","_id":"ckgfr41n70008lkvz2hir69we"},{"post_id":"ckgfr41n40005lkvzenhpgluj","category_id":"ckgcu81wb0001tsvz2fdm3p25","_id":"ckgfr41n7000alkvzdhosavl2"},{"post_id":"ckgo0pgyt000064vz4gtt7x3s","category_id":"ckgaxsaai0004p0vzh38gbgkd","_id":"ckgo0pgzq000264vz8omwgvgf"},{"post_id":"ckhi87lwq0000jgvzdit3h8gw","category_id":"ckgaxsaaw000kp0vzg82c4j3a","_id":"ckhi87lxh0002jgvzhrd71xya"},{"post_id":"ckgaxsab80015p0vzalaq5bcz","category_id":"ckgaxsacb002pp0vzd89ph2g9","_id":"ckhj2wb3700019kvzd8prf1s7"},{"post_id":"ckgaxsab90019p0vz6kcrbn3x","category_id":"ckgaxsacb002pp0vzd89ph2g9","_id":"ckhj2wb3y00049kvz16lg1e4h"},{"post_id":"ckhj2wb3600009kvz0jsg7xy0","category_id":"ckhj2wb3800029kvz57ki0due","_id":"ckhj2wb4000079kvzdhst8c5u"},{"post_id":"ckgaxsaeu006kp0vz89hg23gy","category_id":"ckgaxsacb002pp0vzd89ph2g9","_id":"ckhj2wb5i00089kvz7ntw93ce"},{"post_id":"cki1lyue90000ekvzaflh6z0c","category_id":"cki1lyuec0001ekvz2vigbozr","_id":"cki1lyuey0004ekvz77l85pvf"},{"post_id":"cki1lyuf50009ekvzdjurbxyh","category_id":"cki1lyuec0001ekvz2vigbozr","_id":"cki1lyuf7000bekvz6pvz8n88"},{"post_id":"ckktscdl90000coo1fe0t1axy","category_id":"ckgcu81wb0001tsvz2fdm3p25","_id":"ckktscdmo0003coo1eoa244gi"}],"PostTag":[{"post_id":"ckgaxsaac0001p0vzdznr4syg","tag_id":"ckgaxsaak0005p0vzgvxu582y","_id":"ckgaxsaas000ep0vzde9fgbo7"},{"post_id":"ckgaxsaag0003p0vzfzsu0ksi","tag_id":"ckgaxsaar000dp0vzbnba8dsy","_id":"ckgaxsaay000np0vz63hqee7t"},{"post_id":"ckgaxsaam0007p0vz4lag53ov","tag_id":"ckgaxsaax000lp0vzei2q3le4","_id":"ckgaxsab3000up0vzes8p3p1j"},{"post_id":"ckgaxsaao0009p0vz7glj3ixx","tag_id":"ckgaxsab0000rp0vzfb294w4q","_id":"ckgaxsab60011p0vz4st4h8an"},{"post_id":"ckgaxsaaq000bp0vzceytfjmp","tag_id":"ckgaxsab5000yp0vzc86ggirl","_id":"ckgaxsab90018p0vzeigsbpsz"},{"post_id":"ckgaxsaat000gp0vz7wmk0lfo","tag_id":"ckgaxsab80016p0vz3ue28k0r","_id":"ckgaxsabh001gp0vzgbyn6ho1"},{"post_id":"ckgaxsaav000ip0vzd8v28eo1","tag_id":"ckgaxsabe001ep0vz189c4vpq","_id":"ckgaxsabs001up0vz34k5csdv"},{"post_id":"ckgaxsaav000ip0vzd8v28eo1","tag_id":"ckgaxsabk001lp0vz3iehc1jf","_id":"ckgaxsabv001yp0vz9aa02e1e"},{"post_id":"ckgaxsaax000mp0vz515h06v8","tag_id":"ckgaxsabk001lp0vz3iehc1jf","_id":"ckgaxsabx0022p0vz2pae8nnq"},{"post_id":"ckgaxsaaz000op0vz6vpnag4o","tag_id":"ckgaxsabv001zp0vz4cf01k6e","_id":"ckgaxsac7002gp0vz5obcf99t"},{"post_id":"ckgaxsaaz000op0vz6vpnag4o","tag_id":"ckgaxsac20027p0vz0vgc9wtv","_id":"ckgaxsac9002kp0vz8med4kl5"},{"post_id":"ckgaxsab2000sp0vz7ltp7v7s","tag_id":"ckgaxsac6002ep0vz24w31osi","_id":"ckgaxsacg002vp0vzfza79kvm"},{"post_id":"ckgaxsab2000sp0vz7ltp7v7s","tag_id":"ckgaxsaca002mp0vz7i466q7v","_id":"ckgaxsaci002yp0vzfba3flhx"},{"post_id":"ckgaxsab3000vp0vz7ak33wcc","tag_id":"ckgaxsace002sp0vzffr1bs4d","_id":"ckgaxsacj0032p0vz9ih79mbq"},{"post_id":"ckgaxsab5000zp0vz15et60f2","tag_id":"ckgaxsacj0030p0vzdj8d0fme","_id":"ckgaxsacx003mp0vz7i9hez7w"},{"post_id":"ckgaxsab5000zp0vz15et60f2","tag_id":"ckgaxsacm0037p0vzbqw54jpo","_id":"ckgaxsacy003pp0vzg0dg2fmw"},{"post_id":"ckgaxsab5000zp0vz15et60f2","tag_id":"ckgaxsac6002ep0vz24w31osi","_id":"ckgaxsad0003tp0vzgyipakj8"},{"post_id":"ckgaxsab60012p0vz31u4daz9","tag_id":"ckgaxsacv003jp0vz2lu9g8ef","_id":"ckgaxsad1003wp0vz3li8asw1"},{"post_id":"ckgaxsab80015p0vzalaq5bcz","tag_id":"ckgaxsacy003qp0vz6zczgcqf","_id":"ckgaxsad50043p0vz3ofm7vcw"},{"post_id":"ckgaxsab80015p0vzalaq5bcz","tag_id":"ckgaxsad2003yp0vzbg974no0","_id":"ckgaxsad50045p0vz0bcx05qf"},{"post_id":"ckgaxsab90019p0vz6kcrbn3x","tag_id":"ckgaxsacy003qp0vz6zczgcqf","_id":"ckgaxsad7004dp0vzdd141qm3"},{"post_id":"ckgaxsab90019p0vz6kcrbn3x","tag_id":"ckgaxsad50047p0vzdpz1cznk","_id":"ckgaxsad7004ep0vz7d517sxb"},{"post_id":"ckgaxsab90019p0vz6kcrbn3x","tag_id":"ckgaxsad6004ap0vzfotmb3oh","_id":"ckgaxsad7004gp0vz28wgcy52"},{"post_id":"ckgaxsabd001cp0vzb02d6v7u","tag_id":"ckgaxsad6004cp0vzfoi18nya","_id":"ckgaxsad7004hp0vz442cf4fv"},{"post_id":"ckgaxsabf001fp0vz6lzc6l3h","tag_id":"ckgaxsad7004fp0vzabgu12si","_id":"ckgaxsad8004kp0vz6sm41idu"},{"post_id":"ckgaxsabf001fp0vz6lzc6l3h","tag_id":"ckgaxsad7004ip0vz3upb4b6g","_id":"ckgaxsad8004lp0vz83zmd3oe"},{"post_id":"ckgaxsabj001jp0vzgdytcwtc","tag_id":"ckgaxsad8004jp0vzh77taoy4","_id":"ckgaxsad8004np0vz5jkfhf0h"},{"post_id":"ckgaxsabl001mp0vzgr4yfi61","tag_id":"ckgaxsad8004mp0vz5gfqck6h","_id":"ckgaxsad9004pp0vzb12i4r6h"},{"post_id":"ckgaxsabm001op0vzgw5c8g6y","tag_id":"ckgaxsad9004op0vz45xo9vgg","_id":"ckgaxsada004rp0vz84o821in"},{"post_id":"ckgaxsabp001sp0vz6oub185t","tag_id":"ckgaxsad9004qp0vz8k1o4rp6","_id":"ckgaxsada004tp0vz259w34qb"},{"post_id":"ckgaxsabs001vp0vzb1dy9tql","tag_id":"ckgaxsada004sp0vz1v012nga","_id":"ckgaxsadb004vp0vz0wfd0nrr"},{"post_id":"ckgaxsabw0020p0vz3vp9683x","tag_id":"ckgaxsadb004up0vzhliq2pok","_id":"ckgaxsadb004xp0vz8qkwdsxf"},{"post_id":"ckgaxsaby0023p0vzh3pd3fxu","tag_id":"ckgaxsadb004wp0vzd1536p03","_id":"ckgaxsadc004zp0vz60o2cat6"},{"post_id":"ckgaxsac20026p0vz3fwwgec9","tag_id":"ckgaxsadb004yp0vzfvkiedll","_id":"ckgaxsadc0051p0vz3m1e3af0"},{"post_id":"ckgaxsac30029p0vzf9dj4g4h","tag_id":"ckgaxsab80016p0vz3ue28k0r","_id":"ckgaxsadd0053p0vzepmyb6cu"},{"post_id":"ckgaxsac30029p0vzf9dj4g4h","tag_id":"ckgaxsadc0050p0vze8rf9o8p","_id":"ckgaxsadd0054p0vzfb37hnoq"},{"post_id":"ckgaxsac5002cp0vz0uv7ewe0","tag_id":"ckgaxsadc0052p0vz6gwx2ndb","_id":"ckgaxsadd0056p0vz3yyy86of"},{"post_id":"ckgaxsac7002fp0vzc40x3v7d","tag_id":"ckgaxsab80016p0vz3ue28k0r","_id":"ckgaxsade0059p0vz18sn2j2c"},{"post_id":"ckgaxsac7002fp0vzc40x3v7d","tag_id":"ckgaxsadc0050p0vze8rf9o8p","_id":"ckgaxsade005ap0vz06mphdyq"},{"post_id":"ckgaxsac7002fp0vzc40x3v7d","tag_id":"ckgaxsace002sp0vzffr1bs4d","_id":"ckgaxsadf005cp0vzerolf33y"},{"post_id":"ckgaxsac8002jp0vz457y1fsv","tag_id":"ckgaxsade0058p0vz4g3kexk3","_id":"ckgaxsadf005dp0vzhf7z9ryp"},{"post_id":"ckgaxsaca002np0vzgjz92uvl","tag_id":"ckgaxsade005bp0vzb27sdta3","_id":"ckgaxsadf005fp0vz83b06iyk"},{"post_id":"ckgaxsacc002qp0vz8jyrcspx","tag_id":"ckgaxsadf005ep0vzh5eg8bnw","_id":"ckgaxsadg005hp0vz0gx0a6uh"},{"post_id":"ckgaxsace002tp0vzhn7sad3w","tag_id":"ckgaxsadf005gp0vzfgrl1gk3","_id":"ckgaxsadg005jp0vzhfvaah8f"},{"post_id":"ckgaxsacg002wp0vz05gx1piy","tag_id":"ckgaxsadg005ip0vzecq24cer","_id":"ckgaxsadg005lp0vz5l93ed8e"},{"post_id":"ckgaxsaci002zp0vzcx0324fc","tag_id":"ckgaxsadg005kp0vz3z7ibxq1","_id":"ckgaxsadh005np0vz3e9gguz1"},{"post_id":"ckgaxsack0033p0vz94aygvs3","tag_id":"ckgaxsadh005mp0vz5s529n23","_id":"ckgaxsadh005pp0vz84xrc356"},{"post_id":"ckgaxsacl0035p0vz08vng2dk","tag_id":"ckgaxsadc0050p0vze8rf9o8p","_id":"ckgaxsadi005rp0vzc6xm04u8"},{"post_id":"ckgaxsacl0035p0vz08vng2dk","tag_id":"ckgaxsab80016p0vz3ue28k0r","_id":"ckgaxsadi005sp0vzad4eb07z"},{"post_id":"ckgaxsaco0038p0vz56ih9qga","tag_id":"ckgaxsadi005qp0vz7jotcg4o","_id":"ckgaxsadi005up0vz0cnk1bld"},{"post_id":"ckgaxsacp003bp0vz167wczno","tag_id":"ckgaxsadi005tp0vz7c6y5we3","_id":"ckgaxsadj005wp0vzbmi989p2"},{"post_id":"ckgaxsacr003ep0vzgpe18oy0","tag_id":"ckgaxsadj005vp0vz4itt5tk7","_id":"ckgaxsadj005yp0vz2uvdbx7b"},{"post_id":"ckgaxsacs003gp0vz4822f2a9","tag_id":"ckgaxsadj005xp0vza50889tc","_id":"ckgaxsadk0060p0vz3x8u4xp0"},{"post_id":"ckgaxsacw003kp0vz1a0j8e54","tag_id":"ckgaxsadk005zp0vz31990e38","_id":"ckgaxsadn0064p0vzht8mawfi"},{"post_id":"ckgaxsacw003kp0vz1a0j8e54","tag_id":"ckgaxsadk0061p0vz5bvzf3vx","_id":"ckgaxsadn0065p0vz9nlb011q"},{"post_id":"ckgaxsacw003kp0vz1a0j8e54","tag_id":"ckgaxsadm0062p0vzhcbb5isu","_id":"ckgaxsadp0067p0vzcc0q2mcr"},{"post_id":"ckgaxsacx003np0vzbo0wa35c","tag_id":"ckgaxsad8004jp0vzh77taoy4","_id":"ckgaxsadp0068p0vzheleaa44"},{"post_id":"ckgaxsacz003rp0vzfbqeak3b","tag_id":"ckgaxsado0066p0vz6mlrf08f","_id":"ckgaxsadp006ap0vz410i53s0"},{"post_id":"ckgaxsad0003up0vz7nmyczxi","tag_id":"ckgaxsadp0069p0vz5cstfdg6","_id":"ckgaxsadq006cp0vzhtl5a4pd"},{"post_id":"ckgaxsad2003xp0vz67epbfod","tag_id":"ckgaxsadq006bp0vz88qb6hog","_id":"ckgaxsadq006dp0vzfbbe1six"},{"post_id":"ckgaxsad2003xp0vz67epbfod","tag_id":"ckgaxsacv003jp0vz2lu9g8ef","_id":"ckgaxsadq006ep0vz3fh1cxn9"},{"post_id":"ckgaxsaes006fp0vz56q8g95k","tag_id":"ckgaxsadi005tp0vz7c6y5we3","_id":"ckgaxsaet006hp0vz18xh6o0t"},{"post_id":"ckgaxsaeu006kp0vz89hg23gy","tag_id":"ckgaxsad2003yp0vzbg974no0","_id":"ckgaxsaew006op0vz094sddks"},{"post_id":"ckgaxsaeu006kp0vz89hg23gy","tag_id":"ckgaxsad7004fp0vzabgu12si","_id":"ckgaxsaex006sp0vz3mfz4smd"},{"post_id":"ckgaxsaet006gp0vzfnuudtj9","tag_id":"ckgaxsaeu006jp0vzg8l50z7x","_id":"ckgaxsaey006up0vzh2rgb84w"},{"post_id":"ckgaxsaet006ip0vz7bxp5u1v","tag_id":"ckgaxsaex006qp0vzf6k70h2o","_id":"ckgaxsaey006xp0vz3xof6fcd"},{"post_id":"ckgaxsaev006mp0vz89be0wsl","tag_id":"ckgaxsaey006wp0vz1spefo1w","_id":"ckgaxsaez0070p0vz6vag5mod"},{"post_id":"ckgaxsaew006pp0vz6wf12gtd","tag_id":"ckgaxsaey006zp0vze3k2bpp9","_id":"ckgaxsaez0071p0vzdy7u7hv1"},{"post_id":"ckgfr41lu0000lkvzdp8tcapz","tag_id":"ckgfr41m00001lkvzdg8c18u6","_id":"ckgfr41mh0003lkvz92vs9wxn"},{"post_id":"ckgfr41n40005lkvzenhpgluj","tag_id":"ckgcu81wq0002tsvz80362js8","_id":"ckgfr41n70007lkvzeqdb2uiv"},{"post_id":"ckgfr41n40005lkvzenhpgluj","tag_id":"ckgaxsace002sp0vzffr1bs4d","_id":"ckgfr41n70009lkvzdyxoet63"},{"post_id":"ckgfr41mu0004lkvz6g6v5jc2","tag_id":"ckgfr41n50006lkvz4r914gq7","_id":"ckgfr41n7000blkvz3p7e30zx"},{"post_id":"ckgo0pgyt000064vz4gtt7x3s","tag_id":"ckgaxsaak0005p0vzgvxu582y","_id":"ckgo0pgzq000364vzbcvl4jv2"},{"post_id":"ckgo0pgyt000064vz4gtt7x3s","tag_id":"ckgaxsace002sp0vzffr1bs4d","_id":"ckgo0pgzq000464vzdy0baqcc"},{"post_id":"ckgo0pgyt000064vz4gtt7x3s","tag_id":"ckgo0pgz7000164vzcx7c6py8","_id":"ckgo0pgzr000564vz8ciwe8qm"},{"post_id":"ckhi87lwq0000jgvzdit3h8gw","tag_id":"ckhi87lx10001jgvzfi2v4vu0","_id":"ckhi87lxh0003jgvz9eb25knw"},{"post_id":"ckhj2wb3600009kvz0jsg7xy0","tag_id":"ckhi87lx10001jgvzfi2v4vu0","_id":"ckhj2wb3z00059kvz6ecn7sdu"},{"post_id":"ckhj2wb3600009kvz0jsg7xy0","tag_id":"ckhj2wb3x00039kvzdxsb9zq9","_id":"ckhj2wb4000069kvz9y5yc8sc"},{"post_id":"cki1lyue90000ekvzaflh6z0c","tag_id":"cki1lyuew0002ekvz6phi20sd","_id":"cki1lyuf00006ekvz0gie82w9"},{"post_id":"cki1lyue90000ekvzaflh6z0c","tag_id":"cki1lyuex0003ekvz4e9y2diz","_id":"cki1lyuf00007ekvz57wu1hug"},{"post_id":"cki1lyue90000ekvzaflh6z0c","tag_id":"cki1lyuey0005ekvzgz01bqrw","_id":"cki1lyuf00008ekvz21atek80"},{"post_id":"cki1lyuf50009ekvzdjurbxyh","tag_id":"cki1lyuex0003ekvz4e9y2diz","_id":"cki1lyuf7000aekvz3wyqcat9"},{"post_id":"ckktscdl90000coo1fe0t1axy","tag_id":"ckgaxsadj005vp0vz4itt5tk7","_id":"ckktscdmm0001coo1181ad3tf"},{"post_id":"ckktscdl90000coo1fe0t1axy","tag_id":"ckgaxsace002sp0vzffr1bs4d","_id":"ckktscdmo0002coo1d2wb0h64"}],"Tag":[{"name":"ADB","_id":"ckgaxsaak0005p0vzgvxu582y"},{"name":"网站优化","_id":"ckgaxsaar000dp0vzbnba8dsy"},{"name":"Bootstrap","_id":"ckgaxsaax000lp0vzei2q3le4"},{"name":"Flutter","_id":"ckgaxsab0000rp0vzfb294w4q"},{"name":"Kali Linux","_id":"ckgaxsab5000yp0vzc86ggirl"},{"name":"Linux","_id":"ckgaxsab80016p0vz3ue28k0r"},{"name":"YAAW","_id":"ckgaxsabe001ep0vz189c4vpq"},{"name":"Oneindex","_id":"ckgaxsabk001lp0vz3iehc1jf"},{"name":"深度学习","_id":"ckgaxsabv001zp0vz4cf01k6e"},{"name":"PyTorch","_id":"ckgaxsac20027p0vz0vgc9wtv"},{"name":"Pandas","_id":"ckgaxsac6002ep0vz24w31osi"},{"name":"数据处理","_id":"ckgaxsaca002mp0vz7i466q7v"},{"name":"Python","_id":"ckgaxsace002sp0vzffr1bs4d"},{"name":"Matplotlib","_id":"ckgaxsacj0030p0vzdj8d0fme"},{"name":"Numpy","_id":"ckgaxsacm0037p0vzbqw54jpo"},{"name":"Rclone","_id":"ckgaxsacv003jp0vz2lu9g8ef"},{"name":"SSR","_id":"ckgaxsacy003qp0vz6zczgcqf"},{"name":"Stunnel","_id":"ckgaxsad2003yp0vzbg974no0"},{"name":"haproxy","_id":"ckgaxsad50047p0vzdpz1cznk"},{"name":"负载均衡","_id":"ckgaxsad6004ap0vzfotmb3oh"},{"name":"ShopXO","_id":"ckgaxsad6004cp0vzfoi18nya"},{"name":"Squid","_id":"ckgaxsad7004fp0vzabgu12si"},{"name":"Mysql","_id":"ckgaxsad7004ip0vz3upb4b6g"},{"name":"Volantis","_id":"ckgaxsad8004jp0vzh77taoy4"},{"name":"TensorFlow","_id":"ckgaxsad8004mp0vz5gfqck6h"},{"name":"Git","_id":"ckgaxsad9004op0vz45xo9vgg"},{"name":"Cookie","_id":"ckgaxsad9004qp0vz8k1o4rp6"},{"name":"浏览器插件","_id":"ckgaxsada004sp0vz1v012nga"},{"name":"JSON","_id":"ckgaxsadb004up0vzhliq2pok"},{"name":"JsDelivr","_id":"ckgaxsadb004wp0vzd1536p03"},{"name":"Magento","_id":"ckgaxsadb004yp0vzfvkiedll"},{"name":"树莓派","_id":"ckgaxsadc0050p0vze8rf9o8p"},{"name":"API","_id":"ckgaxsadc0052p0vz6gwx2ndb"},{"name":"音乐播放器","_id":"ckgaxsade0058p0vz4g3kexk3"},{"name":"电商","_id":"ckgaxsade005bp0vzb27sdta3"},{"name":"VPN","_id":"ckgaxsadf005ep0vzh5eg8bnw"},{"name":"微信公众号","_id":"ckgaxsadf005gp0vzfgrl1gk3"},{"name":"微信小程序","_id":"ckgaxsadg005ip0vzecq24cer"},{"name":"安卓开源库","_id":"ckgaxsadg005kp0vz3z7ibxq1"},{"name":"机器学习","_id":"ckgaxsadh005mp0vz5s529n23"},{"name":"正则表达式","_id":"ckgaxsadi005qp0vz7jotcg4o"},{"name":"Selenium","_id":"ckgaxsadi005tp0vz7c6y5we3"},{"name":"爬虫","_id":"ckgaxsadj005vp0vz4itt5tk7"},{"name":"移动网络","_id":"ckgaxsadj005xp0vza50889tc"},{"name":"博客","_id":"ckgaxsadk005zp0vz31990e38"},{"name":"Hexo","_id":"ckgaxsadk0061p0vz5bvzf3vx"},{"name":"Vlantis","_id":"ckgaxsadm0062p0vzhcbb5isu"},{"name":"电商系统","_id":"ckgaxsado0066p0vz6mlrf08f"},{"name":"Nginx","_id":"ckgaxsadp0069p0vz5cstfdg6"},{"name":"Aria2","_id":"ckgaxsadq006bp0vz88qb6hog"},{"name":"Stunnel代理","_id":"ckgaxsaeu006jp0vzg8l50z7x"},{"name":"Vuejs","_id":"ckgaxsaex006qp0vzf6k70h2o"},{"name":"网络技术","_id":"ckgaxsaey006wp0vz1spefo1w"},{"name":"安卓编程","_id":"ckgaxsaey006zp0vze3k2bpp9"},{"name":"Mitmproxy","_id":"ckgcu81wq0002tsvz80362js8"},{"name":"-Python","_id":"ckgfr41m00001lkvzdg8c18u6"},{"name":"-TWRP","_id":"ckgfr41n50006lkvz4r914gq7"},{"name":"Java","_id":"ckgo0pgz7000164vzcx7c6py8"},{"name":"人工智能","_id":"ckhi87lx10001jgvzfi2v4vu0"},{"name":"AI","_id":"ckhj2wb3x00039kvzdxsb9zq9"},{"name":"Arduino","_id":"cki1lyuew0002ekvz6phi20sd"},{"name":"ESP8266","_id":"cki1lyuex0003ekvz4e9y2diz"},{"name":"MPU6050","_id":"cki1lyuey0005ekvzgz01bqrw"}]}}